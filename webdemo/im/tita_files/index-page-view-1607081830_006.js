/*! tita-web-v4 - v0.4.0 - 2016-07-08 18:31 */function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function dataProcessor(a){return this.serverProcessor=a,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this._headers=null,this._payload=null,this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhx4._eventable(this),this}define("templates/plan",[],function(){return this.JST=this.JST||{},this.JST["plan/g-chart/back-content"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<a class="legendIntroduce" style="display:none;" href="javascript:void(0)">图例说明</a><a class="gantt_btn" href="#plan">\n	<span class="gantt_small_bt"></span>\n\n\n\n\n\n',"personal"==type&&(__p+='\n		<img src="'+(null==(__t=Small)?"":__t)+'" />'+(null==(__t=UserName)?"":__t)+"的"+(null==(__t=year)?"":__t)+"年",month&&(__p+=(null==(__t=month)?"":__t)+"月"),week&&(__p+=" "+(null==(__t=week)?"":__t)),__p+=(null==(__t=i18n.plan_1)?"":__t)+"\n"),__p+=" \n\n","group"==type&&(__p+='\n		<span class="groupText">团队的'+(null==(__t=year)?"":__t)+"年",month&&(__p+=(null==(__t=month)?"":__t)+"月"),__p+="\n			",week&&(__p+=null==(__t=week)?"":__t),__p+=(null==(__t=i18n.plan_1)?"":__t)+"</span>\n"),__p+=" \n\n</a>";return __p},this.JST["plan/g-chart/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="gannt_navBack"></div>\n<div class="_tt_loading_m">努力加载中…</div>\n<div class="gantt-main _tt_plan_container"></div>';return __p},this.JST["plan/histroy/histroy-list-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)ThisYear||(__p+='\n<div class="year_hylt"><span>以下为'+(null==(__t=Year)?"":__t)+"年操作历史</span></div>\n"),__p+="\n<ul>\n	",_.each(Data,function(a,b){__p+='\n		<li class="item_hylt ',Data.length==b+1&&(__p+="noborder"),__p+='">\n		',__p+="undefined"!=typeof a.Today&&a.Today?'\n			<span class="data_hylt">'+(null==(__t=a.Today)?"":__t)+"</span>\n		":'\n			<span class="data_hylt">'+(null==(__t=a.Month)?"":__t)+"月"+(null==(__t=a.Day)?"":__t)+"日</span>\n		",__p+="\n\n		","undefined"!=typeof a.PlanOperationModelsByUser&&a.PlanOperationModelsByUser?(__p+="\n				",_.each(a.PlanOperationModelsByUser,function(a){__p+="\n				<table>\n					<tr> \n						","undefined"!=typeof IsShowAvatar&&IsShowAvatar&&(__p+='\n						<td class="avatar_hylt">\n							<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'">\n\n								'+(null==(__t=_.convertImage({className:"",src:a.User.Avatar.Small,size:30,shape:"radius",name:a.User.Name,bgColor:a.User.Avatar.Color}))?"":__t)+"\n							</a>\n						</td>\n						"),__p+='\n						<td class="cont_hylt">\n							<ul>\n								',_.each(a.PlanOperationModels,function(b){__p+="\n									","1"==b.Source.TepId?(__p+='\n									<li>\n										<!--丹丹在 2013年12月第4周计划表中 添加了计划项 12月第四周的计划-->\n										<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n										<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>","undefined"!=typeof b.Source.PlanTableName&&b.Source.PlanTableName&&(__p+="在&nbsp;"+(null==(__t=b.Source.PlanTableName)?"":__t)+"&nbsp;中"),__p+="&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"\n									</li>\n									"):"2"==b.Source.TepId?(__p+='\n									<li>\n										<!--刚刚 在2013年12月第4周计划表中 中 设置了计划项 30号的计划 的截止时间为 2013年11月22日 23:00-->\n										<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n										<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>","undefined"!=typeof b.Source.PlanTableName&&b.Source.PlanTableName&&(__p+="在&nbsp;"+(null==(__t=b.Source.PlanTableName)?"":__t)+"中&nbsp;"),__p+="&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"&nbsp;"+(null==(__t=b.Source.Content2)?"":__t)+"\n									</li>\n									"):"3"==b.Source.TepId?__p+='\n										<li>\n											<!--丹丹 在2013年12月第4周计划表中 添加共享者 海海-->\n											<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n											<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>&nbsp;在"+(null==(__t=b.Source.PlanName)?"":__t)+"&nbsp;中&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+'&nbsp;<a href="/u/'+(null==(__t=b.Source.ToUserId)?"":__t)+'" title="" class="link_hylt">'+(null==(__t=b.Source.ToUserName)?"":__t)+"</a>\n										</li>\n									":"4"==b.Source.TepId?__p+='\n										<li>\n											<!--丹丹 在12月第四周的计划 中 在计划项 2013年12月第4周计划表 下分解出任务 123-->\n											<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n											<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>&nbsp;在"+(null==(__t=b.Source.PlanTableName)?"":__t)+"&nbsp;中&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"</a>&nbsp;"+(null==(__t=b.Source.Content2)?"":__t)+'&nbsp;<a href="'+(null==(__t=b.Source.TaskUrl)?"":__t)+'" title="" class="link_hylt" target="_blank">'+(null==(__t=b.Source.ObjName)?"":__t)+"</a>\n										</li>\n									":"5"==b.Source.TepId&&(__p+='www\n									<!--x 在xxx计划表中 通过任务xxx 生成了 计划项xxxx-->\n										<li>\n											<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n											<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>&nbsp;在"+(null==(__t=b.Source.PlanTableName)?"":__t)+"&nbsp;中&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+'&nbsp;<a href="'+(null==(__t=b.Source.TaskUrl)?"":__t)+'" title="" class="link_hylt" target="_blank">'+(null==(__t=b.Source.ObjName)?"":__t)+"</a>&nbsp;"+(null==(__t=b.Source.Content2)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"\n										</li>\n									"),__p+="\n								"}),__p+="\n							</ul>\n						</td>\n					</tr>\n				</table>\n				"}),__p+="\n			\n		"):(__p+='\n				<table>\n					<tr> \n						<td class="cont_hylt">\n							<ul>\n								',_.each(a.PlanOperationModels,function(a){__p+="\n								\n									","1"==a.Source.TepId?__p+='\n									<!--丹丹 添加了计划项 12月第四周的计划-->\n									<li>\n										<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n										<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"\n									</li>\n									":"2"==a.Source.TepId?__p+='\n									<!--刚刚  设置了计划项 30号的计划 的截止时间为 2013年11月22日 23:00-->\n									<li>\n										<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n										<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"&nbsp;"+(null==(__t=a.Source.Content2)?"":__t)+"\n									</li>\n									":"3"==a.Source.TepId?__p+='\n										<!--丹丹 添加共享者 海海-->\n										<li>\n											<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n											<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+'&nbsp;<a href="/u/'+(null==(__t=a.Source.ToUserId)?"":__t)+'" title="" class="link_hylt">'+(null==(__t=a.Source.ToUserName)?"":__t)+"</a>\n										</li>\n									":"4"==a.Source.TepId?__p+='\n										<!--XX 在计划项 XXX下分解出任务XXXX-->\n										<li>\n\n											<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n											<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"&nbsp;"+(null==(__t=a.Source.Content2)?"":__t)+'&nbsp;<a href="'+(null==(__t=a.Source.TaskUrl)?"":__t)+'" title="" class="link_hylt">'+(null==(__t=a.Source.ObjName)?"":__t)+"</a>\n										</li>\n									":"5"==a.Source.TepId&&(__p+='\n										<!--XX 通过任务XXX(objName)生成了计划项XXX-->\n										<li>\n											<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n											<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+'&nbsp;<a href="'+(null==(__t=a.Source.TaskUrl)?"":__t)+'" target="_blank" title="" class="link_hylt">'+(null==(__t=a.Source.ObjName)?"":__t)+"</a>&nbsp;"+(null==(__t=a.Source.Content2)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"\n										</li>\n									"),__p+="\n								"}),__p+="\n							</ul>\n						</td>\n					</tr>\n				</table>\n			\n		"),__p+="\n		</li>\n	"}),__p+="\n</ul>\n\n\n";return __p},this.JST["plan/histroy/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="_tt_plan_histroy">\n	<div class="pagetitle"><h2>团队所有操作历史</h2></div>\n\n	<div class="_tt_plan_histroy_list">\n		<div class="_tt_loading_m">努力加载中…</div>\n	</div>\n</div>';return __p},this.JST["plan/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='\n	<!-- side sub nav -->\n	<div class="_tt_layout_tabnav tu-col-3" data-tu-submenu="tu-submenu">\n		<div data-name="side-bar-user-info" class="tt_side_subnav_userinfo"></div>\n		<div data-name="side-bar-nav"></div>\n	</div>\n	<!-- side sub nav end -->\n	<div class="_tt_layout_container  tu-col-13">\n		<div class="_tt_loading_m">努力加载中…</div>		\n	</div>\n	<div class="tt_plan_detail_container"></div>\n	';return __p},this.JST["plan/plan-list-data-nav"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<dl class="list">\r\n	',navData&&navData.length>0&&(__p+="\r\n		",_.each(navData,function(a,b){__p+='\r\n			<dd class="',0==b&&(__p+="noborder"),__p+='">\r\n			',__p+=routerData.isMySelf?'\r\n			<a data-trigger="false" href="#plan?type='+(null==(__t=routerData.type)?"":__t)+"&group_id="+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=routerData.tag_type)?"":__t)+"&tag_id="+(null==(__t=routerData.tag_id)?"":__t)+"&plan_table_id="+(null==(__t=a.PlanTableId)?"":__t)+'" >\r\n				'+(null==(__t=a.Name)?"":__t)+"\r\n			</a>\r\n			":'\r\n			<a data-trigger="false" href="#plan?type='+(null==(__t=routerData.type)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&group_id="+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=routerData.tag_type)?"":__t)+"&tag_id="+(null==(__t=routerData.tag_id)?"":__t)+"&plan_table_id="+(null==(__t=a.PlanTableId)?"":__t)+'">\r\n				'+(null==(__t=a.Name)?"":__t)+"\r\n			</a>\r\n			",__p+="\r\n			\r\n			</dd>\r\n		"}),__p+="\r\n	"),__p+="\r\n</dl>	\r\n";return __p},this.JST["plan/plan-list-empty"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="content">\r\n	',to_user_id!=loginUserId||"personal"!=type||isSearch?"group"!=type||isSearch?(__p+="\r\n		\r\n		","undefined"==typeof IsNotify||1!=IsNotify||isSearch?(__p+="\r\n			",__p+=isSearch?'\r\n				<span class="text">暂无数据</span>\r\n			':'\r\n				<span class="text">Ta还没有写'+(null==(__t=i18n.plan_1)?"":__t)+"</span>\r\n			",__p+="\r\n		"):__p+='\r\n		<span class="text">Ta还没有写'+(null==(__t=i18n.plan_1)?"":__t)+'，你可以</span>\r\n		<a user-id="'+(null==(__t=to_user_id)?"":__t)+'" href="javascript:void(0)" class="btnnotice btn btn-sure">正式通知Ta写'+(null==(__t=i18n.plan_1)?"":__t)+"</a>\r\n		",__p+="\r\n	"):__p+='\r\n		<span class="text">您的团队还没有发布自己的'+(null==(__t=i18n.plan_1)?"":__t)+"</span>\r\n	":__p+='\r\n\r\n		<span class="text">把'+(null==(__t=i18n.plan_1)?"":__t)+"写下来，你就已经成功了一半！</span>\r\n	",__p+="\r\n</div>";return __p},this.JST["plan/plan-list-feedback"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="loadfeed">\r\n	<div class="img_loadfed">\r\n		<span>tita努力加载中...</span>\r\n	</div>\r\n</div>\r\n\r\n';return __p},this.JST["plan/plan-list-layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='	<div class="_tt_plan_table"></div>\r\n	<div class="_tt_pagetab"></div>\r\n	<div data-name="plan-create-form"></div>\r\n	<div data-name="plan-data-filter">\r\n		<div class="_tt_loading_m">努力加载中…</div>\r\n	</div>\r\n	<div class="_tt_planlistcontanier">\r\n		<div class="_tt_loading_m">努力加载中…</div>\r\n	</div>\r\n	<div class="_tt_plan_tab_extra">\r\n		<ul class="tt_plan_feedback_histroy">\r\n			<li>\r\n				<a href="javascript:void(0);" data-trigger="false" type="feedBack">评价沟通</a>\r\n			</li>\r\n			<li><a href="javascript:void(0);" data-trigger="false" type="daily">工作总结</a></li>\r\n			<li><a href="javascript:void(0);" data-trigger="false" type="histroy">操作历史</a></li>\r\n		</ul>\r\n		<div class="_tt_feedback"></div>\r\n		<div class="tt_plan_tab_daily"></div>\r\n		<div class="_tt_tab_histroy"></div>\r\n	</div>\r\n	<div data-name="share-range"></div>\r\n<!--plan end-->';return __p},this.JST["plan/plan-list-sidebar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_side_subnav_wrap">\r\n	',"personal"==routerData.type&&(__p+='\r\n		<div class="subtab_ssw">\r\n			',isShowPlan&&(__p+='\r\n			<li class="active"><a href="#plan?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+'" title=""><span>'+(null==(__t=i18n.plan_1)?"":__t)+"</span></a></li>\r\n			"),__p+="\r\n			",IsUsePlanDaily&&(__p+='\r\n			<li><a href="#daily?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+'" title=""><span>总结</span></a></li>\r\n			'),__p+="\r\n			\r\n		</div>\r\n	"),__p+='\r\n	<div class="year_ssw" data-name="year-list">\r\n		<a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown"><span>'+(null==(__t=current_year)?"":__t)+'</span><b class="caret"></b></a>\r\n		<ul class="dropdown_ssw">\r\n			',_.each(groupDatas,function(a){__p+='\r\n				<li><a href="#plan?group_id='+(null==(__t=a.GroupId)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" title="" groupid="'+(null==(__t=a.GroupId)?"":__t)+'">'+(null==(__t=a.GroupName)?"":__t)+"</a></li>\r\n			"}),__p+='\r\n		</ul>\r\n	</div>\r\n	\r\n	<ul class="_tt_side_subnav">			\r\n		',_.each(navData,function(a){__p+="\r\n				",routerData.isMySelf||"personal"!=routerData.type?routerData.isMySelf&&"personal"==routerData.type?__p+='\r\n					<li>\r\n					<a data-trigger="false" href="#plan?group_id='+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=a.TagType)?"":__t)+"&tag_id="+(null==(__t=a.TagId)?"":__t)+'">'+(null==(__t=a.TagName)?"":__t)+"</a>	\r\n					</li>\r\n				":"group"==routerData.type&&(__p+='\r\n					<li>\r\n					<a data-trigger="false" href="#plan?type=group&group_id='+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=a.TagType)?"":__t)+"&tag_id="+(null==(__t=a.TagId)?"":__t)+'">'+(null==(__t=a.TagName)?"":__t)+"</a>	\r\n					</li>\r\n				"):__p+='\r\n				<li>\r\n					<a data-trigger="false" href="#plan?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+"&group_id="+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=a.TagType)?"":__t)+"&tag_id="+(null==(__t=a.TagId)?"":__t)+'">'+(null==(__t=a.TagName)?"":__t)+"</a>			\r\n				</li>\r\n				",__p+="	\r\n		"}),__p+="\r\n	</ul>\r\n</div>";return __p},this.JST["plan/plan-notice/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="userwho"></div>\r\n<div class="sendbox"></div>\r\n';return __p},this.JST["plan/plan-notice/sent-box"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="mailtemplate">\r\n	',__p+=IsSendMail?'\r\n	<div class="input-default">\r\n		<textarea name="" rows="" cols="">'+(null==(__t=MailContent)?"":__t)+"</textarea>\r\n	</div>\r\n	":'\r\n	<div class="input-default input-disable">\r\n		<textarea name="" rows="" cols="" disabled="true">'+(null==(__t=MailContent)?"":__t)+"</textarea>\r\n	</div>\r\n	",__p+='\r\n	<ul class="settype">\r\n		<li>\r\n			<a href="javascript:void(0);" class="disabel_check_st"><span class="ico"></span></a>\r\n			<strong>系统通知</strong><span>（内容为系统自动生成）</span>\r\n		</li>\r\n		<li>\r\n			',__p+=IsSendMail?'\r\n			<a href="javascript:void(0);" class="check_st check_check_st"><span class="ico"></span></a>\r\n			':'\r\n			<a href="javascript:void(0);" class="check_st"><span class="ico"></span></a>\r\n			',__p+='\r\n			<strong>正式邮件通知</strong><span>（内容需自行编辑）</span>\r\n		</li>\r\n	</ul>\r\n	<div class="senderwrap">\r\n		<ul class="copytoself">\r\n			',IsSendMail?(__p+="\r\n				",__p+=IsCopySelf?'\r\n				<li><a class="checkbox checkbox-checked" href="javascript:void(0);"><span class="ico"></span></a>\r\n				<span>同时抄送我自己</span></li>\r\n				':'\r\n				<li><a class="checkbox" href="javascript:void(0);"><span class="ico"></span></a>\r\n				<span>同时抄送我自己</span></li>\r\n				',__p+="\r\n			"):__p+='\r\n				<li><a class="disabel_check_st" href="javascript:void(0);"><span class="ico"></span></a>\r\n				<span>同时抄送我自己</span></li>\r\n			',__p+="\r\n		</div>\r\n	</div>\r\n</div>";return __p},this.JST["plan/plan-notice/user-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+=(null==(__t=_.convertImage({className:"avatar_uw",src:UserAvatar.Small,size:30,shape:"radius",name:Name,bgColor:UserAvatar.Color}))?"":__t)+'\r\n\r\n<a href="javascript:void(0);" class="select_uw"><span class="ico"></span></a>\r\n';return __p},this.JST["plan/plan-notice/user-list"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="title_uw">通知对象：</div>\r\n<ul class="list_uw"></ul>';return __p},this.JST["plan/plan-sidebar-top"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)"personal"==routerData.type?(__p+='\n<div class="_tt_selectyearplan">\n	<a href="#italent/home?appid=1&apptype=1&name=TalentProfile-record&to_user_id='+(null==(__t=user.Id)?"":__t)+'" class="avatar_ttsyp" title="'+(null==(__t=user.Name)?"":__t)+'">\n		',__p+="undefined"!=typeof user.UserAvatar&&user.UserAvatar.HasAvatar===!1?"\n			"+(null==(__t=_.convertImage({className:"",src:"qqq",size:50,shape:"radius",name:user.Name,bgColor:user.UserAvatar.Color}))?"":__t)+"\n		":'\n			<img class="radius_img50" src="'+(null==(__t=user.UserAvatar.Medium)?"":__t)+'" width="50" height="50">\n		',__p+='\n	</a>\n	<div class="wrap">  \n		<a class="name_ttsyp" href="#italent/home?appid=1&apptype=1&name=TalentProfile-record&to_user_id='+(null==(__t=user.Id)?"":__t)+'">'+(null==(__t=user.Name)?"":__t)+'</a>\n		<span class="department_ttsyp">'+(null==(__t=user.Department)?"":__t)+"</span>\n		\n    </div>	\n</div>\n"):__p+='\n<div class="tt_side_subnav_group">\n	<span class="ico_ssg"></span>\n	<div class="text_ssg">'+(null==(__t=team_name)?"":__t)+"</div>\n</div>\n";return __p},this.JST["plan/table/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_plan_table_container">\r\n	<div class="tt_plan_table_tab">\r\n	\r\n		<div class="_tt_plan_table_btn">\r\n			',14!=tag_id&&(__p+='\r\n			<a href="javascript:void(0)" class="btn" data-name="enter-group">\r\n				',__p+="group"==type?"\r\n					我的"+(null==(__t=i18n.plan_1)?"":__t)+"\r\n				":"\r\n					团队"+(null==(__t=i18n.plan_1)?"":__t)+"\r\n				",__p+='\r\n			</a>\r\n			<a href="#" class="btn gantt_btn">甘特图</a>\r\n			<a href="javascript:void(0)" class="btn btnnoticesuperior">提醒上级查看</a>\r\n			'),__p+='\r\n			<div class="tt_plan_table_btn_right">\r\n				',14!=tag_id&&(__p+='\r\n				<a href="javascript:void(0);" class="btn media_ptbr" data-name="level-view">隔级查看</a>\r\n				',IsUsePlanDaily&&(__p+='\r\n					<a href="#daily?type=group" class="btn media_ptbr">团队日报</a>\r\n				'),__p+='\r\n				<a href="#set?page_id=plan" class="btn media_ptbr">设置团队成员</a>\r\n				<a href="javascript:void(0)" data-trigger="false" class="btn media_ptbr" data-name="up-set">上级规定</a>\r\n				'),__p+='\r\n				<a href="javascript:void(0);" class="btn btnMore">更多<span class="icon-arrow-down-2t"></span></a>\r\n\r\n				<ul class="dropdown_ptbr" data-name="more-drop-down-box">\r\n					<li class="media_ptbr"><a href="javascript:void(0);" data-name="level-view">隔级查看</a></li>\r\n					',IsUsePlanDaily&&(__p+='\r\n						<li class="media_ptbr">\r\n							<a href="#daily?type=group" data-name="enter-group">团队日报</a>\r\n						</li>\r\n					'),__p+='\r\n					\r\n					<li class="media_ptbr"><a href="#set?page_id=plan">设置团队成员</a></li>\r\n					<li class="media_ptbr"><a href="javascript:void(0)" data-name="up-set" data-trigger="false">上级规定</a></li>\r\n					<li data-name="approval-group" class="disabled">\r\n						<a href="javascript:void(0)" data-name="enter-apply">团队'+(null==(__t=i18n.plan_1)?"":__t)+'审批</a>\r\n					</li>\r\n					<li data-type="notice" class="disabled">\r\n						<a href="javascript:void(0);">通知团队写'+(null==(__t=i18n.plan_1)?"":__t)+'</a>\r\n					</li>\r\n					<li data-type="history">\r\n						<a href="#plan/histroy">查看团队所有操作历史<span class="indicator" style="display: none;"></span></a>\r\n					</li>\r\n					<li><a href="'+(null==(__t=printUrl)?"":__t)+'" target="_blank" class="btnPrint">打印与导出</a></li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="tt_plan_table_list_container">\r\n		\r\n	</div>\r\n</div>\r\n\r\n';return __p},this.JST}),define("views/plan/plan-list-layout",["talent","templates/plan"],function(a,b){return a.Layout.extend({template:b["plan/plan-list-layout"],className:"_tt_plan_container",regions:{planNav:"._tt_pagetab",planList:"._tt_planlistcontanier",planFeedBack:"._tt_feedback",planHistroy:"._tt_tab_histroy",planHistroy:"._tt_tab_histroy",sharerange:"[data-name=share-range]",planTabExtra:"._tt_plan_tab_extra",daily:".tt_plan_tab_daily",planTable:"._tt_plan_table",planNewItemForm:"div[data-name=plan-create-form]",planDataFilter:'div[data-name="plan-data-filter"]'},initialize:function(){this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1}})}),define("views/plan/plan-list-data-nav-item-view",["talent","templates/plan"],function(a,b){return a.ItemView.extend({template:b["plan/plan-list-data-nav"],initialize:function(){}})}),define("views/common/bs-tab/bs-tab",["talent"],function(a){return a.ItemView.extend({template:_.template(),initialize:function(a){this.$el=a.el,a.getActiveNodeByData&&(this.getActiveNodeByData=a.getActiveNodeByData),a.getActiveNodeByNode&&(this.getActiveNodeByNode=a.getActiveNodeByNode),a.getEventTriggerNode&&(this.getEventTriggerNode=a.getEventTriggerNode);var b=a.eventNode||"a",c=_.debounce(this.onTabClick,300,!0),d=this.$el.data("bb-cid");d&&this.$el.off(".delegateEvents"+d),this.$el.data("bb-cid",this.cid),this.events=function(){var a={};return a["click "+b]=c,a},this.activeClassName=a.activeClassName?a.activeClassName:"active"},setDefault:function(a){this.$el.find("."+this.activeClassName).removeClass(this.activeClassName);var b=this.getActiveNodeByData(a);this.activeNode=b,b.addClass(this.activeClassName)},onTabClick:function(b){var c=this,d=a.$(b.currentTarget);d.attr("outside")||(c.activeNode&&c.activeNode.removeClass(c.activeClassName),c.activeNode=c.getActiveNodeByNode(d),c.activeNode.addClass(c.activeClassName),c.options.eventTriggerName&&a.app.vent.trigger("tab:"+c.options.eventTriggerName+":change",c.getEventTriggerNode(d)))},getEventTriggerNode:function(a){return a},getActiveNodeByData:function(b){var c="";a._.each(b,function(a,b){c+=b+"="+a+"&"}),c=c.slice(0,c.length-1);var d=this.getActiveNodeByNode(this.$el.find('a[href$="'+c+'"]'));return d},getActiveNodeByNode:function(a){return a.parent()},getActiveNode:function(){return this.activeNode}})}),define("views/common/share-range/share-range-view",["talent","templates/common","tdialog","UserSelector","collections/smember-group-collection","$.tipsy"],function(a,b,c,d,e){var f=a.ItemView.extend({tagName:"li",className:"item_sr",template:b["common/share-range/share-range-item"],onRender:function(){var a=this;1==this.model.get("Type")&&this.$el.addClass("disable"),this.$el.tipsy({gravity:"s",title:function(){var b=a.$el.hasClass("disable")?"":"删除：";return b+a.model.get("User").Name}})}}),g=a.ItemView.extend({template:a._.template("<%= emptyText%>"),defaults:{},tagName:"li",className:"empty_sr",templateHelpers:function(){return this.settings},initialize:function(){this.settings=a._.extend({},this.defaults,this.options)}});return a.CompositeView.extend({className:"tt_sharerange",defaults:{deleteTip:"确定把ta共享里删除",addBtnTips:"添加共享人，将本月或本周计划共享给ta",title:"共享给谁？",isEdit:!1,emptyText:"暂无共享者",userSelectOptions:{viewType:"single",input:!0,stringLen:{Name:34,Email:30,DepartmentName:30},bias:{left:30,top:-302},muti:!0}},template:b["common/share-range/share-range"],itemView:f,itemViewContainer:"ul",ui:{add:"a[data-name=add]","delete":"span[data-name=delete]"},events:{"mouseenter li":"_liOverHandler","mouseleave li":"_liOutHandler","click span[data-name=delete]":"_deleteShareItem"},modelEvents:{"change:isEdit":"render"},templateHelpers:function(){return this.settings},onRender:function(){var a=this;if(!this.collection.length&&!this.model.get("isEdit")){var b=new g({emptyText:this.settings.emptyText});this.$el.find("ul").html(b.render().$el)}this._addShareUser(),this.ui.add.tipsy({gravity:"s",title:function(){return a.settings.addBtnTips}})},initialize:function(){this.settings=a.$.extend({},this.defaults,this.options),this.settings.userSelectOptions=a._.extend({},this.defaults.userSelectOptions,this.options.userSelectOptions),this.model.set(this.settings)},appendHtml:function(a,b){this.model.get("isEdit")?a.$el.find("li:last").before(b.el):(b.$el.addClass("disable"),b.$el.find(".del_sr").remove(),a.$el.find("ul").append(b.el))},_addShareUser:function(){var b=this,c=this.ui.add;this.memberSmemberView=new d({collection:new e}),this.memberSmemberView.addNode(c,this.settings.userSelectOptions),c.on("submit",function(d,e){var f,g=[];f=e.data?e.data:[e],a._.each(f,function(a){g.push("department"==a.type?{Id:a.id,Name:a.name,Email:a.name+":"+a.id+":dep_members"}:{Id:a.Id,Name:a.Name,Email:a.Email})}),b.trigger("add",c,g)})},_liOverHandler:function(b){var c=a.$(b.currentTarget);c.find(".del_sr").show()},_liOutHandler:function(b){var c=a.$(b.currentTarget);c.find(".del_sr").hide()},_deleteShareItem:function(b){var c=a.$(b.currentTarget),d=c.attr("Id");a.$(".tipsy").remove(),this._deleteDialog(c,this.settings.deleteTip,d)},_deleteDialog:function(a,b,d){var e=this;this.delDialog=new c({type:"tipsy",sure:function(){e.trigger("delete",a,d),e.delDialog.remove()},cancel:!0}),$("body").append(this.delDialog.render().$el),this.delDialog.show(a,b,{pos:"top",className:"ask",arrow:!1})},onClose:function(){this.delDialog&&this.delDialog.close()}})}),define("views/plan/plan-list-feedback-item-view",["talent","templates/plan","TitaWidget"],function(a,b,c){return a.ItemView.extend({template:b["plan/plan-list-feedback"],className:"_tt_feedbackcontent",ui:{feedbackcontent:"._tt_feedbackcontent"},initialize:function(){},onRender:function(){var b=this,d=this.model.get("feedData"),e=d.total,f=d.comments||[];f.length>4&&(f=f.slice(f.length-4,f.length)),b.feedCommentListView=new c.CommentListView({isInAppPage:!1,onlyComment:!0,mBlogOptions:{defaultHide:!1,defaultValue:"",isShowSendSms:!1},custom:{more:!0,remind:!0,collect:!0,reply:!0},actionMore:{detail:!0,"delete":!0,setTop:!0},isPrivate:!1,privateTipText:"",feedId:b.model.get("feedId"),defaultCount:4,feedType:4,model:new a.Model({total:e,comments:f})}),b.listenTo(b.feedCommentListView,"more",function(){a.app.request("Comment:getFeedItemComment",{feed_id:b.model.get("feedId"),comment_type:0}).done(function(a){b.feedCommentListView.feedCommentListView.collection.reset(a.comments)})}),this.$el.html(b.feedCommentListView.render().$el)}})}),define("views/common/empty-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{emptyContext:""},template:b["common/empty"],className:"tt_common_emptyinit",initialize:function(a){this.settings=Talent._.extend({},this.defaults,a)},templateHelpers:function(){var a=this.settings.emptyContext?this.settings.emptyContext:this.model.get("emptyContext"),b=0;return a&&(b=a.replace(/<[^>].*?>/g,"").replace(/[&nbsp;]/g,"").length),{emptyContext:a,className:b>24?"small_content_emptyinit":"content_emptyinit"}}})}),define("views/plan/plan-list-daily-view",["talent","templates/plan","TitaWidget","views/common/empty-view"],function(a,b,c,d){return a.ItemView.extend({template:b["plan/plan-list-feedback"],className:"_tt_feedbackcontent",ui:{feedbackcontent:"._tt_feedbackcontent"},onShow:function(){var b=this,e=(this.model.get("feedId"),this.model.get("plan_table_id"));a.app.request("Feed:getObjFeed",{obj_id:e,obj_type:8,feed_count:10,comment_count:4,start:"",to_user_id:b.model.get("to_user_id")}).done(function(e){var f={IsEnd:e.IsEnd,LastId:e.LastId,feeds:e.Data};if(f.feeds&&f.feeds.length)b.feedCompositeView=new c.FeedListView({model:new a.Model(f)}),b.$el.html(b.feedCompositeView.render().$el);else{var g=new d({emptyContext:"尚无最新总结"});b.$el.html(g.render().$el)}}).fail(function(a){deferred.reject(a)})}})}),define("views/plan/plan-notice/send-view",["talent","templates/plan"],function(a,b){return a.CompositeView.extend({template:b["plan/plan-notice/sent-box"],ui:{inpuCheck:"a.check_st",textarea:".input-default",copyCheck:"a.checkbox"},events:function(){var a={};return a["click "+this.ui.inpuCheck]="_toggelTab",a["click "+this.ui.copyCheck]="onCopyCheck",a},initialize:function(){this.model.set("IsSendMail",!0),this.model.set("IsCopySelf",!0),this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1},modelEvents:{change:"render"},templateHelpers:function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=new Date(a.getTime()+6048e5),f=e.getMonth()+1,g=e.getDate();return{MailContent:this.model.get("MailContent")||"各位：\n请尽快在tita上填写你的"+this.iPlan+",最晚于"+f+"月"+g+"号提交。",RecipientName:this.model.get("RecipientName")||"",SenderName:this.model.get("SenderName")||"",SendTime:this.model.get("SendTime")||b+"年"+c+"月"+d+"日"}},_toggelTab:function(){this.model.get("IsSendMail")?this.model.set("IsSendMail",!1):this.model.set("IsSendMail",!0)},onCopyCheck:function(){this.model.get("IsCopySelf")?this.model.set("IsCopySelf",!1):this.model.set("IsCopySelf",!0)},getCotent:function(){if(this.model.get("IsSendMail")){var b=a.$(this.ui.textarea).find("textarea").val();return b=b.replace(/[\n\r]/g,"</br>")}return""},reset:function(){this.model.set("IsSendMail",!0),this.model.set("IsCopySelf",!0)}})}),define("views/plan/plan-notice/user-item-view",["talent","templates/plan","$.tipsy"],function(a,b){return a.ItemView.extend({tagName:"li",template:b["plan/plan-notice/user-item"],initialize:function(){this.isDisableSelect=this.options.isDisableSelect||!1},onRender:function(){this.isDisableSelect&&a.$(this.el).addClass("disable"),this.model.get("IsActive")?a.$(this.el).addClass("active"):a.$(this.el).removeClass("active"),a.$(this.el).attr("Id",this.model.get("Id")),$(".tipsy").hide(),a.$(this.el).find(".avatar_uw").tipsy({gravity:"s"})},onClose:function(){$(".tipsy").hide()}})}),define("views/plan/plan-notice/user-composite-view",["talent","templates/plan","views/plan/plan-notice/user-item-view","tdialog"],function(a,b,c,d){return a.CompositeView.extend({template:b["plan/plan-notice/user-list"],itemViewContainer:"ul",itemView:c,ui:{item:"li"},events:function(){var a={};return a["click "+this.ui.item]="_selectUser",a["mouseenter "+this.ui.item]="_hoverUser",a["mouseleave "+this.ui.item]="_hoverUser",a},collectionEvents:{change:"render"},initialize:function(){this.userListData=[]
},request:function(){{var b=this;a.app.request("UserSubordinate:getSubordinate",{level:2}).done(function(a){b.userListData=a,b.collection.reset(b.addAttr(a))})}},returnUserIds:function(){var b=[];return a._.filter(this.collection.toJSON(),function(c){if(c.IsActive){var d=a._.pick(c,"Id");b.push(a._.values(d))}}),b.join(",")},_selectUser:function(b){var c=this;if(this.model.get("isDisableSelect"))return!0;var e=a.$(b.currentTarget),f=e.index(),g=this.collection.at(f);c.selectUserTipView&&c.selectUserTipView.$el.remove();var h=a._.filter(this.collection.toJSON(),function(a){return a.IsActive?a.IsActive:void 0});return h.length<=1&&g.get("IsActive")?(this.selectUserTipView=new d({fixed:!1,type:"modal",cancel:!1,sure:!1,zindex:1001}),this.selectUserTipView.render().$el.appendTo("body"),this.selectUserTipView.show(e,'<div class="innerhtml_dialog">请至少选择一个通知对象</div>',{arrow:!1,pos:"bottomCenter"}),void setTimeout(function(){c.selectUserTipView.$el.remove()},3e3)):void(g.get("IsActive")?g.set("IsActive",!1):g.set("IsActive",!0))},_hoverUser:function(b){var c=a.$(b.currentTarget);c.toggleClass("hover")},addAttr:function(a){for(var b=0;b<a.length;b++)a[b].IsActive=!0;return a},reset:function(){this.collection.reset(this.addAttr(this.userListData))},itemViewOptions:function(){var a=this.model.get("isDisableSelect")||!1;return{isDisableSelect:a}}})}),define("views/plan/plan-notice/index-page-view",["talent","templates/common","views/plan/plan-notice/send-view","views/plan/plan-notice/user-composite-view"],function(a,b,c,d){var e=a.Layout.extend({tagName:"div",className:"noticemessage",template:b["plan/plan-notice/index-page"],regions:{userList:".userwho",sendbox:".sendbox"},initialize:function(){var b=this;this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1,this.userIds=[],this.isShowUserList=0==this.options.isShowUserList?!1:!0,this.isToSubordinate=1==this.options.isToSubordinate?!0:!1,this.isToSuperior=1==this.options.isToSuperior?!0:!1,this.superiorUser=this.options.superiorUser&&this.options.superiorUser!={}?this.options.superiorUser:{},this.routerData=this.options.routerData||[],this.loginUser=a.Context.getUserInfo();var e=this.routerData.tag_id,f=this.routerData.startDate||"",g="";g=e&&e>1?e-1+"月":a._.substring(f,6),this.sendView=new c,this.userCompositeView=new d;a.app.request("UserSubordinate:getSubordinate",{level:2}).done(function(c){if(b.isToSuperior)var d=b.superiorUser;else if(b.isToSubordinate)var d=a._.filter(c,function(a){return a.Id==b.routerData.to_user_id});var e=new Date,f=e.getFullYear(),h=e.getMonth()+1,i=e.getDate(),j=new Date(e.getTime()+6048e5),k=(j.getMonth()+1,j.getDate(),"各位");if(b.isToSuperior){k=d[0].Name;var l="你好，我已填好"+g+b.routerData.plan_table_name+b.iPlan+"，请查阅。"}else{b.isToSubordinate&&(k=d[0].Name);var l="请及时交付"+g+b.routerData.plan_table_name+b.iPlan+"，务必严格执行。\n制定"+b.iPlan+"时请遵循以下几点：\n1.要具体、可达、可衡量，突出重点，详情中可以描述目标与措施。\n2.有未完成的，可酌情纳入本期"+b.iPlan+"。"}if(b.sendView.model.set("MailContent",l),b.sendView.model.set("RecipientName",k),b.sendView.model.set("SenderName",b.loginUser.Name),b.sendView.model.set("SendTime",f+"年"+h+"月"+i+"日"),b.isToSubordinate||b.isToSuperior){var m=b.userCompositeView.addAttr(d);b.userCompositeView.model.set("isDisableSelect",!0)}else var m=b.userCompositeView.addAttr(c);b.userCompositeView.collection.reset(m)});this.$el.bind("click",function(a){a.stopPropagation()})},onRender:function(){this.isShowUserList?this.userList.show(this.userCompositeView):this.$el.find(this.regions.userList).hide(),this.sendbox.show(this.sendView)},setuserIds:function(a){this.userIds=a},getUserIds:function(){if(!this.isShowUserList)return this.userIds;var a=this.userCompositeView.returnUserIds(),b=this.sendView.model.get("IsCopySelf")&&this.sendView.model.get("IsSendMail")?!0:!1;return b&&(a=a+","+this.loginUser.Id),a},getMailCont:function(){return this.sendView.getCotent()},getMailSender:function(){return this.loginUser.Name},reset:function(){this.sendView.reset(),this.userCompositeView.reset()}});return e}),define("views/plan/plan-list-empty-view",["talent","templates/plan","views/plan/plan-notice/index-page-view","tdialog"],function(a,b,c,d){return a.ItemView.extend({template:b["plan/plan-list-empty"],className:"_tt_emptyplanlist",templateHelpers:function(){return{loginUserId:this.loginUser.Id,to_user_id:this.routerData.to_user_id,IsNotify:this.routerData.IsNotify||0,i18n:a.Context.getI18n(),type:this.routerData.type||"personal",isSearch:this.routerData.isSearch}},initialize:function(){this.routerData=this.options.model.toJSON(),this.loginUser=a.Context.getUserInfo(),this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1},events:{"click .btnnotice":"renderNoticeDialogView"},onRender:function(){},renderNoticeDialogView:function(b){b.stopPropagation();var e=this;this.planNoticeIndexPageView||(this.planNoticeIndexPageView=new c({isShowUserList:!0,isToSubordinate:!0,routerData:this.routerData}),this.noticeDialogView=new d({fixed:!1,type:"modal",sure:function(){e.sendNotce()},cancel:!0}),this.$el.find(".content").append(this.noticeDialogView.render().$el));var f=this.planNoticeIndexPageView.render().el;this.noticeDialogView.show(a.$(b.target),f,{arrow:2,pos:"bottomRight",height:492,topBias:15,leftBias:10,arrowBias:0,container:this.$el.find(".content")})},sendNotce:function(){var b=this.routerData,c=this,d=this.planNoticeIndexPageView.getUserIds(),e={GroupId:b.group_id,TagId:b.tag_id,PlanTableId:b.plan_table_id,MessageType:12,UserIds:d},f=this.planNoticeIndexPageView.getMailCont(),g="";b.tag_id>1&&(g=b.tag_id-1+"月"),f&&(e.EmailContent=f),e.MessageContent="通知你写&nbsp;"+g+b.plan_table_name+this.iPlan,this.noticeDialogView.changeSubmitBtn(2);a.app.request("PlanCommmon:postSendNotice",e).done(function(){setTimeout(function(){c.noticeDialogView.changeSubmitBtn(1),c.noticeDialogView.$el.remove(),c.planNoticeSuperiorView=!1;var a=c.$el.find(".content");a.addClass("hassendnotice").html('<span class="icon"></span><span class="text">通知已发送</span>')},500)}).fail(function(){})},onClose:function(){}})}),define("views/common/error-tracker-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/error-tracker"],defaults:{content:"暂时没有查看权限",subContent:""},className:"_tt_errotracker",events:{"click #close":"clickClosed"},templateHelpers:function(){return{content:this.settings.content,subContent:this.settings.subContent||""}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options)},onShow:function(){var a=3,b=this.$el.find("#secondNumClose"),c=null;c=setInterval(function(){b.html(a--),0>a&&clearInterval(c)},1e3)},clickClosed:function(){this.closeWindow()},closeWindow:function(){window.opener=null,window.open("","_self",""),window.close()}})}),define("views/plan/histroy/histroy-list-item-view",["talent","templates/plan"],function(a,b){return a.ItemView.extend({tagName:"div",className:"itembyyear_hylt",template:b["plan/histroy/histroy-list-item"],templateHelpers:function(){var a=new Date,b=a.getFullYear();return{ThisYear:this.model.get("Year")==b?!0:!1}},initialize:function(){var b=this,c=this.model.get("Data");this.userInfo=a.Context.getUserInfo(),a._.each(c,function(c){c.PlanOperationModelsByUser?a._.each(c.PlanOperationModelsByUser,function(c){a._.each(c.PlanOperationModels,function(a){b._joinUrl(a.Source)})}):a._.each(c.PlanOperationModels,function(a){b._joinUrl(a.Source)})}),this.model.set("Data",c)},onRender:function(){},_joinUrl:function(a){{var b=a.TepId;a.UserId}if((4==b||5==b)&&a.ObjId){var c="/u/"+this.userInfo.Id+"/Home#more/taskinfo?id="+a.ObjId;a.TaskUrl=c}}})}),define("views/plan/histroy/histroy-list-view",["talent","templates/plan","views/plan/histroy/histroy-list-item-view","views/common/empty-view"],function(a,b,c,d){return a.CollectionView.extend({defaults:{isShowAvatar:!1,emptyContext:null},className:"_tt_histroy_list",itemView:c,itemViewContainer:this.$el,emptyView:d,initialize:function(){this.settings=a.$.extend({},this.defaults,this.options)},onBeforeItemAdded:function(a){a.model.set("IsShowAvatar",this.settings.isShowAvatar)},itemViewOptions:function(){return{emptyContext:this.settings.emptyContext}}})}),define("views/plan/histroy/index-page-view",["talent","templates/plan","views/plan/histroy/histroy-list-view"],function(a,b,c){var d=a.Layout.extend({template:b["plan/histroy/index-page"],className:"_tt_page_container",regions:{history:"._tt_plan_histroy_list"},initialize:function(){this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1,a.Context.setPageTitle("tita-团队所有操作历史")},onRender:function(){this.renderHistroyList()},renderHistroyList:function(){var b=this;a.app.request("Plan:getAllHistroyData",{}).done(function(d){b.histroyListView||(b.histroyListView=new c({collection:new a.Collection(d),isShowAvatar:!0,emptyContext:"还没有任何"+b.iPlan+"的操作记录"}),b.history.show(b.histroyListView))}).fail(function(a){alert(a)})}});return a.BasePageView.extend({mainViewClass:d,layout:window.top==window?"master-layout":"empty-layout"})}),define("views/common/membership/membership-tab-composite-view",["talent","templates/common"],function(a,b){var c=a.CompositeView.extend({template:b["common/membership/membership-tab-composite"],tagName:"ul",initialize:function(a){this.options=a||{},this.itemViewOptions={direction:this.options.direction,middleId:this.options.middleId,activeId:this.options.activeId,hasSuperior:"0"==this.model.get("Id")?!1:!0},this.dealData(),this.collection=this.model.subordinate},onRender:function(){1==this.model.get("level")&&this.$el.addClass("first_ul"),2==this.model.get("level")&&this.$el.addClass("second_ul"),this.model.get("Id")==this.options.activeId&&this.$el.find("div:first").addClass("active"),this.options.hasSuperior?"0"==this.model.get("subordinateCount")&&"3"!=this.model.get("level")&&this.$el.find(".membership_line").addClass("membership_line_last"):"0"==this.model.get("subordinateCount")&&(this.$el.find(".membership_line").addClass("membership_line_last"),this.$el.find(".membership_line").css({width:0}))},appendHtml:function(a,b){a.$("li:first").find(".membership_subordinate_container").append(b.el)},dealData:function(){var a=12;(1==this.model.get("level")||2==this.model.get("level"))&&(a=6),this.model.set("subName",this.subString(this.model.get("Name"),a,!0))},subString:function(a,b,c){for(var d=0,e="",f=/[^\x00-\xff]/g,g="",a=a||"",h=a.replace(f,"**").length,i=0;h>i&&(g=a.charAt(i).toString(),null!=g.match(f)?d+=2:d++,!(d>b));i++)e+=g;return c&&h>b&&(e+="..."),e}});return a.CollectionView.extend({itemView:c,events:{"click .membreship_subordinate_btn":"changeActiveId","click .membership_item_short":"changeActiveId","click .membership_item_long":"changeProfileId"},initialize:function(a){this.itemViewOptions=this.model.toJSON()},changeActiveId:function(b){var c=this,d=a.$(b.target).parents("li"),e=d.attr("data-id"),f=d.attr("level");if(3!=f){var g=a.app.request("Membership:getSuperior",{id:e}),h="1"==f?"1-3":"2-3";g.done(function(a){c.trigger("changeActiveId",{middleId:a,direction:h,activeId:e})})}else this.trigger("changeActiveId",{middleId:e,direction:"3-2",activeId:e});b.stopPropagation()},changeProfileId:function(b){{var c=a.$(b.target).parents("li"),d=c.attr("data-id");c.attr("")}this.trigger("changeProfileId",{profileId:d,activeId:d,middleId:this.model.get("middleId")})},onRender:function(){this.$el.find(".second_ul .membership_subordinate_container>ul:last").find(".membership_line").addClass("membership_line_last")},onShow:function(){this.trigger("allItemShow")}})}),function(a){var b=function(b){function c(){!E.find("#BS_scroll").length>0&&(F.style.position="relative",F.style.overflow="hidden",E.append(b.setStyle?['<div style="display:none;top:0;position: absolute;" id="BS_scroll"  >','<em style="min-height: 15px;display:inline-block;" id="BS_scroll_main"></em>',"</div>"].join(""):['<div style="display:none;top:0;position: absolute;right: 1px;width: 11px;" id="BS_scroll"  >','<em style="height:0;background-image: url('+A+'/webim_scroll_bg.png);background-position: -9px 0;background-repeat: repeat-y;width: 11px;min-height: 5px;border-radius: 4px;display:inline-block;" id="BS_scroll_main"></em>',"</div>"].join(""))),s=E.find("#BS_scroll")[0],s.style.zIndex=1e3,t=E.find("#BS_scroll_main")[0],o(F),n(F),d()}function d(){if(containerClientHeight=F.clientHeight,C&&0==containerClientHeight&&(containerClientHeight=F.offsetHeight),containerScrollHeight=E.find("ul").height(),u=containerClientHeight<containerScrollHeight){var a=containerClientHeight/containerScrollHeight,b=parseInt(containerClientHeight*a>D?containerClientHeight*a:D);t.style.height=b-7+"px",x=containerClientHeight-b,w=containerScrollHeight-containerClientHeight;var c=F.scrollTop/w;c>1&&(c=1),0>c&&(c=0),m(c),f()}}function e(){s.style.display="none"}function f(){s.style.display=""}function g(a){H||(H=!0,a=a||widow.event,y=a.clientY,r(a))}function h(a){if(H){a=a||window.event;var b=a.clientY;v=(b-y)/x+G,v>1&&(v=1),0>v&&(v=0),m(v),r(a)}}function i(){H&&(H=!1,G=v)}function j(b){{var b=b||window.event;b.srcElement||b.target}z&&clearTimeout(z),!u||(z=setTimeout(function(){f(),p(document,"mousemove",h),a(document).on("selectstart.sortable",function(){return!1})},300))}function k(){z&&clearTimeout(z),z=setTimeout(function(){e(),q(document,"mousemove",h),a(document).off("selectstart.sortable")},500)}function l(a){if(u){var b=B?a.detail:-a.wheelDelta/40;G=(F.scrollTop+16*b)/w,G>1&&(G=1,d()),0>G&&(G=0),m(G),r(a)}}function m(a){F.scrollTop=a*w,s.style.top=a*x+F.scrollTop+"px",v=a}function n(){p(F,B?"DOMMouseScroll":"mousewheel",l),p(t,"mousedown",g),p(document,"mouseup",i),p(F,"mouseover",j),p(F,"mouseout",k)}function o(){q(F,B?"DOMMouseScroll":"mousewheel",l),q(t,"mousedown",g),q(document,"mouseup",i),q(F,"mouseover",j),q(F,"mouseout",k)}function p(a,b,c){return window.addEventListener?a.addEventListener(b,c,!1):window.attachEvent?a.attachEvent("on"+b,c):{}}function q(a,b,c){return window.addEventListener?a.removeEventListener(b,c,!1):window.detachEvent?a.detachEvent("on"+b,c):{}}function r(a){a.preventDefault?a.preventDefault():a.returnValue=!1}var s,t,u,v,w,x,y,z,A=b.imgUrl||"",B=(b.setStyle,navigator.userAgent.toLowerCase().match(/firefox\/([\d.]+)/)),C=!window.XMLHttpRequest&&window.ActiveXObject,D=20,E=this,F=this[0],G=0,H=!1;c()};a.fn.extend({scrollable:b})}(jQuery),define("$.scrollable",function(){}),function(a,b){function c(a){return""===f?a:(a=a.charAt(0).toUpperCase()+a.substr(1),f+a)}var d=Math,e=b.createElement("div").style,f=function(){for(var a,b="t,webkitT,MozT,msT,OT".split(","),c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in e)return b[c].substr(0,b[c].length-1);return!1}(),g=f?"-"+f.toLowerCase()+"-":"",h=c("transform"),i=c("transitionProperty"),j=c("transitionDuration"),k=c("transformOrigin"),l=c("transitionTimingFunction"),m=c("transitionDelay"),n=/android/gi.test(navigator.appVersion),o=/iphone|ipad/gi.test(navigator.appVersion),p=/hp-tablet/gi.test(navigator.appVersion),q=c("perspective")in e,r="ontouchstart"in a&&!p,s=f!==!1,t=c("transition")in e,u="onorientationchange"in a?"orientationchange":"resize",v=r?"touchstart":"mousedown",w=r?"touchmove":"mousemove",x=r?"touchend":"mouseup",y=r?"touchcancel":"mouseup",z=function(){if(f===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return a[f]}(),A=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),B=function(){return a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout}(),C=q?" translateZ(0)":"",D=function(c,d){var e,f=this;f.wrapper="object"==typeof c?c:b.getElementById(c),f.wrapper.style.overflow="hidden",f.scroller=f.wrapper.children[0],f.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:n,hideScrollbar:o,fadeScrollbar:o&&q,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(e in d)f.options[e]=d[e];f.x=f.options.x,f.y=f.options.y,f.options.useTransform=s&&f.options.useTransform,f.options.hScrollbar=f.options.hScroll&&f.options.hScrollbar,f.options.vScrollbar=f.options.vScroll&&f.options.vScrollbar,f.options.zoom=f.options.useTransform&&f.options.zoom,f.options.useTransition=t&&f.options.useTransition,f.options.zoom&&n&&(C=""),f.scroller.style[i]=f.options.useTransform?g+"transform":"top left",f.scroller.style[j]="0",f.scroller.style[k]="0 0",f.options.useTransition&&(f.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)"),f.options.useTransform?f.scroller.style[h]="translate("+f.x+"px,"+f.y+"px)"+C:f.scroller.style.cssText+=";position:absolute;top:"+f.y+"px;left:"+f.x+"px",f.options.useTransition&&(f.options.fixedScrollbar=!0),f.refresh(),f._bind(u,a),f._bind(v),r||"none"!=f.options.wheelAction&&(f._bind("DOMMouseScroll"),f._bind("mousewheel")),f.options.checkDOMChanges&&(f.checkDOMTime=setInterval(function(){f._checkDOMChanges()},500))};D.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){var b=this;switch(a.type){case v:if(!r&&0!==a.button)return;b._start(a);break;case w:b._move(a);break;case x:case y:b._end(a);break;case u:b._resize();break;case"DOMMouseScroll":case"mousewheel":b._wheel(a);break;case z:b._transitionEnd(a)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(a){var c,e=this;return e[a+"Scrollbar"]?(e[a+"ScrollbarWrapper"]||(c=b.createElement("div"),e.options.scrollbarClass?c.className=e.options.scrollbarClass+a.toUpperCase():c.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(e.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(e.hScrollbar?"7":"2")+"px;top:2px;right:1px"),c.style.cssText+=";pointer-events:none;"+g+"transition-property:opacity;"+g+"transition-duration:"+(e.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(e.options.hideScrollbar?"0":"1"),e.wrapper.appendChild(c),e[a+"ScrollbarWrapper"]=c,c=b.createElement("div"),e.options.scrollbarClass||(c.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+g+"background-clip:padding-box;"+g+"box-sizing:border-box;"+("h"==a?"height:100%":"width:100%")+";"+g+"border-radius:3px;border-radius:3px"),c.style.cssText+=";pointer-events:none;"+g+"transition-property:"+g+"transform;"+g+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+g+"transition-duration:0;"+g+"transform: translate(0,0)"+C,e.options.useTransition&&(c.style.cssText+=";"+g+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),e[a+"ScrollbarWrapper"].appendChild(c),e[a+"ScrollbarIndicator"]=c),"h"==a?(e.hScrollbarSize=e.hScrollbarWrapper.clientWidth,e.hScrollbarIndicatorSize=d.max(d.round(e.hScrollbarSize*e.hScrollbarSize/e.scrollerW),8),e.hScrollbarIndicator.style.width=e.hScrollbarIndicatorSize+"px",e.hScrollbarMaxScroll=e.hScrollbarSize-e.hScrollbarIndicatorSize,e.hScrollbarProp=e.hScrollbarMaxScroll/e.maxScrollX):(e.vScrollbarSize=e.vScrollbarWrapper.clientHeight,e.vScrollbarIndicatorSize=d.max(d.round(e.vScrollbarSize*e.vScrollbarSize/e.scrollerH),8),e.vScrollbarIndicator.style.height=e.vScrollbarIndicatorSize+"px",e.vScrollbarMaxScroll=e.vScrollbarSize-e.vScrollbarIndicatorSize,e.vScrollbarProp=e.vScrollbarMaxScroll/e.maxScrollY),void e._scrollbarPos(a,!0)):void(e[a+"ScrollbarWrapper"]&&(s&&(e[a+"ScrollbarIndicator"].style[h]=""),e[a+"ScrollbarWrapper"].parentNode.removeChild(e[a+"ScrollbarWrapper"]),e[a+"ScrollbarWrapper"]=null,e[a+"ScrollbarIndicator"]=null))},_resize:function(){var a=this;setTimeout(function(){a.refresh()},n?200:0)},_pos:function(a,b){this.zoomed||(a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[h]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+C:(a=d.round(a),b=d.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(a,b){var c,e=this,f="h"==a?e.x:e.y;e[a+"Scrollbar"]&&(f=e[a+"ScrollbarProp"]*f,0>f?(e.options.fixedScrollbar||(c=e[a+"ScrollbarIndicatorSize"]+d.round(3*f),8>c&&(c=8),e[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px"),f=0):f>e[a+"ScrollbarMaxScroll"]&&(e.options.fixedScrollbar?f=e[a+"ScrollbarMaxScroll"]:(c=e[a+"ScrollbarIndicatorSize"]-d.round(3*(f-e[a+"ScrollbarMaxScroll"])),8>c&&(c=8),e[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px",f=e[a+"ScrollbarMaxScroll"]+(e[a+"ScrollbarIndicatorSize"]-c))),e[a+"ScrollbarWrapper"].style[m]="0",e[a+"ScrollbarWrapper"].style.opacity=b&&e.options.hideScrollbar?"0":"1",e[a+"ScrollbarIndicator"].style[h]="translate("+("h"==a?f+"px,0)":"0,"+f+"px)")+C)},_start:function(b){var c,e,f,g,i,j=this,k=r?b.touches[0]:b;j.enabled&&(j.options.onBeforeScrollStart&&j.options.onBeforeScrollStart.call(j,b),(j.options.useTransition||j.options.zoom)&&j._transitionTime(0),j.moved=!1,j.animating=!1,j.zoomed=!1,j.distX=0,j.distY=0,j.absDistX=0,j.absDistY=0,j.dirX=0,j.dirY=0,j.options.zoom&&r&&b.touches.length>1&&(g=d.abs(b.touches[0].pageX-b.touches[1].pageX),i=d.abs(b.touches[0].pageY-b.touches[1].pageY),j.touchesDistStart=d.sqrt(g*g+i*i),j.originX=d.abs(b.touches[0].pageX+b.touches[1].pageX-2*j.wrapperOffsetLeft)/2-j.x,j.originY=d.abs(b.touches[0].pageY+b.touches[1].pageY-2*j.wrapperOffsetTop)/2-j.y,j.options.onZoomStart&&j.options.onZoomStart.call(j,b)),j.options.momentum&&(j.options.useTransform?(c=getComputedStyle(j.scroller,null)[h].replace(/[^0-9\-.,]/g,"").split(","),e=+(c[12]||c[4]),f=+(c[13]||c[5])):(e=+getComputedStyle(j.scroller,null).left.replace(/[^0-9-]/g,""),f=+getComputedStyle(j.scroller,null).top.replace(/[^0-9-]/g,"")),(e!=j.x||f!=j.y)&&(j.options.useTransition?j._unbind(z):B(j.aniTime),j.steps=[],j._pos(e,f),j.options.onScrollEnd&&j.options.onScrollEnd.call(j))),j.absStartX=j.x,j.absStartY=j.y,j.startX=j.x,j.startY=j.y,j.pointX=k.pageX,j.pointY=k.pageY,j.startTime=b.timeStamp||Date.now(),j.options.onScrollStart&&j.options.onScrollStart.call(j,b),j._bind(w,a),j._bind(x,a),j._bind(y,a))},_move:function(a){var b,c,e,f=this,g=r?a.touches[0]:a,i=g.pageX-f.pointX,j=g.pageY-f.pointY,k=f.x+i,l=f.y+j,m=a.timeStamp||Date.now();return f.options.onBeforeScrollMove&&f.options.onBeforeScrollMove.call(f,a),f.options.zoom&&r&&a.touches.length>1?(b=d.abs(a.touches[0].pageX-a.touches[1].pageX),c=d.abs(a.touches[0].pageY-a.touches[1].pageY),f.touchesDist=d.sqrt(b*b+c*c),f.zoomed=!0,e=1/f.touchesDistStart*f.touchesDist*this.scale,e<f.options.zoomMin?e=.5*f.options.zoomMin*Math.pow(2,e/f.options.zoomMin):e>f.options.zoomMax&&(e=2*f.options.zoomMax*Math.pow(.5,f.options.zoomMax/e)),f.lastScale=e/this.scale,k=this.originX-this.originX*f.lastScale+this.x,l=this.originY-this.originY*f.lastScale+this.y,this.scroller.style[h]="translate("+k+"px,"+l+"px) scale("+e+")"+C,void(f.options.onZoom&&f.options.onZoom.call(f,a))):(f.pointX=g.pageX,f.pointY=g.pageY,(k>0||k<f.maxScrollX)&&(k=f.options.bounce?f.x+i/2:k>=0||f.maxScrollX>=0?0:f.maxScrollX),(l>f.minScrollY||l<f.maxScrollY)&&(l=f.options.bounce?f.y+j/2:l>=f.minScrollY||f.maxScrollY>=0?f.minScrollY:f.maxScrollY),f.distX+=i,f.distY+=j,f.absDistX=d.abs(f.distX),f.absDistY=d.abs(f.distY),void(f.absDistX<6&&f.absDistY<6||(f.options.lockDirection&&(f.absDistX>f.absDistY+5?(l=f.y,j=0):f.absDistY>f.absDistX+5&&(k=f.x,i=0)),f.moved=!0,f._pos(k,l),f.dirX=i>0?-1:0>i?1:0,f.dirY=j>0?-1:0>j?1:0,m-f.startTime>300&&(f.startTime=m,f.startX=f.x,f.startY=f.y),f.options.onScrollMove&&f.options.onScrollMove.call(f,a))))},_end:function(c){if(!r||0===c.touches.length){var e,f,g,i,k,l,m,n=this,o=r?c.changedTouches[0]:c,p={dist:0,time:0},q={dist:0,time:0},s=(c.timeStamp||Date.now())-n.startTime,t=n.x,u=n.y;if(n._unbind(w,a),n._unbind(x,a),n._unbind(y,a),n.options.onBeforeScrollEnd&&n.options.onBeforeScrollEnd.call(n,c),n.zoomed)return m=n.scale*n.lastScale,m=Math.max(n.options.zoomMin,m),m=Math.min(n.options.zoomMax,m),n.lastScale=m/n.scale,n.scale=m,n.x=n.originX-n.originX*n.lastScale+n.x,n.y=n.originY-n.originY*n.lastScale+n.y,n.scroller.style[j]="200ms",n.scroller.style[h]="translate("+n.x+"px,"+n.y+"px) scale("+n.scale+")"+C,n.zoomed=!1,n.refresh(),void(n.options.onZoomEnd&&n.options.onZoomEnd.call(n,c));if(!n.moved)return r&&(n.doubleTapTimer&&n.options.zoom?(clearTimeout(n.doubleTapTimer),n.doubleTapTimer=null,n.options.onZoomStart&&n.options.onZoomStart.call(n,c),n.zoom(n.pointX,n.pointY,1==n.scale?n.options.doubleTapZoom:1),n.options.onZoomEnd&&setTimeout(function(){n.options.onZoomEnd.call(n,c)},200)):this.options.handleClick&&(n.doubleTapTimer=setTimeout(function(){for(n.doubleTapTimer=null,e=o.target;1!=e.nodeType;)e=e.parentNode;"SELECT"!=e.tagName&&"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName&&(f=b.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!0,c.view,1,o.screenX,o.screenY,o.clientX,o.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null),f._fake=!0,e.dispatchEvent(f))},n.options.zoom?250:0))),n._resetPos(400),void(n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c));if(300>s&&n.options.momentum&&(p=t?n._momentum(t-n.startX,s,-n.x,n.scrollerW-n.wrapperW+n.x,n.options.bounce?n.wrapperW:0):p,q=u?n._momentum(u-n.startY,s,-n.y,n.maxScrollY<0?n.scrollerH-n.wrapperH+n.y-n.minScrollY:0,n.options.bounce?n.wrapperH:0):q,t=n.x+p.dist,u=n.y+q.dist,(n.x>0&&t>0||n.x<n.maxScrollX&&t<n.maxScrollX)&&(p={dist:0,time:0}),(n.y>n.minScrollY&&u>n.minScrollY||n.y<n.maxScrollY&&u<n.maxScrollY)&&(q={dist:0,time:0})),p.dist||q.dist)return k=d.max(d.max(p.time,q.time),10),n.options.snap&&(g=t-n.absStartX,i=u-n.absStartY,d.abs(g)<n.options.snapThreshold&&d.abs(i)<n.options.snapThreshold?n.scrollTo(n.absStartX,n.absStartY,200):(l=n._snap(t,u),t=l.x,u=l.y,k=d.max(l.time,k))),n.scrollTo(d.round(t),d.round(u),k),void(n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c));if(n.options.snap)return g=t-n.absStartX,i=u-n.absStartY,d.abs(g)<n.options.snapThreshold&&d.abs(i)<n.options.snapThreshold?n.scrollTo(n.absStartX,n.absStartY,200):(l=n._snap(n.x,n.y),(l.x!=n.x||l.y!=n.y)&&n.scrollTo(l.x,l.y,l.time)),void(n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c));n._resetPos(200),n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c)}},_resetPos:function(a){var b=this,c=b.x>=0?0:b.x<b.maxScrollX?b.maxScrollX:b.x,d=b.y>=b.minScrollY||b.maxScrollY>0?b.minScrollY:b.y<b.maxScrollY?b.maxScrollY:b.y;return c==b.x&&d==b.y?(b.moved&&(b.moved=!1,b.options.onScrollEnd&&b.options.onScrollEnd.call(b)),b.hScrollbar&&b.options.hideScrollbar&&("webkit"==f&&(b.hScrollbarWrapper.style[m]="300ms"),b.hScrollbarWrapper.style.opacity="0"),void(b.vScrollbar&&b.options.hideScrollbar&&("webkit"==f&&(b.vScrollbarWrapper.style[m]="300ms"),b.vScrollbarWrapper.style.opacity="0"))):void b.scrollTo(c,d,a||0)},_wheel:function(a){var b,c,d,e,f,g=this;if("wheelDeltaX"in a)b=a.wheelDeltaX/12,c=a.wheelDeltaY/12;else if("wheelDelta"in a)b=c=a.wheelDelta/12;else{if(!("detail"in a))return;b=c=3*-a.detail}return"zoom"==g.options.wheelAction?(f=g.scale*Math.pow(2,1/3*(c?c/Math.abs(c):0)),f<g.options.zoomMin&&(f=g.options.zoomMin),f>g.options.zoomMax&&(f=g.options.zoomMax),void(f!=g.scale&&(!g.wheelZoomCount&&g.options.onZoomStart&&g.options.onZoomStart.call(g,a),g.wheelZoomCount++,g.zoom(a.pageX,a.pageY,f,400),setTimeout(function(){g.wheelZoomCount--,!g.wheelZoomCount&&g.options.onZoomEnd&&g.options.onZoomEnd.call(g,a)},400)))):(d=g.x+b,e=g.y+c,d>0?d=0:d<g.maxScrollX&&(d=g.maxScrollX),e>g.minScrollY?e=g.minScrollY:e<g.maxScrollY&&(e=g.maxScrollY),void(g.maxScrollY<0&&g.scrollTo(d,e,0)))},_transitionEnd:function(a){var b=this;a.target==b.scroller&&(b._unbind(z),b._startAni())},_startAni:function(){var a,b,c,e=this,f=e.x,g=e.y,h=Date.now();if(!e.animating){if(!e.steps.length)return void e._resetPos(400);if(a=e.steps.shift(),a.x==f&&a.y==g&&(a.time=0),e.animating=!0,e.moved=!0,e.options.useTransition)return e._transitionTime(a.time),e._pos(a.x,a.y),e.animating=!1,void(a.time?e._bind(z):e._resetPos(0));c=function(){var i,j,k=Date.now();return k>=h+a.time?(e._pos(a.x,a.y),e.animating=!1,e.options.onAnimationEnd&&e.options.onAnimationEnd.call(e),void e._startAni()):(k=(k-h)/a.time-1,b=d.sqrt(1-k*k),i=(a.x-f)*b+f,j=(a.y-g)*b+g,e._pos(i,j),void(e.animating&&(e.aniTime=A(c))))},c()}},_transitionTime:function(a){a+="ms",this.scroller.style[j]=a,this.hScrollbar&&(this.hScrollbarIndicator.style[j]=a),this.vScrollbar&&(this.vScrollbarIndicator.style[j]=a)},_momentum:function(a,b,c,e,f){var g=6e-4,h=d.abs(a)/b,i=h*h/(2*g),j=0,k=0;return a>0&&i>c?(k=f/(6/(i/h*g)),c+=k,h=h*c/i,i=c):0>a&&i>e&&(k=f/(6/(i/h*g)),e+=k,h=h*e/i,i=e),i*=0>a?-1:1,j=h/g,{dist:i,time:d.round(j)}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return a!=this.wrapper&&(b*=this.scale,c*=this.scale),{left:b,top:c}},_snap:function(a,b){var c,e,f,g,h,i,j=this;for(f=j.pagesX.length-1,c=0,e=j.pagesX.length;e>c;c++)if(a>=j.pagesX[c]){f=c;break}for(f==j.currPageX&&f>0&&j.dirX<0&&f--,a=j.pagesX[f],h=d.abs(a-j.pagesX[j.currPageX]),h=h?d.abs(j.x-a)/h*500:0,j.currPageX=f,f=j.pagesY.length-1,c=0;f>c;c++)if(b>=j.pagesY[c]){f=c;break}return f==j.currPageY&&f>0&&j.dirY<0&&f--,b=j.pagesY[f],i=d.abs(b-j.pagesY[j.currPageY]),i=i?d.abs(j.y-b)/i*500:0,j.currPageY=f,g=d.round(d.max(h,i))||200,{x:a,y:b,time:g}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){var b=this;b.scroller.style[h]="",b.hScrollbar=!1,b.vScrollbar=!1,b._scrollbar("h"),b._scrollbar("v"),b._unbind(u,a),b._unbind(v),b._unbind(w,a),b._unbind(x,a),b._unbind(y,a),b.options.hasTouch||(b._unbind("DOMMouseScroll"),b._unbind("mousewheel")),b.options.useTransition&&b._unbind(z),b.options.checkDOMChanges&&clearInterval(b.checkDOMTime),b.options.onDestroy&&b.options.onDestroy.call(b)},refresh:function(){var a,b,c,e,f=this,g=0,h=0;if(f.scale<f.options.zoomMin&&(f.scale=f.options.zoomMin),f.wrapperW=f.wrapper.clientWidth||1,f.wrapperH=f.wrapper.clientHeight||1,f.minScrollY=-f.options.topOffset||0,f.scrollerW=d.round(f.scroller.offsetWidth*f.scale),f.scrollerH=d.round((f.scroller.offsetHeight+f.minScrollY)*f.scale),f.maxScrollX=f.wrapperW-f.scrollerW,f.maxScrollY=f.wrapperH-f.scrollerH+f.minScrollY,f.dirX=0,f.dirY=0,f.options.onRefresh&&f.options.onRefresh.call(f),f.hScroll=f.options.hScroll&&f.maxScrollX<0,f.vScroll=f.options.vScroll&&(!f.options.bounceLock&&!f.hScroll||f.scrollerH>f.wrapperH),f.hScrollbar=f.hScroll&&f.options.hScrollbar,f.vScrollbar=f.vScroll&&f.options.vScrollbar&&f.scrollerH>f.wrapperH,a=f._offset(f.wrapper),f.wrapperOffsetLeft=-a.left,f.wrapperOffsetTop=-a.top,"string"==typeof f.options.snap)for(f.pagesX=[],f.pagesY=[],e=f.scroller.querySelectorAll(f.options.snap),b=0,c=e.length;c>b;b++)g=f._offset(e[b]),g.left+=f.wrapperOffsetLeft,g.top+=f.wrapperOffsetTop,f.pagesX[b]=g.left<f.maxScrollX?f.maxScrollX:g.left*f.scale,f.pagesY[b]=g.top<f.maxScrollY?f.maxScrollY:g.top*f.scale;else if(f.options.snap){for(f.pagesX=[];g>=f.maxScrollX;)f.pagesX[h]=g,g-=f.wrapperW,h++;for(f.maxScrollX%f.wrapperW&&(f.pagesX[f.pagesX.length]=f.maxScrollX-f.pagesX[f.pagesX.length-1]+f.pagesX[f.pagesX.length-1]),g=0,h=0,f.pagesY=[];g>=f.maxScrollY;)f.pagesY[h]=g,g-=f.wrapperH,h++;
f.maxScrollY%f.wrapperH&&(f.pagesY[f.pagesY.length]=f.maxScrollY-f.pagesY[f.pagesY.length-1]+f.pagesY[f.pagesY.length-1])}f._scrollbar("h"),f._scrollbar("v"),f.zoomed||(f.scroller.style[j]="0",f._resetPos(400))},scrollTo:function(a,b,c,d){var e,f,g=this,h=a;for(g.stop(),h.length||(h=[{x:a,y:b,time:c,relative:d}]),e=0,f=h.length;f>e;e++)h[e].relative&&(h[e].x=g.x-h[e].x,h[e].y=g.y-h[e].y),g.steps.push({x:h[e].x,y:h[e].y,time:h[e].time||0});g._startAni()},scrollToElement:function(a,b){var c,e=this;a=a.nodeType?a:e.scroller.querySelector(a),a&&(c=e._offset(a),c.left+=e.wrapperOffsetLeft,c.top+=e.wrapperOffsetTop,c.left=c.left>0?0:c.left<e.maxScrollX?e.maxScrollX:c.left,c.top=c.top>e.minScrollY?e.minScrollY:c.top<e.maxScrollY?e.maxScrollY:c.top,b=void 0===b?d.max(2*d.abs(c.left),2*d.abs(c.top)):b,e.scrollTo(c.left,c.top,b))},scrollToPage:function(a,b,c){var d,e,f=this;c=void 0===c?400:c,f.options.onScrollStart&&f.options.onScrollStart.call(f),f.options.snap?(a="next"==a?f.currPageX+1:"prev"==a?f.currPageX-1:a,b="next"==b?f.currPageY+1:"prev"==b?f.currPageY-1:b,a=0>a?0:a>f.pagesX.length-1?f.pagesX.length-1:a,b=0>b?0:b>f.pagesY.length-1?f.pagesY.length-1:b,f.currPageX=a,f.currPageY=b,d=f.pagesX[a],e=f.pagesY[b]):(d=-f.wrapperW*a,e=-f.wrapperH*b,d<f.maxScrollX&&(d=f.maxScrollX),e<f.maxScrollY&&(e=f.maxScrollY)),f.scrollTo(d,e,c)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(w,a),this._unbind(x,a),this._unbind(y,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(z):B(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(a,b,c,d){var e=this,f=c/e.scale;e.options.useTransform&&(e.zoomed=!0,d=void 0===d?200:d,a=a-e.wrapperOffsetLeft-e.x,b=b-e.wrapperOffsetTop-e.y,e.x=a-a*f+e.x,e.y=b-b*f+e.y,e.scale=c,e.refresh(),e.x=e.x>0?0:e.x<e.maxScrollX?e.maxScrollX:e.x,e.y=e.y>e.minScrollY?e.minScrollY:e.y<e.maxScrollY?e.maxScrollY:e.y,e.scroller.style[j]=d+"ms",e.scroller.style[h]="translate("+e.x+"px,"+e.y+"px) scale("+c+")"+C,e.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},e=null,"undefined"!=typeof exports?exports.iScroll=D:a.iScroll=D}(window,document),define("iScroll",function(){}),define("views/common/membership/membership-tab-layout",["talent","templates/common","views/common/membership/membership-tab-composite-view","$.scrollable","iScroll"],function(a,b,c,d,e){function f(a,b,c,d,e,f){return e.level2.css(c),[function(){e.level1.css(a).animate(b,200,f)},function(){e.level2.animate(d,300,f)}]}function g(a,b,c,d,e,f){return e.level2.css(c),[function(){e.level1.hide().toggle("slow",f)},function(){e.level2.animate(d,200,f)}]}function h(a,b,c,d,e,f){return"0"==e.level1.parents("li").attr("data-id")?(e.level2.css(c),[function(){e.level1.hide().toggle("slow",f)},function(){e.level2.animate(d,200,f)}]):(e.level2.hide(),[function(){e.level1.hide().toggle("slow",f)},function(){e.level2.hide().toggle("slow",f)}])}function i(a,b){var c=a.model.get("direction"),d=j(a);d.line.hide(),d.level3.hide();var e=[],i=[function(){d.level3.toggle("slow",o)},function(){d.line.toggle("slow",o)},function(){b.resolve()}],k={"margin-left":10,"margin-top":10},l={"margin-left":-5,"margin-top":0};if("3-2"==c)var m={"margin-left":10,width:200,height:80,"margin-top":10},n={width:d.level2.width(),height:d.level2.height(),"margin-left":0,"margin-top":0};else var m={"margin-left":-20},n={"margin-left":0};var o=function(){a.$el.dequeue("slideList")};switch(c){case"3-2":e=f(k,l,m,n,d,o);break;case"2-3":e=g(k,l,m,n,d,o);break;default:e=h(k,l,m,n,d,o)}"0"==d.level1.parents("li").attr("data-id")&&(e=e.slice(1,e.length)),"0"==d.level1.parents("li").attr("data-id")&&0==a.$el.find(".second_ul li:first").attr("data-id")&&(d.level2.css(n),e=e.slice(1,e.length)),e=e.concat(i),a.$el.queue("slideList",e),o()}function j(a){var b=a.$el.find(".second_ul>li>div:first");return{level1:a.$el.find(".first_ul>li>div:first"),level2:b,level3:b.parent().find(".membership_subordinate_container"),line:a.$el.find(".membership_line")}}var k=a.Region.extend({show:function(a){var b=this;this.ensureEl();var c=a.isClosed||_.isUndefined(a.$el),d=a!==this.currentView;d&&this.close(),a.render(),d||c?this.open(a).done(function(){b.currentView=a,Marionette.triggerMethod.call(b,"show",a),Marionette.triggerMethod.call(a,"show")}):(this.currentView=a,Marionette.triggerMethod.call(this,"show",a),Marionette.triggerMethod.call(a,"show"))},open:function(a){var b=new $.Deferred;return this.$el.empty().append(a.el),i(a,b),b.promise()}}),l=a.Layout.extend({template:b["common/membership/membership-tab-layout"],className:"membership_tab_container",regions:{tab:{selector:".membership_tab_staff_container",regionType:k}},ui:{tab:".membership_tab_staff_container",backContainer:".membership_back",backBtn:".membership_back_btn"},events:{"click .membership_back_btn":"showTopStaffView"},modelEvents:{"change:middleId":"renderTabView","change:profileId":"renderProfileView","change:activeId":"renderActive"},initialize:function(){},onRender:function(){},getTabData:function(){var b=new $.Deferred,c=a.app.request("Membership:getDataType",{id:this.model.get("middleId"),activeId:this.model.get("activeId"),type:this.model.get("type")});return c.done(function(a){b.resolve(a)}),b.promise()},renderTabView:function(){var b=this,d=a.Model.extend({initialize:function(){var a=this.get("subordinate");a&&(this.subordinate=new e(a),this.unset("subordinate"))}}),e=a.Collection.extend({model:d});this.getTabData().done(function(a){b.membershipTabCompositeView=new c({collection:new e(a),model:b.model}),0==a[0].Id&&0==a[0].subordinate[0].Id?(b.ui.backBtn.slideUp("slow"),b.ui.tab.addClass("membership_top_staff")):(b.ui.backBtn.slideDown("slow"),b.ui.tab.removeClass("membership_top_staff")),b.renderTabBottomStaff(b.membershipTabCompositeView),b.bindEvents(b.membershipTabCompositeView)})},renderTabBottomStaff:function(a){var b=this;b.tab.show(a),b.topContainer=!1},bindEvents:function(a){var b=this;a.on("changeActiveId",function(a){b.model.set(a)}),a.on("changeProfileId",function(a){b.model.set(a)}),a.on("allItemShow",function(){b.afterTabAllRender()})},afterTabAllRender:function(){this.updateDimension();var b=this,c=a._.debounce(function(){b.updateDimension()},400);$(window).off("resize.membership_page"),$(window).on("resize.membership_page",c)},renderProfileView:function(){var a=this.model.get("profileId");this.trigger("detailIdChanged",a)},renderActive:function(){var a=this.model.get("activeId"),b=this.ui.tab.find('[data-id="'+a+'"]').find("div:first");b.hasClass("active")||(this.ui.tab.find(".active").removeClass("active"),b.addClass("active"))},onShow:function(){this.renderTabView()},showTopStaffView:function(){var b=a.Context.getUserInfo().Id;this.model.set({middleId:b,direction:"2-3"})},getIsMobile:function(){for(var a=navigator.userAgent,b=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),c=!0,d=0;d<b.length;d++)if(a.indexOf(b[d])>0){c=!1;break}return c},updateDimension:function(){var b=a.$("#header-region").outerHeight(),c=(a.$("#main-region").outerHeight(),a.$(window).height()-b),d=c-11-a.$(".membership_tab_top").outerHeight()-a.$(".membership_bottom").outerHeight()-a.$(".membership_back").outerHeight(),f=this.$el.find("#membership_scroll_container");f.height(d);var g=this.getIsMobile();g?f.scrollable({setStyle:!0}):this.tabScroll=new e("membership_scroll_container",{hScrollbar:!1,scrollbarClass:"myScrollbar"})}});return l}),define("views/common/membership/membership-tab-thumb-composite-view",["talent","templates/common","$.scrollable","iScroll","$.tipsy"],function(a,b,c,d){var e=a.ItemView.extend({template:b["common/membership/membership-tab-thumb-item"],tagName:"li",templateHelpers:function(){var a="narrow"==this.mode?30:"team"==this.mode?30:50;return{imgSize:a}},initialize:function(a){this.mode=a.mode||"team"},onRender:function(){this.$el.attr("data-id",this.model.get("Id")),this.$el.find(".membership_thumb_img").tipsy({gravity:"e",fallback:this.model.get("Name")});var a=this.model.get("Type")?this.model.get("Type"):0;a&&this.$el.addClass("dotted_radius_parent")}}),f=a.ItemView.extend({template:a._.template('<div class="membership_empty_tips"><%= text  %></div>'),initialize:function(a){var a=a||{};this.templateHelpers=a}});return a.CompositeView.extend({className:"membership_thumb_container",template:b["common/membership/membership-tab-thumb-composite"],itemView:e,itemViewContainer:".membership_thumb_container",emptyView:f,events:{"click .membership_thumb_img":"changeActiveId","click .membership_fold":"changeMode"},initialize:function(){if(0==this.collection.models.length){var a="membership"==this.model.get("viewName")?"暂无下属":"暂无共享";this.itemViewOptions={text:a}}else this.itemViewOptions={mode:this.model.get("mode")}},onAfterItemAdded:function(a){var b=parseInt(this.model.get("activeId"));(b==parseInt(a.model.get("Id"))||b==parseInt(a.model.get("id")))&&a.$el.find("img").addClass("active")},changeMode:function(){this.trigger("change:mode","wide")},changeActiveId:function(b){var c=a.$(b.currentTarget),d=c.parents("li").attr("data-id");this.$el.find(".membership_thumb_img").removeClass("active"),c.addClass("active"),this.trigger("detailIdChanged",d)},onRender:function(){"share"==this.model.get("viewName")&&this.$el.addClass("membership_share_container"),"membership"==this.model.get("viewName")&&this.$el.find("li").first().after('<div class="membership_fold_container"><div class="membership_fold"><span class="membership_fold_arrow"></span>展开</div></div>')},onShow:function(){this.updateDimension();var b=this,c=a._.debounce(function(){b.updateDimension()},400);$(window).off("resize.membership_page"),$(window).on("resize.membership_page",c)},updateDimension:function(){var b=a.$("#header-region").outerHeight(),c=(a.$("#main-region").outerHeight(),a.$(window).height()-b),e=c-1-a.$(".membership_tab_top").outerHeight()-a.$(".membership_bottom").outerHeight(),f=this.$el.find("#membership_scroll_container");f.height(e);var g=this.getIsMobile();g?f.scrollable({setStyle:!0}):this.tabScroll=new d("membership_scroll_container",{hScrollbar:!1,scrollbarClass:"myScrollbar"})},getIsMobile:function(){for(var a=navigator.userAgent,b=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),c=!0,d=0;d<b.length;d++)if(a.indexOf(b[d])>0){c=!1;break}return c}})}),define("views/common/membership/membership-tab-operate-view",["talent","templates/common","tdialog","views/plan/plan-notice/index-page-view","$.tipsy"],function(a,b,c,d){var e=a.ItemView.extend({tagName:"li",template:a._.template(['<% if(href != "") {%>',"	<a href=<%= href %>><%= name %></a>","<% } else { %>",'	<a href="javascript:void(0)"><%= name %></a>',"<% } %>"].join("")),initialize:function(){},onRender:function(){"history"==this.model.get("type")&&this.$el.find("a").append('<span class="indicator"></span>'),this.$el.attr("data-type",this.model.get("type"))}});return a.CompositeView.extend({template:b["common/membership/membership-tab-operate"],itemView:e,itemViewContainer:".menu-list",defaults:function(){return{data:[{name:"设置团队成员",href:"#set?page_id=plan",type:"set"},{name:"查看团队日报",href:"#daily?type=group",type:"daily-group"},{name:"通知大家写"+this.iPlan,href:"",type:"notice"},{name:"查看团队所有操作历史",href:"#plan/histroy",type:"history"}]}},events:{"click .membership_bottom_btn":"afterShowDropDownClick","mouseenter .membership_bottom_btn":"overShowDropDownClick","mouseleave .membership_bottom_btn":"leaveShowDropDownClick","click li[data-type=notice]":"renderNoticeDialogView","click li[data-type=daily-group]":"_dailyGroupClick"},modelEvents:{},initialize:function(){this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1;var b=this.defaults();this.collection=new a.Collection(b.data)},changeMode:function(a){this.$el.find(".membership_bottom").removeClass("short"),this.$el.find(".membership_bottom_btn").tipsy("disable"),"wide"!=a&&(this.$el.find(".membership_bottom_btn").tipsy({gravity:"se",fallback:"团队操作"}),this.$el.find(".membership_bottom").addClass("short"))},onShow:function(){this.getHistroyIndicator();var b=this;a.$("body").off("click.membership_drop"),a.$("body").on("click.membership_drop",function(){b.$el.find(".dropdown-menu").hide(),b.$el.find(".membership_bottom_btn .indicator_all").show(),b.noticeDialogView&&b.noticeDialogView.$el.hide()})},afterShowDropDownClick:function(b){var c=this;b.stopPropagation();var d=a.$(b.currentTarget);a.app.request("Membership:getSubordinateData",{}).done(function(b){var e=a.Context.getUserInfo().Id;!b||!b.length||1==b.length&&b[0].Id==e?c.$el.find("li[data-type=notice]").addClass("disable"):c.$el.find("li[data-type=notice]").removeClass("disable"),d.find(".indicator_all").hide(),d.find(".dropdown-menu").show()})},overShowDropDownClick:function(b){var c=a.$(b.currentTarget);c.addClass("hover")},leaveShowDropDownClick:function(b){var c=a.$(b.currentTarget);c.removeClass("hover")},_dailyGroupClick:function(){var a=this;setTimeout(function(){a.$el.find(".dropdown-menu").hide()},300)},renderNoticeDialogView:function(b){b.stopPropagation();var e=a.$(b.currentTarget);if(!e.hasClass("disable")){this.$el.find(".dropdown-menu").hide();var f=this;this.noticeViewStatus=!0,this.planNoticeIndexPageView=new d({isShowUserList:!0,isToSubordinate:!1,routerData:this.model.get("routerData")});var g=this.planNoticeIndexPageView.render().el;this.noticeDialogView=new c({fixed:!0,type:"modal",sure:function(){f.sendNotce()},cancel:function(){f.planNoticeIndexPageView.close(),f.noticeDialogView.$el.remove()}}),this.noticeDialogView.render().$el.appendTo("body");var h=this.$el.find(".membership_bottom_btn").offset().top-$(document).scrollTop();this.noticeDialogView.show(this.$el.find(".membership_bottom_btn"),g,{arrow:!1,pos:"leftBottom",height:487,arrowBias:-2,domOffTop:h})}},sendNotce:function(){var b=this.model.get("routerData"),c=this,d=this.planNoticeIndexPageView.getUserIds(),e={GroupId:b.group_id,TagId:b.tag_id,PlanTableId:b.plan_table_id,MessageType:12,UserIds:d},f=this.planNoticeIndexPageView.getMailCont(),g="";b.tag_id>1&&(g=b.tag_id-1+"月"),f&&(e.EmailContent=f),e.MessageContent="通知你写计划&nbsp;"+g+b.plan_table_name;a.app.request("PlanCommmon:postSendNotice",e).done(function(){c.planNoticeIndexPageView.close(),c.noticeDialogView.hide(),c.showMsgDialog("通知已发送",c.$el.find(".membership_bottom"))}).fail(function(){c.planNoticeIndexPageView.close(),c.noticeDialogView.hide(),c.showMsgDialog(msg,c.$el.find(".membership_bottom"))})},showMsgDialog:function(a,b){this.dialogView=new c({fixed:!0,type:"tipsy",pos:"leftCenter",sure:!1,cancel:!1,arrow:!1});var d=this;this.dialogView.render().$el.appendTo("body"),this.dialogView.show(b,a,{arrow:1,pos:"leftBottom",arrowBias:-15,topBias:0,className:"success"}),setTimeout(function(){d.dialogView.$el.remove()},3e3)},getHistroyIndicator:function(){var b=this,c=b.$el.find(".indicator");a.app.request("Indicator:getPlanOperationData",{}).done(function(a){return!a||0==a||0>a?void c.hide():void c.show().html(a)})},onClose:function(){a.$("body").off("click.membership_drop"),a.$(".tipsy").remove(),this.dialogView&&this.dialogView.$el&&this.dialogView.$el.remove()}})}),define("views/common/membership/membership-tab-component",["talent","templates/common","views/common/membership/membership-tab-layout","views/common/membership/membership-tab-thumb-composite-view","views/common/membership/membership-tab-operate-view","$.tipsy"],function(a,b,c,d,e){return a.Layout.extend({defaults:{bottomView:"new bottomView()",showShare:!0,type:0},template:b["common/membership/membership-tab-component"],regions:{tabRegion:{selector:"#membership_tab"},operate:"#membership_bottom_container"},ui:{arrow:".membership_arrow_icon",arrowBtn:".membership_arrow",tab:".membership_tab_title",tabLi:".membership_tab_title li"},events:function(){var a={};return a["click "+this.ui.arrowBtn]="afterArrowClick",a["click "+this.ui.tabLi]="afterTabClick",a},modelEvents:{"change:mode":"afterViewModeChange","change:viewName":"afterViewNameChange"},initialize:function(b){var c=this;this.setting=a._.extend({},this.defaults,b);var d=a.app.request("history:getQueryObject");d.done(function(d){c.routerData=d;var f={mode:"narrow",viewName:"membership",showBottom:!1,showTab:!1,bottomView:new e};c.bottomView=b&&b.bottomView||new e;var g=a.$.extend({},f,b);"undefined"!=typeof c.routerData.viewName&&c.routerData.viewName&&(g.viewName=c.routerData.viewName),c.model=new a.Model(g),c.userInfo=a.Context.getUserInfo(),c.userInfo.MidAvatar=c.userInfo.Avatar.replace("_s","_m"),c.options.model&&c.listenTo(c.options.model,"change:viewName",function(){var a=c.options.model.get("viewName");c.model.set("viewName",a),c.$el.find(".membership_tab_title li").removeClass("active"),c.$el.find("li[data-name="+a+"]").addClass("active")})})},onRender:function(){var b=this;a.app.vent.off("membership:show:wide"),a.app.vent.on("membership:show:wide",function(){b.model.set("mode","wide")}),0==this.model.get("showTab")&&this.$el.find(".membership_tab_top").remove(),this.$el.find(".membership_tab_title li span").tipsy({gravity:"se"}),this.ui.arrowBtn.tipsy({title:function(){return"wide"==b.model.get("mode")?"收起隔级查看":"展开隔级查看"},gravity:"e"}),this.afterViewModeChange(!0)},getActiveId:function(){var b=this,c=new a.$.Deferred,d=a.app.request("history:getQueryObject");return d.done(function(d){b.activeId=d.to_user_id?d.to_user_id:a.Context.getUserInfo().Id,c.resolve(b.activeId)}),c.promise()},renderMembershipView:function(){"wide"==this.model.get("mode")?this.renderMembershipTabView():this.renderMembershipTabThumbView(),this.renderBottomOperateView()},renderBottomOperateView:function(){"membership"==this.model.get("viewName")&&1==this.model.get("showBottom")?(this.operate.show(this.bottomView),this.bottomView.changeMode&&this.bottomView.changeMode(this.model.get("mode"))):this.operate&&this.operate.close()},renderMembershipTabThumbView:function(){var b=this;this.getActiveId().done(function(c){var e=a.Context.getUserInfo().Id,f=a.app.request("Membership:getSubordinateData",{id:e,type:b.setting.type});f.done(function(e){var f=(e[0],e);f=1==f.length?[]:f,this.subordinate=f;var g=new d({collection:new a.Collection(f),model:new a.Model({activeId:c,viewName:"membership"})});g.on("change:mode",function(a){b.model.set("mode",a)}),b.tabRegion&&b.tabRegion.show(g),b.bindEvents(g)})})},renderMembershipTabView:function(){var b=this,d=a.Context.getUserInfo().Id;this.getActiveId().done(function(e){b.membershipTabLayout?(d==e&&b.membershipTabLayout.model.set({middleId:e,direction:"down",activeId:e,profileId:e,type:b.setting.type}),b.tabRegion.show(b.membershipTabLayout)):(b.membershipTabLayout=new c({model:new a.Model({middleId:e,direction:"down",activeId:e,profileId:e,type:b.setting.type})}),b.tabRegion.show(b.membershipTabLayout),b.bindEvents(b.membershipTabLayout))})},renderShareView:function(){var b=this;this.getActiveId().done(function(c){a.app.request("Plan:getShareWidthMeData",{}).done(function(a){var d=a;b.afterRenderShareView(c,d)})})},afterRenderShareView:function(b,c){var e=this.model.get("mode");c=c&&c.length?c:[];var f=new d({collection:new a.Collection(c),model:new a.Model({activeId:b,viewName:"share",mode:e})});this.tabRegion.show(f),this.bindEvents(f)},renderNarrowViewByData:function(){var b=this;this.$el.find(".membership_tab_title li span").tipsy("enable"),this.ui.arrow.removeClass("membership_arrow_right").addClass("membership_arrow_left"),this.$el.find(".membership_right").addClass("short"),this.$el.find(".membership_tab_title").fadeIn("fast"),this.getActiveId().done(function(c){a.app.request("Plan:getShareWidthMeData",{}).done(function(e){var f=e||[];a.app.request("Membership:getSubordinateData",{id:c}).done(function(e){b.renderBottomOperateView();var g=(e[0]&&e[0].subordinate,e),h="membership",i=g.length&&1!=g.length?g:[];(1==g.length||0==g.length)&&f.length&&(h="share",i=f);var j=new d({collection:new a.Collection(i),model:new a.Model({activeId:c,viewName:h})});b.tabRegion.show(j),b.bindEvents(j),b.model.set("viewName",h,{silent:!0}),"share"==h?(b.ui.tab.find(".active").removeClass("active"),b.ui.tab.find("li[data-name=share]").addClass("active")):(b.ui.tab.find(".active").removeClass("active"),b.ui.tab.find("li[data-name=membership]").addClass("active"))})})})},afterArrowClick:function(){var a="wide"==this.model.get("mode")?"narrow":"wide";this.model.set("mode",a)},afterViewModeChange:function(){this.tabRegion.close();{var a=this,b=this.model.get("mode");this.model.get("showTab")}"wide"==b?(this.$el.find(".membership_icon_st").tipsy("disable"),this.$el.find(".membership_icon_share").tipsy("disable"),this.ui.arrow.removeClass("membership_arrow_left").addClass("membership_arrow_right"),this.$el.find(".membership_right").removeClass("short"),this.$el.find(".membership_tab_title").removeClass("short").fadeIn("fast"),this.$el.find(".membership_right").animate({width:278},300,function(){a.afterViewNameChange()})):(this.$el.find(".membership_tab_title li span").tipsy("enable"),this.ui.arrow.removeClass("membership_arrow_right").addClass("membership_arrow_left"),this.$el.find(".membership_right").addClass("short"),this.$el.find(".membership_tab_title").fadeIn("fast"),this.$el.find(".membership_right").animate({width:65},300,function(){a.afterViewNameChange()}))},afterTabClick:function(b){a.$(".tipsy").remove();var c=a.$(b.currentTarget);if(!c.hasClass("active")){var d=c.attr("data-name");this.model.set("viewName",d),this.ui.tab.find(".active").removeClass("active"),c.addClass("active");var e=decodeURIComponent(location.hash);a.app.execute("history:navigate",e,!1)}},afterViewNameChange:function(){"membership"==this.model.get("viewName")?this.renderMembershipView():(this.renderShareView(),this.operate.close()),this.$el.find(".membership_tab_title li").removeClass("active"),this.$el.find("li[data-name="+this.model.get("viewName")+"]").addClass("active")},changeRoute:function(a){var b=this.model.get("viewName");return"share"==b?void this.changeShareRoute(a):void this.changeGroupRoute(a)},changeShareRoute:function(b){var c,d=decodeURIComponent(location.hash);c=d.indexOf("?")>0?d.split("?")[0]:d,d=c+"?to_user_id="+b+"&viewName=share",a.app.execute("history:navigate",d,!0)},changeGroupRoute:function(b){var c=decodeURIComponent(location.hash),d="to_user_id="+b;-1!=c.indexOf("to_user_id")?c=c.replace(/to_user_id=\w+/,d):c+=c.indexOf("?")<0?"?to_user_id="+b:"&to_user_id="+b,a.app.execute("history:navigate",c,!0)},routerDataChange:function(){this.ui.arrow.hasClass("membership_arrow_left")&&this.renderMembershipTabThumbView()},bindEvents:function(a){var b=this;a.off("detailIdChanged"),a.on("detailIdChanged",function(a){b.changeRoute(a)})},templateHelpers:function(){return{showShare:this.setting.showShare}},onClose:function(){a.app.vent.off("membership:show:wide")}})}),define("views/plan/plan-sidebar-top-view",["talent","templates/plan"],function(a,b){return a.ItemView.extend({template:b["plan/plan-sidebar-top"],modelEvents:{"change:user":"render"},onRender:function(){}})}),define("views/plan/table/index-page-view",["talent","templates/plan","tdialog","moment","views/plan/plan-notice/index-page-view","views/common/membership/membership-tab-operate-view"],function(a,b,c,d,e){return a.Layout.extend({template:b["plan/table/index-page"],initialize:function(b){this.queryObj=b.queryObj;this.planTableCollection=new a.Collection,this.superiorUser=[],this.ajaxTag=!1;a.Context.getGlobal("WebHead");this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1},templateHelpers:function(){{var b=a.Context.getGlobal("tenant_function");this.model.get("plan_table_name").length}return this.userInfo=a.Context.getUserInfo(),{printUrl:"/plan/"+this.userInfo.Id+"/Home/PrintPlanItems?toUserId="+this.model.get("to_user_id")+"&groupId="+this.model.get("group_id")+"&tagId="+this.model.get("tag_id")+"&plantableid="+this.model.get("plan_table_id"),i18n:this.i18n,IsUsePlanDaily:b.IsUsePlanDaily}},ui:{planTableListContainer:".tt_plan_table_list_container",planTableContainer:".tt_plan_table_container",emptyContainer:".emptyContainer",btnnoticesuperior:".btnnoticesuperior",btnPrint:".btnPrint",btnMore:".btnMore",btnMemberShip:"a[data-name=level-view]",moreDropDownBox:"ul[data-name=more-drop-down-box]",moreSendNotice:"li[data-type=notice]",moreApproval:'li[data-name="approval-group"]',btnEnterGroup:"a[data-name=enter-group]",btnUpSet:'a[data-name="up-set"]',btnChangeType:'a[data-name="enter-group"]'},events:function(){var a={};return a["click "+this.ui.btnnoticesuperior]="_onNoticeSuperior",a["click "+this.ui.btnMore]="_isHasSubordinate",a["click "+this.ui.btnMemberShip]="showMemberShip",a["click "+this.ui.moreSendNotice]="_renderNoticeDialogView",a["click "+this.ui.btnUpSet]="_renderUpSetApply",a["click "+this.ui.btnChangeType]="_triggerChangeType",a},onRender:function(){var b=this;this.ui.btnnoticesuperior.hide(),a.$(document).off("click.Plan-Table-Index-Page-View"),a.$(document).on("click.Plan-Table-Index-Page-View",function(){b.planNoticeSuperiorView="",b.noticeSuperiorDialogView&&b.noticeSuperiorDialogView.close(),b.ui.moreDropDownBox&&b.ui.moreDropDownBox.hide()});var c=a.app.request("UserSubordinate:getData",{lv:2});c.done(function(c){var d=a._.pluck(c,"ParentUser");return a._.include(d,null)?(b.$el.find(".btnnoticesuperior").hide(),b.$el.find('a[data-name="up-set"]').addClass("btn-disabled"),!0):(b.superiorUser=a._.filter(d,function(b){return b.Id!=a.Context.getUserInfo().Id}),void(b.superiorUser&&b.superiorUser.length&&b.$el.find(".btnnoticesuperior").show()))});var d=this.$el.find(".gantt_btn"),e=this.model.toJSON(),f=e.plan_table_name,g=(e.plan_table_name.length,{to_user_id:e.to_user_id,plan_table_id:this.options.groupPlanTable,type:e.type||"personal"}),h=e.startDate.split("年")[0],i=e.endDate.split("年")[0];g.year=h==i?h:i,f&&(g.week=f),1==e.tag_id?g.show_type="year":(g.show_type="day",g.month=h==i?e.startDate.split("年")[1].split("月")[0]:e.endDate.split("年")[1].split("月")[0]),g.startDate=e.startDate.split("年")[0]+"/"+e.startDate.split("年")[1].split("月")[0]+"/"+e.startDate.split("年")[1].split("月")[1].split("日")[0],g.endDate=e.endDate.split("年")[0]+"/"+e.endDate.split("年")[1].split("月")[0]+"/"+e.endDate.split("年")[1].split("月")[1].split("日")[0];var j=[];g.plan_table_id=b.model.get("plan_table_id"),g.plan_table_type=b.model.get("PlanTableType");for(var k in g)j.push(k+"="+g[k]);var l="#plan/g-chart?"+j.join("&");d.attr("href",l)},_triggerChangeType:function(){this.trigger("changeType")},_renderUpSetApply:function(b){var c=a.$(b.currentTarget);c.hasClass("btn-disabled")||this.trigger("setUp")},onClose:function(){this.noticeSuperiorDialogView&&this.noticeSuperiorDialogView.close(),a.$(document).off("click.Plan-Table-Index-Page-View")},showMemberShip:function(){a.app.vent.trigger("membership:show:wide")},_isHasSubordinate:function(b){var c,d=this;a.app.request("Membership:getSubordinateData",{}).done(function(e){e&&e.length?(c=!0,1==e.length&&(e[0].Id=a.Context.getUserInfo().Id,c=!1)):c=!1,d._showMorePop(b,c)})},_showMorePop:function(a,b){a.stopPropagation();var c=this.ui.moreDropDownBox;b?(this.ui.moreSendNotice.removeClass("disabled"),this.ui.moreApproval.removeClass("disabled"),this.$el.find('li[data-name="approval-group"] a').attr("href","#more/apply?name=plan&&delindicator=SuperApply")):(this.ui.moreSendNotice.addClass("disabled"),this.ui.moreApproval.addClass("disabled"),this.$el.find('li[data-name="approval-group"] a').attr("href","javascript:void(0)")),c.is(":hidden")?c.show():c.hide()},_renderNoticeDialogView:function(b){b.stopPropagation();var d=a.$(b.currentTarget);if(!d.hasClass("disabled")){var f=this;this.noticeViewStatus=!0,this.planNoticeIndexPageView=new e({isShowUserList:!0,isToSubordinate:!1,routerData:this.model.toJSON()});var g=this.planNoticeIndexPageView.render().el;this.noticeDialogView&&this.noticeDialogView.close(),this.noticeDialogView=new c({fixed:!1,type:"modal",sure:function(){f.noticeDialogView.close(),f.sendNotce()},cancel:function(){f.noticeDialogView.close()}}),this.ui.planTableContainer.append(this.noticeDialogView.render().$el),this.noticeDialogView.show(this.ui.btnMore,g,{arrow:!1,pos:"bottomRight",arrowBias:-2,container:this.ui.planTableContainer}),this.ui.moreDropDownBox.hide()}},sendNotce:function(){var b=this.model.toJSON(),c=this,d=this.planNoticeIndexPageView.getUserIds(),e={GroupId:b.group_id,TagId:b.tag_id,PlanTableId:b.plan_table_id,MessageType:12,UserIds:d},f=this.planNoticeIndexPageView.getMailCont(),g="";b.tag_id>1&&(g=b.tag_id-1+"月"),f&&(e.EmailContent=f),e.MessageContent="通知你写"+this.iPlan+"&nbsp;"+g+b.plan_table_name;a.app.request("PlanCommmon:postSendNotice",e).done(function(){c.planNoticeIndexPageView.close(),c.noticeDialogView.hide(),c.showMsgDialog("通知已发送",c.ui.btnMore)}).fail(function(){c.planNoticeIndexPageView.close(),c.noticeDialogView.hide(),c.showMsgDialog(msg,c.ui.btnMore)})},showMsgDialog:function(a,b){this.dialogView=new c({fixed:!0,type:"tipsy",pos:"bottomRight",sure:!1,cancel:!1,arrow:!1});var d=this;this.dialogView.render().$el.appendTo("body"),this.dialogView.show(b,a,{arrow:!1,pos:"bottomRight",className:"success"}),setTimeout(function(){d.dialogView.$el.remove()},3e3)},showButton:function(a){this.isShowButton=a,a&&1==a?(this.$el.find(".btnPrint").show(),this.superiorUser&&this.superiorUser.length>0&&this.$el.find(".btnnoticesuperior").show()):(this.$el.find(".btnPrint").show(),this.$el.find(".btnnoticesuperior").hide())},_onNoticeSuperior:function(b){b.stopPropagation();var d=this;this.planNoticeSuperiorView||(this.planNoticeSuperiorView=new e({isShowUserList:!0,isToSubordinate:!1,isToSuperior:!0,superiorUser:this.superiorUser,routerData:this.model.toJSON()}),this.noticeSuperiorDialogView=new c({fixed:!1,type:"modal",sure:function(){d.sendNotceSuperior()},cancel:!0}),this.noticeSuperiorDialogView.render().$el.appendTo(this.$el));var f=this.planNoticeSuperiorView.render().el;this.noticeSuperiorDialogView.show(a.$(b.target),f,{arrow:1,pos:"bottom",height:492,topBias:-25,leftBias:10,arrowBias:0})},sendNotceSuperior:function(){var b=this.model.toJSON(),c=this,d=this.planNoticeSuperiorView.getUserIds(),e={GroupId:b.group_id,TagId:b.tag_id,PlanTableId:b.plan_table_id,MessageType:11,UserIds:d},f=this.planNoticeSuperiorView.getMailCont(),g=this.planNoticeSuperiorView.getMailSender(),h="";b.tag_id>1&&(h=b.tag_id-1+"月"),f&&(e.EmailContent=f),e.MessageContent=g+"提醒你查看ta的"+h+b.plan_table_name+this.iPlan,this.noticeSuperiorDialogView.changeSubmitBtn(2);a.app.request("PlanCommmon:postSendNotice",e).done(function(){setTimeout(function(){c.noticeSuperiorDialogView.changeSubmitBtn(1),c.noticeSuperiorDialogView.$el.remove(),c.planNoticeIndexPageView&&c.planNoticeSuperiorView.close(),c.planNoticeSuperiorView=!1},500)}).fail(function(){})}})}),define("views/common/messages/message-applist-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({template:b["common/messages/message-approval-list"],tagName:"li",className:"li-check",initialize:function(){},modelEvents:{"change:Value":"render"},ui:{checkItem:'a[data-name="check-item"]'},events:function(){var a={};return a["click "+this.ui.checkItem]="_clickCheckItem",a},_clickCheckItem:function(){this.trigger("click")}});return a.CompositeView.extend({defaults:{emptyContext:"暂无设置计划审批"},template:b["common/messages/message-approval-detail"],emptyTemplate:b["common/messages/message-empty-approval"],itemView:d,itemViewContainer:"ul",className:"pushpullscreen",initialize:function(b){this.model.set("selectScope",""),0==this.collection.length&&(this.template=this.emptyTemplate),this.settings=a._.extend({},this.defaults,b),this.$el.on("click",function(a){a.stopPropagation()})},modelEvents:{"change:selectScope":"render"},templateHelpers:function(){var b=this.model.get("ReportRules")||[],c=a._.findWhere(b,{ReportType:8}),d=a._.findWhere(b,{ReportType:26}),e=a._.findWhere(b,{ReportType:27});return{daily_date:c?c.SubmitDate:void 0,week_date:d?d.SubmitDate:void 0,month_date:e?e.SubmitDate:void 0}
},onShow:function(){0==this.collection.length&&this._renderEmptyView(),this.setPosition(),this._formateData()},ui:{close:".close_pdtb",title:".tt_plandetailtopbar",plandetailcontent:"._tt_plandetailcontent",emptyShow:'div[data-name="empty-show"]'},events:function(){var a={};return a["click "+this.ui.close]="onCloseHandler",a},_renderEmptyView:function(){var a=new c({emptyContext:this.settings.emptyContext});this.ui.emptyShow.html(a.render().$el)},_formateData:function(){{var b=this.model.get("LableSet"),c=[];a._.each(b,function(a){c.push(a.LableFullName)})}this.model.set("setLables",c);var d=c.join(",");this.model.set("selectScope",d);var e=this.model.get("planApplySets"),f=_.filter(e,function(a){return a.Value?a:void 0});0==b.length&&0==f.length&&this._renderEmptyView()},onCloseHandler:function(){this.trigger("messageApplist:close")},setPosition:function(){var a=Talent.$(window).height(),b=this.$el.offset().top,c=this.ui.title.height();this.ui.plandetailcontent.css({height:a-b-c,overflowY:"auto"})}})}),"undefined"==typeof window.dhx4&&(window.dhx4={version:"4.1.3",skin:null,skinDetect:function(a){return{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace"}[this.readFromCss(a+"_skin_detect")]||null},readFromCss:function(a,b){var c=document.createElement("DIV");c.className=a,null!=document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c);var d=c[b||"offsetWidth"];return c.parentNode.removeChild(c),c=null,d},lastId:1,newId:function(){return this.lastId++},zim:{data:{},step:5,first:function(){return 100},last:function(){var a=this.first();for(var b in this.data)a=Math.max(a,this.data[b]);return a},reserve:function(a){return this.data[a]=this.last()+this.step,this.data[a]},clear:function(a){null!=this.data[a]&&(this.data[a]=null,delete this.data[a])}},s2b:function(a){return"string"==typeof a&&(a=a.toLowerCase()),1==a||1==a||"true"==a||"1"==a||"yes"==a||"y"==a},s2j:function(s){var obj=null;dhx4.temp=null;try{eval("dhx4.temp="+s)}catch(e){dhx4.temp=null}return obj=dhx4.temp,dhx4.temp=null,obj},absLeft:function(a){return"string"==typeof a&&(a=document.getElementById(a)),this.getOffset(a).left},absTop:function(a){return"string"==typeof a&&(a=document.getElementById(a)),this.getOffset(a).top},_aOfs:function(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}},_aOfsRect:function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},getOffset:function(a){return a.getBoundingClientRect?this._aOfsRect(a):this._aOfs(a)},_isObj:function(a){return null!=a&&"object"==typeof a&&"undefined"==typeof a.length},_copyObj:function(a){if(this._isObj(a)){var b={};for(var c in a)b[c]="object"==typeof a[c]&&null!=a[c]?this._copyObj(a[c]):a[c]}else for(var b=[],c=0;c<a.length;c++)b[c]="object"==typeof a[c]&&null!=a[c]?this._copyObj(a[c]):a[c];return b},screenDim:function(){var a=navigator.userAgent.indexOf("MSIE")>=0,b={};return b.left=document.body.scrollLeft,b.right=b.left+(window.innerWidth||document.body.clientWidth),b.top=Math.max((a?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop),b.bottom=b.top+(a?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight),b},selectTextRange:function(a,b,c){a="string"==typeof a?document.getElementById(a):a;var d=a.value.length;if(b=Math.max(Math.min(b,d),0),c=Math.min(c,d),a.setSelectionRange)try{a.setSelectionRange(b,c)}catch(e){}else if(a.createTextRange){var f=a.createTextRange();f.moveStart("character",b),f.moveEnd("character",c-d);try{f.select()}catch(e){}}},transData:null,transDetect:function(){if(null==this.transData){this.transData={transProp:!1,transEv:null};var a={MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"transitionend",transition:"transitionend"};for(var b in a)0==this.transData.transProp&&null!=document.documentElement.style[b]&&(this.transData.transProp=b,this.transData.transEv=a[b]);a=null}return this.transData},_xmlNodeValue:function(a){for(var b="",c=0;c<a.childNodes.length;c++)b+=null!=a.childNodes[c].nodeValue?a.childNodes[c].nodeValue.toString().replace(/^[\n\r\s]{0,}/,"").replace(/[\n\r\s]{0,}$/,""):"";return b}},window.dhx4.isIE=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isIE6=null==window.XMLHttpRequest&&navigator.userAgent.indexOf("MSIE")>=0,window.dhx4.isIE7=navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0,window.dhx4.isIE8=navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isOpera=navigator.userAgent.indexOf("Opera")>=0,window.dhx4.isChrome=navigator.userAgent.indexOf("Chrome")>=0,window.dhx4.isKHTML=navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0,window.dhx4.isFF=navigator.userAgent.indexOf("Firefox")>=0,window.dhx4.isIPad=navigator.userAgent.search(/iPad/gi)>=0),"undefined"==typeof window.dhx4.ajax&&(window.dhx4.ajax={cache:!1,method:"get",parse:function(a){if("string"!=typeof a)return a;if(a=a.replace(/^[\s]+/,""),window.DOMParser&&!dhx4.isIE)var b=(new window.DOMParser).parseFromString(a,"text/xml");else if(window.ActiveXObject!==window.undefined){var b=new window.ActiveXObject("Microsoft.XMLDOM");b.async="false",b.loadXML(a)}return b},xmltop:function(a,b,c){if("undefined"==typeof b.status||b.status<400){var d=b.responseXML?b.responseXML||b:dhx4.ajax.parse(b.responseText||b);if(d&&null!==d.documentElement&&!d.getElementsByTagName("parsererror").length)return d.getElementsByTagName(a)[0]}return-1!==c&&dhx4.callEvent("onLoadXMLError",["Incorrect XML",arguments[1],c]),document.createElement("DIV")},xpath:function(a,b){if(b.nodeName||(b=b.responseXML||b),dhx4.isIE)return b.selectNodes(a)||[];for(var c,d=[],e=(b.ownerDocument||b).evaluate(a,b,null,XPathResult.ANY_TYPE,null);c=e.iterateNext();)d.push(c);return d},query:function(a){dhx4.ajax._call(a.method||"GET",a.url,a.data||"",a.async||!0,a.callback,null,a.headers)},get:function(a,b){this._call("GET",a,null,!0,b)},getSync:function(a){return this._call("GET",a,null,!1)},put:function(a,b,c){this._call("PUT",a,b,!0,c)},del:function(a,b,c){this._call("DELETE",a,b,!0,c)},post:function(a,b,c){1==arguments.length?b="":2!=arguments.length||"function"!=typeof b&&"function"!=typeof window[b]?b=String(b):(c=b,b=""),this._call("POST",a,b,!0,c)},postSync:function(a,b){return b=null==b?"":String(b),this._call("POST",a,b,!1)},getLong:function(a,b){this._call("GET",a,null,!0,b,{url:a})},postLong:function(a,b,c){2==arguments.length&&(c=b,b=""),this._call("POST",a,b,!0,c,{url:a,postData:b})},_call:function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==d&&(h.onreadystatechange=function(){if(4==h.readyState||1==i&&3==h.readyState){if((200!=h.status||""==h.responseText)&&!dhx4.callEvent("onAjaxError",[h]))return;window.setTimeout(function(){"function"==typeof e&&e.apply(window,[{xmlDoc:h}]),null!=f&&("undefined"!=typeof f.postData?dhx4.ajax.postLong(f.url,f.postData,e):dhx4.ajax.getLong(f.url,e)),e=null,h=null},1)}}),"GET"==a&&1!=this.cache&&(b+=(b.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),h.open(a,b,d),g)for(var j in g)h.setRequestHeader(j,g[j]);else"POST"==a.toUpperCase()||"PUT"==a||"DELETE"==a?h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==a&&(c=null);return h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c),d?void 0:{xmlDoc:h}}}),"undefined"==typeof window.dhx4._eventable&&(window.dhx4._eventable=function(a,b){return"clear"==b?(a.detachAllEvents(),a.dhxevs=null,a.attachEvent=null,a.detachEvent=null,a.checkEvent=null,a.callEvent=null,a.detachAllEvents=null,void(a=null)):(a.dhxevs={data:{}},a.attachEvent=function(a,b){a=String(a).toLowerCase(),this.dhxevs.data[a]||(this.dhxevs.data[a]={});var c=window.dhx4.newId();return this.dhxevs.data[a][c]=b,c},a.detachEvent=function(a){for(var b in this.dhxevs.data){var c=0;for(var d in this.dhxevs.data[b])d==a?(this.dhxevs.data[b][d]=null,delete this.dhxevs.data[b][d]):c++;0==c&&(this.dhxevs.data[b]=null,delete this.dhxevs.data[b])}},a.checkEvent=function(a){return a=String(a).toLowerCase(),null!=this.dhxevs.data[a]},a.callEvent=function(a,b){if(a=String(a).toLowerCase(),null==this.dhxevs.data[a])return!0;var c=!0;for(var d in this.dhxevs.data[a])c=this.dhxevs.data[a][d].apply(this,b)&&c;return c},a.detachAllEvents=function(){for(var a in this.dhxevs.data){for(var b in this.dhxevs.data[a])this.dhxevs.data[a][b]=null,delete this.dhxevs.data[a][b];this.dhxevs.data[a]=null,delete this.dhxevs.data[a]}},void(a=null))},dhx4._eventable(dhx4)),"undefined"==typeof window.dhtmlx&&(window.dhtmlx={extend:function(a,b){for(var c in b)a[c]||(a[c]=b[c]);return a},extend_api:function(a,b,c){var d=window[a];d&&(window[a]=function(a){if(a&&"object"==typeof a&&!a.tagName){var c=d.apply(this,b._init?b._init(a):arguments);for(var e in dhtmlx)b[e]&&this[b[e]](dhtmlx[e]);for(var e in a)b[e]?this[b[e]](a[e]):0===e.indexOf("on")&&this.attachEvent(e,a[e])}else var c=d.apply(this,arguments);return b._patch&&b._patch(this),c||this},window[a].prototype=d.prototype,c&&dhtmlx.extend(window[a].prototype,c))},url:function(a){return-1!=a.indexOf("?")?"&":"?"}}),_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,(-1!=navigator.appVersion.indexOf("MSIE 8.0")||-1!=navigator.appVersion.indexOf("MSIE 9.0")||-1!=navigator.appVersion.indexOf("MSIE 10.0")||document.documentMode>7)&&"BackCompat"!=document.compatMode&&(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),"undefined"==typeof window.dhtmlxEvent,null==dhtmlxEvent.touchDelay&&(dhtmlxEvent.touchDelay=2e3),"undefined"==typeof dhtmlxEvent.initTouch&&(dhtmlxEvent.initTouch=function(){function a(){if(c){var a=document.createEvent("HTMLEvents");a.initEvent("dblclick",!0,!0),c.dispatchEvent(a),b=c=null}}var b,c,d,e;dhtmlxEvent(document.body,"touchstart",function(f){c=f.touches[0].target,d=f.touches[0].clientX,e=f.touches[0].clientY,b=window.setTimeout(a,dhtmlxEvent.touchDelay)}),dhtmlxEvent(document.body,"touchmove",function(a){b&&(Math.abs(a.touches[0].clientX-d)>50||Math.abs(a.touches[0].clientY-e)>50)&&(window.clearTimeout(b),b=c=!1)}),dhtmlxEvent(document.body,"touchend",function(){b&&(window.clearTimeout(b),b=c=!1)}),dhtmlxEvent.initTouch=function(){}}),window.dhtmlx||(window.dhtmlx={}),function(){function a(a,b){var d=a.callback;c(!1),a.box.parentNode.removeChild(a.box),m=a.box=null,d&&d(b)}function b(b){if(m){b=b||event;var c=b.which||event.keyCode;return dhtmlx.message.keyboard&&((13==c||32==c)&&a(m,!0),27==c&&a(m,!1)),b.preventDefault&&b.preventDefault(),!(b.cancelBubble=!0)}}function c(a){c.cover||(c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover));document.body.scrollHeight;c.cover.style.display=a?"inline-block":"none"}function d(a,b){var c="dhtmlx_"+a.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+c+"' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){n.area||(n.area=document.createElement("DIV"),n.area.className="dhtmlx_message_area",n.area.style[n.position]="5px",document.body.appendChild(n.area)),n.hide(a.id);var b=document.createElement("DIV");return b.innerHTML="<div>"+a.text+"</div>",b.className="dhtmlx-info dhtmlx-"+a.type,b.onclick=function(){n.hide(a.id),a=null},"bottom"==n.position&&n.area.firstChild?n.area.insertBefore(b,n.area.firstChild):n.area.appendChild(b),a.expire>0&&(n.timers[a.id]=window.setTimeout(function(){n.hide(a.id)},a.expire)),n.pull[a.id]=b,b=null,a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type,f.setAttribute("dhxbox",1);var g="";if(b.width&&(f.style.width=b.width),b.height&&(f.style.height=b.height),b.title&&(g+='<div class="dhtmlx_popup_title">'+b.title+"</div>"),g+='<div class="dhtmlx_popup_text"><span>'+(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">',c&&(g+=d(b.ok||"OK",!0)),e&&(g+=d(b.cancel||"Cancel",!1)),b.buttons)for(var h=0;h<b.buttons.length;h++)g+=d(b.buttons[h],h);if(g+="</div>",f.innerHTML=g,b.content){var i=b.content;"string"==typeof i&&(i=document.getElementById(i)),"none"==i.style.display&&(i.style.display=""),f.childNodes[b.title?1:0].appendChild(i)}return f.onclick=function(c){c=c||event;var d=c.target||c.srcElement;if(d.className||(d=d.parentNode),"dhtmlx_popup_button"==d.className.split(" ")[0]){var e=d.getAttribute("result");e="true"==e||("false"==e?!1:e),a(b,e)}},b.box=f,(c||e)&&(m=b),f}function g(a,d,e){var g=a.tagName?a:f(a,d,e);a.hidden||c(!0),document.body.appendChild(g);var h=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-g.offsetWidth)/2)),i=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-g.offsetHeight)/2));return g.style.top="top"==a.position?"-3px":i+"px",g.style.left=h+"px",g.onkeydown=b,g.focus(),a.hidden&&dhtmlx.modalbox.hide(g),g}function h(a){return g(a,!0,!1)}function i(a){return g(a,!0,!0)}function j(a){return g(a)}function k(a,b,c){return"object"!=typeof a&&("function"==typeof b&&(c=b,b=""),a={text:a,type:b,callback:c}),a}function l(a,b,c,d){return"object"!=typeof a&&(a={text:a,type:b,expire:c,id:d}),a.id=a.id||n.uid(),a.expire=a.expire||n.expire,a}var m=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",b,!0),dhtmlx.alert=function(){var a=k.apply(this,arguments);return a.type=a.type||"confirm",h(a)},dhtmlx.confirm=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",i(a)},dhtmlx.modalbox=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",j(a)},dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var n=dhtmlx.message=function(a){a=l.apply(this,arguments),a.type=a.type||"info";var b=a.type.split("-")[0];switch(b){case"alert":return h(a);case"confirm":return i(a);case"modalbox":return j(a);default:return e(a)}};n.seed=(new Date).valueOf(),n.uid=function(){return n.seed++},n.expire=4e3,n.keyboard=!0,n.position="top",n.pull={},n.timers={},n.hideAll=function(){for(var a in n.pull)n.hide(a)},n.hide=function(a){var b=n.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b),b=null},2e3),b.className+=" hidden",n.timers[a]&&window.clearTimeout(n.timers[a]),delete n.pull[a])}}(),dataProcessor.prototype={setTransactionMode:function(a,b){"object"==typeof a?(this._tMode=a.mode||this._tMode,this._headers=this._headers||a.headers,this._payload=this._payload||a.payload):(this._tMode=a,this._tSend=b),"REST"==this._tMode&&(this._tSend=!1,this._endnm=!0)},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=dhx4.s2b(a)},setDataColumns:function(a){this._columns="string"==typeof a?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=dhx4.s2b(a)},enablePartialDataSend:function(a){this._changed=dhx4.s2b(a)},setUpdateMode:function(a,b){this.autoUpdate="cell"==a,this.updateMode=a,this.dnd=b},ignore:function(a,b){this._silent_mode=!0,a.call(b||window),this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a);c=c||"updated";var e=this.obj.getUserData(a,this.action_param);e&&"updated"==c&&(c=e),b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,this.action_param,"")),b||this._clearUpdateFlag(a),this.markRow(a,b,c),b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);if(e&&(d=this.styles[e],b=!0),this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(var f=0;f<e.details.length;f++)e.details[f]&&this.obj[this._methods[1]](a,f,d)}},getState:function(a){return this.obj.getUserData(a,this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}}),this._invalid[a]=b},checkBeforeUpdate:function(){return!0},sendData:function(a){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof a||this._tSend?this.sendAllData():this._in_progress[a]?!1:(this.messages=[],!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",[a,this.messages])?!1:void this._beforeSendData(this._getRowData(a),a))):void 0},_beforeSendData:function(a,b){return this.callEvent("onBeforeUpdate",[b,this.getState(b),a])?void this._sendData(a,b):!1},serialize:function(a,b){if("string"==typeof a)return a;if("undefined"!=typeof b)return this.serialize_one(a,"");var c=[],d=[];for(var e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));return c.push("ids="+this.escape(d.join(","))),dhtmlx.security_key&&c.push("dhx_security="+dhtmlx.security_key),c.join("&")},serialize_one:function(a,b){if("string"==typeof a)return a;var c=[];for(var d in a)if(a.hasOwnProperty(d)){if(("id"==d||d==this.action_param)&&"REST"==this._tMode)continue;c.push(this.escape((b||"")+d)+"="+this.escape(a[d]))}return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());var c=this,d=function(d){var e=[];if(b)e.push(b);else if(a)for(var f in a)e.push(f);return c.afterUpdate(c,d,e)},e=this.serverProcessor+(this._user?dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)dhx4.ajax.get(e+(-1!=e.indexOf("?")?"&":"?")+this.serialize(a,b),d);else if("POST"==this._tMode)dhx4.ajax.post(e,this.serialize(a,b),d);else if("REST"==this._tMode){var f=this.getState(b),g=e.replace(/(\&|\?)editing\=true/,""),h="",i="post";if("inserted"==f?h=this.serialize(a,b):"deleted"==f?(i="DELETE",g=g+("/"==g.slice(-1)?"":"/")+b):(i="PUT",h=this.serialize(a,b),g=g+("/"==g.slice(-1)?"":"/")+b),this._payload)for(var j in this._payload)g=g+dhtmlx.url(g)+this.escape(j)+"="+this.escape(this._payload[j]);dhx4.ajax.query({url:g,method:i,headers:this._headers,data:h,callback:d})}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]){if(this.is_invalid(this.updatedRows[b]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(){for(var a={},b=!1,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];this._in_progress[d]||this.is_invalid(d)||this.callEvent("onBeforeUpdate",[d,this.getState(d),this._getRowData(d)])&&(a[d]=this._getRowData(d,d+this.post_delim),b=!0,this._in_progress[d]=(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return""!==a}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){var b=0;for(b=0;b<this.updatedRows.length&&a!=this.updatedRows[b];b++);return b},defineAction:function(a,b){this._uActions||(this._uActions=[]),this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f="error"!=c&&"invalid"!=c;if(f||this.set_invalid(a,c),this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];"wait"!=this._in_progress[e]&&this.setUpdated(a,!1);var g=a;switch(c){case"inserted":case"insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case"delete":case"deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}"wait"!=this._in_progress[e]?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,this.action_param))),this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c){if(window.JSON)try{var d=JSON.parse(b.xmlDoc.responseText),e=d.action||this.getState(c)||"updated",f=d.sid||c[0],g=d.tid||c[0];return a.afterUpdateCallback(f,g,e,d),void a.finalizeUpdate()}catch(h){}var i=dhx4.ajax.xmltop("data",b.xmlDoc);if(!i)return this.cleanUpdate(c);var j=dhx4.ajax.xpath("//data/action",i);if(!j.length)return this.cleanUpdate(c);for(var k=0;k<j.length;k++){var l=j[k],e=l.getAttribute("type"),f=l.getAttribute("sid"),g=l.getAttribute("tid");a.afterUpdateCallback(f,g,e,l)}a.finalizeUpdate()},cleanUpdate:function(a){if(a)for(var b=0;b<a.length;b++)delete this._in_progress[a[b]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2e3,this._user=b||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(a,b,c,d){this.afterAutoUpdate(a,b,c,d)}),this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b){return"collision"==b?(this._need_update=!0,!1):!0},fullSync:function(){return 1==this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(a,b){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=b,void this._loader.loadXML(a))},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),c=this.serverProcessor+dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&");c=c.replace("editing=true&",""),this.getUpdates(c,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));var c=a._loader.doXPath("//update");if(c.length){a._silent_mode=!0;for(var d=0;d<c.length;d++){var e=c[d].getAttribute("status"),f=c[d].getAttribute("id"),g=c[d].getAttribute("parent");switch(e){case"inserted":a.callEvent("insertCallback",[c[d],f,g]);break;case"updated":a.callEvent("updateCallback",[c[d],f,g]);break;case"deleted":a.callEvent("deleteCallback",[c[d],f,g])}}a._silent_mode=!1}a._update_busy=!1,a=null})}},window.Gantt={_seed:0},Gantt.plugin=function(a){this._ganttPlugin.push(a),a(window.gantt)},Gantt._ganttPlugin=[],Gantt.getGanttInstance=function(){function dhtmlxDetachEvent(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}function dhtmlxDnD(a,b){b&&(this._settings=b),dhtmlxEventable(this),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(c){b.original_target={target:c.target||c.srcElement},this.dragStart(a,c)},this))}var gantt={version:"3.3.0"};gantt={version:"3.3.0"},dhtmlxEventable=function(obj){obj._silent_mode=!1,obj._silentStart=function(){this._silent_mode=!0},obj._silentEnd=function(){this._silent_mode=!1},obj.attachEvent=function(a,b,c){return a="ev_"+a.toLowerCase(),this[a]||(this[a]=new this._eventCatcher(c||this)),a+":"+this[a].addEvent(b)},obj.callEvent=function(a,b){return this._silent_mode?!0:(a="ev_"+a.toLowerCase(),this[a]?this[a].apply(this,b):!0)},obj.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]},obj._eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var a=!0,b=0;b<dhx_catch.length;b++)if(dhx_catch[b]){var c=dhx_catch[b].apply(obj,arguments);a=a&&c}return a};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(a){dhx_catch[a]=null},z},obj.detachEvent=function(a){if(a){var b=a.split(":");this[b[0]].removeEvent(b[1])}},obj.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&delete this[a]},obj=null},dhtmlx.copy=function(a){var b,c,d;if(a&&"object"==typeof a){for(d={},c=[Array,Date,Number,String,Boolean],b=0;b<c.length;b++)a instanceof c[b]&&(d=b?new c[b](a):new c[b]);for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&(d[b]=dhtmlx.copy(a[b]))}return d||a},dhtmlx.mixin=function(a,b,c){for(var d in b)(!a[d]||c)&&(a[d]=b[d]);return a},dhtmlx.defined=function(a){return"undefined"!=typeof a},dhtmlx.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++,this._seed},dhtmlx.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},gantt._get_position=function(a){var b=0,c=0;if(a.getBoundingClientRect){var d=a.getBoundingClientRect(),e=document.body,f=document.documentElement,g=window.pageYOffset||f.scrollTop||e.scrollTop,h=window.pageXOffset||f.scrollLeft||e.scrollLeft,i=f.clientTop||e.clientTop||0,j=f.clientLeft||e.clientLeft||0;return b=d.top+g-i,c=d.left+h-j,{y:Math.round(b),x:Math.round(c),width:a.offsetWidth,height:a.offsetHeight}}for(;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{y:b,x:c,width:a.offsetWidth,height:a.offsetHeight}},gantt._detectScrollSize=function(){var a=document.createElement("div");a.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;",document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),b},window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b,c){var d=document.createElement("DIV");d.id="gantt_"+dhtmlx.uid(),d.style.width="100%",d.style.height="100%",d.cmp="grid",c=c||window.gantt,document.body.appendChild(d),this.attachObject(d.id);var e=this.vs[this.av];e.grid=c,c.init(d.id,a,b),d.firstChild.style.border="none",e.gridId=d.id,e.gridObj=d;var f="_viewRestore";return this.vs[this[f]()].grid}),"undefined"!=typeof window.dhtmlXCellObject&&(dhtmlXCellObject.prototype.attachGantt=function(a,b,c){var d=document.createElement("DIV");d.id="gantt_"+dhtmlx.uid(),d.style.width="100%",d.style.height="100%",d.cmp="grid",document.body.appendChild(d),this.attachObject(d.id),c=c||window.gantt,c.init(d.id,a,b),d.firstChild.style.border="none";return d=null,this.callEvent("_onContentAttach",[]),this.dataObj}),dhtmlxEventable(gantt),dhx4.ajax.cache=!0,gantt._click={},gantt._dbl_click={},gantt._context_menu={},gantt._on_click=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a),d=!0;if(null!==c?d=!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[c,a]):gantt.callEvent("onEmptyClick",[a]),d){var e=gantt._find_ev_handler(a,b,gantt._click,c);if(!e)return;c&&gantt.getTask(c)&&gantt.config.select_task&&gantt.selectTask(c)}},gantt._on_contextmenu=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(b),d=gantt.locate(b,gantt.config.link_attribute),e=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[c,d,a]);return e||(a.preventDefault?a.preventDefault():a.returnValue=!1),e},gantt._find_ev_handler=function(a,b,c,d){for(var e=!0;b;){var f=gantt._getClassName(b);if(f){f=f.split(" ");for(var g=0;g<f.length;g++)if(f[g]&&c[f[g]]){var h=c[f[g]].call(gantt,a,d,b);e=e&&!("undefined"!=typeof h&&h!==!0)}}b=b.parentNode}return e},gantt._on_dblclick=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a),d=!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[c,a]);if(d){var e=gantt._find_ev_handler(a,b,gantt._dbl_click,c);if(!e)return;null!==c&&gantt.getTask(c)&&d&&gantt.config.details_on_dblclick&&gantt.showLightbox(c)}},gantt._on_mousemove=function(a){if(gantt.checkEvent("onMouseMove")){var b=gantt.locate(a);gantt._last_move_event=a,gantt.callEvent("onMouseMove",[b,a])}},dhtmlxDnD.prototype={dragStart:function(a,b){this.config={obj:a,marker:null,started:!1,pos:this.getPosition(b),sensitivity:4},this._settings&&dhtmlx.mixin(this.config,this._settings,!0);var c=dhtmlx.bind(function(b){return this.dragMove(a,b)},this),d=(dhtmlx.bind(function(b){return this.dragScroll(a,b)},this),dhtmlx.bind(function(a){return dhtmlx.defined(this.config.updates_per_second)&&!gantt._checkTimeout(this,this.config.updates_per_second)?!0:c(a)},this)),e=dhtmlx.bind(function(){return dhtmlxDetachEvent(document.body,"mousemove",d),dhtmlxDetachEvent(document.body,"mouseup",e),this.dragEnd(a)},this);dhtmlxEvent(document.body,"mousemove",d),dhtmlxEvent(document.body,"mouseup",e),document.body.className+=" gantt_noselect"},dragMove:function(a,b){if(!this.config.marker&&!this.config.started){var c=this.getPosition(b),d=c.x-this.config.pos.x,e=c.y-this.config.pos.y,f=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2));if(f>this.config.sensitivity){if(this.config.started=!0,this.config.ignore=!1,this.callEvent("onBeforeDragStart",[a,this.config.original_target])===!1)return this.config.ignore=!0,!0;var g=this.config.marker=document.createElement("div");g.className="gantt_drag_marker",g.innerHTML="Dragging object",document.body.appendChild(g),this.callEvent("onAfterDragStart",[a,this.config.original_target])}else this.config.ignore=!0}this.config.ignore||(b.pos=this.getPosition(b),this.config.marker.style.left=b.pos.x+"px",this.config.marker.style.top=b.pos.y+"px",this.callEvent("onDragMove",[a,b]))},dragEnd:function(){this.config.marker&&(this.config.marker.parentNode.removeChild(this.config.marker),this.config.marker=null,this.callEvent("onDragEnd",[])),document.body.className=document.body.className.replace(" gantt_noselect","")},getPosition:function(a){var b=0,c=0;return a=a||window.event,a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}}},gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(a,b){return this.close(b),!1},this),this._click.gantt_open=dhtmlx.bind(function(a,b){return this.open(b),!1},this),this._click.gantt_row=dhtmlx.bind(function(a,b,c){if(null!==b){var d=this.getTask(b);
this.config.scroll_on_click&&this.showDate(d.start_date),this.callEvent("onTaskRowClick",[b,c])}},this),this._click.gantt_grid_head_cell=dhtmlx.bind(function(a,b,c){var d=c.getAttribute("column_id");if(this.callEvent("onGridHeaderClick",[d,a])){if("add"==d)return void this._click.gantt_add(a,this.config.root_id);if(this.config.sort){for(var e,f=d,g=0;this.config.columns.length;g++)if(this.config.columns[g].name==d){e=this.config.columns[g];break}if(e&&void 0!==e.sort&&e.sort!==!0&&(f=e.sort,!f))return;var h=this._sort&&this._sort.direction&&this._sort.name==d?this._sort.direction:"desc";h="desc"==h?"asc":"desc",this._sort={name:d,direction:h},this.sort(f,"desc"==h)}}},this),!this.config.sort&&this.config.order_branch&&this._init_dnd(),this._click.gantt_add=dhtmlx.bind(function(a,b){if(!this.config.readonly){var c={};return this.createTask(c,b?b:this.config.root_id),!1}},this),this._init_resize&&this._init_resize()},gantt._render_grid=function(){this._is_grid_visible()&&(this._calc_grid_width(),this._render_grid_header())},gantt._calc_grid_width=function(){for(var a=this.getGridColumns(),b=0,c=[],d=[],e=0;e<a.length;e++){var f=parseInt(a[e].width,10);window.isNaN(f)&&(f=50,c.push(e)),d[e]=f,b+=f}if(this.config.autofit||c.length){{var g=this._get_grid_width()-b;g/(c.length>0?c.length:d.length>0?d.length:1)}if(c.length>0)for(var h=g/(c.length?c.length:1),e=0;e<c.length;e++){var i=c[e];d[i]+=h}else for(var h=g/(d.length?d.length:1),e=0;e<d.length;e++)d[e]+=h;for(var e=0;e<d.length;e++)a[e].width=d[e]}else this.config.grid_width=b},gantt._render_grid_header=function(){for(var a=this.getGridColumns(),b=[],c=0,d=this.locale.labels,e=this.config.scale_height-2,f=0;f<a.length;f++){var g=f==a.length-1,h=a[f];g&&this._get_grid_width()>c+h.width&&(h.width=this._get_grid_width()-c),c+=h.width;var i=this._sort&&h.name==this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"",j=["gantt_grid_head_cell","gantt_grid_head_"+h.name,g?"gantt_last_cell":"",this.templates.grid_header_class(h.name,h)].join(" "),k="width:"+(h.width-(g?1:0))+"px;",l=h.label||d["column_"+h.name];l=l||"";var m="<div class='"+j+"' style='"+k+"' column_id='"+h.name+"'>"+l+i+"</div>";b.push(m)}this.$grid_scale.style.height=this.config.scale_height-1+"px",this.$grid_scale.style.lineHeight=e+"px",this.$grid_scale.style.width=c-1+"px",this.$grid_scale.innerHTML=b.join("")},gantt._render_grid_item=function(a){if(!gantt._is_grid_visible())return null;for(var b=this.getGridColumns(),c=[],d=0;d<b.length;d++){var e,f,g=d==b.length-1,h=b[d];"add"==h.name?f="<div class='gantt_add'></div>":(f=h.template?h.template(a):a[h.name],f instanceof Date&&(f=this.templates.date_grid(f,a)),f="<div class='gantt_tree_content'>"+f+"</div>");var i="gantt_cell"+(g?" gantt_last_cell":""),j="";if(h.tree){for(var k=0;k<a.$level;k++)j+=this.templates.grid_indent(a);var l=this._has_children(a.id);l?(j+=this.templates.grid_open(a),j+=this.templates.grid_folder(a)):(j+=this.templates.grid_blank(a),j+=this.templates.grid_file(a))}var m="width:"+(h.width-(g?1:0))+"px;";dhtmlx.defined(h.align)&&(m+="text-align:"+h.align+";"),e="<div class='"+i+"' style='"+m+"'>"+j+f+"</div>",c.push(e)}var i=a.$index%2===0?"":" odd";if(i+=a.$transparent?" gantt_transparent":"",i+=a.$dataprocessor_class?" "+a.$dataprocessor_class:"",this.templates.grid_row_class){var n=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);n&&(i+=" "+n)}this.getState().selected_task==a.id&&(i+=" gantt_selected");var o=document.createElement("div");return o.className="gantt_row"+i,o.style.height=this.config.row_height+"px",o.style.lineHeight=gantt.config.row_height+"px",o.setAttribute(this.config.task_attribute,a.id),o.innerHTML=c.join(""),o},gantt.open=function(a){gantt._set_item_state(a,!0),this.callEvent("onTaskOpened",[a])},gantt.close=function(a){gantt._set_item_state(a,!1),this.callEvent("onTaskClosed",[a])},gantt._set_item_state=function(a,b){a&&this._pull[a]&&(this._pull[a].$open=b,gantt._refresh_on_toggle_element(a))},gantt._refresh_on_toggle_element=function(){this.refreshData()},gantt._is_grid_visible=function(){return this.config.grid_width&&this.config.show_grid},gantt._get_grid_width=function(){return this._is_grid_visible()?this._is_chart_visible()?this.config.grid_width:this._x:0},gantt.moveTask=function(a,b,c){var d=arguments[3];if(d){if(d===a)return;c=this.getParent(d),b=this.getTaskIndex(d)}if(a!=c){c=c||this.config.root_id;var e=this.getTask(a),f=this.getParent(e.id),g=(this.getChildren(this.getParent(e.id)),this.getChildren(c));if(-1==b&&(b=g.length+1),f==c){var h=this.getTaskIndex(a);if(h==b)return}if(this.callEvent("onBeforeTaskMove",[a,c,b])!==!1){this._replace_branch_child(f,a),g=this.getChildren(c);var i=g[b];i?g=g.slice(0,b).concat([a]).concat(g.slice(b)):g.push(a),this.setParent(e,c),this._branches[c]=g,e.$level=this.calculateTaskLevel(e),e.$drop_target=1*b>0?d?(this.getTaskIndex(a)>this.getTaskIndex(d)?"next:":"")+d:"next:"+gantt.getPrevSibling(a):g[1*b+1]?g[1*b+1]:c,this.callEvent("onAfterTaskMove",[a,c,b])&&this.refreshData()}}},gantt._init_dnd=function(){var a=new dhtmlxDnD(this.$grid_data,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);if(!d)return!1;this.hideQuickInfo&&this._hideQuickInfo();var e=this.locate(c),f=gantt.getTask(e);return gantt._is_readonly(f)?!1:(a.config.initial_open_state=f.$open,this.callEvent("onRowDragStart",[e,c.target||c.srcElement,c])?void 0:!1)},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);a.config.marker.innerHTML=d.outerHTML,a.config.id=this.locate(c);var e=this.getTask(a.config.id);a.config.index=this.getTaskIndex(a.config.id),a.config.parent=e.parent,e.$open=!1,e.$transparent=!0,this.refreshData()},this)),a.lastTaskOfLevel=function(a){for(var b=gantt._order,c=gantt._pull,d=null,e=0,f=b.length;f>e;e++)c[b[e]].$level==a&&(d=c[b[e]]);return d?d.id:null},a._getGridPos=dhtmlx.bind(function(a){var b=this._get_position(this.$grid_data),c=b.x,d=a.pos.y-10;return d<b.y&&(d=b.y),d>b.y+this.$grid_data.offsetHeight-this.config.row_height&&(d=b.y+this.$grid_data.offsetHeight-this.config.row_height),b.x=c,b.y=d,b},this),a.attachEvent("onDragMove",dhtmlx.bind(function(b,c){function d(a,b){return a.$level==b.$level||gantt.config.order_branch_free}var e=a.config,f=a._getGridPos(c);e.marker.style.left=f.x+10+"px",e.marker.style.top=f.y+"px",f=a._getGridPos(c);var g=(f.x,f.y),h=document.elementFromPoint(f.x-document.body.scrollLeft+1,g-document.body.scrollTop),i=this.locate(h),j=this.getTask(a.config.id);if(this.isTaskExists(i)||(i=a.lastTaskOfLevel(gantt.config.order_branch_free?j.$level:0),i==a.config.id&&(i=null)),this.isTaskExists(i)){var k=gantt._get_position(h),l=this.getTask(i);if(k.y+h.offsetHeight/2<g){var m=this.getGlobalTaskIndex(l.id),n=this._pull[this._order[m+1]];if(n){if(n.id==j.id)return;l=n}else if(n=this._pull[this._order[m]],d(n,j)&&n.id!=j.id)return void this.moveTask(j.id,-1,this.getParent(n.id))}for(var m=this.getGlobalTaskIndex(l.id),o=this._pull[this._order[m-1]],p=1;(!o||o.id==l.id)&&m-p>=0;)o=this._pull[this._order[m-p]],p++;if(j.id==l.id)return;d(l,j)&&j.id!=l.id?this.moveTask(j.id,0,0,l.id):l.$level!=j.$level-1||gantt.getChildren(l.id).length?o&&d(o,j)&&j.id!=o.id&&this.moveTask(j.id,-1,this.getParent(o.id)):this.moveTask(j.id,0,l.id)}return!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(){var b=this.getTask(a.config.id);this.callEvent("onBeforeRowDragEnd",[a.config.id,a.config.parent,a.config.index])===!1?(this.moveTask(a.config.id,a.config.index,a.config.parent),b.$drop_target=null):this.callEvent("onRowDragEnd",[a.config.id,b.$drop_target]),b.$transparent=!1,b.$open=a.config.initial_open_state,this.refreshData()},this))},gantt.getGridColumns=function(){return this.config.columns},gantt._has_children=function(a){return this.getChildren(a).length>0},gantt._render_grid_header_resize=function(){for(var a=this.getGridColumns(),b=0,c=this.config.scale_height,d=(this._get_position(this.$grid_scale),0);d<a.length;d++){var e=(d==a.length-1,a[d]);if(b+=e.width,e.resize){var f=document.createElement("div");f.className="gantt_grid_column_resize_wrap",f.style.top="0px",f.style.height=c+"px",f.innerHTML="<div class='gantt_grid_column_resize'></div>",f.setAttribute(this.config.grid_resizer_column_attribute,d),this.$grid_scale.appendChild(f),f.style.left=Math.max(0,b-1-f.offsetWidth/2)+"px"}}if(this.config.grid_resize){var g=document.createElement("div");g.className="gantt_grid_resize_wrap",g.style.top="0px",g.style.height=this.$grid.offsetHeight+"px",g.innerHTML="<div class='gantt_grid_resize'></div>",g.setAttribute(this.config.grid_resizer_attribute,!0),this.$grid_scale.appendChild(g),g.style.left=Math.max(0,this.config.grid_width-1-g.offsetWidth/2)+"px"}},gantt._init_resize=function(){var a=new dhtmlxDnD(this.$grid_scale,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){var c=this._locateHTML(b,this.config.grid_resizer_column_attribute);if(!c)return!1;var d=this.locate(b,this.config.grid_resizer_column_attribute),e=this.getGridColumns()[d];return gantt.callEvent("onColumnResizeStart",[d,e])===!1?!1:void 0},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this.locate(c,this.config.grid_resizer_column_attribute);a.config.marker.innerHTML="",a.config.marker.className+=" gantt_grid_resize_area",a.config.marker.style.height=this.$grid.offsetHeight+"px",a.config.marker.style.top="0px",a.config.drag_index=d},this)),a.attachEvent("onDragMove",dhtmlx.bind(function(){var b=a.config,c=this.getGridColumns(),d=this._get_position(this.$grid_scale),e=parseInt(b.marker.style.left,10),f=this.config.min_grid_column_width,g=this.$grid_data.offsetWidth-this.config.min_grid_column_width*(c.length-b.drag_index-2),h=0,i=0;e-=d.x-1;for(var j=0;j<b.drag_index;j++)f+=c[j].width,h+=c[j].width;return f>e&&(e=f),this.config.keep_grid_width&&e>g&&(e=g),i=e-h,b.marker.style.top=d.y+"px",b.marker.style.left=d.x-1+h+"px",b.marker.style.width=i+"px",b.left=e-1,gantt.callEvent("onColumnResize",[b.drag_index,c[b.drag_index],i-1]),!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(){for(var b=this.getGridColumns(),c=0,d=parseInt(a.config.drag_index,10),e=b[d],f=0;d>f;f++)c+=b[f].width;var g=e.min_width&&a.config.left-c<e.min_width?e.min_width:a.config.left-c;if(gantt.callEvent("onColumnResizeEnd",[d,e,g])!==!1&&e.width!=g){if(e.width=g,this.config.keep_grid_width)for(var f=d+1,h=b.length;h>f;f++)b[f].width="add"==b[f].name?1*b[f].width||44:null;else{for(var f=d,h=b.length;h>f;f++)c+=b[f].width;this.config.grid_width=c}this.render()}},this));var b=new dhtmlxDnD(this.$grid,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(b.config.sensitivity=this.config.dnd_sensitivity),b.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){var c=this._locateHTML(b,this.config.grid_resizer_attribute);return c?gantt.callEvent("onGridResizeStart",[gantt.config.grid_width])===!1?!1:void 0:!1},this)),b.attachEvent("onAfterDragStart",dhtmlx.bind(function(){b.config.marker.innerHTML="",b.config.marker.className+=" gantt_grid_resize_area",b.config.marker.style.height=this.$grid.offsetHeight+"px",b.config.marker.style.top="0px"},this)),b.attachEvent("onDragMove",dhtmlx.bind(function(){for(var a=b.config,c=this.config.columns,d=this._get_position(this.$grid),e=parseInt(a.marker.style.left,10),f=0,g=0;g<c.length;g++)c[g].hide||(f+=c[g].min_width?c[g].min_width:this.config.min_grid_column_width);return e-=d.x-1,f>e&&(e=f),a.marker.style.top=d.y+"px",a.marker.style.left=d.x-1+"px",a.marker.style.width=e+"px",a.left=e-1,gantt.callEvent("onGridResize",[this.config.grid_width,e-1]),!0},this)),b.attachEvent("onDragEnd",dhtmlx.bind(function(){for(var a=this.config.columns,c=0,d=b.config.left,e=0,f=a.length;f>e;e++)a[e].hide||(c+=a[e].width);for(var g=a.length,h=d-c,e=0;g>e;e++)if(!a[e].hide){var i=Math.floor(h*(a[e].width/c));c-=a[e].width;var j=a[e].width+i;(a[e].min_width&&j>=a[e].min_width||!a[e].min_width||j>a[e].width)&&(h-=i,a[e].width=j)}for(var k=h>0?1:-1;h>0&&1===k||0>h&&-1===k;){var l=h;for(e=0;g>e;e++){var m=a[e].width+k;if((a[e].min_width&&m>=a[e].min_width||!a[e].min_width||j>a[e].width)&&(h-=k,a[e].width=m,0==h))break}if(l==h)break}gantt.callEvent("onGridResizeEnd",[this.config.grid_width,d])!==!1&&(this.config.grid_width=d,this.render())},this))},gantt.attachEvent("onGanttRender",function(){gantt._render_grid_header_resize()}),function(){var a=gantt._has_children;gantt._has_children=function(b){return a.apply(this,arguments)?!0:this.isTaskExists(b)?this.getTask(b).$has_child:!1}}(),gantt._need_dynamic_loading=function(a){if(gantt.config.branch_loading&&gantt._load_url){var b=gantt.getUserData(a,"was_rendered");if(!b&&gantt._has_children(a))return!0}return!1},gantt._refresh_on_toggle_element=function(a){gantt._need_dynamic_loading(a)||this.refreshData()},gantt.attachEvent("onTaskOpened",function(a){if(gantt.config.branch_loading&&gantt._load_url&&gantt._need_dynamic_loading(a)){var b=gantt._load_url;b=b.replace(/(\?|&)?parent_id=.+&?/,"");var c=b.indexOf("?")>=0?"&":"?",d=0;this._cached_scroll_pos&&this._cached_scroll_pos.y&&(d=Math.max(this._cached_scroll_pos.y,0)),gantt.load(b+c+"parent_id="+encodeURIComponent(a),this._load_type,function(){d&&gantt.scrollTo(null,d)}),gantt.setUserData(a,"was_rendered",!0)}}),gantt.getGridColumns=function(){for(var a=gantt.config.columns,b=[],c=0;c<a.length;c++)a[c].hide||b.push(a[c]);return b},gantt.getGridColumn=function(a){for(var b=gantt.config.columns,c=0;c<b.length;c++)if(b[c].name==a)return b[c];return null},gantt._scale_helpers={getSum:function(a,b,c){void 0===c&&(c=a.length-1),void 0===b&&(b=0);for(var d=0,e=b;c>=e;e++)d+=a[e];return d},setSumWidth:function(a,b,c,d){var e=b.width;void 0===d&&(d=e.length-1),void 0===c&&(c=0);var f=d-c+1;if(!(c>e.length-1||0>=f||d>e.length-1)){var g=this.getSum(e,c,d),h=a-g;this.adjustSize(h,e,c,d),this.adjustSize(-h,e,d+1),b.full_width=this.getSum(e)}},splitSize:function(a,b){for(var c=[],d=0;b>d;d++)c[d]=0;return this.adjustSize(a,c),c},adjustSize:function(a,b,c,d){c||(c=0),void 0===d&&(d=b.length-1);for(var e=d-c+1,f=this.getSum(b,c,d),g=0,h=c;d>=h;h++){var i=Math.floor(a*(f?b[h]/f:1/e));f-=b[h],a-=i,e--,b[h]+=i,g+=i}b[b.length-1]+=a},sortScales:function(a){function b(a,b){var c=new Date(1970,0,1);return gantt.date.add(c,b,a)-c}a.sort(function(a,c){return b(a.unit,a.step)<b(c.unit,c.step)?1:b(a.unit,a.step)>b(c.unit,c.step)?-1:0})},primaryScale:function(){return gantt._init_template("date_scale"),{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,css:gantt.templates.scale_cell_class}},prepareConfigs:function(a,b,c,d){for(var e=this.splitSize(d,a.length),f=c,g=[],h=a.length-1;h>=0;h--){var i=h==a.length-1,j=this.initScaleConfig(a[h]);i&&this.processIgnores(j),this.initColSizes(j,b,f,e[h]),this.limitVisibleRange(j),i&&(f=j.full_width),g.unshift(j)}for(var h=0;h<g.length-1;h++)this.alineScaleColumns(g[g.length-1],g[h]);for(var h=0;h<g.length;h++)this.setPosSettings(g[h]);return g},setPosSettings:function(a){for(var b=0,c=a.trace_x.length;c>b;b++)a.left.push((a.width[b-1]||0)+(a.left[b-1]||0))},_ignore_time_config:function(a){return this.config.skip_off_time?!this.isWorkTime(a):!1},processIgnores:function(a){a.ignore_x={},a.display_count=a.count},initColSizes:function(a,b,c,d){var e=c;a.height=d;var f=void 0===a.display_count?a.count:a.display_count;f||(f=1),a.col_width=Math.floor(e/f),b&&a.col_width<b&&(a.col_width=b,e=a.col_width*f),a.width=[];for(var g=a.ignore_x||{},h=0;h<a.trace_x.length;h++)a.width[h]=g[a.trace_x[h].valueOf()]||a.display_count==a.count?0:1;this.adjustSize(e-this.getSum(a.width),a.width),a.full_width=this.getSum(a.width)},initScaleConfig:function(a){var b=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:0,width:[],left:[],trace_x:[]},a);return this.eachColumn(a.unit,a.step,function(a){b.count++,b.trace_x.push(new Date(a))}),b},iterateScales:function(a,b,c,d,e){for(var f=b.trace_x,g=a.trace_x,h=c||0,i=d||g.length-1,j=0,k=1;k<f.length;k++)for(var l=h;i>=l;l++)+g[l]!=+f[k]||(e&&e.apply(this,[j,k,h,l]),h=l,j=k)},alineScaleColumns:function(a,b,c,d){this.iterateScales(a,b,c,d,function(c,d,e,f){var g=this.getSum(a.width,e,f-1),h=this.getSum(b.width,c,d-1);h!=g&&this.setSumWidth(g,b,c,d-1)})},eachColumn:function(a,b,c){var d=new Date(gantt._min_date),e=new Date(gantt._max_date);gantt.date[a+"_start"]&&(d=gantt.date[a+"_start"](d));var f=new Date(d);for(+f>=+e&&(e=gantt.date.add(f,b,a));+e>+f;){c.call(this,new Date(f));var g=f.getTimezoneOffset();f=gantt.date.add(f,b,a),f=gantt._correct_dst_change(f,g,b,a),gantt.date[a+"_start"]&&(f=gantt.date[a+"_start"](f))}},limitVisibleRange:function(a){var b=a.trace_x,c=0,d=a.width.length-1,e=0;if(+b[0]<+gantt._min_date&&c!=d){var f=Math.floor(a.width[0]*((b[1]-gantt._min_date)/(b[1]-b[0])));e+=a.width[0]-f,a.width[0]=f,b[0]=new Date(gantt._min_date)}var g=b.length-1,h=b[g],i=gantt.date.add(h,a.step,a.unit);if(+i>+gantt._max_date&&g>0){var f=a.width[g]-Math.floor(a.width[g]*((i-gantt._max_date)/(i-h)));e+=a.width[g]-f,a.width[g]=f}if(e){for(var j=this.getSum(a.width),k=0,l=0;l<a.width.length;l++){var m=Math.floor(e*(a.width[l]/j));a.width[l]+=m,k+=m}this.adjustSize(e-k,a.width)}}},gantt._scale_helpers.processIgnores=function(a){var b=a.count;if(a.ignore_x={},gantt.ignore_time||gantt.config.skip_off_time){var c=gantt.ignore_time||function(){return!1};b=0;for(var d=0;d<a.trace_x.length;d++)c.call(gantt,a.trace_x[d])||this._ignore_time_config.call(gantt,a.trace_x[d])?(a.ignore_x[a.trace_x[d].valueOf()]=!0,a.ignored_colls=!0):b++}a.display_count=b},gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var a=gantt.config.drag_mode;this.set_actions();var b={before_start:"onBeforeTaskDrag",before_finish:"onBeforeTaskChanged",after_finish:"onAfterTaskDrag"};for(var c in this._events)for(var d in a)this._events[c][d]=b[c];this._handlers[a.move]=this._move,this._handlers[a.resize]=this._resize,this._handlers[a.progress]=this._resize_progress},set_actions:function(){var a=gantt.$task_data;dhtmlxEvent(a,"mousemove",dhtmlx.bind(function(a){this.on_mouse_move(a||event)},this)),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(a){this.on_mouse_down(a||event)},this)),dhtmlxEvent(a,"mouseup",dhtmlx.bind(function(a){this.on_mouse_up(a||event)},this))},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start_x:null,start_y:null,obj:null,left:null}},_resize:function(a,b,c){var d=gantt.config,e=this._drag_task_coords(a,c);c.left?(a.start_date=gantt.dateFromPos(e.start+b),a.start_date||(a.start_date=new Date(gantt.getState().min_date))):(a.end_date=gantt.dateFromPos(e.end+b),a.end_date||(a.end_date=new Date(gantt.getState().max_date))),a.end_date-a.start_date<d.min_duration&&(c.left?a.start_date=gantt.calculateEndDate(a.end_date,-1):a.end_date=gantt.calculateEndDate(a.start_date,1)),gantt._init_task_timing(a)},_resize_progress:function(a,b,c){var d=this._drag_task_coords(a,c),e=Math.max(0,c.pos.x-d.start);a.progress=Math.min(1,e/(d.end-d.start))},_move:function(a,b,c){var d=this._drag_task_coords(a,c),e=gantt.dateFromPos(d.start+b),f=gantt.dateFromPos(d.end+b);e?f?(a.start_date=e,a.end_date=f):(a.end_date=new Date(gantt.getState().max_date),a.start_date=gantt.dateFromPos(gantt.posFromDate(a.end_date)-(d.end-d.start))):(a.start_date=new Date(gantt.getState().min_date),a.end_date=gantt.dateFromPos(gantt.posFromDate(a.start_date)+(d.end-d.start)))},_drag_task_coords:function(a,b){var c=b.obj_s_x=b.obj_s_x||gantt.posFromDate(a.start_date),d=b.obj_e_x=b.obj_e_x||gantt.posFromDate(a.end_date);return{start:c,end:d}},on_mouse_move:function(a){this.drag.start_drag&&this._start_dnd(a);var b=this.drag;if(b.mode){if(!gantt._checkTimeout(this,40))return;this._update_on_move(a)}},_update_on_move:function(a){var b=this.drag;if(b.mode){var c=gantt._get_mouse_pos(a);if(b.pos&&b.pos.x==c.x)return;b.pos=c;var d=gantt.dateFromPos(c.x);if(!d||isNaN(d.getTime()))return;var e=c.x-b.start_x,f=gantt.getTask(b.id);if(this._handlers[b.mode]){var g=dhtmlx.mixin({},f),h=dhtmlx.mixin({},f);this._handlers[b.mode].apply(this,[h,e,b]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id,!0),gantt.callEvent("onTaskDrag",[f.id,b.mode,h,g,a]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id),gantt.refreshTask(b.id)}}},on_mouse_down:function(a,b){if(2!=a.button){var c=gantt.locate(a),d=null;if(gantt.isTaskExists(c)&&(d=gantt.getTask(c)),!gantt._is_readonly(d)&&!this.drag.mode){this.clear_drag_state(),b=b||a.target||a.srcElement;var e=gantt._getClassName(b);if(!e||!this._get_drag_mode(e))return b.parentNode?this.on_mouse_down(a,b.parentNode):void 0;var f=this._get_drag_mode(e);if(f)if(f.mode&&f.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+f.mode]){if(c=gantt.locate(b),d=dhtmlx.copy(gantt.getTask(c)||{}),gantt._is_readonly(d))return this.clear_drag_state(),!1;if(gantt._is_flex_task(d)&&f.mode!=gantt.config.drag_mode.progress)return void this.clear_drag_state();f.id=c;var g=gantt._get_mouse_pos(a);f.start_x=g.x,f.start_y=g.y,f.obj=d,this.drag.start_drag=f}else this.clear_drag_state();else if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[e.split(" ")[0]])&&b.parentNode)return this.on_mouse_down(a,b.parentNode)}}},_fix_dnd_scale_time:function(a,b){function c(a){gantt.isWorkTime(a.start_date)||(a.start_date=gantt.calculateEndDate(a.start_date,-1,gantt.config.duration_unit))}function d(a){gantt.isWorkTime(new Date(a.end_date-1))||(a.end_date=gantt.calculateEndDate(a.end_date,1,gantt.config.duration_unit))}var e=gantt._tasks.unit,f=gantt._tasks.step;gantt.config.round_dnd_dates||(e="minute",f=gantt.config.time_step),b.mode==gantt.config.drag_mode.resize?b.left?(a.start_date=gantt.roundDate({date:a.start_date,unit:e,step:f}),c(a)):(a.end_date=gantt.roundDate({date:a.end_date,unit:e,step:f}),d(a)):b.mode==gantt.config.drag_mode.move&&(a.start_date=gantt.roundDate({date:a.start_date,unit:e,step:f}),c(a),a.end_date=gantt.calculateEndDate(a.start_date,a.duration,gantt.config.duration_unit))},_fix_working_times:function(a,b){var b=b||{mode:gantt.config.drag_mode.move};gantt.config.work_time&&gantt.config.correct_work_time&&(b.mode==gantt.config.drag_mode.resize?b.left?a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}):a.end_date=gantt.getClosestWorkTime({date:a.end_date,dir:"past"}):b.mode==gantt.config.drag_mode.move&&gantt.correctTaskWorkTime(a))},on_mouse_up:function(a){var b=this.drag;if(b.mode&&b.id){var c=gantt.getTask(b.id);if(gantt.config.work_time&&gantt.config.correct_work_time&&this._fix_working_times(c,b),this._fix_dnd_scale_time(c,b),gantt._init_task_timing(c),this._fireEvent("before_finish",b.mode,[b.id,b.mode,dhtmlx.copy(b.obj),a])){var d=b.id;gantt._init_task_timing(c),this._fireEvent("after_finish",b.mode,[d,b.mode,a]),this.clear_drag_state(),gantt.updateTask(c.id)}else b.obj._dhx_changed=!1,dhtmlx.mixin(c,b.obj,!0),gantt.updateTask(c.id)}this.clear_drag_state()},_get_drag_mode:function(a){var b=gantt.config.drag_mode,c=(a||"").split(" "),d=c[0],e={mode:null,left:null};switch(d){case"gantt_task_line":case"gantt_task_content":e.mode=b.move;break;case"gantt_task_drag":e.mode=b.resize,e.left=c[1]&&-1!==c[1].indexOf("left",c[1].length-"left".length)?!0:!1;break;case"gantt_task_progress_drag":e.mode=b.progress;break;case"gantt_link_control":case"gantt_link_point":e.mode=b.ignore;break;default:e=null}return e},_start_dnd:function(a){var b=this.drag=this.drag.start_drag;delete b.start_drag;var c=gantt.config,d=b.id;c["drag_"+b.mode]&&gantt.callEvent("onBeforeDrag",[d,b.mode,a])&&this._fireEvent("before_start",b.mode,[d,b.mode,a])?delete b.start_drag:this.clear_drag_state()},_fireEvent:function(a,b,c){dhtmlx.assert(this._events[a],"Invalid stage:{"+a+"}");var d=this._events[a][b];return dhtmlx.assert(d,"Unknown after drop mode:{"+b+"}"),dhtmlx.assert(c,"Invalid event arguments"),gantt.checkEvent(d)?gantt.callEvent(d,c):!0}},gantt.roundTaskDates=function(a){var b=gantt._tasks_dnd.drag;b||(b={mode:gantt.config.drag_mode.move}),gantt._tasks_dnd._fix_dnd_scale_time(a,b)},gantt._render_link=function(a){for(var b=this.getLink(a),c=gantt._get_link_renderers(),d=0;d<c.length;d++)c[d].render_item(b)},gantt._get_link_type=function(a,b){var c=null;return a&&b?c=gantt.config.links.start_to_start:!a&&b?c=gantt.config.links.finish_to_start:a||b?a&&!b&&(c=gantt.config.links.start_to_finish):c=gantt.config.links.finish_to_finish,c},gantt.isLinkAllowed=function(a,b,c,d){var e=null;if(e="object"==typeof a?a:{source:a,target:b,type:this._get_link_type(c,d)},!e)return!1;if(!(e.source&&e.target&&e.type))return!1;if(e.source==e.target)return!1;var f=!0;return this.checkEvent("onLinkValidation")&&(f=this.callEvent("onLinkValidation",[e])),f},gantt._render_link_element=function(a){var b=this._path_builder.get_points(a),c=gantt._drawer,d=c.get_lines(b),e=document.createElement("div"),f="gantt_task_link";a.color&&(f+=" gantt_link_inline_color");var g=this.templates.link_class?this.templates.link_class(a):"";g&&(f+=" "+g),this.config.highlight_critical_path&&this.isCriticalLink&&this.isCriticalLink(a)&&(f+=" gantt_critical_link"),e.className=f,e.setAttribute(gantt.config.link_attribute,a.id);for(var h=0;h<d.length;h++){h==d.length-1&&(d[h].size-=gantt.config.link_arrow_size);var i=c.render_line(d[h],d[h+1]);a.color&&(i.firstChild.style.backgroundColor=a.color),e.appendChild(i)}var j=d[d.length-1].direction,k=gantt._render_link_arrow(b[b.length-1],j);return a.color&&(k.style.borderColor=a.color),e.appendChild(k),e},gantt._render_link_arrow=function(a,b){var c=document.createElement("div"),d=gantt._drawer,e=a.y,f=a.x,g=gantt.config.link_arrow_size,h=gantt.config.row_height,i="gantt_link_arrow gantt_link_arrow_"+b;switch(b){case d.dirs.right:e-=(g-h)/2,f-=g;break;case d.dirs.left:e-=(g-h)/2;break;case d.dirs.up:f-=g;break;case d.dirs.down:e+=2*g,f-=g}return c.style.cssText=["top:"+e+"px","left:"+f+"px"].join(";"),c.className=i,c},gantt._drawer={current_pos:null,dirs:{left:"left",right:"right",up:"up",down:"down"},path:[],clear:function(){this.current_pos=null,this.path=[]},point:function(a){this.current_pos=dhtmlx.copy(a)},get_lines:function(a){this.clear(),this.point(a[0]);for(var b=1;b<a.length;b++)this.line_to(a[b]);return this.get_path()},line_to:function(a){var b=dhtmlx.copy(a),c=this.current_pos,d=this._get_line(c,b);this.path.push(d),this.current_pos=b},get_path:function(){return this.path},get_wrapper_sizes:function(a){var b,c=gantt.config.link_wrapper_width,d=(gantt.config.link_line_width,a.y+(gantt.config.row_height-c)/2);switch(a.direction){case this.dirs.left:b={top:d,height:c,lineHeight:c,left:a.x-a.size-c/2,width:a.size+c};break;case this.dirs.right:b={top:d,lineHeight:c,height:c,left:a.x-c/2,width:a.size+c};break;case this.dirs.up:b={top:d-a.size,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c};break;case this.dirs.down:b={top:d,lineHeight:a.size+2*c,height:a.size+2*c,left:a.x-c/2,width:c}}return b},get_line_sizes:function(a){var b,c=gantt.config.link_line_width,d=gantt.config.link_wrapper_width,e=a.size+c;switch(a.direction){case this.dirs.left:case this.dirs.right:b={height:c,width:e,marginTop:(d-c)/2,marginLeft:(d-c)/2};break;case this.dirs.up:case this.dirs.down:b={height:e,width:c,marginTop:(d-c)/2,marginLeft:(d-c)/2}}return b},render_line:function(a){var b=this.get_wrapper_sizes(a),c=document.createElement("div");c.style.cssText=["top:"+b.top+"px","left:"+b.left+"px","height:"+b.height+"px","width:"+b.width+"px"].join(";"),c.className="gantt_line_wrapper";var d=this.get_line_sizes(a),e=document.createElement("div");return e.style.cssText=["height:"+d.height+"px","width:"+d.width+"px","margin-top:"+d.marginTop+"px","margin-left:"+d.marginLeft+"px"].join(";"),e.className="gantt_link_line_"+a.direction,c.appendChild(e),c},_get_line:function(a,b){var c=this.get_direction(a,b),d={x:a.x,y:a.y,direction:this.get_direction(a,b)};return d.size=Math.abs(c==this.dirs.left||c==this.dirs.right?a.x-b.x:a.y-b.y),d},get_direction:function(a,b){var c=0;return c=b.x<a.x?this.dirs.left:b.x>a.x?this.dirs.right:b.y>a.y?this.dirs.down:this.dirs.up}},gantt._y_from_ind=function(a){return a*gantt.config.row_height},gantt._path_builder={path:[],clear:function(){this.path=[]},current:function(){return this.path[this.path.length-1]},point:function(a){return a?(this.path.push(dhtmlx.copy(a)),a):this.current()},point_to:function(a,b,c){c=c?{x:c.x,y:c.y}:dhtmlx.copy(this.point());var d=gantt._drawer.dirs;switch(a){case d.left:c.x-=b;break;case d.right:c.x+=b;break;case d.up:c.y-=b;break;case d.down:c.y+=b}return this.point(c)},get_points:function(a){var b=this.get_endpoint(a),c=gantt.config,d=b.e_y-b.y,e=b.e_x-b.x,f=gantt._drawer.dirs;this.clear(),this.point({x:b.x,y:b.y});var g=2*c.link_arrow_size,h=b.e_x>b.x;if(a.type==gantt.config.links.start_to_start)this.point_to(f.left,g),h?(this.point_to(f.down,d),this.point_to(f.right,e)):(this.point_to(f.right,e),this.point_to(f.down,d)),this.point_to(f.right,g);else if(a.type==gantt.config.links.finish_to_start)if(h=b.e_x>b.x+2*g,this.point_to(f.right,g),h)e-=g,this.point_to(f.down,d),this.point_to(f.right,e);else{e-=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.right,g)}else if(a.type==gantt.config.links.finish_to_finish)this.point_to(f.right,g),h?(this.point_to(f.right,e),this.point_to(f.down,d)):(this.point_to(f.down,d),this.point_to(f.right,e)),this.point_to(f.left,g);else if(a.type==gantt.config.links.start_to_finish)if(h=b.e_x>b.x-2*g,this.point_to(f.left,g),h){e+=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.left,g)}else e+=g,this.point_to(f.down,d),this.point_to(f.right,e);return this.path},get_endpoint:function(a){var b=gantt.config.links,c=!1,d=!1;a.type==b.start_to_start?c=d=!0:a.type==b.finish_to_finish?c=d=!1:a.type==b.finish_to_start?(c=!1,d=!0):a.type==b.start_to_finish?(c=!0,d=!1):dhtmlx.assert(!1,"Invalid link type");var e=gantt._get_task_visible_pos(gantt._pull[a.source],c),f=gantt._get_task_visible_pos(gantt._pull[a.target],d);return{x:e.x,e_x:f.x,y:e.y,e_y:f.y}}},gantt._init_links_dnd=function(){function a(a,b,c){var d=gantt._get_task_pos(a,!!b);return d.y+=gantt._get_task_height()/2,c=c||0,d.x+=(b?-1:1)*c,d}function b(a){var b=d(),c=["gantt_link_tooltip"];b.from&&b.to&&c.push(gantt.isLinkAllowed(b.from,b.to,b.from_start,b.to_start)?"gantt_allowed_link":"gantt_invalid_link");var e=gantt.templates.drag_link_class(b.from,b.from_start,b.to,b.to_start);e&&c.push(e);var f="<div class='"+e+"'>"+gantt.templates.drag_link(b.from,b.from_start,b.to,b.to_start)+"</div>";a.innerHTML=f}function c(a,b){a.style.left=b.x+5+"px",a.style.top=b.y+5+"px"}function d(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start}}function e(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=null,gantt._link_target_task_start=!0}function f(a,b,c,e){var f=i(),j=d(),k=["gantt_link_direction"];gantt.templates.link_direction_class&&k.push(gantt.templates.link_direction_class(j.from,j.from_start,j.to,j.to_start));var l=Math.sqrt(Math.pow(c-a,2)+Math.pow(e-b,2));if(l=Math.max(0,l-3)){f.className=k.join(" ");var m=(e-b)/(c-a),n=Math.atan(m);2==h(a,c,b,e)?n+=Math.PI:3==h(a,c,b,e)&&(n-=Math.PI);var o=Math.sin(n),p=Math.cos(n),q=Math.round(b),r=Math.round(a),s=["-webkit-transform: rotate("+n+"rad)","-moz-transform: rotate("+n+"rad)","-ms-transform: rotate("+n+"rad)","-o-transform: rotate("+n+"rad)","transform: rotate("+n+"rad)","width:"+Math.round(l)+"px"];
if(-1!=window.navigator.userAgent.indexOf("MSIE 8.0")){s.push('-ms-filter: "'+g(o,p)+'"');var t=Math.abs(Math.round(a-c)),u=Math.abs(Math.round(e-b));switch(h(a,c,b,e)){case 1:q-=u;break;case 2:r-=t,q-=u;break;case 3:r-=t}}s.push("top:"+q+"px"),s.push("left:"+r+"px"),f.style.cssText=s.join(";")}}function g(a,b){return"progid:DXImageTransform.Microsoft.Matrix(M11 = "+b+",M12 = -"+a+",M21 = "+a+",M22 = "+b+",SizingMethod = 'auto expand')"}function h(a,b,c,d){return b>=a?c>=d?1:4:c>=d?2:3}function i(){return k._direction||(k._direction=document.createElement("div"),gantt.$task_links.appendChild(k._direction)),k._direction}function j(){k._direction&&(k._direction.parentNode&&k._direction.parentNode.removeChild(k._direction),k._direction=null)}var k=new dhtmlxDnD(this.$task_bars,{sensitivity:0,updates_per_second:60}),l="task_left",m="task_right",n="gantt_link_point",o="gantt_link_control";k.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){var d=c.target||c.srcElement;if(e(),gantt.getState().drag_id)return!1;if(gantt._locate_css(d,n)){gantt._locate_css(d,l)&&(gantt._link_source_task_start=!0);var f=gantt._link_source_task=this.locate(c),g=gantt.getTask(f);if(gantt._is_readonly(g))return e(),!1;var h=0;return gantt._get_safe_type(g.type)==gantt.config.types.milestone&&(h=(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2),this._dir_start=a(g,!!gantt._link_source_task_start,h),!0}return!1},this)),k.attachEvent("onAfterDragStart",dhtmlx.bind(function(){b(k.config.marker)},this)),k.attachEvent("onDragMove",dhtmlx.bind(function(d,e){var g=k.config,h=k.getPosition(e);c(g.marker,h);var i=gantt._is_link_drop_area(e),j=gantt._link_target_task,l=gantt._link_landing,n=gantt._link_target_task_start,p=gantt.locate(e),q=!0;if(i&&(q=!gantt._locate_css(e,m),i=!!p),gantt._link_target_task=p,gantt._link_landing=i,gantt._link_target_task_start=q,i){var r=gantt.getTask(p),s=gantt._locate_css(e,o),t=0;s&&(t=Math.floor(s.offsetWidth/2)),this._dir_end=a(r,!!gantt._link_target_task_start,t)}else this._dir_end=gantt._get_mouse_pos(e);var u=!(l==i&&j==p&&n==q);return u&&(j&&gantt.refreshTask(j,!1),p&&gantt.refreshTask(p,!1)),u&&b(g.marker),f(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y),!0},this)),k.attachEvent("onDragEnd",dhtmlx.bind(function(){var a=d();if(a.from&&a.to&&a.from!=a.to){var b=gantt._get_link_type(a.from_start,a.to_start),c={source:a.from,target:a.to,type:b};c.type&&gantt.isLinkAllowed(c)&&gantt.addLink(c)}e(),a.from&&gantt.refreshTask(a.from,!1),a.to&&gantt.refreshTask(a.to,!1),j()},this)),gantt._is_link_drop_area=function(a){return!!gantt._locate_css(a,o)}},gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start}},gantt._init_tasks=function(){function a(a,b,c,d){for(var e=0;e<a.length;e++)a[e].change_id(b,c),a[e].render_item(d)}this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}},this._click.gantt_task_link=dhtmlx.bind(function(a){var b=this.locate(a,gantt.config.link_attribute);b&&this.callEvent("onLinkClick",[b,a])},this),this._click.gantt_scale_cell=dhtmlx.bind(function(a){var b=gantt._get_mouse_pos(a),c=gantt.dateFromPos(b.x),d=Math.floor(gantt._day_index_by_date(c)),e=gantt._tasks.trace_x[d];gantt.callEvent("onScaleClick",[a,e])},this),this._dbl_click.gantt_task_link=dhtmlx.bind(function(a,b){var b=this.locate(a,gantt.config.link_attribute);this._delete_link_handler(b,a)},this),this._dbl_click.gantt_link_point=dhtmlx.bind(function(a,b,c){var b=this.locate(a),d=this.getTask(b),e=null;return c.parentNode&&gantt._getClassName(c.parentNode)&&(e=gantt._getClassName(c.parentNode).indexOf("_left")>-1?d.$target[0]:d.$source[0]),e&&this._delete_link_handler(e,a),!1},this),this._tasks_dnd.init(),this._init_links_dnd(),this._link_layers.clear();var b=this.addLinkLayer({renderer:this._render_link_element,container:this.$task_links,filter:gantt._create_filter(["_filter_link","_is_chart_visible"])});this._linkRenderer=this._link_layers.getRenderer(b),this._task_layers.clear();var c=this.addTaskLayer({renderer:this._render_task_element,container:this.$task_bars,filter:gantt._create_filter(["_filter_task","_is_chart_visible"])});this._taskRenderer=this._task_layers.getRenderer(c),this.addTaskLayer({renderer:this._render_grid_item,container:this.$grid_data,filter:gantt._create_filter(["_filter_task","_is_grid_visible"])}),this.addTaskLayer({renderer:this._render_bg_line,container:this.$task_bg,filter:gantt._create_filter(["_filter_task","_is_chart_visible","_is_std_background"])}),this._onTaskIdChange&&this.detachEvent(this._onTaskIdChange),this._onTaskIdChange=this.attachEvent("onTaskIdChange",function(b,c){var d=this._get_task_renderers();a(d,b,c,this.getTask(c))}),this._onLinkIdChange&&this.detachEvent(this._onLinkIdChange),this._onLinkIdChange=this.attachEvent("onLinkIdChange",function(b,c){var d=this._get_link_renderers();a(d,b,c,this.getLink(c))})},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&gantt[f].apply(gantt,[b.id,b])!==!1)}return c}},gantt._is_chart_visible=function(){return!!this.config.show_chart},gantt._filter_task=function(a,b){var c=null,d=null;return this.config.start_date&&this.config.end_date&&(c=this.config.start_date.valueOf(),d=this.config.end_date.valueOf(),+b.start_date>d||+b.end_date<+c)?!1:!0},gantt._filter_link=function(a,b){return this.config.show_links?!gantt.isTaskVisible(b.source)||!gantt.isTaskVisible(b.target)||gantt._isAllowedUnscheduledTask(gantt.getTask(b.source))||gantt._isAllowedUnscheduledTask(gantt.getTask(b.target))?!1:this.callEvent("onBeforeLinkDisplay",[a,b]):!1},gantt._is_std_background=function(){return!this.config.static_background},gantt._delete_link_handler=function(a,b){if(a&&this.callEvent("onLinkDblClick",[a,b])){var c=gantt.getLink(a);if(gantt._is_readonly(c))return;var d="",e=gantt.locale.labels.link+" "+this.templates.link_description(this.getLink(a))+" "+gantt.locale.labels.confirm_link_deleting;window.setTimeout(function(){gantt._dhtmlx_confirm(e,d,function(){gantt.deleteLink(a)})},gantt.config.touch?300:1)}},gantt.getTaskNode=function(a){return this._taskRenderer.rendered[a]},gantt.getLinkNode=function(a){return this._linkRenderer.rendered[a]},gantt._get_tasks_data=function(){for(var a=[],b=0;b<this._order.length;b++){var c=this._pull[this._order[b]];c.$index=b,this.resetProjectDates(c),a.push(c)}return a},gantt._get_links_data=function(){var a=[];for(var b in this._lpull)a.push(this._lpull[b]);return a},gantt._render_data=function(){if(this.callEvent("onBeforeDataRender",[]),this._is_render_active()){this._sync_order(),this._update_layout_sizes(),this.config.static_background&&this._render_bg_canvas();for(var a=this._get_tasks_data(),b=this._get_task_renderers(),c=0;c<b.length;c++)b[c].render_items(a);var d=gantt._get_links_data();b=this._get_link_renderers();for(var c=0;c<b.length;c++)b[c].render_items(d);this.callEvent("onDataRender",[])}},gantt._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var b=this.$task_data.childNodes,c=0,d=b.length;d>c;c++){var e=b[c];this._is_layer(e)&&e.style&&(e.style.width=a.full_width+"px")}if(this._is_grid_visible()){for(var f=this.getGridColumns(),g=0,c=0;c<f.length;c++)g+=f[c].width;this.$grid_data.style.width=Math.max(g-1,0)+"px"}},gantt._scale_range_unit=function(){var a=this.config.scale_unit;if(this.config.scale_offset_minimal){var b=this._get_scales();a=b[b.length-1].unit}return a},gantt._init_tasks_range=function(){var a=this._scale_range_unit();if(this.config.start_date&&this.config.end_date)return this._min_date=this.date[a+"_start"](new Date(this.config.start_date)),void(this._max_date=this.date[a+"_start"](new Date(this.config.end_date)));this._get_tasks_data();var b=this.getSubtaskDates();this._min_date=b.start_date,this._max_date=b.end_date,this._max_date&&this._max_date||(this._min_date=new Date,this._max_date=new Date(this._min_date)),this._min_date=this.date[a+"_start"](this._min_date),this._min_date=this.calculateEndDate(this.date[a+"_start"](this._min_date),-1,a),this._max_date=this.date[a+"_start"](this._max_date),this._max_date=this.calculateEndDate(this._max_date,2,a)},gantt._prepare_scale_html=function(a){var b=[],c=null,d=null,e=null;(a.template||a.date)&&(d=a.template||this.date.date_to_str(a.date)),e=a.css||function(){},!a.css&&this.config.inherit_scale_class&&(e=gantt.templates.scale_cell_class);for(var f=0;f<a.count;f++){c=new Date(a.trace_x[f]);var g=d.call(this,c),h=a.width[f],i="",j="",k="";if(h){i="width:"+h+"px;",k="gantt_scale_cell"+(f==a.count-1?" gantt_last_cell":""),j=e.call(this,c),j&&(k+=" "+j);var l="<div class='"+k+"' style='"+i+"'>"+g+"</div>";b.push(l)}}return b.join("")},gantt._get_scales=function(){var a=this._scale_helpers,b=[a.primaryScale()].concat(this.config.subscales);return a.sortScales(b),b},gantt._render_tasks_scales=function(){this._init_tasks_range(),this._scroll_resize(),this._set_sizes();var a="",b=0,c=0,d=0;if(this._is_chart_visible()){var e=this._scale_helpers,f=this._get_scales();d=this.config.scale_height-1;for(var g=this._get_resize_options(),h=g.x?Math.max(this.config.autosize_min_width,0):this.$task.offsetWidth,i=e.prepareConfigs(f,this.config.min_column_width,h,d),j=this._tasks=i[i.length-1],k=[],l=this.templates.scale_row_class,m=0;m<i.length;m++){var n="gantt_scale_line",o=l(i[m]);o&&(n+=" "+o),k.push('<div class="'+n+'" style="height:'+i[m].height+"px;line-height:"+i[m].height+'px">'+this._prepare_scale_html(i[m])+"</div>")}a=k.join(""),b=j.full_width+this.$scroll_ver.offsetWidth+"px",c=j.full_width+"px",d+="px"}this.$task.style.display=this._is_chart_visible()?"":"none",this.$task_scale.style.height=d,this.$task_data.style.width=this.$task_scale.style.width=b,this.$task_scale.innerHTML=a},gantt._render_bg_line=function(a){var b=gantt._tasks,c=b.count,d=document.createElement("div");if(gantt.config.show_task_cells)for(var e=0;c>e;e++){var f=b.width[e],g="";if(f>0){var h=document.createElement("div");h.style.width=f+"px",g="gantt_task_cell"+(e==c-1?" gantt_last_cell":""),j=this.templates.task_cell_class(a,b.trace_x[e]),j&&(g+=" "+j),h.className=g,d.appendChild(h)}}var i=a.$index%2!==0,j=gantt.templates.task_row_class(a.start_date,a.end_date,a),k="gantt_task_row"+(i?" odd":"")+(j?" "+j:"");return this.getState().selected_task==a.id&&(k+=" gantt_selected"),d.className=k,d.style.height=gantt.config.row_height+"px",d.setAttribute(this.config.task_attribute,a.id),d},gantt._render_bg_canvas=function(){},gantt._adjust_scales=function(){if(this.config.fit_tasks){var a=+this._min_date,b=+this._max_date;if(this._init_tasks_range(),+this._min_date!=a||+this._max_date!=b)return this.render(),this.callEvent("onScaleAdjusted",[]),!0}return!1},gantt.refreshTask=function(a,b){if(this._is_render_active()){var c=this._get_task_renderers(),d=this.getTask(a);if(d&&this.isTaskVisible(a)){for(var e=0;e<c.length;e++)c[e].render_item(d);if(void 0!==b&&!b)return;for(var e=0;e<d.$source.length;e++)gantt.refreshLink(d.$source[e]);for(var e=0;e<d.$target.length;e++)gantt.refreshLink(d.$target[e])}else this._render_data()}},gantt.refreshLink=function(a){if(this._is_render_active())if(this.isLinkExists(a))this._render_link(a);else for(var b=this._get_link_renderers(),c=0;c<b.length;c++)b[c].remove_item(a)},gantt._combine_item_class=function(a,b,c){var d=[a];b&&d.push(b);var e=gantt.getState(),f=this.getTask(c);this._get_safe_type(f.type)==this.config.types.milestone&&d.push("gantt_milestone"),this._get_safe_type(f.type)==this.config.types.project&&d.push("gantt_project"),this._is_flex_task(f)&&d.push("gantt_dependent_task"),this.config.select_task&&c==e.selected_task&&d.push("gantt_selected"),c==e.drag_id&&(d.push("gantt_drag_"+e.drag_mode),e.touch_drag&&d.push("gantt_touch_"+e.drag_mode));var g=gantt._get_link_state();if(g.link_source_id==c&&d.push("gantt_link_source"),g.link_target_id==c&&d.push("gantt_link_target"),this.config.highlight_critical_path&&this.isCriticalTask&&this.isCriticalTask(f)&&d.push("gantt_critical_task"),g.link_landing_area&&g.link_target_id&&g.link_source_id&&g.link_target_id!=g.link_source_id){var h=g.link_source_id,i=g.link_source_start,j=g.link_target_start,k=gantt.isLinkAllowed(h,c,i,j),l="";l=k?j?"link_start_allow":"link_finish_allow":j?"link_start_deny":"link_finish_deny",d.push(l)}return d.join(" ")},gantt._render_pair=function(a,b,c,d){var e=gantt.getState();+c.end_date<=+e.max_date&&a.appendChild(d(b+" task_right")),+c.start_date>=+e.min_date&&a.appendChild(d(b+" task_left"))},gantt._get_task_height=function(){var a=this.config.task_height;return"full"==a&&(a=this.config.row_height-5),a=Math.min(a,this.config.row_height),Math.max(a,0)},gantt._get_milestone_width=function(){return this._get_task_height()},gantt._get_visible_milestone_width=function(){var a=gantt._get_task_height();return Math.sqrt(2*a*a)},gantt.getTaskPosition=function(a,b,c){var d=this.posFromDate(b||a.start_date),e=this.posFromDate(c||a.end_date);e=Math.max(d,e);var f=this.getTaskTop(a.id),g=this.config.task_height;return{left:d,top:f,height:g,width:Math.max(e-d,0)}},gantt._get_task_width=function(a){return Math.round(this._get_task_pos(a,!1).x-this._get_task_pos(a,!0).x)},gantt._is_readonly=function(a){return a&&a[this.config.editable_property]?!1:a&&a[this.config.readonly_property]||this.config.readonly},gantt._task_default_render=function(a){if(!this._isAllowedUnscheduledTask(a)){var b=this._get_task_pos(a),c=this.config,d=this._get_task_height(),e=Math.floor((this.config.row_height-d)/2);this._get_safe_type(a.type)==c.types.milestone&&c.link_line_width>1&&(e+=1);var f=document.createElement("div"),g=gantt._get_task_width(a),h=this._get_safe_type(a.type);f.setAttribute(this.config.task_attribute,a.id),c.show_progress&&h!=this.config.types.milestone&&this._render_task_progress(a,f,g);var i=gantt._render_task_content(a,g);a.textColor&&(i.style.color=a.textColor),f.appendChild(i);var j=this._combine_item_class("gantt_task_line",this.templates.task_class(a.start_date,a.end_date,a),a.id);(a.color||a.progressColor||a.textColor)&&(j+=" gantt_task_inline_color"),f.className=j;var k=["left:"+b.x+"px","top:"+(e+b.y)+"px","height:"+d+"px","line-height:"+d+"px","width:"+g+"px"];a.color&&k.push("background-color:"+a.color),a.textColor&&k.push("color:"+a.textColor),f.style.cssText=k.join(";");var l=this._render_leftside_content(a);return l&&f.appendChild(l),l=this._render_rightside_content(a),l&&f.appendChild(l),this._is_readonly(a)||(c.drag_resize&&!this._is_flex_task(a)&&h!=this.config.types.milestone&&gantt._render_pair(f,"gantt_task_drag",a,function(a){var b=document.createElement("div");return b.className=a,b}),c.drag_links&&this.config.show_links&&gantt._render_pair(f,"gantt_link_control",a,function(a){var b=document.createElement("div");b.className=a,b.style.cssText=["height:"+d+"px","line-height:"+d+"px"].join(";");var c=document.createElement("div");return c.className="gantt_link_point",b.appendChild(c),b})),f}},gantt._render_task_element=function(a){var b=this.config.type_renderers,c=b[this._get_safe_type(a.type)],d=this._task_default_render;return c||(c=d),c.call(this,a,dhtmlx.bind(d,this))},gantt._render_side_content=function(a,b,c){if(!b)return null;var d=b(a.start_date,a.end_date,a);if(!d)return null;var e=document.createElement("div");return e.className="gantt_side_content "+c,e.innerHTML=d,e},gantt._render_leftside_content=function(a){var b="gantt_left "+gantt._get_link_crossing_css(!0,a);return gantt._render_side_content(a,this.templates.leftside_text,b)},gantt._render_rightside_content=function(a){var b="gantt_right "+gantt._get_link_crossing_css(!1,a);return gantt._render_side_content(a,this.templates.rightside_text,b)},gantt._get_conditions=function(a){return a?{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]}:{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]}},gantt._get_link_crossing_css=function(a,b){var c=gantt._get_conditions(a);for(var d in c)for(var e=b[d],f=0;f<e.length;f++)for(var g=gantt.getLink(e[f]),h=0;h<c[d].length;h++)if(g.type==c[d][h])return"gantt_link_crossing";return""},gantt._render_task_content=function(a){var b=document.createElement("div");return this._get_safe_type(a.type)!=this.config.types.milestone&&(b.innerHTML=this.templates.task_text(a.start_date,a.end_date,a)),b.className="gantt_task_content",b},gantt._render_task_progress=function(a,b,c){var d=1*a.progress||0;c=Math.max(c-2,0);var e=document.createElement("div"),f=Math.round(c*d);if(f=Math.min(c,f),a.progressColor&&(e.style.backgroundColor=a.progressColor,e.style.opacity=1),e.style.width=f+"px",e.className=this.templates.progress_class?this.templates.progress_class(a):"gantt_task_progress",e.innerHTML=this.templates.progress_text(a.start_date,a.end_date,a),b.appendChild(e),this.config.drag_progress&&!gantt._is_readonly(a)){var g=document.createElement("div");g.style.left=f+"px",g.className="gantt_task_progress_drag",e.appendChild(g),b.appendChild(g)}},gantt._get_line=function(a){var b={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3,year:31536e3};return b[a]||0},gantt.dateFromPos=function(a){var b=this._tasks;if(0>a||a>b.full_width||!b.full_width)return null;var c=this._findBinary(this._tasks.left,a),d=this._tasks.left[c],e=b.width[c]||b.col_width,f=0;e&&(f=(a-d)/e);var g=0;f&&(g=gantt._get_coll_duration(b,b.trace_x[c]));var h=new Date(b.trace_x[c].valueOf()+Math.round(f*g));return h},gantt.posFromDate=function(a){var b=gantt._day_index_by_date(a);dhtmlx.assert(b>=0,"Invalid day index");var c=Math.floor(b),d=b%1,e=gantt._tasks.left[Math.min(c,gantt._tasks.width.length-1)];return c==gantt._tasks.width.length&&(e+=gantt._tasks.width[gantt._tasks.width.length-1]),d&&(e+=c<gantt._tasks.width.length?gantt._tasks.width[c]*(d%1):1),e},gantt._day_index_by_date=function(a){var b=new Date(a).valueOf(),c=gantt._tasks.trace_x,d=gantt._tasks.ignore_x;if(b<=this._min_date)return 0;if(b>=this._max_date)return c.length;for(var e=gantt._findBinary(c,b),f=+gantt._tasks.trace_x[e];d[f];)f=gantt._tasks.trace_x[++e];return f?e+(a-c[e])/gantt._get_coll_duration(gantt._tasks,c[e]):0},gantt._findBinary=function(a,b){for(var c,d,e,f=0,g=a.length-1;g>=f;)if(c=Math.floor((f+g)/2),d=+a[c],e=+a[c-1],b>d)f=c+1;else{if(!(d>b))return c;if(!isNaN(e)&&b>e)return c-1;g=c-1}return a.length-1},gantt._get_coll_duration=function(a,b){return gantt.date.add(b,a.step,a.unit)-b},gantt._get_x_pos=function(a,b){b=b!==!1;gantt.posFromDate(b?a.start_date:a.end_date)},gantt.getTaskTop=function(a){return this._y_from_ind(this.getGlobalTaskIndex(a))},gantt._get_task_coord=function(a,b,c){b=b!==!1,c=c||0;var d=this._get_safe_type(a.type)==this.config.types.milestone,e=null;e=b||d?a.start_date||this._default_task_date(a):a.end_date||this.calculateEndDate(this._default_task_date(a));var f=this.posFromDate(e),g=this.getTaskTop(a.id);return d&&(b?f-=c:f+=c),{x:f,y:g}},gantt._get_task_pos=function(a,b){b=b!==!1;var c=gantt._get_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._get_task_visible_pos=function(a,b){b=b!==!1;var c=gantt._get_visible_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._correct_shift=function(a,b){return a-=6e4*(new Date(gantt._min_date).getTimezoneOffset()-new Date(a).getTimezoneOffset())*(b?-1:1)},gantt._get_mouse_pos=function(a){if(a.pageX||a.pageY)var b={x:a.pageX,y:a.pageY};var c=_isIE?document.documentElement:document.body,b={x:a.clientX+c.scrollLeft-c.clientLeft,y:a.clientY+c.scrollTop-c.clientTop},d=gantt._get_position(gantt.$task_data);return b.x=b.x-d.x+gantt.$task_data.scrollLeft,b.y=b.y-d.y+gantt.$task_data.scrollTop,b},gantt._is_layer=function(a){return a&&a.hasAttribute&&a.hasAttribute(this.config.layer_attribute)},gantt._task_renderer=function(a,b,c,d){return this._task_area_pulls||(this._task_area_pulls={}),this._task_area_renderers||(this._task_area_renderers={}),this._task_area_renderers[a]?this._task_area_renderers[a]:(b||dhtmlx.assert(!1,"Invalid renderer call"),c&&c.setAttribute(this.config.layer_attribute,!0),this._task_area_renderers[a]={render_item:function(e,f){var g=gantt._task_area_pulls[a];if(f=f||c,d&&!d(e))return void this.remove_item(e.id);var h=b.call(gantt,e);h&&(g[e.id]?this.replace_item(e.id,h):(g[e.id]=h,f.appendChild(h)))},clear:function(b){this.rendered=gantt._task_area_pulls[a]={},b=b||c,b&&(b.innerHTML="")},render_items:function(a,b){b=b||c,this.clear(b);for(var d=document.createDocumentFragment(),e=0,f=a.length;f>e;e++)this.render_item(a[e],d);b.appendChild(d)},replace_item:function(a,b){var c=this.rendered[a];c&&c.parentNode&&c.parentNode.replaceChild(b,c),this.rendered[a]=b},remove_item:function(a){var b=this.rendered[a];b&&b.parentNode&&b.parentNode.removeChild(b),delete this.rendered[a]},change_id:function(a,b){this.rendered[b]=this.rendered[a],delete this.rendered[a]},rendered:this._task_area_pulls[a],node:c,unload:function(){this.clear(),delete gantt._task_area_renderers[a],delete gantt._task_area_pulls[a]}},this._task_area_renderers[a])},gantt._clear_renderers=function(){for(var a in this._task_area_renderers)this._task_renderer(a).unload()},gantt._render_bg_canvas=function(){var a=gantt._tasks,b=gantt.$task_bg,c=document.createElement("canvas"),d=gantt.config.row_height,e=a.col_width;if(c.getContext){c.height=d,c.width=e;var f=document.createElement("div"),g=document.createElement("div");f.className="gantt_task_row",g.className="gantt_task_cell",f.style.display=g.style.display="none",b.appendChild(f),f.appendChild(g);var h=c.getContext("2d");h.beginPath(),h.moveTo(0,d),h.lineTo(e,d),h.lineWidth=1,h.strokeStyle=getComputedStyle(f).getPropertyValue("border-bottom-color")||"#ebebeb",h.stroke(),h.beginPath(),h.moveTo(e,d),h.lineTo(e,0),h.lineWidth=1,h.strokeStyle=getComputedStyle(g).getPropertyValue("border-right-color")||"#ebebeb",h.stroke(),a.fill_img=c.toDataURL(),b.style.height=d*gantt._order.length+"px",b.style.backgroundImage="url("+a.fill_img+")",b.removeChild(f)}},gantt.attachEvent("onGanttReady",function(){gantt._task_layers.add(),gantt._link_layers.add()}),gantt._layers={prepareConfig:function(a){"function"==typeof a&&(a={renderer:a});a.id=dhtmlx.uid();return a.container||(a.container=document.createElement("div")),a},create:function(a,b){return{tempCollection:[],renderers:{},container:a,getRenderers:function(){var a=[];for(var b in this.renderers)a.push(this.renderers[b]);return a},getRenderer:function(a){return this.renderers[a]},add:function(a){if(a&&this.tempCollection.push(a),this.container())for(var c=this.container(),d=this.tempCollection,e=0;e<d.length;e++){var a=d[e],f=a.container,g=a.id,h=a.topmost;if(!f.parentNode)if(h)c.appendChild(f);else{var i=b?b():c.firstChild;i?c.insertBefore(f,i):c.appendChild(f)}this.renderers[g]=gantt._task_renderer(g,a.renderer,f,a.filter),this.tempCollection.splice(e,1),e--}},remove:function(a){this.renderers[a].unload(),delete this.renderers[a]},clear:function(){for(var a in this.renderers)this.renderers[a].unload();this.renderers={}}}}},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&gantt[f].call(gantt,b.id,b)!==!1)}return c}},gantt._add_generic_layer=function(a,b){return function(c){return void 0===c.filter&&(c.filter=gantt._create_filter(b)),c=gantt._layers.prepareConfig(c),a.add(c),c.id}},gantt._task_layers=gantt._layers.create(function(){return gantt.$task_data},function(){return gantt.$task_links}),gantt._link_layers=gantt._layers.create(function(){return gantt.$task_data}),gantt.addTaskLayer=gantt._add_generic_layer(gantt._task_layers,["_filter_task","_is_chart_visible"]),gantt.removeTaskLayer=function(a){gantt._task_layers.remove(a)},gantt.addLinkLayer=gantt._add_generic_layer(gantt._link_layers,["_filter_link","_is_chart_visible"]),gantt.removeLinkLayer=function(a){gantt._link_layers.remove(a)},gantt._get_task_renderers=function(){return this._task_layers.getRenderers()},gantt._get_link_renderers=function(){return this._link_layers.getRenderers()},gantt._pull={},gantt._branches={},gantt._order=[],gantt._lpull={},gantt._order_full=[],gantt.load=function(a,b,c){this._load_url=a,dhtmlx.assert(arguments.length,"Invalid load arguments"),this.callEvent("onLoadStart",[]);var d="json",e=null;arguments.length>=3?(d=b,e=c):"string"==typeof arguments[1]?d=arguments[1]:"function"==typeof arguments[1]&&(e=arguments[1]),this._load_type=d,dhx4.ajax.get(a,dhtmlx.bind(function(a){this.on_load(a,d),this.callEvent("onLoadEnd",[]),"function"==typeof e&&e.call(this)},this))},gantt.parse=function(a,b){this.on_load({xmlDoc:{responseText:a}},b)},gantt.serialize=function(a){return a=a||"json",this[a].serialize()},gantt.on_load=function(a,b){this.callEvent("onBeforeParse",[]),b||(b="json"),dhtmlx.assert(this[b],"Invalid data type:'"+b+"'");var c=a.xmlDoc.responseText,d=this[b].parse(c,a);this._process_loading(d)},gantt._process_loading=function(a){a.collections&&this._load_collections(a.collections);for(var b,c=a.data,d=0;d<c.length;d++)b=c[d],this._init_task(b),this.callEvent("onTaskLoading",[b])&&(this._order_full.push(b.id),this._pull[b.id]=b);for(var d in this._pull)b=this._pull[d],this.setParent(b,this.getParent(b)||this.config.root_id);for(var d=0;d<this._order_full.length;d++)b=this._pull[this._order_full[d]],this._add_branch(b),b.$level=this.calculateTaskLevel(b);if(this._sync_order(),this._init_links(a.links||(a.collections?a.collections.links:[])),this.callEvent("onParse",[]),this.render(),this.config.initial_scroll){var e=this._order[0]||this.config.root_id;e&&this.showTask(e)}},gantt._init_links=function(a){if(a)for(var b=0;b<a.length;b++)if(a[b]){var c=this._init_link(a[b]);this._lpull[c.id]=c}this._sync_links()},gantt._load_collections=function(a){var b=!1;for(var c in a)if(a.hasOwnProperty(c)){b=!0;var d=a[c],e=this.serverList[c];if(!e)continue;e.splice(0,e.length);for(var f=0;f<d.length;f++){var g=d[f],h=dhtmlx.copy(g);h.key=h.value;for(var i in g)if(g.hasOwnProperty(i)){if("value"==i||"label"==i)continue;h[i]=g[i]}e.push(h)}}b&&this.callEvent("onOptionsLoad",[])},gantt._sync_order=function(a){this._order=[],this._sync_order_item({parent:this.config.root_id,$open:!0,$ignore:!0,id:this.config.root_id}),a||(this._scroll_resize(),this._set_sizes())},gantt.attachEvent("onBeforeTaskDisplay",function(a,b){return!b.$ignore}),gantt._sync_order_item=function(a){if(a.id&&this._filter_task(a.id,a)&&this.callEvent("onBeforeTaskDisplay",[a.id,a])&&this._order.push(a.id),a.$open){var b=this.getChildren(a.id);if(b)for(var c=0;c<b.length;c++)this._sync_order_item(this._pull[b[c]])}},gantt.getTaskCount=function(){return this._order_full.length},gantt.getVisibleTaskCount=function(){return this._order.length},gantt.getTaskIndex=function(a){for(var b=this.getChildren(this.getParent(a)),c=0;c<b.length;c++)if(b[c]==a)return c;return-1},gantt.getGlobalTaskIndex=function(a){dhtmlx.assert(a,"Invalid argument");for(var b=this._order,c=0,d=b.length;d>c;c++)if(b[c]==a)return c;return-1},gantt._get_visible_order=gantt.getGlobalTaskIndex,gantt.eachTask=function(a,b,c){b=b||this.config.root_id,c=c||this;var d=this.getChildren(b);if(d)for(var e=0;e<d.length;e++){var f=this._pull[d[e]];a.call(c,f),this.hasChild(f.id)&&this.eachTask(a,f.id,c)}},gantt.json={parse:function(data){return dhtmlx.assert(data,"Invalid data"),"string"==typeof data&&(window.JSON?data=JSON.parse(data):(gantt._temp=eval("("+data+")"),data=gantt._temp||{},gantt._temp=null)),data.dhx_security&&(dhtmlx.security_key=data.dhx_security),data},_copyLink:function(a){var b={};for(var c in a)b[c]=a[c];return b},_copyObject:function(a){var b={};for(var c in a)"$"!=c.charAt(0)&&(b[c]=a[c],b[c]instanceof Date&&(b[c]=gantt.templates.xml_format(b[c])));return b},serialize:function(){var a=[],b=[];gantt.eachTask(function(b){gantt.resetProjectDates(b),a.push(this._copyObject(b))},gantt.config.root_id,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return{data:a,links:b}}},gantt.xml={_xmlNodeToJSON:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=a.attributes[d].value;if(!b){for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];1==e.nodeType&&(c[e.tagName]=e.firstChild?e.firstChild.nodeValue:"")}c.text||(c.text=a.firstChild?a.firstChild.nodeValue:"")}return c},_getCollections:function(a){for(var b={},c=dhx4.ajax.xpath("//coll_options",a),d=0;d<c.length;d++)for(var e=c[d].getAttribute("for"),f=b[e]=[],g=dhx4.ajax.xpath(".//item",c[d]),h=0;h<g.length;h++){for(var i=g[h],j=i.attributes,k={key:g[h].getAttribute("value"),label:g[h].getAttribute("label")},l=0;l<j.length;l++){var m=j[l];"value"!=m.nodeName&&"label"!=m.nodeName&&(k[m.nodeName]=m.nodeValue)}f.push(k)}return b},_getXML:function(a,b,c){c=c||"data",b.getXMLTopNode||(b=dhx4.ajax.parse(b));var d=dhx4.ajax.xmltop(c,b.xmlDoc);if(d.tagName!=c)throw"Invalid XML data";var e=d.getAttribute("dhx_security");return e&&(dhtmlx.security_key=e),d},parse:function(a,b){b=this._getXML(a,b);for(var c={},d=c.data=[],e=dhx4.ajax.xpath("//task",b),f=0;f<e.length;f++)d[f]=this._xmlNodeToJSON(e[f]);return c.collections=this._getCollections(b),c},_copyLink:function(a){return"<item id='"+a.id+"' source='"+a.source+"' target='"+a.target+"' type='"+a.type+"' />"},_copyObject:function(a){return"<task id='"+a.id+"' parent='"+(a.parent||"")+"' start_date='"+a.start_date+"' duration='"+a.duration+"' open='"+!!a.open+"' progress='"+a.progress+"' end_date='"+a.end_date+"'><![CDATA["+a.text+"]]></task>"},serialize:function(){for(var a=[],b=[],c=gantt.json.serialize(),d=0,e=c.data.length;e>d;d++)a.push(this._copyObject(c.data[d]));for(var d=0,e=c.links.length;e>d;d++)b.push(this._copyLink(c.links[d]));return"<data>"+a.join("")+"<coll_options for='links'>"+b.join("")+"</coll_options></data>"}},gantt.oldxml={parse:function(a,b){b=gantt.xml._getXML(a,b,"projects");for(var c={collections:{links:[]}},d=c.data=[],e=dhx4.ajax.xpath("//task",b),f=0;f<e.length;f++){d[f]=gantt.xml._xmlNodeToJSON(e[f]);var g=e[f].parentNode;d[f].parent="project"==g.tagName?"project-"+g.getAttribute("id"):g.parentNode.getAttribute("id")}e=dhx4.ajax.xpath("//project",b);for(var f=0;f<e.length;f++){var h=gantt.xml._xmlNodeToJSON(e[f],!0);h.id="project-"+h.id,d.push(h)}for(var f=0;f<d.length;f++){var h=d[f];h.start_date=h.startdate||h.est,h.end_date=h.enddate,h.text=h.name,h.duration=h.duration/8,h.open=1,h.duration||h.end_date||(h.duration=1),h.predecessortasks&&c.collections.links.push({target:h.id,source:h.predecessortasks,type:gantt.config.links.finish_to_start})}return c},serialize:function(){dhtmlx.message("Serialization to 'old XML' is not implemented")}},gantt.serverList=function(a,b){return b?this.serverList[a]=b.slice(0):this.serverList[a]||(this.serverList[a]=[]),this.serverList[a]},gantt._working_time_helper={units:["year","month","week","day","hour","minute"],hours:[8,17],dates:{0:!1,6:!1},_working_units_cache:{_cache:{},get:function(a,b){if(!a||!b)return-1;var c=this._cache,d=b.getTime(),e=-1;return c&&c[a]&&void 0!==c[a][d]&&(e=c[a][d]),e},put:function(a,b,c){if(!a||!b)return!1;var d=this._cache,e=b.getTime();return c=!!c,d?(d[a]||(d[a]={}),d[a][e]=c,!0):!1},clear:function(){this._cache={}}},_get_unit_order:function(a){for(var b=0,c=this.units.length;c>b;b++)if(this.units[b]==a)return b;dhtmlx.assert(!1,"Incorrect duration unit")},_timestamp:function(a){var b=null;return a.day||0===a.day?b=a.day:a.date&&(b=gantt.date.date_part(new Date(a.date)).valueOf()),b
},set_time:function(a){var b=void 0!==a.hours?a.hours:!0,c=this._timestamp(a);null!==c?this.dates[c]=b:this.hours=b,this._working_units_cache.clear()},unset_time:function(a){if(a){var b=this._timestamp(a);null!==b&&delete this.dates[b]}else this.hours=[];this._working_units_cache.clear()},is_working_unit:function(a,b,c){if(!gantt.config.work_time)return!0;var d=this._working_units_cache.get(b,a);return-1==d&&(d=this._check_is_working_unit(a,b,c),this._working_units_cache.put(b,a,d)),d},_check_is_working_unit:function(a,b,c){return void 0===c&&(c=this._get_unit_order(b)),void 0===c?!1:c&&!this.is_working_unit(a,this.units[c-1],c-1)?!1:this["is_work_"+b]?this["is_work_"+b](a):!0},is_work_day:function(a){var b=this.get_working_hours(a);return b instanceof Array?b.length>0:!1},is_work_hour:function(a){for(var b=this.get_working_hours(a),c=a.getHours(),d=0;d<b.length;d+=2){if(void 0===b[d+1])return b[d]==c;if(c>=b[d]&&c<b[d+1])return!0}return!1},get_working_hours:function(a){var b=this._timestamp({date:a}),c=!0;return void 0!==this.dates[b]?c=this.dates[b]:void 0!==this.dates[a.getDay()]&&(c=this.dates[a.getDay()]),c===!0?this.hours:c?c:[]},get_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1,g=0;e.valueOf()<f.valueOf();)this.is_working_unit(e,c)&&g++,e=gantt.date.add(e,d,c);return g},is_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1;e.valueOf()<f.valueOf();){if(this.is_working_unit(e,c))return!0;e=gantt.date.add(e,d,c)}return!1},add_worktime:function(a,b,c,d){if(!c)return!1;var e=new Date(a),f=0,d=d||1,b=1*b;if(gantt.config.work_time){for(;b>f;){var g=gantt.date.add(e,d,c);this.is_working_unit(d>0?e:g,c)&&f++,e=g}return e}return gantt.date.add(e,d*b,c)},get_closest_worktime:function(a){if(this.is_working_unit(a.date,a.unit))return a.date;var b=a.unit,c=gantt.date[b+"_start"](a.date),d=new Date(c),e=new Date(c),f=!0,g=3e3,h=0,i="any"==a.dir||!a.dir,j=1;for("past"==a.dir&&(j=-1);!this.is_working_unit(c,b);){i&&(c=f?d:e,j=-1*j);var k=c.getTimezoneOffset();if(c=gantt.date.add(c,j,b),c=gantt._correct_dst_change(c,k,j,b),gantt.date[b+"_start"]&&(c=gantt.date[b+"_start"](c)),i&&(f?d=c:e=c),f=!f,h++,h>g)return dhtmlx.assert(!1,"Invalid working time check"),!1}return(c==e||"past"==a.dir)&&(c=gantt.date.add(c,1,b)),c}},gantt.getTask=function(a){return dhtmlx.assert(a,"Invalid argument for gantt.getTask"),dhtmlx.assert(this._pull[a],"Task not found id="+a),this._pull[a]},gantt.getTaskByTime=function(a,b){var c=this._pull,d=[];if(a||b){a=+a||-1/0,b=+b||1/0;for(var e in c){var f=c[e];+f.start_date<b&&+f.end_date>a&&d.push(f)}}else for(var e in c)d.push(c[e]);return d},gantt.isTaskExists=function(a){return dhtmlx.defined(this._pull[a])},gantt.isUnscheduledTask=function(a){return!!a.unscheduled||!a.start_date},gantt._isAllowedUnscheduledTask=function(a){return a.unscheduled&&gantt.config.show_unscheduled},gantt.isTaskVisible=function(a){if(!this._pull[a])return!1;var b=this._pull[a];if(!(+b.start_date<+this._max_date&&+b.end_date>+this._min_date||gantt._isAllowedUnscheduledTask(b)))return!1;for(var c=0,d=this._order.length;d>c;c++)if(this._order[c]==a)return!0;return!1},gantt.updateTask=function(a,b){return dhtmlx.defined(b)||(b=this.getTask(a)),this.callEvent("onBeforeTaskUpdate",[a,b])===!1?!1:(this._pull[b.id]=b,this._is_parent_sync(b)||this._resync_parent(b),this._isAllowedUnscheduledTask(b)&&(this._init_task(b),this._sync_links()),this._update_parents(b.id),this.refreshTask(b.id),this.callEvent("onAfterTaskUpdate",[a,b]),this._sync_order(),void this._adjust_scales())},gantt._add_branch=function(a,b){var c=this.getParent(a);this.hasChild(c)||(this._branches[c]=[]);for(var d=this.getChildren(c),e=!1,f=0,g=d.length;g>f;f++)if(d[f]==a.id){e=!0;break}e||(1*b==b?d.splice(b,0,a.id):d.push(a.id)),this._sync_parent(a)},gantt._move_branch=function(a,b,c){this.setParent(a,c),this._sync_parent(a),this._replace_branch_child(b,a.id),this.isTaskExists(c)||c==this.config.root_id?this._add_branch(a):delete this._branches[a.id],a.$level=this.calculateTaskLevel(a),this._sync_order()},gantt._resync_parent=function(a){this._move_branch(a,a.$rendered_parent,this.getParent(a))},gantt._sync_parent=function(a){a.$rendered_parent=this.getParent(a)},gantt._is_parent_sync=function(a){return a.$rendered_parent==this.getParent(a)},gantt._replace_branch_child=function(a,b,c){var d=this.getChildren(a);if(d){for(var e=[],f=0;f<d.length;f++)d[f]!=b?e.push(d[f]):c&&e.push(c);this._branches[a]=e}this._sync_order()},gantt.addTask=function(a,b,c){return dhtmlx.defined(b)||(b=this.getParent(a)||0),this.isTaskExists(b)||(b=0),this.setParent(a,b),a=this._init_task(a),this.callEvent("onBeforeTaskAdd",[a.id,a])===!1?!1:(this._pull[a.id]=a,this._add_branch(a,c),this.refreshData(),this._adjust_scales(),this.callEvent("onAfterTaskAdd",[a.id,a]),a.id)},gantt._default_task_date=function(a,b){var c=b&&b!=this.config.root_id?this.getTask(b):!1,d="";if(c)d=c.start_date;else{var e=this._order[0];d=e?this.getTask(e).start_date?this.getTask(e).start_date:this.getTask(e).end_date?this.calculateEndDate(this.getTask(e).end_date,-this.config.duration_step):"":this.config.start_date||this.getState().min_date}return dhtmlx.assert(d,"Invalid dates"),new Date(d)},gantt._set_default_task_timing=function(a){a.start_date=a.start_date||gantt._default_task_date(a,this.getParent(a)),a.duration=a.duration||this.config.duration_step,a.end_date=a.end_date||this.calculateEndDate(a.start_date,a.duration)},gantt.createTask=function(a,b,c){if(a=a||{},a.id=dhtmlx.uid(),a.start_date||(a.start_date=gantt._default_task_date(a,b)),void 0===a.text&&(a.text=gantt.locale.labels.new_task),void 0===a.duration&&(a.duration=1),b){this.setParent(a,b);var d=this.getTask(b);d.$open=!0}return this.callEvent("onTaskCreated",[a])?(this.config.details_on_create?(a.$new=!0,this._pull[a.id]=this._init_task(a),this._add_branch(a,c),a.$level=this.calculateTaskLevel(a),this.selectTask(a.id),this.refreshData(),this.showLightbox(a.id)):this.addTask(a,b,c)&&(this.showTask(a.id),this.selectTask(a.id)),a.id):null},gantt.deleteTask=function(a){return this._deleteTask(a)},gantt._getChildLinks=function(a){var b=this.getTask(a);if(!b)return[];for(var c=b.$source.concat(b.$target),d=this.getChildren(b.id),e=0;e<d.length;e++)c=c.concat(this._getChildLinks(d[e]));for(var f={},e=0;e<c.length;e++)f[c[e]]=!0;c=[];for(var e in f)c.push(e);return c},gantt._getTaskTree=function(a){var b=this.getTask(a);if(!b)return[];for(var c=[],d=this.getChildren(b.id),e=0;e<d.length;e++)c.push(d[e]),c=c.concat(this._getTaskTree(d[e]));return c},gantt._deleteRelatedLinks=function(a,b){var c=this._dp&&!b,d="",e=c?"off"!=this._dp.updateMode:!1;c&&(d=this._dp.updateMode,this._dp.setUpdateMode("off"));for(var f=0;f<a.length;f++)c&&(this._dp.setGanttMode("links"),this._dp.setUpdated(a[f],!0,"deleted")),this._deleteLink(a[f],!0);c&&(this._dp.setUpdateMode(d),e&&this._dp.sendAllData())},gantt._deleteRelatedTasks=function(a,b){var c=this._dp&&!b,d="";c&&(d=this._dp.updateMode,this._dp.setGanttMode("tasks"),this._dp.setUpdateMode("off"));for(var e=this._getTaskTree(a),f=0;f<e.length;f++){var g=e[f];this._unset_task(g),c&&this._dp.setUpdated(g,!0,"deleted")}c&&this._dp.setUpdateMode(d)},gantt._unset_task=function(a){var b=this.getTask(a);this._update_flags(a,null),delete this._pull[a],this._move_branch(b,this.getParent(b),null)},gantt._deleteTask=function(a,b){var c=this.getTask(a);if(!b&&this.callEvent("onBeforeTaskDelete",[a,c])===!1)return!1;var d=gantt._getChildLinks(a);return this._deleteRelatedTasks(a,b),this._deleteRelatedLinks(d,b),this._unset_task(a),b||(this.callEvent("onAfterTaskDelete",[a,c]),this.refreshData()),!0},gantt.clearAll=function(){this._clear_data(),this.callEvent("onClear",[]),this.refreshData()},gantt._clear_data=function(){this._pull={},this._branches={},this._order=[],this._order_full=[],this._lpull={},this._update_flags(),this.userdata={}},gantt._update_flags=function(a,b){void 0===a?(this._lightbox_id=this._selected_task=null,this._tasks_dnd.drag&&(this._tasks_dnd.drag.id=null)):(this._lightbox_id==a&&(this._lightbox_id=b),this._selected_task==a&&(this._selected_task=b),this._tasks_dnd.drag&&this._tasks_dnd.drag.id==a&&(this._tasks_dnd.drag.id=b))},gantt.changeTaskId=function(a,b){var c=this._pull[b]=this._pull[a];this._pull[b].id=b,delete this._pull[a];for(var d in this._pull){var e=this._pull[d];this.getParent(e)==a&&this.setParent(e,b)}this._update_flags(a,b),this._replace_branch_child(this.getParent(c),a,b),this.callEvent("onTaskIdChange",[a,b])},gantt._get_duration_unit=function(){return 1e3*gantt._get_line(this.config.duration_unit)||this.config.duration_unit},gantt._get_safe_type=function(){return"task"},gantt._get_type_name=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return b;return"task"},gantt.getWorkHours=function(a){return this._working_time_helper.get_working_hours(a)},gantt.setWorkTime=function(a){this._working_time_helper.set_time(a)},gantt.isWorkTime=function(a,b){var c=this._working_time_helper;return c.is_working_unit(a,b||this.config.duration_unit)},gantt.correctTaskWorkTime=function(a){gantt.config.work_time&&gantt.config.correct_work_time&&(gantt.isWorkTime(a.start_date)?gantt.isWorkTime(new Date(+a.end_date-1))||(a.end_date=gantt.calculateEndDate(a.start_date,a.duration)):(a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}),a.end_date=gantt.calculateEndDate(a.start_date,a.duration)))},gantt.getClosestWorkTime=function(a){var b=this._working_time_helper;return a instanceof Date&&(a={date:a}),a.dir=a.dir||"any",a.unit=a.unit||this.config.duration_unit,b.get_closest_worktime(a)},gantt.calculateDuration=function(a,b){var c=this._working_time_helper;return c.get_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt._hasDuration=function(a,b){var c=this._working_time_helper;return c.is_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt.calculateEndDate=function(a,b,c){var d=this._working_time_helper,e=b>=0?1:-1;return d.add_worktime(a,Math.abs(b),c||this.config.duration_unit,e*this.config.duration_step)},gantt._init_task=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a.start_date&&(a.start_date=gantt.date.parseDate(a.start_date,"xml_date")),a.end_date&&(a.end_date=gantt.date.parseDate(a.end_date,"xml_date")),a.start_date?!a.end_date&&a.duration&&(a.end_date=this.calculateEndDate(a.start_date,a.duration)):a.end_date&&void 0!==a.duration&&(a.start_date=this.calculateEndDate(a.end_date,-a.duration)),this._isAllowedUnscheduledTask(a)&&this._set_default_task_timing(a),gantt._init_task_timing(a),a.start_date&&a.end_date&&gantt.correctTaskWorkTime(a),a.$source=[],a.$target=[],void 0===a.parent&&this.setParent(a,this.config.root_id),dhtmlx.defined(a.$open)||(a.$open=dhtmlx.defined(a.open)?a.open:this.config.open_tree_initially),a.$level=this.calculateTaskLevel(a),a},gantt._init_task_timing=function(a){var b=this._get_safe_type(a.type);void 0===a.$rendered_type?a.$rendered_type=b:a.$rendered_type!=b&&(delete a.$no_end,delete a.$no_start,a.$rendered_type=b),void 0!==a.$no_end&&void 0!==a.$no_start||b==this.config.types.milestone||(b==this.config.types.project?(a.$no_end=a.$no_start=!0,this._set_default_task_timing(a)):(a.$no_end=!(a.end_date||a.duration),a.$no_start=!a.start_date,this._isAllowedUnscheduledTask(a)&&(a.$no_end=a.$no_start=!1))),b==this.config.types.milestone&&(a.end_date=a.start_date),a.start_date&&a.end_date&&(a.duration=this.calculateDuration(a.start_date,a.end_date)),a.duration=a.duration||0},gantt._is_flex_task=function(a){return!(!a.$no_end&&!a.$no_start)},gantt.resetProjectDates=function(a){if(a.$no_end||a.$no_start){var b=this.getSubtaskDates(a.id);this._assign_project_dates(a,b.start_date,b.end_date)}},gantt.getSubtaskDates=function(a){var b=null,c=null,d=void 0!==a?a:gantt.config.root_id;return this.eachTask(function(a){this._get_safe_type(a.type)==gantt.config.types.project||this.isUnscheduledTask(a)||(a.start_date&&!a.$no_start&&(!b||b>a.start_date.valueOf())&&(b=a.start_date.valueOf()),a.end_date&&!a.$no_end&&(!c||c<a.end_date.valueOf())&&(c=a.end_date.valueOf()))},d),{start_date:b?new Date(b):null,end_date:c?new Date(c):null}},gantt._assign_project_dates=function(a,b,c){a.$no_start&&(a.start_date=b&&1/0!=b?new Date(b):this._default_task_date(a,this.getParent(a))),a.$no_end&&(a.end_date=c&&c!=-1/0?new Date(c):this.calculateEndDate(a.start_date,this.config.duration_step)),(a.$no_start||a.$no_end)&&this._init_task_timing(a)},gantt._update_parents=function(a,b){if(a){for(var c=this.getTask(a),d=this.getParent(c);!c.$no_end&&!c.$no_start&&d&&this.isTaskExists(d);)c=this.getTask(d),d=this.getParent(c);(c.$no_start||c.$no_end)&&(gantt.resetProjectDates(c),b||this.refreshTask(c.id,!0)),d&&this.isTaskExists(d)&&this._update_parents(d,b)}},gantt.isChildOf=function(a,b){if(!this.isTaskExists(a))return!1;if(b===this.config.root_id)return this.isTaskExists(a);for(var c=this.getTask(a),d=this.getParent(a);c&&this.isTaskExists(d);){if(c=this.getTask(d),c&&c.id==b)return!0;d=this.getParent(c)}return!1},gantt.roundDate=function(a){a instanceof Date&&(a={date:a,unit:gantt._tasks.unit,step:gantt._tasks.step});var b,c,d=a.date,e=a.step,f=a.unit;if(f==gantt._tasks.unit&&e==gantt._tasks.step&&+d>=+gantt._min_date&&+d<=+gantt._max_date){var g=Math.floor(gantt._day_index_by_date(d));c=new Date(gantt._tasks.trace_x[g]),b=new Date(c),gantt._tasks.trace_x[g+1]&&(b=new Date(gantt._tasks.trace_x[g+1]))}else{for(b=gantt.date[f+"_start"](new Date(this._min_date));+d>+b;){b=gantt.date[f+"_start"](gantt.date.add(b,e,f));var h=b.getTimezoneOffset();b=gantt.date.add(b,e,f),b=gantt._correct_dst_change(b,h,b,f),gantt.date[f+"_start"]&&(b=gantt.date[f+"_start"](b))}c=gantt.date.add(b,-1*e,f)}return a.dir&&"future"==a.dir?b:a.dir&&"past"==a.dir?c:Math.abs(d-c)<Math.abs(b-d)?c:b},gantt.attachEvent("onBeforeTaskUpdate",function(a,b){return gantt._init_task_timing(b),!0}),gantt.attachEvent("onBeforeTaskAdd",function(a,b){return gantt._init_task_timing(b),!0}),gantt.calculateTaskLevel=function(a){for(var b=0;this.getParent(a)&&this.isTaskExists(this.getParent(a));)a=this.getTask(this.getParent(a)),b++;return b},gantt.sort=function(a,b,c,d){var e=!d;this.isTaskExists(c)||(c=this.config.root_id),a||(a="order");var f="string"==typeof a?function(b,c){if(b[a]==c[a])return 0;var d=b[a]>c[a];return d?1:-1}:a;if(b){var g=f;f=function(a,b){return g(b,a)}}var h=this.getChildren(c);if(h){for(var i=[],j=h.length-1;j>=0;j--)i[j]=this._pull[h[j]];i.sort(f);for(var j=0;j<i.length;j++)h[j]=i[j].id,this.sort(a,b,h[j],!0)}e&&this.render()},gantt.getNext=function(a){for(var b=0;b<this._order.length-1;b++)if(this._order[b]==a)return this._order[b+1];return null},gantt.getPrev=function(a){for(var b=1;b<this._order.length;b++)if(this._order[b]==a)return this._order[b-1];return null},gantt._get_parent_id=function(a){var b=this.config.root_id;return a&&(b=a.parent),b},gantt.getParent=function(a){var b=null;return a.id?b=a:this.isTaskExists(a)&&(b=gantt.getTask(a)),this._get_parent_id(b)},gantt.setParent=function(a,b){a.parent=b},gantt.getSiblings=function(a){if(!this.isTaskExists(a))return[];var b=this.getParent(a);return this.getChildren(b)},gantt.getNextSibling=function(a){for(var b=this.getSiblings(a),c=0,d=b.length;d>c;c++)if(b[c]==a)return b[c+1]||null;return null},gantt.getPrevSibling=function(a){for(var b=this.getSiblings(a),c=0,d=b.length;d>c;c++)if(b[c]==a)return b[c-1]||null;return null},gantt._dp_init=function(a){a.setTransactionMode("POST",!0),a.serverProcessor+=(-1!=a.serverProcessor.indexOf("?")?"&":"?")+"editing=true",a._serverProcessor=a.serverProcessor,a.styles={updated:"gantt_updated",inserted:"gantt_inserted",deleted:"gantt_deleted",invalid:"gantt_invalid",error:"gantt_error",clear:""},a._methods=["_row_style","setCellTextStyle","_change_id","_delete_task"],a.setGanttMode=function(b){var c=a.modes||{};a._ganttMode&&(c[a._ganttMode]={_in_progress:a._in_progress,_invalid:a._invalid,updatedRows:a.updatedRows});var d=c[b];d||(d=c[b]={_in_progress:{},_invalid:{},updatedRows:[]}),a._in_progress=d._in_progress,a._invalid=d._invalid,a.updatedRows=d.updatedRows,a.modes=c,a._ganttMode=b},this._sendTaskOrder=function(b,c){c.$drop_target&&(a.setGanttMode("tasks"),this.getTask(b).target=c.$drop_target,a.setUpdated(b,!0,"order"),delete this.getTask(b).$drop_target)},this.attachEvent("onAfterTaskAdd",function(b){a.setGanttMode("tasks"),a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterTaskUpdate",function(b,c){a.setGanttMode("tasks"),a.setUpdated(b,!0),gantt._sendTaskOrder(b,c)}),this.attachEvent("onAfterTaskDelete",function(b){a.setGanttMode("tasks"),a.setUpdated(b,!0,"deleted"),"off"==a.updateMode||a._tSend||a.sendAllData()}),this.attachEvent("onAfterLinkUpdate",function(b){a.setGanttMode("links"),a.setUpdated(b,!0)}),this.attachEvent("onAfterLinkAdd",function(b){a.setGanttMode("links"),a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterLinkDelete",function(b){a.setGanttMode("links"),a.setUpdated(b,!0,"deleted")}),this.attachEvent("onRowDragEnd",function(a){gantt._sendTaskOrder(a,gantt.getTask(a))}),a.attachEvent("onBeforeDataSending",function(){var a=this._serverProcessor;if("REST"==this._tMode){var b=this._ganttMode.substr(0,this._ganttMode.length-1);a=a.substring(0,a.indexOf("?")>-1?a.indexOf("?"):a.length),this.serverProcessor=a+("/"==a.slice(-1)?"":"/")+b}else this.serverProcessor=a+window.dhtmlx.url(a)+"gantt_mode="+this._ganttMode;return!0}),this._init_dp_live_update_hooks(a);var b=a.afterUpdate;a.afterUpdate=function(){var c;c=3==arguments.length?arguments[1]:arguments[4];var d=a._ganttMode,e=c.filePath;d="REST"!=this._tMode?-1!=e.indexOf("gantt_mode=links")?"links":"tasks":e.indexOf("/link")>e.indexOf("/task")?"links":"tasks",a.setGanttMode(d);var f=b.apply(a,arguments);return a.setGanttMode(d),f},a._getRowData=dhtmlx.bind(function(b){var c;c="tasks"==a._ganttMode?this.isTaskExists(b)?this.getTask(b):{id:b}:this.isLinkExists(b)?this.getLink(b):{id:b},c=dhtmlx.copy(c);var d={};for(var e in c)if("$"!=e.substr(0,1)){var f=c[e];d[e]=f instanceof Date?this.templates.xml_format(f):null===f?"":f}return c.$no_start&&(c.start_date="",c.duration=""),c.$no_end&&(c.end_date="",c.duration=""),d[a.action_param]=this.getUserData(b,a.action_param),d},this),this._change_id=dhtmlx.bind(function(b,c){"tasks"!=a._ganttMode?this.changeLinkId(b,c):this.changeTaskId(b,c)},this),this._row_style=function(b,c){if("tasks"==a._ganttMode&&gantt.isTaskExists(b)){var d=gantt.getTask(b);d.$dataprocessor_class=c,gantt.refreshTask(b)}},this._delete_task=function(){},this._dp=a,gantt._patch_dhx4_ajax()},gantt._patch_dhx4_ajax=function(){var a=parseInt((dhx4.version||"").split(".").join(""),10);413>=a&&(window.dhx4.ajax._call=function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==d&&(h.onreadystatechange=function(){if(4==h.readyState||1==i&&3==h.readyState){if((200!=h.status||""==h.responseText)&&!dhx4.callEvent("onAjaxError",[h]))return;window.setTimeout(function(){"function"==typeof e&&e.apply(window,[{xmlDoc:h,filePath:b}]),null!=f&&("undefined"!=typeof f.postData?dhx4.ajax.postLong(f.url,f.postData,e):dhx4.ajax.getLong(f.url,e)),e=null,h=null},1)}}),"GET"==a&&1!=this.cache&&(b+=(b.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),h.open(a,b,d),g)for(var j in g)h.setRequestHeader(j,g[j]);else"POST"==a.toUpperCase()||"PUT"==a||"DELETE"==a?h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==a&&(c=null);return h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c),d?void 0:{xmlDoc:h,filePath:b}}),gantt._patch_dhx4_ajax=function(){}},gantt.getUserData=function(a,b){return this.userdata||(this.userdata={}),this.userdata[a]&&this.userdata[a][b]?this.userdata[a][b]:""},gantt.setUserData=function(a,b,c){this.userdata||(this.userdata={}),this.userdata[a]||(this.userdata[a]={}),this.userdata[a][b]=c},gantt._init_link=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a},gantt._sync_links=function(){for(var a in this._pull)this._pull[a].$source=[],this._pull[a].$target=[];for(var a in this._lpull){var b=this._lpull[a];this._pull[b.source]&&this._pull[b.source].$source.push(a),this._pull[b.target]&&this._pull[b.target].$target.push(a)}},gantt.getLink=function(a){return dhtmlx.assert(this._lpull[a],"Link doesn't exist"),this._lpull[a]},gantt.getLinks=function(){var a=[];for(var b in gantt._lpull)a.push(gantt._lpull[b]);return a},gantt.isLinkExists=function(a){return dhtmlx.defined(this._lpull[a])},gantt.addLink=function(a){return a=this._init_link(a),this.callEvent("onBeforeLinkAdd",[a.id,a])===!1?!1:(this._lpull[a.id]=a,this._sync_links(),this._render_link(a.id),this.callEvent("onAfterLinkAdd",[a.id,a]),a.id)},gantt.updateLink=function(a,b){return dhtmlx.defined(b)||(b=this.getLink(a)),this.callEvent("onBeforeLinkUpdate",[a,b])===!1?!1:(this._lpull[a]=b,this._sync_links(),this._render_link(a),this.callEvent("onAfterLinkUpdate",[a,b]),!0)},gantt.deleteLink=function(a){return this._deleteLink(a)},gantt._deleteLink=function(a,b){var c=this.getLink(a);return b||this.callEvent("onBeforeLinkDelete",[a,c])!==!1?(delete this._lpull[a],this._sync_links(),this.refreshLink(a),b||this.callEvent("onAfterLinkDelete",[a,c]),!0):!1},gantt.changeLinkId=function(a,b){this._lpull[b]=this._lpull[a],this._lpull[b].id=b,delete this._lpull[a],this._sync_links(),this.callEvent("onLinkIdChange",[a,b])},gantt.getChildren=function(a){return dhtmlx.defined(this._branches[a])?this._branches[a]:[]},gantt.hasChild=function(a){return dhtmlx.defined(this._branches[a])&&this._branches[a].length},gantt.refreshData=function(){this._render_data()},gantt._configure=function(a,b,c){for(var d in b)("undefined"==typeof a[d]||c)&&(a[d]=b[d])},gantt._init_skin=function(){gantt._get_skin(!1),gantt._init_skin=function(){}},gantt._get_skin=function(a){if(!gantt.skin||a)for(var b=document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c].href.match("dhtmlxgantt_([a-z]+).css");if(d){gantt.skin=d[1];break}}gantt.skin||(gantt.skin="terrace");var e=gantt.skins[gantt.skin];this._configure(gantt.config,e.config,a);var f=gantt.getGridColumns();f[1]&&"undefined"==typeof f[1].width&&(f[1].width=e._second_column_width),f[2]&&"undefined"==typeof f[2].width&&(f[2].width=e._third_column_width),e._lightbox_template&&(gantt._lightbox_template=e._lightbox_template),gantt.resetLightbox()},gantt.resetSkin=function(){this.skin="",this._get_skin(!0)},gantt.skins={},gantt._lightbox_methods={},gantt._lightbox_template="<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>",gantt.showLightbox=function(a){if(a&&!gantt._is_readonly(this.getTask(a))&&this.callEvent("onBeforeLightbox",[a])){var b=this.getTask(a),c=this.getLightbox(this._get_safe_type(b.type));this._center_lightbox(c),this.showCover(),this._fill_lightbox(a,c),this.callEvent("onLightbox",[a])}},gantt._get_timepicker_step=function(){if(this.config.round_dnd_dates){var a=gantt._tasks,b=this._get_line(a.unit)*a.step/60;return(b>=1440||!this._is_chart_visible())&&(b=this.config.time_step),b}return this.config.time_step},gantt.getLabel=function(a,b){for(var c=this._get_typed_lightbox_config(),d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""},gantt.updateCollection=function(a,b){b=b.slice(0);var c=gantt.serverList(a);return c?(c.splice(0,c.length),c.push.apply(c,b||[]),void gantt.resetLightbox()):!1},gantt.getLightboxType=function(){return this._get_safe_type(this._lightbox_type)},gantt.getLightbox=function(a){if(void 0===a&&(a=this.getLightboxType()),!this._lightbox||this.getLightboxType()!=this._get_safe_type(a)){this._lightbox_type=this._get_safe_type(a);var b=document.createElement("DIV");b.className="gantt_cal_light";var c=this._is_lightbox_timepicker();(gantt.config.wide_form||c)&&(b.className+=" gantt_cal_light_wide"),c&&(gantt.config.wide_form=!0,b.className+=" gantt_cal_light_full"),b.style.visibility="hidden";for(var d=this._lightbox_template,e=this.config.buttons_left,f=0;f<e.length;f++){var g=this.config._migrate_buttons[e[f]]?this.config._migrate_buttons[e[f]]:e[f];d+="<div class='gantt_btn_set gantt_left_btn_set "+g+"_set'><div dhx_button='1' class='"+g+"'></div><div>"+this.locale.labels[g]+"</div></div>"}e=this.config.buttons_right;for(var f=0;f<e.length;f++){var g=this.config._migrate_buttons[e[f]]?this.config._migrate_buttons[e[f]]:e[f];d+="<div class='gantt_btn_set gantt_right_btn_set "+g+"_set' style='float:right;'><div dhx_button='1' class='"+g+"'></div><div>"+this.locale.labels[g]+"</div></div>"}d+="</div>",b.innerHTML=d,gantt.config.drag_lightbox&&(b.firstChild.onmousedown=gantt._ready_to_dnd,b.firstChild.onselectstart=function(){return!1},b.firstChild.style.cursor="pointer",gantt._init_dnd_events()),document.body.insertBefore(b,document.body.firstChild),this._lightbox=b;var h=this._get_typed_lightbox_config(a);d=this._render_sections(h);for(var i=b.getElementsByTagName("div"),f=0;f<i.length;f++){var j=i[f];if("gantt_cal_larea"==j.className){j.innerHTML=d;break}}this.resizeLightbox(),this._init_lightbox_events(this),b.style.display="none",b.style.visibility="visible"}return this._lightbox},gantt._render_sections=function(a){for(var b="",c=0;c<a.length;c++){var d=this.form_blocks[a[c].type];if(d){a[c].id="area_"+dhtmlx.uid();var e=a[c].hidden?" style='display:none'":"",f="";a[c].button&&(f="<div class='gantt_custom_button' index='"+c+"'><div class='gantt_custom_button_"+a[c].button+"'></div><div>"+this.locale.labels["button_"+a[c].button]+"</div></div>"),this.config.wide_form&&(b+="<div class='gantt_wrap_section' "+e+">"),b+="<div id='"+a[c].id+"' class='gantt_cal_lsection'>"+f+this.locale.labels["section_"+a[c].name]+"</div>"+d.render.call(this,a[c]),b+="</div>"}}return b},gantt.resizeLightbox=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px",b.style.height=b.scrollHeight+"px",a.style.height=b.scrollHeight+this.config.lightbox_additional_height+"px",b.style.height=b.scrollHeight+"px"}},gantt._center_lightbox=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px",a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+(document.body.offsetWidth-a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}},gantt.showCover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="gantt_cal_cover";var a=void 0!==document.height?document.height:document.body.offsetHeight,b=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(a,b)+"px",document.body.appendChild(this._cover)}},gantt._init_lightbox_events=function(){gantt.lightbox_events={},gantt.lightbox_events.gantt_save_btn=function(){gantt._save_lightbox()},gantt.lightbox_events.gantt_delete_btn=function(){gantt.callEvent("onLightboxDelete",[gantt._lightbox_id])&&(gantt.isTaskExists(gantt._lightbox_id)?gantt.$click.buttons["delete"](gantt._lightbox_id):gantt.hideLightbox())},gantt.lightbox_events.gantt_cancel_btn=function(){gantt._cancel_lightbox()},gantt.lightbox_events["default"]=function(a,b){if(b.getAttribute("dhx_button"))gantt.callEvent("onLightboxButton",[b.className,b,a]);else{var c,d,e,f=gantt._getClassName(b);-1!=f.indexOf("gantt_custom_button")&&(-1!=f.indexOf("gantt_custom_button_")?(c=b.parentNode.getAttribute("index"),e=b.parentNode.parentNode):(c=b.getAttribute("index"),e=b.parentNode,b=b.firstChild));var g=gantt._get_typed_lightbox_config();c&&(d=gantt.form_blocks[g[c].type],d.button_click(c,b,e,e.nextSibling))}},dhtmlxEvent(gantt.getLightbox(),"click",function(a){a=a||window.event;var b=a.target?a.target:a.srcElement,c=gantt._getClassName(b);if(c||(b=b.previousSibling,c=gantt._getClassName(b)),b&&c&&0===c.indexOf("gantt_btn_set")&&(b=b.firstChild,c=gantt._getClassName(b)),b&&c){var d=dhtmlx.defined(gantt.lightbox_events[b.className])?gantt.lightbox_events[b.className]:gantt.lightbox_events["default"];return d(a,b)}return!1}),gantt.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case gantt.keys.edit_save:if((a||event).shiftKey)return;gantt._save_lightbox();break;case gantt.keys.edit_cancel:gantt._cancel_lightbox()}}},gantt._cancel_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxCancel",[this._lightbox_id,a.$new]),gantt.isTaskExists(a.id)&&a.$new&&this._deleteTask(a.id,!0),this.refreshData(),this.hideLightbox()},gantt._save_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxSave",[this._lightbox_id,a,!!a.$new])&&(a.$new?(delete a.$new,this.addTask(a)):this.isTaskExists(a.id)&&(dhtmlx.mixin(this.getTask(a.id),a,!0),this.updateTask(a.id)),this.refreshData(),this.hideLightbox())},gantt._resolve_default_mapping=function(a){var b=a.map_to,c={time:!0,time_optional:!0,duration:!0,duration_optional:!0};return c[a.type]&&("auto"==a.map_to?b={start_date:"start_date",end_date:"end_date",duration:"duration"}:"string"==typeof a.map_to&&(b={start_date:a.map_to})),b},gantt.getLightboxValues=function(){var a={};gantt.isTaskExists(this._lightbox_id)&&(a=dhtmlx.mixin({},this.getTask(this._lightbox_id)));for(var b=this._get_typed_lightbox_config(),c=0;c<b.length;c++){var d=document.getElementById(b[c].id);d=d?d.nextSibling:d;var e=this.form_blocks[b[c].type];if(e){var f=e.get_value.call(this,d,a,b[c]),g=gantt._resolve_default_mapping(b[c]);if("string"==typeof g&&"auto"!=g)a[g]=f;else if("object"==typeof g)for(var h in g)g[h]&&(a[g[h]]=f[h])}}return a},gantt.hideLightbox=function(){var a=this.getLightbox();a&&(a.style.display="none"),this._lightbox_id=null,this.hideCover(),this.callEvent("onAfterLightbox",[])},gantt.hideCover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},gantt.resetLightbox=function(){gantt._lightbox&&!gantt._custom_lightbox&&gantt._lightbox.parentNode.removeChild(gantt._lightbox),gantt._lightbox=null},gantt._set_lightbox_values=function(a,b){var c=a,d=b.getElementsByTagName("span");gantt.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=gantt.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.task_time(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.task_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var e=this._get_typed_lightbox_config(this.getLightboxType()),f=0;f<e.length;f++){var g=e[f];if(this.form_blocks[g.type]){var h=document.getElementById(g.id).nextSibling,i=this.form_blocks[g.type],j=gantt._resolve_default_mapping(e[f]),k=dhtmlx.defined(c[j])?c[j]:g.default_value;i.set_value.call(gantt,h,k,c,g),g.focus&&i.focus.call(gantt,h)}}a.id&&(gantt._lightbox_id=a.id)},gantt._fill_lightbox=function(a,b){var c=this.getTask(a);this._set_lightbox_values(c,b)},gantt.getLightboxSection=function(a){var b=this._get_typed_lightbox_config(),c=0;for(c;c<b.length&&b[c].name!=a;c++);var d=b[c];if(!d)return null;this._lightbox||this.getLightbox();var e=document.getElementById(d.id),f=e.nextSibling,g={section:d,header:e,node:f,getValue:function(a){return gantt.form_blocks[d.type].get_value.call(gantt,f,a||{},d)},setValue:function(a,b){return gantt.form_blocks[d.type].set_value.call(gantt,f,a,b||{},d)}},h=this._lightbox_methods["get_"+d.type+"_control"];return h?h(g):g
},gantt._lightbox_methods.get_template_control=function(a){return a.control=a.node,a},gantt._lightbox_methods.get_select_control=function(a){return a.control=a.node.getElementsByTagName("select")[0],a},gantt._lightbox_methods.get_textarea_control=function(a){return a.control=a.node.getElementsByTagName("textarea")[0],a},gantt._lightbox_methods.get_time_control=function(a){return a.control=a.node.getElementsByTagName("select"),a},gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd),dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd),gantt._init_dnd_events=function(){}},gantt._move_while_dnd=function(a){if(gantt._dnd_start_lb){document.gantt_unselectable||(document.body.className+=" gantt_unselectable",document.gantt_unselectable=!0);var b=gantt.getLightbox(),c=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=gantt._lb_start[1]+c[1]-gantt._dnd_start_lb[1]+"px",b.style.left=gantt._lb_start[0]+c[0]-gantt._dnd_start_lb[0]+"px"}},gantt._ready_to_dnd=function(a){var b=gantt.getLightbox();gantt._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)],gantt._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]},gantt._finish_dnd=function(){gantt._lb_start&&(gantt._lb_start=gantt._dnd_start_lb=!1,document.body.className=document.body.className.replace(" gantt_unselectable",""),document.gantt_unselectable=!1)},gantt._focus=function(a,b){if(a&&a.focus)if(gantt.config.touch);else try{b&&a.select&&a.select(),a.focus()}catch(c){}},gantt.form_blocks={getTimePicker:function(a,b){var c=a.time_format;if(!c){var c=["%d","%m","%Y"];gantt._get_line(gantt._tasks.unit)<gantt._get_line("day")&&c.push("%H:%i")}a._time_format_order={size:0};var d=this.config,e=this.date.date_part(new Date(gantt._min_date.valueOf())),f=1440,g=0;gantt.config.limit_time_select&&(f=60*d.last_hour+1,g=60*d.first_hour,e.setHours(d.first_hour));for(var h="",i=0;i<c.length;i++){var j=c[i];i>0&&(h+=" ");var k="";switch(j){case"%Y":a._time_format_order[2]=i,a._time_format_order.size++;var l,m,n,o;a.year_range&&(isNaN(a.year_range)?a.year_range.push&&(n=a.year_range[0],o=a.year_range[1]):l=a.year_range),l=l||10,m=m||Math.floor(l/2),n=n||e.getFullYear()-m,o=o||n+l;for(var p=n;o>p;p++)k+="<option value='"+p+"'>"+p+"</option>";break;case"%m":a._time_format_order[1]=i,a._time_format_order.size++;for(var p=0;12>p;p++)k+="<option value='"+p+"'>"+this.locale.date.month_full[p]+"</option>";break;case"%d":a._time_format_order[0]=i,a._time_format_order.size++;for(var p=1;32>p;p++)k+="<option value='"+p+"'>"+p+"</option>";break;case"%H:%i":a._time_format_order[3]=i,a._time_format_order.size++;var p=g,q=e.getDate();for(a._time_values=[];f>p;){var r=this.templates.time_picker(e);k+="<option value='"+p+"'>"+r+"</option>",a._time_values.push(p),e.setTime(e.valueOf()+60*this._get_timepicker_step()*1e3);var s=e.getDate()!=q?1:0;p=24*s*60+60*e.getHours()+e.getMinutes()}}if(k){var t=a.readonly?"disabled='disabled'":"",u=b?" style='display:none'":"";h+="<select "+t+u+">"+k+"</select>"}}return h},_fill_lightbox_select:function(a,b,c,d){if(a[b+d[0]].value=c.getDate(),a[b+d[1]].value=c.getMonth(),a[b+d[2]].value=c.getFullYear(),dhtmlx.defined(d[3])){var e=60*c.getHours()+c.getMinutes();e=Math.round(e/gantt._get_timepicker_step())*gantt._get_timepicker_step();var f=a[b+d[3]];f.value=e,f.setAttribute("data-value",e)}},template:{render:function(a){var b=(a.height||"30")+"px";return"<div class='gantt_cal_ltext gantt_cal_template' style='height:"+b+";'></div>"},set_value:function(a,b){a.innerHTML=b||""},get_value:function(a){return a.innerHTML||""},focus:function(){}},textarea:{render:function(a){var b=(a.height||"130")+"px";return"<div class='gantt_cal_ltext' style='height:"+b+";'><textarea></textarea></div>"},set_value:function(a,b){a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},select:{render:function(a){for(var b=(a.height||"23")+"px",c="<div class='gantt_cal_ltext' style='height:"+b+";'><select style='width:100%;'>",d=0;d<a.options.length;d++)c+="<option value='"+a.options[d].key+"'>"+a.options[d].label+"</option>";return c+="</select></div>"},set_value:function(a,b,c,d){var e=a.firstChild;!e._dhx_onchange&&d.onchange&&(e.onchange=d.onchange,e._dhx_onchange=!0),"undefined"==typeof b&&(b=(e.options[0]||{}).value),e.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},time:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a),c=["<div style='height:"+(a.height||30)+"px;padding-top:0px;font-size:inherit;text-align:center;' class='gantt_section_time'>"];return c.push(b),a.single_date?(b=this.form_blocks.getTimePicker.call(this,a,!0),c.push("<span></span>")):c.push("<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"),c.push(b),c.push("</div>"),c.join("")},set_value:function(a,b,c,d){{var e=d,f=a.getElementsByTagName("select"),g=d._time_format_order;d._time_format_size}if(e.auto_end_date)for(var h=function(){k=new Date(f[g[2]].value,f[g[1]].value,f[g[0]].value,0,0),l=gantt.calculateEndDate(k,1),this.form_blocks._fill_lightbox_select(f,g.size,l,g,e)},i=0;4>i;i++)f[i].onchange=h;var j=gantt._resolve_default_mapping(d);"string"==typeof j&&(j={start_date:j});var k=c[j.start_date]||new Date,l=c[j.end_date]||gantt.calculateEndDate(k,1);this.form_blocks._fill_lightbox_select(f,0,k,g,e),this.form_blocks._fill_lightbox_select(f,g.size,l,g,e)},get_value:function(a,b,c){var d=a.getElementsByTagName("select"),e=c._time_format_order,f=0,g=0;if(dhtmlx.defined(e[3])){var h=parseInt(d[e[3]].value,10);f=Math.floor(h/60),g=h%60}var i=new Date(d[e[2]].value,d[e[1]].value,d[e[0]].value,f,g);if(f=g=0,dhtmlx.defined(e[3])){var h=parseInt(d[e.size+e[3]].value,10);f=Math.floor(h/60),g=h%60}var j=new Date(d[e[2]+e.size].value,d[e[1]+e.size].value,d[e[0]+e.size].value,f,g);i>=j&&(j=gantt.date.add(i,gantt._get_timepicker_step(),"minute"));var k=gantt._resolve_default_mapping(c),l={start_date:new Date(i),end_date:new Date(j)};return"string"==typeof k?l.start_date:l},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},duration:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a);b="<div class='gantt_time_selects'>"+b+"</div>";var c=this.locale.labels[this.config.duration_unit+"s"],d=a.single_date?' style="display:none"':"",e=a.readonly?" disabled='disabled'":"",f="<div class='gantt_duration' "+d+"><input type='button' class='gantt_duration_dec' value='-'"+e+"><input type='text' value='5' class='gantt_duration_value'"+e+"><input type='button' class='gantt_duration_inc' value='+'"+e+"> "+c+" <span></span></div>",g="<div style='height:"+(a.height||30)+"px;padding-top:0px;font-size:inherit;' class='gantt_section_time'>"+b+" "+f+"</div>";return g},set_value:function(a,b,c,d){function e(){var b=gantt.form_blocks.duration._get_start_date.call(gantt,a,d),c=gantt.form_blocks.duration._get_duration.call(gantt,a,d),e=gantt.calculateEndDate(b,c);l.innerHTML=gantt.templates.task_date(e)}function f(a){var b=j.value;b=parseInt(b,10),window.isNaN(b)&&(b=0),b+=a,1>b&&(b=1),j.value=b,e()}var g=d,h=a.getElementsByTagName("select"),i=a.getElementsByTagName("input"),j=i[1],k=[i[0],i[2]],l=a.getElementsByTagName("span")[0],m=d._time_format_order;k[0].onclick=dhtmlx.bind(function(){f(-1*this.config.duration_step)},this),k[1].onclick=dhtmlx.bind(function(){f(1*this.config.duration_step)},this),h[0].onchange=e,h[1].onchange=e,h[2].onchange=e,h[3]&&(h[3].onchange=e),j.onkeydown=dhtmlx.bind(function(a){a=a||window.event;var b=a.charCode||a.keyCode||a.which;return 40==b?(f(-1*this.config.duration_step),!1):38==b?(f(1*this.config.duration_step),!1):void window.setTimeout(function(){e()},1)},this),j.onchange=dhtmlx.bind(function(){e()},this);var n=gantt._resolve_default_mapping(d);"string"==typeof n&&(n={start_date:n});var o=c[n.start_date]||new Date,p=c[n.end_date]||gantt.calculateEndDate(o,1),q=Math.round(c[n.duration])||gantt.calculateDuration(o,p);gantt.form_blocks._fill_lightbox_select(h,0,o,m,g),j.value=q,e()},_get_start_date:function(a,b){var c=a.getElementsByTagName("select"),d=b._time_format_order,e=0,f=0;if(dhtmlx.defined(d[3])){var g=c[d[3]],h=parseInt(g.value,10);isNaN(h)&&g.hasAttribute("data-value")&&(h=parseInt(g.getAttribute("data-value"),10)),e=Math.floor(h/60),f=h%60}return new Date(c[d[2]].value,c[d[1]].value,c[d[0]].value,e,f)},_get_duration:function(a){var b=a.getElementsByTagName("input")[1];return b=parseInt(b.value,10),(!b||window.isNaN(b))&&(b=1),0>b&&(b*=-1),b},get_value:function(a,b,c){var d=gantt.form_blocks.duration._get_start_date(a,c),e=gantt.form_blocks.duration._get_duration(a,c),f=gantt.calculateEndDate(d,e),g=gantt._resolve_default_mapping(c),h={start_date:new Date(d),end_date:new Date(f),duration:e};return"string"==typeof g?h.start_date:h},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},parent:{_filter:function(a,b,c){var d=b.filter||function(){return!0};a=a.slice(0);for(var e=0;e<a.length;e++){var f=a[e];(f.id==c||gantt.isChildOf(f.id,c)||d(f.id,f)===!1)&&(a.splice(e,1),e--)}return a},_display:function(a,b){var c=[],d=[];b&&(c=gantt.getTaskByTime(),a.allow_root&&c.unshift({id:gantt.config.root_id,text:a.root_label||""}),c=this._filter(c,a,b),a.sort&&c.sort(a.sort));for(var e=a.template||gantt.templates.task_text,f=0;f<c.length;f++){var g=e.apply(gantt,[c[f].start_date,c[f].end_date,c[f]]);void 0===g&&(g=""),d.push({key:c[f].id,label:g})}return a.options=d,a.map_to=a.map_to||"parent",gantt.form_blocks.select.render.apply(this,arguments)},render:function(a){return gantt.form_blocks.parent._display(a,!1)},set_value:function(a,b,c,d){var e=document.createElement("div");e.innerHTML=gantt.form_blocks.parent._display(d,c.id);var f=e.removeChild(e.firstChild);return a.onselect=null,a.parentNode.replaceChild(f,a),gantt.form_blocks.select.set_value.apply(gantt,[f,b,c,d])},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(gantt,arguments)}}},gantt._is_lightbox_timepicker=function(){for(var a=this._get_typed_lightbox_config(),b=0;b<a.length;b++)if("time"==a[b].name&&"time"==a[b].type)return!0;return!1},gantt._dhtmlx_confirm=function(a,b,c,d){if(!a)return c();var e={text:a};b&&(e.title=b),d&&(e.ok=d),c&&(e.callback=function(a){a&&c()}),dhtmlx.confirm(e)},gantt._get_typed_lightbox_config=function(a){void 0===a&&(a=this.getLightboxType());var b=this._get_type_name(a);return gantt.config.lightbox[b+"_sections"]?gantt.config.lightbox[b+"_sections"]:gantt.config.lightbox.sections},gantt._silent_redraw_lightbox=function(a){var b=this.getLightboxType();if(this.getState().lightbox){var c=this.getState().lightbox,d=this.getLightboxValues(),e=dhtmlx.copy(this.getTask(c));this.resetLightbox();var f=dhtmlx.mixin(e,d,!0),g=this.getLightbox(a?a:void 0);this._center_lightbox(this.getLightbox()),this._set_lightbox_values(f,g)}else this.resetLightbox(),this.getLightbox(a?a:void 0);this.callEvent("onLightboxChange",[b,this.getLightboxType()])},gantt._extend_to_optional=function(a){var b=a,c={render:b.render,focus:b.focus,set_value:function(a,d,e,f){var g=gantt._resolve_default_mapping(f);if(!e[g.start_date]||"start_date"==g.start_date&&this._isAllowedUnscheduledTask(e)){c.disable(a,f);var h={};for(var i in g)h[g[i]]=e[i];return b.set_value.call(gantt,a,d,h,f)}return c.enable(a,f),b.set_value.call(gantt,a,d,e,f)},get_value:function(a,c,d){return d.disabled?{start_date:null}:b.get_value.call(gantt,a,c,d)},update_block:function(a,b){if(gantt.callEvent("onSectionToggle",[gantt._lightbox_id,b]),a.style.display=b.disabled?"none":"block",b.button){var c=a.previousSibling.firstChild.firstChild,d=gantt.locale.labels,e=b.disabled?d[b.name+"_enable_button"]:d[b.name+"_disable_button"];c.nextSibling.innerHTML=e}gantt.resizeLightbox()},disable:function(a,b){b.disabled=!0,c.update_block(a,b)},enable:function(a,b){b.disabled=!1,c.update_block(a,b)},button_click:function(a,b,d,e){if(gantt.callEvent("onSectionButton",[gantt._lightbox_id,d])!==!1){var f=gantt._get_typed_lightbox_config()[a];f.disabled?c.enable(e,f):c.disable(e,f)}}};return c},gantt.form_blocks.duration_optional=gantt._extend_to_optional(gantt.form_blocks.duration),gantt.form_blocks.time_optional=gantt._extend_to_optional(gantt.form_blocks.time),gantt._init_dp_live_update_hooks=function(a){a.attachEvent("insertCallback",gantt._insert_callback),a.attachEvent("updateCallback",gantt._update_callback),a.attachEvent("deleteCallback",gantt._delete_callback)},gantt._update_callback=function(a,b){var c=a.data||gantt.xml._xmlNodeToJSON(a.firstChild);if(gantt.isTaskExists(b)){var d=gantt.getTask(b);for(var e in c){var f=c[e];switch(e){case"id":continue;case"start_date":case"end_date":f=gantt.templates.xml_date(f);break;case"duration":d.end_date=gantt.calculateEndDate(d.start_date,f)}d[e]=f}gantt.updateTask(b),gantt.refreshData()}},gantt._insert_callback=function(a,b,c,d){var e=a.data||gantt.xml._xmlNodeToJSON(a.firstChild),f={add:gantt.addTask,isExist:gantt.isTaskExists};"links"==d&&(f.add=gantt.addLink,f.isExist=gantt.isLinkExists),f.isExist.call(gantt,b)||(e.id=b,f.add.call(gantt,e))},gantt._delete_callback=function(a,b,c,d){var e={"delete":gantt.deleteTask,isExist:gantt.isTaskExists};"links"==d&&(e["delete"]=gantt.deleteLink,e.isExist=gantt.isLinkExists),e.isExist.call(gantt,b)&&e["delete"].call(gantt,b)},gantt._get_safe_type=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return a;return gantt.config.types.task},gantt.form_blocks.typeselect={render:function(a){var b=gantt.config.types,c=gantt.locale.labels,d=[],e=a.filter||function(){return!0};for(var f in b)!e(f,b[f])==!1&&d.push({key:b[f],label:c["type_"+f]});a.options=d;var g=a.onchange;return a.onchange=function(){gantt.getState().lightbox;gantt.changeLightboxType(this.value),"function"==typeof g&&g.apply(this,arguments)},gantt.form_blocks.select.render.apply(gantt,arguments)},set_value:function(){return gantt.form_blocks.select.set_value.apply(gantt,arguments)},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(this,arguments)}},function(){function a(){return gantt._cached_functions.update_if_changed(gantt),gantt._cached_functions.active||gantt._cached_functions.activate(),!0}gantt._cached_functions={cache:{},mode:!1,critical_path_mode:!1,wrap_methods:function(a,b){if(b._prefetch_originals)for(var c in b._prefetch_originals)b[c]=b._prefetch_originals[c];b._prefetch_originals={};for(var c=0;c<a.length;c++)this.prefetch(a[c],b)},prefetch:function(a,b){var c=b[a];if(c){var d=this;b._prefetch_originals[a]=c,b[a]=function(){if(d.active){var b=d.get_arguments_hash(Array.prototype.slice.call(arguments));d.cache[a]||(d.cache[a]={});var e=d.cache[a];if(d.has_cached_value(e,b))return d.get_cached_value(e,b);var f=c.apply(this,arguments);return d.cache_value(e,b,f),f}return c.apply(this,arguments)}}return c},cache_value:function(a,b,c){this.is_date(c)&&(c=new Date(c)),a[b]=c},has_cached_value:function(a,b){return a.hasOwnProperty(b)},get_cached_value:function(a,b){var c=a[b];return this.is_date(c)&&(c=new Date(c)),c},is_date:function(a){return a&&a.getUTCDate},get_arguments_hash:function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.stringify_argument(a[c]));return"("+b.join(";")+")"},stringify_argument:function(a){var b="";return b=a.id?a.id:this.is_date(a)?a.valueOf():a,b+""},activate:function(){this.clear(),this.active=!0},deactivate:function(){this.clear(),this.active=!1},clear:function(){this.cache={}},setup:function(a){var b=[],c=["isCriticalTask","isCriticalLink","_isProjectEnd","_getProjectEnd"];"auto"==this.mode?a.config.highlight_critical_path&&(b=c):this.mode===!0&&(b=c),this.wrap_methods(b,a)},update_if_changed:function(a){var b=this.critical_path_mode!=a.config.highlight_critical_path||this.mode!==a.config.optimize_render;b&&(this.critical_path_mode=a.config.highlight_critical_path,this.mode=a.config.optimize_render,this.setup(a))}},gantt.attachEvent("onBeforeGanttRender",a),gantt.attachEvent("onBeforeDataRender",a),gantt.attachEvent("onBeforeParse",a),gantt.attachEvent("onDataRender",function(){gantt._cached_functions.deactivate()}),gantt.attachEvent("onBeforeGanttReady",function(){return gantt._cached_functions.update_if_changed(gantt),!0})}(),dhtmlx.assert=function(a,b){a||gantt.config.show_errors&&gantt.callEvent("onError",[b])!==!1&&dhtmlx.message({type:"error",text:b,expire:-1})},gantt.init=function(a,b,c){this.callEvent("onBeforeGanttReady",[]),b&&c&&(this.config.start_date=this._min_date=new Date(b),this.config.end_date=this._max_date=new Date(c)),this._init_skin(),this.date.init(),this.config.scroll_size||(this.config.scroll_size=this._detectScrollSize()),dhtmlxEvent(window,"resize",this._on_resize),this.init=function(a){this.$container&&this.$container.parentNode&&(this.$container.parentNode.removeChild(this.$container),this.$container=null),this._reinit(a)},this._reinit(a)},gantt._reinit=function(a){this._init_html_area(a),this._set_sizes(),this._clear_renderers(),this.resetLightbox(),this._update_flags(),this._init_touch_events(),this._init_templates(),this._init_grid(),this._init_tasks(),this._set_scroll_events(),dhtmlxEvent(this.$container,"click",this._on_click),dhtmlxEvent(this.$container,"dblclick",this._on_dblclick),dhtmlxEvent(this.$container,"mousemove",this._on_mousemove),dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu),this.callEvent("onGanttReady",[]),this.render()},gantt._init_html_area=function(a){this._obj="string"==typeof a?document.getElementById(a):a,window.gantt!==gantt&&(this._obj.gantt=gantt),dhtmlx.assert(this._obj,"Invalid html container: "+a);var b="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div>";b+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>",this._obj.innerHTML=b,this.$container=this._obj.firstChild;var c=this.$container.childNodes;this.$grid=c[0],this.$task=c[1],this.$scroll_ver=c[2],this.$scroll_hor=c[3],this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>",this.$grid_scale=this.$grid.childNodes[0],this.$grid_data=this.$grid.childNodes[1],this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>",this.$task_scale=this.$task.childNodes[0],this.$task_data=this.$task.childNodes[1],this.$task_bg=this.$task_data.childNodes[0],this.$task_links=this.$task_data.childNodes[1],this.$task_bars=this.$task_data.childNodes[2]},gantt.$click={buttons:{edit:function(a){gantt.showLightbox(a)},"delete":function(a){var b=gantt.locale.labels.confirm_deleting,c=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(b,c,function(){var b=gantt.getTask(a);b.$new?(gantt._deleteTask(a,!0),gantt.refreshData()):gantt.deleteTask(a),gantt.hideLightbox()})}}},gantt._calculate_content_height=function(){var a=this.config.scale_height,b=this._order.length*this.config.row_height,c=this._scroll_hor?this.config.scroll_size+1:0;return this._is_grid_visible()||this._is_chart_visible()?a+b+2+c:0},gantt._calculate_content_width=function(){{var a=this._get_grid_width(),b=this._tasks?this._tasks.full_width:0;this._scroll_ver?this.config.scroll_size+1:0}return this._is_chart_visible()||(b=0),this._is_grid_visible()||(a=0),a+b+1},gantt._get_resize_options=function(){var a={x:!1,y:!1};return"xy"==this.config.autosize?a.x=a.y=!0:"y"==this.config.autosize||this.config.autosize===!0?a.y=!0:"x"==this.config.autosize&&(a.x=!0),a},gantt._clean_el_size=function(a){return 1*(a||"").toString().replace("px","")||0},gantt._get_box_styles=function(){var a=null;a=window.getComputedStyle?window.getComputedStyle(this._obj,null):{width:this._obj.clientWidth,height:this._obj.clientHeight};var b=["width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],c={boxSizing:"border-box"==a.boxSizing};a.MozBoxSizing&&(c.boxSizing="border-box"==a.MozBoxSizing);for(var d=0;d<b.length;d++)c[b[d]]=a[b[d]]?this._clean_el_size(a[b[d]]):0;var e={horPaddings:c.paddingLeft+c.paddingRight+c.borderLeftWidth+c.borderRightWidth,vertPaddings:c.paddingTop+c.paddingBottom+c.borderTopWidth+c.borderBottomWidth,borderBox:c.boxSizing,innerWidth:c.width,innerHeight:c.height,outerWidth:c.width,outerHeight:c.height};return e.borderBox?(e.innerWidth-=e.horPaddings,e.innerHeight-=e.vertPaddings):(e.outerWidth+=e.horPaddings,e.outerHeight+=e.vertPaddings),e},gantt._do_autosize=function(){var a=this._get_resize_options(),b=this._get_box_styles();if(a.y){var c=this._calculate_content_height();b.borderBox&&(c+=b.vertPaddings),this._obj.style.height=c+"px"}if(a.x){var d=this._calculate_content_width();b.borderBox&&(d+=b.horPaddings),this._obj.style.width=d+"px"}},gantt._set_sizes=function(){this._do_autosize();var a=this._get_box_styles();if(this._y=a.innerHeight,!(this._y<20)){this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";var b=Math.max(this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2,0);this.$grid_data.style.height=this.$task_data.style.height=b+"px";var c=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=c+"px",this.$grid.style.display=0===c?"none":"",a=this._get_box_styles(),this._x=a.innerWidth,this._x<20||(this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px",this.$task.style.width=Math.max(this._x-this._get_grid_width()-2,0)+"px")}},gantt.getScrollState=function(){return this.$task&&this.$task_data?{x:this.$task.scrollLeft,y:this.$task_data.scrollTop}:null},gantt._save_scroll_state=function(a,b){var c={};this._cached_scroll_pos=this._cached_scroll_pos||{},void 0!==a&&(c.x=Math.max(a,0)),void 0!==b&&(c.y=Math.max(b,0)),dhtmlx.mixin(this._cached_scroll_pos,c,!0)},gantt._restore_scroll_state=function(){return this._cached_scroll_pos||null},gantt.scrollTo=function(a,b){1*a==a&&(this.$task.scrollLeft=a,this._save_scroll_state(a,void 0)),1*b==b&&(this.$task_data.scrollTop=b,this.$grid_data.scrollTop=b,this._save_scroll_state(void 0,b));var c=gantt._restore_scroll_state()||{x:0,y:0};this.callEvent("onGanttScroll",[c.x,c.y])},gantt.showDate=function(a){var b=this.posFromDate(a),c=Math.max(b-this.config.task_scroll_offset,0);this.scrollTo(c)},gantt.showTask=function(a){var b=this.getTaskNode(a);if(b){var c=Math.max(b.offsetLeft-this.config.task_scroll_offset,0),d=b.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this.scrollTo(c,d)}},gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes(),gantt._scroll_resize()},gantt.render=function(){if(this._is_render_active()){this.callEvent("onBeforeGanttRender",[]);var a=dhtmlx.copy(this._restore_scroll_state()),b=null;if(a&&(b=gantt.dateFromPos(a.x+this.config.task_scroll_offset)),this._render_grid(),this._render_tasks_scales(),this._scroll_resize(),this._on_resize(),this._render_data(),this.config.preserve_scroll&&a){var c=gantt._restore_scroll_state(),d=gantt.dateFromPos(c.x);(+b!=+d||c.y!=a.y)&&(b&&this.showDate(b),gantt.scrollTo(void 0,a.y))}this.callEvent("onGanttRender",[])}},gantt._set_scroll_events=function(){function a(a){var c=gantt._get_resize_options();gantt._wheel_time=new Date;var d=b?-20*a.deltaX:2*a.wheelDeltaX,e=b?-40*a.deltaY:a.wheelDelta;if(d&&Math.abs(d)>Math.abs(e)){if(c.x)return!0;var f=d/-40,g=gantt.$task.scrollLeft+30*f;gantt.scrollTo(g,null),gantt.$scroll_hor.scrollTop=h}else{if(c.y)return!0;var f=e/-40;"undefined"==typeof e&&(f=a.detail);var h=gantt.$scroll_ver.scrollTop+30*f;if(!gantt.config.prevent_default_scroll&&gantt._cached_scroll_pos&&gantt._cached_scroll_pos.y==h)return!0;gantt.scrollTo(null,h),gantt.$scroll_ver.scrollTop=h}return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(new Date-(gantt._wheel_time||0)<100)return!0;if(!gantt._touch_scroll_active){var a=gantt.$scroll_hor.scrollLeft;gantt.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=a,gantt.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=gantt.$task.scrollLeft,b=gantt.$scroll_hor.scrollLeft;b!=a&&(gantt.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=gantt.$task_data.scrollTop,b=gantt.$scroll_ver.scrollTop;b!=a&&(gantt.$scroll_ver.scrollTop=a)});var b=_isFF&&!window._KHTMLrv;b?dhtmlxEvent(gantt.$container,"wheel",a):dhtmlxEvent(gantt.$container,"mousewheel",a)},gantt._scroll_resize=function(){if(!(this._x<20||this._y<20)){var a=this._get_grid_width(),b=Math.max(this._x-a,0),c=Math.max(this._y-this.config.scale_height,0),d=this.config.scroll_size+1,e=Math.max(this.$task_data.offsetWidth-d,0),f=this.config.row_height*this._order.length,g=this._get_resize_options(),h=this._scroll_hor=g.x?!1:e>b,i=this._scroll_ver=g.y?!1:f>c,h=h?"block":"none";this.$scroll_hor.style&&this.$scroll_hor.style&&this.$scroll_hor.firstChild&&this.$scroll_ver.firstChild&&(this.$scroll_hor.style.display=h?"block":"none",this.$scroll_hor.style.height=(h?8:0)+"px",this.$scroll_hor.style.width=Math.max(this._x-(i?d:2),0)+"px",this.$scroll_hor.firstChild.style.width=e+a+d+2+"px",this.$scroll_ver.style.display=i?"block":"none",this.$scroll_ver.style.width=(i?8:0)+"px",this.$scroll_ver.style.height=Math.max(this._y-(h?d:0)-this.config.scale_height,0)+"px",this.$scroll_ver.style.top=this.config.scale_height+"px",this.$scroll_ver.firstChild.style.height=this.config.scale_height+f+"px")}},gantt._getClassName=function(a){if(!a)return"";var b=a.className||"";return b.baseVal&&(b=b.baseVal),b.indexOf||(b=""),gantt._trim(b)},gantt.locate=function(a){var b=gantt._get_target_node(a),c=gantt._getClassName(b);if((c||"").indexOf("gantt_task_cell")>=0)return null;for(var d=arguments[1]||this.config.task_attribute;b;){if(b.getAttribute){var e=b.getAttribute(d);if(e)return e}b=b.parentNode}return null},gantt._get_target_node=function(a){var b;return a.tagName?b=a:(a=a||window.event,b=a.target||a.srcElement),b},gantt._trim=function(a){var b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};return b.apply(a)},gantt._locate_css=function(a,b,c){void 0===c&&(c=!0);for(var d=gantt._get_target_node(a),e="";d;){if(e=gantt._getClassName(d)){var f=e.indexOf(b);if(f>=0){if(!c)return d;var g=0===f||!gantt._trim(e.charAt(f-1)),h=f+b.length>=e.length||!gantt._trim(e.charAt(f+b.length));if(g&&h)return d}}d=d.parentNode}return null},gantt._locateHTML=function(a,b){var c=gantt._get_target_node(a);for(b=b||this.config.task_attribute;c;){if(c.getAttribute){var d=c.getAttribute(b);if(d)return c}c=c.parentNode}return null},gantt.getTaskRowNode=function(a){for(var b=this.$grid_data.childNodes,c=this.config.task_attribute,d=0;d<b.length;d++)if(b[d].getAttribute){var e=b[d].getAttribute(c);if(e==a)return b[d]}return null},gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:new Date(this._min_date),max_date:new Date(this._max_date),lightbox:this._lightbox_id,touch_drag:this._touch_drag}},gantt._checkTimeout=function(a,b){if(!b)return!0;var c=1e3/b;return 1>c?!0:a._on_timeout?!1:(setTimeout(function(){delete a._on_timeout},c),a._on_timeout=!0,!0)},gantt.selectTask=function(a){if(!this.config.select_task)return!1;if(a){if(this._selected_task==a)return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[a]))return!1;this.unselectTask(),this._selected_task=a,this.refreshTask(a),this.callEvent("onTaskSelected",[a])}return this._selected_task},gantt.unselectTask=function(a){var a=a||this._selected_task;a&&(this._selected_task=null,this.refreshTask(a),this.callEvent("onTaskUnselected",[a]))},gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null},gantt.changeLightboxType=function(a){return this.getLightboxType()==a?!0:void gantt._silent_redraw_lightbox(a)},gantt._is_render_active=function(){return!this._skip_render},gantt._correct_dst_change=function(a,b,c,d){var e=gantt._get_line(d)*c;if(e>3600&&86400>e){var f=a.getTimezoneOffset()-b;f&&(a=gantt.date.add(a,f,"minute"))}return a},gantt.batchUpdate=function(a){var b,c=this._dp&&"off"!=this._dp.updateMode;c&&(b=this._dp.updateMode,this._dp.setUpdateMode("off")),this._skip_render=!0;try{a()}catch(d){}this._skip_render=!1,this.render(),c&&(this._dp.setUpdateMode(b),this._dp.sendData())},gantt.date={init:function(){for(var a=gantt.locale.date.month_short,b=gantt.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;for(var a=gantt.locale.date.month_full,b=gantt.locale.date.month_full_hash={},c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){var b=new Date(a);return a.setHours(0),this.hour_start(a),a.getHours()&&(a.getDate()<b.getDate()||a.getMonth()<b.getMonth()||a.getFullYear()<b.getFullYear())&&a.setTime(a.getTime()+36e5*(24-a.getHours())),a},time_part:function(a){return(a.valueOf()/1e3-60*a.getTimezoneOffset())%86400},week_start:function(a){var b=a.getDay();return gantt.config.start_on_monday&&(0===b?b=6:b--),this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){return a.setDate(1),this.date_part(a)},year_start:function(a){return a.setMonth(0),this.month_start(a)},day_start:function(a){return this.date_part(a)},hour_start:function(a){return a.getMinutes()&&a.setMinutes(0),this.minute_start(a),a},minute_start:function(a){return a.getSeconds()&&a.setSeconds(0),a.getMilliseconds()&&a.setMilliseconds(0),a},_add_days:function(a,b){var c=new Date(a.valueOf());return c.setDate(c.getDate()+b),b>=0&&!a.getHours()&&c.getHours()&&(c.getDate()<=a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case"day":d=gantt.date._add_days(d,b);break;case"week":d=gantt.date._add_days(d,7*b);break;case"month":d.setMonth(d.getMonth()+b);break;case"year":d.setYear(d.getFullYear()+b);break;case"hour":d.setTime(d.getTime()+60*b*60*1e3);break;case"minute":d.setTime(d.getTime()+60*b*1e3);break;default:return gantt.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return 10>a?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){return a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return'"+gantt.date.to_fixed(date.getDate())+"';case"%m":return'"+gantt.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+gantt.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+gantt.locale.date.day_short[date.getDay()]+"';case"%l":return'"+gantt.locale.date.day_full[date.getDay()]+"';case"%M":return'"+gantt.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+gantt.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+gantt.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+gantt.date.to_fixed(date.getHours())+"';case"%i":return'"+gantt.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+gantt.date.to_fixed(date.getSeconds())+"';case"%W":return'"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+"';default:return a}}),b&&(a=a.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case"%j":case"%d":c+="set[2]=temp["+e+"]||1;";
break;case"%n":case"%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case"%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":c+="set[3]=temp["+e+"]||0;";break;case"%i":c+="set[4]=temp["+e+"]||0;";break;case"%Y":c+="set[0]=temp["+e+"]||0;";break;case"%a":case"%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":c+="set[5]=temp["+e+"]||0;";break;case"%M":c+="set[1]=gantt.locale.date.month_short_hash[temp["+e+"]]||0;";break;case"%F":c+="set[1]=gantt.locale.date.month_full_hash[temp["+e+"]]||0;"}var f="set[0],set[1],set[2],set[3],set[4],set[5]";return b&&(f=" Date.UTC("+f+")"),new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+f+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();0===b&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));var d=c.getFullYear(),e=Math.round((c.getTime()-new Date(d,0,1).getTime())/864e5),f=1+Math.floor(e/7);return f},getUTCISOWeek:function(a){return this.getISOWeek(a)},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())},parseDate:function(a,b){return"string"==typeof a&&(dhtmlx.defined(b)&&(b="string"==typeof b?dhtmlx.defined(gantt.templates[b])?gantt.templates[b]:gantt.date.str_to_date(b):gantt.templates.xml_date),a=a?b(a):null),a}},gantt.date.quarter_start=function(a){gantt.date.month_start(a);var b,c=a.getMonth();return b=c>=9?9:c>=6?6:c>=3?3:0,a.setMonth(b),a},gantt.date.add_quarter=function(a,b){return gantt.date.add(a,3*b,"month")},gantt.config||(gantt.config={}),gantt.config||(gantt.config={}),gantt.templates||(gantt.templates={}),function(){dhtmlx.mixin(gantt.config,{links:{finish_to_start:"0",start_to_start:"1",finish_to_finish:"2",start_to_finish:"3"},types:{task:"task",project:"project",milestone:"milestone"},duration_unit:"day",work_time:!1,correct_work_time:!1,skip_off_time:!1,autosize:!1,autosize_min_width:0,show_links:!0,show_task_cells:!0,static_background:!1,branch_loading:!1,show_loading:!1,show_chart:!0,show_grid:!0,min_duration:36e5,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:!0,server_utc:!1,show_progress:!0,fit_tasks:!1,select_task:!0,scroll_on_click:!0,preserve_scroll:!0,readonly:!1,date_grid:"%Y-%m-%d",drag_links:!0,drag_progress:!0,drag_resize:!0,drag_move:!0,drag_mode:{resize:"resize",progress:"progress",move:"move",ignore:"ignore"},round_dnd_dates:!0,link_wrapper_width:20,root_id:0,autofit:!1,columns:[{name:"text",tree:!0,width:"*",resize:!0},{name:"start_date",align:"center",resize:!0},{name:"duration",align:"center"},{name:"add",width:"44"}],step:1,scale_unit:"day",scale_offset_minimal:!0,subscales:[],inherit_scale_class:!1,time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",layer_attribute:"data-layer",buttons_left:["gantt_save_btn","gantt_cancel_btn"],_migrate_buttons:{dhx_save_btn:"gantt_save_btn",dhx_cancel_btn:"gantt_cancel_btn",dhx_delete_btn:"gantt_delete_btn"},buttons_right:["gantt_delete_btn"],lightbox:{sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"time",type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",readonly:!0,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",single_date:!0,map_to:"auto"}]},drag_lightbox:!0,sort:!1,details_on_create:!0,details_on_dblclick:!0,initial_scroll:!0,task_scroll_offset:100,order_branch:!1,order_branch_free:!1,task_height:"full",min_column_width:70,min_grid_column_width:70,grid_resizer_column_attribute:"column_index",grid_resizer_attribute:"grid_resizer",keep_grid_width:!1,grid_resize:!1,show_unscheduled:!0,readonly_property:"readonly",editable_property:"editable",type_renderers:{},open_tree_initially:!1,optimize_render:"auto",prevent_default_scroll:!1,show_errors:!0}),gantt.keys={edit_save:13,edit_cancel:27},gantt._init_template=function(a,b,c){var d=this._reg_templates||{};c=c||a,this.config[a]&&d[c]!=this.config[a]&&(b&&this.templates[c]||(this.templates[c]=this.date.date_to_str(this.config[a]),d[c]=this.config[a])),this._reg_templates=d},gantt._init_templates=function(){var a=gantt.locale.labels;a.gantt_save_btn=a.icon_save,a.gantt_cancel_btn=a.icon_cancel,a.gantt_delete_btn=a.icon_delete;var b=this.date.date_to_str,c=this.config;gantt._init_template("date_scale",!0),gantt._init_template("date_grid",!0,"grid_date_format"),gantt._init_template("task_date",!0),dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(c.xml_date,c.server_utc),xml_format:b(c.xml_date,c.server_utc),api_date:this.date.str_to_date(c.api_date),progress_text:function(){return""},grid_header_class:function(){return""},task_text:function(a,b,c){return c.text},task_class:function(){return""},grid_row_class:function(){return""},task_row_class:function(){return""},task_cell_class:function(){return""},scale_cell_class:function(){return""},scale_row_class:function(){return""},grid_indent:function(){return"<div class='gantt_tree_indent'></div>"},grid_folder:function(a){return"<div class='gantt_tree_icon gantt_folder_"+(a.$open?"open":"closed")+"'></div>"},grid_file:function(){return"<div class='gantt_tree_icon gantt_file'></div>"},grid_open:function(a){return"<div class='gantt_tree_icon gantt_"+(a.$open?"close":"open")+"'></div>"},grid_blank:function(){return"<div class='gantt_tree_icon gantt_blank'></div>"},date_grid:function(a,b){return b&&gantt.isUnscheduledTask(b)&&gantt.config.show_unscheduled?gantt.templates.task_unscheduled_time(b):gantt.templates.grid_date_format(a)},task_time:function(a,b,c){return gantt.isUnscheduledTask(c)&&gantt.config.show_unscheduled?gantt.templates.task_unscheduled_time(c):gantt.templates.task_date(a)+" - "+gantt.templates.task_date(b)},task_unscheduled_time:function(){return""},time_picker:b(c.time_picker),link_class:function(){return""},link_description:function(a){var b=gantt.getTask(a.source),c=gantt.getTask(a.target);return"<b>"+b.text+"</b> &ndash;  <b>"+c.text+"</b>"},drag_link:function(a,b,c,d){a=gantt.getTask(a);var e=gantt.locale.labels,f="<b>"+a.text+"</b> "+(b?e.link_start:e.link_end)+"<br/>";return c&&(c=gantt.getTask(c),f+="<b> "+c.text+"</b> "+(d?e.link_start:e.link_end)+"<br/>"),f},drag_link_class:function(a,b,c,d){var e="";if(a&&c){var f=gantt.isLinkAllowed(a,c,b,d);e=" "+(f?"gantt_link_allow":"gantt_link_deny")}return"gantt_link_tooltip"+e}}),this.callEvent("onTemplatesReady",[])}}(),window.jQuery&&!function(a){var b=[];a.fn.dhx_gantt=function(c){if(c=c||{},"string"!=typeof c){var d=[];return this.each(function(){if(this&&this.getAttribute)if(this.gantt)d.push("object"==typeof this.gantt?this.gantt:window.gantt);else{var a=window.gantt.$container?Gantt.getGanttInstance():window.gantt;for(var b in c)"data"!=b&&(a.config[b]=c[b]);a.init(this),c.data&&a.parse(c.data),d.push(a)}}),1===d.length?d[0]:d}return b[c]?b[c].apply(this,[]):void a.error("Method "+c+" does not exist on jQuery.dhx_gantt")}}(jQuery),window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b){var c=document.createElement("DIV");c.id="gantt_"+dhtmlx.uid(),c.style.width="100%",c.style.height="100%",c.cmp="grid",document.body.appendChild(c),this.attachObject(c.id);var d=this.vs[this.av];d.grid=gantt,gantt.init(c.id,a,b),c.firstChild.style.border="none",d.gridId=c.id,d.gridObj=c;var e="_viewRestore";return this.vs[this[e]()].grid}),gantt.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{new_task:"New task",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Task will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80},gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80},gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70},gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{gantt_delete_btn:"icon_delete",gantt_save_btn:"icon_save"}},gantt.config.touch_drag=500,gantt.config.touch=!0,gantt.config.touch_feedback=!0,gantt._touch_feedback=function(){gantt.config.touch_feedback&&navigator.vibrate&&navigator.vibrate(1)},gantt._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||a.pointerType==a.MSPOINTER_TYPE_MOUSE}):this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&a.touches.length>1?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,clientX:a.touches[0].clientX,clientY:a.touches[0].clientY}:a},function(){return!1}))},gantt._touch_events=function(a,b,c){function d(a){return a&&a.preventDefault&&a.preventDefault(),(a||event).cancelBubble=!0,!1}function e(a){var b=gantt._task_area_pulls,c=gantt.getTask(a);if(c&&gantt.isTaskVisible(a))for(var d in b)if(c=b[d][a],c&&c.getAttribute("task_id")&&c.getAttribute("task_id")==a){var e=c.cloneNode(!0);return l=c,b[d][a]=e,c.style.display="none",e.className+=" gantt_drag_move ",c.parentNode.appendChild(e),e}}var f,g=0,h=!1,i=!1,j=null,k=null,l=null;this._gantt_touch_event_ready||(this._gantt_touch_event_ready=1,dhtmlxEvent(gantt.$container,a[0],function(a){if(!c(a)&&h){k&&clearTimeout(k);var e=b(a);if(gantt._tasks_dnd.drag.id||gantt._tasks_dnd.drag.start_drag)return gantt._tasks_dnd.on_mouse_move(e),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1;if(e&&j){var l=j.pageX-e.pageX,m=j.pageY-e.pageY;if(!i&&(Math.abs(l)>5||Math.abs(m)>5)&&(gantt._touch_scroll_active=i=!0,g=0,f=gantt.getScrollState()),i){gantt.scrollTo(f.x+l,f.y+m);var n=gantt.getScrollState();if(f.x!=n.x&&m>2*l||f.y!=n.y&&l>2*m)return d(a)}}return d(a)}})),dhtmlxEvent(this.$container,"contextmenu",function(a){return h?d(a):void 0}),dhtmlxEvent(this.$container,a[1],function(a){if(!c(a)){if(a.touches&&a.touches.length>1)return void(h=!1);if(h=!0,j=b(a),j&&g){var f=new Date;500>f-g?(gantt._on_dblclick(j),d(a)):g=f}else g=new Date;k=setTimeout(function(){var a=gantt.locate(j);!a||gantt._locate_css(j,"gantt_link_control")||gantt._locate_css(j,"gantt_grid_data")||(gantt._tasks_dnd.on_mouse_down(j),gantt._tasks_dnd.drag&&gantt._tasks_dnd.drag.start_drag&&(e(a),gantt._tasks_dnd._start_dnd(j),gantt._touch_drag=!0,gantt.refreshTask(a),gantt._touch_feedback())),k=null},gantt.config.touch_drag)}}),dhtmlxEvent(this.$container,a[2],function(a){if(!c(a)){k&&clearTimeout(k),gantt._touch_drag=!1,h=!1;var d=b(a);gantt._tasks_dnd.on_mouse_up(d),l&&(gantt.refreshTask(gantt.locate(l)),l.parentNode&&(l.parentNode.removeChild(l),gantt._touch_feedback())),gantt._touch_scroll_active=h=i=!1,l=null}})};for(var i=0;i<Gantt._ganttPlugin.length;i++)Gantt._ganttPlugin[i](gantt);return gantt._internal_id=Gantt._seed++,Gantt.$syncFactory&&Gantt.$syncFactory(gantt),gantt},window.gantt=Gantt.getGanttInstance(),dhtmlx&&(dhtmlx.attaches=dhtmlx.attaches||[],dhtmlx.attaches.attachGantt=function(a,b,c){var d=document.createElement("DIV");return d.id="dhxSchedObj_"+this._genStr(12),d.style.cssText="width:100%; height:100%;",document.body.appendChild(d),this.attachObject(d.id,!1,!0),c=c||(window.gantt.$container?Gantt.getGanttInstance():window.gantt),this.vs[this.av].sched=c,this.vs[this.av].schedId=d.id,c.destructor=function(){},c.init(d.id,a,b),this.vs[this._viewRestore()].sched}),define("gantt",function(a){return function(){var b;return b||a.gantt}}(this)),Gantt.plugin(function(a){a._markers||(a._markers={}),a.config.show_markers=!0,a.attachEvent("onClear",function(){a._markers={}}),a.attachEvent("onGanttReady",function(){function b(b){if(!a.config.show_markers)return!1;if(!b.start_date)return!1;var c=a.getState();if(!(+b.start_date>+c.max_date||+b.end_date&&+b.end_date<+c.min_date||+b.start_date<+c.min_date)){var d=document.createElement("div");d.setAttribute("marker_id",b.id);var e="gantt_marker";a.templates.marker_class&&(e+=" "+a.templates.marker_class(b)),b.css&&(e+=" "+b.css),b.title&&(d.title=b.title),d.className=e;var f=a.posFromDate(b.start_date);if(d.style.left=f+"px",d.style.height=Math.max(a._y_from_ind(a._order.length),0)+"px",b.end_date){var g=a.posFromDate(b.end_date);d.style.width=Math.max(g-f,0)+"px"}return b.text&&(d.innerHTML="<div class='gantt_marker_content' >"+b.text+"</div>"),d}}var c=document.createElement("div");c.className="gantt_marker_area",a.$task_data.appendChild(c),a.$marker_area=c,a._markerRenderer=a._task_renderer("markers",b,a.$marker_area,null)}),a.attachEvent("onDataRender",function(){a.renderMarkers()}),a.getMarker=function(a){return this._markers?this._markers[a]:null},a.addMarker=function(a){return a.id=a.id||dhtmlx.uid(),this._markers[a.id]=a,a.id},a.deleteMarker=function(a){return this._markers&&this._markers[a]?(delete this._markers[a],!0):!1},a.updateMarker=function(a){this._markerRenderer&&this._markerRenderer.render_item(a)},a.renderMarkers=function(){if(!this._markers)return!1;if(!this._markerRenderer)return!1;var a=[];for(var b in this._markers)a.push(this._markers[b]);return this._markerRenderer.render_items(a),!0}}),define("ganttMarker",function(){}),Gantt.plugin(function(a){a._tooltip={},a._tooltip_class="gantt_tooltip",a.config.tooltip_timeout=30,a.config.tooltip_offset_y=20,a.config.tooltip_offset_x=10,a._create_tooltip=function(){return this._tooltip_html||(this._tooltip_html=document.createElement("div"),this._tooltip_html.className=a._tooltip_class),this._tooltip_html},a._is_cursor_under_tooltip=function(a,b){return a.x>=b.pos.x&&a.x<=b.pos.x+b.width?!0:a.y>=b.pos.y&&a.y<=b.pos.y+b.height?!0:!1},a._show_tooltip=function(b,c){if(!a.config.touch||a.config.touch_tooltip){var d=this._create_tooltip();d.innerHTML=b,a.$task_data.appendChild(d);var e=d.offsetWidth+20,f=d.offsetHeight+40,g=this.$task.offsetHeight,h=this.$task.offsetWidth,i=this.getScrollState();c.y+=i.y;var j={x:c.x,y:c.y};c.x+=1*a.config.tooltip_offset_x||0,c.y+=1*a.config.tooltip_offset_y||0,c.y=Math.min(Math.max(i.y,c.y),i.y+g-f),c.x=Math.min(Math.max(i.x,c.x),i.x+h-e),a._is_cursor_under_tooltip(j,{pos:c,width:e,height:f})&&(j.x+e>h+i.x&&(c.x=j.x-(e-20)-(1*a.config.tooltip_offset_x||0)),j.y+f>g+i.y&&(c.y=j.y-(f-40)-(1*a.config.tooltip_offset_y||0))),d.style.left=c.x+"px",d.style.top=c.y+"px"}},a._hide_tooltip=function(){this._tooltip_html&&this._tooltip_html.parentNode&&this._tooltip_html.parentNode.removeChild(this._tooltip_html),this._tooltip_id=0},a._is_tooltip=function(b){var c=b.target||b.srcElement;return a._is_node_child(c,function(a){return a.className==this._tooltip_class})},a._is_task_line=function(b){var c=b.target||b.srcElement;return a._is_node_child(c,function(a){return a==this.$task_data})},a._is_node_child=function(b,c){for(var d=!1;b&&!d;)d=c.call(a,b),b=b.parentNode;return d},a._tooltip_pos=function(b){if(b.pageX||b.pageY)var c={x:b.pageX,y:b.pageY};var d=_isIE?document.documentElement:document.body,c={x:b.clientX+d.scrollLeft-d.clientLeft,y:b.clientY+d.scrollTop-d.clientTop},e=a._get_position(a.$task_data);return c.x=c.x-e.x,c.y=c.y-e.y,c},a.attachEvent("onMouseMove",function(b,c){if(this.config.tooltip_timeout){document.createEventObject&&!document.createEvent&&(c=document.createEventObject(c));var d=this.config.tooltip_timeout;this._tooltip_id&&!b&&(isNaN(this.config.tooltip_hide_timeout)||(d=this.config.tooltip_hide_timeout)),clearTimeout(a._tooltip_ev_timer),a._tooltip_ev_timer=setTimeout(function(){a._init_tooltip(b,c)},d)}else a._init_tooltip(b,c)}),a._init_tooltip=function(a,b){if(!this._is_tooltip(b)&&(a!=this._tooltip_id||this._is_task_line(b))){if(!a)return this._hide_tooltip();this._tooltip_id=a;var c=this.getTask(a),d=this.templates.tooltip_text(c.start_date,c.end_date,c);return d?void this._show_tooltip(d,this._tooltip_pos(b)):void this._hide_tooltip()}},a.attachEvent("onMouseLeave",function(b){a._is_tooltip(b)||this._hide_tooltip()}),a.templates.tooltip_date_format=a.date.date_to_str("%Y-%m-%d"),a.templates.tooltip_text=function(b,c,d){return"<b>Task:</b> "+d.text+"<br/><b>Start date:</b> "+a.templates.tooltip_date_format(b)+"<br/><b>End date:</b> "+a.templates.tooltip_date_format(c)}}),define("ganttTips",function(){}),gantt.config.day_date="%M %d日 %D",gantt.config.default_date="%Y年 %M %d日",gantt.config.month_date="%Y年 %M",gantt.locale={date:{month_full:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],month_short:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],day_full:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],day_short:["日","一","二","三","四","五","六"]},labels:{dhx_cal_today_button:"今天",day_tab:"日",week_tab:"周",month_tab:"月",new_event:"新建日程",icon_save:"保存",icon_cancel:"关闭",icon_details:"详细",icon_edit:"编辑",icon_delete:"删除",confirm_closing:"请确认是否撤销修改!",confirm_deleting:"是否删除日程?",section_description:"描述",section_time:"时间范围",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},define("ganttCN",function(){}),define("views/common/gantt/gantt-layout-view",["talent","templates/common","moment","tdialog","gantt","ganttMarker","ganttTips","ganttCN"],function(a,b,c,d,e){return a.ItemView.extend({template:b["common/gantt/gantt-layout"],legendTemplate:b["common/gantt/gantt-legend"],regions:{chart:".gantt-body"},className:"gantt",defaults:{width:1200,height:600,getSubUrl:"",data:{startDate:"",endDate:""}},initialize:function(b){var d=this;this.nowDate=c().toDate(),this.settings=a._.extend({},this.defaults,b);var e=d.$(".gantt-main"),f=e.width();if(d.settings.data.Data){var g=d.settings.data.Data.tasks;d.model.set("work",!1),g.isWork=!1}else{var g=d.settings.data.tasks;d.model.set("work",!0),g.isWork=!0}var h=0;if(h=620,h=g.length>20?620:28*g.length+110,this.model.set({width:f,height:h}),g[0])if("score"in g[0]){var i=!0;d.model.set("score",!0)}else{var i=!1;d.model.set("score",!1)}else{var i=!1;d.model.set("score",!1)}this.setGanttConfig(g.isWork,i),this.setGanttTmeplates(),this.overRiderGanttMethod(),this.addGanttMarker(),this.addGanttEvent(),this.setScaleConfig("1")},getBackupColumn:function(){var a={name:"startDate",label:"日期",template:function(a){var b=c(a.backStartDate).format("YYYY-MM-DD"),d=c(a.backEndDate).format("YYYY-MM-DD");return"milestone1"==a.type&&"未设置里程碑"==a.name||a.title?"":b+" - "+d},align:"center",resize:!0};return a},getBackSorce:function(){var a={name:"score",label:"评分",resize:!0,width:"60",align:"center",width:80,template:function(a){return 2==a.status&&!a.score||a.title?"":a.score?a.score:"-"}};return a},getBackComplate:function(){var a={name:"finishProgress",label:"完成度",resize:!0,width:"60",align:"center"};return a},mockData:function(){for(var a=[{id:1,name:"项目1",finishProgress:"120/130",type:"4",score:"60%",endDate:"2015/07/12",startDate:"2015/06/22",endDate:"2015/07/12",finishDate:"2015/07/13",isLongTerm:!1},{id:11,name:"产品设计",principalUser:"jack",type:"27",finishProgress:"120/130",score:"60%",startDate:"2015/06/22",endDate:"2015/07/12",finishDate:"2015/07/13",isLongTerm:!1,parentId:"1"}],b=0;10>b;b++){var c={id:b+100,name:"Task #"+(b+3),principalUser:"jack",type:"7",finishProgress:"120/130",score:"60%",startDate:"2015/06/22",endDate:"2015/07/12",finishDate:"2015/07/13",isLongTerm:!1,parentId:"11",progressColor:"#74bdff"};a.push(c)}return a},initGantt:function(){this.$el.find(this.ui.ganttBody)[0];e.init("grid-configuration")},setGanttConfig:function(a,b){var c=this;e.config.grid_width=450,e.config.readonly=!0,e.config.row_height=25,e.config.grid_resize=!0,e.config.columns=[{name:"name",resize:!0,label:"事项名称",tree:!0,template:function(a){var b=a.name,c="";return"project"==a.type?c="项目:":"milestone1"==a.type&&"未设置里程碑"!=b&&(c="里程碑:"),c+b}},{name:"principalUser",resize:!0,label:"负责人",align:"center",template:function(a){return a.principalUser?a.principalUser:""}}];var d=c.getBackComplate(),f=c.getBackSorce(),g=c.getBackupColumn();a&&e.config.columns.push(d),b&&e.config.columns.push(f),e.config.columns.push(g)},setGanttTmeplates:function(){var a=this;e.templates.grid_file=function(){return""},e.templates.grid_folder=function(){return""},e.templates.progress_text=function(){return""},e.templates.grid_header_class=function(){return"gridTitle gridFont"},e.templates.scale_cell_class=function(){return"gridTitle"},e.templates.scale_row_class=function(){return"gridTitle"},e.templates.task_text=function(a,b,d){var e=d.finishDate,f=d.endTime,g=d.status,h=d.type;return"project"==h||"milestone1"==h||"title"==h?"":"2"==g?c(e).format()==c(f).format()?"按期完成":c(e)<c(f)?"提前完成":"延期完成":"4"==g?"已取消":"6"==g?"已暂停":"0"==g?"未开始":"3"==g?"延迟":"1"==g?"进行中":void 0},e.templates.progress_class=function(a){var b=a.type,d=a.status,e=a.finishDate,f=a.endTime,g=a.startDate,h=a.progress;return"project"==b||"title"==b?"hideTest":"milestone1"==b?"未设置里程碑"==a.name?"hideTest":"heightSmall":"2"==d?c(e).format()==c(f).format()?"testGreen progressGreen":c(e)<c(f)?"gantt_task_progress testGreen":"testGreen":"4"==d?"darkgray":"6"==d?"pause":"0"==d?"gantt_task_progress_blue":"3"==d?c(g)>c(e)?"setdelay":c(e)<c(g)?"setdelay":1==h?"gantt_task_progress_blue":"setdelay":"1"==d?"gantt_task_progress_blue":void 0},e.templates.task_class=function(b,d,e){{var f=e.type,g=e.status,h=e.finishDate,i=e.endTime,j=e.startDate;e.progress}return"project"==f||"title"==f?"hideTest":"milestone1"==f?"未设置里程碑"==e.name?"hideTest":"heightSmall":"2"==g?c(h).format()==c(i).format()?"testGreen progressGreen":c(h)<c(j)?"testGreen":c(h)<c(i)?"testGreen cancle":"testRed":"4"==g?c(h)<c(i)?"cancle":"testRed":"6"==g?c(h)>c(i)?"testRed":c(h)<c(j)?"pause":"cancle":"0"==g?c(i)<a.nowDate?"testRed":"gantt_task_progress_blue":"3"==g?c(h)<c(i)?"setdelay":c(j)>c(h)?"setdelay":"testRed":"1"==g?c(i)<a.nowDate?"testRed":"gantt_task_progress_blue":void 0},e.templates.tooltip_text=function(a,b,c){var a=c.startDate,b=c.endDate;return("milestone1"==c.type||"project"==c.type)&&(a=c.backStartDate,b=c.backEndDate),"title"==c.type?"<div class='gantt-tip'><b>名称:</b> "+c.name:"<div class='gantt-tip'><b>名称:</b> "+c.name+"<br/><b>开始时间:</b> "+a+"<br/><b>结束时间:</b> "+b+"</div>"},e.attachEvent("onMouseMove",function(){})},overRiderGanttMethod:function(){e._render_grid_item=function(a){if(!e._is_grid_visible())return null;for(var b=this.getGridColumns(),c=[],d=0;d<b.length;d++){var f,g,h=d==b.length-1,i=b[d];"add"==i.name?g="<div class='gantt_add'></div>":(g=i.template?i.template(a):a[i.name],g instanceof Date&&(g=this.templates.date_grid(g,a)),g="<div class='gantt_tree_content gantt_tree_content_"+a.type+"' >"+g+"</div>");var j="gantt_cell"+(h?" gantt_last_cell":""),k="";if(i.tree){for(var l=0;l<a.$level;l++)k+=this.templates.grid_indent(a);var m=this._has_children(a.id);m?(k+=this.templates.grid_open(a),k+=this.templates.grid_folder(a)):(k+=this.templates.grid_blank(a),k+=this.templates.grid_file(a))}var n="width:"+(i.width-(h?1:0))+"px;";dhtmlx.defined(i.align)&&(n+="text-align:"+i.align+";"),f="<div class='"+j+"' style='"+n+"'>"+k+g+"</div>",c.push(f)}var j=a.$index%2===0?"":" odd";if(j+=a.$transparent?" gantt_transparent":"",j+=a.$dataprocessor_class?" "+a.$dataprocessor_class:"",this.templates.grid_row_class){var o=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);o&&(j+=" "+o)}var p="";a.title&&(p+=" newGantt_title"),this.getState().selected_task==a.id&&(j+=" gantt_selected");var q=document.createElement("div");return q.className="gantt_row"+j+p,q.style.height=this.config.row_height+"px",q.style.lineHeight=e.config.row_height+"px",q.setAttribute(this.config.task_attribute,a.id),q.innerHTML=c.join(""),q},e._set_scroll_events=function(){function a(a){var c=e._get_resize_options();e._wheel_time=new Date;var d=b?-20*a.deltaX:2*a.wheelDeltaX,f=b?-40*a.deltaY:a.wheelDelta;if(d&&Math.abs(d)>Math.abs(f)){if(c.x)return!0;var g=d/-40,h=e.$task.scrollLeft+30*g;e.scrollTo(h,null),e.$scroll_hor.scrollTop=i}else{if(c.y)return!0;var g=f/-40;"undefined"==typeof f&&(g=a.detail);var i=e.$scroll_ver.scrollTop+30*g;if(!e.config.prevent_default_scroll&&e._cached_scroll_pos&&e._cached_scroll_pos.y==i)return!0;e.scrollTo(null,i),e.$scroll_ver.scrollTop=i}return!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(new Date-(e._wheel_time||0)<100)return!0;if(!e._touch_scroll_active){var a=e.$scroll_hor.scrollLeft;e.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!e._touch_scroll_active){var a=e.$scroll_ver.scrollTop;e.$grid_data.scrollTop=a,e.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=e.$task.scrollLeft,b=e.$scroll_hor.scrollLeft;b!=a&&(e.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=e.$task_data.scrollTop,b=e.$scroll_ver.scrollTop;b!=a&&(e.$scroll_ver.scrollTop=a)});var b=_isFF&&!window._KHTMLrv;b?dhtmlxEvent(e.$container,"wheel",a):dhtmlxEvent(e.$container,"mousewheel",a)},e._get_task_pos=function(a,b){b=b!==!1;var c=e._get_milestone_width()/2,d=this._get_task_coord(a,b,c);return"milestone1"==a.type&&(d.y=d.y+11),d},e._has_children=function(a){return this.getChildren(a).length>0||e.getTask(a).isHasChild},e._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var b=this.$task_data.childNodes,c=0,d=b.length;d>c;c++){var e=b[c];this._is_layer(e)&&e.style&&(e.style.width=a.full_width+"px")}if(this._is_grid_visible())for(var f=this.getGridColumns(),g=0,c=0;c<f.length;c++)g+=f[c].width},e.date._add_days=function(a,b){var c=new Date(a.valueOf());return c.setMilliseconds(c.getMilliseconds()+24*b*60*60*1e3),b>=0&&!a.getHours()&&c.getHours()&&(c.getDate()<=a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c}},addGanttMarker:function(){var a=this,b=e.date.date_to_str(e.config.task_date),c=new Date(a.nowDate);e.addMarker({start_date:c,css:"today",text:"Today",title:"Today: "+b(c)})},addGanttEvent:function(){var b=this;b.taskOpenEvent=e.attachEvent("onTaskOpened",function(c){var d=e._has_children(c),f=e.getChildren(c).length,g=e.getTask(c),h=g.workId;d&&0>=f&&a.$.ajax({url:b.settings.getSubUrl,data:{partent_id:c,work_id:h},type:"get"}).done(function(a){var d=a.Data;b.dealData(d),b.addTask(d,c)})}),b.taskClickEvent=e.attachEvent("onTaskClick",function(b,c){var d=e.getTask(b),f=$(c.target).hasClass("gantt_tree_icon");return f?!0:("task"==d.type&&a.app.vent.trigger("global-pull-screen",b,"task"),c.cancelBubble=!0,!0)})},removeEvent:function(){var a=this;e.detachEvent(a.taskOpenEvent),e.detachEvent(a.taskClickEvent)},addTask:function(a,b){for(var c=a.length,d=0;c>d;d++){var f=a[d];e.addTask(f,b)}},setScaleConfig:function(a){var b=this;switch(a){case"1":e.config.scale_unit="month",e.config.step=1,e.config.date_scale="%Y年 %M",e.config.subscales=[{unit:"day",step:1,date:"%j"}],e.config.scale_height=50;break;case"2":var c=function(a){var c=a.getYear(),d=a.getMonth()+1,e=a.getDate(),f=b.getWeekMonth(c,d,e);return"第"+f+"周"};e.config.scale_unit="month",e.config.date_scale="%Y年 %M",e.config.step=1,e.config.subscales=[{unit:"week",step:1,template:c}],e.config.scale_height=50;break;case"3":e.config.scale_unit="year",e.config.date_scale=" %Y",e.config.subscales=[{unit:"month",step:1,date:"%M"}],e.config.scale_height=50,e.templates.date_scale=null;break;case"4":var d=function(a){var b,c=a.getMonth();return b=c>=9?4:c>=6?3:c>=3?2:1,"第"+b+"季度"};e.config.scale_unit="year",e.config.step=1,e.config.date_scale="%Y年",e.config.min_column_width=50,e.config.scale_height=50,e.config.subscales=[{unit:"quarter",step:1,template:d},{unit:"month",step:1,date:"%M"}];break;case"5":var d=function(a){var b,c=a.getMonth();return b=c>=9?4:c>=6?3:c>=3?2:1,"第"+b+"季度"};e.config.scale_unit="year",e.config.step=1,e.config.date_scale="%Y年",e.config.scale_height=50,e.config.subscales=[{unit:"quarter",step:1,template:d},{unit:"month",step:1,date:"%M"}]}},getWeekMonth:function(a,b,c){var d=new Date(a,parseInt(b)-1,c),e=d.getDay(),f=d.getDate();return Math.ceil((f+6-e)/7)},renderGantt:function(){e.render()},operateColumn:function(a){e.getGridColumns();e.getGridColumn("finishProgress")&&(e.getGridColumn("finishProgress").hide=!a),e.getGridColumn("score")&&(e.getGridColumn("score").hide=!a),e.getGridColumn("startDate").hide=!a},bindEvent:function(){var a=this;this.ui.scaleChange.bind("change",function(){var b=a.ui.scaleChange.val();a.setScaleConfig(b),e.render()}),this.ui.showDate.bind("click",function(){var b=a.ui.showDate.prop("checked");a.operateColumn(b),e.config.grid_resize=!0,e.render()}),this.ui.exportPDF.bind("click",function(){}),this.ui.legend.bind("click",function(b){a.lengendHandler(b)})},dealData:function(a){for(var b=this,d=a.length,e=0;d>e;e++){var f=a[e],g=f.type,h=f.status;f.backStartDate=f.startDate,f.backEndDate=f.endDate,f.fullName&&(f.name=f.fullName);var i=f.startDate=f.startTime,j=f.endDate=f.endTime,k=f.finishDate;27!=g&&(0==h||1==h?(f.finishDate=b.nowDate,k=b.nowDate):2==h||4==h||6==h||c(j)<c(b.nowDate)&&(f.finishDate=b.nowDate,k=b.nowDate)),i=c(i),f.start_date=c(f.startTime),j=c(j).valueOf(),k=c(k).valueOf();var l=b.getTimeDur(i,j);if(i>k)f.duration=l,f.progress=0;else{var m=j-k;if(0>m){l=b.getTimeDur(i,k);var n=(j-i)/(k-i).toFixed(2);f.progress=n}else{var n=(k-i)/(j-i).toFixed(2);f.progress=n}f.duration=l}f.open="4"==f.type||"27"==f.type?!0:!f.isHasChild,f.type="5"==f.type?"title":"4"==f.type?"project":"27"==g?"milestone1":"task",f.parent=f.parentId,f.order=20}var o={data:a,links:[]};return o},events:function(){},getTimeDur:function(a,b){var c=(b-a)/864e5;return c},lengendHandler:function(){var b=this,c=this.$el.find(".gantt_btn"),e=this.legendTemplate();
if(!this.legendViewIsShow){this.legendViewIsShow=!0,this.lengedView=new d({fixed:!1,type:"modal",sure:!1,cancel:!1}),this.lengedView.render().$el.appendTo("body");var f={arrow:1,arrowBias:187,topBias:0,leftBias:-5,autoHide:!1};this.lengedView.show(c,e,f),a.$("body").off("click.legendIntroduce"),a.$("body").on("click.legendIntroduce",function(c){var d=a.$(c.target);d.hasClass("gantt_btn")||0!=d.parents(".gantt_btn").length||b.lengedView&&(b.lengedView.hide(),b.legendViewIsShow=!1)})}},ui:{ganttBody:"#grid-configuration",scaleChange:"#gattConfigScale",showDate:"#showDate",exportPDF:"#exportPDF",legend:"#legend",ganttEmpty:".gantt_empty",ganttTool:"#gantt-tool",loading:"._tt_loading_m",allContainer:"#gantt-all-container"},events:function(){var a={};return a},onRender:function(){},onShow:function(){var a=this,b={},c=[];a.settings.data.tasks?(a.data=b=a.settings.data,a.tasks=c=a.settings.data.tasks):(a.data=b=a.settings.data.Data,a.tasks=c=a.settings.data.Data.tasks),c.length>1?(a.initGantt(b.startDate,b.endDate),a.bindEvent(),e.parse(a.dealData(c)),a.ui.loading.hide(),a.ui.ganttBody.show(),a.ui.ganttTool.show()):(a.ui.loading.hide(),a.ui.ganttEmpty.show(),a.ui.ganttTool.hide(),this.ui.ganttBody.hide())},onClose:function(){this.tasks.length>1&&(e.close(),e.clearAll())}})}),define("views/plan/g-chart/index-page-view",["talent","templates/plan","views/common/gantt/gantt-layout-view","tdialog"],function(a,b,c,d){var e=a.Layout.extend({template:b["plan/g-chart/index-page"],backTemplate:b["plan/g-chart/back-content"],initialize:function(b){this.i18n=a.Context.getI18n(),this.queryObject=b.queryObject,this.gantConfig={};var c=this.queryObject,d=a.Context.getApiUrl("/PlanV2/GetPlanGanttChartNew"),e=this;this.gantConfig.url=d,this.gantConfig.postData={plan_table_type:c.plan_table_type,to_user_id:c.to_user_id,plan_table_id:c.plan_table_id,type:"personal"==c.type?1:2},this.newGetData(d),e.gantConfig.type="personal"==c.type?"planPersonal":"planGroup",e.gantConfig.queryObject=c,e.gantConfig.leftWidth=130,e.gantConfig.beforeInitData=function(a){if(a.Code){{var b=a.Data||{},c=b.Plans||[];b.Lables||[]}return{allData:c,startDate:b.StartDate,endDate:b.EndDate,labels:b.Lables.lables}}alert("获取服务端数据出错！")}},ui:{gantBtn:".legendIntroduce",loading:"._tt_loading_m"},events:function(){var a={};return a["click "+this.ui.gantBtn]="lengendHandler",a["click "+this.ui.testPrint]="testPrintMethod",a},newGetData:function(a){var b=this,c=b.gantConfig.postData;b.newOnShow();var d="?plan_table_type="+c.plan_table_type+"&to_user_id="+c.to_user_id+"&plan_table_id="+c.plan_table_id+"&type="+c.type;$.ajax({type:"GET",url:a+d,dataType:"json"}).done(function(a){b.newSuccess(a)})},dataHandle:function(a,b,c){for(var d=this,e=[],f=[],g=[],h=[],i=0;i<a.length;i++){var j=a[i];j.fullName?j.title=!1:(j.id=j.LabelId,j.startDate=b,j.endDate=c,j.startTime=b,j.endTime=c,j.title=!0,j.type=5),1e3==a[i].LabTypeIdentify?(j.name||(j.name=j.LabelName),e.push(j)):0==a[i].LabTypeIdentify?(j.name||(j.name=j.LabelName),f.push(j)):-1==a[i].LabTypeIdentify?(j.name||(j.name=j.LabelName),h.push(j)):g.push(j)}if(h.length>0)for(var i=0;i<h.length;i++){var k=h[i],l=_.clone(k);l.name=l.LabelName,l.LabTypeIdentify=1e3;var m=l.LabelId;(""==m||"0"==m)&&(m=null),l.id=m,l.parentId=null,l.status=0,l.title=!0,l.type=5,l.workId=null,l.principalUser=null,l.fullName=null,e.push(l),k.parentId||(k.parentId=m)}for(var n=[],i=0;i<g.length;i++){var j=g[i];j.fullName||n.push(j)}for(var i=0;i<n.length;i++){var j=n[i],o=d.getFullName(j,n);j.name=o}for(var p=[],i=0;i<n.length;i++){var j=n[i];0==j.LabelParentId&&p.push(j)}for(var i=0;i<p.length;i++)for(var j=p[i],q=d.getChildData(j,n),r=0;r<q.length;r++){var s=d.getIndex(j,p),t=q[r],u=r+s+1;p.splice(u,0,t)}for(var v=[],i=0;i<p.length;i++){var j=p[i],w=d.judgeTitle(j,g);w&&(j.id=i+1,v.push(j));for(var r=0;r<g.length;r++){var t=g[r];t.LabelId==j.LabelId&&t.fullName&&(t.parentId||(t.parentId=j.id),v.push(t))}}for(var x=[],i=0;i<f.length;i++){var j=f[i];j.fullName||x.push(j)}for(var i=0;i<f.length;i++)for(var j=f[i],r=0;r<f.length;r++){var t=f[r];t.fullName&&t.LabelId==j.id&&!t.parentId&&(t.parentId=j.id)}for(var y=new Date,z=y.getTime()+"",i=0;i<e.length;i++){var j=e[i];if(!j.id){j.id=z;for(var r=0;r<e.length;r++){var t=e[r];!t.parentId&&t.fullName&&(t.parentId=j.id)}}}var A=v.concat(f,e,h);return A},judgeTitle:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.fullName&&d.LabelId==a.LabelId)return!0}return!1},getDeClassedData:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.LabelId==a.LabelId&&(!e.parentId&&e.id&&(e.parentId=a.LabelId),c.push(e))}return c},getChildData:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.LabelParentId==a.LabelId&&c.push(e)}return c},getIndex:function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=c;if(a.LabelId==d.LabelId)return e}},getFullName:function(a,b){for(var c=a.LabelParentId,d=a.LabelName;"0"!=c;)for(var e=0;e<b.length;e++){var f=b[e];c==f.LabelId&&(d=f.LabelName+">"+d,c=f.LabelParentId)}return d},newSuccess:function(a){var b=this,d=[];a.Data.tasks&&(d=b.dataHandle(a.Data.tasks,a.Data.startDate,a.Data.endDate)),a.Data.tasks=d,b.gantConfig.data=a,this.ganttView=new c(b.gantConfig),this.listenTo(this.ganttView,"gantt:resizeend",function(a){a.hasTask?b.updatePlanTime(a):b.updateTaskTime(a)}),this.ui.loading.hide(),this.main.show(this.ganttView)},lengendHandler:function(b){var c=this;b.stopPropagation();var e=a.$(b.currentTarget),f=['<div class="lengendTip">','<dl class="clearfix"><dt>计划</dt><dd class="plan_t"></dd></dl>','<dl class="clearfix"><dt>任务</dt><dd class="task_t"></dd></dl>','<dl class="clearfix"><dt>提前完成</dt><dd class="beforeDone"></dd></dl>','<dl class="clearfix"><dt>延期完成</dt><dd class="delayDone"></dd></dl>',"<div>"];this.lengedView=new d({fixed:!1,type:"modal",sure:!1,cancel:!1}),this.lengedView.render().$el.appendTo("body");var g={arrow:1,arrowBias:140,topBias:-24,autoHide:!1};this.lengedView.show(e,f.join(""),g),a.$("body").off("click.legendIntroduce"),a.$("body").on("click.legendIntroduce",function(){c.lengedView&&c.lengedView.hide()})},regions:{main:".gantt-main"},newOnShow:function(){var b=this,c=this.queryObject.to_user_id;a.app.request("User:getData",{ids:[c]}).done(function(a){var d=a[c],e={};e.Small=d.Avatar.Small,e.UserName=d.Name,e.year=b.queryObject.year,e.month=b.queryObject.month,e.type=b.queryObject.type,e.week=b.queryObject.week,e.i18n=b.i18n,b.$el.find(".gannt_navBack").html(b.backTemplate(e))})},updateTaskTime:function(a){var b=Talent.Context.getApiUrl("task/UpdateDate")+"?task_id="+a.Id,c={};c.StartDate=a.StartDate,c.Deadline=a.DeadLine,Talent.$.ajax({url:b,type:"post",data:c,success:function(a){1!=a.Code},error:function(){}})},updatePlanTime:function(a){var b=this,c=Talent.Context.getApiUrl("PlanV2/UpdateDate"),e=this.$el.find(a.nodeId);Talent.$.ajax({url:c,type:"put",data:a,success:function(a){var c=b.ganttView.resizeModel;1!=a.Code&&(b.tDialogView&&b.tDialogView.close(),b.tDialogView=new d({type:"tipsy"}),b.tDialogView.render().$el.appendTo("body"),b.tDialogView.show(e,a.Message,{arrow:!1,pos:"topCenter",className:"warn",autoHide:!0}),b.ganttView.cancelModify(c))}})}});return a.BasePageView.extend({mainViewClass:e,layout:window.top==window?"master-layout":"empty-layout"})}),define("views/common/plugins/class/class-treeItem-view",["talent","templates/common","$.tipsy"],function(a,b){return a.CompositeView.extend({template:b["common/plugins/class/class-move-item"],tagName:"li",initialize:function(){this.userInfo=a.Context.getUserInfo(),this.collection=this.model.children},ui:{enterprise:"span[data-name=enterprise]",person:"span[data-name=person]",permission:"span[data-name=lock-permission]"},appendHtml:function(a,b){a.$el.find("ul:first").append(b.el)},templateHelpers:function(){var a=!0;return 2==this.userInfo.Role?a=!0:this.model.get("IsTenant")&&(a=!1),{isEdit:a}},onRender:function(){this.$el.attr({id:this.model.get("id"),parent_id:this.model.get("parent_id"),"data-end":this.model.get("isEnd"),fullName:this.model.get("fullName"),ifAddClass:this.model.get("IsAllowSetPersonalLable")}),this._headIcoTispy()},_headIcoTispy:function(){a.$(this.ui.enterprise).tipsy({fallback:"企业分类",gravity:"s"}),a.$(this.ui.person).tipsy({fallback:"个人分类",gravity:"s"}),a.$(this.ui.permission).tipsy({fallback:"该分类下不允许添加个人分类",gravity:"s"})}})}),define("views/common/plugins/class/class-newFolder-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{type:"new",nameLen:200},template:b["common/plugins/class/class-move-new"],tagName:function(){return"rename"==this.options.type?"div":"li"},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a.click="_elHandler",a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},templateHelpers:function(){return{type:this.settings.type}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.attr("data-type","new-folder-form")},_elHandler:function(a){a.stopPropagation()},_focusHandler:function(b){a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus")},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=a.$.trim(c.val()),e=this.settings.nameLen;return a._.isStringBeyondLength(d,e)?(d=a._.substringWithM(d,e),c.val(d),!1):void 0},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.ui.input.val();this.model.set("name",a.$.trim(d)),""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel",this.model.get("name")),this.close()}})}),define("views/common/plugins/class/class-treeCollection-view",["talent","templates/common","views/common/plugins/class/class-treeItem-view","views/common/plugins/class/class-newFolder-view","tdialog"],function(a,b,c,d,e){return a.CollectionView.extend({defaults:{isEdit:!1},itemView:c,tagName:"ul",events:function(){var a={};return a["click ul"]="_ulHandler",a["click li div[data-name=title]"]="_checkHandler",a["click li span[data-name=toggle]"]="_toggleHandler",a["click li a[data-name=deleted]"]="_deleteHandler",a["click li a[data-name=edit]"]="_editHandler",a},collectionEvents:{reset:"render"},initialize:function(b){this.options=b,this.settings=a._.extend({},this.defaults,this.options),this.activeFolder=this.$el.find("li:first")},onShow:function(){var a=this.settings.isEdit,b=this.$el.find("li:first");b.addClass("unfold"),a?b.addClass("active"):b.find("ul:first").find("li:first").addClass("active")},itemViewOptions:function(){return{isEdit:this.settings.isEdit}},onAfterItemAdded:function(a){this.settings.isEdit||a.$el.find("div[data-name=klass-item-action]").remove()},_ulHandler:function(a){a.stopPropagation()},_toggleHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget).closest("li"),d=c.attr("data-end");"false"==d&&(c.hasClass("unfold")?c.removeClass("unfold"):c.addClass("unfold"))},_checkHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.closest("li"),e=(d.attr("data-end"),c.find("div[data-name=title-name]")),f=parseInt(d.attr("id")),g=d.attr("fullName");if(void 0!=g){var h=g.toString(),i=/^(分类\/)/;h=h.replace(i,"")}var j=this.settings.isEdit;"new-folder-form"!=d.attr("data-type")&&(0!=f||j)&&(this.activeFolder=d,this.$el.find("li").removeClass("active"),d.addClass("active"),this.trigger("checked",this.activeFolder,{id:f,name:a.$.trim(e.html()),fullName:h,parent_id:parseInt(d.attr("parent_id"))}))},_deleteHandler:function(b){var c=this;b.stopPropagation();var d=a.$(b.currentTarget),e=a.$(b.currentTarget).closest("li"),f=e.attr("parent_id"),g=d.attr("id");this._tipDialogView(d,"确定删除吗？子分类及相关信息都将被删除",function(){c.trigger("delete",{id:g,li:e,call:function(){e.remove();var a=c.$el.find('li[parent_id="'+f+'"]');if(!a.length){var b=c.$el.find('li[id="'+f+'"]');b.hasClass("unfold")&&b.find(".icon_tv").remove()}}})})},_editHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.attr("id"),e=a.$(b.currentTarget).closest("li");this._rendRenameView(d,c,e)},_rendRenameView:function(b,c,e){this.renameView&&this.renameView.close();var f=c.closest("div[data-name=title]"),g=f.find("div[data-name=title-name]"),h=g.html();this.renameView=new d({type:"rename",model:new a.Model({name:h})}),this.listenTo(this.renameView,"submit",function(a){this.trigger("rename",{id:b,name:a,node:e,node_name:g})},this),this.listenTo(this.renameView,"close",function(){g.html(this.renameView.model.get("name"))},this),g.html(this.renameView.render().$el),this.renameView.ui.input.focus()},_tipDialogView:function(a,b,c){var d=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new e({type:"tipsy",sure:!0,cancel:!0,sure:function(){c&&c(),d.tDialogView.close()}}),this.tDialogView.render().$el.appendTo(this.$el);var f=$("body").find(".tu-page-container").scrollTop()||0;this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",topBias:f-50,className:"ask"})},onClose:function(){}})}),define("views/common/plugins/class/class-search-view",["talent","templates/common","tdialog"],function(a,b){return a.ItemView.extend({template:b["common/plugins/class/class-search"],className:"class_search",ui:{content:".smember_condition_input",lableUl:"ul[data-name=lable-ul]",lableList:"ul[data-name=lable-list]",lableNameItem:"li[data-name=lablename]",contentHolder:".smember_condition_label",smemberHeaderInput:".smember_header_input"},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.$el.on("click",function(a){a.stopPropagation()}),this.collection=new a.Collection},events:function(){var a={};return a["focusout .smember_condition_input"]="onInputFocusOut",a["focusin .smember_condition_input"]="onInputFocusin",a["click "+this.ui.lableNameItem]="_checkHandler",a["click "+this.ui.contentHolder]="_smemberHandler",a},onRender:function(){var a=this;this.$el.find("#lable-list").hide(),this.$el.find("#lableName").on("keyup",function(){a.lableList()}),this.$el.find("#lableName").on("keypress",function(b){13==b.which&&a.lableList()})},onInputFocusOut:function(){this.ui.smemberHeaderInput.removeClass("input-focus"),""==this.ui.content.val()&&this.ui.contentHolder.show()},_checkHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(d);this.$el.find("#lableName").val(c.text()),this.$el.find("#lable-list").hide(),this.trigger("checkedLable",e.toJSON())},_smemberHandler:function(b){this.ui.contentHolder.hide();a.$(b.currentTarget);this.$el.find("#lableName").focus()},onInputFocusin:function(){this.ui.smemberHeaderInput.addClass("input-focus"),this.ui.contentHolder.hide();var b=a.$.trim(this.ui.content.val());return null==b||""==b?void this.$el.find("#lable-list").hide():void 0},lableList:function(){var b=this,c=a.$.trim(this.ui.content.val());return null==c||""==c?void this.$el.find("#lable-list").hide():void a.app.request("Lable:searchClassData",{user_id:this.userInfo.Id,filter:c}).done(function(a){b.collection.reset(a.lables||[]),b._listPlan(a.lables)}).fail(function(){})},_listPlan:function(b){var c="";null!=b&&b.length>0?a._.each(b,function(a){""!=a.name&&null!=a.name&&void 0!=a.name&&(c+='<li data-name="lablename" parentId ="'+a.parent_id+'" id="'+a.id+'">'+a.name+"</li>")}):c+="<li>无搜索结果</li>",this.ui.lableUl.empty(),this.ui.lableUl.append(c),this.$el.find("#lable-list").show()}})}),define("views/common/plugins/class/class-project-tab-item-view",["talent","templates/common"],function(a,b){var c=a.ItemView.extend({className:"class_project_tab",template:b["common/plugins/class/class-project-tab"],ui:{tabA:"a"},initialize:function(){this.$el.on("click",function(a){a.stopPropagation()})},events:function(){var a={};return a["click "+this.ui.tabA]="_clickTabName",a},_clickTabName:function(b){this.$el.find("a").removeClass("current");var c=a.$(b.currentTarget);c.addClass("current"),this.trigger("changeTree",c.attr("data-id"))},onRender:function(){}});return c}),define("views/common/plugins/class/class-view",["talent","templates/common","views/common/empty-view","views/common/plugins/class/class-treeItem-view","views/common/plugins/class/class-treeCollection-view","views/common/plugins/class/class-search-view","views/common/plugins/class/class-project-tab-item-view","tdialog"],function(a,b,c,d,e,f,g,h){var i=a.ItemView.extend({defaults:{type:"new",nameLen:100},template:b["common/plugins/class/class-move-new"],tagName:function(){return"rename"==this.options.type?"div":"li"},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a.click="_elHandler",a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},templateHelpers:function(){return{type:this.settings.type}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.attr("data-type","new-folder-form")},_elHandler:function(a){a.stopPropagation()},_focusHandler:function(b){var c=a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus"),"rename"==this.settings.type&&this.model.get("name")&&c.select()},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=a.$.trim(c.val()),e=this.settings.nameLen;return a._.isStringBeyondLength(d,e)?(d=a._.substringWithM(d,e),c.val(d),!1):void 0},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.ui.input.val();this.model.set("name",a.$.trim(d)),""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel",this.model.get("name")),this.close()}});return a.Layout.extend({defaults:{showTitle:!1,showButtonSure:!1,showButtonAdd:!1,showButtonReset:!1,showButtonCancel:!1,isEdit:!1,isShowSearch:!1,isShowProjectTab:!1},template:b["common/plugins/class/class-move"],itemFolderTemplate:b["common/plugins/class/class-move-item"],className:"tt_class_tree",ui:{closed:"span[data-name=klass-move-close]",newFolder:"button[data-name=klass-move-new-folder]",submit:"button[data-name=klass-move-submit]",title:"div[data-name=title]",actionArea:"div[data-name=klass-action]",emptyArea:"div[data-name=empty]",buttonReset:"button[data-name=klass-move-reset]",buttonCancel:"button[data-name=klass-move-cancel]",searchClass:"div[data-name=search-class]"},regions:{tree:"div[data-name=tree]",emptyArea:"div[data-name=empty]",classProjectTab:'div[data-name="class-project-tab"]'},collectionEvents:{reset:"_collectionReset"},_collectionReset:function(){var a=this.settings.isEdit,b=this.collection.toJSON()[0],c=b.children||[];a?b.length&&this.model.set({id:b[0].id,name:b[0].name}):this.model.set(c.length?{id:c[0].id,name:c[0].name}:{id:0,name:""}),this.render()},events:function(){var a={};return a["click "+this.ui.closed]="_closeHandler",a["click "+this.ui.submit]="_submitHandler",a["click "+this.ui.newFolder]="_newFolderHandler",a["click "+this.ui.buttonReset]="_resetHandler",a["click "+this.ui.buttonCancel]="_closeHandler",a["focus "+this.ui.newFolderForm_input]="_focusNewFolderHandler",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.addAjax=!1,this.model.set({id:0,name:"",parent_id:0}),a.$(document).on("click.documentlist_permissions",function(){$(document).find(".documentlist_permissions").hide(),$(document).find(".activeClass").hide()}),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){var a=this;this._customView(),this.settings.isShowProjectTab?(this._renderClassProjectTabView(),setTimeout(function(){a._changeClassViewCollection(2771)},0)):this._renderTreeView(),this.settings.isShowSearch&&this._searchView(),this._renderEmptyView()},_renderClassProjectTabView:function(){var a=this;this.classProjectTabView=new g,this.classProjectTab.show(this.classProjectTabView),this.listenTo(this.classProjectTabView,"changeTree",function(b){a._changeClassViewCollection(b)})},_changeClassViewCollection:function(b){if(0!=b){var c=this.collection.toJSON(),d=c[0].children,e=[];a._.each(d,function(a){a.id==b&&e.push(a)}),c[0].children=e,this._renderTreeView(c),this.$el.find('li[id="'+b+'"]').addClass("unfold")}else this._renderTreeView()},_searchView:function(){var a=this;this.searchView&&this.searchView.close(),this.searchView=new f,this.listenTo(this.searchView,"checkedLable",function(b){a.trigger("checkedLable",b),a._currentLiTree(b)}),this.ui.searchClass.append(this.searchView.render().el)},_currentLiTree:function(a){function b(a){var d=c.$el.find("div[data-name='tree'] li[id="+a+"]");if(d.length&&0!=a){var e=d.attr("parent_id");d.addClass("unfold"),b(e)}}var c=this,d=c.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').attr("parent_id");b(d),this.$el.find('div[data-name="tree"] li').removeClass("active"),this.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').addClass("active");var e=this.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').position();this.trigger("scrollTop",{id:a.id,top:e.top})},setPosition:function(b,c){var d=b.offset(),e=b.outerWidth(),f=b.outerHeight(),g=this.$el,h=g.outerWidth(),i={pos:"left"},c=a._.extend({},i,c);this.$el.css("right"==c.pos?{top:d.top+f+5,left:d.left-h+e}:{top:d.top+f+5,left:d.left})},_renderEmptyView:function(){var a=this.settings.isEdit,b='请到<a href="#set?page_id=class">个人设置</a>下设置分类';a&&(b="点击 添加类别 添加分类"),this.ui.emptyArea.hide();var d=this.collection.toJSON();if(d.length&&d[0]&&d[0].children)return void this.ui.emptyArea.hide();var e=new c({emptyContext:b});this.emptyArea.show(e),this.ui.emptyArea.show()},_customView:function(){this.settings.showTitle||this.ui.title.remove(),this.settings.showButtonSure||this.ui.submit.remove(),this.settings.showButtonAdd||this.ui.newFolder.remove(),this.settings.showButtonSure||this.settings.showButtonAdd||this.ui.actionArea.remove(),this.settings.showButtonReset||this.ui.buttonReset.remove(),this.settings.showButtonCancel||this.ui.buttonCancel.remove()},_submitHandler:function(b){var c=a.$(b.currentTarget),d=null,e=null,f=null,g=this.model.get("name");""==g?(e=this.searchView.$el.find("#lableName").attr("ids"),d=this.searchView.$el.find("#lableName").val(),f=this.searchView.$el.find("#lableName").attr("parentid")):(e=this.model.get("id"),d=this.model.get("name"),f=this.model.get("parent_id")),this.model.set("id",e),this.model.set("parent_id",f),this.model.set("name",d);var h=this.treeView.collection.models[0].children;h&&!h.length?this.trigger("submit",{id:"",name:"",parent_id:""},c):this.trigger("submit",{id:this.model.get("id"),name:this.model.get("name"),parent_id:this.model.get("parent_id")},c),this.close()},_resetHandler:function(b){a.$(b.currentTarget);this.trigger("reset")},_closeHandler:function(b){a.$(b.currentTarget);this.trigger("closed"),this.close()},_newFolderHandler:function(b){var c=a.$(b.currentTarget),e=this;this.newFolderView&&this.newFolderView.close(),this.newFolderView=new i,this.listenTo(this.newFolderView,"submit",function(b){this.trigger("new",{name:b,parent_id:this.model.get("id"),node:c,call:function(b){b.isEnd=!0;var c=new d({model:new a.Model(b)});e.activeFolder.find("ul:first").prepend(c.render().el),e.ui.emptyArea.hide();var f=b.parent_id;e._addTreeCollectionIcon(f)}})},this),this.listenTo(this.newFolderView,"cancel",function(){this.activeFolder.removeClass("unfold")},this);{var f=this.activeFolder.attr("ifaddclass");this.activeFolder.attr("fullname")}"false"!=f?(this.activeFolder.addClass("unfold"),this.activeFolder.find("ul:first").prepend(this.newFolderView.render().el),this.newFolderView.ui.input.focus()):e._tipDialogView(c,"该分类下不允许创建个人分类")},_addTreeCollectionIcon:function(a){var b=this,c=this.$el.find("li [id='"+a+"']");this.$el.find("#iconTv").removeAttr("id"),c.children(":first").prepend('<span id="iconTv"  class="icon_tv" data-name="toggle"></span>'),this.$el.find("#iconTv").click(function(){var c=b.$el.find("li [id='"+a+"']").hasClass("unfold");c?b.$el.find("li [id='"+a+"']").removeClass("unfold"):b.$el.find("li [id='"+a+"']").addClass("unfold")})},_tipDialogView:function(a,b,c){var d=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new h({type:"tipsy",sure:function(){c&&c(),d.tDialogView.close()},cancel:function(){d.tDialogView&&d.tDialogView.close()}}),this.tDialogView.render().$el.appendTo("body"),this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",className:"warn"})},_renderTreeView:function(a){var b=this,c=Backbone.Model.extend({initialize:function(){var a=this.get("children");a&&(this.children=new d(a),this.unset("children"))}}),d=Backbone.Collection.extend({model:c});if(a)var f=a;else var f=this.collection.toJSON();this.treeView=new e({collection:new d(f),isEdit:this.settings.isEdit}),this.activeFolder=this.treeView.$el,this.listenTo(this.treeView,"delete",function(a,c){b.trigger("delete",a,c)}),this.listenTo(this.treeView,"rename",function(a){var c=a.node;c.attr("id")==this.activeFolder.attr("id")&&this.model.set("name",a.name),b.trigger("rename",a)}),this.listenTo(this.treeView,"rename",function(a){var b=a.node;b.attr("id")==this.activeFolder.attr("id")&&this.model.set("name",a.name)}),this.listenTo(this.treeView,"checked",function(a,b){this.activeFolder=a,this.model.set({id:b.id,name:b.name,fullName:b.fullName,parent_id:b.parent_id}),this.trigger("checked",{id:b.id,name:b.name,fullName:b.fullName,parent_id:b.parent_id})},this),this.tree&&this.tree.show(this.treeView)},onClose:function(){this.tDialogView&&this.tDialogView.close(),a.$(document).off("click.documentlist_permissions")}})}),define("views/common/plugins/class/checked-class-composite-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({tagName:"li",template:b["common/plugins/class/checked-class-item"],initialize:function(){},ui:{delItem:".smember_btn_reduce"},events:function(){var a={};return a["click "+this.ui.delItem]="_deleteItem",a},onRender:function(){},_deleteItem:function(){this.trigger("deleteItem",this.model)}});return a.CompositeView.extend({defaults:{emptyContext:"请从左侧点击选择"},itemView:d,template:_.template("<ul></ul>"),itemViewContainer:"ul",emptyView:c,events:function(){var a={};return a},initialize:function(){},onRender:function(){var a=this;this.on("itemview:deleteItem",function(b){a.collection.remove(b.model)})},itemViewOptions:function(){return{emptyContext:this.defaults.emptyContext}}})}),define("views/common/plugins/class/project-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({template:b["common/plugins/class/work-item"],tagName:"li",onRender:function(){this.$el.attr("id",this.model.get("WorkId"))}}),e=a.CompositeView.extend({itemView:d,itemViewContainer:"ul",template:b["common/plugins/class/work-list"],className:"tt_klass_work",events:{"click li":"_chekcoutItemHandler","click div[data-name=work-title]":"_toggleHandler"},ui:{workList:"ul[data-name=work-list]"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){this.settings.isDefaultChecked&&this.$el.find("li:first").addClass("active")},_toggleHandler:function(b){var c=a.$(b.currentTarget),d=c.next("ul"),e=d.is(":hidden");this.ui.workList.hide(),e?(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-minus-square"),d.show()):(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-plus-square"),d.hide())},_chekcoutItemHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(parseInt(d));this.$el.find("li").removeClass("active"),c.addClass("active"),this.trigger("checked",{id:d,name:e.get("WorkName")})}});return a.Layout.extend({template:b["common/plugins/class/project"],className:"tt_class_tree",ui:{emptyArea:"div[data-name=empty]"},regions:{workBox:"div[data-name=work-box]",workJoinBox:"div[data-name=work-box-join]",emptyArea:"div[data-name=empty]"},events:function(){var a={};return a},initialize:function(){this.i18n=a.Context.getI18n(),this.joinCollection=this.options.joinCollection},onRender:function(){this._rendWorkListView(this.workBox,this.collection,"create"),this._rendWorkListView(this.workJoinBox,this.joinCollection,"join"),this._renderEmptyView()},_renderEmptyView:function(){if(this.ui.emptyArea.hide(),this.collection.length||this.joinCollection.length)return void this.ui.emptyArea.hide();var a=new c({emptyContext:"请在"+this.i18n.work_1+"功能下创建"+this.i18n.work_1});this.emptyArea.show(a),this.ui.emptyArea.show()},_rendWorkListView:function(b,c,d){var f="我负责的";"join"==d&&(f="我参与的");var g=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"WorkId"})}}),h=new e({collection:new g(c.toJSON()),model:new a.Model({title:f})});this.listenTo(h,"checked",function(a){this.trigger("checked",a)},this),b.show(h)}})}),define("views/common/plugins/class/class-tree-component-view",["talent","templates/common","views/common/plugins/class/class-view","views/common/plugins/class/checked-class-composite-view","views/common/plugins/class/project-view"],function(a,b,c,d,e){return a.Layout.extend({defaults:{isShowSearch:!1,title:"",pluginType:0},template:b["common/plugins/class/class-tree-component"],className:"class_data_filter_dropdown",initialize:function(b){var c=this;this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.classCollection=new a.Collection,this.checkedCollection=new a.Collection,b.checkedClassCollection&&(this.checkedCollection=b.checkedClassCollection),a.$(document).off("click.Class-Tree-Component-View"),a.$(document).on("click.Class-Tree-Component-View",function(){c.close()}),this.$el.off("click"),this.$el.on("click",function(a){a.stopPropagation()})},regions:{classArea:".class_data_type_list",checkedTypeList:".class_data_checked_type_list"},ui:{sureBtn:'a[data-handler="Submit"]',canceltBtn:'a[data-handler="Cancel"]',closeBtn:'a[data-handler="Close"]',cleanBtn:'a[data-handler="clean"]',allClass:'[data-name="all"]',allProject:'[data-name="project"]'},events:function(){var a={};return a["click "+this.ui.sureBtn]="_sureChecked",a["click "+this.ui.canceltBtn]="_cancelChecked",a["click "+this.ui.closeBtn]="_cancelChecked",a["click "+this.ui.cleanBtn]="_cleanChecked",a["click "+this.ui.allClass]="_allClass",a["click "+this.ui.allProject]="_allProject",a},templateHelpers:function(){return{title:this.settings.title,pluginType:this.settings.pluginType}},_cleanChecked:function(){this.checkedCollection.reset(),this.close(),this.trigger("emptyClass")},_sureChecked:function(){this.trigger("checkedClass",this.checkedCollection.toJSON()),this.close()},_allClass:function(){this.ui.allClass.addClass("active"),this.ui.allProject.removeClass("active"),this._requestClassData()
},_allProject:function(){this.ui.allClass.removeClass("active"),this.ui.allProject.addClass("active"),this._requestProjectData()},_cancelChecked:function(){this.close(),this.trigger("resetClass")},onClose:function(){a.$(document).on("click.Class-Tree-Component-View")},showView:function(){this.$el.show()},hideView:function(){this.$el.hide()},setPositon:function(b,c){b.outerHeight(),b.offset(),b.position();a.Context.setPosition(b,this.$el,{pos:"bottomLeft",container:c||a.$("body")})},onRender:function(){this._requestClassData(),this._renderClassView(),this._renderCheckedClassCompositeView()},_renderCheckedClassCompositeView:function(){this.checkedClassCompositeView=new d({collection:this.checkedCollection}),this.checkedTypeList.show(this.checkedClassCompositeView)},_requestProjectData:function(){var b=this;this.allProjectView?b.classArea.show(b.allProjectView):(this.allProjectView=new e({collection:new a.Collection,joinCollection:new a.Collection,pluginType:this.settings.pluginType}),this.listenTo(this.allProjectView,"checked",function(a){b.checkedCollection.push({id:a.id,name:a.name,fullName:a.name,type:2})}),a.app.request("Project:getProject",{app_id:1,app_type:1}).done(function(a){var c=a.CreateWorks||[],d=a.JoinWorks||[];b.allProjectView.collection.reset(c),b.allProjectView.joinCollection.reset(d),b.classArea.show(b.allProjectView)}))},_requestClassData:function(){var b=this;this.classView?this._renderClassView():a.app.request("Lable:getLableData",{obj_id:this.userInfo.Id,obj_type:1,to_userId:this.options.to_userId||0}).done(function(a){b.classCollection.reset(a.lables),b._renderClassView()}).fail(function(){})},_renderClassView:function(){var a=this;this.classView||(this.classView&&this.classView.close(),this.classView=new c({collection:this.classCollection,edit:!1,isShowSearch:this.settings.isShowSearch,pluginType:this.settings.pluginType}),this.listenTo(this.classView,"checkedLable",function(b){var c=a.checkedCollection.where({id:Number(b.id)});0==c.length?a.checkedCollection.add({id:b.id,name:b.name,fullName:b.fullName||"",type:1}):a.checkedCollection.findWhere({id:Number(b.id)}).set({id:b.id,name:b.name,fullName:b.fullName||"",type:1})},this),this.listenTo(this.classView,"checked",function(b){var c=a.checkedCollection.where({id:b.id});0==c.length&&a.checkedCollection.push({id:b.id,name:b.name,fullName:b.fullName,type:1})},this),this.listenTo(this.classView,"scrollTop",function(b){var c=this.$el.find(".class_data_type_list").height()/2,d=parseInt(this.$el.find(".class_data_type_list .cont_rd").css("paddingTop"));a.$el.find(".class_data_type_list").animate({scrollTop:b.top-c+d})},this)),this.classArea.show(this.classView)}})}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require("../moment")):"function"==typeof define&&define.amd?define("momentZH",["moment"],b):b(a.moment)}(this,function(a){var b=a.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(a,b){return 12===a&&(a=0),"凌晨"===b||"早上"===b||"上午"===b?a:"下午"===b||"晚上"===b?a+12:a>=11?a:a+12},meridiem:function(a,b){var c=100*a+b;return 600>c?"凌晨":900>c?"早上":1130>c?"上午":1230>c?"中午":1800>c?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[下]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[上]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"日";case"M":return a+"月";case"w":case"W":return a+"周";default:return a}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});return b}),define("views/common/plugins/popup/sort-pop-view",["talent","templates/common","tdialog","moment","momentZH","$.tipsy"],function(a,b,c){return a.ItemView.extend({defaults:{displayType:"inline",container:null,node:null,isShowStar:!0},template:b["common/plugins/popup/sort-pop"],ui:{defaultSort:'[data-name="default"]',startSort:'[data-name="start"]',endSort:'[data-name="end"]',createSort:'[data-name="create"]',star:'[data-name="star"]',item:".item"},events:function(){var a={};return a["click "+this.ui.item]="_chooseHandler",a},modelEvents:{change:"render"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.renderTag=!0,this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",minWidth:90,className:"_tt_dialog ns-sortPop-dialog",displayType:this.settings.displayType}),this.settings.container.append("inline"==this.settings.displayType?this.Dialog.render().$el:this.Dialog.render().$el)},templateHelpers:function(){return this.settings},onRender:function(){var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"bottomRight",arrow:!1,container:this.settings.container}),b.Dialog.hide(),a.$(document).off("click.sortPop"),a.$(document).on("click.sortPop",function(){b.Dialog.hide()}),this.renderTag=!1),this.$("[original-title]").tipsy({gravity:"s"})},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},_chooseHandler:function(a){var b=this.$(a.currentTarget),c=b.attr("data-name"),d=this.model.get("SortType");switch(b.trigger("mouseleave"),c){case"default":d=1;break;case"start":d=3==d?2:3;break;case"end":d=5==d?4:5;break;case"create":d=7==d?6:7;break;case"star":d=8}this.model.set("SortType",d),this.trigger("submit"),this.Dialog.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.sortPop")}})}),define("views/common/plugins/popup/member-sort-view",["talent","templates/common","tdialog","moment","momentZH","$.tipsy"],function(a,b,c){return a.ItemView.extend({defaults:{displayType:"inline",node:null,container:null},template:b["common/plugins/popup/member-sort"],ui:{check:".check",labelTxt:".label",sure:'[data-name="sure"]'},events:function(){var a={};return a["click "+this.ui.check]="_checkHandler",a["click "+this.ui.labelTxt]="_checkHandler",a["click "+this.ui.sure]="_submitHandler",a},modelEvents:{change:"_checkIsEmpty"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.renderTag=!0,this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",className:"_tt_dialog ns-memberSort-dialog",displayType:this.settings.displayType}),this.settings.container.append("inline"==this.settings.displayType?this.Dialog.render().$el:this.Dialog.render().$el);var b=this.collection.findWhere({FidleName:"TaskPrincipal"}),d=this.collection.findWhere({FidleName:"TaskCreate"}),e=this.collection.findWhere({FidleName:"TaskParticipator"}),f=[];b&&f.push({key:"r",value:"1"}),d&&f.push({key:"c",value:"3"}),e&&f.push({key:"p",value:"2"}),this.model.set({checkAll:!0,isEmpty:!1,isShowRes:b,isShowCreate:d,isShowPart:e});for(var g=0,h=f.length;h>g;g++)this.model.set(f[g].key,!0);this.dataSet=f,this.caculateData()},onRender:function(){var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"bottomRight",arrow:!1,container:this.settings.container}),a.$(document).off("click.memberSortPop"),a.$(document).on("click.memberSortPop",function(){b.Dialog.hide()}))},_checkIsEmpty:function(){for(var a="",b="",c=!0,d=this.dataSet,e=this.model.toJSON(),f=0,g=d.length;g>f;f++)a=d[f].key,b=d[f].value,e[a]&&(c=!1);this.model.set({isEmpty:c},{silent:!0})},_checkHandler:function(a){var b=this.$(a.currentTarget).parent().attr("data-type"),c=this.model.toJSON(),d=c[b],e=this.dataSet,f=!0;if(this.model.set(b,!d),"checkAll"==b)for(var g=0,h=e.length;h>g;g++)this.model.set(e[g].key,!d);else{c=this.model.toJSON();for(var g=0,h=e.length;h>g;g++)c[e[g].key]||(f=!1);this.model.set({checkAll:f})}this.renderTag=!1,this.render(),a.stopPropagation()},caculateData:function(){for(var a="",b="",c=[],d=this.dataSet,e=this.model.toJSON(),f=0,g=d.length;g>f;f++)a=d[f].key,b=d[f].value,e[a]&&c.push(b);this.model.set({RelationType:c.join(",")})},_submitHandler:function(){var a=this.ui.sure;a.hasClass("btn-disabled")||(this.caculateData(),this.hide(),this.trigger("submit"))},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.memberSortPop")}})}),define("views/common/plan/plan-data-filter-view",["talent","templates/common","views/common/plugins/class/class-tree-component-view","$.tipsy","helpers/context","views/common/plugins/popup/sort-pop-view","views/common/plugins/popup/member-sort-view"],function(a,b,c,d,e,f,g){var h=a.ItemView.extend({template:b["common/plan/plan-data-filter-dropdown"],className:"tt_data_filter_dropdown",ui:{buttonSubmit:"button[data-name=submit]",dottedTips:'span[data-name="dotted-tips"]'},modelEvents:{"change:allChecked":"render"},events:{"click li":"_clickLiHandler","click button[data-name=submit]":"_submitDataHandler",'click div[data-name="filter-all"] a':"_clickFilterAllHandler"},templateHelpers:function(){return{data:this.options.collection.toJSON()}},initialize:function(){var b=this,c=this.options.collection||new a.Collection([]),d=a._.where(c.toJSON(),{Checked:!0})||[];d=a._.compact(d),this.activeData=a._.pluck(d,"Id")||[],this.activeLen=d.length||0,a.$(document).off("click.Plan-Data-Filter-Dropdown-View"),a.$(document).on("click.Plan-Data-Filter-Dropdown-View",function(){b.close()}),this.$el.off("click"),this.$el.on("click",function(a){a.stopPropagation()}),this.activeLen==this.options.collection.length?this.model.set("allChecked",!0):this.model.set("allChecked",!1)},_clickFilterAllHandler:function(){var b=this;a._.each(this.options.collection.models,function(a){a.set("Checked",!b.model.get("allChecked"))}),this.model.set("allChecked",!this.model.get("allChecked")),this.model.get("allChecked")?(this.activeLen=b.options.collection.length,this.activeData=a._.map(b.options.collection.models,function(a){return a.get("Id")})):(this.activeLen=0,this.activeData=[]),this.activeLen>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled")},onRender:function(){var b=this.activeLen;b>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled"),a.$(this.ui.dottedTips).tipsy({fallback:"虚线下级",gravity:"s"})},onClose:function(){a.$(document).off("click.Plan-Data-Filter-Dropdown-View"),a.$(".tipsy").remove()},_clickLiHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.find("a[data-name=input-checkbox]"),e=this.activeLen,f=this.activeData,g=this.options.collection,h=parseInt(c.attr("id")),i=g.findWhere({Id:h});d.hasClass("checkbox-checked")?(d.removeClass("checkbox-checked"),e-=1,f=a._.without(f,h),i&&i.set("Checked",!1)):(d.addClass("checkbox-checked"),e+=1,f.push(h),i&&i.set("Checked",!0)),this.activeLen=e,this.activeData=f,e>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled"),e==this.options.collection.length?this.model.set("allChecked",!0):this.model.set("allChecked",!1)},_submitDataHandler:function(b){var c=(a.$(b.currentTarget),this.activeData),d=this.activeLen;this.trigger("submit",c),0!=d&&this.close()}});return a.ItemView.extend({defaults:{status:!0,member:!0,Class:!0,memberType:!0,sortType:!0,isShowStar:!0,isShowDetail:!0,statusCollection:new a.Collection([{Name:"未开始",Id:0,Checked:!0},{Name:"进行中",Id:1,Checked:!0},{Name:"已完成",Id:2,Checked:!0},{Name:"已延迟",Id:3,Checked:!0},{Name:"已取消",Id:4,Checked:!0},{Name:"暂停中",Id:6,Checked:!0}]),memberCollection:new a.Collection,ClassCollection:new a.Collection},template:b["common/plan/plan-data-filter"],className:"tt_data_filter",ui:{sort:'[data-name="sort"]',detail:'[data-name="detail-mode"]',memberType:'[data-type="memberType"]'},events:function(){var a={};return a["click .status-item"]="_clickItemTypeHandler",a["click "+this.ui.detail]="_setDetailHander",a["click "+this.ui.sort]="_popSortHandler",a},modelEvents:{"change:detail_checked":"_detailCheckChange"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo();var b=this.settings.memberCollection;b.each(function(a){a.set("Checked",!0)});var c=this.settings.statusCollection;c.each(function(a){a.set("Checked",!0)}),this.model.set({SortType:1})},templateHelpers:function(){return this.settings.detail_checked=this.model.get("detail_checked")?this.model.get("detail_checked"):!1,this.settings},onRender:function(){var a=this.$el.find("li:first").attr("data-type");this.model.set("type",a)},onShow:function(){this.sortPopView&&this.sortPopView.close(),this.sortPopView=new f({node:this.ui.sort,container:this.$el,model:this.model,isShowStar:this.settings.isShowStar}),this.sortPopView.render(),this.sortPopView.on("submit",function(){this.trigger("dataFilter",this.model.toJSON())},this)},_detailCheckChange:function(){var a=this.model.get("detail_checked"),b=this.ui.detail;b.removeClass("checkbox-checked"),a&&b.addClass("checkbox-checked")},_popSortHandler:function(b){a.$(b.currentTarget);this._closeAllPop(),b.stopPropagation(),this.sortPopView.show()},_setDetailHander:function(){var a=this.model.get("detail_checked");this.model.set({detail_checked:!a}),this.trigger("show_detail",this.model.toJSON())},_setMarkHander:function(){},_closeAllPop:function(){this.dropDownView&&this.dropDownView.close(),this.classTreeComponentView&&this.classTreeComponentView.close(),this.memberSortView&&this.memberSortView.hide(),this.sortPopView&&this.sortPopView.hide()},_clickItemTypeHandler:function(b){b.stopPropagation(),this._closeAllPop();var c=a.$(b.currentTarget),d=c.attr("data-type");"class"==d?this._renderClassTreeView(c,d):"memberType"==d?this._clickMemberHandler():this._renderDropDownView(c,d)},_clickMemberHandler:function(){var b=this,c=this.model.get("to_user_id"),d=this.userInfo.Id,e=!0;c=c?c:d,e=c==d?!0:!1,this.model.set("isSelfView",e),this.memberTypes?this.memberSortView.show():a.app.request("Customize:getData",{obj_id:c,obj_type:1,customize_type:"1,2"}).done(function(c){var d=null,e=null,f=a._.where;d=f(c,{CustomizaBehaviorType:1}),e=f(d[0].Fields,{FieldValue:!0}),b.memberTypes=e,b._renderMemberTypeView()})},_renderMemberTypeView:function(){this.memberSortView&&this.memberSortView.close(),this.memberSortView=new g({node:this.ui.memberType,container:this.$el,model:this.model,collection:new a.Collection(this.memberTypes)}),this.memberSortView.on("submit",function(){this.trigger("dataFilter",this.model.toJSON())},this),this.memberSortView.render()},_renderClassTreeView:function(a,b){var d=this;this.classTreeComponentView&&this.classTreeComponentView.close(),this.classTreeComponentView=new c({checkedClassCollection:this.settings.ClassCollection,isShowSearch:!0,title:"选择类别",pluginType:1}),this.$el.append(this.classTreeComponentView.render().$el),this.classTreeComponentView.setPositon(a,this.$el),this.listenTo(this.classTreeComponentView,"checkedClass",function(a){d.settings.ClassCollection.reset(a),d.model.set(b,a),d.trigger("dataFilter",d.model.toJSON())}),this.listenTo(this.classTreeComponentView,"emptyClass",function(){d.settings.ClassCollection.reset(),d.model.set(b,""),d.trigger("dataFilter",d.model.toJSON())}),this.listenTo(this.classTreeComponentView,"resetClass",function(){d.model.set(b,"")})},_renderDropDownView:function(b,c){{var d=this.settings[c+"Collection"],e=this.model.get("status")||[];this.model.get("member")||[]}a._.each(e,function(a){var b=d.findWhere({Id:a});b&&b.set("Checked",!0)}),"member"==c&&d.each(function(a){var b=a.toJSON();a.set({Type:b.type,Name:b.name,Id:b.userId})}),this.dropDownView&&this.dropDownView.close(),this.dropDownView=new h({model:this.model,collection:d}),this.listenTo(this.dropDownView,"submit",function(a){this.model.set(c,a),this.trigger("dataFilter",this.model.toJSON())},this),this.$el.append(this.dropDownView.render().el),a.Context.setPosition(b,this.dropDownView.$el,{container:this.$el,pos:"bottomRight",leftBias:0,topBias:4})},onClose:function(){this.dropDownView&&this.dropDownView.close(),this.classTreeComponentView&&this.classTreeComponentView.close(),this.memberSortView&&this.memberSortView.close(),this.sortPopView&&this.sortPopView.close()}})}),define("views/common/plugins/class/work-view",["talent","templates/common","views/common/plugins/class/class-view","tdialog","views/common/empty-view"],function(a,b,c,d,e){var f=a.ItemView.extend({template:b["common/plugins/class/work-item"],tagName:"li",onRender:function(){this.$el.attr("id",this.model.get("WorkId"))}}),g=a.CompositeView.extend({defaults:{isDefaultChecked:!0},itemView:f,itemViewContainer:"ul",template:b["common/plugins/class/work-list"],className:"tt_klass_work",events:{"click li":"_chekcoutItemHandler","click div[data-name=work-title]":"_toggleHandler"},ui:{workList:"ul[data-name=work-list]"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.collection.model=a.Model.extend({idAttribute:"WorkId"}),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){this.settings.isDefaultChecked&&this.$el.find("li:first").addClass("active")},_toggleHandler:function(b){var c=a.$(b.currentTarget),d=c.next("ul"),e=d.is(":hidden");this.ui.workList.hide(),e?(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-minus-square"),d.show()):(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-plus-square"),d.hide())},_chekcoutItemHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(parseInt(d));this.$el.find("li").removeClass("active"),c.addClass("active"),this.trigger("checked",{id:d,name:e.get("WorkName")})}});return a.Layout.extend({defaults:{showTitle:!1,showButtonSure:!1,showButtonAdd:!1,showButtonCancel:!1},template:b["common/plugins/class/work"],itemFolderTemplate:b["common/plugins/class/class-move-item"],className:"tt_class_tree",ui:{closed:"span[data-name=work-move-close]",newFolder:"button[data-name=work-move-new-folder]",submit:"button[data-name=work-move-submit]",title:"div[data-name=work-move-title]",actionArea:"div[data-name=work-action]",emptyArea:"div[data-name=empty]",buttonCancel:"button[data-name=work-move-cancel]",buttonReset:"button[data-name=work-move-reset]"},regions:{workBox:"div[data-name=work-box]",workJoinBox:"div[data-name=work-box-join]",emptyArea:"div[data-name=empty]"},collectionEvents:{reset:"_collectionReset"},_collectionReset:function(){var a=this.collection.toJSON()||[],b=this.joinCollection.toJSON()||[];a.length?this.model.set({id:a[0].WorkId,name:a[0].WorkName}):b.length&&this.model.set({id:b[0].WorkId,name:b[0].WorkName}),this.render()},templateHelpers:function(){return{i18n:this.i18n}},events:function(){var a={};return a["click "+this.ui.closed]="_closeHandler",a["click "+this.ui.buttonCancel]="_closeHandler",a["click "+this.ui.buttonReset]="_resetHandler",a["click "+this.ui.submit]="_submitHandler",a["click "+this.ui.newFolder]="_newFolderHandler",a["focus "+this.ui.newFolderForm_input]="_focusNewFolderHandler",a},initialize:function(){this.i18n=a.Context.getI18n(),this.settings=a._.extend({},this.defaults,this.options),this.addAjax=!1,this.model.set({id:0,name:""}),this.joinCollection=this.options.joinCollection?this.options.joinCollection:new a.Collection,this.listenTo(this.joinCollection,"reset",this._collectionReset)},onRender:function(){this._customView(),this._rendWorkListView(this.workBox,this.collection,"create"),this._rendWorkListView(this.workJoinBox,this.joinCollection,"join"),this._renderEmptyView(),402==this.model.get("type")&&this.workJoinBox.$el.hide()},setPosition:function(a){var b=a.offset(),c=a.outerWidth(),d=a.outerHeight(),e=this.$el,f=e.outerWidth();this.$el.css("right"==pos?{top:b.top+d+5,left:b.left-f+c}:{top:b.top+d+5,left:b.left})},_renderEmptyView:function(){var a=this.model.get("type"),b="请在"+this.i18n.work_1+"功能下创建"+this.i18n.work_1;if(4!=a&&(b="暂无目标"),this.ui.emptyArea.hide(),this.collection.length||this.joinCollection.length)return void this.ui.emptyArea.hide();var c=new e({emptyContext:b});this.emptyArea.show(c),this.ui.emptyArea.show()},_customView:function(){this.settings.showTitle||this.ui.title.remove(),this.settings.showButtonSure||this.ui.submit.remove(),this.settings.showButtonAdd||this.ui.newFolder.remove(),this.settings.showButtonSure||this.settings.showButtonAdd||this.ui.actionArea.remove()},_submitHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget);this.trigger("submit",{id:this.model.get("id"),name:this.model.get("name")},c)},_closeHandler:function(b){a.$(b.currentTarget);this.trigger("closed"),this.close()},_resetHandler:function(b){a.$(b.currentTarget);this.trigger("reset")},_rendWorkListView:function(b,c,d){var e="我负责的",f=!0;"join"==d&&(e="我参与的"),this.collection.length||"create"!=d||(f=!1),this.collection.length&&"join"==d&&(f=!1);var h=new g({collection:c,model:new a.Model({title:e}),isDefaultChecked:f});this.listenTo(h,"checked",function(a){this.model.set({id:a.id,name:a.name}),this.trigger("checked",a)},this),b.show(h)}})}),define("views/common/plugins/class/class-component-view",["talent","templates/common","views/common/plugins/class/class-view","views/common/plugins/class/work-view","tdialog"],function(a,b,c,d,e){return a.Layout.extend({template:b["common/plugins/class/class-component"],className:"tt_class_dialog",regions:{classArea:"div[data-name=klass-content]",classEmptyArea:"div[data-name=klass-empty]"},defaults:{isShowSearch:!1,isShowProject:!0,isShowTarget:!1},ui:{klassTabLi:"ul[data-name=klass-tab] li",klassTab:"ul[data-name=klass-tab]",closed:"span[data-name=klass-close]",emptyArea:"div[data-name=empty]",newInputFolder:"button[data-name=klass-move-new-folder]",buttonSubmit:"button[data-name=klass-action-submit]",buttonCancel:"button[data-name=klass-action-cancel]",buttonReset:"button[data-name=klass-action-reset]"},modelEvents:{"change:type":"_typeChange"},_typeChange:function(){var a=this.model.get("type");17==a?(this._renderClassView(),this._requestClassData()):4==a?this.setting.isShowProject&&(this._renderWorkView(),this._requestWorkData(a)):this.setting.isShowTarget&&(this._renderTargetView(),this._requestWorkData(a))},templateHelpers:function(){var b=a.Context.getGlobal("tenant_function");return{i18n:this.i18n,IsUseWorkLable:b.IsUseWorkLable,isShowProject:this.settings.isShowProject,isShowTarget:this.settings.isShowTarget}},events:function(){var a={};return a["click li"]="_checkLiHandler",a["click "+this.ui.klassTabLi]="_clickTabHandler",a["click "+this.ui.closed]="_clickClosedHandler",a["click "+this.ui.newInputFolder]="_clickAddInputHandler",a["click "]="_stopPropagation",a},initialize:function(b){var d=this;this.setting=this.settings=a._.extend({},this.defaults,b),this.i18n=a.Context.getI18n(),this.tajax_work=!1,this.tajax_klass=!1,this.tajax_target=!1,this.userInfo=a.Context.getUserInfo(),this.model.set({id:0,name:""}),this.classCollection=new a.Collection,this.workCreatCollection=new a.Collection,this.workJoinCollection=new a.Collection,this.targetCreatCollection=new a.Collection,this.targetJoinCollection=new a.Collection,this.classView&&this.classView.close(),this.classView=new c({collection:this.classCollection,model:this.model,edit:!0,isEdit:!0}),this.listenTo(this.classView,"liChecked",function(a){this.activeFolder=a}),this.listenTo(this.classView,"delete",function(b){a.app.request("Lable:deleteLableData",{lable_id:b.id}).done(function(){b.call()}).fail(function(a){d._tipDialogView(b.li,a)})}),this.listenTo(this.classView,"rename",function(b){a.app.request("Lable:putRenameLableData",{lable_id:b.id,name:b.name}).done(function(){b.node_name.html(b.name)})},this),this.$el.on("click",function(a){a.stopPropagation()}),a.$(document).on("click.kclass"+this.cid,function(){d.close()})},_stopPropagation:function(a){a.stopPropagation()},onRender:function(){var a=this.model.get("type")||17;17==a?(this._renderClassView(),this._requestClassData()):(this._renderWorkView(),this._requestWorkData(a)),this._initCustom()},onClose:function(){this.model.set({type:17,id:0,name:"",isEnd:!0},{silent:!0}),a.$(document).off("click.kclass"+this.cid)},setPosition:function(a,b){var c=a.offset(),d=a.outerWidth(),e=a.outerHeight(),f=this.$el,g=f.outerWidth(),b=b||"left";this.$el.css("right"==b?{top:c.top+e+10,left:c.left-g+d,"z-index":99}:{top:c.top+e+10,left:c.left,"z-index":99})},_initCustom:function(){var a=this.model.get("type")||17;this.ui.klassTabLi.removeClass("active"),this.ui.klassTab.find("li[data-type="+a+"]").addClass("active")},_submitHandler:function(){this.trigger("submit",{type:this.model.get("type"),id:this.model.get("id"),name:this.model.get("name")}),this.close()},_cancelHandler:function(){this.trigger("cancel"),this.close()},_resetHandler:function(){this.trigger("reset"),this.close()},_clickTabHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.attr("data-type");this.ui.klassTabLi.removeClass("active"),c.addClass("active"),this.model.set("type",parseInt(d))},_clickClosedHandler:function(){this.close(),this.trigger("closed")},_requestClassData:function(){var b=this;this.tajax_work||(this.tajax_work=!0,a.app.request("Lable:getLableData",{obj_id:this.userInfo.Id,obj_type:1}).done(function(a){b.classCollection.reset(a.lables)}).fail(function(){b.tajax_work=!1}))},_renderClassView:function(){this.classView&&this.classView.close(),this.classView=new c({collection:this.classCollection,model:this.model,isEdit:!0,showButtonSure:!0,showButtonAdd:!0,showButtonReset:!0,showButtonCancel:!0,isShowSearch:this.settings.isShowSearch}),this.listenTo(this.classView,"new",function(b){var c=this;a.app.request("Lable:postAddLableData",{obj_id:this.userInfo.Id,obj_type:"1",name:b.name,parent_id:b.parent_id}).done(function(a){b.call(a)}).fail(function(a){c._tipDialogView(b.node,a)})}),this.listenTo(this.classView,"delete",function(b){a.app.request("Lable:deleteLableData",{lable_id:b.id}).done(function(){b.call()}).fail(function(a){self._tipDialogView(b.li,a)})}),this.listenTo(this.classView,"rename",function(b){a.app.request("Lable:putRenameLableData",{lable_id:b.id,name:b.name}).done(function(){b.node_name.html(b.name)})},this),this.listenTo(this.classView,"checked",function(a){this.model.set({type:17,id:a.id,name:a.name},{silent:!0})},this),this.listenTo(this.classView,"closed",function(){this._cancelHandler()}),this.listenTo(this.classView,"reset",function(){this._resetHandler()}),this.listenTo(this.classView,"submit",function(){this._submitHandler()},this),this.listenTo(this.classView,"scrollTop",function(a){var b=this.$el.find(".tt_tree_view").height()/2;this.$el.find(".tt_tree_view").animate({scrollTop:a.top-b})},this),this.classArea.show(this.classView)},_requestWorkData:function(b){var c=this,d=1,e=1;if(4==b){if(this.tajax_klass)return;this.tajax_klass=!0}else{if(this.tajax_target)return;this.tajax_target=!0,d=402,e=402}a.app.request("Project:getProject",{app_id:d,app_type:e}).done(function(a){var d=a.CreateWorks||[],e=a.JoinWorks||[];4==b?(c.workCreatCollection.reset(d),c.workJoinCollection.reset(e)):(c.targetCreatCollection.reset(d),c.targetJoinCollection.reset(e))})},_clickCancelHandler:function(){this.trigger("cancel"),this.close()},_renderWorkView:function(){this.workView&&this.workView.close(),this.workView=new d({collection:this.workCreatCollection,joinCollection:this.workJoinCollection,model:this.model,showButtonSure:!0,showButtonAdd:!1}),this.listenTo(this.workView,"checked",function(a){this.$el.find(".tt_tree_view li").removeClass("active"),this.$el.find('.tt_tree_view li[id="'+a.id+'"]').addClass("active"),this.model.set({type:4,id:a.id,name:a.name},{silent:!0})},this),this.listenTo(this.workView,"submit",function(){this._submitHandler()},this),this.listenTo(this.workView,"closed",function(){this._clickCancelHandler()},this),this.listenTo(this.workView,"reset",function(){this._resetHandler()},this),this.classArea.show(this.workView)},_renderTargetView:function(){this.targetView&&this.targetView.close(),this.targetView=new d({collection:this.targetCreatCollection,joinCollection:this.targetJoinCollection,model:this.model,showButtonSure:!0,showButtonAdd:!1}),this.listenTo(this.targetView,"checked",function(a){this.$el.find(".tt_tree_view li").removeClass("active"),this.$el.find('.tt_tree_view li[id="'+a.id+'"]').addClass("active"),this.model.set({type:4,id:a.id,name:a.name},{silent:!0})},this),this.listenTo(this.targetView,"submit",function(){this._submitHandler()},this),this.listenTo(this.targetView,"closed",function(){this._clickCancelHandler()},this),this.listenTo(this.targetView,"reset",function(){this._resetHandler()},this),this.classArea.show(this.targetView)},_tipDialogView:function(a,b){this.tDialogView&&this.tDialogView.close(),this.tDialogView=new e({type:"tipsy"}),this.tDialogView.render().$el.appendTo("body"),this.tDialogView.show(a,b,{arrow:!1,pos:"top",className:"warn",autoHide:!0})}})}),define("views/common/plan/plan-create-view",["talent","templates/plan","$.tipsy","tdialog","views/common/plugins/class/class-component-view"],function(a,b,c,d,e){return a.ItemView.extend({template:b["common/plan/plan-create"],ui:{form:"form",contentLabel:".name_label",contentWrap:".input-default",content:"input[name=new-content]",submit:".submint",formKlass:"div[data-name=new-klass]",formKlassName:"span[data-name=new-klass-name]"},events:function(){var a={};return a["submit "+this.ui.form]="_onSubmit",a["click "+this.ui.contentLabel]="_labeClcik",a["click "+this.ui.submit]="_onSubmit",a["keydown "+this.ui.content]="_onKeydown",a["keyup "+this.ui.content]="_onKeyup",a["focus "+this.ui.content]="_onFocus",a["blur "+this.ui.content]="_onBlur",a["click "+this.ui.formKlass]="_clickClassHandler",a},modelEvents:{"change:label_name":"_changeLabName"},_changeLabName:function(){var b=this.model.get("label_name");b=a._.substringWithM(b,6,!0);var c=this.model.get("name");""==b?(b="类别",c||this.startDate||this.endDate||this.ui.contentWrap.removeClass("input-focus")):this.ui.contentWrap.addClass("input-focus"),this.ui.formKlassName.html(b)},templateHelpers:function(){return{i18n:this.i18n}},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.settings=a._.extend({},this.defaults,this.options),this.i18n=a.Context.getI18n(),this.tajax=!1},onRender:function(){this.ui.submit.tipsy({gravity:"s"})},_onKeydown:function(b){var c=this,d=a.$(b.target),e=b.keyCode,f=d.attr("name");if(d.prev("label").hide(),"time"==f){if(8!=e)return!1;d.val("")}if(this.ui.contentWrap.hasClass("input-focus")||this.ui.contentWrap.removeClass("input-error").addClass("input-focus"),13==e){if($(".daterangepicker").hide(),this.createTime)return;this.createTime=setTimeout(function(){c._onSubmit(b),c.createTime=null},300)}},_onKeyup:function(b){var c=a.$(b.target),d=a.$.trim(c.val());this.model.set("name",d)},_onkeyupTime:function(b){var c=(b.keyCode,a.$(b.target));c.val("")},_onFocus:function(b){a.$(b.target);this.ui.contentWrap.removeClass("input-error").addClass("input-focus")},_onBlur:function(b){var c=this;setTimeout(function(){var d=a.$(b.target),e=c.model.get("name");""!=e&&e||(c.ui.contentWrap.removeClass("input-focus"),d.prev("label").show())},100)},_labeClcik:function(){$(this.ui.content).focus()
},_clickClassHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget);this._renderKlassView(c,"create")},_renderKlassView:function(b,c,d){var f=d&&d.label_type&&0!=d.label_type?d.label_type:17;this.classComponentView&&this.classComponentView.close(),this.classComponentView=new e({model:new a.Model({type:f}),isShowSearch:!0}),this.listenTo(this.classComponentView,"submit",function(a){0!=a.id&&("update"==c?this._requestUpdateKlass({planItem_id:d.id,label_type:a.type,label_id:a.id,label_name:a.name}):this.model.set({label_type:a.type,label_id:a.id,label_name:a.name}))}),this.listenTo(this.classComponentView,"new",function(b){a.app.request("Lable:postAddLableData",{obj_id:this.userInfo.Id,obj_type:"1",name:b.name,parent_id:b.parent_id}).done(function(a){b.call(a)})}),this.listenTo(this.classComponentView,"reset",function(){"update"==c?this._requestUpdateKlass({planItem_id:d.id,label_type:0,label_id:null,label_name:""}):this.model.set({label_type:0,label_id:null,label_name:""})}),this.$el.append(this.classComponentView.render().el),this.classComponentView.setPosition(b),this.classComponentView.$el.show()},_onSubmit:function(a){if(a.preventDefault(),!this.tajax){this.tajax=!0;var b=this,c=this.model.get("name"),d=this.$el.find("input.name").val();if(d!=c&&(this.model.set("name",d),c=d),""==c)return this.ui.contentWrap.css("border-color","red"),this.ui.contentWrap.animate({"border-color":"#ddd"},2e3),void(this.tajax=!1);this._changeSubmitBtn(2),this.submitRequest({name:this.model.get("name"),labType:this.model.get("label_type")||0,labId:this.model.get("label_id")||0}).done(function(){b._submitSuccess()}).fail(function(){b.tajax=!1,b._submitError()})}},submitRequest:function(){var b=new a.$.Deferre;return b},_submitSuccess:function(){var a=this;this.model.set({label_type:0,label_id:null,label_name:"",name:""}),this.ui.contentWrap.addClass("input-success"),this._changeSubmitBtn(3),this.classComponentView&&this.classComponentView.close(),setTimeout(function(){a.ui.contentWrap.removeClass("input-success"),a.render(),a._changeSubmitBtn(1),a.tajax=!1},500)},_submitError:function(){this._changeSubmitBtn(1),this.ui.contentWrap.removeClass("input-focus").addClass("input-error")},resetForm:function(){this.ui.content.val(""),this.ui.contentLabel.show(),this.ui.contentWrap.removeClass("input-focus").removeClass("input-success").removeClass("input-error")},_changeSubmitBtn:function(a){this.ui.submit.html(1==a?"发布":2==a?'<span class="loading_submint"></span>':'<span class="success_submint"></span>')},_tipMessage:function(a,b,c){this.failDialog||(this.failDialog=new d({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:c||"warn"})},onClose:function(){this.failDialog&&this.failDialog.close(),this.classComponentView&&this.classComponentView.close()}})}),define("views/plan/index-page-view",["talent","templates/plan","views/plan/plan-list-layout","views/plan/plan-list-data-nav-item-view","views/common/bs-tab/bs-tab","views/common/share-range/share-range-view","views/plan/plan-list-feedback-item-view","views/plan/plan-list-daily-view","views/plan/plan-list-empty-view","views/common/error-tracker-view","views/plan/histroy/index-page-view","views/plan/histroy/histroy-list-view","tdialog","views/common/membership/membership-tab-component","views/plan/plan-sidebar-top-view","views/plan/table/index-page-view","views/common/messages/message-applist-view","views/plan/g-chart/index-page-view","views/common/plan/plan-data-filter-view","views/common/plan/plan-create-view","TitaWidget","moment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=new a.Model,x=a.Layout.extend({template:b["plan/index-page"],sideBarTemplate:b["plan/plan-list-sidebar"],className:"tu-row-fuild",regions:{main:"._tt_layout_container",sideBarNav:"div[data-name=side-bar-nav]",sideBarUserInfo:"div[data-name=side-bar-user-info]"},events:{"click div[data-name=year-list]":"showYearDropdown"},groupNameMapping:{1:"2013",2:"2014",3:"2015",4:"2016",5:"2017",6:"2018",7:"2019",8:"2020"},initialize:function(){var b=this;this.renderTop=!0,this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1,this.userInfo=a.Context.getUserInfo(),a.Context.setPageTitle("tita-"+this.iPlan),this.planListLayout=null,this.hasBindTab=!1,this.planSidebarTopView=new o,this.routerModel=new a.Model,this.listenTo(this.routerModel,"change:type",function(){b.rederSideBar(),b._renderUserInfoView()}),this.teamData=[]},onRender:function(){var b=this;this._getRouterData().done(function(){b.routerData.isMySelf?b._getMockPageData():b._getPageData()}),this.$el.on("click",function(){b.$el.find("div[data-name=year-list] ul").hide(),a.$(".wrap_noticesetting_tita").hide()})},_getMockPageData:function(){var b=this;a.app.request("Plan:getMockDateData",{group_id:parseInt(b.routerData.group_id),date:v().format("YYYY/MM/DD")}).done(function(a){var c=a&&a.Data;b.tabData=c,b.rederSideBar(),b._renderUserInfoView()})},onShow:function(){a._.splash("plan"),setTimeout(function(){a.$("#BizQQWAP").hide()},4e3)},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a,b.routerData.to_user_id=a.to_user_id?a.to_user_id:b.userInfo.Id,b.routerData.type=b.routerData.type||"personal",b.routerData.isMySelf="group"==b.routerData.type?!1:b.routerData.to_user_id==b.userInfo.Id,b.routerData.group_id=b.routerData.group_id||0,b.routerData.isSearch=b.routerData.isSearch||!1,b.routerModel.set(b.routerData,{silent:!0}),d.resolve(b.routerData)}),d},_getPageData:function(){var b=this,b=this;a.$.ajax({url:a.Context.getWebUrl("Plan/"+this.userInfo.Id+"/Home/Index?toUserId="+this.routerData.to_user_id+"&groupId="+this.routerData.group_id+"&type="+this.routerData.type),dataType:"jsonp"}).done(function(a){if(a&&0==a.Code)b._renderErrorTrackerView();else{var c=a&&a.Data;b.tabData=c,b.rederSideBar(),b._renderUserInfoView()}})},_renderErrorTrackerView:function(){var b=new j({content:"哎呀~该"+this.i18n.plan_1+"暂时无法查看了",subContent:"只有建立了上下级关系或共享才能查看"+this.i18n.plan_1+"，请联系发"+this.i18n.plan_1+"者"});a.$("#main-region").css("background","#fff"),a.$("._tt_layout_tabnav").hide(),a.$(this.regions.main).width("100%"),a.$(this.regions.main).html(b.render().$el)},_renderUserInfoView:function(){var b=this;if(this.routerData.isMySelf)this.planSidebarTopView.model.set({user:this.userInfo,routerData:this.routerData,team_name:"我的团队"}),this.sideBarUserInfo&&this.sideBarUserInfo.show(this.planSidebarTopView);else{var c=this.routerData.to_user_id;a.app.request("User:getData",{ids:[c]}).done(function(a){b.planSidebarTopView.model.set({user:a[c],routerData:b.routerData,team_name:"我的团队"}),b.sideBarUserInfo&&b.sideBarUserInfo.show(b.planSidebarTopView)})}},rederSideBar:function(){var b=this,c=(this.routerData,this.tabData.taglist);if(this.activeGroup=a._.findWhere(c,{Active:!0})||c[0],this.routerData.group_id&&0!==this.routerData.group_id){var d=parseInt(this.routerData.group_id);activeGroup=a._.findWhere(c,{GroupId:d})}this.routerData.group_id=this.activeGroup.GroupId,this.routerData.group_name=this.activeGroup.GroupName;var f=this.activeGroup.PlanTableListModels,g=a._.findWhere(f,{Active:!0})||f[0];if(this.routerData.tag_id){var h=parseInt(this.routerData.tag_id);g=a._.findWhere(f,{TagId:h})}this.routerData.tag_id=g.TagId,this.routerData.tag_name=g.TagName,this.routerData.tag_type=g.TagType,this.routerData.IsCurrentDate=!0,w.set("routerData",this.routerData,{silent:!0}),this.routerData.viewName&&w.set("viewName",this.routerData.viewName);var i=a.Context.getGlobal("tenant_function"),j=a.Context.customModuleIsShow();this.$el.find("div[data-name=side-bar-nav]").html("").append(this.sideBarTemplate({user:this.userInfo,current_year:this.routerData.group_name,groupDatas:c,navData:f,routerData:this.routerData,i18n:this.i18n,IsUsePlanDaily:i.IsUsePlanDaily,isShowPlan:j.plan}));var k=new e({el:this.$el.find("._tt_side_subnav"),eventTriggerName:"Plan-List-SiderBar"});a.app.vent.off("tab:Plan-List-SiderBar:change"),a.app.vent.on("tab:Plan-List-SiderBar:change",function(a){b.routerData.plan_table_id="",b.onTabClick(a)},this),k.setDefault({tag_id:this.routerData.tag_id}),this.renderPartialViewByRouter()},onTabClick:function(b){var c=a.Context.parseUrl(b.attr("href"));if(this.hasBindTab=!1,a._.isEmpty(c)!==!0){this.routerData=a._.extend({},this.routerData,c),this.routerData.isMySelf="group"==this.routerData.type?!1:this.routerData.to_user_id==this.userInfo.Id;this.renderPartialViewByRouter(),a.app.vent.off("tab:Tita-Plan-Feedback-Histroy-Tab:change"),this.histroyListView&&this.histroyListView.close(),this.planListFeedbackItemView&&this.planListFeedbackItemView.close(),this.planListCompositeView&&this.planListCompositeView.collection.reset(),w.set({routerData:this.routerData},{silent:!0})}},renderPartialViewByRouter:function(){this.onClosePlanDetailLayout();var b=this.routerData;this.planListLayout||(this.planListLayout=new c({model:new a.Model(b)}),this.main&&this.main.show(this.planListLayout)),this.renderPlanListTopNavCompositeView()},_changeAvtar:function(){var b=this,c=this.routerData;if(!c.isMySelf){var d=c.to_user_id;a.app.request("User:getData",{ids:[d]}).done(function(a){b.planSidebarTopView.model.set({user:a[d],routerData:b.routerData,team_name:"我的团队"})})}},onClosePlanDetailLayout:function(){this.messageApprovalView&&this.messageApprovalView.close()},renderPlanListLayout:function(){var b=this.routerData;this.planListLayout||(this.planListLayout=new c({model:new a.Model(b)}),this.main&&this.main.show(this.planListLayout)),this.renderPlanListTopNavCompositeView()},renderPlanListTopNavCompositeView:function(){var a=this,b=this._getGroupTableNavData();b.done(function(b){a.renderTop?a._renderPlanListDataNavItemView(b):a.renderTop=!0,a.routerData.isMySelf?a._rendPlanNewContentView():a.$el.find('div[data-name="plan-create-form"]').html(""),a.renderPlanListCompositeView(),a.checkUserPlanTable(),a._renderFeedAndShareView()})},_renderFeedAndShareView:function(){var b=this,c=this.routerData;"group"!=c.type&&a.app.request("Plan:getShareAndFeed",{to_user_id:c.to_user_id,planTableId:c.plan_table_id}).done(function(c){b.routerData.shareUsers=c.ShareUsers||[],b.renderPlanShareRangeCompositeView(),c.Feed&&(b.routerData.feedId=c.Feed.FeedId,a.app.request("Comment:getFeedItemComment",{feed_id:c.Feed.FeedId,comment_type:0}).done(function(a){b.routerData.feedData=a||"",b.routerData.feedData&&b.clickTabFeedBackHistroy()}))})},_renderPlanListDataNavItemView:function(b){var c=this;this.planListTopNavView&&c.planListTopNavView.close(),this.planListTopNavView=new d({model:new a.Model(b)}),this.planListLayout.planNav.show(c.planListTopNavView);var f=new e({el:c.planListTopNavView.$el.find(".list"),eventTriggerName:"Plan-List-Top-Nav-View"});a.app.vent.off("tab:Plan-List-Top-Nav-View:change"),a.app.vent.on("tab:Plan-List-Top-Nav-View:change",function(a){c.renderTop=!1,c.onTabClick(a)},c),f.setDefault({plan_table_id:this.routerData.plan_table_id})},_renderPlanDataFilterView:function(){var b=this,c=this.routerData.type;"personal"==c?this._renderPlanFilterActualy():a.app.request("Bench:getModuleData",{channel_type:2,view_name:"Team"}).done(function(a){b.teamData=a.members,b._renderPlanFilterActualy()})},_renderPlanFilterActualy:function(){var b=this,c=this.routerData.type,d=this.teamData;if(this.teamData&&this.teamData.length&&(a._.map(d,function(a){a.user.type=a.type}),d=a._.pluck(d,"user")),this.filterOptions&&this.filterOptions["class"])var e=this.filterOptions["class"];else var e=[];this.planDataFilterView&&this.planDataFilterView.close(),this.planDataFilterView=new s({member:"group"==c?!0:!1,memberType:"group"==c?!1:!0,isShowStar:"group"==c?!1:!0,memberCollection:new a.Collection(d),ClassCollection:new a.Collection(e),model:new a.Model(this.routerData)}),this.listenTo(this.planDataFilterView,"dataFilter",function(a){b.filterOptions=a,b._requestSearchData()}),this.listenTo(this.planDataFilterView,"show_detail",function(a){b.filterOptions=a,b._showPlanListDetail(a.detail_checked)}),this.planListLayout.planDataFilter&&this.planListLayout.planDataFilter.show(this.planDataFilterView)},_showPlanListDetail:function(b){if(b){this.planListCompositeView.model.set("detail_checked",b);var c=this.planListCompositeView&&Talent._.values(this.planListCompositeView.childrenModel)||[],d=new Talent.Collection(c),e=a._.pluck(d.where({isRemind:!0,cycleId:0}),"id");d.length&&e.length&&this._requestRemindData(e.toString()).done(function(a){_.map(a,function(a){var b=d.where({taskId:a.ObjId}),c=null;c=+new Date(a.Time)?v(new Date(a.Time)).format("MM/DD HH:mm"):a.Time,b[0].set("time",c)})})}else this.planListCompositeView&&this.planListCompositeView.model.set("detail_checked",b)},_requestRemindData:function(b){if(b){var c=new a.$.Deferred;return a.app.request("Plan:getNoticeTime",{obj_ids:b,obj_type:7}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c}},_requestSearchData:function(){var b=this,c=this.routerData,d=this.filterOptions.member||[],e=this.filterOptions.status||[],f=this.filterOptions["class"]||[],g=[],h=c.startDate.replace(/年|月/g,"/").replace("日",""),i=c.endDate.replace(/年|月/g,"/").replace("日",""),j=this.filterOptions.SortType,k=this.filterOptions.RelationType;_.each(f,function(a){1==a.type?g.push({LableType:17,LableId:a.id}):2==a.type&&g.push({LableType:4,LableId:a.id})}),a.app.request("Plan:getSearchPlanData",{type:this.routerData.type,to_user_id:this.routerData.to_user_id,planTableId:this.routerData.plan_table_id,UserIds:d.join(","),Status:e.join(","),LableModels:g,planTableType:this.routerData.PlanTableType,StartDate:h,EndDate:i,SortType:j,RelationType:k,startNum:1,count:100}).done(function(a){b.routerData.isSearch=!0;var c=a.tasks||[];b.taskListNextNum=a.nextNum,b.renderPlanListByClassView(c);var d=b.filterOptions.detail_checked;d&&b._showPlanListDetail(d)})},checkUserPlanTable:function(){var b=this,c=this._getGroupPlanTableId();this.planTableView=new p({model:new a.Model(this.routerData),groupPlanTable:c}),this.planListLayout.planTable.show(b.planTableView),this.listenTo(this.planTableView,"setUp",function(){a.app.request("Message:getMessageApproval",{}).done(function(a){b._renderMessageApproval(a)})}),this.listenTo(this.planTableView,"changeType",function(){var a=b.routerData.type;"group"==a?(b.hasBindTab=!1,b.routerData.type="personal",b.routerData.isMySelf=b.routerData.to_user_id==b.userInfo.Id,b.routerModel.set(b.routerData)):(b.hasBindTab=!0,b.routerData.type="group",b.routerData.isMySelf=!1,b.routerModel.set(b.routerData))})},_renderMessageApproval:function(b){var c=b.ApplySetModel.PlanApplySets,d=_.filter(c,function(a){return a.Value?a:void 0});this.messageApprovalView=new q({collection:new a.Collection(d),model:new a.Model({ReportRules:b.ReportRules,hideDaily:!1,LableSet:b.ApplySetModel.LableSets,planApplySets:c})}),Talent.app.vent.trigger("global-pull-screen","Plan-Superior-Rules",this.messageApprovalView,{changeUrl:!1})},_rendPlanNewContentView:function(){var b=this,c=this.routerData;if(14==c.tag_id)this._renderPlanCreateView();else{if(c.IsCurrentDate)var d=v().format("YYYY/MM/DD");else var d=this._newFormatDate(c.startDate);var e=(a.Context.getGlobal("tenantBehavior").TaskPushlishPrivateType,this._newFormatDate(c.endDate));this.taskCreateView=new TaskCreateView({planTableType:c.PlanTableType,planTableId:c.plan_table_id,TaskSource:1,startDate:v(new Date(d)).format("YYYY/MM/DD 08:00"),endDate:v(new Date(e)).format("YYYY/MM/DD 18:00"),titleKey:"plan_create_title_key",editKey:"plan_create_key"}),this.listenTo(this.taskCreateView,"postData",function(c){a.app.request("Task:createTask",c).done(function(a){a&&(b.taskCreateView._submitSuccess(),b.taskCreateView.render(),b._addTaskItem(a),tAjax=!1)}).fail(function(a){b.taskCreateView._submitError(a),tAjax=!1})}),this.planListLayout.planNewItemForm.show(this.taskCreateView)}},_rendPlanNewContentView:function(){var b=this,c=this.routerData;if(14==c.tag_id)return void this._renderPlanCreateView();if(c.IsCurrentDate)var d=v().format("YYYY/MM/DD");else var d=this._newFormatDate(c.startDate);var e=this._newFormatDate(c.endDate),f=a.Context.getGlobal("tenantBehavior").TaskPushlishPrivateType;this.taskCreateView=new u.TaskCreateView({id:"Plan-Index-Page-"+this.routerData.plan_table_id,shape:"line",privateRangeOptions:{privateValue:f},dataTimeRangeOptions:{rangepickerOptions:{startDate:v(new Date(d)).format("YYYY/MM/DD 08:00"),endDate:v(new Date(e)).format("YYYY/MM/DD 18:00")}},requestSubmit:function(d){var e=new Talent.$.Deferred;return d.planTableType=c.PlanTableType,d.PlanTableId=c.plan_table_id,d.TaskSource=1,d.AddPlan=0,a.app.request("Task:createTask",d).done(function(a){b._addTaskItem(a),e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()}}),this.planListLayout.planNewItemForm.show(this.taskCreateView)},_renderPlanCreateView:function(){var b=this,c=this.routerData,d=new t;d.submitRequest=function(d){var e=new a.$.Deferred;return a.app.request("Task:createTask",{LabId:d.labId,LabType:d.labType,TaskName:d.name,TaskSource:1,planTableId:c.plan_table_id,planTableType:c.PlanTableType}).done(function(a){b._addTaskItem(a),e.resolve(a)}).fail(function(a){e.reject(a)}),e},this.planListLayout.planNewItemForm.show(d)},_addTaskItem:function(a){if(a.planTableId=this.routerData.plan_table_id,!this.planListCompositeView||0==this.planListCompositeView.collection.length)return void this.renderPlanListByClassView([a]);var b=this.planListCompositeView.collection.toJSON();b.unshift(a),this.planListCompositeView.collection.reset(b)},renderPlanListByClassView:function(b){var c=this,d=this.routerData;return d.detail_checked=!1,b&&b.length>0?(this.planTableView&&this.planTableView.showButton(d.isMySelf?!0:!1),this.planListCompositeView&&this.planListCompositeView.close(),this.planListCompositeView=new u.TaskListView({data:b,isShowStar:"group"==d.type?!1:!0,isShowOwnerTag:!0,deployAll:!1,isShowToggle:!0,isShowMoreBtn:this.taskListNextNum?!0:!1,quirkOwnerTag:!(c.routerData.to_user_id==this.userInfo.Id),hasDetailodel:!0}),this.listenTo(this.planListCompositeView,"showMore",function(a,b,c){this._requestMorePlan(c)}),this.listenTo(this.planListCompositeView,"openSub",function(a,b,c){this._getSubPlans(b,c)}),void(this.planListLayout&&this.planListLayout.planList&&this.planListLayout.planList.show(c.planListCompositeView))):(this.emptyView=new i({model:new a.Model(d)}),void(this.planListLayout&&this.planListLayout.planList&&this.planListLayout.planList.show(this.emptyView)))},_requestMorePlan:function(b){var c=this,d=this.routerData,e=this._newFormatDate(d.startDate),f=this._newFormatDate(d.endDate);a.app.request("Plan:getTaskData",{type:d.type,StartDate:e,EndDate:f,startNum:c.taskListNextNum,to_user_id:d.to_user_id,planTableId:d.plan_table_id,planTableType:d.PlanTableType}).done(function(a){var d=c.planListCompositeView,e=a.tasks||[];e=b(e),c.taskListNextNum=a.nextNum,d.collection.add(e),c.taskListNextNum||d.hideMoreBtn(),d.loadingCompelte()})},_getSubPlans:function(b){this.filterOptions=this.filterOptions?this.filterOptions:{};var c=this.routerData,d=this.filterOptions.member||[],e=this.filterOptions.status||[],f=this.filterOptions["class"]||[],g=[],h=c.startDate.replace(/年|月/g,"/").replace("日",""),i=c.endDate.replace(/年|月/g,"/").replace("日",""),j=this.filterOptions.SortType,k=this.filterOptions.RelationType,l=c.type;_.each(f,function(a){1==a.type?g.push({LableType:17,LableId:a.id}):2==a.type&&g.push({LableType:4,LableId:a.id})});var m=b.get("level");a.app.request("Plan:GetSubPlans",{type:1,to_user_id:c.to_user_id,userIds:d.join(","),status:e.join(","),LableModels:g,SortType:j,RelationType:k,PlanTableId:c.plan_table_id,PlanTableType:c.PlanTableType,StartDate:h,EndDate:i,parentTaskId:b.id,fromLevel:m,toLevel:m+1,IsTeam:"personal"==l?!1:!0}).done(function(a){b.set({tasks:a,currentDeploy:!0})})},renderPlanListCompositeView:function(){var b=this;a.$(this.planListLayout.regions.planTabExtra).hide();var c=this.routerData,d=this._newFormatDate(c.startDate),e=this._newFormatDate(c.endDate);a.app.request("Plan:getTaskData",{type:c.type,to_user_id:c.to_user_id,StartDate:d,EndDate:e,startNum:1,planTableId:c.plan_table_id,planTableType:c.PlanTableType}).done(function(a){var c=a.tasks||[];b.taskListNextNum=a.nextNum,b.renderPlanListByClassView(c),c.length>0?(b._renderPlanDataFilterView(),b.$el.find('div[data-name="plan-data-filter"]').show()):b.$el.find('div[data-name="plan-data-filter"]').hide()})},_getGroupPlanTableId:function(){var b=this.activeGroup,c=b.PlanTableListModels,d=this.routerData,e=parseInt(d.tag_id),f=a._.findWhere(c,{TagId:e}),g=f.PlanTableModels,h=g[0];return h.PlanTableId},renderPlanShareRangeCompositeView:function(){var b=this;this.planShareRangeCompositeView=new f({collection:new a.Collection(this.routerData.shareUsers),isEdit:this.routerData.isMySelf,deleteTip:"确定把ta从"+this.iPlan+"表共享里删除",userSelectOptions:{container:this.$el}}),this.listenTo(b.planShareRangeCompositeView,"add",function(a,c){b._addShareUser(a,c)}),this.listenTo(b.planShareRangeCompositeView,"delete",function(a,c){b._deleteShareUser(a,c)}),this.planListLayout&&this.planListLayout.sharerange&&this.planListLayout.sharerange.show(this.planShareRangeCompositeView,{noAnimate:!0})},_deleteShareUser:function(b,c){var d=this,e=d.planShareRangeCompositeView.collection.toJSON(),f=a._.find(e,function(a){return a.User.Id==c});a.app.request("Plan:deleteShareUserData",{to_user_id:c,tag_id:this.routerData.tag_id,group_id:this.routerData.group_id,plan_table_id:this.routerData.plan_table_id}).done(function(){b.remove();var a=d.planShareRangeCompositeView.collection.findWhere(f);d.planShareRangeCompositeView.collection.remove(a)}).fail(function(a){d.tipMessage(b,a)})},_addShareUser:function(b,c){var d=this,e=d.planShareRangeCompositeView.collection.toJSON();if(c&&c.length>0){var f=[];Talent._.each(c,function(a){d._dealRepeatUserListData(a,e)?d.tipMessage(b,"部分添加的人已存在"):f.push(a)}),f&&f.length>0&&a.app.request("Plan:addShareUserData",{tag_id:this.routerData.tag_id,group_id:this.routerData.group_id,plan_table_id:this.routerData.plan_table_id,data:f}).done(function(b){var c=[];a._.each(b.Users,function(a){c.push({Type:0,User:a})}),d.planShareRangeCompositeView.collection.add(c)}).fail(function(a){d.tipMessage(b,a)})}else d.tipMessage(b,"请选择添加人员")},_dealRepeatUserListData:function(a,b){var c=!1;return Talent._.each(b,function(b){a.Id==b.User.Id&&(c=!0)}),c},_getGroupTableNavData:function(){var b=(this.routerData,new a.$.Deferred),c=this;return b.resolve(c.getActiveTableName()),b.promise()},getActiveTableName:function(){var b,c,d=this.routerData,e=this.activeGroup.PlanTableListModels,f=(d.tag_type,d.tag_id),g=(parseInt(f)-1,a._.find(e,{TagId:Math.floor(d.tag_id)}));b=g?g.PlanTableModels:e[0].PlanTableModels,c=d.plan_table_id?a._.find(b,{PlanTableId:d.plan_table_id})||b[0]:a._.find(b,{Active:!0})||b[0],d.plan_table_id=c&&c.PlanTableId,d.plan_table_name=c&&c.Name,d.feedId=c&&c.FeedId,d.startDate=c&&c.StartDate,d.endDate=c&&c.EndDate,d.IsNotify=c&&c.IsNotify,d.IsCurrentDate=c&&c.IsCurrentDate,d.PlanTableType=c&&c.PlanTableType,_.map(b,function(a){a.encodeName=encodeURIComponent(a.Name)});var h={navData:b,routerData:d};return h},showYearDropdown:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.find(".caret"),e=d.position(),f=(d.outerWidth(),d.outerHeight()),g=this.$el.find("div[data-name=year-list] ul"),h=g.width();g.css("display")&&"none"!==g.css("display")?g.hide():(g.css({left:e.left-h/2,top:e.top+f+10}),g.show())},onClose:function(){$(window).off("resize.baseMaterLayout"),a.app.vent.off("tab:Plan-List-SiderBar:change"),a.app.vent.off("tab:Tita-Plan-Feedback-Histroy-Tab:change"),a.app.vent.off("tab:Tita-Plan-List:change"),a.app.vent.off("tab:Plan-List-Top-Nav-View:change"),a.$(".tipsy").remove()},clickTabFeedBackHistroy:function(){if(!this.hasBindTab){this.hasBindTab=!0,a.$(this.planListLayout.regions.planTabExtra).show();var b=this,c=this.$el.find(".tt_plan_feedback_histroy"),d=new e({el:c,eventTriggerName:"Tita-Plan-Feedback-Histroy-Tab",getActiveNodeByData:function(a){var b=this.$el.find("li a[type="+a+"]");return b},getActiveNodeByNode:function(a){return a}});a.$(b.planListLayout.regions.planHistroy).hide(),a.$(b.planListLayout.regions.daily).hide(),a.$(b.planListLayout.regions.planFeedBack).show();var f=a.Context.getGlobal("tenant_function"),g="feedBack";f.social||(g="daily",c.find('a[type="feedBack"]').parent().remove()),f.IsUsePlanDaily||(g="histroy",c.find('a[type="daily"]').parent().remove());var h=this.routerData.tab_name||g;d.setDefault(h),a.app.vent.off("tab:Tita-Plan-Feedback-Histroy-Tab:change"),a.app.vent.on("tab:Tita-Plan-Feedback-Histroy-Tab:change",function(a){var c=a.attr("type");b._renderBottomTab(c,!1),b._changeHash("tab_name",c)}),this._renderBottomTab(h,!0)}},_renderBottomTab:function(b,c){a.$(this.planListLayout.regions.planHistroy).hide(),a.$(this.planListLayout.regions.planFeedBack).hide(),a.$(this.planListLayout.regions.daily).hide(),"feedBack"==b?(this.renderPlanListFeedBackItemView(c),a.$(this.planListLayout.regions.planFeedBack).show()):"histroy"==b?(this.renderHistroyList(),a.$(this.planListLayout.regions.planHistroy).show()):"daily"==b&&(this.renderDailyList(),a.$(this.planListLayout.regions.daily).show())},_changeHash:function(b,c){var d=decodeURIComponent(location.hash);if(-1!=d.indexOf(b)){var e=new RegExp("("+b+"=\\w+)");d=d.replace(e,b+"="+c)}else d+=d.indexOf("?")<0?"?"+b+"="+c:"&"+b+"="+c;a.app.execute("history:navigate",d,!1)},renderDailyList:function(){this.planListDailyView=new h({model:new a.Model(this.routerData)}),this.planListLayout&&this.planListLayout.daily&&this.planListLayout.daily.show(this.planListDailyView,{noAnimate:!0})},renderPlanListFeedBackItemView:function(b){b&&(this.planListFeedbackItemView=new g({model:new a.Model(this.routerData)}),this.planListLayout&&this.planListLayout.planFeedBack&&this.planListLayout.planFeedBack.show(this.planListFeedbackItemView,{noAnimate:!0}))},renderHistroyList:function(){var b=this;a.app.request("Plan:getHistroyData",{group_id:this.routerData.group_id,tag_id:this.routerData.tag_id,plan_table_id:this.routerData.plan_table_id,to_user_id:this.routerData.to_user_id}).done(function(c){b.histroyListView=new l({collection:new a.Collection(c),emptyContext:"还没有任何"+b.iPlan+"的操作记录"}),b.listenTo(b.histroyListView,"histroyListItemView:name",function(c){var d=a.Context.parseUrl(c.attr("href"));d.to_user_id=d.to_user_id?d.to_user_id:b.userInfo.Id,d.isMySelf=d.to_user_id==b.userInfo.Id,b.routerData=d}),b.planListLayout.planHistroy&&b.planListLayout.planHistroy.show(b.histroyListView,{noAnimate:!0})}).fail(function(a){alert(a)})},changeHash:function(){var b=decodeURIComponent(location.hash).split("&plan_item_id="),c=b[0].substring(1);a.app.execute("history:navigate",c,!1)},tipMessage:function(a,b){this.delDialog||(this.delDialog=new m({type:"tipsy"}),$("body").append(this.delDialog.render().$el)),this.delDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:"warn"})},_formatDate:function(a){var b=a.match(/\d+/g);return b&&a.indexOf("年")>0&&a.indexOf("月")>0&&(b[1]=b[1]-1),b&&a.indexOf("年")<0&&a.indexOf("月")>0&&(b[0]=b[0]-1),b},_newFormatDate:function(a){var b=a.match(/\d+/g);return b.join("/")}}),y=new n({showBottom:!1,showTab:!0,model:w,type:1});return y.changeGroupRoute=function(b){var c=decodeURIComponent(location.hash),d="to_user_id="+b;-1!=c.indexOf("to_user_id")?c=c.replace(/to_user_id=\w+/,d):c+=c.indexOf("?")<0?"?to_user_id="+b:"&to_user_id="+b,-1!=c.indexOf("type")&&(c=c.replace(/type=\w+/,"type=personal")),a.app.execute("history:navigate",c,!0)},a.BasePageView.extend({mainViewClass:x,layout:window.top==window?"master-layout":"empty-layout",hideSidebar:window.top==window?!1:!0,layoutViewOptions:{hideSubMenu:!1,showRightSidebar:function(){return{showRightSidebar:!0,rightSidebarView:y}}}})});