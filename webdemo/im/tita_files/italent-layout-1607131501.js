define(["talent","templates/common","tita-common","views/common/page-regions/header-extention-view","TitaWidget","iTalent-header","iTalent-sidebar","views/more/guide/index-page-view","moment","views/common/onlineservice/onlineservice-view","views/common/system-upgrade-view"],function(Talent,JST,TitaCommon,HeaderExtentionView,TitaWidget,ITalentHeader,ITalentSidebar,GuideIndexPageView,moment,OnlineserviceView,SystemUpgradeView){var MasterLayout=Talent.BaseMasterLayout.extend({template:JST["common/layouts/italent-layout"],regions:{header:"div[data-name=header-region]",sidebar:"div[data-name=nav-region]",subNav:"div[data-name=sub-nav-region]",rightSidebar:"div[data-name=rightbar-region]",rightView:"div[data-name=rightview-region]",mainInner:"div[data-name=main-container-innner-region]"},initialize:function(){var self=this;this.userInfo=Talent.Context.getUserInfo();this.apiPath=BSGlobal["apiPath"];this.__scrollBarWidth=null;this.headerHeight=41;this.rightbarWidth=0;this.isFirstRender=true;this.model=new Talent.Model;this.model.on("change:messageRedCount",function(){self._updateMsgData()});this.model.on("change:todoRedCount",function(){self._updateTodoData()});var mCollection=Talent.Collection.extend({model:Talent.Model.extend({idAttribute:"type"})});this.indicatorCollection=new mCollection;this.todoCollection=new Talent.Collection;this.navCollection=new Talent.Collection;window.iTalentSDK&&window.iTalentSDK.register()},className:"tu-page-layout tu-height-full",regionsClass:{header:ITalentHeader,sidebar:ITalentSidebar},onShow:function(){var self=this;this.ui={pageContainer:this.$el.find(".tu-page-container"),rightSidebar:this.$el.find("div[data-name=rightbar-region]"),mainContainer:this.$el.find("div[data-name=main-container-region]"),mainInner:this.$el.find("div[data-name=main-container-innner-region]"),rightView:"div[data-name=rightview-region]"};$("html,body").css({height:"100%",overflow:"hidden"});$("#bs_layout_container").css({height:"100%"});this._getScrollBarWidth();this._getRouterData();this._renderGuideView();this._listenRouterChange();this._clearGlobalIndicator();this._renderHeadView();this._renderSidebarView();this.refresh();this._renderRightView();this._renderMessage();this._renderSystemUpgrade();var onlineserviceView=new OnlineserviceView;var resizeDelay=Talent._.debounce(function(){self._setMainInngerWidth();self._setPageLinePos()},300);$(window).off("resize.Tita-Layout");$(window).on("resize.Tita-Layout",resizeDelay)},_renderSystemUpgrade:function(){var systemUpgradeView=new SystemUpgradeView;this.$el.find(".tu-page-header").append(systemUpgradeView.render().$el)},refresh:function(){var self=this;var options=this.options;var showRightSidebar=options.showRightSidebar;if(showRightSidebar){this.rightbarWidth=65}else{this.rightbarWidth=0}if(this.hideSidebar){this.SidebarViewClass=null;this.$el.addClass("tu-page-hidesidebar")}else{this.$el.removeClass("tu-page-hidesidebar")}this._renderMainView();this._renderSidebarRight();this.trigger("refresh")},_getRouterData:function(){var self=this;Talent.app.request("history:getQueryObject").done(function(queryObject){var defaults={iTalentNavCode:"",iTalentNavId:""};self.routerData=queryObject})},_listenRouterChange:function(){var self=this;Talent.app.vent.on("route",function(fragments,params,getQueryObject){self.guideIndexPageView&&self.guideIndexPageView.close();Talent.app.request("history:getQueryObject").done(function(queryObject){var locationHash=decodeURIComponent(location.hash);var hash=locationHash.split("?")[0];if(hash=="#bench"){self._renderGuideView()}self.routerData=queryObject;self.routerData.iTalentNavCode=self.routerData.iTalentNavCode||"";self.routerData.iTalentNavId=self.routerData.iTalentNavId||"";self.sidebarView&&self.sidebarView.highLightSet({code:self.routerData.iTalentNavCode,id:self.routerData.iTalentNavId})})})},_renderGuideView:function(){var self=this;Talent.app.request("Plan:getMockDateData",{group_id:0,date:moment().format("YYYY/MM/DD")}).done(function(resp){var data=resp&&resp.Data&&resp.Data.taglist?resp.Data.taglist:[];self._getActiveData(data);self.guideIndexPageView=new GuideIndexPageView({planTableId:self.planTableId});self.ui.mainContainer.append(self.guideIndexPageView.render().$el);self._adjustGuideView();if(self.routerData["show_guide"]&&self.routerData["show_guide"]=="true"){self.guideIndexPageView.show();self.routerData["show_guide"]=false;Talent.Context.changeHash(self.routerData)}})},_adjustGuideView:function(){this.guideIndexPageView&&this.guideIndexPageView.$el.addClass("page-sidebar-anmite").css("paddingLeft",this.sidebarWidth)},_getActiveData:function(data){var groupDatas=data;this.activeGroup=Talent._.findWhere(groupDatas,{Active:true})||groupDatas[0];var tagDatas=this.activeGroup["PlanTableListModels"];var activeTagData=Talent._.findWhere(tagDatas,{Active:true})||tagDatas[0];this.planTableId=activeTagData.PlanTableModels[0].PlanTableId},_renderHeadView:function(){var tenantInfo=Talent.Context.getTenantInfo(),userInfo=this.userInfo,titaHost=Talent.Context.getGlobal("titaHost"),data={},logo=tenantInfo.Logo;if(!logo){var host=location.host;if(host.indexOf("italent")!=-1)logo=Talent.Context.getStaticUrl("images/logo_italent.png");else if(host.indexOf("tita")!=-1)logo=Talent.Context.getStaticUrl("images/logo_tita.png")}this.todoBtn={type:"Todos",iconName:"header-icon-daiban",id:"",title:"待办",href:"#more/messages?messageType=1&isRead=1",reminds:{remindCount:0,viewAllHref:"#more/messages?messageType=1&isRead=1",remindList:[]}};this.messageBtn={type:"Message",iconName:"header-icon-xiaoxi",id:"",title:"通知",href:"#more/messages?messageType=2&isRead=2",reminds:{remindCount:0,viewAllHref:"#more/messages?messageType=2&isRead=2",remindList:[]}};this.headerBtn=[{type:"Search",iconName:"header-icon-sousuo",id:"",title:"搜索同事、动态、项目等",href:"javascript:void(0)",reminds:{remindCount:0,viewAllHref:"#",remindList:[]}},{type:"HomePage",iconName:"header-icon-chanpin",id:"",title:"回到首页",href:"#sitemap",reminds:{remindCount:0,viewAllHref:"#",remindList:[]}},{type:"Settings",iconName:"header-icon-shezhi",id:"",title:"设置",href:"#set?url="+titaHost+"/u/"+userInfo.Id+"/Setting/Avatar&page_id=avatar",reminds:{remindCount:0,viewAllHref:"",remindList:[]}},this.todoBtn,this.messageBtn];data=Talent._.extend({},data,{companyInfo:{logo:logo,name:tenantInfo.Abbreviation,href:titaHost},userInfo:{name:userInfo.Name,avatar:{color:userInfo.UserAvatar.Color,hasAvatar:userInfo.UserAvatar.HasAvatar,small:userInfo.UserAvatar.Small}},oprBtn:this.headerBtn,userInfoDropDown:[{title:"个人主页",href:"#italent/home?name=TalentProfile-record",target:"_self",type:"header-mainPage"},{title:"编辑简档",href:"#more/archives",target:"_self",type:"header-editDoc"},{title:"个人设置",href:"#set?url="+titaHost+"/u/"+userInfo.Id+"/Setting/Avatar&page_id=avatar",target:"_self",type:"header-userSetting"},{title:"退出登录",href:"/Account/Logout",target:"_self",type:"header-logout"}]});this.headerView=new this.regionsClass.header(data);this.listenTo(this.headerView,"iconClickEvent",function(resp){switch(resp.type){case"Todos":{this._getTodoData()}break}});this.listenTo(this.headerView,"iconOprEvents",function(resp){switch(resp.target){case"Search":{this._search(resp.exportData)}break}});this.header.show(this.headerView);var H=this.headerView.$el.outerHeight();if(this.headerHeight!==H){this.headerHeight=H;this.ui.pageContainer.css({top:H})}},_search:function(options){var encodeval=encodeURIComponent(this._searchEncode(options.searchValue));var titaHost=Talent.Context.getGlobal("titaHost");var loginUserId=Talent.Context.getGlobal("loginUserInfo")["Id"];var urlH=titaHost+"/Search/"+loginUserId+"/Search/Home?search="+encodeval;var url="#widget/italent?iTalentFrameType=iframe&iTalentFrame="+encodeURIComponent(encodeURIComponent(urlH));window.location.href=url},_searchEncode:function(str){var s="";if(str.length==0)return"";s=str.replace(/&/g,"&amp;");s=s.replace(/</g,"&lt;");s=s.replace(/>/g,"&gt;");s=s.replace(/    /g,"&nbsp;");s=s.replace(/\'/g,"&apos;");s=s.replace(/\"/g,"&quot;");s=s.replace(/\n/g,"");return s},_parseUrl:function(){var queryHash={};var hash=decodeURIComponent(location.hash).split("?");queryHash["hash"]=hash[0];if(hash[1]&&hash[1]!==""){var queryArray=hash[1].split("&");for(var i=0;i<queryArray.length;i++){var queryPair=queryArray[i].split("=");queryHash[queryPair[0]]=queryPair[1]}}return queryHash},_renderSidebarView:function(){var SidebarViewClass=this.sidebarViewClass?this.sidebarViewClass:this.regionsClass.sidebar;if(this.SidebarViewClass!==SidebarViewClass||this.refreshSidebar){var data=Talent.Context.getGlobal("newNavigation")||[],queryHash=this._parseUrl();if(!data.length)return;for(var i=0;i<data.length;i++){var d_item=data[i];if(d_item.code===this.routerData.iTalentNavCode||d_item.id==this.routerData.iTalentNavId){Talent.Context.setPageTitle(d_item.title)}if(d_item.code=="tita-home"){d_item["indicatorType"]="feedIndicator"}if(d_item.type=="hash"){var qObject="iTalentNavId="+d_item.id+(d_item.code?"&iTalentNavCode="+d_item.code:"");if(d_item.href.indexOf("?")>0){d_item.href+="&"+qObject}else{d_item.href+="?"+qObject}}if(!d_item.children.length)continue;for(var j=0;j<d_item.children.length;j++){var j_item=d_item.children[j];var j_qObject="iTalentNavId="+j_item.id+(j_item.code?"&iTalentNavCode="+j_item.code:"");if(j_item.code===this.routerData.iTalentNavCode||j_item.id==this.routerData.iTalentNavId){Talent.Context.setPageTitle(j_item.title)}if(j_item.type=="hash"){if(j_item.href.indexOf("?")>0){j_item.href+="&"+j_qObject}else{j_item.href+="?"+j_qObject}}}}this.navCollection.reset(data);this.SidebarViewClass=SidebarViewClass;this.sidebarView=new this.SidebarViewClass({menuArry:data});this.listenTo(this.sidebarView,"layoutChanged",function(options){this.sidebarWidth=this.hideSidebar?0:options.width;if(this.hideSidebar)return;this._adjustSidebarView();this._adjustGuideView()});this.listenTo(this.sidebarView,"hashChanged",function(options){var title=options&&options.title||"italent";Talent.Context.setPageTitle(title);if(options.type=="iframe"){var url="widget/italent?iTalentNavId="+options.id+"&iTalentFrameType="+options.type+"&iTalentFrame="+encodeURIComponent(options.href);window.iTalentSDK.register({listenEvent:"__iTalentSDK_Close_Iframe",cb:function(){Talent.app.execute("history:navigate","#"+url,{trigger:true,forceTrigger:true})}});window.iTalentSDK.recycleIframe("iTalentFrame")}var indicatorType=options["indicatorType"]||null;if(indicatorType&&options.newCount){Talent.app.vent.trigger("GlobalIndicatorDelete",{indicatorType:indicatorType,messageType:0})}});this.sidebarWidth=this.sidebarView.getWidth().width;this.ui.pageContainer.css({paddingLeft:this.sidebarWidth});this.sidebar.show(this.sidebarView);this.sidebarView.highLightSet({code:this.routerData.iTalentNavCode,id:this.routerData.iTalentNavId})}else{this.ui.pageContainer.css({paddingLeft:this.sidebarWidth})}},_updateNavData:function(type){var self=this;var mapping={feedIndicator:148};this.indicatorCollection.each(function(model){var type=model.get("type");if(type=="feedAboutMeIndicator"){var name=mapping["feedIndicator"];var navModel=self.navCollection.get(name);if(!navModel)return;navModel.set("newCount",true);self.sidebarView.setMsgNotice({id:navModel.get("id"),newCount:model.get("value")>0?true:false})}})},_adjustSidebarView:function(options){var self=this;this._setMainInngerWidth();if(this.options.hideSubMenu){}else{this._setPageLinePos()}this.ui.pageContainer.addClass("page-sidebar-anmite").css("paddingLeft",this.sidebarWidth)},_setMainInngerWidth:function(){var scrollWidth=this.__scrollBarWidth.vertical||0;var sidebarWidth=this.hideSidebar?0:this.sidebarWidth;var elW=this.$el.width();this.ui.mainInner.css({width:elW-sidebarWidth-this.rightbarWidth-scrollWidth})},_renderMainView:function(){var scrollWidth=this.__scrollBarWidth.vertical||0;var sidebarWidth=this.hideSidebar?0:this.sidebarWidth;var elW=this.$el.width(),elH=this.$el.height();this.ui.mainInner.attr("style","");this.ui.mainInner.css({marginRight:this.rightbarWidth,width:elW-sidebarWidth-this.rightbarWidth-scrollWidth,minHeight:elH-this.headerHeight});var mainView=new this.mainViewClass(this.options);this.mainInner.show(mainView);this._adjustPagelinePos()},_renderSidebarRight:function(){var self=this;var options=this.options;var showRightSidebar=options.showRightSidebar;var rightSidebar=showRightSidebar&&showRightSidebar();var showRightSidebar=rightSidebar&&rightSidebar.showRightSidebar,rightSidebarView=rightSidebar&&rightSidebar.rightSidebarView;var refreshSidebarRight=rightSidebar&&rightSidebar.refreshSidebarRight?rightSidebar.refreshSidebarRight:false;this._getFragments(refreshSidebarRight);if(showRightSidebar&&this.RightSidebarView){if(!this.refreshSidebarRight)return;this.RightSidebarView=rightSidebar.rightSidebarView;this.rightSidebar.show(this.RightSidebarView);this._adjustSidebarRight()}else if(showRightSidebar&&!this.RightSidebarView){this.ui.pageContainer.append(this.ui.rightSidebar);this.RightSidebarView=rightSidebarView;this.rightSidebar.show(this.RightSidebarView);this._adjustSidebarRight()}else{this.rightSidebar.close();this.RightSidebarView=null;this.ui.rightSidebar.detach()}},_adjustSidebarRight:function(){var scrollWidth=this.__scrollBarWidth.vertical||0;this.ui.rightSidebar.css({right:scrollWidth}).show();this.ui.rightSidebar.find(".membership_right").css({right:this.__scrollBarWidth.vertical})},_adjustPagelinePos:function(){if(typeof this.options.hideSubMenu=="undefined"){this.$el.addClass("tu-page-hidesubmenu").removeClass("tu-page-dividing").removeClass("tu-page-submenu");return}if(this.options.hideSubMenu){this.$el.addClass("tu-page-hidesubmenu").removeClass("tu-page-submenu").removeClass("tu-page-dividing")}else{if(typeof this.options.isDividing!="undefined"&&this.options.isDividing){this.$el.removeClass("tu-page-hidesubmenu").removeClass("tu-page-submenu").addClass("tu-page-dividing")}else{this.$el.removeClass("tu-page-hidesubmenu").removeClass("tu-page-dividing").addClass("tu-page-submenu")}this._setPageLinePos()}},_setPageLinePos:function(){var wGide3=this.$el.find("[data-tu-submenu=tu-submenu]").width();if(typeof this.options.isDividing!="undefined"&&this.options.isDividing){this.ui.mainInner.css({backgroundPosition:wGide3-1+"px 0"})}else{this.ui.mainInner.css({backgroundPosition:-(2e3-wGide3)+"px 0"})}},_renderRightView:function(){var pullScreenLayoutView=new TitaWidget.PullScreenView({topBias:this.headerHeight,showFullScreenButton:true});this.listenTo(pullScreenLayoutView,"open",function(options){this.ui.mainContainer.stop().animate({marginRight:options.width},options.duration)});this.listenTo(pullScreenLayoutView,"closed",function(options){this.ui.mainContainer.animate({marginRight:0},options.duration)});this.rightView.show(pullScreenLayoutView)},_getFragments:function(options){var self=this;Talent.app.request("history:getFragments").done(function(fragments){self.refreshSidebarRight=options?true:false;if(Talent._.difference(self.routerFragments,fragments).length){self.refreshSidebarRight=true}self.routerFragments=fragments})},_getScrollBarWidth:function(){if(this.__scrollBarWidth)return this.__scrollBarWidth;var scrollBarHelper=document.createElement("div");scrollBarHelper.setAttribute("class","tu-scroll");scrollBarHelper.style.cssText="overflow:scroll;width:100px;height:100px; position: absolute;top:-9999px;";document.body.appendChild(scrollBarHelper);if(scrollBarHelper){this.__scrollBarWidth={horizontal:scrollBarHelper.offsetHeight-scrollBarHelper.clientHeight-1,vertical:scrollBarHelper.offsetWidth-scrollBarHelper.clientWidth}}document.body.removeChild(scrollBarHelper);return this.__scrollBarWidth},_renderMessage:function(){var self=this;this._getAjaxObjRemindData();if(this.Timer)clearInterval(this.Timer);this.Timer=setInterval(function(){self._getAjaxObjRemindData()},15e3)},_getDate:function(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if(month<10){month="0"+month}if(day<10){day="0"+day}return year+"/"+month+"/"+day},_getAjaxObjRemindData:function(){var self=this;var date=this.model.get("time")||this._getDate();var locationOrigin=location.host;var locationHash=decodeURIComponent(location.hash);var hash=locationHash.split("?")[0];if(this.apiPath.split("//")[1]===locationOrigin){var iframeWindow=window}else{var iframeWindow=$('iframe[src="'+this.apiPath+'/iframe.html"]')[0].contentWindow}var request=iframeWindow.XMLHttpRequest?new iframeWindow.XMLHttpRequest:iframeWindow.ActiveXObject?new iframeWindow.ActiveXObject("Microsoft.XMLHTTP"):new iframeWindow.XMLHttpRequest;request.open("GET",Talent.Context.getApiUrl("RemindV2/Get?dateTime=")+date,true);request.onreadystatechange=function(){if(request.readyState!==4)return;if(request.status===200){var resp=JSON.parse(request.responseText);var indicators=resp["Data"]&&resp["Data"]["indicators"]||[],reminds=resp["Data"]&&resp["Data"]["reminds"]||[];self.indicatorCollection.reset(indicators);self._setGlobalIndicator();var messageRendCount=self.indicatorCollection.get("messageIndicator")&&self.indicatorCollection.get("messageIndicator").get("value")||0;var todosIndicator=self.indicatorCollection.get("todoIndicator")&&self.indicatorCollection.get("todoIndicator").get("value")||0;self.model.set({messageRedCount:messageRendCount,todoRedCount:todosIndicator});self._renderRemindMeView(resp);self._updateNavData()}if(request.status===401){var logoutUrl=Talent.Context.getGlobal("logoutUrl")||"/Account/Logout";location.reload()}};request.setRequestHeader("Accept","*");request.setRequestHeader("Content-Type","application/json;charset=utf-8");request.setRequestHeader("X-Beisen-ts",(new Date).getTime());request.setRequestHeader("X-XSRF-Token",Talent.Context.getGlobal("webApiToken"));request.send(null)},_renderRemindMeView:function(resp){if(!this.remindmeWidgetItemView){this.remindmeWidgetItemView=new TitaCommon.RemindmeWidgetItemView;this.$el.append(this.remindmeWidgetItemView.render().$el);this.remindmeWidgetItemView.model.set({time:resp["Data"]["date"]||"",data:resp["Data"]["reminds"]||[]})}else{this.remindmeWidgetItemView.model.set({time:resp["Data"]["date"]||"",data:resp["Data"]["reminds"]||[]});this.remindmeWidgetItemView.modelDataChange()}},_setGlobalIndicator:function(data){Talent.app.vent.trigger("GlobalIndicatorUpdate",this.indicatorCollection);if(!window.BSGlobal){window.BSGlobal={}}window.BSGlobal["indicator"]=data},_clearGlobalIndicator:function(){Talent.app.vent.on("GlobalIndicatorDelete",function(options){this._requestClearIndicator(options)},this)},_requestClearIndicator:function(options){var defaults={indicatorType:"",messageType:"",indicatorNum:0};var self=this;var options=Talent._.extend({},defaults,options);Talent.app.request("Indicator:indicatorClear",{messageType:options["messageType"]||0,indicatorType:options["indicatorType"]||""}).done(function(resp){if(options["indicatorType"]==""&&options["indicatorNum"]){var removeModel=self.indicatorCollection.where({messageType:options["messageType"]});self.indicatorCollection.remove(removeModel);if(options["messageType"]==1){self._reduce_messageIndicator(options["indicatorNum"])}if(options["messageType"]==2){self._reduce_totoIndicator(options["indicatorNum"])}return}var type=options["indicatorType"].split(",");for(var i=0;i<type.length;i++){var itemType=type[i];var model=self.indicatorCollection.get(itemType);if(!model)continue;var value=Number(model.get("value"))||0;if(value==0)continue;self.indicatorCollection.remove(model);var msgs=["mCommentIndicator","mLeaveIndicator","mLeaveAllIndicator","mWorkIndicator","mfollowIndicator","mLeaveWorkIndicator","mLeaveDepartmentIndicator","mtitaIndicator","messageIndicator","mSuccessionIndicator","mRecruitIndicator","mEMPIndicator","mTalentReviewIndicator","mGoalIndicator","mApprove","mApprovalCentre","mtitadashang","mTaoShangIndicator"];var todos=["todotitaIndicator","todoIndicator","tSuccessionIndicator","tRecruitIndicator","tEMPIndicator","tTalentReviewIndicator","tGoalIndicator","tApprove"];if(Talent._.indexOf(msgs,itemType)>-1){self._reduce_messageIndicator(value)}if(Talent._.indexOf(todos,itemType)>-1){self._reduce_totoIndicator(value)}if(itemType=="feedAboutMeIndicator"){var navModel=self.navCollection.get(148);if(!navModel)return;navModel.set("newCount",true);self.sidebarView.setMsgNotice({id:navModel.get("id"),newCount:false})}}})},_reduce_messageIndicator:function(num){var model=this.indicatorCollection.get("messageIndicator")||new Talent.Model,orginNum=model.get("value")||0;var res=orginNum-num<0?0:orginNum-num;model.set("value",res);this.model.set("messageRedCount",res)},_reduce_totoIndicator:function(){var model=this.indicatorCollection.get("todoIndicator")||new Talent.Model,orginNum=model.get("value")||0;var res=orginNum-num<0?0:orginNum-num;model.set("value",res);this.model.set("todoRedCount",res)},_getMessageListData:function(num){var messageListData=this.indicatorCollection.where({messageType:1})||[];var data=[];if(!messageListData.length)return[];for(var i=0;i<messageListData.length;i++){var item=messageListData[i];var urlClassName=this._getMessageUrl(item);data.push({content:item.get("content"),date:"",length:item.get("value"),className:urlClassName.className,href:urlClassName.url})}return data},_getMessageUrl:function(model){var type=model.get("type"),indicatorType=model.get("indicatorType"),appId=model.get("appId");appType=model.get("appType");var url={className:"header-icon-reply",url:"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType};switch(type){case"mCommentIndicator":url={className:"header-icon-reply",url:"#more/indicatormsg?indicatorType="+indicatorType};break;case"mLeaveIndicator":url={className:"header-icon-at-me",url:"#more/indicatormsg?indicatorType="+indicatorType};break;case"mTaoShangIndicator":url={className:"header-icon-ex-reward",url:"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType};break;case"mLeaveAllIndicator":url={className:"header-icon-at-notice",url:"#more/indicatormsg?indicatorType="+indicatorType};break;case"mWorkIndicator":url={className:"header-icon-work-notice",url:"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType};break;case"mfollowIndicator":url={className:"header-icon-fans",url:"#staff?name=fans"};break;case"mLeaveWorkIndicator":url={className:"header-icon-at-project",url:"#more/indicatormsg?indicatorType="+indicatorType};break;case"mLeaveDepartmentIndicator":url={className:"header-icon-at-department",url:"#more/indicatormsg?indicatorType="+indicatorType};break;case"mLeaveTeamIndicator":url={className:"header-icon-at-team",url:"#more/indicatormsg?indicatorType="+indicatorType};break;case"mtitadashang":url={className:"header-icon-in-reward",url:"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType};break;case"mTeamIndicator":url={className:"header-icon-work-notice",url:"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType};break}return url},_updateMsgData:function(){var remindsListData=this._getMessageListData();this.messageBtn.reminds=Talent._.extend({},this.messageBtn.reminds,{remindCount:this.model.get("messageRedCount"),remindList:remindsListData||[]});this.headerView.reloadMessage(this.messageBtn)},_getTodoData:function(){var self=this;Talent.app.request("Todo:getTodoData:",{pageNum:1,page_size:50,status:1}).done(function(resp){var arr=[];if(resp.todos){resp.todos.length>5?arr=resp.todos.slice(0,5):arr=resp.todos}self.todoCollection.reset(arr);self._updateTodoData(arr)}).fail(function(msge){})},_updateTodoData:function(arr){if(arr){var remindListData=this._getRemindListData();this.todoBtn.reminds=Talent._.extend({},this.todoBtn.reminds,{remindList:remindListData})}else{this.todoBtn.reminds=Talent._.extend({},this.todoBtn.reminds,{remindCount:this.model.get("todoRedCount"),remindList:[]})}this.headerView.reloadMessage(this.todoBtn)},_getRemindListData:function(){var todo=this.todoCollection.toJSON();var data=[],self=this;for(var i=0;i<todo.length;i++){var item=todo[i];data.push({userName:item.User.name,userPic:item.User.avatar.Medium,teskName:item.subTitle,data:item.createDate,taskContent:item.content,href:self._getUrl(item),avatar:{color:item.User.avatar.Color,hasAvatar:item.User.avatar.HasAvatar,medium:item.User.avatar.Medium}})}return data},_getUrl:function(obj){var type=obj["todoType"],host="//"+location.host+location.pathname,url=host+"#more/messages?messageType=1",isPush=obj["isPush"];if(obj["objUrl"]&&obj["objUrl"]!=""){return obj["objUrl"]}if(type==1){if(isPush){url+="&pullScreeId="+obj["objId"]+'&pullScreenOpen=true&pullScreenType=task"'}else{url=obj["objUrl"]}}else if(type==2){url=host+"#more/apply?name=plan"}else if(type==3){url=host+"#more/apply?name=work"}else if(type==4){url=obj["objUrl"]}return url}});return new MasterLayout});
//# sourceMappingURL=http://sourcemap.beisen.co/ux/tita-web-v4/hotfix/app/scripts/views/common/layouts/italent-layout-1607131501.min.map