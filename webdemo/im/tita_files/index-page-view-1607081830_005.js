/*! tita-web-v4 - v0.4.0 - 2016-07-08 18:31 */define("templates/widget",[],function(){return this.JST=this.JST||{},this.JST["widget/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<ul class="tt_pubtab" data-name="pubtab">\n	<li class="active"><a href="javascript:void(0);" title="">'+(null==(__t=i18n.publishshare_1)?"":__t)+'</a></li>\n	<li><a href="javascript:void(0);" title="">写日报</a></li>\n</ul>\n<div class="pubblog_home" data-name="pubblog"></div>\n<div class="pubtask_home" data-name="pubtask"></div>\n<div class="pubdaily_home" data-name="pubdaily"></div>\n<div class="feed_home" data-name="feedlist"><div class="_tt_loading_m">努力加载中…</div></div>';return __p},this.JST["widget/tab-comment-track/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="tu-tabbable-line">\n	<ul class="tu-nav-tabs ">\n		<li class="active">\n			<a href="javascript:void(0);">协作</a>\n		</li>\n	</ul>\n	<div class="tu-nav-content" data-name="comment-track">\n		<div data-name="track" style="margin-top:30px;"></div>\n		<div style="border:1px solid #E4EBF0;height:0;overflow:hidden;margin:20px 0"></div>\n		<div data-name="comment" style=""></div>\n	</div>\n	\n</div>';return __p},this.JST}),define("views/common/loading-view",["talent"],function(a){return a.ItemView.extend({template:a._.template('<img src="'+a.Context.getStaticUrl("images/loading_v1.gif")+'"><span>&nbsp;加载中...</span>'),className:"_tt_common_loading",hide:function(){this.$el.hide()},show:function(){this.$el.show()}})}),define("views/common/empty-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{emptyContext:""},template:b["common/empty"],className:"tt_common_emptyinit",initialize:function(a){this.settings=Talent._.extend({},this.defaults,a)},templateHelpers:function(){var a=this.settings.emptyContext?this.settings.emptyContext:this.model.get("emptyContext"),b=0;return a&&(b=a.replace(/<[^>].*?>/g,"").replace(/[&nbsp;]/g,"").length),{emptyContext:a,className:b>24?"small_content_emptyinit":"content_emptyinit"}}})}),define("templates/bench",[],function(){return this.JST=this.JST||{},this.JST["bench/bench-daily-group-empty"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="bench_right_chart_empty">\n	<div class="top_brce">如果团队提交了日报<br />将呈现类似如下统计图表</div>\n	<div class="cont_brce"><img src="'+(null==(__t=imgUrl)?"":__t)+'" alt="" /></div>\n</div>';return __p},this.JST["bench/bench-daily-group"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div data-name="bench-daily-container">\n	<div class="top_gyd">'+(null==(__t=unSubmitTotal)?"":__t)+"人未提交  尚有"+(null==(__t=unEvaluateTotal)?"":__t)+'人未评价</div>\n	<div data-name="bench-daily-chart" class="chart_gyd"></div>\n	<div class="action_gyd" >\n		<a href="#daily?type=group&iTalentNavCode=tita-daily" class="btn">查看团队所有日报</a>\n		<button class="btn" data-name="bench-daily-sendnotice">&nbsp;通知大家写日报&nbsp;</button>\n	</div>\n</div>';return __p},this.JST["bench/bench-daily-my"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+="<p>\n	",dailySubmit?(__p+="\n		",__p+=3==dailySubmit.submitType?'<span class="icon-dialog-closed-warn icon_d"></span>':'<span class="icon-right icon_d"></span>',__p+='<span class="status_dc">'+(null==(__t=dailySubmit.submitContent)?"":__t)+"</span>\n	"):__p+='\n		<span class="icon-dialog-closed-warn icon_dc"></span><span class="status_dc">'+(null==(__t=dailySubmit.submitContent)?"":__t)+"</span>\n	",__p+="\n</p>\n",__p+=evaluation?'\n	<div class="evaluation_d"><span>评价：'+(null==(__t=_.evaluation(evaluation))?"":__t)+"</span></div>\n":'\n	<div class="evaluation_d">\n		<span>评价：暂无</span>\n	</div>\n',__p+="\n",__p+=dailySubmit&&3!=dailySubmit.submitType?'\n<div class="action_d"><a href="#daily?dailyId='+(null==(__t=dailyId)?"":__t)+'&iTalentNavCode=tita-daily" class="btn">'+(null==(__t=evaluation?"查看":"修改")?"":__t)+"</a></button>\n":'\n<div class="action_d"><button class="btn" data-name="write-daily">写日报</a></button>\n';return __p},this.JST["bench/bench-daily"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm">\r\n			<span class="name_bbm">',__p+="my"==type?"我的今日日报":"团队今日日报",__p+='</span>\r\n		</div>\r\n	</div>\r\n	<div class="cont_bbm" data-name="bench-daily-container">\r\n		\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-export-daily"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<a data-name="export" href="javascript:void(0)" class="btn" style="display:block;">导出日报</a>\n<div class="popArea" data-name="popArea" style="position:relative;"></div>\n<div class="addUserArea" data-name="addUserArea"></div>';return __p},this.JST["bench/bench-my-group"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm">\r\n			<span class="name_bbm tt-guide" data-link="//help.tita.com/ProPrice/VersionPrice">我的团队</span>\r\n		</div>\r\n		<div class="right_bbm">\r\n			<span class="down_bbm t" data-name="drop-down" original-title ="团队操作" ><span class="icon-arrow-down icon-arrow-down-disabled"></span></span>\r\n		</div>\r\n	</div>\r\n	<div class="cont_bbm">\r\n		<div class="bench_my_group" data-name="content">\r\n			\r\n		</div>\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-my-plan-component"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_bench_myplan">\r\n	<div data-name="week-box"></div>\r\n	<div data-name="plan-cereate-form"></div>\r\n	<div data-name="plan-data-filter"></div>\r\n	<div class="tt_expire_bench_plan_list" data-name="bench-expire-plan-area">\r\n		<div class="tt_bench_planlist_title" data-name=\'expire-title\'>\r\n			<span class="today_plt expire_plt" original-title="收起" data-name="toggle-expire">\r\n				<span class="txt">\r\n					',__p+=date!=today&&date<today?(null==(__t=_.formatStringDate(date,"MM月DD日"))?"":__t)+"过期的"+(null==(__t=i18n.plan_1)?"":__t):"已过期",__p+='\r\n				</span>\r\n				<span class="icon icon-w-arrow-up-double"></span>\r\n			</span>\r\n		</div>\r\n		<div data-name="expire-plan-list">\r\n			<div class="_tt_loading_m">努力加载中…</div>\r\n		</div>\r\n		\r\n	</div>\r\n	\r\n	<div class="tt_bench_plan_list" data-name="bench-plan-area">\r\n		<div class="tt_bench_planlist_title" data-name="plan-title">\r\n			<span class="today_plt" original-title="收起" data-name="toggle-today">\r\n				<span class="txt">\r\n					',__p+=date!=today&&date<today?(null==(__t=_.formatStringDate(date,"MM月DD日"))?"":__t)+"的"+(null==(__t=i18n.plan_1)?"":__t):"当前"+(null==(__t=i18n.plan_1)?"":__t),__p+='\r\n				</span>\r\n				<span class="icon icon-w-arrow-up-double"></span>\r\n			</span>\r\n		</div>\r\n		<div data-name=\'plan-list\'>\r\n			<div class="_tt_loading_m">努力加载中…</div>\r\n		</div>\r\n		\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-note"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="bench-basic-modules">\n	<div class="title_bbm">\n		<div class="left_bbm">\n			<span class="name_bbm tt-guide" data-link="//help.tita.com/ProPrice/VersionPrice">便签</span>\n		</div>\n	</div>\n	<div class="cont_bbm">\n		<div class="bench_note" data-name="content">\n			\n		</div>\n	</div>\n</div>';return __p},this.JST["bench/bench-unaccept-task-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="task">\n	',isTita&&!isQqUse?(__p+="\n		",__p+=isPush?'\n		<span data-name="push" data-trigger="false"  class="task-name" id="'+(null==(__t=feedId)?"":__t)+'">'+(null==(__t=_.substring(taskName,18,!0))?"":__t)+"</span>\n		":'\n			<a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="task-name">'+(null==(__t=_.substring(taskName,18,!0))?"":__t)+"</a>\n		",__p+="\n	"):__p+='\n		<a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="task-name">'+(null==(__t=_.substring(taskName,18,!0))?"":__t)+"</a>\n	",__p+="\n	\n\n	",cycleId>0&&(__p+='\n		<span class="icon-task-cycle"  data-handler="ShowTitle"></span>\n	'),__p+="\n	",isNew&&(__p+='<span class="icon-new"></span>'),__p+='\n</div>\n<div class="organiser">\n	',__p+=showPrincipal?'\n		<span class="l">负责人：'+(null==(__t=principalUser)?"":__t)+"</span>\n	":'\n		<span class="l">发起人：'+(null==(__t=publishUser)?"":__t)+"</span>\n	",__p+='\n	<span class="r">'+(null==(__t=createDate)?"":__t)+"</span>\n</div>";return __p},this.JST["bench/bench-unaccept-task"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm">\r\n			<span class="name_bbm">\r\n				'+(null==(__t=title)?"":__t)+"（"+(null==(__t=Total)?"":__t)+"）\r\n			</span>\r\n		</div>\r\n		",showAllBtn&&(__p+='\r\n				<a class="all" href="'+(null==(__t=showAllUrl)?"":__t)+'">全部</a>\r\n			'),__p+='\r\n	</div>\r\n	<div class="cont_bbm">\r\n		<div class="bench_shi_to_accept_task">\r\n			<div class="list_stat">\r\n				\r\n			</div>\r\n			',Total>5&&(__p+='\r\n			<div class="page_stat">\r\n				<span class="icon-arrow-left icon-arrow-left-disabled" data-name="prev"></span>\r\n				<span class="icon-arrow-right" data-name="next"></span>\r\n			</div>\r\n			'),__p+="\r\n		</div>\r\n	</div>\r\n</div>";return __p},this.JST["bench/bench-undetermine-plan"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<a class="btn" href="#plan?&iTalentNavCode=tita-plan&tag_type=1&amp;tag_id=14" style="display:block;">待定计划('+(null==(__t=total)?"":__t)+")</a>";return __p},this.JST["bench/bench-week-composite"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="tt_bench_plan_time">\r\n	<div class="left">\r\n		<div class="left_time" data-name="date-box">\r\n			<span class="week" data-name="week">'+(null==(__t=week)?"":__t)+'</span>\r\n			<span class="date"><span data-name="month">'+(null==(__t=month)?"":__t)+'</span>月<span data-name="day">'+(null==(__t=date)?"":__t)+'</span>日<br/><span data-name="year">'+(null==(__t=year)?"":__t)+'</span>年</span>\r\n		</div>\r\n	</div>\r\n	<div class="right">\r\n		<ul class="right_week" data-name="week-list"></ul>\r\n	</div>\r\n</div>\r\n\r\n';return __p},this.JST["bench/bench-week-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="name_list">\r\n	<a data-trigger="false" href="javascript:void(0);">'+(null==(__t=CName)?"":__t)+'</a>\r\n</span>\r\n\r\n<span class="caret"></span>\r\n';return __p},this.JST["bench/bench-week-plan-implementation-empty"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench_right_chart_empty">\r\n	<div class="top_brce">如果制定了'+(null==(__t=i18n.plan_1)?"":__t)+' <br />将呈现类似如下统计图表</div>\r\n	<div class="cont_brce"><img src="'+(null==(__t=imgUrl)?"":__t)+'" alt="" /></div>\r\n	',showBottom&&(__p+='\r\n	<div class="bot_brce">现在就去 <a href="'+(null==(__t=planUrl)?"":__t)+'" title="" target="_blank">填写我的'+(null==(__t=i18n.plan_1)?"":__t)+"</a></div>\r\n	"),__p+="\r\n</div>";return __p},this.JST["bench/bench-week-plan-implementation"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm my_week_left_bbm">\r\n			<div class="myWeekPlanList">\r\n				<span class="name_bbm" data-name=\'title\' data-type="4">我本周'+(null==(__t=i18n.plan_1)?"":__t)+'执行情况</span>\r\n				<span class="icon-arrow-down" data-name="drop-down"></span>\r\n				<ul class="bench-drop-down" data-name="drop-down-box">\r\n					<li data-type="4" class="current">我本周'+(null==(__t=i18n.plan_1)?"":__t)+'执行情况</li>\r\n					<li data-type="3">我本月'+(null==(__t=i18n.plan_1)?"":__t)+'执行情况</li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="cont_bbm">\r\n		<div class="bench_weekplanstatus">\r\n			<div class="charts_wps" data-name="week-plan-status"></div>\r\n			<div class="init_wps" data-name="week-plan-empty"></div>\r\n		</div>\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-work-hour-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span data-name="push"  id="'+(null==(__t=feedId)?"":__t)+'" class="left">\n	'+(null==(__t=_.substring(taskName,16,!0))?"":__t)+'\n</span>\n<span class="right">（'+(null==(__t=hours)?"":__t)+"h）</span>";return __p},this.JST["bench/bench-work-hour"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench-basic-modules">\n	<div class="title_bbm">\n		<div class="left_bbm">\n			<span class="name_bbm">\n				'+(null==(__t=title)?"":__t)+"（"+(null==(__t=totalWorkHour)?"":__t)+'h）\n			</span>\n		</div>\n	</div>\n	<div class="cont_bbm">\n		<div class="bench_shi_to_accept_task">\n			<div class="list_stat">\n				\n			</div>\n			',0/0===Total&&(__p+='\n			<div class="page_stat">\n				<span class="icon-arrow-left icon-arrow-left-disabled" data-name="prev"></span>\n				<span class="icon-arrow-right" data-name="next"></span>\n			</div>\n			'),__p+="\n		</div>\n	</div>\n</div>";return __p},this.JST["bench/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='\n<div class="tt_tab_page">\n	<ul class="tab_tp" data-name="bench-tab">\n		<li class="active" data-type="my"><a href="#bench?type=my" data-trigger="false">我的工作</a></li>\n		<li data-type="group"><a href="#bench?type=group"  data-trigger="false">团队工作</a></li>\n	</ul>\n	<span class="down_tb" ><a href="javascript:void(0);" class="tt-guide" data-name="intro-plan"><span class="icon-light"></span>'+(null==(__t=i18n.plan_1)?"":__t)+'入门</a></span>\n</div>\n\n<div class="_tt_layout_home_right" data-name="right-container">\n	<div class="tt_enter_tms" data-name="enter-tms"></div>\n	<div class="un-basic-modules">\n		<a class="btn" href="#more/tasks?relation=2" style="display:block;">'+(null==(__t=i18n.task_1)?"":__t)+'中心</a>\n	</div>\n	<div data-name="bench-right-1"></div>\n	<div data-name="bench-right-2"></div>\n	<div data-name="bench-right-3"></div>\n	<div data-name="bench-right-4"></div>\n	<div data-name="bench-right-5"></div>\n	<div data-name="bench-right-6"></div>\n	<div class="bench-right-7" data-name="bench-right-7"></div>\n	<div data-name="bench-right-8"></div>\n	<div data-name="bench-right-9"></div>\n	<div data-name="bench-right-10"></div>\n</div>\n<div class="_tt_layout_home_container">\n	<!-- <div data-name="bench-plan-form"></div> -->\n	<div data-name="bench-plan"></div>\n</div>\n<div class="_tt_pagebottomline"></div> \n';return __p},this.JST}),define("views/bench/bench-unaccept-task-view",["talent","templates/bench","$.tipsy","tdialog"],function(a,b){var c=a.ItemView.extend({template:b["bench/bench-unaccept-task-item"],tagName:"li",ui:{icon_cycle:".icon-task-cycle"},events:{'mouseenter [data-handler="ShowTitle"]':"_showTitle"},onRender:function(){var a=this.ui.icon_cycle,b=this;this.hasRequested=!1,a.on("mouseenter",function(){b._showTitle()})},initialize:function(){},templateHelpers:function(){return this.options},_showTitle:function(){var b=this;b.hasRequested||(b.hasRequested=!0,a.app.request("Task:getCycleTask",{cycle_id:this.model.get("CycleId")}).done(function(a){var c=a.CycType,d=a.CycStartDate,e=a.CycEndDate,f={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七"},g={1:"每天",2:"每个工作日",3:"每周"+(d==e?f[d]:f[d]+"-"+f[e]),4:"每月"+(d==e?d:d+"-"+e)};b.ui.icon_cycle.attr({"original-title":g[c]}),b.ui.icon_cycle.tipsy({gravity:"s"}),b.ui.icon_cycle.trigger("mouseenter")}).fail(function(a){b._tipMessage(b.ui.icon_cycle,a)}))},_tipMessage:function(a,b,c){this.failDialog||(this.failDialog=new Tdialog({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"bottomCenter",arrow:!1,autoHide:!0,className:c||"warn"})},onClose:function(){this.failDialog&&this.failDialog.close()}});return a.CompositeView.extend({template:b["bench/bench-unaccept-task"],defaults:{showAllBtn:!1,showAllUrl:"",title:"我待接受的任务",showPrincipal:!1,isQqUse:!1},itemView:c,itemViewContainer:".list_stat",tagName:"ul",ui:{prev:"span[data-name=prev]",next:"span[data-name=next]",taskName:'[data-name="push"]'},events:function(){var a={};return a["click "+this.ui.prev]="_prevHandler",a["click "+this.ui.next]="_nextHandler",a["click "+this.ui.taskName]="_onClickName",a},initialize:function(b){this.pageIndex=1,this.pageSize=5,this.options=b,this.options.emptyView&&(this.emptyView=this.options.emptyView),this.settings=a._.extend({},this.defaults,this.options)},templateHelpers:function(){return this.settings},onRender:function(){var b=this;this.total=this.model.get("Total")||1,this.pageNum=Math.ceil(this.total/this.pageSize);a.app.request("history:getQueryObject").done(function(a){b.routerData=a;b.collection.get(a.plan_item_id);a.plan_item_id})},_onClickName:function(a){a.stopPropagation();var b=this,c=b.$(a.currentTarget),d=c.attr("id");Talent.app.vent.trigger("global-pull-screen",d,"task")},itemViewOptions:function(){return delete this.settings.model,delete this.settings.collection,this.settings},_prevHandler:function(b){var c=a.$(b.currentTarget);this.pageIndex-=1,this.ui.next.removeClass("icon-arrow-right-disabled"),c.hasClass("icon-arrow-left-disabled")||(1==this.pageIndex&&(this.pageIndex=1,c.addClass("icon-arrow-left-disabled")),this.trigger("click:prev",this.pageIndex))},_nextHandler:function(b){var c=a.$(b.currentTarget);this.pageIndex+=1,this.ui.prev.removeClass("icon-arrow-left-disabled"),c.hasClass("icon-arrow-right-disabled")||(this.pageIndex==this.pageNum&&(this.pageIndex=this.pageNum,c.addClass("icon-arrow-right-disabled")),this.trigger("click:next",this.pageIndex))},onClose:function(){}})}),define("views/bench/bench-drop-down-view",["talent"],function(a){var b=a.ItemView.extend({template:a._.template('<a href="<%=href%>" title="" class="<%=css%>"><%=name%></a>'),tagName:"li",templateHelpers:function(){return{href:this.model.get("url")||"javascript:void(0);"}},onRender:function(){var a=this.model.get("type");a&&this.$el.attr("data-type",this.model.get("type"))}});return a.CollectionView.extend({tagName:"ul",className:"bench-drop-down",itemView:b,itemViewContainer:this.$el,initialize:function(){var b=this;this.isOpen=!1,a.$(document).off("click.Bench-Drop-Down-View"),a.$(document).on("click.Bench-Drop-Down-View",function(){b.hide()})},events:function(){var a={};return a["click li"]="_liClickHandler",a},onClose:function(){a.$(document).off("click.Bench-Drop-Down-View")},_liClickHandler:function(b){var c=a.$(b.currentTarget);this.hide(),this.trigger("selected",{type:c.attr("data-type"),name:c.html()})},show:function(a,b){if(this.isOpen)return this.isOpen=!1,void this.$el.hide();var c=a.offset(),d=a.height(),e=a.width(),f=this.$el.width();this.$el.find("a").removeClass("current"),this.$el.find("li[data-type="+b+"]").find("a").addClass("current"),this.$el.css({top:c.top+d,left:c.left-f+e,"z-index":99}).show()},hide:function(){this.$el.hide()}})}),define("views/bench/bench-week-plan-implementation-view",["talent","templates/bench","views/bench/bench-drop-down-view"],function(a,b,c){return a.ItemView.extend({defaults:{from:"tita"},template:b["bench/bench-week-plan-implementation"],emptyTemplate:b["bench/bench-week-plan-implementation-empty"],ui:{content:"div[data-name=week-plan-status]",dropDown:".myWeekPlanList",dropDownBtn:"span[data-name=drop-down]",dropDownBox:"ul[data-name=drop-down-box]",title:"span[data-name=title]",empty:"div[data-name=week-plan-empty]"},events:function(){var a={};return a["click "+this.ui.dropDown]="_showDropDownHandler",a["mouseover "+this.ui.dropDown]="_planColorBlue",a["mouseout "+this.ui.dropDown]="_planColorGray",a},templateHelpers:function(){return{i18n:this.i18n,from:this.settings.from}},modelEvents:{"change:data":"changeData"},initialize:function(){var b=this;this.i18n=a.Context.getI18n(),this.userInfo=a.Context.getUserInfo(),this.settings=a._.extend({},b.defaults,b.options),this.dropDownIsOpen=!1,this.routerModel=this.options.routerModel},changeData:function(){var a=this;require(["highCharts"],function(){a._showChat()})},onShow:function(){var b=this.routerModel.get("type");"group"==b&&this.ui.title.html("团队本周"+this.i18n.plan_1+"执行情况"),require(["highCharts"],function(){c._showChat()});var c=this;a.$("body").off("click.tdialogWeekPlan"),a.$("body").on("click.tdialogWeekPlan",function(){c.benchDropDownView&&c.benchDropDownView.hide()})},_planColorBlue:function(a){$(a.currentTarget).find(".icon-arrow-down").addClass("icon-arrow-down-blue")},_planColorGray:function(a){$(a.currentTarget).find(".icon-arrow-down").removeClass("icon-arrow-down-blue")},_showDropDownHandler:function(b){b.stopPropagation();var d=a.$(b.currentTarget),e=d.find("span[data-name=title]"),f=e.attr("data-type"),g=this.i18n.plan_1;if(!this.benchDropDownView){var h=this.routerModel.get("type"),i=[{name:"我本周"+g+"执行情况",type:"4",href:"javascript:void(0)",css:""},{name:"我本月"+g+"执行情况",type:"3",href:"javascript:void(0)",css:""}];if("group"==h)var i=[{name:"团队本周"+g+"执行情况",type:"4",href:"javascript:void(0)",css:""},{name:"团队本月"+g+"执行情况",type:"3",href:"javascript:void(0)",css:""}];this.benchDropDownView=new c({collection:new a.Collection(i)}),this.listenTo(this.benchDropDownView,"selected",function(a){this.ui.title.html(a.name).attr("data-type",a.type),this.trigger("switch",a)},this),a.$("body").append(this.benchDropDownView.render().$el)}this.benchDropDownView.show(d,f)},_showChat:function(){var a=this.model.get("data"),b=0,c=0;if(!a||!a.length)return void this._emptyFun();for(var d={"已完成":"#1bd0dc","进行中":"#009944","已延期":"#f9b700","已取消":"#eb6877","未开始":"#eb6100","暂停中":"#8c92cb"},e=0,f=0,g=0;g<a.length;g++)c+=a[g].y,e+=a[g].y,"已完成"==a[g].name&&(f=g),a[g].color=d[a[g].name]||"#0f0";if(a[f].sliced=!0,a[f].selected=!0,b=Math.ceil(a[f].y/e*100),0==c)return void this._emptyFun();this.ui.empty.hide(),this.ui.content.show(),this.ui.content.highcharts({chart:{type:"pie",width:190,height:190},credits:{enabled:!1},title:{text:b+"%",align:"center",style:{fontSize:"26px",fontFamily:"Arial",fontWeight:"bold",color:"#1bd0dc"},y:65,x:-35},tooltip:{enabled:!0,pointFormat:"{series.color}",valueSuffix:"%"},plotOptions:{pie:{allowPointSelect:!0,allowPointSelect:!0,cursor:"pointer",showInLegend:!0,innerSize:"85%",center:[30,20],point:{events:{legendItemClick:function(){return!1}}},events:{click:function(a){var b=Math.ceil(a.point.percentage);h.setTitle({text:b+"%",align:"center",y:55,x:-35,style:{fontSize:"26px",fontFamily:"Arial",color:a.point.color}})}}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",itemMarginBottom:5,y:-10,x:10,itemStyle:{color:"#8a8a8a"}},xAxis:{categories:["进行中","已完成","已延期","已取消","未开始","暂停中"]},series:[{type:"pie",name:"",data:a}]}).show();var h=this.ui.content.highcharts()},_emptyFun:function(){var b=this.routerModel.get("type"),c={i18n:this.i18n,imgUrl:a.Context.getStaticUrl("images/bench/chart_3.jpg"),planUrl:"widget"==this.settings.from?"/u/"+this.userInfo.Id+"Home#plan":"#plan",showBottom:"my"==b?!0:!1},d=this.emptyTemplate(c);this.ui.empty.html(d).show(),this.ui.content.hide()}})}),define("views/common/italent/base-module-item-view",["talent","templates/common","simplemodal"],function(a,b,c){return a.CompositeView.extend({baseTemplate:b["common/italent/base-module-item"],tfootTemplate:a._.template('<%if(typeof(editable)!=="undefined"&& editable == 1){%><div class="edit_tmi" ><a href="javascript:void(0);" data-name="edit">编辑</a></div><%}%>'),ui:{main:"#talent_basic_module_main",load:".talent_basic_module_load"},regions:{main:"#talent_basic_module_main"},events:{"click  a[data-name=edit]":"editHandler"},modelEvents:{change:"modelChangeFun"},modelChangeFun:function(){this.onRender&&this.onRender(),this.onShow&&this.onShow()},renderModel:function(){var b={};b=this.serializeData(),b=this.mixinTemplateHelpers(b),b.loadimgurl=a.Context.getStaticUrl("images/load_m.gif");var c=this.baseTemplate,d=Marionette.Renderer.render(this.tfootTemplate,b);b.tfootTemplate=d;var e=Marionette.Renderer.render(c,b),f=this.$el.find(this.ui.main);return f.length>0&&f.html(),e},getData:function(){var b=new a.$.Deferred;return b.promise()},editHandler:function(b,d){b.preventDefault();var e=this,f={title:e.model.get("title"),url:e.model.get("edit_url")},d=a._.extend({},f,d),g=decodeURIComponent(d.url);g+=g.indexOf("?")>0?"&sureCall=sureCallback&cancelCall=cancelCallback":"?sureCall=sureCallback&cancelCall=cancelCallback",window.sureCallback=function(){e.getItemViewData(),e.editDialog.remove()},window.cancelCallback=function(){e.editDialog.remove()};var h=d.title,i='<iframe allowTransparency="true" src="'+g+'" width="100%" height="400" frameborder="0" scrolling="auto"> </iframe>',j=a.Context.getModuleLoading(),k='<div><div class="simplemodal-title">'+h+'</div><div class="simplemodal-box">'+j+"</div></div>";this.editDialog=new c({autoResize:!0,minHeight:480,minWidth:700,containerCss:{backgroundColor:"#fff",border:"1px solid #c5c5c5"},onClose:function(){e.editDialog.remove(),e.getItemViewData(),window.sureCallback=null,window.cancelCall=null}}),this.editDialog.render(k).appendTo(this.$el);var l=document.createElement("iframe");l.style.display="none",l.name="rrrrr",l.attachEvent?l.attachEvent("onload",function(){l.style.display="block",e.editDialog.$el.find(".simplemodal-box").html(i)}):l.onload=function(){l.style.display="block",e.editDialog.$el.find(".simplemodal-box").html(i)},l.src=g,e.editDialog.$el.find(".simplemodal-box").append(l)},getItemViewData:function(){var b=this;a.$.ajax({url:a.Context.getApiUrl("italent/user/view/Get?"+this.model.get("restfulapi")),type:"Get",dataType:"json"}).done(function(a){b.collection.reset(a.data)})}})}),define("views/common/italent/modules/talent-plan-statistics-view",["talent","templates/common","views/common/italent/base-module-item-view"],function(a,b,c){return c.extend({className:"talent-plan-statistics_wrap",template:b["common/italent/modules/talent-plan-statistics"],templateHelpers:function(){return{i18n:this.i18n}},onShow:function(){var b=this;this.i18n=a.Context.getI18n(),this.model.fetching.done(function(){var c=b.model.get("data");c.i18n=a.Context.getI18n(),b.ui.load&&b.ui.load.remove(),c&&(b.ui.main.append(b.template(c)),require(["highCharts"],function(){b.showChat(c)}))})},showChat:function(b){for(var c=b.chartdata,d=0,e=0;e<c.length;e++)d+=c[e].y;if(0==d){var f=a.Context.getEmptyTemplate("0个"+this.i18n.plan_1+"，无法绘制图表");return void this.$el.find(".charts_ps").html(f)}this.$el.find(".charts_ps").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#555",connectorColor:"#000000",format:"{point.name}: {point.percentage:.1f} %",style:{fontFamily:"Arial"}}}},series:[{type:"pie",name:"",data:c}]})}})}),define("views/common/italent/modules/talent-task-statistics-view",["talent","templates/common","views/common/italent/base-module-item-view"],function(a,b,c){return c.extend({defautls:{showClassStatistics:!0},className:"talent-task-statistics_wrap",template:b["common/italent/modules/talent-task-statistics"],onRender:function(){var b=this;this.i18n=a.Context.getI18n(),this.model.fetching.done(function(){var a=b.model.get("data");b.ui.load&&b.ui.load.remove(),a.task_1=b.i18n.task_1,a&&b.ui.main.append(b.template(a))})},events:{"click .tab_ts li":"changeTab"},initialize:function(){this.ui.classStatistic="",this.settings=a._.extend({},this.defautls,this.options)},onShow:function(){this.settings.showClassStatistics||this.$el.find("div[data-name=class-statistic]").remove();var a=this;require(["highCharts"],function(){a.showChat()})},changeTab:function(b){var c=a.$(b.currentTarget),d=a.$(".tab_ts li"),e=a.$(".tab_ts li").index(c);d.removeClass("active"),c.addClass("active");var f=this;require(["highCharts"],function(){f.showChat(e)})},showChat:function(a){var a=a||0,b=this.model.get("data").CounterCollections1||"";b&&this.$el.find(".box_ts").highcharts({chart:{type:"column"},title:{text:""},xAxis:{categories:b[a].date},yAxis:{min:1,minPadding:1,minRange:1,stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"gray"}}},legend:{align:"right",x:-70,verticalAlign:"top",y:0,floating:!0,backgroundColor:"white",borderColor:"#CCC",borderWidth:1,shadow:!1},tooltip:{pointFormat:"本周完成：<b>{point.y:.1f}</b>"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,color:"white"}}},series:b[a].values})}})}),define("views/widget/modules/index-page-view",["talent","templates/widget","views/common/loading-view","views/bench/bench-unaccept-task-view","views/bench/bench-week-plan-implementation-view","views/common/empty-view","views/common/italent/modules/talent-plan-statistics-view","views/common/italent/modules/talent-task-statistics-view","TitaWidget","moment"],function(a,b,c,d,e,f,g,h,i){var j=a.Layout.extend({defaults:{name:"widget",isVisible:"1"},template:a._.template('<div data-name="cont"></div>'),className:"tt_widget_modules",templateHelpers:function(){return{i18n:this.i18n}},regions:{cont:"div[data-name=cont]"},ui:{cont:"div[data-name=cont]"},initialize:function(){this.i18n=a.Context.getI18n(),this.userInfo=a.Context.getUserInfo(),this.acceptTask_Page_Index=1,this._getRouterData()},onRender:function(){var a=this;this.childViewMapping={italent_plan_status:"views/common/italent/modules/talent-plan-statistics-view",italent_task_status:"views/common/italent/modules/talent-task-statistics-view"};var b=this.routerData.name;if("week_plan_stats"==b&&this._renderPlanWeekView(),"unaccept-task"==b&&this._renderUnAcceptView(),"publish-task"==b&&this._renderTaskWeekView(),"italent_plan_status"==b){var c=this.childViewMapping[b];require([c],function(c){a["_render_"+b](c)})}},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a||{},b.routerData.name=a.name||"week_plan_stats",b.routerData.toUserId=a.toUserId||""}),d},_render_italent_plan_status:function(b){var c=this,d="view_name=talent-plan-statistics-view&to_user_id="+this.userInfo.Id;a.$.ajax({url:a.Context.getApiUrl("italent/user/view/Get?"+d),type:"Get",dataType:"json"}).done(function(d){var e=(d.data,new a.Model(d));e.fetching=new a.$.Deferred,e.fetching.resolve(e.get("data")),c.childView=new b({model:e});c.childView.render();c.childView.onShow(),c.ui.cont&&c.ui.cont.append(c.childView.el)});var e="italent_task_status",f=this.childViewMapping[e];require([f],function(a){c["_render_"+e](a)})},_render_italent_task_status:function(b){var c=this,d="view_name=talent-task-statistics-view&to_user_id="+this.userInfo.Id;a.$.ajax({url:a.Context.getApiUrl("italent/user/view/Get?"+d),type:"Get",dataType:"json"}).done(function(d){var e=(d.data,new a.Model(d));e.fetching=new a.$.Deferred,e.fetching.resolve(e.get("data")),c.childView=new b({model:e,showClassStatistics:!1});c.childView.render();c.ui.cont&&c.ui.cont.append(c.childView.el),c.childView.onShow()})},_renderUnAcceptView:function(){var b=this;a.app.request("Bench:getModuleData",{channel_type:1,view_name:"UnAccetpTask",startNum:this.acceptTask_Page_Index,count:5}).done(function(c){var e=c.tasks||[],f=(c.total,a.ItemView.extend({template:a._.template('<div class="tt_common_emptyinit"><div class="content_emptyinit"><div class="className">尚无待接受的'+b.i18n.task_1+"</div></div></div>")}));b.benchUnAcceptTaskView?b.benchUnAcceptTaskView.collection.reset(e):(b.benchUnAcceptTaskView=new d({model:new a.Model({Total:c.total}),collection:new a.Collection(e),emptyView:f,isQqUse:!0}),b.listenTo(b.benchUnAcceptTaskView,"click:prev",function(a){b.acceptTask_Page_Index=a,b._renderUnAcceptView()}),b.listenTo(b.benchUnAcceptTaskView,"click:next",function(a){b.acceptTask_Page_Index=a,b._renderUnAcceptView()}),b.cont&&b.cont.show(b.benchUnAcceptTaskView))})},_renderPlanWeekView:function(b){var c=this;a.app.request("Bench:getModuleData",{channel_type:1,view_name:"PsersonalWeekPlanStatistic",startNum:1,count:5}).done(function(b){var b=b||[];
c.benchWeekPlanImplementationView?c.benchWeekPlanImplementationView.model.set({Data:b}):(c.benchWeekPlanImplementationView=new e({model:new a.Model({Data:b.data}),routerModel:new a.Model({type:"my"}),from:"widget"}),c.listenTo(c.benchWeekPlanImplementationView,"switch",function(a){c._renderPlanWeekView(a.type)},c),c.cont&&c.cont.show(c.benchWeekPlanImplementationView))})},_renderTaskWeekView:function(){this.$el.css({height:300,width:710}),this.createTaskCompositeView=new i.TaskCreateView({id:"Widget-Task-Create",toUserId:this.routerData.toUserId,requestSubmit:function(b){var c=new a.$.Deferred;return a.app.request("Task:newCreateTask",b).done(function(){c.resolve()}).fail(function(a){c.reject(a)}),c}}),this.cont.show(this.createTaskCompositeView)}});return a.BasePageView.extend({layout:"empty-layout",mainViewClass:j})}),define("views/common/send-notice/send-notice-user-list-view",["talent","templates/common","$.tipsy","tdialog"],function(a,b,c,d){var e=a.ItemView.extend({tagName:"li",template:b["common/send-notice/send-notice-user-list-item"],initialize:function(){this.isDisableSelect=this.options.isDisableSelect||!1},onRender:function(){var b=this;a.$(this.el).addClass("active"),this.model.set("isActive",!0),a.$(this.el).attr("Id",this.model.get("userId")),$(".tipsy").hide(),this.$el.tipsy({gravity:"s",title:function(){return b.model.get("name")}})},onClose:function(){$(".tipsy").hide()},modelEvents:{"change:isActive":"_toggleStatus"},_toggleStatus:function(){var b=this.model.get("isActive");b?a.$(this.el).addClass("active"):a.$(this.el).removeClass("active")}});return a.CompositeView.extend({template:a._.template("<ul/>"),itemViewContainer:"ul",itemView:e,events:function(){var a={};return a["click li"]="_selectUser",a},onRender:function(){this.selectUsers=this.collection.toJSON(),this.model.set("selectUsers",a._.pluck(this.selectUsers,"userId")),1==this.collection.length&&this.$el.find("li:first").addClass("disable")},_selectUser:function(b){if(1!=this.collection.length){var c=a.$(b.currentTarget),e=c.index(),f=this.collection.at(e);this.selectUserTipView&&this.selectUserTipView.$el.remove(),f.get("isActive")?f.set("isActive",!1):f.set("isActive",!0);var g=a._.filter(this.collection.toJSON(),function(a){return a.isActive?a.isActive:void 0});return 0==g.length?(f.set("isActive",!0),this.selectUserTipView=new d({fixed:!1,type:"modal",cancel:!1,sure:!1}),this.selectUserTipView.render().$el.appendTo("body"),void this.selectUserTipView.show(c,'<div class="innerhtml_dialog">请至少选择一个通知对象</div>',{arrow:!1,autoHide:!0,pos:"bottomCenter"})):void this.model.set("selectUsers",a._.pluck(g,"userId"))}},addAttr:function(a){for(var b=0;b<a.length;b++)a[b].isActive=!0;return a},reset:function(){this.collection.reset(this.addAttr(this.userListData))}})}),define("views/common/send-notice/send-notice-auto-user-list-view",["talent","templates/common","UserSelector","collections/smember-group-collection","$.tipsy","tdialog"],function(a,b,c,d,e,f){var g=a.ItemView.extend({template:b["common/send-notice/add-user"],tagName:"li",ui:{uxUserArea:".ux_user_area"},initialize:function(){},onRender:function(){this.model.has("UserAvatar")?(this.userAvatar=this.model.get("UserAvatar"),this.userAvatar.HasAvatar&&this.$el.find("img").addClass("radius_img30")):this.userAvatar="",this.$el.find("a").tipsy({gravity:"s"})},events:function(){var a={};return a["mouseover "+this.ui.uxUserArea]="changeHideNode",a["mouseout "+this.ui.uxUserArea]="changeShowNode",a["click "+this.ui.uxUserArea]="deleteUser",a},deleteUser:function(){this.trigger("deleteUser",this.model)},changeHideNode:function(b){var c=a.$(b.currentTarget);this.userAvatar.HasAvatar?c.find("img").hide():c.find("span").hide()},changeShowNode:function(b){var c=a.$(b.currentTarget);this.userAvatar.HasAvatar?c.find("img").show():c.find("span").show()}}),h=a.CompositeView.extend({itemView:g,itemViewContainer:"ul",template:b["common/send-notice/add-user-list"],className:"add_user_list",ui:{addUserBtn:".ux_add_btn"},initialize:function(){},modelEvents:{change:"render"},onRender:function(){var a=this;this.on("itemview:deleteUser",function(b){a.collection.remove(b.model),$("body .tipsy").remove()}),this.userSelectorView=new c({collection:new d}),this.userSelectorView.addNode(this.$el.find(".ux_add_btn"),this.addUserSelectonOptions),this.$el.find(".ux_add_btn").on("submit",function(b,c){b.stopPropagation(),a.smemberSelect(c)})},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render(),this.$el.find(this.itemViewContainer).find("li:first-child").length?this.$el.find(this.itemViewContainer).find("li:first-child").before(e.el):this.$el.find(this.itemViewContainer).append(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)},smemberSelect:function(a){var a=a||{},b=this.collection.where({Id:a.Id});b.length>0?this.showDialogArrow(this.ui.addUserBtn,"该联系人已存在","warn"):this.collection.add(a)},showDialogArrow:function(b,c,d){var e=this;e.tDialogViewError||(e.tDialogViewError=new f({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),e.tDialogViewError.render().$el.appendTo("body")),e.tDialogViewError.show(a.$(b),c,{arrow:1,pos:"bottomCenter",height:300,topBias:8,leftBias:0,arrowBias:10,className:d,autoHide:!0})}});return h}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require("../moment")):"function"==typeof define&&define.amd?define("momentZH",["moment"],b):b(a.moment)}(this,function(a){var b=a.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(a,b){return 12===a&&(a=0),"凌晨"===b||"早上"===b||"上午"===b?a:"下午"===b||"晚上"===b?a+12:a>=11?a:a+12},meridiem:function(a,b){var c=100*a+b;return 600>c?"凌晨":900>c?"早上":1130>c?"上午":1230>c?"中午":1800>c?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[下]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[上]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"日";case"M":return a+"月";case"w":case"W":return a+"周";default:return a}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});return b}),define("views/common/send-notice/send-notice-component",["talent","templates/common","views/common/send-notice/send-notice-user-list-view","views/common/send-notice/send-notice-auto-user-list-view","moment","momentZH","tdialog"],function(a,b,c,d,e,f,g){return a.Layout.extend({defaults:{title:"提醒大家写日报",isMailEdit:"true",mailContent:"",checkedSendMail:!0,isEditCopySelf:!0,checkedCopySelf:!0,isShowWithStatistics:!1,checkedWidthStatistics:!0,isShowSystemNotice:!0,isShowFormalNotice:!1,autoSubShow:!1,editFormalNotice:!1},className:"noticemessage",template:b["common/send-notice/send-notice-component"],regions:{userList:"div[data-name=user-list]"},ui:{item:"li",title:"div[data-name=title]",inputWrap:"div[data-name=mail-cont]",input:"div[data-name=mail-cont] textarea",copyMy:"a[data-name=copy-my]",withStatistics:"a[data-name=with-statistics]"},events:function(){var a={};return a["click "+this.ui.item]="_selectUser",a["keyup "+this.ui.input]="_keyupInputHandler",a["click "+this.ui.copyMy]="_clickCopyMyHandler",a["click "+this.ui.withStatistics]="_clickWidthStatistics",a},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),this.model.set(this.settings),this.loginUser=a.Context.getUserInfo(),this.model.set("user",this.loginUser);var d=e().format("YYYY年M月D日");this.model.set("SendTime",d),this.settings.autoSubShow||(this.collection.each(function(a){a.set("Id",a.get("userId"))}),this.sendNoticeUserListView=new c({collection:this.collection})),a.$(document).off("click.Send-Notice-Componet-View"),a.$(document).on("click.Send-Notice-Componet-View",function(){b.hideDialog()})},templateHelpers:function(){return{isShowFormalNotice:this.settings.isShowFormalNotice,isShowSystemNotice:this.settings.isShowSystemNotice}},onRender:function(){var a=this;this.ui.input.val(this.model.get("mailContent")),this.settings.autoSubShow?(_.map(this.collection.models,function(b){var c=a._returnImgTemplate(b.toJSON());b.set("imgTemplate",c)}),this.collection.each(function(a){a.set("Id",a.get("userId"))}),this.sendNoticeAutoUserListView=new d({collection:this.collection}),this.userList.show(this.sendNoticeAutoUserListView)):this.userList.show(this.sendNoticeUserListView)},_returnImgTemplate:function(a){var b="";if(a.avatar.HasAvatar)var b='<img class="radius_img30" width="30" height="30" src="'+a.avatar.Small+'" />';else var b='<span class="radius_img30" style="background-color:'+a.avatar.Color+'">'+_.substring(a.name,2,!1)+"</span>";return b},onClose:function(){a.$(document).off("click.Send-Notice-Componet-View")},showDialog:function(b,c,d){var e=this;this.dialogView=new g({type:"defaults",sure:function(){var a=e.model.get("checkedCopySelf");if(e.settings.autoSubShow)var b=_.map(e.sendNoticeAutoUserListView.collection.models,function(a){return a.get("Id")});else var b=e.sendNoticeUserListView.model.get("selectUsers");if(a)if(b)b.push(e.loginUser.Id);else{var b=[];b.push(e.loginUser.Id)}var c=e.model.toJSON();c.selectUsers=b,e.dialogView.hide(),e.trigger("submit",c)},cancel:function(){e.hideDialog()}});var f="";f=d?d:$("body"),this.dialogView.render().$el.appendTo(f);var h=this.render().el,i={pos:"bottom",x:0,y:0,title:"提醒大家写日报"};c.title&&this.ui.title.html(c.title),this.dialogView.show(b,h,a._.extend({arrow:!1,autoHide:!1,autoFrames:f,container:f},i,c))},hideDialog:function(){this.dialogView&&this.dialogView.close(),this.$el.remove()},_keyupInputHandler:function(b){var c=a.$(b.currentTarget),d=$.trim(c.val());this.model.set("mailContent",d)},_clickCopyMyHandler:function(b){if(this.model.get("checkedSendMail")){var c=a.$(b.currentTarget),d=this.model.get("checkedCopySelf");d?(this.model.set("checkedCopySelf",!1),c.removeClass("checkbox-checked")):(this.model.set("checkedCopySelf",!0),c.addClass("checkbox-checked"))}},_clickWidthStatistics:function(b){var c=a.$(b.currentTarget),d=this.model.get("checkedWidthStatistics");d?(this.model.set("checkedWidthStatistics",!1),c.removeClass("checkbox-checked")):(this.model.set("checkedWidthStatistics",!0),c.addClass("checkbox-checked"))}})}),define("views/common/plugins/pubdaily/pubdaily-view",["talent","templates/common","tdialog","views/common/send-notice/send-notice-component","TitaWidget"],function(a,b,c,d,e){return a.CompositeView.extend({defaults:{inputDefatutValue:"",shape:"defaults",dialogTilte:"工作日报",autoSubShow:!1,report_type:8,dailyType:1},template:b["common/pubdaily/pubdaily"],className:"tt_daily_pub_view",ui:{pubDailyArea:"div[data-name=pub-daily-form]",buttonGenerate:"button[data-name=generate]",buttonClosed:"span[data-name=closed]",buttonAutoSend:'button[data-name="auto-send"]'},templateHelpers:function(){return this.settings},modelEvents:{},events:function(){var a={};return a["click "+this.ui.buttonGenerate]="_clickButtonGenHandler",a["click "+this.ui.buttonClosed]="_closedHandler",a["click "+this.ui.buttonAutoSend]="_clickButtonAutoSend",a},initialize:function(b){var c=this;this.options=b||{},this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.i18n=a.Context.getI18n(),this.model.set("generateType",[1,2]),"dialog"==this.settings.shape&&(a.$(document).off("click.Pubdaily-View"),a.$(document).on("click.Pubdaily-View",function(){c.close()}),this.$el.on("click",function(a){a.stopPropagation()}))},onClose:function(){"dialog"==this.settings.shape&&a.$(document).off("click.Pubdaily-View")},onShow:function(){var b=(this._rendBlogView(),this);"dialog"==b.settings.shape?(a.$(b.ui.pubDailyArea).append(b.mBlogView.render().$el),b.$el.addClass("tt_dialog_daily_pub")):a.$(b.ui.pubDailyArea).append(b.mBlogView.render().$el)},_clickButtonAutoSend:function(b){{var c=this,c=this;new a.$.Deferred}a.app.request("UserSubordinate:getDirectSuperior").done(function(e){var f=a._.pluck(e,"parentUser");c.superiorUser=a._.filter(f,function(b){return b&&b.userId?b.userId!=a.Context.getUserInfo().Id:void 0});var g=a.$(b.currentTarget);c.sendNoticeComponent&&c.sendNoticeComponent.hideDialog();var h="发送邮件",i=c.model.get("date"),j=c.model.get("generateType");a.app.request("Daily:getAutoDaily",{types:j.join(","),date:i,report_type:c.settings.report_type,plan_table_id:c.model.get("plan_table_id")}).done(function(b){return b?(c.sendNoticeComponent&&c.sendNoticeComponent.close(),c.sendNoticeComponent=new d({collection:new a.Collection(c.superiorUser),mailContent:b,isShowWithStatistics:!1,title:h,isShowSystemNotice:!1,autoSubShow:c.settings.autoSubShow}),c.sendNoticeComponent.showDialog(g,{title:h}),void c.listenTo(c.sendNoticeComponent,"submit",function(b){var d=c.settings.dailyType;return 1==b.selectUsers.length&&b.selectUsers[0]==c.userInfo.Id||0==b.selectUsers.length?void c._tipDialog(g,"通知对象不能为空"):void a.app.request("PlanCommmon:postSendNotice",{UserIds:b.selectUsers.join(","),EmailContent:1==b.checkedSendMail?b.mailContent:"",Date:c.model.get("date"),MessageContent:"",MessageType:1==d?15:18,PlanTableId:this.model.get("plan_table_id")}).done(function(){c._tipDialog(g,"发送邮件成功","success")}).fail(function(a){c._tipDialog(g,a)})})):void c._tipDialog(g,"您还没有工作汇总，工时汇总")})})},setPosition:function(a){var b=a.offset(),c=a.outerWidth(),d=(a.outerHeight(),this.$el.outerWidth());this.$el.css({position:"absolute",left:b.left-d+c,top:b.top})},_clickButtonGenHandler:function(b){var c=a.$(b.currentTarget),d=this.model.get("generateType");d.length&&this._requestAutoDialy(c)},_closedHandler:function(){this.close()},_rendBlogView:function(){var b={publicOptions:{name:"公开",des:"所有人可见"},privateOptions:{name:"私密",des:"仅我的上级可见"},departmentOptions:{name:"部门可见",des:"仅我的部门可见"}},c=this,d=a.Context.getGlobal("tenantBehavior").TaskPushlishPrivateType||3,f="";f=1==d?"公开":2==d?"私密":"部门可见";var g=this.settings.dailyType,h=this.model.get(1==g?"date":"plan_table_id");this.mBlogView=new e.PublistMblogView({id:"Daily"+h,type:"feed",maxlength:"4000",isLimit:!0,defaultValue:this.settings.inputDefatutValue,value:"",submitText:"发布",shape:"default",defaultHide:!1,inFocus:!0,isShowAtAll:!1,atAllText:"所有同事",atAllValue:"@[所有同事:all_members] ",atAllTipText:"所有同事将收到本条消息",privateDropDownOptions:b,isShowAt:!0,atText:"同事",atTipText:"想确保谁看到就@这个成员",isShowAttachment:!0,isShowEmotion:!1,isShowRange:!0,privateText:f,privateValue:d,isShowRangeDropDown:!0,isShowSendSms:!1,submitRequest:function(b,d){var e=new Talent.$.Deferred;return a.app.request("Daily:planDialyAdd",{content:d.context,visibility:d.visibility||1,fileUrls:d.files.join(","),objId:d.privateObjId,objType:d.privateObjType,dateTime:c.settings.model.get("date"),reportType:c.settings.report_type,planTableId:c.settings.model.get("plan_table_id"),otherDocuments:d.YFYDocuments}).done(function(a){c.trigger("submitSuccess",b,a),e.resolve(a)}).fail(function(a){e.reject(a)}),e}})},requestDailyData:function(b){var c=new a.$.Deferred;return a.app.request("Daily:postAddDailyData",{content:b.content,fileUrls:b.FileUrls,dateTime:self.routerData.date,visibility:b.visibility||1,objId:b.ObjId,objType:b.ObjType}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c},_requestAutoDialyContent:function(){},_requestAutoDialy:function(b){var c=this.model.get("date"),d=this,e=this.model.get("generateType");a.app.request("Daily:getAutoDaily",{types:e.join(","),date:c,report_type:d.settings.report_type,plan_table_id:d.model.get("plan_table_id")}).done(function(a){if(!a)return void d._tipDialog(b,"您还没有工作汇总，工时汇总");var c=d.mBlogView.ui.input;c.val(a).trigger("keyup").autosize(),d._cursorMoveEnd(c)})},_cursorMoveEnd:function(a){var b=$(a).val().length,c=$(a)[0];if($.browser.msie){var d=c.createTextRange();d.moveStart("character",b),d.collapse(!0),d.select()}else c.setSelectionRange(b,b),c.focus()},_tipDialog:function(a,b,d){this.tipDialog=new c({type:"tipsy",sure:!1,cancel:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(a,b,{pos:"topRight",className:d||"warn",arrow:!1,autoHide:!0})}})}),define("views/common/sdk/sdk-view",["talent","templates/common"],function(a){return a.ItemView.extend({defaults:{iTalentFrame:"",iTalentFrameType:"",iTalentNavId:"",iTalentNavCode:"",iTalentWidgetUpdateSize:!1},template:a._.template(""),className:"tu-height-full",regions:{},templateHelpers:function(){return{i18n:this.i18n}},initialize:function(){this.routerData={iTalentFrame:"",iTalentFrameType:"",iTalentNavId:"",iTalentWidgetUpdateSize:!1,iTalentNavCode:""},this.routerData=a._.extend({},this.routerData,{iTalentFrame:this.options.iTalentFrame,iTalentFrameType:this.options.iTalentFrameType,iTalentNavId:this.options.iTalentNavId,iTalentWidgetUpdateSize:this.options.iTalentWidgetUpdateSize||!1,iTalentNavCode:this.options.iTalentNavCode}),this._getRouterData(),this.oriOverflow=a.$("html").css("overflow-y")},onRender:function(){this._setIfrmeUrl()},onShow:function(){this.onShowAfter&&this.onShowAfter(),setTimeout(function(){a.$("#BizQQWAP").hide()},4e3)},onClose:function(){var b=a.Context.getGlobal("usingNewMenu")||!1;b||(a.$("html").css("overflow-y",this.oriOverflow),a.$(window).off("resize",this.bindResizeFrame),a.$("#main-region").css("height","")),this.onCloseAfter&&this.onCloseAfter()},_getRouterData:function(){for(var a=decodeURIComponent(location.hash),a=a.slice(a.indexOf("?")+1),b=a.split("&"),c=0;c<b.length;c++){var d=b[c].split("=");this.routerData[d[0]]=d[1]}this.routerData.iTalentFrame&&""!=this.routerData.iTalentFrame?this._formatUrl(this.routerData.iTalentFrame):alert("iframe的地址哪里去了")},_formatUrl:function(a){var b=decodeURIComponent(a);this.routerData.iTalentFrame=b},_setIfrmeUrl:function(){function a(){if(0===e){var a=b.routerData.iTalentFrame;d.data=b.routerData,iframe.contentWindow.name=JSON.stringify(d),iframe.contentWindow.location.href=a,e=1}}var b=this,c=decodeURIComponent(location.hash);c.indexOf("?")>-1&&(c=c.slice(0,c.indexOf("?")));var d={__iTalentFrameId:"iTalentFrame",__iTalentFrameType:this.routerData.iTalentFrameType,__iTalentLocationHref:"//"+location.host+location.pathname+c,__iTalentWidgetUpdateSize:this.routerData.iTalentWidgetUpdateSize,__iTalentNavCode:this.routerData.iTalentNavCode,__iTalentNavId:this.routerData.iTalentNavId},e=0;return iframe=document.createElement("iframe"),src="//"+location.host+"/italent-transfer-data.html",iframe.src=src,iframe.setAttribute("frameborder",0),iframe.setAttribute("marginwidth",0),iframe.setAttribute("marginheight",0),iframe.setAttribute("scrolling","auto"),iframe.setAttribute("width","100%"),iframe.setAttribute("height","100%"),iframe.setAttribute("class","tu-scroll"),iframe.setAttribute("id","iTalentFrame"),iframe.attachEvent?iframe.attachEvent("onload",a):iframe.onload=a,this.$el[0].appendChild(iframe),iframe}})}),define("views/widget/italent/index-page-view",["talent","templates/widget","views/common/sdk/sdk-view"],function(a,b,c){var d=c.extend({onShowAfter:function(){this.css=$("[data-name=main-container-innner-region]").attr("style");var a=Talent.Context.getGlobal("usingNewMenu")||!1;return a?void $("[data-name=main-container-innner-region]").css({height:"100%",width:"100%",overflow:"hidden"}):void this._setClientHeight()},onCloseAfter:function(){},_setClientHeight:function(){var a=($("#main-region"),this._setMainHeight);Talent.$("html").css("overflow-y","hidden"),a();var b=Talent._.debounce(function(){a()},300);$(window).off("resize.baseMaterLayout"),$(window).on("resize.baseMaterLayout",b)},_setMainHeight:function(){var a=(Talent.$("._tt_layout_tabnav").height(),Talent.$("#header-region").outerHeight()),b=Talent.$("#footer-region").outerHeight(),c=$(window).height()-a-b;Talent.$("#main-region").css({height:c})}});return a.BasePageView.extend({mainViewClass:d,layout:window.top==window?"master-layout":"empty-layout"})}),define("views/widget/tab-comment-track/index-page-view",["talent","templates/widget","TitaWidget"],function(a,b,c){var d=a.Layout.extend({defaults:{id:""},template:b["widget/tab-comment-track/index-page"],className:"container",regions:{track:"[data-name=track]",comment:"[data-name=comment]"},ui:{},events:function(){var a={};return a},initialize:function(){this._getRouterData()},onShow:function(){this._getFeedData()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a||{}}),d},_getFeedData:function(){var b=this;a.app.request("Feed:getItemFeed",{feed_id:this.routerData.id,comment_count:99}).done(function(a){b._renderTarckView(a.feedOperations),b._renderCommentView(a.feedComments)})},_renderTarckView:function(b){this.feedTrackView=new c.TrackView({defaultCount:99,model:new a.Model(b)}),this.listenTo(this.feedTrackView,"showAll",function(){this._getCommentData(1)}),this.track.show(this.feedTrackView)},_renderCommentView:function(b){var d=new c.CommentListView({defaultCount:99,feedId:this.routerData.id,model:new a.Model(b),atMuti:!1});this.comment.show(d)},_getCommentData:function(b){var c=this;a.app.request("Comment:getFeedItemComment",{feed_id:this.routerData.id,comment_type:b}).done(function(a){1==b&&c.feedTrackView.model.set("comments",a.comments||[])})},onClose:function(){}});return a.BasePageView.extend({mainViewClass:d,pageTitle:"widget",layout:"empty-layout"})}),define("views/widget/index-page-view",["talent","templates/widget","views/common/loading-view","views/common/empty-view","views/widget/modules/index-page-view","views/common/plugins/pubdaily/pubdaily-view","TitaWidget","tdialog","views/widget/italent/index-page-view","views/widget/tab-comment-track/index-page-view"],function(a,b,c,d,e,f,g,h){var i=a.Layout.extend({defaults:{widgetname:"widget",autoHeight:!1,id:"",appId:1,appType:1,frameId:"iframe",titaObjId:"",titaObjType:0,appObjId:"",appObjType:0},template:b["widget/index-page"],regions:{tab:"ul[data-name=pubtab]",mblog:"div[data-name=pubblog]",task:"div[data-name=pubtask]",daily:"div[data-name=pubdaily]",feedList:"div[data-name=feedlist]"},ui:{tab:"ul[data-name=pubtab]",pubTabLi:"ul[data-name=pubtab] li",pubHome:".pubblog_home",mblog:"div[data-name=pubblog]",task:"div[data-name=pubtask]",daily:"div[data-name=pubdaily]",feedList:"div[data-name=feedlist]"},events:function(){var a={};return a["mouseenter "+this.ui.pubTabLi]="_overPubTabEventHandler",a["mouseleave "+this.ui.pubTabLi]="_leaverPubTabEventHandler",a},templateHelpers:function(){return{i18n:this.i18n}},initialize:function(){this.moduleMapping={widget:["pubBlog","pubdaily","feed"],widget1:["pubBlog","feedListByType"],widget2:["pubBlog","commentList"],widget3:["feedListByType"],widget4:["pubBlog","feedListByObjType"]},this.i18n=a.Context.getI18n(),this.collection=new a.Collection},onRender:function(){var a=this;this._getRouterData().done(function(){a._rendModule()})},_overPubTabEventHandler:function(b){a.$("body").trigger("click");var c=this;this.tabT=setTimeout(function(){var d=a.$(b.currentTarget),e=a.$(c.ui.pubTabLi).index(d);a.$(c.ui.pubTabLi).removeClass("active"),d.addClass("active"),c.ui.pubHome.hide(),a.$("._cycle_tt_dialog").remove(),0==e?(c.ui.pubHome.show(),c.ui.task.hide(),c.ui.daily.hide()):1==e?(c.ui.pubHome.hide(),c.ui.task.show(),c.ui.daily.hide(),c.taskCreateView.$el.find(".ux_task_content").trigger("focus")):(c.ui.pubHome.hide(),c.ui.task.hide(),c.ui.daily.show(),c.pubDailyView&&c.pubDailyView.mBlogView.ui.input.trigger("input.autosize"))},500)},_leaverPubTabEventHandler:function(){clearTimeout(this.tabT)},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a,b.routerData.frameId=a.frameId||b.defaults.frameId,b.routerData.autoHeight=a.autoHeight||b.defaults.autoHeight,b.routerData.minHeight=a.minHeight||0,d.resolve(b.routerData)}),d},_rendModule:function(){var b=this,c=this.routerData.widgetname,d=this.moduleMapping[c]||this.moduleMapping.widget1;switch("widget"!=c&&this.ui.tab.remove(),c){case"widget2":if(!this.routerData.id)return void alert("id不存在");break;case"widget3":if(!this.routerData.id)return void alert("id不存在")}a._.each(d,function(a){b["_render_"+a]()})},_render_italent:function(){this.italent=new Italent,this.feedList.show(this.italent)},_render_pubBlog:function(){var b=this,c=this.routerData.widgetname,d={};switch(c){case"widget":d={privateText:"公开",id:"widget-publish-mlog",shape:"line",isShowAtAll:2==a.Context.getUserInfo().Role||1==a.Context.getUserInfo().Role?!0:!1,submitRequest:function(c,d){var e=new a.$.Deferred;return Talent.app.request("Feed:feedAddShare",{Content:d.context,ObjType:d.privateObjType,ObjId:d.privateObjId,FileUrls:d.files.join(","),Visibility:d.visibility,IsSendSMS:d.isSendSMS,otherDocuments:d.YFYDocuments}).done(function(a){b._addItemViewFeed(a),e.resolve(a)}).fail(function(a){b._tipDialog(c,a),e.reject(a)}),e}};break;case"widget1":d={isShowAtAll:!1,submitRequest:function(c,d){var e=new a.$.Deferred;return Talent.app.request("Feed:feedAddShare",{Content:d.context,ObjType:d.privateObjType,ObjId:d.privateObjId,FileUrls:d.files.join(","),Visibility:d.visibility,IsSendSMS:d.isSendSMS}).done(function(c){b._addListItemFeed(new a.Model(c)),e.resolve(c)}).fail(function(a){b._tipDialog(c,a),e.reject(a)}),e}};break;case"widget4":d={isShowRange:!0,privateText:"私密",privateValue:2,isShowRangeDropDown:!1,isShowSendSms:!1,isShowAtAll:2==a.Context.getUserInfo().Role||1==a.Context.getUserInfo().Role?!0:!1,submitRequest:function(c,d){var e=new a.$.Deferred,f={Content:d.context,ObjType:b.routerData.titaObjType,ObjId:b.routerData.titaObjId,FileUrls:d.files.join(","),Visibility:d.visibility,IsSendSMS:d.isSendSMS,AppId:b.routerData.appId,AppType:b.routerData.appType};return extend={},203==b.routerData.appId&&(extend={AppObjType:b.routerData.appObjType}),a.app.request("Feed:feedAddShare",a._.extend(f,extend)).done(function(c){b.collection.unshift(c),b.feedListView?b._addListItemFeed(new a.Model(c)):b._render_feedListByType(),e.resolve(c)}).fail(function(a){b._tipDialog(c,a),e.reject(a)}),e}};break;case"widget2":d={isShowAtAll:!1,isShowRange:!1,submitRequest:function(c,d){var e=new a.$.Deferred;return a.app.request("Comment:newAddComment",{CommentId:0,FeedId:b.routerData.id,ObjId:0,ObjType:0,Content:d.context,FileUrl:d.files.join(",")}).done(function(c){var c=c||{};if(b.collection.unshift(c),b.commentListView){var d=b.commentListView.addNewItemComment(new a.Model(c));b.commentListView.$el.prepend(d),d.hide().slideDown()}else b._render_commentList();b._setParentIframeAutoHeight(),e.resolve(c)}).fail(function(a){b._tipDialog(c,a),e.reject(a)}),e}}}"400"==this.routerData.appId&&(d=a._.extend({},d,{privateText:"仅我和上级可见",privateValue:2,defaultValue:"想说点什么",shape:"default",isShowRange:!0,isShowRangeDropDown:!1,isShowSendSms:!1}));var e=new g.PublistMblogView(d);this.mblog.show(e)},_getFeedData:function(){var b=this,c=new a.$.Deferred;return a.app.request("Feed:getWidgetFeeds",{app_id:routerData.appId,app_type:routerData.appType,tita_objId:routerData.titaObjId,tita_objtype:routerData.titaObjType,app_objid:routerData.appObjId,app_objtype:routerData.appObjType,type:0,start:this.pageIndex,feed_count:20,comment_count:4}).done(function(){var a={isEnd:resp.IsEnd,lastId:resp.LastId,feeds:resp.Data};b.pageIndex=resp.LastId,c.resolve(a)}),c},_render_feedListByObjType:function(){{var b=this,c=this.routerData;this.routerData.type||"aboutme-all"}a.app.request("Feed:getWidgetFeeds",{app_id:c.appId,app_type:c.appType,tita_objId:c.titaObjId,tita_objtype:c.titaObjType,app_objid:c.appObjId,app_objtype:c.appObjType,type:0,start:"",feed_count:20,comment_count:4}).done(function(c){if(c.feeds=c.feeds||[],b.collection.unshift(c.feeds),0==c.feeds.length){var e=new d({emptyContext:"还没有任何动态"});b.feedList.show(e)}else b.feedListView=new g.FeedListView({requestMoreFeed:function(){var c=new a.$.Deferred;return b._getFeedData().done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c},isInAppPage:!0,model:new a.Model({IsEnd:c.isEnd,LastId:c.lastId,feeds:b.collection.toJSON()})}),b.feedList.show(b.feedListView)})},_render_feedListByType:function(){{var b=this;this.routerData.type||"aboutme-all"}a.app.request("Feed:getFeeds",{type:2,start:"",feed_count:20,comment_count:4}).done(function(c){if(c.feeds=c.feeds||[],b.collection.unshift(c.feeds),0==c.feeds.length){var e=new d({emptyContext:"还没有任何动态"});b.feedListView.show(e)}else b.feedListView=new g.FeedListView({model:new a.Model({IsEnd:c.isEnd,LastId:c.lastId,feeds:c.feeds}),collection:this.collection}),b.feedList.show(b.feedListView)})},_render_commentList:function(){var b=this;this.requestFeed=a.app.request("Comment:getFeedItemComment",{feed_id:this.routerData.id,comment_type:0}).done(function(a){b.collection.unshift(a.comments||[]),b._showCommentListView(a),setTimeout(function(){b._setParentIframeAutoHeight()},300)})},_showCommentListView:function(b){if(!b.total){var c=new d({emptyContext:"还没有任何动态"});return void this.feedList.show(c)}var e={isInAppPage:!1,onlyComment:!0,mBlogOptions:{defaultHide:!0,defaultValue:"",isShowSendSms:!1},custom:{more:!0,remind:!0,collect:!0,reply:!0},actionMore:{detail:!0,"delete":!0,setTop:!0},isPrivate:!1,privateTipText:"",feedId:this.routerData.id,defaultCount:4,sort:"prepend",model:new a.Model(b)};400==this.routerData.appId&&(e.isPrivate=!0,e.privateTipText="仅我和上级可见"),this.commentListView=new g.CommentListView(e),this.feedList.show(this.commentListView)},_addItemViewFeed:function(a){var b=this.feedTabListView.addNewItemFeed(a);b.hide(),this.feedTabListView.$el.find("[data-name=feed-list-box]").prepend(b),b.slideDown()},_addListItemFeed:function(a){var b=this.feedListView.addNewItemFeed(a);b.hide(),this.feedListView.$el.find("[data-name=feed-list-box]").prepend(b),b.slideDown()},_render_feed:function(){this.$el.find("._tt_feedlist").remove(),this.feedTabListView=new g.FeedTabListView({}),this.feedList.show(this.feedTabListView)},_render_pubtask:function(){},_render_pubdaily:function(){var b=this;this.pubDailyView=new f({inputDefatutValue:b.today+"日报",model:new a.Model({date:moment().format("YYYY/MM/DD")}),autoSubShow:!0}),this.ui.daily.html(this.pubDailyView.render().el),this.pubDailyView.onShow(),this.listenTo(this.pubDailyView,"submitSuccess",function(a,c){b._addItemViewFeed(c),b._hasDoneDaily(),b._tipDialog(b.pubDailyView.button_submit,"日报已提交")})},_tipDialog:function(a,b){this.tipDialog=new h({type:"tipsy",sure:!1,cancel:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(a,b,{pos:"topCenter",className:"warn",arrow:!1,autoHide:!0})},_hasDoneDaily:function(){this.$el.find("div[data-name=pubdaily]").html('<div class="publish_daily_done">'+this.today+'已写日报 &nbsp;&nbsp;&nbsp;&nbsp;<a href="#daily">查看</a></div>')},_setParentIframeAutoHeight:function(){top!==self&&"true"==this.routerData.autoHeight&&(parent.document.getElementById(this.routerData.frameId).style.height=0!=this.routerData.minHeight&&this.routerData.minHeight>a.$("body").height()?this.routerData.minHeight+"px":a.$("body").height()+"px")
}});return a.BasePageView.extend({layout:"empty-layout",mainViewClass:i})});