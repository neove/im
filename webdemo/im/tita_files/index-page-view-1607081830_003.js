/*! tita-web-v4 - v0.4.0 - 2016-07-08 18:31 */define("templates/bench",[],function(){return this.JST=this.JST||{},this.JST["bench/bench-daily-group-empty"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="bench_right_chart_empty">\n	<div class="top_brce">如果团队提交了日报<br />将呈现类似如下统计图表</div>\n	<div class="cont_brce"><img src="'+(null==(__t=imgUrl)?"":__t)+'" alt="" /></div>\n</div>';return __p},this.JST["bench/bench-daily-group"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div data-name="bench-daily-container">\n	<div class="top_gyd">'+(null==(__t=unSubmitTotal)?"":__t)+"人未提交  尚有"+(null==(__t=unEvaluateTotal)?"":__t)+'人未评价</div>\n	<div data-name="bench-daily-chart" class="chart_gyd"></div>\n	<div class="action_gyd" >\n		<a href="#daily?type=group&iTalentNavCode=tita-daily" class="btn">查看团队所有日报</a>\n		<button class="btn" data-name="bench-daily-sendnotice">&nbsp;通知大家写日报&nbsp;</button>\n	</div>\n</div>';return __p},this.JST["bench/bench-daily-my"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+="<p>\n	",dailySubmit?(__p+="\n		",__p+=3==dailySubmit.submitType?'<span class="icon-dialog-closed-warn icon_d"></span>':'<span class="icon-right icon_d"></span>',__p+='<span class="status_dc">'+(null==(__t=dailySubmit.submitContent)?"":__t)+"</span>\n	"):__p+='\n		<span class="icon-dialog-closed-warn icon_dc"></span><span class="status_dc">'+(null==(__t=dailySubmit.submitContent)?"":__t)+"</span>\n	",__p+="\n</p>\n",__p+=evaluation?'\n	<div class="evaluation_d"><span>评价：'+(null==(__t=_.evaluation(evaluation))?"":__t)+"</span></div>\n":'\n	<div class="evaluation_d">\n		<span>评价：暂无</span>\n	</div>\n',__p+="\n",__p+=dailySubmit&&3!=dailySubmit.submitType?'\n<div class="action_d"><a href="#daily?dailyId='+(null==(__t=dailyId)?"":__t)+'&iTalentNavCode=tita-daily" class="btn">'+(null==(__t=evaluation?"查看":"修改")?"":__t)+"</a></button>\n":'\n<div class="action_d"><button class="btn" data-name="write-daily">写日报</a></button>\n';return __p},this.JST["bench/bench-daily"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm">\r\n			<span class="name_bbm">',__p+="my"==type?"我的今日日报":"团队今日日报",__p+='</span>\r\n		</div>\r\n	</div>\r\n	<div class="cont_bbm" data-name="bench-daily-container">\r\n		\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-export-daily"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<a data-name="export" href="javascript:void(0)" class="btn" style="display:block;">导出日报</a>\n<div class="popArea" data-name="popArea" style="position:relative;"></div>\n<div class="addUserArea" data-name="addUserArea"></div>';return __p},this.JST["bench/bench-my-group"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm">\r\n			<span class="name_bbm tt-guide" data-link="//help.tita.com/ProPrice/VersionPrice">我的团队</span>\r\n		</div>\r\n		<div class="right_bbm">\r\n			<span class="down_bbm t" data-name="drop-down" original-title ="团队操作" ><span class="icon-arrow-down icon-arrow-down-disabled"></span></span>\r\n		</div>\r\n	</div>\r\n	<div class="cont_bbm">\r\n		<div class="bench_my_group" data-name="content">\r\n			\r\n		</div>\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-my-plan-component"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_bench_myplan">\r\n	<div data-name="week-box"></div>\r\n	<div data-name="plan-cereate-form"></div>\r\n	<div data-name="plan-data-filter"></div>\r\n	<div class="tt_expire_bench_plan_list" data-name="bench-expire-plan-area">\r\n		<div class="tt_bench_planlist_title" data-name=\'expire-title\'>\r\n			<span class="today_plt expire_plt" original-title="收起" data-name="toggle-expire">\r\n				<span class="txt">\r\n					',__p+=date!=today&&date<today?(null==(__t=_.formatStringDate(date,"MM月DD日"))?"":__t)+"过期的"+(null==(__t=i18n.plan_1)?"":__t):"已过期",__p+='\r\n				</span>\r\n				<span class="icon icon-w-arrow-up-double"></span>\r\n			</span>\r\n		</div>\r\n		<div data-name="expire-plan-list">\r\n			<div class="_tt_loading_m">努力加载中…</div>\r\n		</div>\r\n		\r\n	</div>\r\n	\r\n	<div class="tt_bench_plan_list" data-name="bench-plan-area">\r\n		<div class="tt_bench_planlist_title" data-name="plan-title">\r\n			<span class="today_plt" original-title="收起" data-name="toggle-today">\r\n				<span class="txt">\r\n					',__p+=date!=today&&date<today?(null==(__t=_.formatStringDate(date,"MM月DD日"))?"":__t)+"的"+(null==(__t=i18n.plan_1)?"":__t):"当前"+(null==(__t=i18n.plan_1)?"":__t),__p+='\r\n				</span>\r\n				<span class="icon icon-w-arrow-up-double"></span>\r\n			</span>\r\n		</div>\r\n		<div data-name=\'plan-list\'>\r\n			<div class="_tt_loading_m">努力加载中…</div>\r\n		</div>\r\n		\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-note"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="bench-basic-modules">\n	<div class="title_bbm">\n		<div class="left_bbm">\n			<span class="name_bbm tt-guide" data-link="//help.tita.com/ProPrice/VersionPrice">便签</span>\n		</div>\n	</div>\n	<div class="cont_bbm">\n		<div class="bench_note" data-name="content">\n			\n		</div>\n	</div>\n</div>';return __p},this.JST["bench/bench-unaccept-task-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="task">\n	',isTita&&!isQqUse?(__p+="\n		",__p+=isPush?'\n		<span data-name="push" data-trigger="false"  class="task-name" id="'+(null==(__t=feedId)?"":__t)+'">'+(null==(__t=_.substring(taskName,18,!0))?"":__t)+"</span>\n		":'\n			<a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="task-name">'+(null==(__t=_.substring(taskName,18,!0))?"":__t)+"</a>\n		",__p+="\n	"):__p+='\n		<a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="task-name">'+(null==(__t=_.substring(taskName,18,!0))?"":__t)+"</a>\n	",__p+="\n	\n\n	",cycleId>0&&(__p+='\n		<span class="icon-task-cycle"  data-handler="ShowTitle"></span>\n	'),__p+="\n	",isNew&&(__p+='<span class="icon-new"></span>'),__p+='\n</div>\n<div class="organiser">\n	',__p+=showPrincipal?'\n		<span class="l">负责人：'+(null==(__t=principalUser)?"":__t)+"</span>\n	":'\n		<span class="l">发起人：'+(null==(__t=publishUser)?"":__t)+"</span>\n	",__p+='\n	<span class="r">'+(null==(__t=createDate)?"":__t)+"</span>\n</div>";return __p},this.JST["bench/bench-unaccept-task"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm">\r\n			<span class="name_bbm">\r\n				'+(null==(__t=title)?"":__t)+"（"+(null==(__t=Total)?"":__t)+"）\r\n			</span>\r\n		</div>\r\n		",showAllBtn&&(__p+='\r\n				<a class="all" href="'+(null==(__t=showAllUrl)?"":__t)+'">全部</a>\r\n			'),__p+='\r\n	</div>\r\n	<div class="cont_bbm">\r\n		<div class="bench_shi_to_accept_task">\r\n			<div class="list_stat">\r\n				\r\n			</div>\r\n			',Total>5&&(__p+='\r\n			<div class="page_stat">\r\n				<span class="icon-arrow-left icon-arrow-left-disabled" data-name="prev"></span>\r\n				<span class="icon-arrow-right" data-name="next"></span>\r\n			</div>\r\n			'),__p+="\r\n		</div>\r\n	</div>\r\n</div>";return __p},this.JST["bench/bench-undetermine-plan"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<a class="btn" href="#plan?&iTalentNavCode=tita-plan&tag_type=1&amp;tag_id=14" style="display:block;">待定计划('+(null==(__t=total)?"":__t)+")</a>";return __p},this.JST["bench/bench-week-composite"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="tt_bench_plan_time">\r\n	<div class="left">\r\n		<div class="left_time" data-name="date-box">\r\n			<span class="week" data-name="week">'+(null==(__t=week)?"":__t)+'</span>\r\n			<span class="date"><span data-name="month">'+(null==(__t=month)?"":__t)+'</span>月<span data-name="day">'+(null==(__t=date)?"":__t)+'</span>日<br/><span data-name="year">'+(null==(__t=year)?"":__t)+'</span>年</span>\r\n		</div>\r\n	</div>\r\n	<div class="right">\r\n		<ul class="right_week" data-name="week-list"></ul>\r\n	</div>\r\n</div>\r\n\r\n';return __p},this.JST["bench/bench-week-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="name_list">\r\n	<a data-trigger="false" href="javascript:void(0);">'+(null==(__t=CName)?"":__t)+'</a>\r\n</span>\r\n\r\n<span class="caret"></span>\r\n';return __p},this.JST["bench/bench-week-plan-implementation-empty"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench_right_chart_empty">\r\n	<div class="top_brce">如果制定了'+(null==(__t=i18n.plan_1)?"":__t)+' <br />将呈现类似如下统计图表</div>\r\n	<div class="cont_brce"><img src="'+(null==(__t=imgUrl)?"":__t)+'" alt="" /></div>\r\n	',showBottom&&(__p+='\r\n	<div class="bot_brce">现在就去 <a href="'+(null==(__t=planUrl)?"":__t)+'" title="" target="_blank">填写我的'+(null==(__t=i18n.plan_1)?"":__t)+"</a></div>\r\n	"),__p+="\r\n</div>";return __p},this.JST["bench/bench-week-plan-implementation"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="bench-basic-modules">\r\n	<div class="title_bbm">\r\n		<div class="left_bbm my_week_left_bbm">\r\n			<div class="myWeekPlanList">\r\n				<span class="name_bbm" data-name=\'title\' data-type="4">我本周'+(null==(__t=i18n.plan_1)?"":__t)+'执行情况</span>\r\n				<span class="icon-arrow-down" data-name="drop-down"></span>\r\n				<ul class="bench-drop-down" data-name="drop-down-box">\r\n					<li data-type="4" class="current">我本周'+(null==(__t=i18n.plan_1)?"":__t)+'执行情况</li>\r\n					<li data-type="3">我本月'+(null==(__t=i18n.plan_1)?"":__t)+'执行情况</li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="cont_bbm">\r\n		<div class="bench_weekplanstatus">\r\n			<div class="charts_wps" data-name="week-plan-status"></div>\r\n			<div class="init_wps" data-name="week-plan-empty"></div>\r\n		</div>\r\n	</div>\r\n</div>';return __p},this.JST["bench/bench-work-hour-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span data-name="push"  id="'+(null==(__t=feedId)?"":__t)+'" class="left">\n	'+(null==(__t=_.substring(taskName,16,!0))?"":__t)+'\n</span>\n<span class="right">（'+(null==(__t=hours)?"":__t)+"h）</span>";return __p},this.JST["bench/bench-work-hour"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="bench-basic-modules">\n	<div class="title_bbm">\n		<div class="left_bbm">\n			<span class="name_bbm">\n				'+(null==(__t=title)?"":__t)+"（"+(null==(__t=totalWorkHour)?"":__t)+'h）\n			</span>\n		</div>\n	</div>\n	<div class="cont_bbm">\n		<div class="bench_shi_to_accept_task">\n			<div class="list_stat">\n				\n			</div>\n			',0/0===Total&&(__p+='\n			<div class="page_stat">\n				<span class="icon-arrow-left icon-arrow-left-disabled" data-name="prev"></span>\n				<span class="icon-arrow-right" data-name="next"></span>\n			</div>\n			'),__p+="\n		</div>\n	</div>\n</div>";return __p},this.JST["bench/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='\n<div class="tt_tab_page">\n	<ul class="tab_tp" data-name="bench-tab">\n		<li class="active" data-type="my"><a href="#bench?type=my" data-trigger="false">我的工作</a></li>\n		<li data-type="group"><a href="#bench?type=group"  data-trigger="false">团队工作</a></li>\n	</ul>\n	<span class="down_tb" ><a href="javascript:void(0);" class="tt-guide" data-name="intro-plan"><span class="icon-light"></span>'+(null==(__t=i18n.plan_1)?"":__t)+'入门</a></span>\n</div>\n\n<div class="_tt_layout_home_right" data-name="right-container">\n	<div class="tt_enter_tms" data-name="enter-tms"></div>\n	<div class="un-basic-modules">\n		<a class="btn" href="#more/tasks?relation=2" style="display:block;">'+(null==(__t=i18n.task_1)?"":__t)+'中心</a>\n	</div>\n	<div data-name="bench-right-1"></div>\n	<div data-name="bench-right-2"></div>\n	<div data-name="bench-right-3"></div>\n	<div data-name="bench-right-4"></div>\n	<div data-name="bench-right-5"></div>\n	<div data-name="bench-right-6"></div>\n	<div class="bench-right-7" data-name="bench-right-7"></div>\n	<div data-name="bench-right-8"></div>\n	<div data-name="bench-right-9"></div>\n	<div data-name="bench-right-10"></div>\n</div>\n<div class="_tt_layout_home_container">\n	<!-- <div data-name="bench-plan-form"></div> -->\n	<div data-name="bench-plan"></div>\n</div>\n<div class="_tt_pagebottomline"></div> \n';return __p},this.JST}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require("../moment")):"function"==typeof define&&define.amd?define("momentZH",["moment"],b):b(a.moment)}(this,function(a){var b=a.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(a,b){return 12===a&&(a=0),"凌晨"===b||"早上"===b||"上午"===b?a:"下午"===b||"晚上"===b?a+12:a>=11?a:a+12},meridiem:function(a,b){var c=100*a+b;return 600>c?"凌晨":900>c?"早上":1130>c?"上午":1230>c?"中午":1800>c?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[下]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[上]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"日";case"M":return a+"月";case"w":case"W":return a+"周";default:return a}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});return b}),define("views/bench/bench-week-composite-view",["talent","templates/bench","moment","momentZH","TitaWidget"],function(a,b,c,d,e){var f=a.ItemView.extend({className:"week_list",tagName:"li",template:b["bench/bench-week-item"],onRender:function(){this.model.get("currentDate")==this.model.get("Date")&&this.$el.addClass("active"),this.$el.attr("data-date",this.model.get("Date"))}});return a.CompositeView.extend({itemView:f,itemViewContainer:"ul[data-name=week-list]",template:b["bench/bench-week-composite"],ui:{weekList:"ul[data-name=week-list]",weekItem:"ul[data-name=week-list] li",dateBox:"div[data-name=date-box]",week:"span[data-name=week]",month:"span[data-name=month]",day:"span[data-name=day]",year:"span[data-name=year]"},modelEvents:{"change:today":"_todayChange","change:activeDate":"_activeDateChange"},_todayChange:function(){},_activeDateChange:function(){var a=(this.model.get("today"),this.model.get("activeDate")),b=this.ui.weekList.find('li[data-date="'+a+'"]');this.ui.weekList.find("li").removeClass("active"),b.length&&b.addClass("active");var c=this._returnArrayDate();this.ui.week.html(c.week),this.ui.month.html(c.month),this.ui.day.html(c.date),this.ui.year.html(c.year)},templateHelpers:function(){var a=this._returnArrayDate();return a},events:function(){var a={};return a["click "+this.ui.weekItem]="clickWeekItemHandler",a["click "+this.ui.dateBox]="_timeBindPicker",a},initialize:function(){var b=this.model.get("date");this.today=c().format("YYYY/MM/DD"),this.model.set("activeDate",b),this.collection.model=a.Model.extend({idAttribute:"Date"})},onAfterItemAdded:function(a){a.model.get("Date")==this.model.get("date")&&a.$el.addClass("active")},clickWeekItemHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("data-date");this.model.set("activeDate",d),this.trigger("changeDate",d)},_returnArrayDate:function(){var a=this.model.get("date"),b=this.model.get("activeDate");b&&(a=b);var d=c(new Date(a)).toArray(),e=c(new Date(a)).day(),f={1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六",0:"星期日"};return{year:d[0],month:d[1]+1,date:d[2],week:f[e]}},onShow:function(){},_timeBindPicker:function(a){var b=this;a.stopPropagation();var c=Talent.$(a.currentTarget);this.$el.css({position:"relative"}),this.dateTimePickerView&&this.dateTimePickerView.close(),this.dateTimePickerView=new e.DateTimePickerView({rangepickerOptions:{startDate:this.model.get("activeDate"),endDate:this.model.get("activeDate"),format:"YYYY/MM/DD",timePicker:!1},isShowDateView:!0,isShowCycleView:!1,isShowLongView:!1,isShowTab:!1,leftBias:0,count:1}),this.listenTo(this.dateTimePickerView,"sure",function(a,c){b.model.set("activeDate",c.startDate),b.trigger("changeDate",c.startDate)},this),this.$el.append(this.dateTimePickerView.render().el),this.dateTimePickerView.onShow(),this.dateTimePickerView.show(c,{container:this.$el,pos:"bottom",leftBias:0})},onClose:function(){this.dateTimePickerView&&this.dateTimePickerView.close()}})}),define("views/common/empty-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{emptyContext:""},template:b["common/empty"],className:"tt_common_emptyinit",initialize:function(a){this.settings=Talent._.extend({},this.defaults,a)},templateHelpers:function(){var a=this.settings.emptyContext?this.settings.emptyContext:this.model.get("emptyContext"),b=0;return a&&(b=a.replace(/<[^>].*?>/g,"").replace(/[&nbsp;]/g,"").length),{emptyContext:a,className:b>24?"small_content_emptyinit":"content_emptyinit"}}})}),define("views/common/loading-view",["talent"],function(a){return a.ItemView.extend({template:a._.template('<img src="'+a.Context.getStaticUrl("images/loading_v1.gif")+'"><span>&nbsp;加载中...</span>'),className:"_tt_common_loading",hide:function(){this.$el.hide()},show:function(){this.$el.show()}})}),define("views/bench/bench-drop-down-view",["talent"],function(a){var b=a.ItemView.extend({template:a._.template('<a href="<%=href%>" title="" class="<%=css%>"><%=name%></a>'),tagName:"li",templateHelpers:function(){return{href:this.model.get("url")||"javascript:void(0);"}},onRender:function(){var a=this.model.get("type");a&&this.$el.attr("data-type",this.model.get("type"))}});return a.CollectionView.extend({tagName:"ul",className:"bench-drop-down",itemView:b,itemViewContainer:this.$el,initialize:function(){var b=this;this.isOpen=!1,a.$(document).off("click.Bench-Drop-Down-View"),a.$(document).on("click.Bench-Drop-Down-View",function(){b.hide()})},events:function(){var a={};return a["click li"]="_liClickHandler",a},onClose:function(){a.$(document).off("click.Bench-Drop-Down-View")},_liClickHandler:function(b){var c=a.$(b.currentTarget);this.hide(),this.trigger("selected",{type:c.attr("data-type"),name:c.html()})},show:function(a,b){if(this.isOpen)return this.isOpen=!1,void this.$el.hide();var c=a.offset(),d=a.height(),e=a.width(),f=this.$el.width();this.$el.find("a").removeClass("current"),this.$el.find("li[data-type="+b+"]").find("a").addClass("current"),this.$el.css({top:c.top+d,left:c.left-f+e,"z-index":99}).show()},hide:function(){this.$el.hide()}})}),define("views/common/plugins/class/class-treeItem-view",["talent","templates/common","$.tipsy"],function(a,b){return a.CompositeView.extend({template:b["common/plugins/class/class-move-item"],tagName:"li",initialize:function(){this.userInfo=a.Context.getUserInfo(),this.collection=this.model.children},ui:{enterprise:"span[data-name=enterprise]",person:"span[data-name=person]",permission:"span[data-name=lock-permission]"},appendHtml:function(a,b){a.$el.find("ul:first").append(b.el)},templateHelpers:function(){var a=!0;return 2==this.userInfo.Role?a=!0:this.model.get("IsTenant")&&(a=!1),{isEdit:a}},onRender:function(){this.$el.attr({id:this.model.get("id"),parent_id:this.model.get("parent_id"),"data-end":this.model.get("isEnd"),fullName:this.model.get("fullName"),ifAddClass:this.model.get("IsAllowSetPersonalLable")}),this._headIcoTispy()},_headIcoTispy:function(){a.$(this.ui.enterprise).tipsy({fallback:"企业分类",gravity:"s"}),a.$(this.ui.person).tipsy({fallback:"个人分类",gravity:"s"}),a.$(this.ui.permission).tipsy({fallback:"该分类下不允许添加个人分类",gravity:"s"})}})}),define("views/common/plugins/class/class-newFolder-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{type:"new",nameLen:200},template:b["common/plugins/class/class-move-new"],tagName:function(){return"rename"==this.options.type?"div":"li"},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a.click="_elHandler",a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},templateHelpers:function(){return{type:this.settings.type}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.attr("data-type","new-folder-form")},_elHandler:function(a){a.stopPropagation()},_focusHandler:function(b){a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus")},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=a.$.trim(c.val()),e=this.settings.nameLen;return a._.isStringBeyondLength(d,e)?(d=a._.substringWithM(d,e),c.val(d),!1):void 0},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.ui.input.val();this.model.set("name",a.$.trim(d)),""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel",this.model.get("name")),this.close()}})}),define("views/common/plugins/class/class-treeCollection-view",["talent","templates/common","views/common/plugins/class/class-treeItem-view","views/common/plugins/class/class-newFolder-view","tdialog"],function(a,b,c,d,e){return a.CollectionView.extend({defaults:{isEdit:!1},itemView:c,tagName:"ul",events:function(){var a={};return a["click ul"]="_ulHandler",a["click li div[data-name=title]"]="_checkHandler",a["click li span[data-name=toggle]"]="_toggleHandler",a["click li a[data-name=deleted]"]="_deleteHandler",a["click li a[data-name=edit]"]="_editHandler",a},collectionEvents:{reset:"render"},initialize:function(b){this.options=b,this.settings=a._.extend({},this.defaults,this.options),this.activeFolder=this.$el.find("li:first")},onShow:function(){var a=this.settings.isEdit,b=this.$el.find("li:first");b.addClass("unfold"),a?b.addClass("active"):b.find("ul:first").find("li:first").addClass("active")},itemViewOptions:function(){return{isEdit:this.settings.isEdit}},onAfterItemAdded:function(a){this.settings.isEdit||a.$el.find("div[data-name=klass-item-action]").remove()},_ulHandler:function(a){a.stopPropagation()},_toggleHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget).closest("li"),d=c.attr("data-end");"false"==d&&(c.hasClass("unfold")?c.removeClass("unfold"):c.addClass("unfold"))},_checkHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.closest("li"),e=(d.attr("data-end"),c.find("div[data-name=title-name]")),f=parseInt(d.attr("id")),g=d.attr("fullName");if(void 0!=g){var h=g.toString(),i=/^(分类\/)/;h=h.replace(i,"")}var j=this.settings.isEdit;"new-folder-form"!=d.attr("data-type")&&(0!=f||j)&&(this.activeFolder=d,this.$el.find("li").removeClass("active"),d.addClass("active"),this.trigger("checked",this.activeFolder,{id:f,name:a.$.trim(e.html()),fullName:h,parent_id:parseInt(d.attr("parent_id"))}))},_deleteHandler:function(b){var c=this;b.stopPropagation();var d=a.$(b.currentTarget),e=a.$(b.currentTarget).closest("li"),f=e.attr("parent_id"),g=d.attr("id");this._tipDialogView(d,"确定删除吗？子分类及相关信息都将被删除",function(){c.trigger("delete",{id:g,li:e,call:function(){e.remove();var a=c.$el.find('li[parent_id="'+f+'"]');if(!a.length){var b=c.$el.find('li[id="'+f+'"]');b.hasClass("unfold")&&b.find(".icon_tv").remove()}}})})},_editHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.attr("id"),e=a.$(b.currentTarget).closest("li");this._rendRenameView(d,c,e)},_rendRenameView:function(b,c,e){this.renameView&&this.renameView.close();var f=c.closest("div[data-name=title]"),g=f.find("div[data-name=title-name]"),h=g.html();this.renameView=new d({type:"rename",model:new a.Model({name:h})}),this.listenTo(this.renameView,"submit",function(a){this.trigger("rename",{id:b,name:a,node:e,node_name:g})},this),this.listenTo(this.renameView,"close",function(){g.html(this.renameView.model.get("name"))},this),g.html(this.renameView.render().$el),this.renameView.ui.input.focus()},_tipDialogView:function(a,b,c){var d=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new e({type:"tipsy",sure:!0,cancel:!0,sure:function(){c&&c(),d.tDialogView.close()}}),this.tDialogView.render().$el.appendTo(this.$el);var f=$("body").find(".tu-page-container").scrollTop()||0;this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",topBias:f-50,className:"ask"})},onClose:function(){}})}),define("views/common/plugins/class/class-search-view",["talent","templates/common","tdialog"],function(a,b){return a.ItemView.extend({template:b["common/plugins/class/class-search"],className:"class_search",ui:{content:".smember_condition_input",lableUl:"ul[data-name=lable-ul]",lableList:"ul[data-name=lable-list]",lableNameItem:"li[data-name=lablename]",contentHolder:".smember_condition_label",smemberHeaderInput:".smember_header_input"},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.$el.on("click",function(a){a.stopPropagation()}),this.collection=new a.Collection},events:function(){var a={};return a["focusout .smember_condition_input"]="onInputFocusOut",a["focusin .smember_condition_input"]="onInputFocusin",a["click "+this.ui.lableNameItem]="_checkHandler",a["click "+this.ui.contentHolder]="_smemberHandler",a},onRender:function(){var a=this;this.$el.find("#lable-list").hide(),this.$el.find("#lableName").on("keyup",function(){a.lableList()}),this.$el.find("#lableName").on("keypress",function(b){13==b.which&&a.lableList()})},onInputFocusOut:function(){this.ui.smemberHeaderInput.removeClass("input-focus"),""==this.ui.content.val()&&this.ui.contentHolder.show()},_checkHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(d);this.$el.find("#lableName").val(c.text()),this.$el.find("#lable-list").hide(),this.trigger("checkedLable",e.toJSON())},_smemberHandler:function(b){this.ui.contentHolder.hide();a.$(b.currentTarget);this.$el.find("#lableName").focus()},onInputFocusin:function(){this.ui.smemberHeaderInput.addClass("input-focus"),this.ui.contentHolder.hide();var b=a.$.trim(this.ui.content.val());return null==b||""==b?void this.$el.find("#lable-list").hide():void 0},lableList:function(){var b=this,c=a.$.trim(this.ui.content.val());return null==c||""==c?void this.$el.find("#lable-list").hide():void a.app.request("Lable:searchClassData",{user_id:this.userInfo.Id,filter:c}).done(function(a){b.collection.reset(a.lables||[]),b._listPlan(a.lables)}).fail(function(){})},_listPlan:function(b){var c="";null!=b&&b.length>0?a._.each(b,function(a){""!=a.name&&null!=a.name&&void 0!=a.name&&(c+='<li data-name="lablename" parentId ="'+a.parent_id+'" id="'+a.id+'">'+a.name+"</li>")}):c+="<li>无搜索结果</li>",this.ui.lableUl.empty(),this.ui.lableUl.append(c),this.$el.find("#lable-list").show()}})}),define("views/common/plugins/class/class-project-tab-item-view",["talent","templates/common"],function(a,b){var c=a.ItemView.extend({className:"class_project_tab",template:b["common/plugins/class/class-project-tab"],ui:{tabA:"a"},initialize:function(){this.$el.on("click",function(a){a.stopPropagation()})},events:function(){var a={};return a["click "+this.ui.tabA]="_clickTabName",a},_clickTabName:function(b){this.$el.find("a").removeClass("current");var c=a.$(b.currentTarget);c.addClass("current"),this.trigger("changeTree",c.attr("data-id"))},onRender:function(){}});return c}),define("views/common/plugins/class/class-view",["talent","templates/common","views/common/empty-view","views/common/plugins/class/class-treeItem-view","views/common/plugins/class/class-treeCollection-view","views/common/plugins/class/class-search-view","views/common/plugins/class/class-project-tab-item-view","tdialog"],function(a,b,c,d,e,f,g,h){var i=a.ItemView.extend({defaults:{type:"new",nameLen:100},template:b["common/plugins/class/class-move-new"],tagName:function(){return"rename"==this.options.type?"div":"li"},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a.click="_elHandler",a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},templateHelpers:function(){return{type:this.settings.type}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.attr("data-type","new-folder-form")},_elHandler:function(a){a.stopPropagation()},_focusHandler:function(b){var c=a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus"),"rename"==this.settings.type&&this.model.get("name")&&c.select()},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=a.$.trim(c.val()),e=this.settings.nameLen;return a._.isStringBeyondLength(d,e)?(d=a._.substringWithM(d,e),c.val(d),!1):void 0},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.ui.input.val();this.model.set("name",a.$.trim(d)),""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel",this.model.get("name")),this.close()}});return a.Layout.extend({defaults:{showTitle:!1,showButtonSure:!1,showButtonAdd:!1,showButtonReset:!1,showButtonCancel:!1,isEdit:!1,isShowSearch:!1,isShowProjectTab:!1},template:b["common/plugins/class/class-move"],itemFolderTemplate:b["common/plugins/class/class-move-item"],className:"tt_class_tree",ui:{closed:"span[data-name=klass-move-close]",newFolder:"button[data-name=klass-move-new-folder]",submit:"button[data-name=klass-move-submit]",title:"div[data-name=title]",actionArea:"div[data-name=klass-action]",emptyArea:"div[data-name=empty]",buttonReset:"button[data-name=klass-move-reset]",buttonCancel:"button[data-name=klass-move-cancel]",searchClass:"div[data-name=search-class]"},regions:{tree:"div[data-name=tree]",emptyArea:"div[data-name=empty]",classProjectTab:'div[data-name="class-project-tab"]'},collectionEvents:{reset:"_collectionReset"},_collectionReset:function(){var a=this.settings.isEdit,b=this.collection.toJSON()[0],c=b.children||[];
a?b.length&&this.model.set({id:b[0].id,name:b[0].name}):this.model.set(c.length?{id:c[0].id,name:c[0].name}:{id:0,name:""}),this.render()},events:function(){var a={};return a["click "+this.ui.closed]="_closeHandler",a["click "+this.ui.submit]="_submitHandler",a["click "+this.ui.newFolder]="_newFolderHandler",a["click "+this.ui.buttonReset]="_resetHandler",a["click "+this.ui.buttonCancel]="_closeHandler",a["focus "+this.ui.newFolderForm_input]="_focusNewFolderHandler",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.addAjax=!1,this.model.set({id:0,name:"",parent_id:0}),a.$(document).on("click.documentlist_permissions",function(){$(document).find(".documentlist_permissions").hide(),$(document).find(".activeClass").hide()}),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){var a=this;this._customView(),this.settings.isShowProjectTab?(this._renderClassProjectTabView(),setTimeout(function(){a._changeClassViewCollection(2771)},0)):this._renderTreeView(),this.settings.isShowSearch&&this._searchView(),this._renderEmptyView()},_renderClassProjectTabView:function(){var a=this;this.classProjectTabView=new g,this.classProjectTab.show(this.classProjectTabView),this.listenTo(this.classProjectTabView,"changeTree",function(b){a._changeClassViewCollection(b)})},_changeClassViewCollection:function(b){if(0!=b){var c=this.collection.toJSON(),d=c[0].children,e=[];a._.each(d,function(a){a.id==b&&e.push(a)}),c[0].children=e,this._renderTreeView(c),this.$el.find('li[id="'+b+'"]').addClass("unfold")}else this._renderTreeView()},_searchView:function(){var a=this;this.searchView&&this.searchView.close(),this.searchView=new f,this.listenTo(this.searchView,"checkedLable",function(b){a.trigger("checkedLable",b),a._currentLiTree(b)}),this.ui.searchClass.append(this.searchView.render().el)},_currentLiTree:function(a){function b(a){var d=c.$el.find("div[data-name='tree'] li[id="+a+"]");if(d.length&&0!=a){var e=d.attr("parent_id");d.addClass("unfold"),b(e)}}var c=this,d=c.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').attr("parent_id");b(d),this.$el.find('div[data-name="tree"] li').removeClass("active"),this.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').addClass("active");var e=this.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').position();this.trigger("scrollTop",{id:a.id,top:e.top})},setPosition:function(b,c){var d=b.offset(),e=b.outerWidth(),f=b.outerHeight(),g=this.$el,h=g.outerWidth(),i={pos:"left"},c=a._.extend({},i,c);this.$el.css("right"==c.pos?{top:d.top+f+5,left:d.left-h+e}:{top:d.top+f+5,left:d.left})},_renderEmptyView:function(){var a=this.settings.isEdit,b='请到<a href="#set?page_id=class">个人设置</a>下设置分类';a&&(b="点击 添加类别 添加分类"),this.ui.emptyArea.hide();var d=this.collection.toJSON();if(d.length&&d[0]&&d[0].children)return void this.ui.emptyArea.hide();var e=new c({emptyContext:b});this.emptyArea.show(e),this.ui.emptyArea.show()},_customView:function(){this.settings.showTitle||this.ui.title.remove(),this.settings.showButtonSure||this.ui.submit.remove(),this.settings.showButtonAdd||this.ui.newFolder.remove(),this.settings.showButtonSure||this.settings.showButtonAdd||this.ui.actionArea.remove(),this.settings.showButtonReset||this.ui.buttonReset.remove(),this.settings.showButtonCancel||this.ui.buttonCancel.remove()},_submitHandler:function(b){var c=a.$(b.currentTarget),d=null,e=null,f=null,g=this.model.get("name");""==g?(e=this.searchView.$el.find("#lableName").attr("ids"),d=this.searchView.$el.find("#lableName").val(),f=this.searchView.$el.find("#lableName").attr("parentid")):(e=this.model.get("id"),d=this.model.get("name"),f=this.model.get("parent_id")),this.model.set("id",e),this.model.set("parent_id",f),this.model.set("name",d);var h=this.treeView.collection.models[0].children;h&&!h.length?this.trigger("submit",{id:"",name:"",parent_id:""},c):this.trigger("submit",{id:this.model.get("id"),name:this.model.get("name"),parent_id:this.model.get("parent_id")},c),this.close()},_resetHandler:function(b){a.$(b.currentTarget);this.trigger("reset")},_closeHandler:function(b){a.$(b.currentTarget);this.trigger("closed"),this.close()},_newFolderHandler:function(b){var c=a.$(b.currentTarget),e=this;this.newFolderView&&this.newFolderView.close(),this.newFolderView=new i,this.listenTo(this.newFolderView,"submit",function(b){this.trigger("new",{name:b,parent_id:this.model.get("id"),node:c,call:function(b){b.isEnd=!0;var c=new d({model:new a.Model(b)});e.activeFolder.find("ul:first").prepend(c.render().el),e.ui.emptyArea.hide();var f=b.parent_id;e._addTreeCollectionIcon(f)}})},this),this.listenTo(this.newFolderView,"cancel",function(){this.activeFolder.removeClass("unfold")},this);{var f=this.activeFolder.attr("ifaddclass");this.activeFolder.attr("fullname")}"false"!=f?(this.activeFolder.addClass("unfold"),this.activeFolder.find("ul:first").prepend(this.newFolderView.render().el),this.newFolderView.ui.input.focus()):e._tipDialogView(c,"该分类下不允许创建个人分类")},_addTreeCollectionIcon:function(a){var b=this,c=this.$el.find("li [id='"+a+"']");this.$el.find("#iconTv").removeAttr("id"),c.children(":first").prepend('<span id="iconTv"  class="icon_tv" data-name="toggle"></span>'),this.$el.find("#iconTv").click(function(){var c=b.$el.find("li [id='"+a+"']").hasClass("unfold");c?b.$el.find("li [id='"+a+"']").removeClass("unfold"):b.$el.find("li [id='"+a+"']").addClass("unfold")})},_tipDialogView:function(a,b,c){var d=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new h({type:"tipsy",sure:function(){c&&c(),d.tDialogView.close()},cancel:function(){d.tDialogView&&d.tDialogView.close()}}),this.tDialogView.render().$el.appendTo("body"),this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",className:"warn"})},_renderTreeView:function(a){var b=this,c=Backbone.Model.extend({initialize:function(){var a=this.get("children");a&&(this.children=new d(a),this.unset("children"))}}),d=Backbone.Collection.extend({model:c});if(a)var f=a;else var f=this.collection.toJSON();this.treeView=new e({collection:new d(f),isEdit:this.settings.isEdit}),this.activeFolder=this.treeView.$el,this.listenTo(this.treeView,"delete",function(a,c){b.trigger("delete",a,c)}),this.listenTo(this.treeView,"rename",function(a){var c=a.node;c.attr("id")==this.activeFolder.attr("id")&&this.model.set("name",a.name),b.trigger("rename",a)}),this.listenTo(this.treeView,"rename",function(a){var b=a.node;b.attr("id")==this.activeFolder.attr("id")&&this.model.set("name",a.name)}),this.listenTo(this.treeView,"checked",function(a,b){this.activeFolder=a,this.model.set({id:b.id,name:b.name,fullName:b.fullName,parent_id:b.parent_id}),this.trigger("checked",{id:b.id,name:b.name,fullName:b.fullName,parent_id:b.parent_id})},this),this.tree&&this.tree.show(this.treeView)},onClose:function(){this.tDialogView&&this.tDialogView.close(),a.$(document).off("click.documentlist_permissions")}})}),define("views/common/plugins/class/checked-class-composite-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({tagName:"li",template:b["common/plugins/class/checked-class-item"],initialize:function(){},ui:{delItem:".smember_btn_reduce"},events:function(){var a={};return a["click "+this.ui.delItem]="_deleteItem",a},onRender:function(){},_deleteItem:function(){this.trigger("deleteItem",this.model)}});return a.CompositeView.extend({defaults:{emptyContext:"请从左侧点击选择"},itemView:d,template:_.template("<ul></ul>"),itemViewContainer:"ul",emptyView:c,events:function(){var a={};return a},initialize:function(){},onRender:function(){var a=this;this.on("itemview:deleteItem",function(b){a.collection.remove(b.model)})},itemViewOptions:function(){return{emptyContext:this.defaults.emptyContext}}})}),define("views/common/plugins/class/project-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({template:b["common/plugins/class/work-item"],tagName:"li",onRender:function(){this.$el.attr("id",this.model.get("WorkId"))}}),e=a.CompositeView.extend({itemView:d,itemViewContainer:"ul",template:b["common/plugins/class/work-list"],className:"tt_klass_work",events:{"click li":"_chekcoutItemHandler","click div[data-name=work-title]":"_toggleHandler"},ui:{workList:"ul[data-name=work-list]"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){this.settings.isDefaultChecked&&this.$el.find("li:first").addClass("active")},_toggleHandler:function(b){var c=a.$(b.currentTarget),d=c.next("ul"),e=d.is(":hidden");this.ui.workList.hide(),e?(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-minus-square"),d.show()):(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-plus-square"),d.hide())},_chekcoutItemHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(parseInt(d));this.$el.find("li").removeClass("active"),c.addClass("active"),this.trigger("checked",{id:d,name:e.get("WorkName")})}});return a.Layout.extend({template:b["common/plugins/class/project"],className:"tt_class_tree",ui:{emptyArea:"div[data-name=empty]"},regions:{workBox:"div[data-name=work-box]",workJoinBox:"div[data-name=work-box-join]",emptyArea:"div[data-name=empty]"},events:function(){var a={};return a},initialize:function(){this.i18n=a.Context.getI18n(),this.joinCollection=this.options.joinCollection},onRender:function(){this._rendWorkListView(this.workBox,this.collection,"create"),this._rendWorkListView(this.workJoinBox,this.joinCollection,"join"),this._renderEmptyView()},_renderEmptyView:function(){if(this.ui.emptyArea.hide(),this.collection.length||this.joinCollection.length)return void this.ui.emptyArea.hide();var a=new c({emptyContext:"请在"+this.i18n.work_1+"功能下创建"+this.i18n.work_1});this.emptyArea.show(a),this.ui.emptyArea.show()},_rendWorkListView:function(b,c,d){var f="我负责的";"join"==d&&(f="我参与的");var g=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"WorkId"})}}),h=new e({collection:new g(c.toJSON()),model:new a.Model({title:f})});this.listenTo(h,"checked",function(a){this.trigger("checked",a)},this),b.show(h)}})}),define("views/common/plugins/class/class-tree-component-view",["talent","templates/common","views/common/plugins/class/class-view","views/common/plugins/class/checked-class-composite-view","views/common/plugins/class/project-view"],function(a,b,c,d,e){return a.Layout.extend({defaults:{isShowSearch:!1,title:"",pluginType:0},template:b["common/plugins/class/class-tree-component"],className:"class_data_filter_dropdown",initialize:function(b){var c=this;this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.classCollection=new a.Collection,this.checkedCollection=new a.Collection,b.checkedClassCollection&&(this.checkedCollection=b.checkedClassCollection),a.$(document).off("click.Class-Tree-Component-View"),a.$(document).on("click.Class-Tree-Component-View",function(){c.close()}),this.$el.off("click"),this.$el.on("click",function(a){a.stopPropagation()})},regions:{classArea:".class_data_type_list",checkedTypeList:".class_data_checked_type_list"},ui:{sureBtn:'a[data-handler="Submit"]',canceltBtn:'a[data-handler="Cancel"]',closeBtn:'a[data-handler="Close"]',cleanBtn:'a[data-handler="clean"]',allClass:'[data-name="all"]',allProject:'[data-name="project"]'},events:function(){var a={};return a["click "+this.ui.sureBtn]="_sureChecked",a["click "+this.ui.canceltBtn]="_cancelChecked",a["click "+this.ui.closeBtn]="_cancelChecked",a["click "+this.ui.cleanBtn]="_cleanChecked",a["click "+this.ui.allClass]="_allClass",a["click "+this.ui.allProject]="_allProject",a},templateHelpers:function(){return{title:this.settings.title,pluginType:this.settings.pluginType}},_cleanChecked:function(){this.checkedCollection.reset(),this.close(),this.trigger("emptyClass")},_sureChecked:function(){this.trigger("checkedClass",this.checkedCollection.toJSON()),this.close()},_allClass:function(){this.ui.allClass.addClass("active"),this.ui.allProject.removeClass("active"),this._requestClassData()},_allProject:function(){this.ui.allClass.removeClass("active"),this.ui.allProject.addClass("active"),this._requestProjectData()},_cancelChecked:function(){this.close(),this.trigger("resetClass")},onClose:function(){a.$(document).on("click.Class-Tree-Component-View")},showView:function(){this.$el.show()},hideView:function(){this.$el.hide()},setPositon:function(b,c){b.outerHeight(),b.offset(),b.position();a.Context.setPosition(b,this.$el,{pos:"bottomLeft",container:c||a.$("body")})},onRender:function(){this._requestClassData(),this._renderClassView(),this._renderCheckedClassCompositeView()},_renderCheckedClassCompositeView:function(){this.checkedClassCompositeView=new d({collection:this.checkedCollection}),this.checkedTypeList.show(this.checkedClassCompositeView)},_requestProjectData:function(){var b=this;this.allProjectView?b.classArea.show(b.allProjectView):(this.allProjectView=new e({collection:new a.Collection,joinCollection:new a.Collection,pluginType:this.settings.pluginType}),this.listenTo(this.allProjectView,"checked",function(a){b.checkedCollection.push({id:a.id,name:a.name,fullName:a.name,type:2})}),a.app.request("Project:getProject",{app_id:1,app_type:1}).done(function(a){var c=a.CreateWorks||[],d=a.JoinWorks||[];b.allProjectView.collection.reset(c),b.allProjectView.joinCollection.reset(d),b.classArea.show(b.allProjectView)}))},_requestClassData:function(){var b=this;this.classView?this._renderClassView():a.app.request("Lable:getLableData",{obj_id:this.userInfo.Id,obj_type:1,to_userId:this.options.to_userId||0}).done(function(a){b.classCollection.reset(a.lables),b._renderClassView()}).fail(function(){})},_renderClassView:function(){var a=this;this.classView||(this.classView&&this.classView.close(),this.classView=new c({collection:this.classCollection,edit:!1,isShowSearch:this.settings.isShowSearch,pluginType:this.settings.pluginType}),this.listenTo(this.classView,"checkedLable",function(b){var c=a.checkedCollection.where({id:Number(b.id)});0==c.length?a.checkedCollection.add({id:b.id,name:b.name,fullName:b.fullName||"",type:1}):a.checkedCollection.findWhere({id:Number(b.id)}).set({id:b.id,name:b.name,fullName:b.fullName||"",type:1})},this),this.listenTo(this.classView,"checked",function(b){var c=a.checkedCollection.where({id:b.id});0==c.length&&a.checkedCollection.push({id:b.id,name:b.name,fullName:b.fullName,type:1})},this),this.listenTo(this.classView,"scrollTop",function(b){var c=this.$el.find(".class_data_type_list").height()/2,d=parseInt(this.$el.find(".class_data_type_list .cont_rd").css("paddingTop"));a.$el.find(".class_data_type_list").animate({scrollTop:b.top-c+d})},this)),this.classArea.show(this.classView)}})}),define("views/common/plugins/popup/sort-pop-view",["talent","templates/common","tdialog","moment","momentZH","$.tipsy"],function(a,b,c){return a.ItemView.extend({defaults:{displayType:"inline",container:null,node:null,isShowStar:!0},template:b["common/plugins/popup/sort-pop"],ui:{defaultSort:'[data-name="default"]',startSort:'[data-name="start"]',endSort:'[data-name="end"]',createSort:'[data-name="create"]',star:'[data-name="star"]',item:".item"},events:function(){var a={};return a["click "+this.ui.item]="_chooseHandler",a},modelEvents:{change:"render"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.renderTag=!0,this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",minWidth:90,className:"_tt_dialog ns-sortPop-dialog",displayType:this.settings.displayType}),this.settings.container.append("inline"==this.settings.displayType?this.Dialog.render().$el:this.Dialog.render().$el)},templateHelpers:function(){return this.settings},onRender:function(){var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"bottomRight",arrow:!1,container:this.settings.container}),b.Dialog.hide(),a.$(document).off("click.sortPop"),a.$(document).on("click.sortPop",function(){b.Dialog.hide()}),this.renderTag=!1),this.$("[original-title]").tipsy({gravity:"s"})},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},_chooseHandler:function(a){var b=this.$(a.currentTarget),c=b.attr("data-name"),d=this.model.get("SortType");switch(b.trigger("mouseleave"),c){case"default":d=1;break;case"start":d=3==d?2:3;break;case"end":d=5==d?4:5;break;case"create":d=7==d?6:7;break;case"star":d=8}this.model.set("SortType",d),this.trigger("submit"),this.Dialog.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.sortPop")}})}),define("views/common/plugins/popup/member-sort-view",["talent","templates/common","tdialog","moment","momentZH","$.tipsy"],function(a,b,c){return a.ItemView.extend({defaults:{displayType:"inline",node:null,container:null},template:b["common/plugins/popup/member-sort"],ui:{check:".check",labelTxt:".label",sure:'[data-name="sure"]'},events:function(){var a={};return a["click "+this.ui.check]="_checkHandler",a["click "+this.ui.labelTxt]="_checkHandler",a["click "+this.ui.sure]="_submitHandler",a},modelEvents:{change:"_checkIsEmpty"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.renderTag=!0,this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",className:"_tt_dialog ns-memberSort-dialog",displayType:this.settings.displayType}),this.settings.container.append("inline"==this.settings.displayType?this.Dialog.render().$el:this.Dialog.render().$el);var b=this.collection.findWhere({FidleName:"TaskPrincipal"}),d=this.collection.findWhere({FidleName:"TaskCreate"}),e=this.collection.findWhere({FidleName:"TaskParticipator"}),f=[];b&&f.push({key:"r",value:"1"}),d&&f.push({key:"c",value:"3"}),e&&f.push({key:"p",value:"2"}),this.model.set({checkAll:!0,isEmpty:!1,isShowRes:b,isShowCreate:d,isShowPart:e});for(var g=0,h=f.length;h>g;g++)this.model.set(f[g].key,!0);this.dataSet=f,this.caculateData()},onRender:function(){var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"bottomRight",arrow:!1,container:this.settings.container}),a.$(document).off("click.memberSortPop"),a.$(document).on("click.memberSortPop",function(){b.Dialog.hide()}))},_checkIsEmpty:function(){for(var a="",b="",c=!0,d=this.dataSet,e=this.model.toJSON(),f=0,g=d.length;g>f;f++)a=d[f].key,b=d[f].value,e[a]&&(c=!1);this.model.set({isEmpty:c},{silent:!0})},_checkHandler:function(a){var b=this.$(a.currentTarget).parent().attr("data-type"),c=this.model.toJSON(),d=c[b],e=this.dataSet,f=!0;if(this.model.set(b,!d),"checkAll"==b)for(var g=0,h=e.length;h>g;g++)this.model.set(e[g].key,!d);else{c=this.model.toJSON();for(var g=0,h=e.length;h>g;g++)c[e[g].key]||(f=!1);this.model.set({checkAll:f})}this.renderTag=!1,this.render(),a.stopPropagation()},caculateData:function(){for(var a="",b="",c=[],d=this.dataSet,e=this.model.toJSON(),f=0,g=d.length;g>f;f++)a=d[f].key,b=d[f].value,e[a]&&c.push(b);this.model.set({RelationType:c.join(",")})},_submitHandler:function(){var a=this.ui.sure;a.hasClass("btn-disabled")||(this.caculateData(),this.hide(),this.trigger("submit"))},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.memberSortPop")}})}),define("views/common/plan/plan-data-filter-view",["talent","templates/common","views/common/plugins/class/class-tree-component-view","$.tipsy","helpers/context","views/common/plugins/popup/sort-pop-view","views/common/plugins/popup/member-sort-view"],function(a,b,c,d,e,f,g){var h=a.ItemView.extend({template:b["common/plan/plan-data-filter-dropdown"],className:"tt_data_filter_dropdown",ui:{buttonSubmit:"button[data-name=submit]",dottedTips:'span[data-name="dotted-tips"]'},modelEvents:{"change:allChecked":"render"},events:{"click li":"_clickLiHandler","click button[data-name=submit]":"_submitDataHandler",'click div[data-name="filter-all"] a':"_clickFilterAllHandler"},templateHelpers:function(){return{data:this.options.collection.toJSON()}},initialize:function(){var b=this,c=this.options.collection||new a.Collection([]),d=a._.where(c.toJSON(),{Checked:!0})||[];d=a._.compact(d),this.activeData=a._.pluck(d,"Id")||[],this.activeLen=d.length||0,a.$(document).off("click.Plan-Data-Filter-Dropdown-View"),a.$(document).on("click.Plan-Data-Filter-Dropdown-View",function(){b.close()}),this.$el.off("click"),this.$el.on("click",function(a){a.stopPropagation()}),this.activeLen==this.options.collection.length?this.model.set("allChecked",!0):this.model.set("allChecked",!1)},_clickFilterAllHandler:function(){var b=this;a._.each(this.options.collection.models,function(a){a.set("Checked",!b.model.get("allChecked"))}),this.model.set("allChecked",!this.model.get("allChecked")),this.model.get("allChecked")?(this.activeLen=b.options.collection.length,this.activeData=a._.map(b.options.collection.models,function(a){return a.get("Id")})):(this.activeLen=0,this.activeData=[]),this.activeLen>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled")},onRender:function(){var b=this.activeLen;b>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled"),a.$(this.ui.dottedTips).tipsy({fallback:"虚线下级",gravity:"s"})},onClose:function(){a.$(document).off("click.Plan-Data-Filter-Dropdown-View"),a.$(".tipsy").remove()},_clickLiHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.find("a[data-name=input-checkbox]"),e=this.activeLen,f=this.activeData,g=this.options.collection,h=parseInt(c.attr("id")),i=g.findWhere({Id:h});d.hasClass("checkbox-checked")?(d.removeClass("checkbox-checked"),e-=1,f=a._.without(f,h),i&&i.set("Checked",!1)):(d.addClass("checkbox-checked"),e+=1,f.push(h),i&&i.set("Checked",!0)),this.activeLen=e,this.activeData=f,e>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled"),e==this.options.collection.length?this.model.set("allChecked",!0):this.model.set("allChecked",!1)},_submitDataHandler:function(b){var c=(a.$(b.currentTarget),this.activeData),d=this.activeLen;this.trigger("submit",c),0!=d&&this.close()}});return a.ItemView.extend({defaults:{status:!0,member:!0,Class:!0,memberType:!0,sortType:!0,isShowStar:!0,isShowDetail:!0,statusCollection:new a.Collection([{Name:"未开始",Id:0,Checked:!0},{Name:"进行中",Id:1,Checked:!0},{Name:"已完成",Id:2,Checked:!0},{Name:"已延迟",Id:3,Checked:!0},{Name:"已取消",Id:4,Checked:!0},{Name:"暂停中",Id:6,Checked:!0}]),memberCollection:new a.Collection,ClassCollection:new a.Collection},template:b["common/plan/plan-data-filter"],className:"tt_data_filter",ui:{sort:'[data-name="sort"]',detail:'[data-name="detail-mode"]',memberType:'[data-type="memberType"]'},events:function(){var a={};return a["click .status-item"]="_clickItemTypeHandler",a["click "+this.ui.detail]="_setDetailHander",a["click "+this.ui.sort]="_popSortHandler",a},modelEvents:{"change:detail_checked":"_detailCheckChange"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo();var b=this.settings.memberCollection;b.each(function(a){a.set("Checked",!0)});var c=this.settings.statusCollection;c.each(function(a){a.set("Checked",!0)}),this.model.set({SortType:1})},templateHelpers:function(){return this.settings.detail_checked=this.model.get("detail_checked")?this.model.get("detail_checked"):!1,this.settings},onRender:function(){var a=this.$el.find("li:first").attr("data-type");this.model.set("type",a)},onShow:function(){this.sortPopView&&this.sortPopView.close(),this.sortPopView=new f({node:this.ui.sort,container:this.$el,model:this.model,isShowStar:this.settings.isShowStar}),this.sortPopView.render(),this.sortPopView.on("submit",function(){this.trigger("dataFilter",this.model.toJSON())},this)},_detailCheckChange:function(){var a=this.model.get("detail_checked"),b=this.ui.detail;b.removeClass("checkbox-checked"),a&&b.addClass("checkbox-checked")},_popSortHandler:function(b){a.$(b.currentTarget);this._closeAllPop(),b.stopPropagation(),this.sortPopView.show()},_setDetailHander:function(){var a=this.model.get("detail_checked");this.model.set({detail_checked:!a}),this.trigger("show_detail",this.model.toJSON())},_setMarkHander:function(){},_closeAllPop:function(){this.dropDownView&&this.dropDownView.close(),this.classTreeComponentView&&this.classTreeComponentView.close(),this.memberSortView&&this.memberSortView.hide(),this.sortPopView&&this.sortPopView.hide()},_clickItemTypeHandler:function(b){b.stopPropagation(),this._closeAllPop();var c=a.$(b.currentTarget),d=c.attr("data-type");"class"==d?this._renderClassTreeView(c,d):"memberType"==d?this._clickMemberHandler():this._renderDropDownView(c,d)},_clickMemberHandler:function(){var b=this,c=this.model.get("to_user_id"),d=this.userInfo.Id,e=!0;c=c?c:d,e=c==d?!0:!1,this.model.set("isSelfView",e),this.memberTypes?this.memberSortView.show():a.app.request("Customize:getData",{obj_id:c,obj_type:1,customize_type:"1,2"}).done(function(c){var d=null,e=null,f=a._.where;d=f(c,{CustomizaBehaviorType:1}),e=f(d[0].Fields,{FieldValue:!0}),b.memberTypes=e,b._renderMemberTypeView()})},_renderMemberTypeView:function(){this.memberSortView&&this.memberSortView.close(),this.memberSortView=new g({node:this.ui.memberType,container:this.$el,model:this.model,collection:new a.Collection(this.memberTypes)}),this.memberSortView.on("submit",function(){this.trigger("dataFilter",this.model.toJSON())},this),this.memberSortView.render()},_renderClassTreeView:function(a,b){var d=this;this.classTreeComponentView&&this.classTreeComponentView.close(),this.classTreeComponentView=new c({checkedClassCollection:this.settings.ClassCollection,isShowSearch:!0,title:"选择类别",pluginType:1}),this.$el.append(this.classTreeComponentView.render().$el),this.classTreeComponentView.setPositon(a,this.$el),this.listenTo(this.classTreeComponentView,"checkedClass",function(a){d.settings.ClassCollection.reset(a),d.model.set(b,a),d.trigger("dataFilter",d.model.toJSON())}),this.listenTo(this.classTreeComponentView,"emptyClass",function(){d.settings.ClassCollection.reset(),d.model.set(b,""),d.trigger("dataFilter",d.model.toJSON())}),this.listenTo(this.classTreeComponentView,"resetClass",function(){d.model.set(b,"")})},_renderDropDownView:function(b,c){{var d=this.settings[c+"Collection"],e=this.model.get("status")||[];this.model.get("member")||[]}a._.each(e,function(a){var b=d.findWhere({Id:a});b&&b.set("Checked",!0)}),"member"==c&&d.each(function(a){var b=a.toJSON();a.set({Type:b.type,Name:b.name,Id:b.userId})}),this.dropDownView&&this.dropDownView.close(),this.dropDownView=new h({model:this.model,collection:d}),this.listenTo(this.dropDownView,"submit",function(a){this.model.set(c,a),this.trigger("dataFilter",this.model.toJSON())},this),this.$el.append(this.dropDownView.render().el),a.Context.setPosition(b,this.dropDownView.$el,{container:this.$el,pos:"bottomRight",leftBias:0,topBias:4})},onClose:function(){this.dropDownView&&this.dropDownView.close(),this.classTreeComponentView&&this.classTreeComponentView.close(),this.memberSortView&&this.memberSortView.close(),this.sortPopView&&this.sortPopView.close()}})}),define("views/bench/bench-plan-component-view",["talent","templates/bench","moment","momentZH","views/bench/bench-week-composite-view","views/common/empty-view","views/common/loading-view","views/bench/bench-drop-down-view","$.tipsy","views/common/plan/plan-data-filter-view","TitaWidget"],function(a,b,c,d,e,f,g,h,i,j,k){a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"taskId"})}});return a.Layout.extend({template:b["bench/bench-my-plan-component"],ui:{createNewArea:"div[data-name=plan-cereate-form]",planTitle:'div[data-name="plan-title"]',expireTitle:'[data-name="expire-title"]',expireTitleName:'div[data-name="expire-title"] .txt',planTitleName:'div[data-name="plan-title"] .txt',benchPlanArea:'div[data-name="bench-plan-area"]',benchExpirePlanArea:'div[data-name="bench-expire-plan-area"]',toggleExpire:'[data-name="toggle-expire"]',toggleToday:'[data-name="toggle-today"]'},regions:{planList:"div[data-name=plan-list]",expirePlanList:"div[data-name=expire-plan-list]",weekBox:"div[data-name=week-box]",createNewArea:"div[data-name=plan-cereate-form]",dataFilterArea:"div[data-name=plan-data-filter]",benchPlanArea:'div[data-name="bench-plan-area"]',benchExpirePlanArea:'div[data-name="bench-expire-plan-area"]'},modelEvents:{"change:date":"_changeDate","change:type":"_changeType"},events:function(){var a={};return a["click "+this.ui.toggleExpire]="_toggleExpire",a["click "+this.ui.toggleToday]="_toggleToday",a},templateHelpers:function(){return{i18n:this.i18n,today:this.today}},initialize:function(b){this.options=b,this.i18n=a.Context.getI18n(),this.userInfo=a.Context.getUserInfo(),this.today=c().format("YYYY/MM/DD"),this.model.get("date")||this.model.set("date",this.today),this.userId_collections={},this.userId_expire_collections={},this.filterOptions={},this.teamData=[]},onRender:function(){this.$("[original-title]").tipsy({gravity:"s"}),this.clickPlanCount=this.clickExpirePlanCount=0},onShow:function(){this._getDateData()},_toggleClass:function(a){var b=a.find(".icon"),c=b.hasClass("icon-w-arrow-up-double");b.removeClass("icon-w-arrow-up-double icon-w-arrow-down-double"),c?(b.addClass("icon-w-arrow-down-double"),a.attr("original-title","展开")):(b.addClass("icon-w-arrow-up-double"),a.attr("original-title","收起"))},_toggleExpire:function(a){var b=this.$(a.currentTarget);this._toggleClass(b),this.expirePlanList.$el.toggle()},_toggleToday:function(a){var b=this.$(a.currentTarget);this._toggleClass(b),this.planList.$el.toggle()},_resetToggleBtn:function(){var a=this.ui.toggleExpire.attr("original-title","收起").find(".icon"),b=this.ui.toggleToday.attr("original-title","收起").find(".icon");a.add(b).remove("icon-w-arrow-up-double icon-w-arrow-down-double").addClass("icon-w-arrow-down-double"),this.expirePlanList.$el&&this.expirePlanList.$el.show(),this.planList.$el&&this.planList.$el.show()},_changeType:function(){this.filterOptions={}},_changeDate:function(){var b=this,d=this.model.get("date"),e=decodeURIComponent(location.hash),f=e.indexOf("date");e=e.indexOf("?")>0?f>0?e.replace(/date=[\d+\/]+/,"date="+d):e+"&date="+d:e+"?date="+d,e.indexOf("plan_item_id")>0&&(this.model.set("plan_item_id",""),e=e.replace(/&plan_item_id=[\d]+/,"")),a.app.execute("history:navigate",e,!1),this.filterOptions={},this.userId_expire_collections={},this.userId_collections={},this.clickPlanCount=this.clickExpirePlanCount=0,this.planDataFilterView&&this.planDataFilterView.close(),this._rendLoadView(),this._requestPlanData().done(function(a){b._formateReturnData(a,!1)}),b._resetToggleBtn(),d!=this.today&&d<this.today?(this.ui.expireTitleName.text(c(new Date(d)).format("MM月DD日")+"的过期计划"),this.ui.planTitleName.text(c(new Date(d)).format("MM月DD日")+"的计划")):(this.ui.expireTitleName.text("已过期"),this.ui.planTitleName.text("当前计划"));var g=this.model.get("type");"my"==g&&this._rendPlanCreateView()},_getDateData:function(){var a=this;this._renderWeekView();var b=this.model.get("type");"my"==b&&this._rendPlanCreateView(),this._requestPlanData().done(function(b){a._formateReturnData(b,!1)})},_formateReturnData:function(a,b){0==this.userId_collections.length&&0==this.userId_expire_collections.length&&(this._renderEmptyView(this.planList),this.$el.find(this.ui.benchExpirePlanArea).hide(),this.ui.benchPlanArea.show(),this.ui.planTitle.hide()),this.userId_collections.length&&0==this.userId_expire_collections.length&&(this._renderBenchPlanListView(),b||this._renderPlanDataFilter(),this.ui.benchExpirePlanArea.hide(),this.ui.benchPlanArea.show(),this.ui.planTitle.show()),this.userId_expire_collections.length&&0==this.userId_collections.length&&(this._renderBenchExpirePlanListView(),b||(this._renderPlanDataFilter(),this._renderEmptyView(this.planList),this.ui.planTitle.hide()),this.ui.benchPlanArea.hide(),this.ui.benchExpirePlanArea.show(),this.ui.planTitle.show()),this.userId_collections.length&&this.userId_expire_collections.length&&(b||this._renderPlanDataFilter(),this._renderBenchExpirePlanListView(),this._renderBenchPlanListView(),this.$el.find(this.ui.benchPlanArea).show(),this.$el.find(this.ui.planTitle).show())
},_renderWeekView:function(){var b=this._getCurrentWeekData();this.benchWeekCompositeView=new e({model:this.model,collection:new a.Collection(b)}),this.listenTo(this.benchWeekCompositeView,"changeDate",function(a){this.model.set("date",a)},this),this.weekBox.show(this.benchWeekCompositeView)},_getCurrentWeekData:function(){var a=[],b=c(),d=b.days(),e=["周一","周二","周三","周四","周五","周六","周日"],f="";0==d&&(d=7);for(var g=1;8>g;g++)f=e[g-1],b=c(),g==d&&(f="今天"),a.push({CName:f,Date:b.add(g-d,"days").format("YYYY/MM/DD")});return a},_rendPlanCreateView:function(){var b=this,d=c(new Date(this.model.get("date"))).format("YYYY/MM/DD"),e=a.Context.getGlobal("tenantBehavior").TaskPushlishPrivateType||1;this.taskCreateView=new k.TaskCreateView({id:"Becnh-Plan-"+this.model.get("WorkId"),shape:"line",privateRangeOptions:{privateValue:e},dataTimeRangeOptions:{rangepickerOptions:{startDate:d+" 08:00",endDate:d+" 18:00"}},requestSubmit:function(c){var d=new Talent.$.Deferred;return a.app.request("Task:createTask",c).done(function(a){b._addTaskItem(a),d.resolve(a)}).fail(function(a){d.reject(a)}),d}}),this.createNewArea.show(this.taskCreateView)},_addTaskItem:function(a){if(this.benchPlanListView){var b=this.benchPlanListView.collection.toJSON();a.detail_checked=this.benchPlanListView.model.get("detail_checked"),b.unshift(a),this.benchPlanListView.collection.reset(b),this._renderPlanDataFilter(),this.ui.planTitle.show()}else this.userId_collections.push(a),this._renderBenchPlanListView(),this._renderPlanDataFilter(),this.ui.planTitle.show()},_renderPlanDataFilter:function(){var b=this,c=this.model.get("type");"my"==c?this._renderPlanFilterActualy():a.app.request("Bench:getModuleData",{channel_type:2,view_name:"Team"}).done(function(a){b.teamData=a.members,b._renderPlanFilterActualy()})},_renderPlanFilterActualy:function(){var b=this,c=this.filterOptions.detail_checked?this.filterOptions.detail_checked:!1;this.model.set("detail_checked",c);var d=this.teamData;d&&d.length&&(d=a._.pluck(d,"user"),d=a._.filter(d,function(a){return a.userId!=b.userInfo.Id}));var e=this.filterOptions["class"]?this.filterOptions["class"]:[],f=this.model.get("type");this.planDataFilterView&&this.planDataFilterView.close(),this.planDataFilterView=new j({member:"group"==f?!0:!1,memberType:"group"==f?!1:!0,isShowStar:"group"==f?!1:!0,memberCollection:new a.Collection(d),ClassCollection:new a.Collection(e),model:new a.Model(this.model.toJSON())}),this.listenTo(this.planDataFilterView,"dataFilter",function(a){this.filterOptions=a,this._requestSearchData()},this),this.listenTo(this.planDataFilterView,"show_detail",function(a){this.filterOptions=a,this._showExpireAndCurPlanList(a.detail_checked)},this),this.dataFilterArea&&this.dataFilterArea.show(this.planDataFilterView)},_showExpireAndCurPlanList:function(b){var c=this;if(b){this.benchPlanListView&&this.benchPlanListView.model.set("detail_checked",b),this.benchExpirePlanListView&&this.benchExpirePlanListView.model.set("detail_checked",b);var d=this.benchPlanListView&&this.benchPlanListView.collection||new a.Collection,e=c._getIdsByTreeCollection(this.benchPlanListView&&this.benchPlanListView.childrenModel||{});d.length&&this.userId_collections.length&&e.length&&this._requestRemindData(e.toString()).done(function(a){c._setTimesByTreeCollectionIds(c.benchPlanListView.childrenModel,a)});var f=this.benchExpirePlanListView&&this.benchExpirePlanListView.collection||new a.Collection,e=c._getIdsByTreeCollection(this.benchExpirePlanListView&&this.benchExpirePlanListView.childrenModel||{});f.length&&this.userId_expire_collections.length&&e.length&&this._requestRemindData(e.toString()).done(function(a){c._setTimesByTreeCollectionIds(c.benchExpirePlanListView.childrenModel,a)})}else this.benchPlanListView&&this.benchPlanListView.model.set("detail_checked",b),this.benchExpirePlanListView&&this.benchExpirePlanListView.model.set("detail_checked",b)},_getIdsByTreeCollection:function(b){var c=[];return a._.each(b,function(a){a.get("isRemind")&&c.push(a.id)}),c},_setTimesByTreeCollectionIds:function(b,d){for(var e=null,f=null,g=0,h=d.length;h>g;g++)e=d[g].ObjId,f=d[g].Time,f&&(f=c(new Date(f)).format("MM/DD HH:mm")),a._.each(b,function(a){a.id==e&&a.set({time:f})})},_requestRemindData:function(b){if(b){var c=new a.$.Deferred;return a.app.request("Plan:getNoticeTime",{obj_ids:b,obj_type:7}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c}},_requestSearchData:function(){var b=this,c=this.model.get("type"),d=this.filterOptions.member||[],e=this.filterOptions.status||[],f=this.filterOptions["class"]||[],g=[],h=this.filterOptions.SortType,i=this.filterOptions.RelationType;_.each(f,function(a){1==a.type?g.push({LableType:17,LableId:a.id}):2==a.type&&g.push({LableType:4,LableId:a.id})}),a.app.request("Bench:getBenchItemModuleData",{type:c,userIds:d.join(","),status:e.join(","),StartDate:this.model.get("date"),EndDate:this.model.get("date"),LableModels:g,SortType:h,RelationType:i}).done(function(a){b.userId_collections=a.todayPlan.tasks||[],b.userId_expire_collections=a.expirePlan.tasks||[],b.todayTaskNum=a.todayPlan.nextNum,b.expireTasknum=a.expirePlan.nextNum,b._formateReturnData(a,!0);var c=b.filterOptions.detail_checked;c&&b._showExpireAndCurPlanList(c)})},_requestPlanData:function(b){var c=this,d=this.model.get("type"),e=new a.$.Deferred;return a.app.request("Bench:getBenchItemModuleData",{type:d,startNum:b?b.startNum:1,StartDate:this.model.get("date"),EndDate:this.model.get("date"),WorkTableType:b&&b.WorkTableType?b.WorkTableType:0}).done(function(a){c.model.get("type");c.userId_collections=a.todayPlan.tasks||[],c.userId_expire_collections=a.expirePlan.tasks||[],c.todayTaskNum=a.todayPlan.nextNum||!1,c.expireTasknum=a.expirePlan.nextNum||!1,e.resolve(a)}).fail(function(a){e.reject(a)}),e},_renderBenchPlanListView:function(){var a=this,b=this.userId_collections||[],c=this.filterOptions&&this.filterOptions.detail_checked?this.filterOptions.detail_checked:!1;this.model.set("detail_checked",c),this.benchPlanListView=new k.TaskListView({data:b,model:this.model,isShowStar:"group"==this.model.get("type")?!1:!0,isShowMoreBtn:this.todayTaskNum?!0:!1,isShowOwnerTag:!0,isShowToggle:!0,hasDetailodel:!0}),this.listenTo(this.benchPlanListView,"showMore",function(b,c,d){this._requestPlanData({startNum:this.todayTaskNum,WorkTableType:2}).done(function(b){var c=a.benchPlanListView,e=d(b.todayPlan.tasks||[]);c.collection.add(e),a.todayTaskNum||c.hideMoreBtn(),c.loadingCompelte()})},this),this.listenTo(this.benchPlanListView,"openSub",function(a,b){this._getSubPlans(b,1)},this),this.listenTo(this.benchPlanListView.collection,"remove",function(){0==this.benchPlanListView.collection.length&&this.ui.planTitle.hide()},this),this.planList&&this.planList.show(this.benchPlanListView),this.$el.find(this.ui.benchPlanArea).show()},_getSubPlans:function(b,c){var d=this.model.get("type"),e=this.filterOptions.member||[],f=this.filterOptions.status||[],g=this.filterOptions["class"]||[],h=[],i=this.filterOptions.SortType,j=this.filterOptions.RelationType;_.each(g,function(a){1==a.type?h.push({LableType:17,LableId:a.id}):2==a.type&&h.push({LableType:4,LableId:a.id})});var k=b.get("level");a.app.request("Plan:GetSubPlans",{type:1==c?2:3,to_user_id:this.userInfo.Id,userIds:e.join(","),status:f.join(","),LableModels:h,SortType:i,RelationType:j,parentTaskId:b.id,StartDate:this.model.get("date"),EndDate:this.model.get("date"),fromLevel:k,toLevel:k+1,IsTeam:"my"==d?!1:!0}).done(function(a){b.set({tasks:a,currentDeploy:!0})})},_renderBenchExpirePlanListView:function(){var a=this;this.$el.find(this.ui.benchExpirePlanArea).show();var b=this.userId_expire_collections||[],c=this.filterOptions&&this.filterOptions.detail_checked?this.filterOptions.detail_checked:!1;this.model.set("detail_checked",c),this.benchExpirePlanListView&&this.benchExpirePlanListView.close(),this.benchExpirePlanListView=new k.TaskListView({data:b,model:this.model,isShowStar:"group"==this.model.get("type")?!1:!0,isShowMoreBtn:this.expireTasknum?!0:!1,isShowOwnerTag:!0,isShowToggle:!0,hasDetailodel:!0}),this.listenTo(this.benchExpirePlanListView,"openSub",function(a,b){this._getSubPlans(b,2)}),this.listenTo(this.benchExpirePlanListView,"showMore",function(a,b,c){var d=this;this._requestPlanData({startNum:this.expireTasknum,WorkTableType:1}).done(function(a){var b=d.benchExpirePlanListView,e=a.expirePlan.tasks;e=c(e),b.collection.add(e),d.expireTasknum||b.hideMoreBtn(),b.loadingCompelte()})}),this.listenTo(this.benchExpirePlanListView.collection,"remove",function(){0==this.benchExpirePlanListView.collection.length&&this.ui.expireTitle.hide()}),this.expirePlanList&&this.expirePlanList.show(a.benchExpirePlanListView)},_tipDialog:function(a,b,c){this.tipDialog=new Tdialog({type:"tipsy",sure:!1,cancel:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(a,b,{pos:"topCenter",className:c||"warn",arrow:!1,autoHide:!0})},_renderEmptyView:function(b,c){var d=this.model.get("type"),e=this.filterOptions,g=a.Context.getGlobal("tenant_function"),h=this.i18n.plan_1,i="这里能看到自己每天的"+h+"安排和执行情况，您可以：<br/>1.在本页填写今日"+h+'<br/>2.在 <a href="#plan">'+h+"表</a> 下发布"+h+"，然后设置起止时间";"group"==d&&(i="您可以在这里看到所有下属的"+h+"安排和执行情况，<br/>",i+=g.IsUseSetOrg?'现在就去设置<a href="#set?page_id=plan">我的团队成员</a>':"您还没有设置团队成员，请联系超管设置"),c&&(i=c),a._.isEmpty(e)||(i='<div class="bench_search_empty">暂无数据</div>');var j=new f({emptyContext:i});b&&b.show(j)},_rendLoadView:function(){this.loadingView=new g,this.planList.show(this.loadingView)},onClose:function(){a.$(".tipsy").remove()}})}),define("views/bench/bench-unaccept-task-view",["talent","templates/bench","$.tipsy","tdialog"],function(a,b){var c=a.ItemView.extend({template:b["bench/bench-unaccept-task-item"],tagName:"li",ui:{icon_cycle:".icon-task-cycle"},events:{'mouseenter [data-handler="ShowTitle"]':"_showTitle"},onRender:function(){var a=this.ui.icon_cycle,b=this;this.hasRequested=!1,a.on("mouseenter",function(){b._showTitle()})},initialize:function(){},templateHelpers:function(){return this.options},_showTitle:function(){var b=this;b.hasRequested||(b.hasRequested=!0,a.app.request("Task:getCycleTask",{cycle_id:this.model.get("CycleId")}).done(function(a){var c=a.CycType,d=a.CycStartDate,e=a.CycEndDate,f={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七"},g={1:"每天",2:"每个工作日",3:"每周"+(d==e?f[d]:f[d]+"-"+f[e]),4:"每月"+(d==e?d:d+"-"+e)};b.ui.icon_cycle.attr({"original-title":g[c]}),b.ui.icon_cycle.tipsy({gravity:"s"}),b.ui.icon_cycle.trigger("mouseenter")}).fail(function(a){b._tipMessage(b.ui.icon_cycle,a)}))},_tipMessage:function(a,b,c){this.failDialog||(this.failDialog=new Tdialog({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"bottomCenter",arrow:!1,autoHide:!0,className:c||"warn"})},onClose:function(){this.failDialog&&this.failDialog.close()}});return a.CompositeView.extend({template:b["bench/bench-unaccept-task"],defaults:{showAllBtn:!1,showAllUrl:"",title:"我待接受的任务",showPrincipal:!1,isQqUse:!1},itemView:c,itemViewContainer:".list_stat",tagName:"ul",ui:{prev:"span[data-name=prev]",next:"span[data-name=next]",taskName:'[data-name="push"]'},events:function(){var a={};return a["click "+this.ui.prev]="_prevHandler",a["click "+this.ui.next]="_nextHandler",a["click "+this.ui.taskName]="_onClickName",a},initialize:function(b){this.pageIndex=1,this.pageSize=5,this.options=b,this.options.emptyView&&(this.emptyView=this.options.emptyView),this.settings=a._.extend({},this.defaults,this.options)},templateHelpers:function(){return this.settings},onRender:function(){var b=this;this.total=this.model.get("Total")||1,this.pageNum=Math.ceil(this.total/this.pageSize);a.app.request("history:getQueryObject").done(function(a){b.routerData=a;b.collection.get(a.plan_item_id);a.plan_item_id})},_onClickName:function(a){a.stopPropagation();var b=this,c=b.$(a.currentTarget),d=c.attr("id");Talent.app.vent.trigger("global-pull-screen",d,"task")},itemViewOptions:function(){return delete this.settings.model,delete this.settings.collection,this.settings},_prevHandler:function(b){var c=a.$(b.currentTarget);this.pageIndex-=1,this.ui.next.removeClass("icon-arrow-right-disabled"),c.hasClass("icon-arrow-left-disabled")||(1==this.pageIndex&&(this.pageIndex=1,c.addClass("icon-arrow-left-disabled")),this.trigger("click:prev",this.pageIndex))},_nextHandler:function(b){var c=a.$(b.currentTarget);this.pageIndex+=1,this.ui.prev.removeClass("icon-arrow-left-disabled"),c.hasClass("icon-arrow-right-disabled")||(this.pageIndex==this.pageNum&&(this.pageIndex=this.pageNum,c.addClass("icon-arrow-right-disabled")),this.trigger("click:next",this.pageIndex))},onClose:function(){}})}),define("views/bench/bench-week-plan-implementation-view",["talent","templates/bench","views/bench/bench-drop-down-view"],function(a,b,c){return a.ItemView.extend({defaults:{from:"tita"},template:b["bench/bench-week-plan-implementation"],emptyTemplate:b["bench/bench-week-plan-implementation-empty"],ui:{content:"div[data-name=week-plan-status]",dropDown:".myWeekPlanList",dropDownBtn:"span[data-name=drop-down]",dropDownBox:"ul[data-name=drop-down-box]",title:"span[data-name=title]",empty:"div[data-name=week-plan-empty]"},events:function(){var a={};return a["click "+this.ui.dropDown]="_showDropDownHandler",a["mouseover "+this.ui.dropDown]="_planColorBlue",a["mouseout "+this.ui.dropDown]="_planColorGray",a},templateHelpers:function(){return{i18n:this.i18n,from:this.settings.from}},modelEvents:{"change:data":"changeData"},initialize:function(){var b=this;this.i18n=a.Context.getI18n(),this.userInfo=a.Context.getUserInfo(),this.settings=a._.extend({},b.defaults,b.options),this.dropDownIsOpen=!1,this.routerModel=this.options.routerModel},changeData:function(){var a=this;require(["highCharts"],function(){a._showChat()})},onShow:function(){var b=this.routerModel.get("type");"group"==b&&this.ui.title.html("团队本周"+this.i18n.plan_1+"执行情况"),require(["highCharts"],function(){c._showChat()});var c=this;a.$("body").off("click.tdialogWeekPlan"),a.$("body").on("click.tdialogWeekPlan",function(){c.benchDropDownView&&c.benchDropDownView.hide()})},_planColorBlue:function(a){$(a.currentTarget).find(".icon-arrow-down").addClass("icon-arrow-down-blue")},_planColorGray:function(a){$(a.currentTarget).find(".icon-arrow-down").removeClass("icon-arrow-down-blue")},_showDropDownHandler:function(b){b.stopPropagation();var d=a.$(b.currentTarget),e=d.find("span[data-name=title]"),f=e.attr("data-type"),g=this.i18n.plan_1;if(!this.benchDropDownView){var h=this.routerModel.get("type"),i=[{name:"我本周"+g+"执行情况",type:"4",href:"javascript:void(0)",css:""},{name:"我本月"+g+"执行情况",type:"3",href:"javascript:void(0)",css:""}];if("group"==h)var i=[{name:"团队本周"+g+"执行情况",type:"4",href:"javascript:void(0)",css:""},{name:"团队本月"+g+"执行情况",type:"3",href:"javascript:void(0)",css:""}];this.benchDropDownView=new c({collection:new a.Collection(i)}),this.listenTo(this.benchDropDownView,"selected",function(a){this.ui.title.html(a.name).attr("data-type",a.type),this.trigger("switch",a)},this),a.$("body").append(this.benchDropDownView.render().$el)}this.benchDropDownView.show(d,f)},_showChat:function(){var a=this.model.get("data"),b=0,c=0;if(!a||!a.length)return void this._emptyFun();for(var d={"已完成":"#1bd0dc","进行中":"#009944","已延期":"#f9b700","已取消":"#eb6877","未开始":"#eb6100","暂停中":"#8c92cb"},e=0,f=0,g=0;g<a.length;g++)c+=a[g].y,e+=a[g].y,"已完成"==a[g].name&&(f=g),a[g].color=d[a[g].name]||"#0f0";if(a[f].sliced=!0,a[f].selected=!0,b=Math.ceil(a[f].y/e*100),0==c)return void this._emptyFun();this.ui.empty.hide(),this.ui.content.show(),this.ui.content.highcharts({chart:{type:"pie",width:190,height:190},credits:{enabled:!1},title:{text:b+"%",align:"center",style:{fontSize:"26px",fontFamily:"Arial",fontWeight:"bold",color:"#1bd0dc"},y:65,x:-35},tooltip:{enabled:!0,pointFormat:"{series.color}",valueSuffix:"%"},plotOptions:{pie:{allowPointSelect:!0,allowPointSelect:!0,cursor:"pointer",showInLegend:!0,innerSize:"85%",center:[30,20],point:{events:{legendItemClick:function(){return!1}}},events:{click:function(a){var b=Math.ceil(a.point.percentage);h.setTitle({text:b+"%",align:"center",y:55,x:-35,style:{fontSize:"26px",fontFamily:"Arial",color:a.point.color}})}}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",itemMarginBottom:5,y:-10,x:10,itemStyle:{color:"#8a8a8a"}},xAxis:{categories:["进行中","已完成","已延期","已取消","未开始","暂停中"]},series:[{type:"pie",name:"",data:a}]}).show();var h=this.ui.content.highcharts()},_emptyFun:function(){var b=this.routerModel.get("type"),c={i18n:this.i18n,imgUrl:a.Context.getStaticUrl("images/bench/chart_3.jpg"),planUrl:"widget"==this.settings.from?"/u/"+this.userInfo.Id+"Home#plan":"#plan",showBottom:"my"==b?!0:!1},d=this.emptyTemplate(c);this.ui.empty.html(d).show(),this.ui.content.hide()}})}),define("views/common/my-team-view",["talent","templates/common","$.tipsy"],function(a,b){var c=a.ItemView.extend({template:b["common/my-team"],onRender:function(){this.$el.find("[original-title]").tipsy({gravity:"s"})}});return a.View.extend({className:"membertree",initialize:function(){this.model=this.options.model||new a.Model},render:function(){var b=this;return a.app.request("history:getQueryObject").done(function(a){b.routerData=a,b.routerData.appid=b.routerData.appid||1,b.routerData.apptype=b.routerData.apptype||1;var c=b.model.get("data");return c?void b._renderTeamView():void 0}),this.$el},_isChinese:function(a){var b=/[u00-uFF]/;return!b.test(a)},_dealData:function(b){var c=this,d={},e=a._.pluck(b,"user");e=a._.compact(e);var f=a._.pluck(b,"parentUser");f=a._.compact(f);var g="#italent/home?appid="+this.routerData.appid+"&apptype="+this.routerData.apptype+"&name=TalentProfile-record&to_user_id=",h=a.Context.getUserInfo().Id,i=a._.where(e,{userId:h})[0];a._.each(e,function(a){a.isChinese=c._isChinese(a.name)===!1?!1:!0}),a._.each(f,function(a){a.isChinese=c._isChinese(a.name)===!1?!1:!0}),a._.isEmpty(i)||(i.LinkUrl=g+h),d.lv_2=i||"";var j=a._.map(b,function(a){return a.user&&a.user.userId==h?(a.LinkUrl=g+h,a.parentUser):void 0});d.lv_1=j[0]||"";var k=[];return a._.each(e,function(a){a.userId!=h&&(a.LinkUrl=g+a.userId,k.push(a))}),d.lv_3=k,d},_renderTeamView:function(){var b=this.model.get("data"),d=this._dealData(b),e=new c({model:new a.Model(d)});this.$el.append(e.render().$el)}})}),define("views/bench/bench-my-group-view",["talent","templates/bench","views/common/my-team-view","views/bench/bench-drop-down-view"],function(a,b,c,d){return a.ItemView.extend({template:b["bench/bench-my-group"],regions:{contentBox:"div[data-name=content]"},ui:{dropDown:"span[data-name=drop-down]",contentBox:"div[data-name=content]"},events:function(){var a={};return a["click "+this.ui.dropDown]="_showDropDownHandler",a},initialize:function(){this.i18n=a.Context.getI18n(),this.helpHost=a.Context.getGlobal("helpHost")},onRender:function(){this.$el.find("[original-title]").tipsy({gravity:"s"})},onShow:function(){this.myTeamView||(this.myTeamView=new c({model:this.model}),this.ui.contentBox.append(this.myTeamView.render()))},onClose:function(){a.$(".tipsy").remove()},_showDropDownHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),e=a.Context.getGlobal("tenant_function");if(!this.benchDropDownView){var f=[];e.IsUseSetOrg&&f.push({name:"设置团队成员",url:"#set?page_id=plan",css:""}),e.IsUsePlanDaily&&f.push({name:"查看团队日报",url:"#daily?type=group",css:""}),f.push({name:"查看团队"+this.i18n.plan_1+"操作历史",url:"#plan/histroy",css:""},{name:'<span class="icon-light"></span>团队入门',css:"tt-guide last_bdd",type:"guide"}),this.benchDropDownView=new d({collection:new a.Collection(f)}),this.listenTo(this.benchDropDownView,"selected",function(b){"guide"==b.type&&a.app.vent.trigger("Guide:Guide-View:click","group")}),a.$("body").append(this.benchDropDownView.render().$el)}this.benchDropDownView.show(c)}})}),define("views/common/enter-admin-center-view",["talent","templates/common","$.tipsy"],function(a,b){return a.ItemView.extend({template:b["common/enter-admin-center"],className:"tt_entertms",templateHelpers:function(){var b=a.Context.getUserInfo(),c="bench",d=a.Context.getGlobal("WebHead"),e=a.Context.getGlobal("IsUseTitaManage")||!1,f=a._.extend({},a.Context.getGlobal("tenantAuthentication")),g=f.DeadLine;if(g){var h=g.split("-");f.DeadLine=h[0]+"年"+h[1]+"月"+h[2]+"日"}var i=Talent.Context.getGlobal("titaHost"),j=Talent.Context.getGlobal("loginUserInfo").Id,k=i+"/u/"+j+"/Invite/InviteMoreIndex",l="#widget/italent?iTalentFrameType=iframe&iTalentFrame="+encodeURIComponent(k),m={TmUrl:a.Context.getGlobal("tmNewHost"),ReportUrl:"#more/iframe?url="+a.Context.getGlobal("reporthost"),IsManager:2==b.Role||1==b.Role||4==b.Role?!0:!1,IsShow:this.curPageId==c?!0:!1,IsUseTitaManage:e,IsShowDueRemind:0!=f.TenantId&&1==f.Version&&1==f.ExpireType&&2==b.Role?!0:!1,tenantAuthentication:f,Role:b.Role,IsBose:b.IsBoss,url:l};m.ReportRole=!1;for(var n=0;n<d.AppHead.length;n++)910==d.AppHead[n].AppId&&(m.ReportRole=!0);return m},ui:{guide:"a[data-name=guide]"},initialize:function(){this._routerData()},onRender:function(){this.ui.guide.tipsy({gravity:"s"})},onClose:function(){a.$(".tipsy").remove()},_routerData:function(){var b=this,c=a.app.request("history:getFragments");c.done(function(a){b.curPageId=a})}})}),define("views/common/send-notice/send-notice-user-list-view",["talent","templates/common","$.tipsy","tdialog"],function(a,b,c,d){var e=a.ItemView.extend({tagName:"li",template:b["common/send-notice/send-notice-user-list-item"],initialize:function(){this.isDisableSelect=this.options.isDisableSelect||!1},onRender:function(){var b=this;a.$(this.el).addClass("active"),this.model.set("isActive",!0),a.$(this.el).attr("Id",this.model.get("userId")),$(".tipsy").hide(),this.$el.tipsy({gravity:"s",title:function(){return b.model.get("name")}})},onClose:function(){$(".tipsy").hide()},modelEvents:{"change:isActive":"_toggleStatus"},_toggleStatus:function(){var b=this.model.get("isActive");b?a.$(this.el).addClass("active"):a.$(this.el).removeClass("active")}});return a.CompositeView.extend({template:a._.template("<ul/>"),itemViewContainer:"ul",itemView:e,events:function(){var a={};return a["click li"]="_selectUser",a},onRender:function(){this.selectUsers=this.collection.toJSON(),this.model.set("selectUsers",a._.pluck(this.selectUsers,"userId")),1==this.collection.length&&this.$el.find("li:first").addClass("disable")},_selectUser:function(b){if(1!=this.collection.length){var c=a.$(b.currentTarget),e=c.index(),f=this.collection.at(e);this.selectUserTipView&&this.selectUserTipView.$el.remove(),f.get("isActive")?f.set("isActive",!1):f.set("isActive",!0);var g=a._.filter(this.collection.toJSON(),function(a){return a.isActive?a.isActive:void 0});return 0==g.length?(f.set("isActive",!0),this.selectUserTipView=new d({fixed:!1,type:"modal",cancel:!1,sure:!1}),this.selectUserTipView.render().$el.appendTo("body"),void this.selectUserTipView.show(c,'<div class="innerhtml_dialog">请至少选择一个通知对象</div>',{arrow:!1,autoHide:!0,pos:"bottomCenter"})):void this.model.set("selectUsers",a._.pluck(g,"userId"))}},addAttr:function(a){for(var b=0;b<a.length;b++)a[b].isActive=!0;return a},reset:function(){this.collection.reset(this.addAttr(this.userListData))}})}),define("views/common/send-notice/send-notice-auto-user-list-view",["talent","templates/common","UserSelector","collections/smember-group-collection","$.tipsy","tdialog"],function(a,b,c,d,e,f){var g=a.ItemView.extend({template:b["common/send-notice/add-user"],tagName:"li",ui:{uxUserArea:".ux_user_area"},initialize:function(){},onRender:function(){this.model.has("UserAvatar")?(this.userAvatar=this.model.get("UserAvatar"),this.userAvatar.HasAvatar&&this.$el.find("img").addClass("radius_img30")):this.userAvatar="",this.$el.find("a").tipsy({gravity:"s"})},events:function(){var a={};return a["mouseover "+this.ui.uxUserArea]="changeHideNode",a["mouseout "+this.ui.uxUserArea]="changeShowNode",a["click "+this.ui.uxUserArea]="deleteUser",a},deleteUser:function(){this.trigger("deleteUser",this.model)},changeHideNode:function(b){var c=a.$(b.currentTarget);this.userAvatar.HasAvatar?c.find("img").hide():c.find("span").hide()},changeShowNode:function(b){var c=a.$(b.currentTarget);this.userAvatar.HasAvatar?c.find("img").show():c.find("span").show()}}),h=a.CompositeView.extend({itemView:g,itemViewContainer:"ul",template:b["common/send-notice/add-user-list"],className:"add_user_list",ui:{addUserBtn:".ux_add_btn"},initialize:function(){},modelEvents:{change:"render"},onRender:function(){var a=this;this.on("itemview:deleteUser",function(b){a.collection.remove(b.model),$("body .tipsy").remove()}),this.userSelectorView=new c({collection:new d}),this.userSelectorView.addNode(this.$el.find(".ux_add_btn"),this.addUserSelectonOptions),this.$el.find(".ux_add_btn").on("submit",function(b,c){b.stopPropagation(),a.smemberSelect(c)})},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render(),this.$el.find(this.itemViewContainer).find("li:first-child").length?this.$el.find(this.itemViewContainer).find("li:first-child").before(e.el):this.$el.find(this.itemViewContainer).append(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)},smemberSelect:function(a){var a=a||{},b=this.collection.where({Id:a.Id});b.length>0?this.showDialogArrow(this.ui.addUserBtn,"该联系人已存在","warn"):this.collection.add(a)},showDialogArrow:function(b,c,d){var e=this;e.tDialogViewError||(e.tDialogViewError=new f({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),e.tDialogViewError.render().$el.appendTo("body")),e.tDialogViewError.show(a.$(b),c,{arrow:1,pos:"bottomCenter",height:300,topBias:8,leftBias:0,arrowBias:10,className:d,autoHide:!0})}});return h}),define("views/common/send-notice/send-notice-component",["talent","templates/common","views/common/send-notice/send-notice-user-list-view","views/common/send-notice/send-notice-auto-user-list-view","moment","momentZH","tdialog"],function(a,b,c,d,e,f,g){return a.Layout.extend({defaults:{title:"提醒大家写日报",isMailEdit:"true",mailContent:"",checkedSendMail:!0,isEditCopySelf:!0,checkedCopySelf:!0,isShowWithStatistics:!1,checkedWidthStatistics:!0,isShowSystemNotice:!0,isShowFormalNotice:!1,autoSubShow:!1,editFormalNotice:!1},className:"noticemessage",template:b["common/send-notice/send-notice-component"],regions:{userList:"div[data-name=user-list]"},ui:{item:"li",title:"div[data-name=title]",inputWrap:"div[data-name=mail-cont]",input:"div[data-name=mail-cont] textarea",copyMy:"a[data-name=copy-my]",withStatistics:"a[data-name=with-statistics]"},events:function(){var a={};return a["click "+this.ui.item]="_selectUser",a["keyup "+this.ui.input]="_keyupInputHandler",a["click "+this.ui.copyMy]="_clickCopyMyHandler",a["click "+this.ui.withStatistics]="_clickWidthStatistics",a},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),this.model.set(this.settings),this.loginUser=a.Context.getUserInfo(),this.model.set("user",this.loginUser);var d=e().format("YYYY年M月D日");this.model.set("SendTime",d),this.settings.autoSubShow||(this.collection.each(function(a){a.set("Id",a.get("userId"))}),this.sendNoticeUserListView=new c({collection:this.collection})),a.$(document).off("click.Send-Notice-Componet-View"),a.$(document).on("click.Send-Notice-Componet-View",function(){b.hideDialog()})},templateHelpers:function(){return{isShowFormalNotice:this.settings.isShowFormalNotice,isShowSystemNotice:this.settings.isShowSystemNotice}},onRender:function(){var a=this;this.ui.input.val(this.model.get("mailContent")),this.settings.autoSubShow?(_.map(this.collection.models,function(b){var c=a._returnImgTemplate(b.toJSON());b.set("imgTemplate",c)}),this.collection.each(function(a){a.set("Id",a.get("userId"))}),this.sendNoticeAutoUserListView=new d({collection:this.collection}),this.userList.show(this.sendNoticeAutoUserListView)):this.userList.show(this.sendNoticeUserListView)},_returnImgTemplate:function(a){var b="";if(a.avatar.HasAvatar)var b='<img class="radius_img30" width="30" height="30" src="'+a.avatar.Small+'" />';else var b='<span class="radius_img30" style="background-color:'+a.avatar.Color+'">'+_.substring(a.name,2,!1)+"</span>";return b},onClose:function(){a.$(document).off("click.Send-Notice-Componet-View")},showDialog:function(b,c,d){var e=this;this.dialogView=new g({type:"defaults",sure:function(){var a=e.model.get("checkedCopySelf");if(e.settings.autoSubShow)var b=_.map(e.sendNoticeAutoUserListView.collection.models,function(a){return a.get("Id")});else var b=e.sendNoticeUserListView.model.get("selectUsers");if(a)if(b)b.push(e.loginUser.Id);else{var b=[];b.push(e.loginUser.Id)}var c=e.model.toJSON();c.selectUsers=b,e.dialogView.hide(),e.trigger("submit",c)},cancel:function(){e.hideDialog()}});var f="";f=d?d:$("body"),this.dialogView.render().$el.appendTo(f);var h=this.render().el,i={pos:"bottom",x:0,y:0,title:"提醒大家写日报"};c.title&&this.ui.title.html(c.title),this.dialogView.show(b,h,a._.extend({arrow:!1,autoHide:!1,autoFrames:f,container:f},i,c))},hideDialog:function(){this.dialogView&&this.dialogView.close(),this.$el.remove()},_keyupInputHandler:function(b){var c=a.$(b.currentTarget),d=$.trim(c.val());this.model.set("mailContent",d)},_clickCopyMyHandler:function(b){if(this.model.get("checkedSendMail")){var c=a.$(b.currentTarget),d=this.model.get("checkedCopySelf");d?(this.model.set("checkedCopySelf",!1),c.removeClass("checkbox-checked")):(this.model.set("checkedCopySelf",!0),c.addClass("checkbox-checked"))}},_clickWidthStatistics:function(b){var c=a.$(b.currentTarget),d=this.model.get("checkedWidthStatistics");d?(this.model.set("checkedWidthStatistics",!1),c.removeClass("checkbox-checked")):(this.model.set("checkedWidthStatistics",!0),c.addClass("checkbox-checked"))}})}),define("views/common/plugins/pubdaily/pubdaily-view",["talent","templates/common","tdialog","views/common/send-notice/send-notice-component","TitaWidget"],function(a,b,c,d,e){return a.CompositeView.extend({defaults:{inputDefatutValue:"",shape:"defaults",dialogTilte:"工作日报",autoSubShow:!1,report_type:8,dailyType:1},template:b["common/pubdaily/pubdaily"],className:"tt_daily_pub_view",ui:{pubDailyArea:"div[data-name=pub-daily-form]",buttonGenerate:"button[data-name=generate]",buttonClosed:"span[data-name=closed]",buttonAutoSend:'button[data-name="auto-send"]'},templateHelpers:function(){return this.settings},modelEvents:{},events:function(){var a={};return a["click "+this.ui.buttonGenerate]="_clickButtonGenHandler",a["click "+this.ui.buttonClosed]="_closedHandler",a["click "+this.ui.buttonAutoSend]="_clickButtonAutoSend",a},initialize:function(b){var c=this;this.options=b||{},this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.i18n=a.Context.getI18n(),this.model.set("generateType",[1,2]),"dialog"==this.settings.shape&&(a.$(document).off("click.Pubdaily-View"),a.$(document).on("click.Pubdaily-View",function(){c.close()}),this.$el.on("click",function(a){a.stopPropagation()}))},onClose:function(){"dialog"==this.settings.shape&&a.$(document).off("click.Pubdaily-View")},onShow:function(){var b=(this._rendBlogView(),this);"dialog"==b.settings.shape?(a.$(b.ui.pubDailyArea).append(b.mBlogView.render().$el),b.$el.addClass("tt_dialog_daily_pub")):a.$(b.ui.pubDailyArea).append(b.mBlogView.render().$el)},_clickButtonAutoSend:function(b){{var c=this,c=this;new a.$.Deferred}a.app.request("UserSubordinate:getDirectSuperior").done(function(e){var f=a._.pluck(e,"parentUser");c.superiorUser=a._.filter(f,function(b){return b&&b.userId?b.userId!=a.Context.getUserInfo().Id:void 0});var g=a.$(b.currentTarget);c.sendNoticeComponent&&c.sendNoticeComponent.hideDialog();var h="发送邮件",i=c.model.get("date"),j=c.model.get("generateType");a.app.request("Daily:getAutoDaily",{types:j.join(","),date:i,report_type:c.settings.report_type,plan_table_id:c.model.get("plan_table_id")}).done(function(b){return b?(c.sendNoticeComponent&&c.sendNoticeComponent.close(),c.sendNoticeComponent=new d({collection:new a.Collection(c.superiorUser),mailContent:b,isShowWithStatistics:!1,title:h,isShowSystemNotice:!1,autoSubShow:c.settings.autoSubShow}),c.sendNoticeComponent.showDialog(g,{title:h}),void c.listenTo(c.sendNoticeComponent,"submit",function(b){var d=c.settings.dailyType;
return 1==b.selectUsers.length&&b.selectUsers[0]==c.userInfo.Id||0==b.selectUsers.length?void c._tipDialog(g,"通知对象不能为空"):void a.app.request("PlanCommmon:postSendNotice",{UserIds:b.selectUsers.join(","),EmailContent:1==b.checkedSendMail?b.mailContent:"",Date:c.model.get("date"),MessageContent:"",MessageType:1==d?15:18,PlanTableId:this.model.get("plan_table_id")}).done(function(){c._tipDialog(g,"发送邮件成功","success")}).fail(function(a){c._tipDialog(g,a)})})):void c._tipDialog(g,"您还没有工作汇总，工时汇总")})})},setPosition:function(a){var b=a.offset(),c=a.outerWidth(),d=(a.outerHeight(),this.$el.outerWidth());this.$el.css({position:"absolute",left:b.left-d+c,top:b.top})},_clickButtonGenHandler:function(b){var c=a.$(b.currentTarget),d=this.model.get("generateType");d.length&&this._requestAutoDialy(c)},_closedHandler:function(){this.close()},_rendBlogView:function(){var b={publicOptions:{name:"公开",des:"所有人可见"},privateOptions:{name:"私密",des:"仅我的上级可见"},departmentOptions:{name:"部门可见",des:"仅我的部门可见"}},c=this,d=a.Context.getGlobal("tenantBehavior").TaskPushlishPrivateType||3,f="";f=1==d?"公开":2==d?"私密":"部门可见";var g=this.settings.dailyType,h=this.model.get(1==g?"date":"plan_table_id");this.mBlogView=new e.PublistMblogView({id:"Daily"+h,type:"feed",maxlength:"4000",isLimit:!0,defaultValue:this.settings.inputDefatutValue,value:"",submitText:"发布",shape:"default",defaultHide:!1,inFocus:!0,isShowAtAll:!1,atAllText:"所有同事",atAllValue:"@[所有同事:all_members] ",atAllTipText:"所有同事将收到本条消息",privateDropDownOptions:b,isShowAt:!0,atText:"同事",atTipText:"想确保谁看到就@这个成员",isShowAttachment:!0,isShowEmotion:!1,isShowRange:!0,privateText:f,privateValue:d,isShowRangeDropDown:!0,isShowSendSms:!1,submitRequest:function(b,d){var e=new Talent.$.Deferred;return a.app.request("Daily:planDialyAdd",{content:d.context,visibility:d.visibility||1,fileUrls:d.files.join(","),objId:d.privateObjId,objType:d.privateObjType,dateTime:c.settings.model.get("date"),reportType:c.settings.report_type,planTableId:c.settings.model.get("plan_table_id"),otherDocuments:d.YFYDocuments}).done(function(a){c.trigger("submitSuccess",b,a),e.resolve(a)}).fail(function(a){e.reject(a)}),e}})},requestDailyData:function(b){var c=new a.$.Deferred;return a.app.request("Daily:postAddDailyData",{content:b.content,fileUrls:b.FileUrls,dateTime:self.routerData.date,visibility:b.visibility||1,objId:b.ObjId,objType:b.ObjType}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c},_requestAutoDialyContent:function(){},_requestAutoDialy:function(b){var c=this.model.get("date"),d=this,e=this.model.get("generateType");a.app.request("Daily:getAutoDaily",{types:e.join(","),date:c,report_type:d.settings.report_type,plan_table_id:d.model.get("plan_table_id")}).done(function(a){if(!a)return void d._tipDialog(b,"您还没有工作汇总，工时汇总");var c=d.mBlogView.ui.input;c.val(a).trigger("keyup").autosize(),d._cursorMoveEnd(c)})},_cursorMoveEnd:function(a){var b=$(a).val().length,c=$(a)[0];if($.browser.msie){var d=c.createTextRange();d.moveStart("character",b),d.collapse(!0),d.select()}else c.setSelectionRange(b,b),c.focus()},_tipDialog:function(a,b,d){this.tipDialog=new c({type:"tipsy",sure:!1,cancel:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(a,b,{pos:"topRight",className:d||"warn",arrow:!1,autoHide:!0})}})}),define("views/bench/bench-daily-view",["talent","templates/bench","views/common/send-notice/send-notice-component","views/common/plugins/pubdaily/pubdaily-view"],function(a,b,c,d){var e=a.ItemView.extend({template:b["bench/bench-daily-my"],className:"tt_bench_my_daily",ui:{buttonWriteButton:"button[data-name=write-daily]"},events:function(){var a={};return a["click "+this.ui.buttonWriteButton]="_writeDailyHandler",a},_writeDailyHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),e=this.model.get("dailyDate"),f=e.split("/");f=f[0]+"年"+f[1]+"月"+f[2]+"日";var g=this;this.pubDailyView&&this.pubDailyView.close(),this.pubDailyView=new d({shape:"dialog",dialogTilte:f+" 工作日报",model:new a.Model({date:e}),autoSubShow:!0}),this.$el.append(this.pubDailyView.render().el),this.pubDailyView.onShow(),a.Context.setPosition(c,this.pubDailyView.$el,{container:this.$el,pos:"bottomCenter",leftBias:0,topBias:50,autoFrames:this.$el}),this.listenTo(this.pubDailyView,"submitSuccess",function(b,c){var d=new a.$.Deferred;g.trigger("pubDailySuccess",c),d.resolve(c)})},onClose:function(){this.pubDailyView&&this.pubDailyView.close()}}),f=a.ItemView.extend({template:b["bench/bench-daily-group"],emptyTemplate:b["bench/bench-daily-group-empty"],className:"tt_bench_group_daily",ui:{chart:"div[data-name=bench-daily-chart]",container:"div[data-name=bench-daily-container]",btnSendNotice:"button[data-name=bench-daily-sendnotice]"},events:function(){var a={};return a["click "+this.ui.btnSendNotice]="_sendMsgHandler",a},templateHelpers:function(){var b=this.model.get("data"),c=b.DailyStatistic,d=a._.findWhere(c,{status:3}),e=0;return d&&(e=d.y),{unEvaluateTotal:b.UnEvaluateTotal,unSubmitTotal:e}},initialize:function(){this.i18n=a.Context.getI18n()},onShow:function(){var a=this;require(["highCharts"],function(){a._showChat()})},_sendMsgHandler:function(b){var c=a.$(b.currentTarget),d=this;a.app.request("Daily:getMySubmitDailySetting",{}).done(function(a){d._renderNotice(c,a)})},_getSubordinates:function(){var b=this.model.get("team"),c=a.Context.getUserInfo(),d=a._.pluck(b,"user");d=a._.compact(d);for(var e=[],f=0;f<d.length;f++)d[f].userId!=c.Id&&e.push(d[f]);return e},_renderNotice:function(b,d){var e=this._getSubordinates(),f=this.model.get("data"),g=f.GruopId,h=(f.PlanTableId,f.TagId),i=1==d.PeriodType?"今天":"明天",j="请在"+i+d.SetTime+"前及时交付今天的日报，内容包括：\n1.总结今天完成了哪些"+this.i18n.plan_1+"，还有哪些"+this.i18n.plan_1+"没有完成，原因是什么，预计什么时间能做完\n2.明天要完成哪些事情\n请同步更新"+this.i18n.plan_1+"表中的状态。超过"+d.SetTime+"未提交日报的，都算迟交。\n";if(!e)return void alert("获取不到下属信息");var k="提醒大家写日报";this.sendNoticeComponent=new c({collection:new a.Collection(e),mailContent:j,isShowWithStatistics:!0,title:k}),this.listenTo(this.sendNoticeComponent,"submit",function(b){a.app.request("PlanCommmon:postSendNotice",{UserIds:b.selectUsers.join(","),MessageContent:"",EmailContent:1==b.checkedSendMail?b.mailContent:"",GroupId:g,TagId:h,PlanTableId:"",MessageType:"13",Date:"",IsStatistics:1==b.checkedWidthStatistics?1:0})}),this.sendNoticeComponent.showDialog(b,{title:k},this.$el)},_showChat:function(){for(var b=this.model.get("data").dailyStatistic,c=0,d=0,e={"已提交":"#1bd0dc","未提交":"#eb6100"},f=0,g=0,h=0;h<b.length;h++)d+=b[h].y,f+=b[h].y,"已提交"==b[h].name&&(g=h),b[h].color=e[b[h].name]||"#0f0";if(b[g].sliced=!0,b[g].selected=!0,c=Math.ceil(b[g].y/f*100),0==d){var i={i18n:this.i18n,imgUrl:a.Context.getStaticUrl("images/bench/chart_1.jpg")},j=this.emptyTemplate(i);return void this.ui.container.html(j)}this.ui.chart.highcharts({chart:{type:"pie",width:190,height:190},credits:{enabled:!1},title:{text:c+"%",align:"center",style:{fontSize:"26px",fontFamily:"Arial",fontWeight:"bold",color:"#1bd0dc"},y:60,x:-35},tooltip:{enabled:!0,pointFormat:"{series.color}",valueSuffix:"%"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",showInLegend:!0,innerSize:"85%",center:[30,20],point:{events:{legendItemClick:function(){return!1}}},events:{click:function(a){var b=Math.ceil(a.point.percentage);k.setTitle({text:b+"%",align:"center",y:60,x:-35,style:{fontSize:"26px",fontFamily:"Arial",color:a.point.color}})}}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",itemMarginBottom:5,y:30,x:10,itemStyle:{color:"#8a8a8a"}},xAxis:{categories:["已提交","未提交"]},series:[{type:"pie",name:"",data:b}]}).show();var k=this.ui.chart.highcharts()}});return a.Layout.extend({template:b["bench/bench-daily"],regions:{container:"div[data-name=bench-daily-container]"},initialize:function(){this.routerModel=this.options.routerModel},templateHelpers:function(){var a=this.routerModel.get("type");return{type:a}},onRender:function(){var b=this.routerModel.get("type");if("my"==b){var c=new e({model:new a.Model(this.model.get("data"))});this.listenTo(c,"pubDailySuccess",function(a){this.trigger("pubDailySuccess",a)},this),this.container.show(c)}else{var d=new f({model:this.model});this.container.show(d)}}})}),define("$.daterangepicker",["talent","moment"],function(a,b){var c=function(a,b,c){this.parentEl="body",this.element=$(a),this.isShowing=!1;var d='<div class="daterangepicker dropdown-menu"><div class="calendar first left"></div><div class="calendar second right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input"><label for="daterangepicker_start"></label><input class="input-mini" type="text" name="daterangepicker_start" value="" disabled="disabled" /></div><div class="daterangepicker_end_input"><label for="daterangepicker_end"></label><input class="input-mini" type="text" name="daterangepicker_end" value="" disabled="disabled" /></div><button class="applyBtn" disabled="disabled" type="button"></button>&nbsp;<button class="cancelBtn" type="button"></button></div></div></div>';("object"!=typeof b||null===b)&&(b={}),this.parentEl=$("object"==typeof b&&b.parentEl&&$(b.parentEl).length?b.parentEl:this.parentEl),this.container=$(d).appendTo(this.parentEl),b=$.extend(this.element.data(),b),this.setOptions(b,c),this.container.find(".calendar").on("click.daterangepicker",".prev",$.proxy(this.clickPrev,this)).on("click.daterangepicker",".next",$.proxy(this.clickNext,this)).on("click.daterangepicker","td.available",$.proxy(this.clickDate,this)).on("mouseenter.daterangepicker","td.available",$.proxy(this.hoverDate,this)).on("mouseleave.daterangepicker","td.available",$.proxy(this.updateFormInputs,this)).on("change.daterangepicker","select.yearselect",$.proxy(this.updateMonthYear,this)).on("change.daterangepicker","select.monthselect",$.proxy(this.updateMonthYear,this)).on("change.daterangepicker","select.hourselect,select.minuteselect,select.secondselect,select.ampmselect",$.proxy(this.updateTime,this)),this.container.find(".ranges").on("click.daterangepicker","button.applyBtn",$.proxy(this.clickApply,this)).on("click.daterangepicker","button.cancelBtn",$.proxy(this.clickCancel,this)).on("click.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.showCalendars,this)).on("change.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.inputsChanged,this)).on("keydown.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.inputsKeydown,this)).on("click.daterangepicker","li",$.proxy(this.clickRange,this)).on("mouseenter.daterangepicker","li",$.proxy(this.enterRange,this)).on("mouseleave.daterangepicker","li",$.proxy(this.updateFormInputs,this)),this.element.is("input")?this.element.on({"click.daterangepicker":$.proxy(this.show,this),"focus.daterangepicker":$.proxy(this.show,this),"keyup.daterangepicker":$.proxy(this.updateFromControl,this),"keydown.daterangepicker":$.proxy(this.keydown,this)}):this.element.on("click.daterangepicker",$.proxy(this.toggle,this))};c.prototype={constructor:c,setOptions:function(a,c){if(this.startDate=b().startOf("day"),this.endDate=b().endOf("day"),this.timeZone=b().utcOffset(),this.minDate=!1,this.maxDate=!1,this.dateLimit=!1,this.showDropdowns=!1,this.showWeekNumbers=!1,this.timePicker=!1,this.timePickerSeconds=!1,this.timePickerIncrement=30,this.timePicker12Hour=!0,this.autoApply=!1,this.singleDatePicker=!1,this.ranges={},this.autoHide=!0,this.opens="right",this.element.hasClass("pull-right")&&(this.opens="left"),this.drops="down",this.element.hasClass("dropup")&&(this.drops="up"),this.buttonClasses=["btn","btn-small btn-sm"],this.applyClass="btn-success",this.cancelClass="btn-default",this.format="MM/DD/YYYY",this.separator=" - ",this.locale={applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:b.weekdaysMin(),monthNames:b.monthsShort(),firstDay:b.localeData()._week.dow},this.cb=function(){},"string"==typeof a.format&&(this.format=a.format),"string"==typeof a.separator&&(this.separator=a.separator),"string"==typeof a.startDate&&(this.startDate=b(a.startDate,this.format)),"string"==typeof a.endDate&&(this.endDate=b(a.endDate,this.format)),"string"==typeof a.minDate&&(this.minDate=b(a.minDate,this.format)),"string"==typeof a.maxDate&&(this.maxDate=b(a.maxDate,this.format)),"object"==typeof a.startDate&&(this.startDate=b(a.startDate)),"object"==typeof a.endDate&&(this.endDate=b(a.endDate)),"object"==typeof a.minDate&&(this.minDate=b(a.minDate)),"object"==typeof a.maxDate&&(this.maxDate=b(a.maxDate)),"string"==typeof a.applyClass&&(this.applyClass=a.applyClass),"string"==typeof a.cancelClass&&(this.cancelClass=a.cancelClass),"object"==typeof a.dateLimit&&(this.dateLimit=a.dateLimit),"object"==typeof a.locale&&("object"==typeof a.locale.daysOfWeek&&(this.locale.daysOfWeek=a.locale.daysOfWeek.slice()),"object"==typeof a.locale.monthNames&&(this.locale.monthNames=a.locale.monthNames.slice()),"number"==typeof a.locale.firstDay&&(this.locale.firstDay=a.locale.firstDay),"string"==typeof a.locale.applyLabel&&(this.locale.applyLabel=a.locale.applyLabel),"string"==typeof a.locale.cancelLabel&&(this.locale.cancelLabel=a.locale.cancelLabel),"string"==typeof a.locale.fromLabel&&(this.locale.fromLabel=a.locale.fromLabel),"string"==typeof a.locale.toLabel&&(this.locale.toLabel=a.locale.toLabel),"string"==typeof a.locale.weekLabel&&(this.locale.weekLabel=a.locale.weekLabel),"string"==typeof a.locale.customRangeLabel&&(this.locale.customRangeLabel=a.locale.customRangeLabel)),"string"==typeof a.opens&&(this.opens=a.opens),"string"==typeof a.drops&&(this.drops=a.drops),"boolean"==typeof a.showWeekNumbers&&(this.showWeekNumbers=a.showWeekNumbers),"string"==typeof a.buttonClasses&&(this.buttonClasses=[a.buttonClasses]),"object"==typeof a.buttonClasses&&(this.buttonClasses=a.buttonClasses),"boolean"==typeof a.showDropdowns&&(this.showDropdowns=a.showDropdowns),"boolean"==typeof a.singleDatePicker&&(this.singleDatePicker=a.singleDatePicker,this.singleDatePicker&&(this.endDate=this.startDate.clone())),"boolean"==typeof a.timePicker&&(this.timePicker=a.timePicker),"boolean"==typeof a.timePickerSeconds&&(this.timePickerSeconds=a.timePickerSeconds),"number"==typeof a.timePickerIncrement&&(this.timePickerIncrement=a.timePickerIncrement),"boolean"==typeof a.timePicker12Hour&&(this.timePicker12Hour=a.timePicker12Hour),"boolean"==typeof a.autoApply&&(this.autoApply=a.autoApply,this.autoApply&&this.container.find(".applyBtn, .cancelBtn").addClass("hide")),"boolean"==typeof a.autoHide&&(this.autoHide=a.autoHide),0!=this.locale.firstDay)for(var d=this.locale.firstDay;d>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),d--;var e,f,g;if("undefined"==typeof a.startDate&&"undefined"==typeof a.endDate&&$(this.element).is("input[type=text]")){var h=$(this.element).val(),i=h.split(this.separator);e=f=null,2==i.length?(e=b(i[0],this.format),f=b(i[1],this.format)):this.singleDatePicker&&""!==h&&(e=b(h,this.format),f=b(h,this.format)),null!==e&&null!==f&&(this.startDate=e,this.endDate=f)}if("string"==typeof a.timeZone||"number"==typeof a.timeZone?(this.timeZone="string"==typeof a.timeZone&&"undefined"!=typeof b.tz?-1*b.tz.zone(a.timeZone).parse(new Date):a.timeZone,this.startDate.utcOffset(this.timeZone),this.endDate.utcOffset(this.timeZone)):this.timeZone=b(this.startDate).utcOffset(),"object"==typeof a.ranges){for(g in a.ranges)e="string"==typeof a.ranges[g][0]?b(a.ranges[g][0],this.format):b(a.ranges[g][0]),f="string"==typeof a.ranges[g][1]?b(a.ranges[g][1],this.format):b(a.ranges[g][1]),this.minDate&&e.isBefore(this.minDate)&&(e=b(this.minDate)),this.maxDate&&f.isAfter(this.maxDate)&&(f=b(this.maxDate)),this.minDate&&f.isBefore(this.minDate)||this.maxDate&&e.isAfter(this.maxDate)||(this.ranges[g]=[e,f]);var j="<ul>";for(g in this.ranges)j+="<li>"+g+"</li>";j+="<li>"+this.locale.customRangeLabel+"</li>",j+="</ul>",this.container.find(".ranges ul").remove(),this.container.find(".ranges").prepend(j)}if("function"==typeof c&&(this.cb=c),this.timePicker||(this.startDate=this.startDate.startOf("day"),this.endDate=this.endDate.endOf("day")),this.singleDatePicker?(this.opens=this.opens||"right",this.container.addClass("single"),this.container.find(".calendar.right").show(),this.container.find(".calendar.left").hide(),this.timePicker?this.container.find(".ranges .daterangepicker_start_input, .ranges .daterangepicker_end_input").hide():this.container.find(".ranges").hide(),this.container.find(".calendar.right").hasClass("single")||this.container.find(".calendar.right").addClass("single")):(this.container.removeClass("single"),this.container.find(".calendar.right").removeClass("single"),this.container.find(".calendar.left").show(),this.container.find(".ranges").show()),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.oldChosenLabel=this.chosenLabel,this.leftCalendar={month:b([this.startDate.year(),this.startDate.month(),1,this.startDate.hour(),this.startDate.minute(),this.startDate.second()]),calendar:[]},this.rightCalendar={month:b([this.endDate.year(),this.endDate.month(),1,this.endDate.hour(),this.endDate.minute(),this.endDate.second()]),calendar:[]},"right"==this.opens||"center"==this.opens){var k=this.container.find(".calendar.first"),l=this.container.find(".calendar.second");l.hasClass("single")&&(l.removeClass("single"),k.addClass("single")),k.removeClass("left").addClass("right"),l.removeClass("right").addClass("left"),this.singleDatePicker&&(k.show(),l.hide())}"undefined"!=typeof a.ranges||this.singleDatePicker||this.container.addClass("show-calendar"),this.autoHide?this.container.removeClass("opensleft opensright").addClass("opens"+this.opens):this.container.removeClass("opensleft opensright openscenter").addClass("open"),this.updateView(),this.updateCalendars();var m=this.container;$.each(this.buttonClasses,function(a,b){m.find("button").addClass(b)}),this.container.find(".daterangepicker_start_input label").html(this.locale.fromLabel),this.container.find(".daterangepicker_end_input label").html(this.locale.toLabel),this.applyClass.length&&this.container.find(".applyBtn").addClass(this.applyClass),this.cancelClass.length&&this.container.find(".cancelBtn").addClass(this.cancelClass),this.container.find(".applyBtn").html(this.locale.applyLabel),this.container.find(".cancelBtn").html(this.locale.cancelLabel)},setStartDate:function(a){"string"==typeof a&&(this.startDate=b(a,this.format).utcOffset(this.timeZone)),"object"==typeof a&&(this.startDate=b(a)),this.timePicker||(this.startDate=this.startDate.startOf("day")),this.oldStartDate=this.startDate.clone(),this.updateView(),this.updateCalendars(),this.updateInputText()},setEndDate:function(a){"string"==typeof a&&(this.endDate=b(a,this.format).utcOffset(this.timeZone)),"object"==typeof a&&(this.endDate=b(a)),this.timePicker||(this.endDate=this.endDate.endOf("day")),this.oldEndDate=this.endDate.clone(),this.updateView(),this.updateCalendars(),this.updateInputText()},updateView:function(){this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute()),this.updateFormInputs()},updateFormInputs:function(){this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.format)),this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.format)),this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")&&this.element.val().length){var a=this.element.val().split(this.separator),c=null,d=null;2===a.length&&(c=b(a[0],this.format).utcOffset(this.timeZone),d=b(a[1],this.format).utcOffset(this.timeZone)),(this.singleDatePicker||null===c||null===d)&&(c=b(this.element.val(),this.format).utcOffset(this.timeZone),d=c),d.isBefore(c)||(this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.startDate=c,this.endDate=d,this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.updateCalendars())}},keydown:function(a){(9===a.keyCode||13===a.keyCode)&&this.hide()},notify:function(){this.updateView(),this.updateInputText(),this.cb(this.startDate,this.endDate,this.chosenLabel)},move:function(){var a,b={top:0,left:0},c=$(window).width();this.parentEl.is("body")||(b={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()},c=this.parentEl[0].clientWidth+this.parentEl.offset().left),a="up"==this.drops?this.element.offset().top-this.container.outerHeight()-b.top:this.element.offset().top+this.element.outerHeight()-b.top,this.container["up"==this.drops?"addClass":"removeClass"]("dropup"),"left"==this.opens?(this.container.css({top:a,right:c-this.element.offset().left-this.element.outerWidth(),left:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):"center"==this.opens?(this.container.css({top:a,left:this.element.offset().left-b.left+this.element.outerWidth()/2-this.container.outerWidth()/2,right:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):(this.container.css({top:a,left:this.element.offset().left-b.left,right:"auto"}),this.container.offset().left+this.container.outerWidth()>$(window).width()&&this.container.css({left:"auto",right:0}))},toggle:function(){this.autoHide&&(this.element.hasClass("active")?this.hide():this.show())},show:function(){this.isShowing||(this.element.addClass("active"),this.container.show(),this.move(),this._outsideClickProxy=$.proxy(function(a){this.outsideClick(a)},this),$(document).on("mousedown.daterangepicker",this._outsideClickProxy).on("touchend.daterangepicker",this._outsideClickProxy).on("click.daterangepicker","[data-toggle=dropdown]",this._outsideClickProxy).on("focusin.daterangepicker",this._outsideClickProxy),this.isShowing=!0,this.element.trigger("show.daterangepicker",this))},outsideClick:function(a){var b=$(a.target);this.autoHide||"focusin"==a.type||b.closest(this.element).length||b.closest(this.container).length||b.closest(".calendar-date").length||this.hide()},hide:function(){this.isShowing&&($(document).off(".daterangepicker"),this.element.removeClass("active"),this.container.hide(),this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.isShowing=!1,this.element.trigger("hide.daterangepicker",this))},enterRange:function(a){var b=a.target.innerHTML;if(b==this.locale.customRangeLabel)this.updateView();else{var c=this.ranges[b];this.container.find("input[name=daterangepicker_start]").val(c[0].format(this.format)),this.container.find("input[name=daterangepicker_end]").val(c[1].format(this.format))}},showCalendars:function(){this.container.addClass("show-calendar"),this.move(),this.element.trigger("showCalendar.daterangepicker",this)},hideCalendars:function(){this.container.removeClass("show-calendar"),this.element.trigger("hideCalendar.daterangepicker",this)},inputsChanged:function(a){var c=$(a.target),d=b(c.val(),this.format);if(d.isValid()){var e,f;if("daterangepicker_start"===c.attr("name")){if(e=!1!==this.minDate&&d.isBefore(this.minDate)?this.minDate:d,f=this.endDate,"object"==typeof this.dateLimit){var g=b(e).add(this.dateLimit).endOf("day");f.isAfter(g)&&(f=g)}}else if(e=this.startDate,f=!1!==this.maxDate&&d.isAfter(this.maxDate)?this.maxDate:d.endOf("day"),"object"==typeof this.dateLimit){var h=b(f).subtract(this.dateLimit).startOf("day");e.isBefore(h)&&(e=h)}this.setCustomDates(e,f)}},inputsKeydown:function(a){13===a.keyCode&&(this.inputsChanged(a),this.notify())},updateInputText:function(){this.element.is("input")&&!this.singleDatePicker?(this.element.val(this.startDate.format(this.format)+this.separator+this.endDate.format(this.format)),this.element.trigger("change")):this.element.is("input")&&(this.element.val(this.endDate.format(this.format)),this.element.trigger("change"))},clickRange:function(a){var b=a.target.innerHTML;if(this.chosenLabel=b,b==this.locale.customRangeLabel)this.showCalendars();else{var c=this.ranges[b];this.startDate=c[0],this.endDate=c[1],this.timePicker||(this.startDate.startOf("day"),this.endDate.endOf("day")),this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute()),this.updateCalendars(),this.updateInputText(),this.hideCalendars(),this.hide(),this.element.trigger("apply.daterangepicker",this),this.autoApply&&this.notify()}},clickPrev:function(a){var b=$(a.target).parents(".calendar");b.hasClass("left")?this.leftCalendar.month.subtract(1,"month"):this.rightCalendar.month.subtract(1,"month"),this.updateCalendars()},clickNext:function(a){var b=$(a.target).parents(".calendar");b.hasClass("left")?this.leftCalendar.month.add(1,"month"):this.rightCalendar.month.add(1,"month"),this.updateCalendars()},hoverDate:function(a){var b=$(a.target).attr("data-title"),c=b.substr(1,1),d=b.substr(3,1),e=$(a.target).parents(".calendar");e.hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[c][d].format(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[c][d].format(this.format))},setCustomDates:function(a,c){if(this.chosenLabel=this.locale.customRangeLabel,a.isAfter(c)){var d=this.endDate.diff(this.startDate);c=b(a).add(d,"ms"),this.maxDate&&c.isAfter(this.maxDate)&&(c=this.maxDate.clone())}this.startDate=a,this.endDate=c,this.updateView(),this.updateCalendars(),this.autoApply&&(this.notify(),this.element.trigger("apply.daterangepicker",this))},clickDate:function(a){var c,d,e=$(a.target).attr("data-title"),f=e.substr(1,1),g=e.substr(3,1),h=$(a.target).parents(".calendar");if(h.hasClass("left")){if(c=this.leftCalendar.calendar[f][g],d=this.endDate,"object"==typeof this.dateLimit){var i=b(c).add(this.dateLimit).endOf("day");d.isAfter(i)&&(d=i)}}else if(c=this.startDate,d=this.rightCalendar.calendar[f][g],"object"==typeof this.dateLimit){var j=b(d).subtract(this.dateLimit).startOf("day");c.isBefore(j)&&(c=j)}this.singleDatePicker&&h.hasClass("left")?d=c.clone():this.singleDatePicker&&h.hasClass("right")&&(c=d.clone()),h.find("td").removeClass("active"),$(a.target).addClass("active"),this.setCustomDates(c,d),this.timePicker||d.endOf("day"),this.singleDatePicker&&!this.timePicker&&this.clickApply()},clickApply:function(){this.updateInputText(),this.hide(),this.element.trigger("apply.daterangepicker",this)},clickCancel:function(){this.startDate=this.oldStartDate,this.endDate=this.oldEndDate,this.chosenLabel=this.oldChosenLabel,this.updateView(),this.updateCalendars(),this.hide(),this.element.trigger("cancel.daterangepicker",this)},updateMonthYear:function(a){var b=$(a.target).closest(".calendar").hasClass("left"),c=b?"left":"right",d=this.container.find(".calendar."+c),e=parseInt(d.find(".monthselect").val(),10),f=d.find(".yearselect").val();b||this.singleDatePicker||(f<this.startDate.year()||f==this.startDate.year()&&e<this.startDate.month())&&(e=this.startDate.month(),f=this.startDate.year()),this.minDate&&(f<this.minDate.year()||f==this.minDate.year()&&e<this.minDate.month())&&(e=this.minDate.month(),f=this.minDate.year()),this.maxDate&&(f>this.maxDate.year()||f==this.maxDate.year()&&e>this.maxDate.month())&&(e=this.maxDate.month(),f=this.maxDate.year()),this[c+"Calendar"].month.month(e).year(f),this.updateCalendars()},updateTime:function(a){var b=$(a.target).closest(".calendar"),c=b.hasClass("left"),d=parseInt(b.find(".hourselect").val(),10),e=parseInt(b.find(".minuteselect").val(),10),f=0;if(this.timePickerSeconds&&(f=parseInt(b.find(".secondselect").val(),10)),this.timePicker12Hour){var g=b.find(".ampmselect").val();"PM"===g&&12>d&&(d+=12),"AM"===g&&12===d&&(d=0)}if(c){var h=this.startDate.clone();h.hour(d),h.minute(e),h.second(f),this.startDate=h,this.leftCalendar.month.hour(d).minute(e).second(f),this.singleDatePicker&&(this.endDate=h.clone())}else{var i=this.endDate.clone();i.hour(d),i.minute(e),i.second(f),this.endDate=i,this.singleDatePicker&&(this.startDate=i.clone()),this.rightCalendar.month.hour(d).minute(e).second(f)}this.updateView(),this.updateCalendars(),this.autoApply&&(this.notify(),this.element.trigger("apply.daterangepicker",this))},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.month(),this.leftCalendar.month.year(),this.leftCalendar.month.hour(),this.leftCalendar.month.minute(),this.leftCalendar.month.second(),"left"),this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.month(),this.rightCalendar.month.year(),this.rightCalendar.month.hour(),this.rightCalendar.month.minute(),this.rightCalendar.month.second(),"right"),this.container.find(".calendar.left").empty().html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate,"left")),this.container.find(".calendar.right").empty().html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.singleDatePicker?this.minDate:this.startDate,this.maxDate,"right")),this.container.find(".ranges li").removeClass("active");var a=!0,b=0;for(var c in this.ranges)this.timePicker?this.startDate.isSame(this.ranges[c][0])&&this.endDate.isSame(this.ranges[c][1])&&(a=!1,this.chosenLabel=this.container.find(".ranges li:eq("+b+")").addClass("active").html()):this.startDate.format("YYYY-MM-DD")==this.ranges[c][0].format("YYYY-MM-DD")&&this.endDate.format("YYYY-MM-DD")==this.ranges[c][1].format("YYYY-MM-DD")&&(a=!1,this.chosenLabel=this.container.find(".ranges li:eq("+b+")").addClass("active").html()),b++;a&&(this.chosenLabel=this.container.find(".ranges li:last").addClass("active").html(),this.showCalendars())},buildCalendar:function(a,c,d,e,f,g){var h,i=b([c,a]).daysInMonth(),j=b([c,a,1]),k=b([c,a,i]),l=b(j).subtract(1,"month").month(),m=b(j).subtract(1,"month").year(),n=b([m,l]).daysInMonth(),o=j.day(),p=[];for(p.firstDay=j,p.lastDay=k,h=0;6>h;h++)p[h]=[];var q=n-o+this.locale.firstDay+1;q>n&&(q-=7),o==this.locale.firstDay&&(q=n-6);var r,s,t=b([m,l,q,12,e,f]);for(h=0,r=0,s=0;42>h;h++,r++,t=b(t).add(24,"hour"))h>0&&r%7===0&&(r=0,s++),p[s][r]=t.clone().hour(d),t.hour(12),this.minDate&&p[s][r].format("YYYY-MM-DD")==this.minDate.format("YYYY-MM-DD")&&p[s][r].isBefore(this.minDate)&&"left"==g&&(p[s][r]=this.minDate.clone()),this.maxDate&&p[s][r].format("YYYY-MM-DD")==this.maxDate.format("YYYY-MM-DD")&&p[s][r].isAfter(this.maxDate)&&"right"==g&&(p[s][r]=this.maxDate.clone());return p},renderDropdowns:function(a,b,c){for(var d=a.month(),e=a.year(),f=c&&c.year()||e+5,g=b&&b.year()||e-50,h='<select class="monthselect">',i=e==g,j=e==f,k=0;12>k;k++)(!i||k>=b.month())&&(!j||k<=c.month())&&(h+="<option value='"+k+"'"+(k===d?" selected='selected'":"")+">"+this.locale.monthNames[k]+"</option>");h+="</select>";for(var l='<select class="yearselect">',m=g;f>=m;m++)l+='<option value="'+m+'"'+(m===e?' selected="selected"':"")+">"+m+"</option>";return l+="</select>",h+l},renderCalendar:function(a,b,c,d,e){var f='<div class="calendar-date">';f+='<table class="table-condensed">',f+="<thead>",f+="<tr>",this.showWeekNumbers&&(f+="<th></th>"),f+=!c||c.isBefore(a.firstDay)?'<th class="prev available"><i class="fa fa-arrow-left icon icon-arrow-left glyphicon glyphicon-arrow-left"></i></th>':"<th></th>";var g=this.locale.monthNames[a[1][1].month()]+a[1][1].format(" YYYY");this.showDropdowns&&(g=this.renderDropdowns(a[1][1],c,d)),f+='<th colspan="5" class="month">'+g+"</th>",f+=!d||d.isAfter(a.lastDay)?'<th class="next available"><i class="fa fa-arrow-right icon icon-arrow-right glyphicon glyphicon-arrow-right"></i></th>':"<th></th>",f+="</tr>",f+="<tr>",this.showWeekNumbers&&(f+='<th class="week">'+this.locale.weekLabel+"</th>"),$.each(this.locale.daysOfWeek,function(a,b){f+="<th>"+b+"</th>"
}),f+="</tr>",f+="</thead>",f+="<tbody>";for(var h=0;6>h;h++){f+="<tr>",this.showWeekNumbers&&(f+='<td class="week">'+a[h][0].week()+"</td>");for(var i=0;7>i;i++){var j="available ";j+=a[h][i].month()==a[1][1].month()?"":"off",a[h][i].isSame(new Date,"day")&&(j+=" today "),c&&a[h][i].isBefore(c,"day")||d&&a[h][i].isAfter(d,"day")?j=" off disabled ":a[h][i].format("YYYY-MM-DD")==b.format("YYYY-MM-DD")?(j+=" active ",a[h][i].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")&&(j+=" start-date "),a[h][i].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")&&(j+=" end-date ")):a[h][i]>=this.startDate&&a[h][i]<=this.endDate&&(j+=" in-range ",a[h][i].isSame(this.startDate)&&(j+=" start-date "),a[h][i].isSame(this.endDate)&&(j+=" end-date "));var k="r"+h+"c"+i;f+='<td class="'+j.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" data-title="'+k+'">'+a[h][i].date()+"</td>"}f+="</tr>"}f+="</tbody>",f+="</table>",f+="</div>";var l;if(this.timePicker){f+='<div class="calendar-time">',f+='<select class="hourselect">';var m=0,n=23;c&&("left"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==c.format("YYYY-MM-DD")&&(m=c.hour(),b.hour()<m&&b.hour(m),this.timePicker12Hour&&m>=12&&b.hour()>=12&&(m-=12),this.timePicker12Hour&&12==m&&(m=1)),d&&("right"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==d.format("YYYY-MM-DD")&&(n=d.hour(),b.hour()>n&&b.hour(n),this.timePicker12Hour&&n>=12&&b.hour()>=12&&(n-=12));var o=0,p=23,q=b.hour();for(this.timePicker12Hour&&(o=1,p=12,q>=12&&(q-=12),0===q&&(q=12)),l=o;p>=l;l++)f+=l==q?'<option value="'+l+'" selected="selected">'+l+"</option>":m>l||l>n?'<option value="'+l+'" disabled="disabled" class="disabled">'+l+"</option>":'<option value="'+l+'">'+l+"</option>";f+="</select> : ",f+='<select class="minuteselect">';var r=0,s=59;for(c&&("left"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD h A")==c.format("YYYY-MM-DD h A")&&(r=c.minute(),b.minute()<r&&b.minute(r)),d&&("right"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD h A")==d.format("YYYY-MM-DD h A")&&(s=d.minute(),b.minute()>s&&b.minute(s)),l=0;60>l;l+=this.timePickerIncrement){var t=l;10>t&&(t="0"+t),f+=l==b.minute()?'<option value="'+l+'" selected="selected">'+t+"</option>":r>l||l>s?'<option value="'+l+'" disabled="disabled" class="disabled">'+t+"</option>":'<option value="'+l+'">'+t+"</option>"}if(f+="</select> ",this.timePickerSeconds){for(f+=': <select class="secondselect">',l=0;60>l;l+=this.timePickerIncrement){var t=l;10>t&&(t="0"+t),f+=l==b.second()?'<option value="'+l+'" selected="selected">'+t+"</option>":'<option value="'+l+'">'+t+"</option>"}f+="</select>"}if(this.timePicker12Hour){f+='<select class="ampmselect">';var u="",v="";c&&("left"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==c.format("YYYY-MM-DD")&&c.hour()>=12&&(u=' disabled="disabled" class="disabled"'),d&&("right"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==d.format("YYYY-MM-DD")&&d.hour()<12&&(v=' disabled="disabled" class="disabled"'),f+=b.hour()>=12?'<option value="AM"'+u+'>AM</option><option value="PM" selected="selected"'+v+">PM</option>":'<option value="AM" selected="selected"'+u+'>AM</option><option value="PM"'+v+">PM</option>",f+="</select>"}f+="</div>"}return f},remove:function(){this.container.remove(),this.element.off(".daterangepicker"),this.element.removeData("daterangepicker")}},$.fn.daterangepicker=function(a,b){return this.each(function(){var d=$(this);d.data("daterangepicker")&&d.data("daterangepicker").remove(),d.data("daterangepicker",new c(d,a,b))}),this}}),define("views/common/plugins/popup/export-pop-view",["talent","templates/common","tdialog","$.daterangepicker","moment","momentZH"],function(a,b,c,d,e){return a.ItemView.extend({defaults:{displayType:"global",downloadUrl:""},template:b["common/plugins/popup/export-pop"],ui:{timepicker:'[data-name="timepicker"]',mail:'[data-name="mail"]',local:'[data-name="local"]'},events:function(){var a={};return a["click "+this.ui.local]="_closePop",a["click "+this.ui.mail]="_sendUsersPop",a},modelEvents:{"change:startDate":"_dateChange","change:endDate":"_dateChange"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.apiPath=a.Context.getApiHost(),this.tenantInfo=a.Context.getTenantInfo(),this.userInfo=a.Context.getUserInfo(),this.settings.container=this.settings.container||$("body"),this.Dialog=new c({sure:!1,cancel:!1,showClosed:!0,type:"default",minWidth:440,arrow:!1,className:"_tt_dialog ns-exportDaily-dialog tt-common-popup",displayType:"inline"}),this.listenTo(this.Dialog,"hide",function(){this.close()}),"inline"==this.settings.displayType?this.settings.container.append(this.Dialog.render().$el):$("body").append(this.Dialog.render().$el)},templateHelpers:function(){var a=this.model.toJSON(),b=e(a.startDate),c=e(a.endDate),d="",f=b.format("YYYY/MM/DD"),g=c.format("YYYY/MM/DD");d=f==g?f:f+"-"+g;var h=this.apiPath+"/api/v1/"+this.tenantInfo.Id+"/"+this.userInfo.Id+"/WorkTable/DownloadDaily?startDate="+this.model.get("startDate")+"&endDate="+this.model.get("endDate");return{downloadUrl:h,timeTxt:d}},onRender:function(){var b=this;this.Dialog.show(this.settings.node,this.el,{pos:this.settings.pos||"bottomRight",container:this.settings.container}),this.ui.timepicker.daterangepicker({id:"exportDaily",timePicker:!1,timePickerIncrement:5,format:"YYYY/MM/DD",timePicker12Hour:!1,opens:"left",startDate:this.model.get("startDate"),endDate:this.model.get("endDate"),showLong:!1,locale:{applyLabel:"确定",cancelLabel:"取消",fromLabel:"开始时间",toLabel:"结束时间"},parentEl:$("body").find(".tu-main-container-inner")}),this.ui.timepicker.on("apply.daterangepicker",function(c,d){var f=e(d.startDate),g=e(d.endDate),h="",i=f.format("YYYY/MM/DD"),j=g.format("YYYY/MM/DD");h=i==j?i:i+"-"+j,b.model.set({startDate:i,endDate:j}),a.$(this).text(h)})},_closePop:function(){this.Dialog&&this.Dialog.close()},_dateChange:function(){var a=this.apiPath+"/api/v1/"+this.tenantInfo.Id+"/"+this.userInfo.Id+"/WorkTable/DownloadDaily?startDate="+this.model.get("startDate")+"&endDate="+this.model.get("endDate");this.ui.local.attr("href",a)},_sendUsersPop:function(){this.trigger("mailpop")},onClose:function(){this.ui.timepicker.data&&this.ui.timepicker.data("daterangepicker")&&this.ui.timepicker.data("daterangepicker").remove(),this.Dialog&&this.Dialog.close()}})}),define("views/common/plugins/notice/notice-user-view",["talent","templates/common","UserSelector","collections/smember-group-collection","$.tipsy","tdialog"],function(a,b,c,d,e,f){var g=a.ItemView.extend({template:b["common/plugins/notice/add-user"],tagName:"li",ui:{uxUserArea:".ux_user_area"},initialize:function(){},onRender:function(){this.$el.find("a").tipsy({gravity:"s"})},events:function(){var a={};return a["mouseover "+this.ui.uxUserArea]="changeHideNode",a["mouseout "+this.ui.uxUserArea]="changeShowNode",a["click "+this.ui.uxUserArea]="deleteUser",a},deleteUser:function(){this.trigger("deleteUser",this.model)},changeHideNode:function(b){var c=a.$(b.currentTarget),d=this.model.get("Avatar");d.HasAvatar?c.find("img").hide():c.find("span").hide()},changeShowNode:function(b){var c=a.$(b.currentTarget),d=this.model.get("Avatar");d.HasAvatar?c.find("img").show():c.find("span").show()}}),h=a.CompositeView.extend({itemView:g,itemViewContainer:"ul",className:"person-list",template:b["common/plugins/notice/add-user-list"],ui:{addUserBtn:".ux_add_btn"},defaults:{title:"提醒对象"},initialize:function(b){this.settings=a._.extend({},this.defaults,this.options),this.addUserSelectonOptions=b.addUserSelectonOptions},templateHelpers:function(){return{title:this.settings.title}},modelEvents:{change:"render"},collectionEvents:{add:"_changeLength",remove:"_changeLength",reset:"_changeLength"},_changeLength:function(){this.trigger("changeLength")},onRender:function(){var a=this;this.on("itemview:deleteUser",function(b){a.collection.remove(b.model),$("body .tipsy").remove()}),this.userSelectorView=new c({collection:new d}),this.userSelectorView.addNode(this.$el.find(".ux_add_btn"),this.addUserSelectonOptions),this.$el.find(".ux_add_btn").on("submit",function(b,c){b.stopPropagation(),a.changeResponsible(c)})},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render(),this.$el.find(this.itemViewContainer).find("li:first-child").length?this.$el.find(this.itemViewContainer).find("li:first-child").before(e.el):this.$el.find(this.itemViewContainer).append(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)},changeResponsible:function(a){this.smemberSelect(a)},smemberSelect:function(a){a=a||{};var b=this.collection.where({Id:a.Id});b.length>0?this.showDialogArrow(this.ui.addUserBtn,"该联系人已存在","warn"):(a.Avatar=a.UserAvatar,this.collection.add(a))},showDialogArrow:function(b,c,d){var e=this;e.tDialogViewError||(e.tDialogViewError=new f({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),e.tDialogViewError.render().$el.appendTo("body")),e.tDialogViewError.show(a.$(b),c,{arrow:1,pos:"bottomCenter",height:300,topBias:8,leftBias:0,arrowBias:10,className:d,autoHide:!0})}});return h}),define("views/common/plugins/popup/add-user-pop-view",["talent","templates/common","tdialog","$.daterangepicker","moment","momentZH","views/common/plugins/notice/notice-user-view"],function(a,b,c,d,e,f,g){return a.ItemView.extend({defaults:{displayType:"global",downloadUrl:"",topBias:0},template:a._.template(""),ui:{},events:function(){var a={};return a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.settings.container=this.settings.container||$("body");var b=this;this.Dialog=new c({sure:function(){var a=b.Dialog.$el.find(".sure_dialog");a.hasClass("btn-disabled")||b.trigger("confirm")},cancel:!0,type:"default",minWidth:440,arrow:!1,className:"_tt_dialog ns-adduser-dialog tt-common-popup",displayType:"inline"}),"inline"==this.settings.displayType?this.settings.container.append(this.Dialog.render().$el):a.$("body").append(this.Dialog.render().$el),this.noticeUserView=new g({addUserSelectonOptions:{muti:!1,container:this.Dialog.$el},title:"发送对象",collection:new a.Collection([{Id:this.userInfo.Id,Name:this.userInfo.Name,Avatar:this.userInfo.UserAvatar}])}),this.noticeUserView.on("changeLength",function(){var a=this.noticeUserView.collection.length,b=this.Dialog.$el.find(".sure_dialog");a>0?b.removeClass("btn-disabled"):b.addClass("btn-disabled")},this),this.noticeUserView.render()},onRender:function(){this.Dialog.show(this.settings.node,this.noticeUserView.el,{topBias:this.settings.topBias,container:this.settings.container,pos:this.settings.pos||"top"})},onClose:function(){this.Dialog&&this.Dialog.close()}})}),define("views/bench/bench-export-daily-view",["talent","templates/bench","views/common/plugins/popup/export-pop-view","views/common/plugins/popup/add-user-pop-view"],function(a,b,c,d){return a.ItemView.extend({template:b["bench/bench-export-daily"],ui:{exportDaily:'[data-name="export"]',popArea:'[data-name="popArea"]',addUserArea:'[data-name="addUserArea"]'},events:function(){var a={};return a["click "+this.ui.exportDaily]="_export",a},initialize:function(){},_export:function(b){var e=(this.$(b.currentTarget),this.model.get("date"));this.popView&&this.popView.close(),this.popView=new c({node:this.ui.exportDaily,displayType:"inline",model:new a.Model({startDate:e,endDate:e}),container:this.ui.popArea,pos:"bottomRight"}),this.popView.on("mailpop",function(){this.addUserPopView=new d({node:this.popView.$el,displayType:"inline",container:this.popView.$el,pos:"bottom"}),this.addUserPopView.render(),this.addUserPopView.on("confirm",function(){this._sendMail()},this)},this),this.popView.on("hide",function(){this.addUserPopView&&this.addUserPopView.close()},this),this.popView.render()},_sendMail:function(){var b=this,c=this.popView.model.toJSON(),d=this.addUserPopView.noticeUserView.collection;a.app.request("WorkTable:sendMail",{startDate:c.startDate,endDate:c.endDate,userIds:d.pluck("Id").join(",")}).done(function(){b.popView.close(),b.addUserPopView.close()}).fail(function(){b.popView.close(),b.addUserPopView.close()})},onClose:function(){this.popView&&this.popView.close(),this.addUserPopView&&this.addUserPopView.close()}})}),function(a){"function"==typeof define&&define.amd?define("$.autoresize",["jquery"],a):a(window.jQuery||window.$)}(function(a){var b,c={className:"autosizejs",append:"",callback:!1,resizeDelay:10},d='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',e=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],f=a(d).data("autosize",!0)[0];f.style.lineHeight="99px","99px"===a(f).css("lineHeight")&&e.push("lineHeight"),f.style.lineHeight="",a.fn.autosize=function(d){return d=a.extend({},c,d||{}),f.parentNode!==document.body&&a(document.body).append(f),this.each(function(){function c(){var c,g={};if(b=l,f.className=d.className,i=parseInt(m.css("maxHeight"),10),a.each(e,function(a,b){g[b]=m.css(b)}),a(f).css(g),"oninput"in l){var h=l.style.width;l.style.width="0px",c=l.offsetWidth,l.style.width=h}}function g(){var e,g,h,k;b!==l&&c(),f.value=l.value+d.append,f.style.overflowY=l.style.overflowY,g=parseInt(l.style.height,10),"getComputedStyle"in window?(k=window.getComputedStyle(l),h=l.getBoundingClientRect().width,a.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(a,b){h-=parseInt(k[b],10)}),f.style.width=h+"px"):f.style.width=Math.max(m.width(),0)+"px",f.scrollTop=0,f.scrollTop=9e4,e=f.scrollTop,i&&e>i?(l.style.overflowY="scroll",e=i):(l.style.overflowY="hidden",j>e&&(e=j)),e+=n,g!==e&&(l.style.height=e+"px",o&&d.callback.call(l,l))}function h(){clearTimeout(k),k=setTimeout(function(){m.width()!==q&&g()},parseInt(d.resizeDelay,10))}var i,j,k,l=this,m=a(l),n=0,o=a.isFunction(d.callback),p={height:l.style.height,overflow:l.style.overflow,overflowY:l.style.overflowY,wordWrap:l.style.wordWrap,resize:l.style.resize},q=m.width();m.data("autosize")||(m.data("autosize",!0),("border-box"===m.css("box-sizing")||"border-box"===m.css("-moz-box-sizing")||"border-box"===m.css("-webkit-box-sizing"))&&(n=m.outerHeight()-m.height()),j=Math.max(parseInt(m.css("minHeight"),10)-n||0,m.height()),m.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:"none"===m.css("resize")||"vertical"===m.css("resize")?"none":"horizontal"}),"onpropertychange"in l?"oninput"in l?m.on("input.autosize keyup.autosize",g):m.on("propertychange.autosize",function(){"value"===event.propertyName&&g()}):m.on("input.autosize",g),d.resizeDelay!==!1&&a(window).on("resize.autosize",h),m.on("autosize.resize",g),m.on("autosize.resizeIncludeStyle",function(){b=null,g()}),m.on("autosize.destroy",function(){b=null,clearTimeout(k),a(window).off("resize",h),m.off("autosize").off(".autosize").css(p).removeData("autosize")}),g())})}}),define("views/common/note/note-composite-view",["talent","templates/common","$.autoresize","tdialog"],function(a,b,c,d){var e=a.ItemView.extend({template:b["common/note/note-item"],tagName:"li",colorTemplate:b["common/note/color-list"],initialize:function(b){var c=this;this.userInfo=a.Context.getUserInfo(),this.setting=a._.extend({},this.defaults,b);var d=_.values(this.setting.colorList);_.each(d,function(a,b){a==c.model.get("color")&&c.model.set("activeNum",b)})},ui:{content:'textarea[data-name="content"]',noteEdit:'div[data-name="note-edit"]',noteDel:'a[data-name="edit-note-del"]',noteSure:'a[data-name="edit-note-sure"]',noteCancel:'a[data-name="edit-note-cancel"]',noteEditColor:'a[data-name="edit-note-color"]',noteParent:"div.note_li"},onRender:function(){this.ui.content.autosize()},modelEvents:{"change:content":"render"},events:function(){var a={};return a["focus "+this.ui.content]="_onFocus",a["click "+this.ui.noteDel]="_onDelete",a["click "+this.ui.noteSure]="_onEditSure",a["click "+this.ui.noteCancel]="_onEditCancel",a["click "+this.ui.noteEditColor]="_showEditNoteColor",a["blur "+this.ui.content]="_onBlur",a},onShow:function(){this.ui.content.trigger("autosize.resize")},_showEditNoteColor:function(b){b.stopPropagation();var c=this;this.tDialogView||(this.tDialogView=new d({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),this.tDialogView.render().$el.appendTo("body")),this.tDialogView.show(a.$(b.currentTarget),this.colorTemplate({colorList:this.setting.colorList,activeNum:this.model.get("activeNum")}),{arrow:1,pos:"top",className:"color"}),this.tDialogView.$el.find(".note_color_list a").on("click",function(b){var d=a.$(b.currentTarget);c.tDialogView.$el.find("a").removeClass("active"),d.addClass("active");var e=d.attr("data-name");c.model.set("color",c.setting.colorList[e]),c.model.set("activeNum",e),c.tDialogView.hide(),c._changeCurrentColor(e)}),a.$("body").off("click.tDialogView"),a.$("body").on("click.tDialogView",function(){c.tDialogView.hide()})},_changeCurrentColor:function(a){this.model.get("color");this.$el.find('a[data-name="edit-note-color"]').css({background:this.setting.colorList[a]}),this.$el.find(".note_li").css({background:this.setting.colorList[a]}),this.$el.find('textarea[data-name="content"]').css({background:this.setting.colorList[a]})},_onEditCancel:function(){this.render()},_onFocus:function(){var a=this.model.get("content");this.ui.content.val(a),this.ui.content.trigger("autosize.resize"),this.ui.noteEdit.show(),this.trigger("focusNote")},_onEditSure:function(){this.ui.noteEdit.hide(),this._requestEditNote()},_onDelete:function(){this.trigger("deleteNote")},_requestEditNote:function(){var b=this,c=this._trimall($.trim(this.ui.content.val()));c&&a.app.request("Note:editNote",{user_id:this.userInfo.Id,NoteId:this.model.get("noteId"),Content:c,Color:this.model.get("color")}).done(function(a){b.model.set(a),b.render()}).fail(function(a){alert(a)})},_trimall:function(a){var a=a.replace(/\n/g,"");return a}}),f=a.CompositeView.extend({defaults:{colorList:{0:"#fff8dd",1:"#fee3cd",2:"#fbe2e2",3:"#daf4d6",4:"#dde5f5",5:"#e9e0f8"},pageSize:"5"},itemView:e,itemViewContainer:"ul",template:b["common/note/note-list"],colorTemplate:b["common/note/color-list"],initialize:function(b){this.userInfo=a.Context.getUserInfo(),this.model.set("deleteNote",""),this.setting=a._.extend({},this.defaults,b),this.model.set("color",this.setting.colorList[0]),this.model.set("activeNum",0),this.model.set("Total",this.setting.Total),this.model.set("totalPage",Math.ceil(this.setting.Total/this.setting.pageSize)),this.model.set("curPage",1),this.addAjax=!1},collectionEvents:{reset:"render",add:"render"},ui:{noteAdd:'a[data-name="note-add"]',noteAddPop:'div[data-name="note-add-pop"]',noteAddContent:'textarea[data-name="note-add-content"]',noteAddColor:'a[data-name="add-note-color"]',noteSure:'a[data-name="add-note-sure"]',noteCancel:'a[data-name="add-note-cancel"]',notePrev:'a[data-name="prev"]',noteNext:'a[data-name="next"]',noteParent:".note_add_content"},events:function(){var a={};return a["click "+this.ui.noteAdd]="_showAddNotePop",a["click "+this.ui.noteAddColor]="_showAddNoteColor",a["click "+this.ui.noteSure]="_addNote",a["click "+this.ui.noteCancel]="_noteCancel",a["click "+this.ui.notePrev]="_onTriggerPage",a["click "+this.ui.noteNext]="_onTriggerPage",a["click "+this.ui.noteParent]="_onFocus",a},modelEvents:{"change:deleteNote":"_requestDeleteNote","change:color":"_changeColor","change:curPage":"render","change:totalPage":"_renderTotalPage"},_renderTotalPage:function(){var a=this.model.get("totalPage"),b=this.model.get("curPage");b>=a?(this.model.set("curPage",a),this.trigger("page",a)):this.trigger("page",b)},_onFocus:function(){this.ui.noteAddContent.focus()},_onTriggerPage:function(b){var c=a.$(b.currentTarget),d=c.attr("data-name");if(!("prev"==d&&c.hasClass("icon-arrow-left-disabled")||"next"==d&&c.hasClass("icon-arrow-right-disabled"))){{var e=this.model.get("curPage");this.model.get("totalPage")}"prev"==d?e-=1:e+=1,this.model.set("curPage",e),this.trigger("page",e)}},itemViewOptions:function(){return{colorList:this.defaults.colorList}},_noteCancel:function(){this.render()},_trimall:function(a){var a=a.replace(/\n/g,"");return a},_addNote:function(){var b=this,c=this._trimall($.trim(this.ui.noteAddContent.val()));this.addAjax||(this.addAjax=!0,a.app.request("Note:addNote",{Content:c,Color:this.model.get("color"),user_id:this.userInfo.Id}).done(function(){b.trigger("page",1),b.model.set("color",b.setting.colorList[0]),b.addAjax=!1;var a=b.model.get("Total");b.model.set("Total",a+1);var c=Math.ceil((a+1)/b.setting.pageSize);b.model.set("totalPage",c)}).fail(function(a){b.addAjax=!1,b.showDialogArrow(b.$el.find('a[data-name="add-note-sure"]'),a,"warn")}))},showDialogArrow:function(b,c,e){var f=this;f.tDialogViewError||(f.tDialogViewError=new d({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),f.tDialogViewError.render().$el.appendTo("body")),f.tDialogViewError.show(a.$(b),c,{arrow:1,pos:"bottomCenter",className:e,autoHide:!0})},_changeColor:function(){this.ui.noteAddColor.css({background:this.model.get("color")}),this.$el.find('textarea[data-name="note-add-content"]').css({background:this.model.get("color")}),this.$el.find(".note_add_content").css({background:this.model.get("color")})},_showAddNoteColor:function(b){b.stopPropagation();var c=this;this.tDialogView||(this.tDialogView=new d({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),this.tDialogView.render().$el.appendTo("body")),this.tDialogView.show(a.$(b.currentTarget),this.colorTemplate({colorList:this.setting.colorList,activeNum:this.model.get("activeNum")}),{arrow:1,pos:"top",className:"color"}),this.tDialogView.$el.find(".note_color_list a").on("click",function(b){var d=a.$(b.currentTarget);c.tDialogView.$el.find("a").removeClass("active"),d.addClass("active");var e=d.attr("data-name");c.model.set("color",c.setting.colorList[e]),c.model.set("activeNum",e),c.tDialogView.hide()}),a.$("body").off("click.tDialogView"),a.$("body").on("click.tDialogView",function(){c.tDialogView.hide()})},_showAddNotePop:function(b){this.children.each(function(a){a.render()});var c=a.$(b.currentTarget);c.parent().hide(),this.ui.noteAddPop.show(),this.$el.find('textarea[data-name="note-add-content"]').focus()},_requestDeleteNote:function(){var b=this,c=this.model.get("deleteNote");a.app.request("Note:deleteNote",{user_id:this.userInfo.Id,noteId:c.noteId}).done(function(){var a=b.model.get("Total");b.model.set("Total",a-1);var c=Math.ceil((a-1)/b.setting.pageSize);0==c&&(c=1),b.trigger("page",b.model.get("curPage")),b.model.set("totalPage",c)}).fail(function(a){alert(a)})},onRender:function(){var a=this;this.on("itemview:deleteNote",function(b){a.model.set("deleteNote",b.model.toJSON()),a.collection.remove(b.model)}),this.on("itemview:focusNote",function(b){a.children.each(function(a){a.cid!=b.cid&&a.render()}),a.tDialogView&&a.tDialogView.hide(),a.$el.find(".note_add").show(),a.$el.find('div[data-name="note-add-pop"]').hide()}),this.ui.noteAddContent.autosize()},onShow:function(){this.ui.noteAddContent.trigger("autosize.resize")}});return f}),define("views/bench/bench-note-view",["talent","templates/bench","views/common/note/note-composite-view"],function(a,b,c){return a.Layout.extend({template:b["bench/bench-note"],regions:{contentBox:"div[data-name=content]"},initialize:function(b){this.options=b,this.model.set("Total",this.options.Total),this.userInfo=a.Context.getUserInfo()},onShow:function(){this._renderNoteCompositeView()},_renderNoteCompositeView:function(){var a=this;this.noteCompositeView=new c({collection:this.collection,Total:this.options.Total}),this.listenTo(this.noteCompositeView,"page",function(b){a._getNoteData(b)}),this.contentBox.show(this.noteCompositeView)},_getNoteData:function(b){var c=this,d=b||1,e=new a.$.Deferred;return a.app.request("Bench:getModuleData",{channel_type:1,view_name:"Note",startNum:d,count:5}).done(function(a){var a=a||{},b=a.notes||[],d=a.total||0;c.collection.reset(b),c.model.set("Total",d),e.resolve()}),e}})}),define("views/bench/bench-undetermined-plan-view",["talent","templates/bench"],function(a,b){return a.ItemView.extend({className:"un-basic-modules",template:b["bench/bench-undetermine-plan"],initialize:function(){},onRender:function(){}})}),define("views/bench/bench-work-hour-view",["talent","templates/bench","$.tipsy","tdialog"],function(a,b){var c=a.ItemView.extend({template:b["bench/bench-work-hour-item"],tagName:"li",className:"item",ui:{},events:{},initialize:function(){},templateHelpers:function(){var a=this.model.get("TaskName");return{TaskName:Talent.Context.subString(a,16,!0)}},onClose:function(){}});return a.CompositeView.extend({template:b["bench/bench-work-hour"],defaults:{title:"当天工时"},className:"ns-today-workhour",itemView:c,itemViewContainer:".list_stat",tagName:"ul",ui:{prev:"span[data-name=prev]",next:"span[data-name=next]",title:".name_bbm",taskName:'[data-name="push"]'},events:function(){var a={};return a["click "+this.ui.prev]="_prevHandler",a["click "+this.ui.next]="_nextHandler",a["click "+this.ui.taskName]="_onClickName",a},modelEvents:{"change:totalWorkHour":"_changeTitle"},collectionEvents:{add:"_syn",remove:"_syn",reset:"_syn"},initialize:function(b){this.pageIndex=1,this.pageSize=5,this.options.emptyView&&(this.emptyView=this.options.emptyView);for(var c=this.collection.toJSON(),d=0,e=0,f=c.length;f>e;e++)d+=c[e].hours;this.settings=a._.extend({},this.defaults,b),this.model.set("totalWorkHour",d)},templateHelpers:function(){return this.settings},onRender:function(){this.total=this.model.get("Total")||1,this.pageNum=Math.ceil(this.total/this.pageSize),this.$("li").last().css({border:"none"})},_syn:function(){for(var a=this.collection.toJSON(),b=0,c=0,d=a.length;d>c;c++)b+=a[c].hours;this.model.set("totalWorkHour",b)},_changeTitle:function(){this.ui.title.text("当天工时 （"+this.model.get("totalWorkHour")+"h）")},_onClickName:function(a){a.stopPropagation();var b=this,c=b.$(a.currentTarget),d=c.attr("id");Talent.app.vent.trigger("global-pull-screen",d,"task")},_prevHandler:function(b){var c=a.$(b.currentTarget);this.pageIndex-=1,this.ui.next.removeClass("icon-arrow-right-disabled"),c.hasClass("icon-arrow-left-disabled")||(1==this.pageIndex&&(this.pageIndex=1,c.addClass("icon-arrow-left-disabled")),this.trigger("click:prev",this.pageIndex))},_nextHandler:function(b){var c=a.$(b.currentTarget);this.pageIndex+=1,this.ui.prev.removeClass("icon-arrow-left-disabled"),c.hasClass("icon-arrow-right-disabled")||(this.pageIndex==this.pageNum&&(this.pageIndex=this.pageNum,c.addClass("icon-arrow-right-disabled")),this.trigger("click:next",this.pageIndex))},onClose:function(){}})}),define("views/bench/index-page-view",["talent","templates/bench","views/bench/bench-plan-component-view","views/bench/bench-unaccept-task-view","views/bench/bench-week-plan-implementation-view","views/bench/bench-my-group-view","views/common/enter-admin-center-view","views/bench/bench-daily-view","views/bench/bench-export-daily-view","views/bench/bench-drop-down-view","views/bench/bench-note-view","views/bench/bench-undetermined-plan-view","moment","momentZH","$.tipsy","views/common/loading-view","views/bench/bench-work-hour-view"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.Layout.extend({className:"tt_layout_bench",template:b["bench/index-page"],regions:{container:"._tt_layout_home_container",right_1:"div[data-name=bench-right-1]",right_2:"div[data-name=bench-right-2]",right_3:"div[data-name=bench-right-3]",right_4:"div[data-name=bench-right-4]",right_5:"div[data-name=bench-right-5]",right_6:"div[data-name=bench-right-6]",right_7:"div[data-name=bench-right-7]",right_8:"div[data-name=bench-right-8]",right_9:"div[data-name=bench-right-9]",right_10:"div[data-name=bench-right-10]",entertms:"div[data-name=enter-tms]",planListArea:"div[data-name=bench-plan]"},ui:{tabNav:"ul[data-name=bench-tab]",tabNavItem:"ul[data-name=bench-tab] li",right_1:"div[data-name=bench-right-1]",right_2:"div[data-name=bench-right-2]",right_3:"div[data-name=bench-right-3]",right_4:"div[data-name=bench-right-4]",right_5:"div[data-name=bench-right-5]",right_6:"div[data-name=bench-right-6]",right_7:"div[data-name=bench-right-7]",right_8:"div[data-name=bench-right-8]",right_9:"div[data-name=bench-right-9]",right_10:"div[data-name=bench-right-10]",right_contacts:"[data-name=bench-right-contacts]",introPlan:"a[data-name=intro-plan]",planListArea:"div[data-name=bench-plan]"},events:function(){var a={};return a["click "+this.ui.tabNavItem]="_tabLiHandler",a["click "+this.ui.introPlan]="_showIntroPlanHandler",a},templateHelpers:function(){return{i18n:this.i18n}},initialize:function(){var b=this;this.today=m().format("YYYY/MM/DD"),this.i18n=a.Context.getI18n(),this.userInfo=a.Context.getUserInfo(),a.Context.setPageTitle("tita-工作台"),this.acceptTask_Page_Index=1,this.workHour_Page_Index=1,this.joinTask_Page_Index=1,this.routerDataModel=new a.Model,this.listenTo(this.routerDataModel,"change:type",function(){this._getPageData()},this),this.listenTo(this.routerDataModel,"change:date",function(){this.acceptTask_Page_Index=1,this.joinTask_Page_Index=1,a.app.request("Bench:getModuleData",{channel_type:1,view_name:"WorkTimeTask",StartDate:this.routerDataModel.get("date"),EndDate:this.routerDataModel.get("date"),startNum:1,count:5}).done(function(a){var c=b.benchWorkHourView;c?a.tasks&&a.tasks.length?(c.$el.show(),c.collection.reset(a.tasks),c.model.set("Total",a.tasks.length)):c.$el.hide():b._renderTodayWorkHour(a,{pos:b.todayWorkHourPos,viewName:"WorkTimeTask",viewType:5})})})},onRender:function(){this._getRouterData(),this._typeChange()},onShow:function(){this.$el.find("span[original-title]").tipsy({gravity:"e"}),this.enterAdminCenterView||(this.enterAdminCenterView=new g,this.entertms.show(this.enterAdminCenterView)),a._.splash("bench"),this._getPageData(),a.$("#BizQQWAP").show()},_rendLoadView:function(){this.loadingView=new p,this.planListArea.show(this.loadingView)},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a||{},b.routerData.date=a.date||b.today,b.routerData.type=a.type||"my",b.routerData.to_user_id=b.routerData.to_user_id||b.userInfo.Id,b.routerData.isMySelf=b.routerData.to_user_id==b.userInfo.Id,b.routerData.area_type=b.routerData.area_type||"",b.routerDataModel.set(b.routerData,{silent:!0})}),d},_getPageData:function(){{var a=this;this.routerDataModel.get("type")}this.ui.right_1.html(""),this.ui.right_2.html(""),this.ui.right_3.html(""),this.ui.right_4.html(""),this.ui.right_5.html(""),this.ui.right_6.html(""),this.ui.right_7.html(""),this.ui.right_8.html(""),this.ui.right_9.html(""),this.ui.right_10.html(""),this._rendLoadView(),a._renderPlanListView(),this._getRightModuleData()},_getRightModuleData:function(){var b=this.routerDataModel.get("type"),c=this;a.app.request("Bench:getRightPartData",{channel_type:"my"==b?1:2,date:this.routerDataModel.get("date")}).done(function(a){c._renderRightPart(a)})},_renderRightPart:function(a){for(var b=null,c=null,d={UnDetermineCount:"_renderUndeterminedPlanView",PersionalPlanDaily:"_renderDailyView",TeamPlanDaily:"_renderDailyView",UnAccetpTask:"_renderUnAcceptView",JoinTask:"_renderJoinedView",PsersonalWeekPlanStatistic:"_renderPlanWeekView",TeamWeekPlanStatistic:"_renderPlanWeekView",PsersonalMonthPlanStatistic:"_renderPlanWeekView",TeamMonthPlanStatistic:"_renderPlanWeekView",Note:"_renderNoteCompositeView",Team:"_renderGroupView",Contact:"_renderExternalContact",ExportDaily:"_renderExportDailyView",WorkTimeTask:"_renderTodayWorkHour"},e=0,f=a.length;f>e;e++)b=a[e],c=d[b.name],c&&this[c](b.data,{pos:e+1,viewName:b.name,viewType:b.viewType,title:b.title});
this.rihgtModuleTotal=f},_renderExternalContact:function(a,b){var c='<div data-name="bench-right-contacts" class="un-basic-modules"><a href="http://kf.tita.com/" target="_blank" class="btn" style="display:block;">外部联系人</a></div>';this.ui["right_"+b.pos].html(c)},_renderUndeterminedPlanView:function(b,c){var d=new l({model:new a.Model({total:b.value})}),e=this["right_"+c.pos];e&&e.show(d)},_typeChange:function(){var a=this.routerDataModel.get("type");this.ui.tabNavItem.removeClass("active"),this.ui.tabNav.find("li[data-type="+a+"]").addClass("active")},_tabLiHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("data-type");this.routerDataModel.set("type",d),this.ui.tabNavItem.removeClass("active"),c.addClass("active")},_renderPlanListView:function(){this.benchPlanComponentView&&this.benchPlanComponentView.close(),this.benchPlanComponentView=new c({model:this.routerDataModel}),this.planListArea&&this.planListArea.show(this.benchPlanComponentView)},_renderJoinedView:function(b,c){var e=b.tasks||[],f=b.total||0;if(e.length){var g=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"feedId"})}});this.benchJoinedView=new d({model:new a.Model({Total:f,nextNum:b.nextNum,upNum:b.upNum,viewType:c.viewType,viewName:c.viewName}),collection:new g(e),showPrincipal:!0,title:"我参与的任务",showAllBtn:!0,showAllUrl:"#more/tasks?relation=2"}),this.listenTo(this.benchJoinedView,"click:prev",function(a){this._getUnAcceptTaskData("join",a)}),this.listenTo(this.benchJoinedView,"click:next",function(a){this._getUnAcceptTaskData("join",a)});var h=this["right_"+c.pos];h&&h.show(this.benchJoinedView)}},_renderUnAcceptView:function(b,c){{var e=b.tasks||[];b.total||0}if(e.length){var f=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"feedId"})}});this.benchUnAcceptTaskView=new d({model:new a.Model({Total:b.total,nextNum:b.nextNum,upNum:b.upNum,viewType:c.viewType,viewName:c.viewName}),collection:new f(e)}),this.listenTo(this.benchUnAcceptTaskView,"click:prev",function(a){this._getUnAcceptTaskData("unaccept",a)}),this.listenTo(this.benchUnAcceptTaskView,"click:next",function(a){this._getUnAcceptTaskData("unaccept",a)});var g=this["right_"+c.pos];g&&g.show(this.benchUnAcceptTaskView)}},_renderTodayWorkHour:function(b,c){var d=b.tasks||[],e=d.length;if(this.todayWorkHourPos=c.pos,e){var f=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"feedId"})}});this.benchWorkHourView=new q({model:new a.Model({Total:e}),collection:new f(d)}),this.listenTo(this.benchWorkHourView,"click:prev",function(a){this.workHour_Page_Index=a}),this.listenTo(this.benchWorkHourView,"click:next",function(a){this.workHour_Page_Index=a});var g=this["right_"+c.pos];g&&g.show(this.benchWorkHourView)}},_getUnAcceptTaskData:function(b,c){var d=this.routerDataModel.get("type"),e={unaccept:{view:this.benchUnAcceptTaskView},join:{view:this.benchJoinedView}},f=e[b].view;a.app.request("Bench:getModuleData",{channel_type:"my"==d?1:2,view_name:f.model.get("viewName"),StartDate:this.model.get("date"),EndDate:this.model.get("date"),startNum:c,count:5}).done(function(a){var b=f.model;f.collection.reset(a.tasks),b.set({nextNum:a.nextNum,upNum:a.upNum})})},_renderPlanWeekView:function(b,c){var d=this.routerDataModel.get("type"),b=b.statistic||[],f=new e({model:new a.Model({data:b}),routerModel:this.routerDataModel});this.listenTo(f,"switch",function(b){var c=4==b.type?!0:!1,e="";e="my"==d?c?"PsersonalWeekPlanStatistic":"PsersonalMonthPlanStatistic":c?"TeamWeekPlanStatistic":"TeamMonthPlanStatistic",a.app.request("Bench:getModuleData",{channel_type:"my"==d?1:2,view_name:e}).done(function(a){var b=a.statistic;f.model.set({data:b||[]})})});var g=this["right_"+c.pos];g&&g.show(f)},_renderExportDailyView:function(a,b){var c=new i({model:this.routerDataModel}),d=this["right_"+b.pos];d&&d.show(c)},_renderDailyView:function(b,c){{var d=this;this.routerDataModel.get("type")}this.teamData?this._renderDailyViewActualy(b,c):a.app.request("Bench:getModuleData",{channel_type:2,view_name:"Team",StartDate:this.model.get("date"),EndDate:this.model.get("date"),SubType:0}).done(function(a){d.teamData=a.members,d._renderDailyViewActualy(b,c)})},_renderDailyViewActualy:function(b,c){var d=this,e=this.routerDataModel.get("type"),f=new h({model:new a.Model({data:b,team:this.teamData}),routerModel:this.routerDataModel});this.listenTo(f,"pubDailySuccess",function(){a.app.request("Bench:getModuleData",{channel_type:"my"==e?1:2,view_name:"my"==e?"PersionalPlanDaily":"TeamPlanDaily",StartDate:this.routerDataModel.get("date"),EndDate:this.routerDataModel.get("date")}).done(function(a){d._renderDailyView(a,c)})});var g=this["right_"+c.pos];g&&g.show(f)},_renderGroupView:function(b,c){var d=new f({model:new a.Model({data:b.members})}),e=this["right_"+c.pos];e&&e.show(d)},_showIntroPlanHandler:function(b){b.stopPropagation(),a.app.vent.trigger("Guide:Guide-View:click","plan")},_renderNoteCompositeView:function(b,c){var d=b.total,b=b.notes||[];this.benchNoteView=new k({collection:new a.Collection(b),Total:d});var e=this["right_"+c.pos];e&&e.show(this.benchNoteView)}});return a.BasePageView.extend({mainViewClass:r,layout:window.top==window?"master-layout":"empty-layout"})});