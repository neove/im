/*! tita-web-v4 - v0.4.0 - 2016-07-08 18:31 */function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function dataProcessor(a){return this.serverProcessor=a,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this._headers=null,this._payload=null,this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhx4._eventable(this),this}define("templates/work",[],function(){return this.JST=this.JST||{},this.JST["work/common/project-list-action/project-list-action"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="btn project_detail_operate_btn">\n	操作<span class="icon icon-arrow-down"></span>\n</div>\n<ul class="btn-list" style="display:none;">\n		',(IsPrincipal||IsCreator||IsManage)&&hasOpenImport&&1!=ApplyState&&3!=ApplyState&&(__p+='\n		<li class="action-btn import-btn" data-name="import-milepost">导入里程碑</li>\n 		<li class="action-btn import-btn" data-name="import-task">导入任务</li>\n 		'),__p+="\n		",(IsPrincipal||IsCreator||IsManage)&&3==ApplyState&&(__p+='\n		<a href="#work?create=true&work_id='+(null==(__t=WorkId)?"":__t)+'"><li>重新创建</li></a>\n 		'),__p+="\n  \n		",!(IsPrincipal||IsCreator||IsApplyUser||IsManage)||0!=ApplyState&&2!=ApplyState||(__p+=2==Status?'\n	 			<li class="end_btn" data-handler="Close">重启项目</li>\n	 		':'\n	 			<li class="end_btn" data-handler="Close">完成项目</li>\n	 		',__p+="\n 		"),__p+="\n 		",(IsPrincipal||IsCreator||IsApplyUser||IsManage)&&DeleteEnable&&(__p+='\n 			<li class="delete_btn" data-handler="Delete">删除项目</li>\n 		'),__p+="\n 		",IsParticipate&&(__p+='\n 			<li class="paticipate_btn" data-handler="Paticipate">退出参与</li>\n 		'),__p+="\n 	",IsPrincipal||IsParticipate||(__p+="\n 		",__p+=IsFollow?'\n 			<li class="paticipate_btn" data-handler="Follow">取消关注</li>\n 		':'\n 			<li class="paticipate_btn" data-handler="Follow">关注项目</a>\n 		'),__p+="\n</ul> ";return __p},this.JST["work/create/project-create-bak"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="project_create_top_container">\n	<div class="project_create_title">\n		<span class="project_sign_icon"></span>\n		<span class="project_create_title_type">新建一个'+(null==(__t=i18n.work_1)?"":__t)+'</span>\n	</div>\n	<hr>\n</div>\n<div class="project_create_bottom_container">\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">'+(null==(__t=i18n.work_1)?"":__t)+'名称</span>\n		<div class="project_input_container">\n			<div class="project_input project_name_input"  data-type="name" contenteditable="true"></div>\n			<label class="place_holder">必填</label>\n		</div>\n		<span class="project_input_tips">最多30个字</span>\n	</div>\n\n	<div class="project_item_container clearfix project_responsible">\n		<span class="project_item_title">谁来负责</span>\n		<div class="project_input_container">\n			<span class="white_member_single"></span>\n			<img src="'+(null==(__t=userInfo.Avatar)?"":__t)+'"></img>\n			<input class="project_input project_responsible_input" data-type="responsible" text-origion="谁负责" value="'+(null==(__t=userInfo.Name)?"":__t)+'"></input>\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_member">\n		<span class="project_item_title">其他成员</span>\n		<div class="project_input_container">\n			<span class="white_member_muti"></span>\n			<ul class="project_member_container">\n			</ul>\n			<a class="project_add_btn" href="javascript:;">\n				<span></span>\n			</a>\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_range">\n		<span class="project_item_title">可见范围</span>\n		<a class="radio_item radio_item1" href="javascript:;">\n			<span class="radio_blue radio_blue_checked"  data-type="private"></span>私密												\n		</a>\n		<a class="radio_item radio_item2" href="javascript:;">\n			<span class="radio_blue" data-type="public"></span>公开\n		</a>\n	</div>\n\n	<div class="project_more_container clearfix">\n		<div class="project_item_container clearfix project_time">\n			<span class="project_item_title">'+(null==(__t=i18n.work_1)?"":__t)+'时间</span>\n			<div class="project_input_container">\n				<a class="radio_item radio_item1" href="javascript:;">\n					<span class="radio_blue radio_blue_checked" data-type="short_term"></span>\n					<span class="time_span time_begin" text-origion="未设置开始时间">未设置开始时间</span>\n					<span class="time_split">...</span>\n					<span class="time_span time_end" text-origion="未设置结束时间">未设置结束时间</span>\n				</a>\n				<a class="radio_item radio_item2" href="javascript:;">\n					<span class="radio_blue"  data-type="long_term"></span>\n					<span>长期'+(null==(__t=i18n.work_1)?"":__t)+'</span>\n				</a>\n			</div>\n			<div class="datepicker">\n				<div id="datepicker"></div>\n			</div>\n		</div>\n		<div class="project_item_container clearfix project_description">\n			<span class="project_item_title">'+(null==(__t=i18n.work_1)?"":__t)+'目标</span>\n			<div class="project_input_container">\n				<span class="descrip_icon"></span>\n				<textarea class="project_input project_description_input" data-type="description"></textarea>\n				<label class="place_holder">请简单描述下</label>\n			</div>\n		</div>\n		<div class="project_item_container" style="display:none">\n			是否安排任务？\n			<a class="" href="javascript:;">安排</a>\n		</div>\n	</div>\n\n	<div class="project_create_more" style="display:none"> \n		<a href="javascript:;" class="project_create_more_btn">\n			<span class="project_create_more_text" text-origion="收起设置">更多设置</span>\n			<span class="blue_drop"></span>\n		</a>\n	</div>\n\n	<div class="project_item_container clearfix">\n		<a class="project_create_btn" href="javascript:;">创建新'+(null==(__t=i18n.work_1)?"":__t)+'</a>\n		<a class="project_cancel_btn" href="#work">取消</a>\n	</div>\n\n	<textarea id="text" style="position:absolute;top: -1000px;"></textarea>\n</div>';return __p},this.JST["work/create/project-create-member-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+="\n",__p+="undefined"!=typeof type&&"department"==type?"\n	<li data-id="+(null==(__t=id)?"":__t)+'>\n		<a original-title="删除'+(null==(__t=name)?"":__t)+'" class="project_delete_member_btn" data-name="'+(null==(__t=dataName)?"":__t)+'" href="javascript:;">\n			<span></span>\n		</a>\n		'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:"",size:30,shape:"radius",name:name,bgColor:"#7890BD"}))?"":__t)+"\n	 \n	</li>\n":"\n	<li data-id="+(null==(__t=UserId)?"":__t)+'>\n		<a original-title="删除'+(null==(__t=Name)?"":__t)+'" class="project_delete_member_btn" data-name="'+(null==(__t=dataName)?"":__t)+'" href="javascript:;">\n			<span></span>\n		</a>\n		'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:Avatar.Small,size:30,shape:"radius",name:Name,bgColor:Avatar.Color}))?"":__t)+"\n	</li>\n";return __p},this.JST["work/create/project-create"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="project_create_top_container">\n	<div class="project_create_title">\n		<span class="project_sign_icon"></span>\n		<span class="project_create_title_type" data-name="title">新建一个'+(null==(__t=i18n.work_1)?"":__t)+'</span>\n	</div>\n	<hr>\n</div>\n<div class="project_create_bottom_container">\n\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">',__p+=IsUseWork?"\n			Name\n		":"\n			"+(null==(__t=i18n.work_1)?"":__t)+"名称\n		",__p+='</span>\n		<div class="project_input_container">\n			<input class="project_input project_name_input"  data-type="name" value="'+(null==(__t=WorkName)?"":__t)+'" />\n			',WorkName||(__p+='\n			<label class="place_holder place_required">必填</label>\n			'),__p+='\n		</div>\n		<span class="project_input_tips">最多50个字</span>\n	</div>\n	',IsUseWork&&(__p+='\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Type\n			":"\n				"+(null==(__t=i18n.work_1)?"":__t)+"类别\n			",__p+='\n			</span>\n		<div class="project_input_container">\n			<input class="project_input project_name_input"  data-type="label" value="'+(null==(__t=LableName)?"":__t)+'" />\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Date\n			":"\n				起止时间\n			",__p+='\n		</span>\n		<div class="project_input_container">\n			',__p+=IsUseWork&&StartDate?'\n				<input class="project_input project_name_input"  data-type="time" value="'+(null==(__t=StartDate)?"":__t)+'">\n			':StartDate&&EndDate&&1==WorkType?'\n			<input class="project_input project_name_input"  data-type="time" value="'+(null==(__t=StartDate)?"":__t)+" - "+(null==(__t=EndDate)?"":__t)+'">\n			':StartDate&&2==WorkType?'\n				<input class="project_input project_name_input"  data-type="time" value="'+(null==(__t=StartDate)?"":__t)+' - 长期">\n			':'\n				<input class="project_input project_name_input"  data-type="time">\n			',__p+='\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Team\n			":"\n				所属部门\n			",__p+='\n		</span>\n		<div class="project_input_container">\n			<input class="project_input project_name_input"  data-type="department" value="'+(null==(__t=DepartmentName)?"":__t)+'" />\n		</div>\n	</div>\n	'),__p+="\n	",IsUseWork||(__p+='\n		<div class="project_item_container clearfix project_name">\n			<span class="project_item_title">\n				起止时间\n			</span>\n			<div class="project_input_container">\n				',create?(__p+='\n					<input class="project_input project_name_input project_date"  data-type="time" style="font-size:14px;">\n					<label class="project_default_date" data-name=\'project-default-date\'>'+(null==(__t=StartDate)?"":__t)+" - ",__p+=EndDate?null==(__t=EndDate)?"":__t:"长期",__p+="</label>\n				"):(__p+="\n					",__p+=StartDate&&EndDate&&1==WorkType?'\n						<input class="project_input project_name_input project_date"  data-type="time" value="'+(null==(__t=StartDate)?"":__t)+" - "+(null==(__t=EndDate)?"":__t)+'">\n						':StartDate&&2==WorkType?'\n							<input class="project_input project_name_input project_date"  data-type="time" value="'+(null==(__t=StartDate)?"":__t)+' - 长期" style="font-size:14px;">\n						':'\n							<input class="project_input project_name_input project_date"  data-type="time" style="font-size:14px;">\n						',__p+="\n				"),__p+="	\n			</div>\n		</div>\n		\n	"),__p+='\n	<div class="project_item_container clearfix project_responsible">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Responsible\n			":"\n				谁来负责\n			",__p+='\n			</span>\n		<div class="project_input_container">\n			<span class="white_member_single_none"></span>\n			<a href="javascript:void(0)" class="responsible_avatar">\n			'+(null==(__t=_.convertImage({className:"radius_img30",src:Principal.Avatar.Small,size:30,shape:"radius",name:Principal.Name,bgColor:Principal.Avatar.Color}))?"":__t)+'\n			</a>\n			<input class="project_input project_responsible_input" data-type="responsible" text-origion="谁负责" ',ApplyUser&&(__p+='style="display:none;"'),__p+='/>\n			<label class="',__p+=ApplyUser?"replace_place_holder":"place_holder",__p+='" >'+(null==(__t=_.substring(Principal.Name,8,!0))?"":__t)+'</label>\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_member">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Members\n			":"\n				其他成员\n			",__p+='\n			</span>\n		<div class="project_input_container">\n			<span class="white_member_single_none"></span>\n			<ul class="project_member_container" data-name="project-member-list" ',Participators.length>15&&(__p+='style="padding-left:5px;"'),__p+=">\n				",_.each(Participators,function(a){__p+='\n					<li data-id="'+(null==(__t=a.UserId)?"":__t)+'">\n						<a original-title="删除'+(null==(__t=a.Name)?"":__t)+'" class="project_delete_member_btn" data-name="project-delete-member" href="javascript:;">\n							<span></span>\n						</a>\n						'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:a.Avatar.Small,size:30,shape:"radius",name:a.Name,bgColor:a.Avatar.Color}))?"":__t)+"\n					</li>\n				"}),__p+='\n			</ul>\n			<a class="project_add_btn" data-name="add-project-member" href="javascript:;" original-title="添加成员" ',Participators.length>=15&&(__p+='style="margin-left:5px;margin-bottom:5px;"'),__p+=">\n				<span></span>\n			</a>\n		</div>\n	</div>\n\n	",IsUseWork||(__p+='\n		<div class="project_item_container clearfix project_member">\n			<span class="project_item_title">审批人</span>\n			<div class="project_input_container">\n				<span class="white_member_single_none"></span>\n				<ul class="project_member_container" data-name="project-apply-user">\n					',ApplyUser&&(__p+='\n						<li data-id="'+(null==(__t=ApplyUser.UserId)?"":__t)+'">\n							<a original-title="删除'+(null==(__t=ApplyUser.Name)?"":__t)+'" class="project_delete_member_btn" data-name="delete-apply-user" href="javascript:;">\n								<span></span>\n							</a>\n							 '+(null==(__t=_.convertImage({src:ApplyUser.Avatar.Small,size:30,shape:"radius",name:ApplyUser.Name,bgColor:ApplyUser.Avatar.Color,className:"img_hover"}))?"":__t)+"\n						</li>\n					"),__p+='\n				</ul>\n				<a class="project_add_btn" data-name="add-apply-user" href="javascript:;" original-title="添加审批人" ',__p+=""==ApplyUser?'style="display:block;"':'style="display:none;"',__p+='>\n					<span></span>\n				</a>\n				<label class="place_apply_holder" data-name="apply-user-default" ',__p+=""==ApplyUser?'style="display:block;"':'style="display:none;"',__p+='>不添加审批人，默认不审批。</label>		\n			</div>\n		</div>\n		<div class="project_item_container clearfix project_member">\n			<span class="project_item_title">关注者</span>\n			<div class="project_input_container">\n				<span class="white_member_single_none"></span>\n				<ul class="project_member_container" data-name="project-follower-list" ',Participators.length>15&&(__p+='style="padding-left:5px;"'),__p+=">\n					",_.each(Participators,function(a){__p+='\n						<li data-id="'+(null==(__t=a.UserId)?"":__t)+'">\n							<a original-title="删除'+(null==(__t=a.Name)?"":__t)+'" class="project_delete_member_btn" data-name="project-delete-follower" href="javascript:;">\n								<span></span>\n							</a>\n							'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:a.Avatar.Small,size:30,shape:"radius",name:a.Name,bgColor:a.Avatar.Color}))?"":__t)+"\n						</li>\n					"}),__p+='\n				</ul>\n				<a class="project_add_btn" data-name="add-project-follower" href="javascript:;" original-title="添加关注者" ',Participators.length>=15&&(__p+='style="margin-left:5px;margin-bottom:5px;"'),__p+=">\n					<span></span>\n				</a>\n			</div>\n		</div>\n	"),__p+='\n	<div class="project_item_container clearfix project_description">\n		<span class="project_item_title">',__p+=IsUseWork?"\n			Objective\n		":"\n			"+(null==(__t=i18n.work_1)?"":__t)+"目标\n		",__p+='</span>\n		<div class="project_input_container">\n			\n			<textarea class="project_input project_description_input" data-type="description" style="resize:none;">'+(null==(__t=Description)?"":__t)+"</textarea>\n			",Description||(__p+='\n			<label class="place_holder">请简单描述下</label>\n			'),__p+='\n			\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_range">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Visibility\n			":"\n				可见范围\n			",__p+='\n			</span>\n		<a class="radio_item radio_item1" href="javascript:;">\n			<span class="radio_blue ',2==IsVisible&&(__p+="radio_blue_checked"),__p+='"  data-type="private"></span>',__p+=IsUseWork?"private":"私密",__p+='												\n		</a>\n		<a class="radio_item radio_item2" href="javascript:;">\n			<span class="radio_blue ',1==IsVisible&&(__p+="radio_blue_checked"),__p+='" data-type="public"></span>',__p+=IsUseWork?"public":"公开",__p+="\n		</a>\n	</div>\n\n	",isShowInvested&&(__p+='\n	<div class="project_item_container clearfix project_range">\n		<span class="project_item_title">已投资</span>\n		<a class="radio_item radio_item1" href="javascript:;">\n			<span class="radio_blue ',IsInvested&&1==IsInvested&&(__p+="radio_blue_checked"),__p+='"  data-type="investment" data-name=\'invested\'></span>是　\n		</a>\n		<a class="radio_item radio_item2" href="javascript:;">\n			<span class="radio_blue ',IsInvested&&0==IsInvested&&(__p+="radio_blue_checked"),__p+='" data-type="noInvestment" data-name=\'invested\'></span>否\n		</a>\n	</div>\n	'),__p+='\n	\n	<div class="project_item_container project_item_topline clearfix">\n		<a class="btn btn-success project_create_btn" href="javascript:;" data-name="submit">创建新'+(null==(__t=i18n.work_1)?"":__t)+'</a>\n		<a class="btn btn-cancel project_cancel_btn" href="#work">取消</a>\n	</div>\n\n	<textarea id="text" style="position:absolute;top: -1000px;"></textarea>\n</div>';return __p},this.JST["work/detail/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='\n<div data-name="container"   class="_tt_layout_container">\n	<div class="_tt_loading_m">努力加载中…</div>		\n</div>';return __p},this.JST["work/dynamic-composite"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div data-name="pubblog"></div>\n<div data-name="feedlist"></div>';return __p},this.JST["work/follower-composite"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="project_member_container">\n	<div class="project_member_container_title">\n		关注者\n		<a class="project_member_count" href="javascript:;"><span>'+(null==(__t=count)?"":__t)+'</span>个人</a>\n	</div>\n	<div class="project_member_list_parent clearfix">\n		\n		',1!=IsParticipate&&1!=IsPrincipal&&!IsCreator&&!IsManage||2!=ApplyState&&0!=ApplyState?IsApplyUser&&2==ApplyState&&(__p+='\n			<div class="project_follower_add">\n				<a href="javascript:void(0);" class="member_add_big" original-title="添加关注者"><span></span></a>\n			</div>\n		'):__p+='\n		<div class="project_follower_add">\n			<a href="javascript:void(0);" class="member_add_big" original-title="添加关注者"><span></span></a>\n		</div>\n		',__p+='\n		<ul class="project_member_container_list" id ="project_follow_list">\n			\n		</ul>\n	</div>\n</div>\n<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>';return __p},this.JST["work/implementation/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<!-- side sub nav -->\n<div class="_tt_layout_tabnav tt_staff_sidebar">	\n	<div class="tt_side_subnav_wrap tt_staff_subnav">\n        <div class="subtab_ssw">\n            <li class="active"><a href="#work/implementation?page_type=group" data-trigger="false"><span>团队</span></a></li>\n            <li><a href="#work/implementation?page_type=organ" data-trigger="false"><span>组织</span></a></li>\n        </div>\n		<div data-name="side-bar" class="side_bar"></div>\n    </div>	\n</div>\n<!-- side sub nav end -->\n<div class="_tt_layout_container tt-project-implamentation">\n	<div class="tt_page_report_container">\n		<div class="report-title">\n			<span class="title-page">项目执行情况</span>\n			<a href="#work" class="back-list">返回项目列表</a>\n		</div>\n		<div class="report_container"  data-name="report-container">\n		</div>\n	</div>\n</div>';return __p},this.JST["work/implementation/report-list-sidebar"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<ul class="_tt_side_subnav">            \n    <li><a href="#work/implementation?page_type=group&sidebar_type=myself" data-trigger="false">我自己</a></li>\n    <li><a href="#work/implementation?page_type=group&sidebar_type=mysub" data-trigger="false">我的团队</a></li>\n</ul>';return __p},this.JST["work/implementation/report-work-composite"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="report-work-list">\n</div>\n<div class="showmore" data-name="show-more">\n<a href="javascript:void(0);" >\n	<span>查看更多</span>\n</a>\n</div>';return __p},this.JST["work/implementation/report-work-item"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<div class="panel-title">\n	<div class="panel-name"><a href="#work?work_id='+__e(workId)+"&app_id=1&app_type=1&to_user_id="+__e(principalUser.UserId)+'">'+__e(workName)+'</a></div>\n	<div class="panel-master">\n		<span class="master-name">负责人：<span class="name">'+__e(principalUser.Name)+'</span></span>\n		<span class="master-photo">\n			',__p+=principalUser.Avatar.HasAvatar?'\n				<img src="'+__e(principalUser.Avatar.Small)+'" alt="'+__e(principalUser.Name)+'" />\n			':"\n				"+(null==(__t=_.convertImage({className:"",size:30,shape:"radius",name:principalUser.Name,bgColor:principalUser.Avatar.Color}))?"":__t)+"\n			",__p+='\n		</span>\n	</div>\n</div>\n<div class="panel-container">\n	<div class="milepost-list">\n		<div class="switch-milepost prev">\n			',showPrev&&(__p+='\n			<span class="icon-arrow-left"></span>\n			'),__p+='\n		</div>\n		<div class="switch-milepost next">\n			',showNext&&(__p+='\n			<span class="icon-arrow-right"></span>\n			'),__p+='\n		</div>\n		<ul class="list-milepost">\n			',_.each(workMileStones,function(a,b){b>=showFromIndex&&b<=showToIndex&&(__p+='\n				<li class="chart-milepost-item">\n					',__p+=1==a.status?'\n						<div class="milepost-name unstart" origin-title="'+__e(a.workMileStoneName)+'">\n							'+__e(a.workMileStoneName)+"\n						</div>\n					":4==a.status||5==a.status?'\n						<div class="milepost-name finished" origin-title="'+__e(a.workMileStoneName)+'">\n							'+__e(a.workMileStoneName)+"\n						</div>\n					":'\n					    <div class="milepost-name" origin-title="'+__e(a.workMileStoneName)+'">\n							'+__e(a.workMileStoneName)+"\n						</div>\n					",__p+='\n					<div class="milepost-status status-'+__e(a.status)+'">\n					  ',__p+=2==a.status||3==a.status?'\n						完成率:<span class="complete-rate">'+__e(Math.round(100*(a.finishTaskOnTimeTotal+a.finishTaskDelayTotal)/(a.taskTotal||1)))+"%</span>\n					  ":"\n					  "+__e(statusValue[a.status])+"\n					  ",__p+='\n					  <div class="milepost-time">\n						'+__e(a.startDate.replace(currentYear+"/",""))+"-"+__e(a.endDate.replace(currentYear+"/",""))+"\n					  </div>\n					</div>\n					",viewChart&&(__p+='\n						<div class="chart-item">\n							',1==a.status?__p+='\n								<div class="mile-chart">\n								  <img src="'+(null==(__t=Talent.Context.getStaticUrl("images/milepost-unstart.png"))?"":__t)+'" />\n							    </div>\n							    <ul class="chart-data-list">\n									<li class="chart-data-item">	\n									    <div class="task-value">'+__e(a.taskTotal)+'</div>\n									    <div class="task-label">未完成</div>\n									</li>\n								</ul>\n						    ':(__p+='\n						    <div class="mile-chart" data-index="'+__e(b)+'">\n							\n						    </div>\n						    <ul class="chart-data-list">\n								',0!=a.taskTotal&&(__p+="\n									",(0!=a.unfinishTaskDelayTotal||0!=a.unfinishTaskOnTimeTotal)&&(__p+='\n										<li class="chart-data-item">	\n										    <div class="task-value"><span class="task-count">'+__e(a.unfinishTaskDelayTotal+a.unfinishTaskOnTimeTotal)+'</span>(<span class="delay-color">'+__e(a.unfinishTaskDelayTotal)+"</span>/"+__e(a.unfinishTaskOnTimeTotal)+')</div>\n										    <div class="task-label">未完成(延期/按期)</div>\n										</li>\n									 '),__p+="\n									 ",(0!=a.finishTaskDelayTotal||0!=a.finishTaskOnTimeTotal)&&(__p+='\n										<li class="chart-data-item">	\n										    <div class="task-value"><span class="task-count">'+__e(a.finishTaskDelayTotal+a.finishTaskOnTimeTotal)+'</span>(<span class="delay-color">'+__e(a.finishTaskDelayTotal)+"</span>/"+__e(a.finishTaskOnTimeTotal)+')</div>\n										    <div class="task-label">已完成(延期/按期)</div>\n										</li>\n									 '),__p+="\n								"),__p+='\n								<li class="chart-data-item">	\n								    <div class="task-value"><span class="task-count">'+__e(a.evaluateScore)+"</span>("+__e(a.evaluatePercent)+')</div>\n								    <div class="task-label">质量均分</div>\n								</li>\n							</ul>\n						    '),__p+="\n						</div>\n					"),__p+="\n				</li>\n			")}),__p+='\n		</ul>\n	</div>\n	\n	<div class="show-detail">\n		',__p+=viewChart?'\n		<a href="javascript:void(0)" class="show-more">收起详情<span class="icon icon-arrow-up"></span></a>\n		':'\n		<a href="javascript:void(0)" class="show-more">展开详情<span class="icon icon-arrow-down"></span></a>\n		',__p+="\n	</div>\n</div>";return __p},this.JST["work/implementation/report-work"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="search-condition">\n	<div data-name="report-filter-component"></div>\n	<div class="report_label">\n		<a class="btn btn-sure" data-name="work-chart" href="javascript:void(0);">生成项目执行图表</a>\n		<a class="btn btn-sure" data-name="work-gant" href="javascript:void(0);" >生成项目甘特图</a>\n	</div>\n</div>\n<div class="legend-info" style="display:none;">\n	<span class="legend-tip">图例说明？</span>\n	<div class="legend-info-tip" style="display:none;">\n		<ul class="legend-list">\n			<li><div class="legend-border"><div class="legend-1">&nbsp;</div></div>未完成-延期</li>\n			<li><div class="legend-border"><div class="legend-2">&nbsp;</div></div>未完成-当前</li>\n			<li><div class="legend-border"><div class="legend-3">&nbsp;</div></div>已完成-按期</li>\n			<li><div class="legend-border"><div class="legend-4">&nbsp;</div></div>已完成-延期</li>\n			<li><div class="legend-border"><div class="legend-5">&nbsp;</div></div>未开始</li>\n		</ul>\n	</div>\n</div>\n<div data-name="report-chart" class="report_chart_container">\n</div>\n';return __p},this.JST["work/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<!-- side sub nav -->\n<div class="tu-col-3" data-tu-submenu="tu-submenu">\n	<div class="tu-col-container"  id="work_left_view"></div>\n</div>\n<!-- side sub nav end -->\n<div  class="work-container tu-col-13">\n	<div class="tu-col-container"  id="work_main_region">\n		<div class="_tt_loading_m" >努力加载中…</div>	\n	</div>	\n</div>\n<div class="tt_plan_detail_container"></div>';return __p},this.JST["work/member-composite"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class=" project_member_container  ">\r\n	<div class="project_member_container_title">\r\n		成员\r\n		<a class="project_member_count" href="javascript:;"><span>'+(null==(__t=MembersCount)?"":__t)+'</span>个人</a>\r\n	</div>\r\n	\r\n	<div class="project_member_container_responsible">\r\n		<div class="project_member_item_info_container">\r\n\r\n			<a href="'+(null==(__t=Principal.HomeUrl)?"":__t)+'">\r\n				'+(null==(__t=_.convertImage({className:"project_member_item_img",src:Principal.Avatar.Medium,size:50,name:Principal.Name,bgColor:Principal.Avatar.Color}))?"":__t)+'\r\n			</a>\r\n			<div  class="project_member_item_info">\r\n				<div class="project_member_item_info_name">'+(null==(__t=_.substringWithM(Principal.Name,12,!0))?"":__t)+"（负责人）</div>\r\n				",isShowDeliver&&(__p+='\r\n				<div class="project_member_item_info_oper remove_response">转交</div>\r\n				'),__p+='\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="project_member_list_parent clearfix">\r\n		',1!=Status||1!=IsParticipate&&1!=IsPrincipal&&!IsCreator&&!IsManage||2!=ApplyState&&0!=ApplyState?IsApplyUser&&2==ApplyState&&1==Status&&(__p+='\r\n			<div class="project_member_add">\r\n				<a class="member_add_big" href="javascript:;" original-title="添加成员">\r\n					<span></span>\r\n				</a>\r\n			</div>\r\n		'):__p+='\r\n			<div class="project_member_add">\r\n				<a class="member_add_big" href="javascript:;" original-title="添加成员">\r\n					<span></span>\r\n				</a>\r\n			</div>\r\n		',__p+='\r\n		<ul class="project_member_container_list" id="project_member_list">\r\n			\r\n		</ul>\r\n	</div>\r\n</div>\r\n	';return __p},this.JST["work/member-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='\r\n<a href="javascript:void(0)">'+(null==(__t=_.convertImage({className:"project_member_item_img",src:Avatar.Medium,size:50,name:Name,bgColor:Avatar.Color}))?"":__t)+'</a>\r\n<div  class="project_member_item_info">\r\n	<div class="project_member_item_info_name" title='+(null==(__t=Name)?"":__t)+">"+(null==(__t=shortName)?"":__t)+"</div>\r\n	\r\n	",1!=Status||1!=IsParticipate&&1!=IsPrincipal&&!IsCreator&&!IsManage||UserId==LoginUser||"member"!=Type||2!=ApplyState&&0!=ApplyState?1!=Status||1!=IsParticipate&&1!=IsPrincipal&&!IsCreator&&!IsManage||"follower"!=Type||2!=ApplyState&&0!=ApplyState||(__p+='\r\n		<div class="project_member_item_info_oper  remove_member">删除</div>\r\n	'):__p+='\r\n		<div class="project_member_item_info_oper  remove_member">删除</div>\r\n	',__p+="\r\n	",2==ApplyState&&IsApplyUser&!IsManage&&1==Status&&(__p+='\r\n		<div class="project_member_item_info_oper  remove_member">删除</div>\r\n	'),__p+="\r\n</div>\r\n\r\n";return __p},this.JST["work/member-layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="member_container"></div>\n<div class="follower_container"></div>';return __p},this.JST["work/mile-tab-item"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<span class="border '+(null==(__t=2==status||3==status?"ing":4==status?"done":"")?"":__t)+'">\n</span>\n<span class="top-icon icon-'+(null==(__t=2==status||3==status?"blue":4==status?"green":"dark")?"":__t)+'-triangle-down">\n</span>\n<div class="bottom '+(null==(__t=activeMile.mileStoneId==mileStoneId?"active":"")?"":__t)+'" data-name="tab" data-id="'+(null==(__t=mileStoneId)?"":__t)+'">\n	<div class="mile-name '+(null==(__t=2==status||3==status?"ing":4==status?"done":"")?"":__t)+'" original-title="'+__e(mileStoneName)+'">里程碑'+(null==(__t=index+1)?"":__t)+'</div>\n	<div class="mile-date">'+(null==(__t=_handleDate(endDate))?"":__t)+"</div>\n	",activeMile.mileStoneId==mileStoneId&&(__p+='\n		<span class="icon icon-blue-triangle-top"></span>\n	'),__p+="\n</div>\n	\n";return __p},this.JST["work/mile-tab"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="mile-tab-wraper">\n	<span class="icon-arrow-left" data-name="pre" original-title="返回"></span>\n	<span class="icon-arrow-right '+(null==(__t=length>6?"active":"")?"":__t)+'" data-name="next"  original-title="查看更多"></span>\n	<div class="project-start">\n		<span class="top-icon icon-green-triangle-down"></span>\n		<div class="mile-name">项目开始</div>\n		<div class="mile-date">'+(null==(__t=_handleDate(StartDate))?"":__t)+'</div>\n	</div>\n	<div class="mile-tab">\n		\n		\n	</div>\n	<div class="no-class '+(null==(__t=0==activeMile.mileStoneId?"active":"")?"":__t)+'" data-id="0"  data-name="tab" original-title="未设置里程碑的其他任务" >\n		<div class="mile-name">其他任务</div>\n		',0==activeMile.mileStoneId&&(__p+='\n			<span class="icon icon-blue-triangle-top"></span>\n		'),__p+='\n	</div>\n</div>\n	\n<div class="mile-detail">\n	',0!=activeMile.mileStoneId?(__p+='\n		<div class="avator">\n			'+(null==(__t=_.convertImage({className:"icon",src:activeMile.user.Avatar.Medium,size:30,shape:"radius",name:activeMile.user.Name,bgColor:activeMile.user.Avatar.Color}))?"":__t)+'\n		</div>\n		<div class="milepost-left">\n			<div class="name"><strong>'+(null==(__t=activeMile.mileStoneName)?"":__t)+"</strong></div>\n\n			\n		",__p+=activeMile.taskTotal>0?'\n			<div class="percent">\n			完成度： <span class="num">\n'+(null==(__t=activeMile.finishTaskTotal)?"":__t)+"/"+(null==(__t=activeMile.taskTotal)?"":__t)+"(<strong>"+(null==(__t=Number((100*activeMile.finishTaskTotal/activeMile.taskTotal).toFixed(1)))?"":__t)+"%</strong>)\n		</span>	\n		</div>\n		":'\n			<div class="noTask">暂无任务</div>\n		',__p+='\n				\n			\n		</div>\n		<div class="milepost-right">\n			<span class="status">\n				',1==activeMile.status?__p+="\n					<strong>未开始</strong>\n				":2==activeMile.status?__p+='\n					<span class="ing">剩余<span class="num">'+(null==(__t=activeMile.remainingDays)?"":__t)+"</span>天</span>\n				":3==activeMile.status?__p+='\n					<span class="warn"><strong>已过期</strong></span>\n				':4==activeMile.status&&(__p+="\n					<strong>已完成</strong>\n				"),__p+='\n			</span>\n			<span data-name="date" class="date ">\n				('+(null==(__t=_handleDate(activeMile.startDate))?"":__t)+"-"+(null==(__t=_handleDate(activeMile.endDate))?"":__t)+")\n			</span>\n		</div>\n	"):__p+='\n		<div class="avator">\n			<span class="radius_img30" style="background-color:#c5c5c5;" >其他</span>\n		</div>\n		<div class="milepost-left">\n			<div class="name">未设置里程碑的其他任务</div>\n		</div>\n	',__p+="\n</div>";
return __p},this.JST["work/permission-prevent/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="contenter">\r\n        <div class="contenterwrapper">\r\n            <div class="noaccess clearfix">\r\n                    <div class="img_na">\r\n                    </div>\r\n                <div class="text_ma">\r\n                    <div class="workhi_tma">\r\n                           <div class="font_title28">\r\n                                    '+(null==(__t=Message)?"":__t)+'\r\n                            </div>\r\n                    </div>\r\n                        <div class="reason_tma">\r\n                        </div>\r\n                    <div class="return_tma">\r\n			 <p><a href="/u/100126934/Home" class="click_rtma" target="_top">返回首页</a>  或 关闭该页面</p>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>';return __p},this.JST["work/project-create"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+="<dl>\n	<dt><span>*</span>"+(null==(__t=i18n.work_1)?"":__t)+'名称</dt>\n	<dd class="no-margin">\n		<div class="tu-input-default">\n			<label for="project-create-name" class="placeholder" data-name="project-name-placeholder">项目名称最多50个字</label>\n			<textarea id="project-create-name" data-name="project-name"></textarea>\n		</div>\n		<p class="error-tip-wrap">\n			<span class="error-tip" data-name="name-error-tip">项目名称最多可输入50个汉字！</span>\n		</p>\n	</dd>\n</dl>\n<dl>\n	<dt>起止时间</dt>\n	<dd>\n		<div data-name="set-date" class="tu-input-default set-date">\n			'+(null==(__t=startDate)?"":__t)+"-"+(null==(__t=endDate)?"":__t)+'\n		</div>\n	</dd>\n</dl>\n<dl>\n	<dt>负责人</dt>\n	<dd>\n		<div class="tu-input-default">\n			<div data-name="set-principal">\n				<a href="javascript:;">\n					'+(null==(__t=_.convertImage({className:"radius_img30",src:loginInfo.Avatar,size:30,shape:"radius",name:loginInfo.Name,bgColor:loginInfo.UserAvatar.Color}))?"":__t)+"\n					"+(null==(__t=_.substring(loginInfo.Name,8,!0))?"":__t)+"\n				</a>\n			</div>\n		</div>	\n	</dd>\n</dl>\n<dl>\n	<dt>"+(null==(__t=i18n.work_1)?"":__t)+'成员</dt>\n	<dd>\n		<div class="tu-input-default">\n			<a href="javascript:;" class="user-add-btn" data-name="set-participator">\n				<span class="tu-icon-add"></span>\n			</a>\n			<ul class="user-list" data-name="user-list-wrap"></ul>\n		</div>\n	</dd>	\n</dl>\n<dl>\n	<dt>审批人</dt>\n	<dd>\n		<div class="tu-input-default okr-obj-cont">\n			<a href="javascript:;" class="user-add-btn" data-name="set-approval">\n				<span class="tu-icon-add"></span>\n			</a>\n		</div>\n	</dd>	\n</dl>\n<dl>\n	<dt>'+(null==(__t=i18n.work_1)?"":__t)+'目标</dt>\n	<dd class="no-margin">\n		<div class="tu-input-default">\n			<textarea id="project-create-description" data-name="project-description"></textarea>\n		</div>\n		<p class="error-tip-wrap">\n			<span class="error-tip" data-name="des-error-tip">已输入<span data-name="txt-total"></span>字，最多可输入5000个汉字！</span>\n		</p>\n	</dd>\n</dl>\n<dl>\n	<dt>可见范围</dt>\n	<dd>\n		<div class="raido">\n			<a href="javascript:;" class="icon-singlebox tu-icon-singlebox-avtive"></a>\n			私密&nbsp;&nbsp;\n			<a href="javascript:;" class="icon-singlebox tu-icon-singlebox-have"></a>\n			公开\n		</div>\n	</dd>\n</dl>';return __p},this.JST["work/project-custom-detail-layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="_tt_loading_m" data-name="page-loading">努力加载中…</div>\n<div data-name="frame-box"></div>';return __p},this.JST["work/project-custom-sidebar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_project_custom_sidebar">\n	<dl class="basic_pcs">\n		<dt><span class="title_pcs">'+(null==(__t=WorkName)?"":__t)+"</span>  \n			",IsEdit&&(__p+='<a href="#work?work_id='+(null==(__t=WorkId)?"":__t)+'&edit=true">Edit</a>'),__p+="\n		</dt>\n		<dd>Responsible:"+(null==(__t=Principal.Name)?"":__t)+"</dd>\n		<dd>Team:"+(null==(__t=DepartmentName)?"":__t)+"</dd>\n		<dd>Type:"+(null==(__t=LableName)?"":__t)+"</dd>\n		<dd>Exploring Start Date:"+(null==(__t=StartDate)?"":__t)+'</dd>\n	</dl>\n\n	<div class="_tt_side_subnav">\n		<ul class="worklist_sidenav">\n			',_.each(LableTypes,function(a){__p+='\n			<li>\n				<a title="'+(null==(__t=a.Name)?"":__t)+'" data-trigger="false" class="worknavlist_wlsn" href="'+(null==(__t=a.Url)?"":__t)+'">\n					<i class="name_wlsn">'+(null==(__t=a.Name)?"":__t)+"</i>\n				</a>\n			</li>\n			"}),__p+="\n		</ul>\n	</div>\n</div>";return __p},this.JST["work/project-detail-layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div id="project_detail_tab_container"></div>\r\n<div class="project_detail_content" id="project_detail_region"><div class="_tt_loading_m">努力加载中…</div></div>';return __p},this.JST["work/project-detail-top-item-date-bak"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<!-- 有长期 -->\r\n<div class="project_detail_time clearfix">\r\n	<span class="time_icon"></span>\r\n	<div class="project_time_item">\r\n		',longTerm?__p+="\r\n			<span>长期项目</span>\r\n		":(__p+='\r\n			<span class="time_begin time_span" text-origion="何时开始">\r\n				'+(null==(__t=startDate)?"":__t)+'\r\n			</span> \r\n			<span class="time_split">...</span> \r\n			<span class="time_end time_span" text-origion="何时结束">\r\n				'+(null==(__t=endDate)?"":__t)+"\r\n			</span>\r\n			",__p+=1==IsDeadLine?'\r\n				<span class="overdue">已到期</span>\r\n			':'\r\n				<a class="time_expire" href="javascript:;">剩余<span class="count"> '+(null==(__t=ExpireDay)?"":__t)+" </span>天</a>\r\n			",__p+="\r\n		"),__p+="\r\n		",1==IsCreater&&1==Status&&(__p+='\r\n			<span class="time_operate">调整</span>\r\n		'),__p+="\r\n	</div>\r\n</div>\r\n",1==IsCreater&&1==Status&&(__p+='\r\n<div class="project_detail_time project_detail_time_edit clearfix">\r\n	<span class="time_icon"></span>\r\n	<div class="project_time_item">\r\n		<a class="radio_item radio_item1" href="javascript:;">\r\n			<span data-type="short_term" class="radio_blue"></span>\r\n			<span class="time_begin time_span" text-origion="何时开始" type="StartDate">'+(null==(__t=startDate)?"":__t)+'</span> <span type="DeadLine" class="time_split">...</span> <span class="time_end time_span" type="EndDate" text-origion="何时结束">'+(null==(__t=endDate)?"":__t)+'</span>\r\n		</a>\r\n		<a class="radio_item radio_item2"  href="javascript:;">\r\n			<span data-type="long_term" class="radio_blue"></span>\r\n			<span class="long_term">长期项目</span>\r\n		</a>\r\n	</div>\r\n	<div class="project_btn_group" style="display:none">\r\n		<a class="btn_blue " type="time" href="javascript:;">确定</a>\r\n		<a class="btn_white " type="time"  href="javascript:;">取消</a>\r\n	</div>\r\n</div>\r\n');return __p},this.JST["work/project-detail-top-item-date"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)IsManage&&2!=Status&&(0==ApplyState||2==ApplyState)||IsEdit?(__p+='\n<div class="project_time_item project_detail_time_edit">\n	<span class="time_begin time_span" text-origion="何时开始">\n		'+(null==(__t=startDate)?"":__t)+'\n	</span> \n	<span class="time_split time_split_img"></span> \n	<span class="time_end time_span" text-origion="何时结束">\n		',__p+=endDate?"\n			"+(null==(__t=endDate)?"":__t)+"\n		":"\n			长期\n		",__p+="\n	</span>\n	",2==Status?__p+='\n		<span class="long">已完成</span>\n	':1==IsDeadLine&&2!=WorkType?__p+='\n		<span class="overdue">已过期'+(null==(__t=ExpireDay)?"":__t)+"天</span>\n	":ExpireDay&&2!=WorkType&&(__p+='\n		<a class="time_expire" href="javascript:;">剩余<span class="count"> '+(null==(__t=ExpireDay)?"":__t)+" </span>天</a>\n	"),__p+="\n</div>\n"):(__p+='\n<div class="project_time_item">\n	<span class="time_begin time_span_no_edit" text-origion="未设置开始">\n		'+(null==(__t=startDate)?"":__t)+'\n	</span> \n	<span class="time_split time_split_img"></span> \n	<span class="time_end time_span_no_edit" text-origion="未设置结束">\n		',__p+=endDate?"\n			"+(null==(__t=endDate)?"":__t)+"\n		":"\n			长期\n		",__p+="\n	</span>\n	",3!=ApplyState&&(__p+="\n		",2==Status?__p+='\n			<span class="long">已完成</span>\n		':1==IsDeadLine&&2!=WorkType?__p+='\n			<span class="overdue">已过期'+(null==(__t=ExpireDay)?"":__t)+"天</span>\n		":ExpireDay&&2!=WorkType&&(__p+='\n			<a class="time_expire" href="javascript:;">剩余<span class="count"> '+(null==(__t=ExpireDay)?"":__t)+" </span>天</a>\n		"),__p+="\n	"),__p+="\n</div>\n"),__p+="\n";return __p},this.JST["work/project-detail-top-item-tag"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="project_tag_item clearfix">\n	<span id="add_tag" class="add_tag" data-name="add-tag"></span>\n	<div class="tag_container" data-name="tag-container"></div>\n</div>';return __p},this.JST["work/project-detail-top-item"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj){if(__p+='<div class="project_detail_top clearfix">\r\n	',ApplyState&&(__p+='\r\n		<span class="',1==ApplyState?__p+="icon-under-approval-i":3==ApplyState&&(__p+="icon-rejected-i"),__p+='"></span>\r\n	'),__p+='\r\n	<div class="'+(null==(__t=203==routerData.appType?"icon-position-big":"icon-project-detail-title")?"":__t)+'">\r\n	</div>\r\n	<div class="project_detail_top_right">\r\n		<div class="btn-list-container">\r\n		</div>\r\n	</div>\r\n\r\n	<div class="project_detail_top_left">\r\n		<div class="project_detail_title">\r\n			',__p+=IsManage&&2!=Status&&(0==ApplyState||2==ApplyState)||IsEdit&&2!=Status?'\r\n			<textarea style="resize:none;" class="project_detail_title_type input_container" data-type="WorkName" >'+(null==(__t=WorkName)?"":__t)+'</textarea>\r\n			<div class="project_btn_group">\r\n				<a class="btn_blue " href="javascript:;">确定</a>\r\n				<a class="btn_white " href="javascript:;">取消</a>\r\n			</div>\r\n			':'\r\n			<div class="project_detail_title_type">'+__e(WorkName)+"</div>\r\n			",__p+='\r\n		</div>\r\n		<div class="project_detail_description clearfix detail-mode" ',"simple"==viewMode&&(__p+='style="display:none;"'),__p+=">\r\n			",IsManage&&2!=Status&&(0==ApplyState||2==ApplyState)||EditDescription&&2!=Status?(__p+="\r\n				","402"==routerData.appId&&"402"==routerData.appType?(__p+='\r\n					<textarea style="resize:none;"  class="project_detail_description_type input_container" text-origion="添加衡量标准"  data-type="Descripition">',__p+=""==Descripition||null==Descripition?"添加衡量标准":null==(__t=Descripition)?"":__t,__p+="</textarea>\r\n				"):(__p+='\r\n					<textarea  style="resize:none;" class="project_detail_description_type input_container" text-origion="添加目标"  data-type="Descripition">',__p+=""==Descripition||null==Descripition?"添加目标":null==(__t=Descripition)?"":__t,__p+="</textarea>\r\n				"),__p+='	\r\n				<div class="project_btn_group">\r\n					<a class="btn_blue " href="javascript:;">确定</a>\r\n					<a class="btn_white " href="javascript:;">取消</a>\r\n				</div>\r\n			'):(__p+='\r\n				<div class="project_detail_description_type">\r\n					',""==Descripition||null==Descripition?(__p+="\r\n						",__p+="402"==routerData.appId&&"402"==routerData.appType?"\r\n						<pre>未设置衡量标准</pre>\r\n						":"\r\n						<pre>未设置目标</pre>\r\n						",__p+="\r\n					"):__p+="\r\n						<pre>"+__e(Descripition)+"</pre>\r\n					",__p+="	\r\n				</div>\r\n			"),__p+='\r\n		</div>\r\n		<div data-name="work-extra-info"></div>\r\n		<ul class="project_detail_attr clearfix">\r\n			<li class="project_detail_tag">\r\n				<span class="label_title"><span class="icon icon-task-tag"></span>标签</span>\r\n				<div class="project_tag_container"></div>\r\n			</li>\r\n			<li class="project_detail_time">\r\n				<span class="label_title"><span class="icon icon-task-during"></span>起止时间</span>\r\n				<span class="project_time_container"></span>\r\n			</li>\r\n			<li class="project_detail_progress">\r\n				<span class="label_title"><span class="icon icon-task-progress"></span>进度</span>\r\n				<span class="item_value">\r\n					  <div class="progress_all">\r\n							<div  class="progress_bar" style="width:'+(null==(__t=Progress)?"":__t)+';">\r\n								<span class="split" ',"0%"==Progress&&(__p+='style="background:#eeeeee"'),__p+="></span>\r\n							</div>\r\n		    		  </div>\r\n				</span>\r\n		\r\n				",IsManage&&2!=Status&&(0==ApplyState||2==ApplyState)||EditDescription&&2!=Status?__p+='\r\n					<span class="item_operate">\r\n					    <input class="project_detail_progress_type input_container"  data-type="Progress" value="'+(null==(__t=Progress)?"":__t)+'" />\r\n					    <div class="project_btn_group">\r\n							<a class="btn_blue " href="javascript:;">确定</a>\r\n							<a class="btn_white " href="javascript:;">取消</a>\r\n						</div>\r\n					 </span>\r\n				':(__p+="\r\n					",3!=ApplyState&&(__p+='\r\n			    	<span class="item_operate">\r\n			    		<div class="project_detail_progress_type">'+(null==(__t=Progress)?"":__t)+"</div>\r\n			    	</span>\r\n			    	"),__p+="\r\n				"),__p+='\r\n			</li>\r\n			<li class="project_detail_top_responsible detail-mode" ',"simple"==viewMode&&(__p+='style="display:none;"'),__p+='>\r\n				<span class="label_title"><span class="icon icon-task-creater"></span>负责人</span>\r\n				<span class="item_value">'+(null==(__t=PrincipalName)?"":__t)+"</span>\r\n				",isShowEditApproval&&(__p+='\r\n				<span class="item_operate">\r\n					',(2==ApplyState&&(IsApplyUser||IsPrincipal||IsManage)&&1==Status||0==ApplyState&&(IsPrincipal||IsCreator||IsManage)&&1==Status)&&(__p+='\r\n						<a href="javascript:void(0);" class="deliver" data-name="approval">转交</a>\r\n					'),__p+="\r\n				</span>\r\n				"),__p+='\r\n			</li>\r\n			<li class="project_detail_top_visiable detail-mode" ',"simple"==viewMode&&(__p+='style="display:none;"'),__p+='>\r\n				<span class="label_title"><span class="icon icon-task-visible"></span>可见范围</span>\r\n				',__p+=1==IsVisible?'\r\n				    <span class="item_value">公开</span>\r\n				':'\r\n				<span class="item_value">私密</span>\r\n				',(IsManage&&2!=Status&&(0==ApplyState||2==ApplyState)||(IsPrincipal||IsCreator||IsApplyUser)&&3!=ApplyState&&EditVisible)&&(__p+='\r\n				  <span class="item_operate">\r\n				  	<a class="authority" href="javascript:;"\r\n				  	 data-handler="Range">修改</a>\r\n                    <ul class="dropdown_range" style="display:none;">\r\n						<li data-type="2" class="'+(null==(__t=2==IsVisible?"active":"")?"":__t)+'">\r\n							<a href="javascript:;">\r\n								<span class="icon-checkbox '+(null==(__t=2==IsVisible?"tu-icon-check-active":"tu-icon-checkbox-have")?"":__t)+'"></span>\r\n								<!-- <span class="check"></span> -->\r\n								<span class="icon-locked"></span>\r\n								<span class="type">私密</span>\r\n								<span class="txt">仅项目成员可见</span>\r\n							</a>\r\n						</li>\r\n						<li data-type="1"  class="'+(null==(__t=1==IsVisible?"active":"")?"":__t)+'">\r\n							<a href="javascript:;">\r\n								<span class="icon-checkbox '+(null==(__t=1==IsVisible?"tu-icon-check-active":"tu-icon-checkbox-have")?"":__t)+'"></span>\r\n								<!-- <span class="check"></span> -->\r\n								<span class="icon-unlocked"></span>\r\n								<span class="type">公开</span>\r\n								<span class="txt">所有人可见</span>\r\n							</a>\r\n						</li>\r\n					</ul>\r\n				  </span>\r\n				'),__p+="\r\n			</li>\r\n			",ApplyUser&&(__p+='\r\n			<li class="project_detail_top_applyuser detail-mode" ',"simple"==viewMode&&(__p+='style="display:none;"'),__p+='>\r\n				<span class="label_title"><span class="icon icon-task-apply"></span>审批人</span>\r\n				<span class="item_value">'+__e(ApplyUserName)+"</span>\r\n			</li>\r\n			"),__p+="\r\n			",__p+="simple"==viewMode?'\r\n			<a href="javascript:void(0);" class="show-more">\r\n				展开<span class="icon icon-arrow-down-double"></span>\r\n			</a>\r\n			':'\r\n			<a href="javascript:void(0);" class="show-more">\r\n				收起<span class="icon icon-arrow-up-double"></span>\r\n			</a>\r\n			',__p+='\r\n		</ul>\r\n	</div>\r\n</div>\r\n<textarea id="text" style="position:absolute;top: -1000px;"></textarea>\r\n<ul class="project_detail_nav clearfix" data-name="tab-nav">\r\n	',2==ApplyState||0==ApplyState){__p+="\r\n		";for(var i=0,len=usedNav.length;len>i;i++){__p+="\r\n			";var temp=usedNav[i],name=temp.name;__p+='\r\n			<li>\r\n			<a class="clearfix" data-trigger="false" href="'+(null==(__t=temp.url)?"":__t)+'">\r\n				'+(null==(__t=name)?"":__t)+"\r\n				","文件"==name&&(__p+="&nbsp;&nbsp;"+(null==(__t=AttachmentTotal)?"":__t)),__p+="\r\n				","人员"==name&&(__p+="&nbsp;&nbsp;"+(null==(__t=MembersTotal)?"":__t)),__p+="\r\n			</a>\r\n			</li>\r\n		"}__p+="\r\n	"}else{__p+="\r\n		";for(var i=0,len=usedNav.length;len>i;i++){__p+="\r\n			";var temp=usedNav[i],name=temp.name;__p+="\r\n			","人员"==name||"操作记录"==name?(__p+='\r\n				<li>\r\n				<a class="clearfix" data-trigger="false" href="'+(null==(__t=temp.url)?"":__t)+'">\r\n					'+(null==(__t=name)?"":__t)+"\r\n					","文件"==name&&(__p+="&nbsp;&nbsp;"+(null==(__t=AttachmentTotal)?"":__t)),__p+="\r\n					","人员"==name&&(__p+="&nbsp;&nbsp;"+(null==(__t=MembersTotal)?"":__t)),__p+="\r\n				</a>\r\n				</li>\r\n			"):__p+='\r\n				<li class="disabled">\r\n					<span>'+(null==(__t=name)?"":__t)+"</span>\r\n				</li>\r\n	    	",__p+="\r\n		"}__p+="\r\n	"}__p+="\r\n</ul>\r\n"}return __p},this.JST["work/project-list-composite-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+="<td>\r\n    <a ",dataTrigger&&(__p+='data-trigger="false"'),__p+=" ",targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'" class="list-item-name" data-name="project-name">\r\n        \r\n        ',1==approvalStatus?__p+='\r\n            <span class="icon-approval"></span>\r\n        ':3==approvalStatus&&(__p+='\r\n            <span class="icon-reject"></span>\r\n        '),__p+="\r\n        \r\n        "+(null==(__t=workName)?"":__t)+"\r\n        \r\n    </a>\r\n    ",showTags&&(__p+='\r\n    <div style="display: inline;">\r\n        ',_.each(tags,function(a){__p+='\r\n        <div class="tt-tag-container" data-name="tag" original-title="查看 '+(null==(__t=a.tagName)?"":__t)+' 下所有工作事项">\r\n            <a href="#work/tag?relation=1&tagId='+(null==(__t=a.id)?"":__t)+"&tagName="+(null==(__t=a.tagName)?"":__t)+'">\r\n        		<div class="tag-wrap clearfix be-check">\r\n        			<div class="tag-main color'+(null==(__t=a.color)?"":__t)+'">\r\n        				<span class="text">'+(null==(__t=a.tagName)?"":__t)+"</span>\r\n        			</div>\r\n        		</div>\r\n            </a>\r\n        </div>\r\n        "}),__p+="\r\n    "),__p+="\r\n    ",counter.taskTotal&&(__p+='\r\n    <div class="total-box">\r\n    <a ',targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'&detail_type=task">\r\n    <span class="icon tu-icon-task" original-title="任务数" data-name="icon-task"></span>\r\n    <span class="trendTotal">'+(null==(__t=counter.finishTaskTotal)?"":__t)+"/"+(null==(__t=counter.taskTotal)?"":__t)+"</span>\r\n    </a>\r\n    </div>\r\n    "),__p+="\r\n    ",counter.trendTotal&&(__p+='\r\n    <div class="total-box">\r\n    	<a ',targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'&detail_type=feed" >\r\n            <span class="icon-indicate">\r\n                <span class="icon tu-icon-talk" original-title="沟通数" data-name="icon-talk"></span>\r\n                <span class="trendTotal">'+(null==(__t=counter.trendTotal)?"":__t)+"</span>\r\n            </span>\r\n    	</a>\r\n    </div>\r\n    "),__p+=' \r\n    </div>\r\n</td>\r\n<td class="no-break" style="',__p+=3==approvalStatus?"color:#ACB7BF;":"color:"+(null==(__t=statusColor)?"":__t),__p+='"><span class="cursor-default" data-name="project-time" original-title="起止时间：'+(null==(__t=startDate)?"":__t)+"-"+(null==(__t=endDate)?"":__t)+'">'+(null==(__t=dateContent)?"":__t)+"</span></td>\r\n\r\n",1==approvalStatus?__p+='\r\n    <td class="no-break" style="color:#EE4344">\r\n        '+(null==(__t=_.convertImage({className:"cursor-default",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,bgColor:principalUser.avatar.color}))?"":__t)+"\r\n        "+(null==(__t=principalUser.name)?"":__t)+"\r\n    </td>\r\n":(__p+="\r\n    ",__p+=3==approvalStatus&&1==routerData.relation&&UserId==principalUser.userId||3==approvalStatus&&0==routerData.relation?'\r\n    <td class="no-break posRe" style="color:#ACB7BF">\r\n        <span class="dialog-area" style="position: relative"></span>\r\n        <span class="status-btn-warp">\r\n            <button type="button" class="tu-btn tu-btn-mini" data-name="del">删除</button>\r\n            <a href="#work?work_id='+(null==(__t=workId)?"":__t)+'&create=true">\r\n                <button type="button" class="tu-btn tu-btn-mini tu-btn-sure">重新创建</button>\r\n            </a>\r\n        </span>\r\n        <span class="status-name">\r\n        '+(null==(__t=_.convertImage({className:"cursor-default",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,bgColor:principalUser.avatar.color}))?"":__t)+"\r\n        "+(null==(__t=principalUser.name)?"":__t)+"\r\n        </span>\r\n    </td>    \r\n    ":'\r\n    <td class="no-break posRe" style="color:'+(null==(__t=3==approvalStatus?"#ACB7BF":"")?"":__t)+'">\r\n        '+(null==(__t=_.convertImage({className:"cursor-default",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,bgColor:principalUser.avatar.color}))?"":__t)+"\r\n        "+(null==(__t=principalUser.name)?"":__t)+"\r\n    </td>\r\n    ",__p+="\r\n"),__p+="\r\n\r\n\r\n\r\n\r\n\r\n";return __p},this.JST["work/project-list-composite"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="tu-table">\r\n	<table>\r\n		<colgroup>\r\n			<col span="1" width="70%"></col>\r\n			<col span="1" width="15%"></col>\r\n			<col span="1" width="15%"></col>\r\n		</colgroup>\r\n		<thead>\r\n			<tr>\r\n				<th>名称</th>\r\n				<th>截止日期</th>\r\n				<th>负责人</th>\r\n			</tr>\r\n		</thead>\r\n		<tbody></tbody>\r\n	</table>\r\n</div>';return __p},this.JST["work/project-list-main-screen"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<li class="screen-item" data-name="status">\n	<span class="name">进行中</span><span class="icon tu-icon-sort-down"></span>\n</li>\n',1!=routerData.relation&&(__p+='\n<li class="screen-item" data-name="select">\n	<span class="name">负责人</span><span class="icon tu-icon-sort-down"></span>\n</li>\n'),__p+='\n<li class="screen-item" data-name="sort">\n	<span class="name">排序</span><span class="icon tu-icon-sort-down"></span>\n</li>\n\n',4==routerData.relation&&(__p+='\n<!-- <li class="screen-item" data-name="search-btn">\n	<span class="tu-icon-search"></span>\n</li> -->\n<li data-name="project-search" style="float: right;line-height: 1px;"></li>\n'),__p+="\n",1!=routerData.relation||203==routerData.app_id&&203==routerData.app_type||(__p+='\n<li class="screen-item" data-name="approvalK" style="float: right;">\n	<a href="#more/apply?name=work&amp;delindicator=WorkSuperApply" class="project-approval">\n		项目审批 \n		<span class="icon-arrow-right-2t"></span>\n	</a>\n</li>\n'),__p+="\n";return __p},this.JST["work/project-list-main-user-history-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+=(null==(__t=name)?"":__t)+'\n<span class="tu-icon-cross" data-name="delete-item"></span>';return __p},this.JST["work/project-list-main-user-history"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<ul data-name="list-container"></ul>\n<a href="javascript:;" data-name="clear" class="clear-btn">清除搜索条件</a>';return __p},this.JST["work/project-list-main"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="project_list_top_container">\n	<div class="tu-container-title ">\n	  	<h2 class="h2">'+(null==(__t=title)?"":__t)+"</h2>\n	  	",isShowCretae&&(__p+='\n	  	<!-- <button class="tu-btn tu-btn-larger tu-btn-sure" data-name="project-create-btn"><a href="',__p+=isUseWork?"#work?create=true":"javascript:;",__p+='" style="color:#fff">新建项目</a></button> -->\n		  		<a href="#work?create=true" style="color:#fff"><button type="button" class="tu-btn tu-btn-larger tu-btn-sure" data-name="project-create-btn">新建项目</button></a>\n	  	'),__p+='\n	</div>\n</div>\n<div class="tt-work-project-list-container">\n	<div data-name="project-screen"></div>\n	<div data-name="user-history-warp"></div>\n	<div data-name="project-list"></div>\n	<div data-name="pagination"></div>\n</div>\n';return __p},this.JST["work/project-list-sidebar-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)_.each(data,function(a){__p+='\n	<li class="item-nav ',a.workId==routerData.work_id&&(__p+="active"),__p+='">\n		<a title="'+(null==(__t=a.workName)?"":__t)+'" data-trigger="false"  class="" title="" href="#work?relation='+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=a.workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'">\n			',__p+=value?null==(__t=Talent.Context.textMark(value,a.workName))?"":__t:null==(__t=a.workName)?"":__t,__p+="\n			",a.counter.indicateTotal>0&&a.counter.indicateTotal<99?__p+='\n			<span class="indicator_wlsn">'+(null==(__t=a.counter.indicateTotal)?"":__t)+"</span>\n			":a.counter.indicateTotal>99&&(__p+='\n			<span class="indicator_wlsn">99+</span>\n			'),__p+=" \n			",1==a.approvalStatus?__p+='\n				<span class="icon-approval"></span>\n			':3==a.approvalStatus&&(__p+='\n				<span class="icon-reject"></span>\n			'),__p+="\n\n		</a>\n	</li>\n"});return __p},this.JST["work/project-list-sidebar-search-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)_.each(data,function(a){__p+='\n	<li class="item-mn">\n		<a title="'+(null==(__t=a.workName)?"":__t)+'" data-trigger="false"  class="title-mn ',a.workId==routerData.work_id&&(__p+="active"),__p+='" title="" href="#work?relation='+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=a.workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'">\n			',__p+=value?null==(__t=Talent.Context.textMark(value,a.workName,{markColor:"#fe5042"}))?"":__t:null==(__t=a.workName)?"":__t,__p+="\n			",a.counter.trendTotal>0&&a.counter.trendTotal<99?__p+='\n			<span class="indicator_wlsn">'+(null==(__t=a.counter.trendTotal)?"":__t)+"</span>\n			":a.counter.trendTotal>99&&(__p+='\n			<span class="indicator_wlsn">N</span>\n			'),__p+=" \n			",a.IsApply&&(__p+='\n				<span class="icon-approval"></span>\n			'),__p+="\n		</a>\n	</li>\n"});return __p},this.JST["work/project-list-sidebar-v2"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+="<!-- ",!isShowSearch||203==routerData.appId&&203==routerData.appType||(__p+='\n	\n		<div class="input-default">\n			<a href="javascript:void(0);" data-name="search-form-btn" title="" class="button_sfl"><span  class="icon-search"></span></a>\n			<input type="text" data-name="search-form" placeholder="输入项目名称">\n		</div>\n		<span class="cancel hide" data-name="cancel">取消</span>\n	</div>\n'),__p+=' -->\n<div data-name="search-form-wrap"></div>\n<ul id="work_sidebar" class="tu-nav-sub" data-name="list-wraper">\n	',showTagManage&&(__p+='\n	<li class="item-mn">\n		<a href="#work/tag" class="title-mn">按标签查看</a>\n	</li>\n	'),__p+="\n	",!isShowImplement||203==routerData.appId&&203==routerData.appType||(__p+='\n	<li class="item-mn">\n		<a href="#work/implementation" class="title-mn">项目执行情况</a>\n	</li>\n	'),__p+='\n	<li class="item-mn" style="display:none"> \n		<a data-trigger="false" href="#work?relation=0&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+'">\n			<span class="un_mark_star mark_star"></span>星标\n		</a>\n		<ul class="worklist_sidenav">\n		</ul>\n	</li>\n	<li class="fold-item item-mn"> \n		<a data-trigger="false" href="#work?relation=1&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" data-name="respon-title" class="title-mn" >',__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+='负责的</a>\n		<span class="arrow-btn tu-icon-fontarrow-down"></span>\n		<ul class="worklist_sidenav sub-menu">\n			<!-- ',_.each(responsibleData,function(a){__p+='\n				<li class="item-nav">\n					<a title="'+(null==(__t=a.WorkName)?"":__t)+'" data-trigger="false"  class="worknavlist_wlsn" title="" href="#work?work_id='+(null==(__t=a.WorkId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'">\n						'+__e(a.WorkName)+"\n						",a.IndicateTotal>0&&a.IndicateTotal<99?__p+='\n						<span class="indicator_wlsn red-remind-num">'+(null==(__t=a.IndicateTotal)?"":__t)+"</span>\n						":a.IndicateTotal>99&&(__p+='\n						<span class="indicator_wlsn red-remind-num">99+</span>\n						'),__p+=" \n						",a.IsApply&&(__p+='\n							<span class="icon-approval"></span>\n						'),__p+="\n					</a>\n				</li>\n			"}),__p+=' -->\n		</ul>\n	</li>\n	<li class="fold-item item-mn"> \n		<a data-trigger="false" data-name="paticip-title" href="#work?relation=2&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" class="title-mn">',__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+='参与的</a>\n		<span class="arrow-btn tu-icon-fontarrow-down"></span>\n		<ul class="worklist_sidenav sub-menu">\n			<!-- ',_.each(paticipateData,function(a){__p+='\n				<li class="item-nav">\n					<a title="'+(null==(__t=a.WorkName)?"":__t)+'" data-trigger="false" class="worknavlist_wlsn" title="" href="#work?work_id='+(null==(__t=a.WorkId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'">\n						'+__e(a.WorkName)+"\n						",a.IndicateTotal>0&&a.IndicateTotal<99?__p+='\n						<span class="indicator_wlsn red-remind-num">'+(null==(__t=a.IndicateTotal)?"":__t)+"</span>\n						":a.IndicateTotal>99&&(__p+='\n						<span class="indicator_wlsn red-remind-num">99+</span>\n						'),__p+=" \n					</a>\n				</li>\n			"}),__p+=" -->\n		</ul>\n	</li>\n	",userId==routerData.to_user_id&&(__p+='\n	<li class="fold-item item-mn"> \n		<a data-trigger="false" data-name="follow-title" href="#work?relation=3&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'"  class="title-mn">我关注的</a>\n		<span class="arrow-btn tu-icon-fontarrow-down"></span>\n		<ul class="worklist_sidenav sub-menu">\n			<!-- ',_.each(followData,function(a){__p+='\n				<li class="item-nav">\n					<a title='+__e(a.WorkName)+' data-trigger="false" class="worknavlist_wlsn" title="" href="#work?work_id='+(null==(__t=a.WorkId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'">\n						'+__e(a.WorkName)+"\n						",a.IndicateTotal>0&&a.IndicateTotal<99?__p+='\n						<span class="indicator_wlsn red-remind-num">'+(null==(__t=a.IndicateTotal)?"":__t)+"</span>\n						":a.IndicateTotal>99&&(__p+='\n						<span class="indicator_wlsn red-remind-num">99+</span>\n						'),__p+=" \n					</a>\n				</li>\n			"
}),__p+=" -->\n		</ul>\n	</li>\n	"),__p+="\n	",!isShowOthers||203==routerData.appId&&203==routerData.appType||(__p+='\n	<li class="item-mn"> \n		<a href="#work?relation=4&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" class="title-mn">所有公开的</a>\n	</li>\n	'),__p+="\n</ul>";return __p},this.JST["work/project-list-sidebar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div data-name="search-form-wrap" class="search-form-wrap"></div>\r\n<ul id="work_sidebar" class="tu-nav-sub" data-name="list-wraper">\r\n	',showTagManage&&(__p+='\r\n	<li class="item-mn">\r\n		<a target="_blank" href="'+(null==(__t=host)?"":__t)+'#work/tag" class="title-mn"><span class="tu-icon-tag siderbar-icon"></span>按标签查看</a>\r\n	</li>\r\n	'),__p+="\r\n	",!isShowImplement||203==routerData.appId&&203==routerData.appType||(__p+='\r\n	<li class="item-mn">\r\n		<a href="#work/implementation" class="title-mn"><span class="tu-icon-chart siderbar-icon"></span>项目执行情况</a>\r\n	</li>\r\n	'),__p+='\r\n	<li class="item-mn" style="display:none"> \r\n		<a data-relation="0" data-trigger="false" href="#work?relation=0&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+'">\r\n			<span class="un_mark_star mark_star"></span>星标\r\n		</a>\r\n		<ul class="worklist_sidenav">\r\n		</ul>\r\n	</li>\r\n	<li class="fold-item item-mn"> \r\n		<a data-relation="1" data-trigger="false" href="#work?relation=1&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" data-name="respon-title" class="title-mn" >',__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+='负责的</a>\r\n		<span class="arrow-btn tu-icon-fontarrow-down"></span>\r\n		<ul class="worklist_sidenav sub-menu" data-relation="1">\r\n			<div class="loading-content">\r\n				',__p+=isShowGIF?'\r\n			    	<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n			    ':'\r\n			        <div class="spinner">\r\n			            <div class="rect1"></div>\r\n			            <div class="rect2"></div>\r\n			            <div class="rect3"></div>\r\n			            <div class="rect4"></div>\r\n			        </div>\r\n			    ',__p+='\r\n			</div>\r\n		</ul>\r\n	</li>\r\n	<li class="fold-item item-mn"> \r\n		<a data-relation="2" data-trigger="false" data-name="paticip-title" href="#work?relation=2&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" class="title-mn">',__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+='参与的</a>\r\n		<span class="arrow-btn tu-icon-fontarrow-down"></span>\r\n		<ul class="worklist_sidenav sub-menu" data-relation="2">\r\n			<div class="loading-content">\r\n				',__p+=isShowGIF?'\r\n			    	<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n			    ':'\r\n			        <div class="spinner">\r\n			            <div class="rect1"></div>\r\n			            <div class="rect2"></div>\r\n			            <div class="rect3"></div>\r\n			            <div class="rect4"></div>\r\n			        </div>\r\n			    ',__p+="\r\n			</div>\r\n		</ul>\r\n	</li>\r\n	",userId==routerData.to_user_id&&(__p+='\r\n	<li class="fold-item item-mn"> \r\n		<a data-relation="3" data-trigger="false" data-name="follow-title" href="#work?relation=3&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'"  class="title-mn">我关注的</a>\r\n		<span class="arrow-btn tu-icon-fontarrow-down"></span>\r\n		<ul class="worklist_sidenav sub-menu" data-relation="3">\r\n			<div class="loading-content">\r\n				',__p+=isShowGIF?'\r\n			    	<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n			    ':'\r\n			        <div class="spinner">\r\n			            <div class="rect1"></div>\r\n			            <div class="rect2"></div>\r\n			            <div class="rect3"></div>\r\n			            <div class="rect4"></div>\r\n			        </div>\r\n			    ',__p+="\r\n			</div>\r\n		</ul>\r\n	</li>\r\n	"),__p+="\r\n	",!isShowOthers||203==routerData.appId&&203==routerData.appType||(__p+='\r\n	<li class="item-mn"> \r\n		<a data-relation="4" data-trigger="false" href="#work?relation=4&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" class="title-mn">所有公开的</a>\r\n	</li>\r\n	'),__p+="\r\n</ul>";return __p},this.JST["work/project-tag-add-dialog-input-checkcolor"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)for(var i=1;7>i;i++)__p+="\n	",__p+=i==color?'\n		<span class="color'+(null==(__t=i)?"":__t)+' tu-icon-font" data-color="'+(null==(__t=i)?"":__t)+'">&#xe900;</span>\n	':'\n		<span class="color'+(null==(__t=i)?"":__t)+'" data-color="'+(null==(__t=i)?"":__t)+'"></span>\n	',__p+="\n";return __p},this.JST["work/project-tag-add-dialog-input"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="check-color-btn" original-title="更换颜色">\n<span class="color'+(null==(__t=color)?"":__t)+'"></span>\n</span>\n<button data-name="add" class="tag-input-add tu-button-disabled">添加</button>\n<div class="tu-input-default">\n<div><label class="placeholder" for="q">输入标签名称</label></div>\n<form data-name="form">\n<input type="text" id="q" data-name="input" autocomplete="off">\n</form>\n</div>\n<p class="input-tip"></p>';return __p},this.JST["work/project-tag-add-dialog-tag-box"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div data-name="my-tag"></div>\n<div data-name="share-tag"></div>';return __p},this.JST["work/project-tag-add-dialog"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div data-name="loading"></div>\n<div data-name="input"></div>\n<div data-name="tag-cont" class="tag-cont"></div>';return __p},this.JST["work/statistics"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)IsEmpty&&(__p+='\n<div class="title"><span>统计</span>  截止于'+(null==(__t=date)?"":__t)+'</div>\n<div class="taskchart">\n	<div class="right_tc">\n		<dl>\n			<dt><i>任务总数</i><span class="num">'+(null==(__t=Pandect.TaskTotal)?"":__t)+'</span></dt>\n			<dd><i>未完成</i><span class="num">'+(null==(__t=Pandect.UndoneTotal)?"":__t)+'</span></dd>\n			<dd><i>已完成</i><span class="num">'+(null==(__t=Pandect.DoneTotal)?"":__t)+'</span></dd>\n		</dl>\n	</div>\n	<div class="left_tc">\n		<h3>任务进展情况总览<span>（完成率    <b>'+(null==(__t=Pandect.CompletionRate)?"":__t)+'%</b>）</span></h3>\n		<div data-name="task-chart"></div>\n	</div>\n	\n</div>\n<div class="personchart">\n	<h3>按负责人统计任务进展状况</h3>\n	<div class="intro_pc">\n		<div class="left_pc">\n			<span class="right_pc">\n				<b></b>已完成\n				<b class="unfinished"></b>未完成\n			</span>\n			柱状图后的数字:（完成数/总数）\n		\n		</div>\n	</div>\n	<div class="chart_pc" data-name="person-chart">\n		\n	</div>\n	\n</div>\n\n<div class="totalchart">\n	<table>\n		<thead>\n			<tr>\n				<th>人员</th>\n				<th>负责总数</th>\n				<th>已完成</th>\n				<th>完成率</th>\n				<th>评分<a class="icon-help" href="//service.tita.com/pages/viewpage.action?pageId=590546" original-title="什么是评分" target="_blank" ></a></th>\n			</tr>\n		</thead>\n		<tbody>\n			',_.each(StaffProgress,function(a){__p+="\n			<tr>\n				<td>"+(null==(__t=a.PrincipalUser.Name)?"":__t)+"</td>\n				<td>"+(null==(__t=a.TaskTotal)?"":__t)+"</td>\n				<td>"+(null==(__t=a.TaskDone)?"":__t)+"</td>\n				<td>\n					",__p+=0!=a.TaskDoneRate?'\n					<div class="pb_tc">\n						\n						<div class="progressbar"><span style="width:'+(null==(__t=a.TaskDoneRate)?"":__t)+'"></span></div>\n						<span class="num">'+(null==(__t=a.TaskDoneRate)?"":__t)+"</span>\n					</div>\n					":"\n					--\n					",__p+="\n				</td>\n				<td>",__p+="0"!=a.TaskScore?"\n					"+(null==(__t=a.TaskScore)?"":__t)+"\n					":"\n					--\n					",__p+="</td>\n			</tr>\n			"}),__p+="\n		</tbody>\n	</table>\n</div>\n"),__p+="\n<br/><br/><br/>\n\n";return __p},this.JST["work/tag/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="tag-manage tu-row-fuild">\n<!-- side sub nav -->\n<div class="tag-tabnav tu-col-3" data-tu-submenu="tu-submenu">\n	<div class="tu-col-container"  data-name="tabnav"></div>\n</div>\n<!-- side sub nav end -->\n<div class="tag-right-container tu-col-13" data-name="container">\n	<div class="tu-col-container"  data-name="tag-right-container"></div>\n</div>\n</div>';return __p},this.JST["work/tag/right-container"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="";return __p},this.JST["work/tag/right-tag-manage-create-tag-checkcolor"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)for(var i=1;7>i;i++)__p+="\n	",__p+=i==color?'\n		<span class="color'+(null==(__t=i)?"":__t)+' tu-icon-font" data-color="'+(null==(__t=i)?"":__t)+'">&#xe900;</span>\n	':'\n		<span class="color'+(null==(__t=i)?"":__t)+'" data-color="'+(null==(__t=i)?"":__t)+'"></span>\n	',__p+="\n";return __p},this.JST["work/tag/right-tag-manage-create-tag-input"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="tu-input-default">\n    <label class="placeholder" for="q">输入标签名称</label>\n    <input type="text" id="q" data-name="input" autocomplete="off">\n</div>\n<p class="input-tip"></p>';return __p},this.JST["work/tag/right-tag-manage-create-tag"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tag-info-item">\n	<div class="tag-info-left">标签名称</div>\n	<div class="tag-info-right" data-name="tag-name-wrap"></div>\n</div>\n<div class="tag-info-item">\n	<div class="tag-info-left">标签颜色</div>\n	<div class="tag-info-right">\n		<div data-name="check-color-wrap" class="check-color-wrap"></div>\n	</div>\n</div>\n',hasDirectSubs&&(__p+='\n	<div class="clearfix tag-info-item">\n		<div class="share">\n			<div class="check-box">\n				<span class="tu-icon-font check-icon">&#xe900;</span>\n			</div>\n			<span>共享给直接下级</span>\n		</div>\n	</div>\n');return __p},this.JST["work/tag/right-tag-manage-tag-collection"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)(hasShareBtn||hasDeleteBtn)&&(__p+='\n<div class="btn-box">\n	',hasShareBtn&&(__p+='\n		<button data-name="share-btn" class="tu-btn tu-btn-small disabled" >共享</button>\n	'),__p+="\n	",hasDeleteBtn&&(__p+='\n		<button data-name="delete-btn" class="tu-btn tu-btn-small disabled">删除</button>\n	'),__p+="\n</div>\n"),__p+='\n<div class="tag-box" data-name="tag-wrap"></div>';return __p},this.JST["work/tag/right-tag-manage-tagbox"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div data-name="my-tag" class="tag-list-box"></div>\n<div data-name="share-tag" class="tag-list-box"></div>';return __p},this.JST["work/tag/right-tag-manage"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tu-container-title tag-manage-title">\n	<h2 class="h2">标签管理<a href="http://service.tita.com/pages/viewpage.action?pageId=1901167" target="_blank" class="icon-dialog-wiki"></a></h2>\n	<button data-name="create-tag" class="tu-btn tu-btn-larger tu-btn-sure ',createTagBtnClick||(__p+="disabled"),__p+='"  original-title="最多可创建50个标签">创建</button>\n	</div>\n<div data-name="tag-container" class="tag-list-container"></div>';return __p},this.JST["work/tag/right-works-collection"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="tu-table">\n	<table>\n		<colgroup>\n			<col span="1" width="60%"></col>\n			<col span="1" width="20%"></col>\n			<col span="1" width="20%"></col>\n		</colgroup>\n		<thead>\n			<tr>\n				<th>项目名称</th>\n				<th>负责人</th>\n				<th>起止时间</th>\n			</tr>\n		</thead>\n		<tbody></tbody>\n	</table>\n</div>';return __p},this.JST["work/tag/right-works-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<td class="tag-name-link">\n	<a href="'+(null==(__t=url)?"":__t)+'" target="_blank">'+(null==(__t=itemName)?"":__t)+'</a>\n</td>\n<td>\n	<span data-name="name-tip" original-title="'+(null==(__t=principalUserName)?"":__t)+'">\n	'+(null==(__t=subName)?"":__t)+"\n	</span>\n</td>\n<td>\n	"+(null==(__t=startDate)?"":__t),__p+=isLongTerm?"-长期":"-"+(null==(__t=endDate)?"":__t),__p+="\n</td>";return __p},this.JST["work/tag/right-works"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="tu-container-title tag-manage-title">\n	<h2 class="h2">'+(null==(__t=tagName)?"":__t)+'</h2>\n</div>\n<div class="tag-manage-main">\n	<div class="tu-tabbable-line tag-items-tabs">\n		<ul class="tu-nav-tabs">\n			<li class="active">\n				<a href="javascript:;">项目<span data-name="project-num"></span></a>\n			</li>\n		</ul>\n		<div class="tu-nav-content"></div>\n	</div>\n	<div data-name="work-items-container"></div>\n	<div data-name="pagination" class="tu-pagelist">\n		<div data-name="pagination-container" class="tu-pagination"></div>\n	</div>\n</div>';return __p},this.JST["work/tag/siderbar-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<span class="leftIcon"><span class="color color'+(null==(__t=color)?"":__t)+'"></span></span><span class="rightIcon">',2==getWay&&(__p+='<span class="share-in tu-icon-fontsharetome" original-title="来自'+(null==(__t=fromUserName)?"":__t)+'的共享" ></span>'),1==shareType&&(__p+='<span class="share-out tu-icon-fontsharedbyme" original-title="已共享给直接下级" ></span>'),0!=objCount&&(__p+='<span class="cont" original-title="标签下工作事项数量" >('+(null==(__t=objCount)?"":__t)+")</span>"),__p+='</span><a href="#work/tag?relation=1&tagId='+(null==(__t=id)?"":__t)+"&tagName="+(null==(__t=tagName)?"":__t)+'" data-trigger="false" data-name="my-used-tag" id="'+(null==(__t=id)?"":__t)+'"><span data-name="tagName">'+(null==(__t=tagName)?"":__t)+"</span></a>";return __p},this.JST["work/tag/siderbar"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)showMyTag&&(__p+='\n<li class="item-mn fold-btn">\n	<a href="javascript:;" class="siderbar-title title-mn" data-name="my-tag-btn">我的标签<span class="tu-icon-fontarrow-up icon-arrow"></span></a>\n	\n</li>\n'),__p+='\n<li class="item-mn" style="position: relative;">\n	<ul data-name="my-used-tag-cont" class="sortable-wrap sub-menu"></ul>\n</li>\n<li class="item-mn">\n	<a href="#work/tag?relation=2" data-name="tag-manage-btn" data-trigger="false" class="title-mn siderbar-title ',2==relation&&(__p+="active"),__p+='">标签管理</a>\n</li>';return __p},this.JST["work/task-select"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<a class="project_task_select task_responsible_select" type="responsible">\n	<span class="select_text"></span>\n	<span class="drop_icon"></span>\n</a>\n<ul class="dropdown-menu task_responsible_dropdown">\n	<li data-type="all" data-text="所有人"><span class="check"></span>所有人</li>\n	',_.each(members,function(a){__p+='\n	<li data-type="'+(null==(__t=a.UserId)?"":__t)+'" data-text="'+(null==(__t=a.Name)?"":__t)+'" title='+(null==(__t=a.Name)?"":__t)+'>\n		<span class="check"></span>'+(null==(__t=_.substring(a.Name,10,!0))?"":__t)+"\n	</li>\n	"}),__p+='\n</ul>\n<a class="project_task_select task_status_select" type="status">\n	<span class="select_text"></span>\n	<span class="drop_icon"></span>\n</a>\n<ul class="dropdown-menu task_status_dropdown">\n	<li data-type="all" data-text="所有状态"><span class="check"></span>所有状态</li>\n	<li data-type="undone" data-text="未完成"><span class="check"></span>未完成</li>\n	<li data-type="done" data-text="已完成"><span class="check"></span>已完成</li>\n</ul>';return __p},this.JST["work/task"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)mileTotal>0&&(__p+='\n<div class="mile-task-tab" data-name="mile-task-tab">\n	\n</div>\n'),__p+='\n<div class="task-wraper">\n	<div class="task-create" data-name="create"></div>\n	<div class="task-filter" data-name="task-data-filter"></div>\n\n	<div class="task-list-container" data-name="task-list"></div>\n</div>\n\n';return __p},this.JST["work/work-mile-no-class-item"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="principle" data-id="0">\n	<span class="radius_img50" style="background-color:#c5c5c5;">其他</span>\n</div>\n<div class="milepost-item-tt">\n	<span class="icon-left icon-dark-angle-left"></span>\n	<div class="milepost-left">\n		<span class="no-class">未设置里程碑的其他任务</span>\n	</div>\n	<div class="milepost-right">\n		<span class="operate" original-title="操作">\n			<span class="icon icon-arrow-down-2t"></span>\n		</span>\n		<div class="operate-btns">\n			<span class="item" data-name="transfer">转移任务</span>\n		</div>\n	</div>\n</div>\n<div class="sub-container-wraper">\n	<div class="sub-container">\n\n	</div>\n	<span class="packup" data-name="packup">完成转移</span>\n</div>\n\n';return __p},this.JST["work/work-mile-task-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="mile-task-right">\n	<span class="date">'+(null==(__t=endDate)?"":__t)+'</span>\n	<span class="name">'+(null==(__t=Context.subString(principalUser.Name,6,!0))?"":__t)+'</span>\n	<span class="transfer-task" data-name="transfer-task" task-id="'+(null==(__t=feedId)?"":__t)+'">转移任务</span>\n</span>\n<span class="mile-task-left">\n	'+(null==(__t=taskName)?"":__t)+"\n</span>\n";return __p},this.JST["work/work-milepost-composite"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="milepost-create" data-name="create"></div>\n<div class="milepost-container">\n\n</div>\n',__p+='\n<div class="no-class-item">\n	\n</div>\n',__p+="\n\n\n";return __p},this.JST["work/work-milepost-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="principle '+(null==(__t=editable?"cursor":"")?"":__t)+'" data-name="principle" data-id="'+(null==(__t=mileStoneId)?"":__t)+'">\n	'+(null==(__t=_.convertImage({className:"icon",src:user.Avatar.Medium,size:50,shape:"radius",name:user.Name,bgColor:user.Avatar.Color}))?"":__t)+"\n	",isLast||(__p+='\n		<span class="icon-dot-top"></span>\n	'),__p+="\n	\n</div>\n",isLast||(__p+='\n	<span class="border-left"></span>\n'),__p+='\n<div class="milepost-item-tt">\n	<span class="sortNum '+(null==(__t=isWarn?"warn":"")?"":__t)+'">'+(null==(__t=index+1)?"":__t)+'</span>\n	<span class="icon-left icon-'+(null==(__t=2==status?"blue":"dark")?"":__t)+'-angle-left"></span>\n	<div class="milepost-right">\n		<span class="status">\n			',1==status?__p+="\n				<strong>未开始</strong>\n			":2==status?__p+='\n				<span class="ing">剩余<span class="num">'+(null==(__t=remainingDays)?"":__t)+"</span>天</span>\n			":3==status?__p+='\n				<span class="warn"><strong>已过期</strong></span>\n			':4==status&&(__p+="\n				<strong>已完成</strong>\n			"),__p+="\n		</span>\n		",__p+=editable?'\n		<span original-title="修改起止时间" data-name="date" class="date cursor '+(null==(__t=isWarn?"warn":"")?"":__t)+'">\n			('+(null==(__t=startDate)?"":__t)+"-"+(null==(__t=endDate)?"":__t)+")\n		</span>\n		":'\n		<span class="date '+(null==(__t=isWarn?"warn":"")?"":__t)+'">\n			('+(null==(__t=startDate)?"":__t)+"-"+(null==(__t=endDate)?"":__t)+")\n		</span>\n\n		",__p+="\n		",transferable&&(__p+='\n		<span class="operate" original-title="操作">\n			<span class="icon icon-arrow-down-2t"></span>\n		</span>\n		'),__p+='\n		<div class="operate-btns">\n			<span class="item" data-name="transfer">转移任务</span>\n			',editable&&(__p+='<span class="item" data-name="delete">删除里程碑</span>'),__p+='\n		</div>\n	</div>\n	<div class="milepost-left">\n		',__p+=editable?'\n			<textarea original-title="修改名称"  style="resize:none;" class="input_container '+(null==(__t=isWarn?"warn":"")?"":__t)+'">'+(null==(__t=mileStoneName)?"":__t)+"</textarea>\n		":'\n			<span class="name '+(null==(__t=isWarn?"warn":"")?"":__t)+'"><strong>'+(null==(__t=mileStoneName)?"":__t)+"</strong></span>\n		",__p+='\n		\n		<div class="project_btn_group">\n			<a class="btn_blue " href="javascript:;">确定</a>\n			<a class="btn_white " href="javascript:;">取消</a>\n		</div>\n		',__p+=taskTotal>0?'\n			<div class="percent">\n				完成度： <span class="num">\n				'+(null==(__t=finishTaskTotal)?"":__t)+"/"+(null==(__t=taskTotal)?"":__t)+"(<strong>"+(null==(__t=Number((100*finishTaskTotal/taskTotal).toFixed(1)))?"":__t)+"%</strong>)\n			</span>	\n			</div>\n		":'\n			<div class="noTask">暂无任务</div>\n		',__p+='\n			\n	</div>\n	\n</div>\n<div class="sub-container-wraper">\n	<div class="sub-container">\n\n	</div>\n	<span class="packup" data-name="packup">完成转移</span>\n</div>\n\n';return __p},this.JST}),define("views/common/bs-tab/bs-tab",["talent"],function(a){return a.ItemView.extend({template:_.template(),initialize:function(a){this.$el=a.el,a.getActiveNodeByData&&(this.getActiveNodeByData=a.getActiveNodeByData),a.getActiveNodeByNode&&(this.getActiveNodeByNode=a.getActiveNodeByNode),a.getEventTriggerNode&&(this.getEventTriggerNode=a.getEventTriggerNode);var b=a.eventNode||"a",c=_.debounce(this.onTabClick,300,!0),d=this.$el.data("bb-cid");d&&this.$el.off(".delegateEvents"+d),this.$el.data("bb-cid",this.cid),this.events=function(){var a={};return a["click "+b]=c,a},this.activeClassName=a.activeClassName?a.activeClassName:"active"},setDefault:function(a){this.$el.find("."+this.activeClassName).removeClass(this.activeClassName);var b=this.getActiveNodeByData(a);this.activeNode=b,b.addClass(this.activeClassName)},onTabClick:function(b){var c=this,d=a.$(b.currentTarget);d.attr("outside")||(c.activeNode&&c.activeNode.removeClass(c.activeClassName),c.activeNode=c.getActiveNodeByNode(d),c.activeNode.addClass(c.activeClassName),c.options.eventTriggerName&&a.app.vent.trigger("tab:"+c.options.eventTriggerName+":change",c.getEventTriggerNode(d)))},getEventTriggerNode:function(a){return a},getActiveNodeByData:function(b){var c="";a._.each(b,function(a,b){c+=b+"="+a+"&"}),c=c.slice(0,c.length-1);var d=this.getActiveNodeByNode(this.$el.find('a[href$="'+c+'"]'));return d},getActiveNodeByNode:function(a){return a.parent()},getActiveNode:function(){return this.activeNode}})}),define("views/work/project-detail-layout",["talent","views/common/bs-tab/bs-tab","templates/work"],function(a,b,c){return a.Layout.extend({template:c["work/project-detail-layout"],className:"project_main_region",initialize:function(){},regions:{main:"#project_detail_region",tab:"#project_detail_tab_container"}})}),!function(a){var b=function(b,c){if(this.options=c,null===b){var d='<div class="tu-modal hide-modal fade-modal" tabindex="-1" role="dialog" id={%id%} data-hidetype="remove"><div class="modal-dialog"><div class="modal-content">'+(c.hashead?'<div class="header-modal">'+(c.closeBtn?'<button type="button" class="close-modal" data-dismiss="modal" aria-hidden="true">&times;</button>':"")+'<h4 class="title-modal">{%title%}</h4></div>':"")+'<div class="body-modal '+(c.hasfoot?"":"no-foot")+'"></div>'+(c.hasfoot?'<div class="footer-modal">'+(c.cancelBtn?'<button type="button" class="tu-btn btn-default tu-btn-small" data-dismiss="modal">{%cancel_btn%}</button>':"")+'<button type="button" class="tu-btn tu-btn-sure tu-btn-small" data-ok="modal">{%ok_btn%}</button></div>':"")+"</div></div></div>";b=a(d.replace("{%title%}",c.title).replace("{%id%}",c.id).replace("{%ok_btn%}",c.okBtn).replace("{%cancel_btn%}",c.cancelBtn)),b.find(".body-modal").html(c.body),a("body").append(b)}this.$element=a(b),c.transition||a(b).removeClass("fade-modal"),this.init()};b.prototype={constructor:b,init:function(){var b=this.$element,c=this.options,d=c.width,e=c.height,f=a(window).width(),g=a(window).height(),h={small:440,normal:590,large:790};b.on("click.dismiss.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)).on("click.ok.modal",':not(.disabled)[data-ok="modal"]',a.proxy(this.okHide,this)),d&&("auto"===d?d=800>.55*f?800:.55*f:h[d]&&(d=h[d]),b.width(d).css("margin-left",-parseInt(d)/2)),"auto"===e&&(e=170>.4*g?170:.4*g),e&&b.find(".body-modal").height(e),"string"==typeof this.options.remote&&this.$element.find(".body-modal").load(this.options.remozte),b.data("okToggle",this.okToggle)},setTitle:function(a){this.$element.find(".title-modal").html(a)},okToggle:function(a){var b=this.$element;"string"==typeof a&&"disabled"==a?b.find('[data-ok="modal"]').addClass("disabled"):b.find('[data-ok="modal"]').removeClass("disabled")},toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,c=a.Event("show"),d=this.$element;return d.trigger(c),this.isShown||c.isDefaultPrevented()?void 0:(this.isShown=!0,this.escape(),this.backdrop(function(){function c(a){a.$element.focus().trigger("shown"),a.options.timeout>0&&(a.timeid=setTimeout(function(){a.hide()},a.options.timeout))}var e=a.support.transition&&d.hasClass("fade-modal");d.parent().length||d.appendTo(document.body),b.resize(),d.show(),e&&d[0].offsetWidth,d.addClass("in-modal").attr("aria-hidden",!1),b.enforceFocus(),e?d.one(a.support.transition.end,function(){c(b)}):c(b)}),d)},hide:function(b){b&&b.preventDefault();var c=this.$element,b=a.Event("hide");return"ok"!=this.hideReason&&c.trigger("cancelHide"),c.trigger(b),this.isShown&&!b.isDefaultPrevented()?(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),this.timeid&&clearTimeout(this.timeid),c.removeClass("in-modal").attr("aria-hidden",!0),a.support.transition&&c.hasClass("fade-modal")?this.hideWithTransition():this.hideModal(),c):void 0},okHide:function(b){function c(){d.hideReason="ok",d.hide(b)}var d=this;if(!b)return void c();var e=this.options.okHide,f=!0;if(!e){var g=a._data(this.$element[0],"events").okHide;g&&g.length&&(e=g[g.length-1].handler)}return"function"==typeof e&&(f=e.call(this)),f!==!1&&c(),d.$element},shadeIn:function(){var b=this.$element;if(!b.find(".shade").length){var c=a('<div class="shade in" style="background:'+this.options.bgcolor+'"></div>');return c.appendTo(b),this.hasShaded=!0,this.$element}},shadeOut:function(){return this.$element.find(".shade").remove(),this.hasShaded=!1,this.$element},shadeToggle:function(){return this[this.hasShaded?"shadeOut":"shadeIn"]()},resize:function(){var b=this.$element,c=b.height(),d=a(window).height(),e=0;return c>=d?e=-d/2:(e=(d-c)/(1+1.618)-d/2,b.css("margin-top",parseInt(e))),b},enforceFocus:function(){var b=this;a(document).off("focusin.modal").on("focusin.modal",function(a){b.$element[0]===a.target||b.$element.has(a.target).length||b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(b){27==b.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end),b.hideModal()},300);this.$element.one(a.support.transition.end,function(){clearTimeout(c),b.hideModal()})},hideModal:function(){var a=this,b=this.$element;b.hide(),this.backdrop(function(){a.removeBackdrop(),b.trigger("ok"==a.hideReason?"okHidden":"cancelHidden"),a.hideReason=null,b.trigger("hidden"),"remove"==b.data("hidetype")&&b.remove()})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(b){var c=this.$element.hasClass("fade-modal")?"fade-modal":"",d=this.options;if(this.isShown){var e=a.support.transition&&c;if(d.backdrop!==!1){if(this.$backdrop=a('<div class="tu-modal-backdrop '+c+'" style="background:'+d.bgcolor+'"/>').appendTo(document.body),this.$backdrop.click("static"==d.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this)),e&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in-modal "),!b)return;e?this.$backdrop.one(a.support.transition.end,b):b()}else b&&b()}else this.$backdrop?(this.$backdrop.removeClass("in-modal"),a.support.transition&&this.$element.hasClass("fade-modal")?this.$backdrop.one(a.support.transition.end,b):b()):b&&b()}};var c=a.fn.modal;a.fn.modal=function(c,d){return this.each(function(){var e=a(this),f=e.data("modal"),g=a.extend({},a.fn.modal.defaults,e.data(),"object"==typeof c&&c);f||e.data("modal",f=new b(this,g)),"string"==typeof c?f[c](d):f.show()})},a.fn.modal.defaults={backdrop:!0,bgcolor:"#000",keyboard:!0,hasfoot:!0,hashead:!0,closeBtn:!0,transition:!0},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on("click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("modal")?"toggle":c.data();b.preventDefault(),e.modal(f).one("hide",function(){c.focus()})}),a.extend({_modal:function(c,d){function e(b,c){var d=["show","shown","hide","hidden","okHidden","cancelHide","cancelHidden"];a.each(d,function(d,e){"function"==typeof c[e]&&a(document).on(e,"#"+b,a.proxy(c[e],a("#"+b)[0]))})}var f=+new Date,g=a.extend({},a.fn.modal.defaults,c,{id:f,okBtn:"确定"},"string"==typeof d?{body:d}:d),h=new b(null,g),i=h.$element;return e(f,g),i.data("modal",h).modal("show"),i},alert:function(b){var c={type:"alert",title:"注意"};return a._modal(c,b)},confirm:function(b){var c={type:"confirm",title:"提示",cancelBtn:"取消"};return a._modal(c,b)}})}(window.jQuery),define("$.modal",function(){}),function(a){"function"==typeof define&&define.amd?define("$.autoresize",["jquery"],a):a(window.jQuery||window.$)}(function(a){var b,c={className:"autosizejs",append:"",callback:!1,resizeDelay:10},d='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',e=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],f=a(d).data("autosize",!0)[0];f.style.lineHeight="99px","99px"===a(f).css("lineHeight")&&e.push("lineHeight"),f.style.lineHeight="",a.fn.autosize=function(d){return d=a.extend({},c,d||{}),f.parentNode!==document.body&&a(document.body).append(f),this.each(function(){function c(){var c,g={};if(b=l,f.className=d.className,i=parseInt(m.css("maxHeight"),10),a.each(e,function(a,b){g[b]=m.css(b)}),a(f).css(g),"oninput"in l){var h=l.style.width;l.style.width="0px",c=l.offsetWidth,l.style.width=h}}function g(){var e,g,h,k;b!==l&&c(),f.value=l.value+d.append,f.style.overflowY=l.style.overflowY,g=parseInt(l.style.height,10),"getComputedStyle"in window?(k=window.getComputedStyle(l),h=l.getBoundingClientRect().width,a.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(a,b){h-=parseInt(k[b],10)}),f.style.width=h+"px"):f.style.width=Math.max(m.width(),0)+"px",f.scrollTop=0,f.scrollTop=9e4,e=f.scrollTop,i&&e>i?(l.style.overflowY="scroll",e=i):(l.style.overflowY="hidden",j>e&&(e=j)),e+=n,g!==e&&(l.style.height=e+"px",o&&d.callback.call(l,l))}function h(){clearTimeout(k),k=setTimeout(function(){m.width()!==q&&g()},parseInt(d.resizeDelay,10))}var i,j,k,l=this,m=a(l),n=0,o=a.isFunction(d.callback),p={height:l.style.height,overflow:l.style.overflow,overflowY:l.style.overflowY,wordWrap:l.style.wordWrap,resize:l.style.resize},q=m.width();m.data("autosize")||(m.data("autosize",!0),("border-box"===m.css("box-sizing")||"border-box"===m.css("-moz-box-sizing")||"border-box"===m.css("-webkit-box-sizing"))&&(n=m.outerHeight()-m.height()),j=Math.max(parseInt(m.css("minHeight"),10)-n||0,m.height()),m.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:"none"===m.css("resize")||"vertical"===m.css("resize")?"none":"horizontal"}),"onpropertychange"in l?"oninput"in l?m.on("input.autosize keyup.autosize",g):m.on("propertychange.autosize",function(){"value"===event.propertyName&&g()
}):m.on("input.autosize",g),d.resizeDelay!==!1&&a(window).on("resize.autosize",h),m.on("autosize.resize",g),m.on("autosize.resizeIncludeStyle",function(){b=null,g()}),m.on("autosize.destroy",function(){b=null,clearTimeout(k),a(window).off("resize",h),m.off("autosize").off(".autosize").css(p).removeData("autosize")}),g())})}}),define("views/work/project-create-view",["talent","templates/work","$.modal","moment","UserSelector","collections/smember-group-collection","$.autoresize"],function(a,b,c,d,e,f){return a.ItemView.extend({template:b["work/project-create"],className:"tt-project-create-dialog",templateHelpers:function(){return{loginInfo:a.Context.getUserInfo(),i18n:a.Context.getI18n()}},ui:{setPrincipalBtn:"[data-name=set-principal]",setParticipatorBtn:"[data-name=set-participator]",setApprovalBtn:"[data-name=set-approval]",userListWrap:"[data-name=user-list-wrap]",projectName:"[data-name=project-name]",projectNamePlaceholder:"[data-name=project-name-placeholder]",errorNameTip:"[data-name=name-error-tip]",projectDes:"[data-name=project-description]",errorDesTip:"[data-name=des-error-tip]",txtTotal:"[data-name=txt-total]"},events:function(){var a={};return a["compositionstart "+this.ui.projectName]="_inputStartHandler",a["compositionend "+this.ui.projectName]="_inputEndHandler",a["focus "+this.ui.projectName]="_projectNameFocusHandler",a["blur "+this.ui.projectName]="_projectNameBlurHandler",a["input "+this.ui.projectName]="_projectNameInputHandler",a["compositionstart "+this.ui.projectDes]="_inputDesStartHandler",a["compositionend "+this.ui.projectDes]="_inputDesEndHandler",a["focus "+this.ui.projectDes]="_projectDesFocusHandler",a["blur "+this.ui.projectDes]="_projectDesBlurHandler",a["input "+this.ui.projectDes]="_projectDesInputHandler",a},initialize:function(){this.model.set({workName:"",description:"",startDate:d().format("YYYY/MM/DD"),endDate:d().add("days",29).format("YYYY/MM/DD"),principalId:"",visibility:2,participators:[],isLong:!1,applyUserId:""}),this.isIE=this.isIE(),this.isIE8=-1!=window.navigator.userAgent.toUpperCase().indexOf("MSIE 8.0")?!0:!1,this.IME=!1,this.propertychange_val="",this.projectNameRole=!1,this.projectDesRole=!1},isIE:function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1},onRender:function(){var a=this;this._renderUserSelectView(),this.ui.projectName.bind("propertychange",function(b){a._projectNameInputHandler(b,a)}),this.ui.projectDes.bind("propertychange",function(b){a._projectNameInputHandler(b,a)})},show:function(){this.crateTagDialog=$.confirm({title:"创建新的标签",body:this.$el,width:"auto",backdrop:"static",okHide:function(){},shown:function(){}}),this.crateTagDialog.modal("okToggle","disabled")},_renderUserSelectView:function(){this.userSelectorView=new e({collection:new f}),this.userSelectorView.addNode(this.ui.setPrincipalBtn,{viewType:"single",input:!0,muti:!1}),this.userSelectorView.addNode(this.ui.setParticipatorBtn,{viewType:"single",input:!0,muti:!1}),this.userSelectorView.addNode(this.ui.setApprovalBtn,{viewType:"single",input:!0,muti:!1}),this.ui.setPrincipalBtn.on("submit",function(){}),this.ui.setParticipatorBtn.on("submit",function(){}),this.ui.setApprovalBtn.on("submit",function(){})},_projectNameFocusHandler:function(a){var b=$(a.currentTarget);b.parent().addClass("tu-input-focus"),b.autosize()},_projectNameBlurHandler:function(a){var b=$(a.currentTarget),c=b.val();""==c&&this.ui.projectNamePlaceholder.show(),b.parent().removeClass("tu-input-focus")},_inputStartHandler:function(){this.IME=!0},_inputEndHandler:function(a){this.IME=!1,this._projectNameInputHandler(a,this)},_projectNameInputHandler:function(a,b){a.stopPropagation();var c=$(a.currentTarget),d=c.val(),e=this;e.isIE8&&(e=b),""==d?e.ui.projectNamePlaceholder.show():e.ui.projectNamePlaceholder.hide(),e.IME||(e._txtTotal(d)>100?(c.parent().removeClass("tu-input-focus").addClass("tu-input-error"),e.ui.errorNameTip.show(),e.projectNameRole=!1):(c.parent().removeClass("tu-input-error").addClass("tu-input-focus"),e.ui.errorNameTip.hide(),""!=d&&(e.projectNameRole=!0)),e._changeModalBtnSatus(),e.model.set("description",d))},_projectDesFocusHandler:function(a){var b=$(a.currentTarget);b.parent().addClass("tu-input-focus"),b.autosize()},_projectDesBlurHandler:function(a){var b=$(a.currentTarget),c=b.val();""==c&&this.ui.projectNamePlaceholder.show(),b.parent().removeClass("tu-input-focus")},_inputDesStartHandler:function(){this.IME=!0},_inputDesEndHandler:function(a){this.IME=!1,this._projectDesInputHandler(a,this)},_projectDesInputHandler:function(a,b){a.stopPropagation();var c=$(a.currentTarget),d=c.val(),e=this;if(e.isIE8&&(e=b),!e.IME){var f=e._txtTotal(d);f>1e4?(c.parent().removeClass("tu-input-focus").addClass("tu-input-error"),e.ui.txtTotal.html(parseInt(f/2)),e.ui.errorDesTip.show(),e.projectDesRole=!1):(c.parent().removeClass("tu-input-error").addClass("tu-input-focus"),e.ui.errorDesTip.hide(),""!=d&&(e.projectDesRole=!0)),e._changeModalBtnSatus(),e.model.set("workName",d)}},_changeModalBtnSatus:function(){var a=this.ui.projectDes.val();a?this.projectNameRole&&this.projectDesRole?this.crateTagDialog.modal("okToggle"):this.crateTagDialog.modal("okToggle","disabled"):this.projectNameRole?this.crateTagDialog.modal("okToggle"):this.crateTagDialog.modal("okToggle","disabled")},_txtTotal:function(a){return a.replace(/[\u4E00-\u9FA5]/g,"**").length}})}),define("views/common/sort-dropdown-menu/sort-dropdown-menu-item-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/sort-dropdown-menu/sort-item"],tagName:"li",defaults:{name:"",isSort:{show:!1,type:""},isShowTip:{show:!1,txt:"",type:""},active:!1},templateHelpers:function(){return this.settings},ui:{item:".item"},modelEvents:{change:"render"},events:function(){var a={};return a["click "+this.ui.item]="_clickItemHandler",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.model.toJSON()),this._dealdata()},_dealdata:function(){var a=this.settings.isShowTip.type,b=this.settings.isSort,c=this.settings.name,d=this.settings.active;"time"==a&&(this.settings.isShowTip.txt="down"==b.type?"点击后最早"+c.substring(0,c.indexOf("时间"))+"的在最前面":"点击后最晚"+c.substring(0,c.indexOf("时间"))+"的在最前面"),d&&b.show&&""==b.type&&(this.settings.isSort={show:!0,type:"down"}),this.model.set(this.settings)},onRender:function(){this._showActive()},_showActive:function(){this.settings.active&&this.$el.addClass("active")},_clickItemHandler:function(){this.trigger("chose")},onClose:function(){}})}),define("views/common/sort-dropdown-menu/sort-dropdown-menu-collection-view",["talent","templates/common","views/common/sort-dropdown-menu/sort-dropdown-menu-item-view","$.tipsy"],function(a,b,c){return a.CollectionView.extend({tagName:"ul",className:"tt-sort-dropdown-menu-container",itemView:c,itemViewContainer:this.el,initialize:function(){var b=this;a.$(document).off("mousedown.sort-dropdown-menu-view"),a.$(document).on("mousedown.sort-dropdown-menu-view",function(){b.close()}),this.$el.off("mousedown.sort-dropdown-menu-view"),this.$el.on("mousedown.sort-dropdown-menu-view",function(a){a.stopPropagation()}),this.on("itemview:chose",function(a){this._dealChose(a)})},onRender:function(){this.$el.find(".item").tipsy({gravity:"s"})},show:function(b,c){var d={container:"",pos:"bottom"},c=a._.extend({},d,c);this._showHere(b,c),this.$el.show()},_showHere:function(b,c){this.activeNode=b||null;var d=c.container||a.$("body"),e=d.offset(),f=a.$("body").scrollTop(),g=a.$("body").scrollLeft(),h=b.offset(),i=b.outerHeight(),j=b.outerWidth(),k=this.$el.outerWidth(),l=this.$el.outerHeight(),m={},n=h.top,o=h.left,p=n-e.top,q=o-e.left;switch(c.pos){case"top":m={top:p-l,left:q};break;case"topCenter":m={top:p-l,left:q+j/2-k/2},arrowPosition={left:k/2},arrowClass="bottom";break;case"topRight":m={top:p-l,left:q+j-k},m.left<0&&(m.left=0),arrowPosition={left:k-16},arrowClass="bottom";break;case"bottom":m={top:p+i,left:q};break;case"bottomCenter":m={top:p+i,left:q+j/2-k/2};break;case"bottomRight":m={top:p+i,left:q+j-k},m.left<0&&(m.left=0);break;case"left":m={top:p,left:q-k};break;case"leftCenter":m={top:p+i/2-l/2,left:q-k};break;case"leftBottom":m={top:p+i-l,left:q-k};break;case"right":m={top:p,left:q+j};break;case"rightCenter":m={top:p+i/2-l/2,left:q+j};break;case"rightBottom":m={top:p+i-l,left:q+j}}var r=a.$(window).height(),s=a.$(window).width(),f=a.$(document).scrollTop(),g=a.$(document).scrollLeft();if(e.top+m.top+l>r+f){var t=r+f-(e.top+m.top+l);m.top=m.top+t}if(e.top+m.top<f){var t=f-(e.top+m.top);m.top=m.top+t}if(e.left+m.left+k>s+g){var u=s+g-(e.left+m.left+k);m.left=m.left+u}if(e.left+m.left<g){var u=g-(e.left+m.left);m.left=m.left+u}this.$el.css(m)},_dealChose:function(a){var b=a.model,c=b.get("active");if(c){if(a.model.get("isSort").show){var d=a.model.get("isSort");d.type="up"==d.type?"down":"up",a.model.set("isSort",d)}}else{var e=this.collection.findWhere({active:!0});e&&(e.set("active",!1),e.get("isSort").show&&e.set("isSort",{show:!0,type:""})),a.model.set("active",!0),a.model.get("isSort").show&&a.model.set("isSort",{show:!0,type:"down"})}this.trigger("chose",a.model),this.close()},onClose:function(){$("body").find(".tipsy").remove(),this.trigger("close")}})}),define("views/common/new-search/new-search-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/new-search/new-search"],className:"tt-new-search",defaults:{type:""},templateHelpers:function(){return{type:this.settings.type||"",searchName:(new Date).getTime()}},ui:{input:"input",searchFormBtn:"[data-name=search-form-btn]",cancelBtn:"[data-name=cancel]",placeholder:".placeholder"},events:function(){var a={};return a["focus "+this.ui.input]="_inputFocusHandler",a["blur "+this.ui.input]="_inputBlurHandler",a["input "+this.ui.input]="_inputInputHandler",a["keyup "+this.ui.input]="_inputKeydownHandler",a["click "+this.ui.searchFormBtn]="_searchBtnClickHandler",a["click "+this.ui.cancelBtn]="_cancelBtnClickHandler",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options)},onRender:function(){var a=this;this.ui.input.bind("propertychange",function(b){a._inputInputHandler(b,a)}),1!=this.settings.type&&""!=this.model.get("routerData").filterKey&&(this.ui.cancelBtn.show(),this.ui.placeholder.hide()),this.settings.skin&&"white"==this.settings.skin&&this.ui.searchFormBtn.addClass("white")},_inputFocusHandler:function(a){a.stopPropagation();var b=$(a.currentTarget);b.parent().addClass("tu-input-focus"),this.settings.skin&&"white"==this.settings.skin?(this.ui.cancelBtn.css("color","#fff"),this.ui.searchFormBtn.css("color","#fff")):(this.ui.cancelBtn.css("color","#005999"),this.ui.searchFormBtn.css("color","#005999")),1==this.settings.type&&this.ui.cancelBtn.show()},_inputBlurHandler:function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.val();""==c&&(b.parent().removeClass("tu-input-focus"),1==this.settings.type&&this.ui.cancelBtn.hide(),this.trigger("cancel",c))},_inputInputHandler:function(a,b){a.stopPropagation();var c=$(a.currentTarget),d=c.val(),e="propertychange"==a.type?b:this,f=e.settings.type;""==d?(e.ui.placeholder.show(),1!=f&&e.ui.cancelBtn.hide()):(e.ui.placeholder.hide(),1!=f&&e.ui.cancelBtn.show())},_inputKeydownHandler:function(a){a.stopPropagation(),a&&13==a.keyCode&&this._searchBtnClickHandler(a)},_searchBtnClickHandler:function(a){a.stopPropagation();var b=this.ui.input.val();if(1!=this.settings.type){var c=this.model.get("routerData");c.filterKey=b,this.model.set("routerData",c),this.trigger("search",b)}else b&&this.trigger("search",b)},_searchBtnMouEnHandler:function(a){var b=$(a.currentTarget);this.settings.skin&&"white"==this.settings.skin&&b.addClass("white")},_searchBtnMouLeHandler:function(a){var b=$(a.currentTarget);this.settings.skin&&"white"==this.settings.skin&&b.removeClass("white")},_cancelBtnClickHandler:function(a){a.stopPropagation();var b=this.ui.input.val();if(1!=this.settings.type){this.ui.input.val("");var c=this.model.get("routerData");c.filterKey="",this.model.set("routerData",c)}this.trigger("cancel",b),this.render()}})}),define("views/work/project-list-main-screen-view",["talent","templates/work","views/common/sort-dropdown-menu/sort-dropdown-menu-collection-view","views/common/new-search/new-search-view","$.infotip"],function(a,b,c,d){return a.ItemView.extend({template:b["work/project-list-main-screen"],tagName:"ul",className:"project-screen-container clearfix",ui:{status:"[data-name=status]",sorts:"[data-name=sort]",search:"[data-name=project-search]"},events:function(){var a={};return a["click "+this.ui.status]="_clickStatusHandler",a["click "+this.ui.sorts]="_clickSortHandler",a},initialize:function(){this.sorts=[{name:"创建时间",isSort:{show:!0,type:"down"},isShowTip:{show:!0,txt:"",type:"time"},active:!0},{name:"开始时间",isSort:{show:!0,type:""},isShowTip:{show:!0,txt:"",type:"time"},active:!1},{name:"结束时间",isSort:{show:!0,type:""},isShowTip:{show:!0,txt:"",type:"time"},active:!1}],this.status=[{name:"进行中",active:!0},{name:"已完成",active:!1}],this.statusCollection=new a.Collection(this.status),this.sortCollection=new a.Collection(this.sorts);var b=this.model.get("routerData");4==b.relation&&(b.filterKey="",this.model.set("routerData",b))},onRender:function(){this._renderSearchVeiw()},onShow:function(){},_clickStatusHandler:function(a){var b=$(a.currentTarget),c=this;this._removeActive(),b.addClass("active"),this._renderSortDropdownMenu(b,this.statusCollection,{container:this.$el}),this.statusCollection.on("change",function(){var a=c.statusCollection.findWhere({active:!0});a&&b.find(".name").html(a.get("name"))})},_clickSortHandler:function(a){var b=$(a.currentTarget);this._removeActive(),b.addClass("active");var c=this.statusCollection.findWhere({active:!0}),d=this.sortCollection.findWhere({active:!0}),e=this.sortCollection.findWhere({name:"完成时间"});e||"已完成"!=c.toJSON().name?"完成时间"==d.toJSON().name&&"已完成"!=c.toJSON().name&&this.sortCollection.reset(this.sorts):this.sortCollection.add({name:"完成时间",isSort:{show:!0,type:""},isShowTip:{show:!0,txt:"",type:"time"},active:!1}),this._renderSortDropdownMenu(b,this.sortCollection,{container:this.$el})},_renderSearchVeiw:function(){this.searchView&&this.searchView.close(),this.searchView=new d({type:1}),this.listenTo(this.searchView,"search",function(a){var b=this.model.get("routerData");b.filterKey=a,this.model.set("routerData",b),this.changeStatusSort(),this.trigger("search")}),this.listenTo(this.searchView,"cancel",function(a){var b=this.model.get("routerData");b.filterKey="",this.model.set("routerData",b),a&&this.changeStatusSort(),this.trigger("clearSearch",a)}),this.ui.search.append(this.searchView.render().$el)},changeStatusSort:function(){this.statusCollection.reset(this.status),this.sortCollection.reset(this.sorts);var a=this.statusCollection.findWhere({active:!0});a&&this.$el.find("[data-name=status] .name").html(a.get("name"))},_removeActive:function(){this.$el.find(".active").removeClass("active")},_renderSortDropdownMenu:function(b,d,e){var f=e&&e.container?e.container:a.$("body"),g=this.model.get("routerData");this.sortDorpdownView&&this.sortDorpdownView.close(),this.sortDorpdownView=new c({collection:d}),this.listenTo(this.sortDorpdownView,"chose",function(a){g.filterKey="",this.model.set("routerData",g),this.$el.find("input").val(""),this.trigger("chose",a),this._removeActive()}),this.listenTo(this.sortDorpdownView,"close",function(){this._removeActive()}),f.append(this.sortDorpdownView.render().$el),this.sortDorpdownView.show(b,e)}})}),define("views/work/project-list-composite-view",["talent","templates/work","helpers/context","$.infotip","$.tipsy"],function(a,b,c){var d=a.ItemView.extend({template:b["work/project-list-composite-item"],tagName:"tr",ui:{delBtn:"[data-name=del]",iconTask:"[data-name=icon-task]",iconTalk:"[data-name=icon-talk]",projectTime:"[data-name=project-time]"},events:function(){var a={};return a["click "+this.ui.delBtn]="_delClickHandler",a},onRender:function(){this.ui.iconTask.tipsy({gravity:"s"}),this.ui.projectTime.tipsy({gravity:"s"})},initialize:function(){var a=this.model.get("principalUser");a.name=c.subString(a.name,12,!0),this.model.set("principalUser",a),this.model.set("statusColor");this.model.get("approvalStatus");isDeadLine=this.model.get("isDeadLine"),isDeadLine&&this.model.set("statusColor","#EE4344")},_delClickHandler:function(b){var c=$(b.currentTarget),d=c.parents("td"),e=this;d.addClass("active"),c.infotip({placement:"top",align:"right",type:"confirm",trigger:"manual",hashead:!1,container:$("body").find(".tt-project-list"),body:"您确定删除吗？删除后不可恢复",okHide:function(){a.app.request("Project:updateData",{data:{work_id:e.model.get("workId")},handler:"Delete"}).done(function(){c.infotip("hide"),e.$el.remove()}).fail(function(a){c.infotip("hide"),c.infotip({animation:!1,type:"attention",trigger:"manual",placement:"top",align:"right",container:"body",hasfoot:!1,body:a}),c.infotip("show")})}}),c.infotip("show"),c.on("hidden",function(){d.removeClass("active")})}});return a.CompositeView.extend({defaults:{showTags:!0,dataTrigger:!0,targetBlank:!1,useHrefFromModel:!1},template:b["work/project-list-composite"],itemViewContainer:"tbody",itemView:d,className:"tt-project-list",ui:{projectName:"[data-name=project-name]",tag:"[data-name=tag]"},events:function(){var a={};return this.settings.dataTrigger&&(a["click "+this.ui.projectName]="_nameClickHandler"),a},itemViewOptions:function(){return{templateHelpers:{routerData:this.model.get("routerData"),showTags:this.settings.showTags,dataTrigger:this.settings.dataTrigger,targetBlank:this.settings.targetBlank,href:"//"+location.host+location.pathname,UserId:c.getUserInfo().Id,useHrefFromModel:this.settings.useHrefFromModel}}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options)},onRender:function(){this.ui.tag.tipsy({gravity:"s"})},_nameClickHandler:function(b){var c=a.$(b.currentTarget);a.app.vent.trigger("tab:_tita_work:change",c)},onClose:function(){$("body").find(".tipsy").remove()}})}),define("views/work/project-list-main-search-dialog-view",function(){}),define("views/work/project-list-main-user-history-view",["talent","templates/work"],function(a,b){var c=a.ItemView.extend({template:b["work/project-list-main-user-history-item"],tagName:"li",className:"history-item",ui:{del:"[data-name=delete-item]"},modelEvents:{change:"render"},events:function(){var a={};return a["click "+this.ui.del]="_clickDelHandler",a},_clickDelHandler:function(){this.trigger("del"),this.remove()}});return a.CompositeView.extend({template:b["work/project-list-main-user-history"],itemView:c,itemViewContainer:"ul",className:"tt-search-history-by-user",events:{"click [data-name=clear]":"_clickClearHanler"},initialize:function(){var a=this;this.on("itemview:del",function(b){a.collection.remove(b.model)})},_clickClearHanler:function(){this.collection.reset()}})}),define("views/common/empty-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{emptyContext:""},template:b["common/empty"],className:"tt_common_emptyinit",initialize:function(a){this.settings=Talent._.extend({},this.defaults,a)},templateHelpers:function(){var a=this.settings.emptyContext?this.settings.emptyContext:this.model.get("emptyContext"),b=0;return a&&(b=a.replace(/<[^>].*?>/g,"").replace(/[&nbsp;]/g,"").length),{emptyContext:a,className:b>24?"small_content_emptyinit":"content_emptyinit"}}})}),!function(a){function b(b){this.itemsCount=b.itemsCount,this.pageSize=b.pageSize,this.displayPage=b.displayPage<5?5:b.displayPage,this.pages=Math.ceil(b.itemsCount/b.pageSize)||1,this.total=a.isNumeric(b.pages)&&(this.pages=b.pages),this.currentPage=b.currentPage,this.styleClass=b.styleClass,this.onSelect=b.onSelect,this.showCtrl=b.showCtrl||!1,this.remote=b.remote,this.displayInfoType=b.displayInfoType}b.prototype={_draw:function(){for(var a='<div class="tu-pagination-container tu-clearfix"><div class="tu-pagination-total"></div><div class="tu-pagination',b=0;b<this.styleClass.length;b++)a+=" "+this.styleClass[b];a+='"></div></div>',this.hookNode.html(a),this._drawInner(),this._drawTotal()},_drawTotal:function(){if(this.itemsCount&&this.displayInfoType){var a=this.hookNode.find(".tu-pagination-total"),b=this.pageSize*this.currentPage-this.pageSize+1,c=this.currentPage==this.pages?this.itemsCount:this.pageSize*this.currentPage,d="显示 <span>"+b+"</span>－<span>"+c+"</span> 项，共<span>"+this.itemsCount+"</span>项";a.html(d)}},_drawInner:function(){var a=this.hookNode.find(".tu-pagination"),b='<ul><li class="prev'+(this.currentPage-1<=0?" disabled":" ")+'"><a href="javascript:void(0)"  data="'+(this.currentPage-1)+'">&lt;</a></li>';if(this.pages<=this.displayPage||this.pages==this.displayPage+1)for(var c=1;c<this.pages+1;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>";else if(this.currentPage<this.displayPage-1){for(var c=1;c<this.displayPage;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>";b+='<li class="dotted"><span>...</span></li>',b+='<li><a href="javascript:void(0)"  data="'+this.pages+'">'+this.pages+"</a></li>"}else if(this.currentPage>this.pages-this.displayPage+2&&this.currentPage<=this.pages){b+='<li><a href="javascript:void(0)"  data="1">1</a></li>',b+='<li class="dotted"><span>...</span></li>';for(var c=this.pages-this.displayPage+2;c<=this.pages;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>"}else{b+='<li><a href="javascript:void(0)"  data="1">1</a></li>',b+='<li class="dotted"><span>...</span></li>';var d,e,f=(this.displayPage-3)/2;(this.displayPage-3)%2==0?d=e=f:(d=Math.floor(f),e=Math.ceil(f));for(var c=this.currentPage-d;c<=this.currentPage+e;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>";b+='<li class="dotted"><span>...</span></li>',b+='<li><a href="javascript:void(0)"  data="'+this.pages+'">'+this.pages+"</a></li>"}b+='<li class="next'+(this.currentPage+1>this.pages?" disabled":" ")+'"><a href="javascript:void(0)"  data="'+(this.currentPage+1)+'">&gt;</a></li></ul>',this.showCtrl&&(b+=this._drawCtrl()),a.html(b)},_drawCtrl:function(){var a='<div>&nbsp;<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>';return a},_ctrl:function(){function b(){var b=parseInt(d.find(".page-num").val());a.isNumeric(b)&&b<=c.pages&&b>0&&(c.remote||(c.currentPage=b,c._drawInner()),a.isFunction(c.onSelect)&&c.onSelect.call(a(this),b))}var c=this,d=c.hookNode.children(".tu-pagination");d.on("click",".page-confirm",function(){b.call(this)}),d.on("keypress",".page-num",function(a){13==a.which&&b.call(this)})},_select:function(){var b=this;b.hookNode.find(".tu-pagination").on("click","a",function(c){c.preventDefault();var d=parseInt(a(this).attr("data"));a(this).parent().hasClass("disabled")||a(this).parent().hasClass("active")||(b.remote||(b.currentPage=d,b._drawInner(),b._drawTotal()),a.isFunction(b.onSelect)&&b.onSelect.call(a(this),d))})},init:function(a,b){return this.hookNode=b,this._draw(),this._select(),this.showCtrl&&this._ctrl(),this},updateItemsCount:function(b,c){this.itemsCount=b,a.isNumeric(b)&&(this.pages=Math.ceil(b/this.pageSize)),this.currentPage=this.currentPage>this.pages?this.pages:this.currentPage,a.isNumeric(c)&&(this.currentPage=c),this._drawInner(),this._drawTotal()},updatePages:function(b,c){a.isNumeric(b)&&(this.pages=b),this.currentPage=this.currentPage>this.pages?this.pages:this.currentPage,a.isNumeric(c)&&(this.currentPage=c),this._drawInner(),this._drawTotal()},goToPage:function(b){a.isNumeric(b)&&b<=this.pages&&b>0&&(this.currentPage=b,this._drawInner(),this._drawTotal())}};var c=a.fn.TPagination;a.fn.TPagination=function(c){var d=a.extend({},a.fn.TPagination.defaults,"object"==typeof c&&c);"string"==typeof c&&(args=a.makeArray(arguments),args.shift());var e=a(this),f=e.data("tu-pagination");return f?"string"==typeof c&&f[c].apply(f,args):e.data("tu-pagination",f=new b(d).init(d,a(this))),f},a.fn.TPagination.Constructor=b,a.fn.TPagination.noConflict=function(){return a.fn.pagination=c,this},a.fn.TPagination.defaults={pageSize:20,pages:null,displayPage:8,currentPage:1,itemsCount:0,displayInfoType:!0,styleClass:[],onSelect:null,remote:!1}}(window.jQuery),define("$.pagination",function(){}),define("views/work/project-list-main-view",["talent","templates/work","views/work/project-create-view","views/work/project-list-main-screen-view","views/work/project-list-composite-view","views/work/project-list-main-search-dialog-view","UserSelector","collections/smember-group-collection","views/work/project-list-main-user-history-view","views/common/empty-view","$.tipsy","helpers/context","$.pagination"],function(a,b,c,d,e,f,g,h,i,j,k,l){return sortMapping={status:{"进行中":1,"已完成":2},sorts:{"创建时间":{down:1,up:2},"开始时间":{down:3,up:4},"结束时间":{down:5,up:6},"完成时间":{down:7,up:8}}},a.ItemView.extend({defaults:function(){l.getI18n();return{title:{relationsearch:"搜索结果",relation0:"星标",relation1:"我负责的",relation2:"我参与的",relation3:"我关注的",relation4:"所有公开的"},isShowApproval:!1,isShowCretae:!1}},template:b["work/project-list-main"],className:"project_main_region",templateHelpers:function(){return delete this.settings.title,a._.extend({},this.settings,{i18n:this.i18n,userId:this.userInfo.Id,isUseWork:this.tenant_function.IsUseWork})},modelEvents:{"change:routerData":"changeRouterData","change:isShowCretae":"render"},ui:{projectScreen:"[data-name=project-screen]",projectList:"[data-name=project-list]",pagination:"[data-name=pagination]",searchBtn:"[data-name=search-btn]",userSelect:"[data-name=user-select]",userHistory:"[data-name=user-history-warp]",search:"[data-name=project-search]"},events:function(){var a={};return a["click "+this.ui.searchBtn]="_clickSearchBtnHandler",a["click "+this.ui.userSelect]="_clickUserSelectHandler",a},initialize:function(){this.i18n=l.getI18n(),this.tenant_function=l.getGlobal("tenant_function"),this.userInfo=l.getUserInfo(),this.settings=a._.extend({},this.defaults(),this.options),this.changeRouterData()},changeRouterData:function(){var a=this.model.get("routerData"),b=this.defaults();if(this.userInfo.Id==a.to_user_id)this.model.set("title",b.title["relation"+a.relation]);else{var c=b.title["relation"+a.relation];this.model.set("title",c.replace("我","ta")),this.settings.isShowCretae=!1}},onShow:function(){this.$el.find("[original-title]").tipsy({gravity:"s"})},onRender:function(){var a=this.model.get("routerData");this._showPagination(),this._renderScreenView(),this._renderListView(),1!=a.relation&&this._renderUserSelectView()},_renderScreenView:function(){var a=(this.model.get("data").total,this.model.get("routerData"));this.screenView&&this.screenView.close(),this.screenView=new d({model:this.model}),this.listenTo(this.screenView,"chose",function(a){this._dealSortData(a.toJSON())}),this.listenTo(this.screenView,"search",function(){a.orderType=1,a.status=1,this.ui.userHistory.hide(),this.userCollection.reset(),this._getListData()}),this.listenTo(this.screenView,"clearSearch",function(b){b&&(a.orderType=1,a.status=1,this.ui.userHistory.hide(),this.userCollection.reset()),this._getListData()}),this.ui.projectScreen.append(this.screenView.render().$el)},_dealSortData:function(a){var b=this.model.get("routerData");a.isSort.show?b.orderType=sortMapping.sorts[a.name][a.isSort.type]:b.status=sortMapping.status[a.name],b.pageIndex=1,this.ui.pagination.TPagination("goToPage",1),this.model.set("routerData",b),this._getListData()},_getListData:function(){var a,b=this.model.get("routerData"),c=this,d={relation:b.relation,appId:b.appId,appType:b.appType,status:b.status,orderType:b.orderType,searchObj:b.searchObj||[],pageNum:b.pageIndex||1,filterKey:b.filterKey||"",pageSize:20,toUserId:b.to_user_id};a=4!=b.relation?this._getListDataAPI(d):this._getTenantListDataAPI(d),a.done(function(a){a.total?(c.ui.pagination.show(),c.ui.pagination.TPagination("updateItemsCount",a.total)):c.ui.pagination.hide(),a.works&&a.works.length?(c._keyWordShow(b.filterKey,a.works),c.collection.reset(a.works)):c.collection.reset(),c._renderListView()}).fail(function(){})},_keyWordShow:function(b,c){return b?(a._.each(c,function(a){var c=new RegExp(b,"g");a.workName=a.workName.replace(c,"<span class=keyword>"+b+"</span>")}),c):c},_getListDataAPI:function(b){var c=new a.$.Deferred;return a.app.request("WorkV2:getWorkList",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},_getTenantListDataAPI:function(b){var c=new a.$.Deferred;return a.app.request("WorkV2:getTenantWorkList",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},_renderListView:function(){if(this._closeView(),this.collection.length)this.projectListCompositeView&&this.projectListCompositeView.close(),this.projectListCompositeView=new e({collection:this.collection,model:this.model,useHrefFromModel:!0}),this.ui.projectList.append(this.projectListCompositeView.render().$el);else{var a=this.model.get("routerData").status,b=this.model.get("routerData").relation,c="";this.emptyView&&this.emptyView.close(),(1==a||2==a)&&(1==b?c="tita帮你来管理团队协作，并随时追踪事情的进展":2==b?c="如有同事将你加为成员，参与的事项将会显示在这里":3==b?c="你关注过的项目将会显示到这里，记得留意最新动态哦":4==b&&(c="你可以关注感兴趣的项目，获取动态")),this.emptyView=new j({emptyContext:c}),this.ui.projectList.empty(),this.ui.projectList.append(this.emptyView.render().$el)}},_renderUserSelectView:function(){var b=this,c=this.$el.find("[data-name=select]");this.userCollection=new a.Collection,this.userCollection.on("remove reset add",function(){b._dealUserCollectionData()}),this.userSelectorView=new g({collection:new h}),this.userSelectorView.addNode(c,{viewType:"single",input:!0,muti:!0}),c.on("submit",function(a,c){a.stopPropagation();var d=b.model.get("routerData");d.filterKey="",b.model.set("routerData",d),b.smemberSelect(c),b._renderUserHistoryView()})},smemberSelect:function(b){b.data?(a._.each(b.data,function(a){a.Id&&(a.id=a.Id,a.name=a.Name)}),this.userCollection.add(b.data)):(b.id=b.Id,b.name=b.Name,this.userCollection.add(b))},_dealUserCollectionData:function(){var b=this.userCollection,c=[],d=this.model.get("routerData");b.length?(this.ui.userHistory.show(),a._.each(b.toJSON(),function(a){var b={};b=a.type&&"department"==a.type?{Id:a.id,Name:a.name,Email:a.name+":"+a.id+":dep_members"}:{Id:a.id,Name:a.name,Email:a.Email},c.push(b)}),d.searchObj=c):(d.searchObj=[],this.ui.userHistory.hide()),d.pageIndex=1,this.model.set("routerData",d),this._getListData(),this.ui.pagination.TPagination("goToPage",1)},_renderUserHistoryView:function(){this.userHistoryView||(this.userHistoryView=new i({collection:this.userCollection}),this.ui.userHistory.append(this.userHistoryView.render().$el))},_clickSearchBtnHandler:function(a){$(a.currentTarget)},_showPagination:function(){var a=this,b=this.model.get("data").total,c=this.model.get("routerData");b||this.ui.pagination.hide(),this.ui.pagination.TPagination({styleClass:["pagination-large"],pageSize:20,itemsCount:b,displayInfoType:"itemsCount",onSelect:function(b){b!=c.pageIndex&&(c.pageIndex=b,a.model.set("routerData",c),a._getListData(),$(".tu-page-container").scrollTop(0))}})},_clickProjectCreateBtnHandler:function(a){this.tenant_function.IsUseWork||(a.stopPropagation(),this.projectCreateView&&this.projectCreateView.close(),this.projectCreateView=new c,this.$el.append(this.projectCreateView.render().$el),this.projectCreateView.show())},_closeView:function(){this.projectListCompositeView&&this.projectListCompositeView.close(),this.emptyView&&this.emptyView.close()},onClose:function(){this.delDialog&&this.delDialog.close(),this.failDialog&&this.failDialog.close(),a.$(".tipsy").remove()
}})}),define("views/work/from-app-view",["talent","templates/work"],function(a){return a.View.extend({postData:function(b){var c=this.options.routerData;if("402"==c.appId&&"402"==c.appType){var d=a.Context.getGlobal("env"),e="develop"==d?"goal.tita-inc.com":"Testing"==d?"qa.goal.tita.com":"goal.tita.com",f=(new Date).getTime(),g="http://"+e+"/Goal/TitaUpdateGoal?workId="+b+"&v="+f,h='<img src="'+g+'" id="iframe_app_id_402"/ style="display:none"/>',i=a.$("#iframe_app_id_402");i.length?i.attr("src",g):a.$("body").append(h)}}})}),define("views/work/common/project-action-item-view",["talent","templates/work","tdialog","views/work/from-app-view","helpers/context"],function(a,b,c,d,e){return a.ItemView.extend({template:b["work/common/project-list-action/project-list-action"],initialize:function(b){var b=b||{},c=this;this.modelEvents=b.modelEvents?b.modelEvents:this.modelEvents,this.model.set("IsMark",!1),this.i18n=e.getI18n(),this.iWork=this.i18n.work_1,this.model.set("i18n",this.i18n),a.$("body").on("click.project_action",function(){c.$el.find(".dropdown_range").hide()})},templateHelpers:function(){var a=e.getGlobal("tenant_function").IsOpenImportTasks;return{hasOpenImport:a}},ui:{btnList:".btn-list",importTask:'[data-name="import-task" ]',importMilePost:'[data-name="import-milepost" ]',operateBtn:".project_detail_operate_btn"},events:function(){var a={};return a["click li"]="onHandler",a["click "+this.ui.operateBtn]="_showBtnList",a["click "+this.ui.importTask]="_importPop",a["click "+this.ui.importMilePost]="_importPop",a},modelEvents:{"change:IsFollow":"render","change:IsMark":"render"},onRender:function(){var a=this;this.model.get("IsPrincipal")?this.$el.addClass("project_detail_top_btn_creater"):this.$el.removeClass("project_detail_top_btn_creater"),$(document).off("click.project-detail-action"),$(document).on("click.project-detail-action",function(b){var c=$(b.target);return c.hasClass("project_detail_operate_btn")||c.parents(".project_detail_operate_btn").length?!1:void a.$el.find(".btn-list").hide()}),0==a.$el.find(".btn-list li").length&&a.$el.html("")},_importPop:function(a){var b=$(a.currentTarget);"import-task"==b.data("name")?this.trigger("popImport",{type:"task"}):this.trigger("popImport",{type:"milepost"})},_showBtnList:function(b){var c=a.$(b.currentTarget),d=c.offset();"none"==this.ui.btnList.css("display")?this.ui.btnList.css({top:d.top+30,left:d.left-38}).show():this.ui.btnList.hide()},onHandler:function(b){var c=a.$(b.currentTarget).attr("data-handler");this[c+"Handler"]&&this[c+"Handler"](b)},CloseHandler:function(b){function c(){d.operateRequest(h,{})}var d=this,e=a.$(b.currentTarget),f=this.model.get("Status"),g=2==f?"确定要重新开启该"+this.iWork+"？":"确定该"+this.iWork+"已完成",h=2==f?"Start":"Close";this.showConfirm(e,g,c)},DeleteHandler:function(b){function c(){d.operateRequest(g,{})}var d=this,e=a.$(b.currentTarget),f="所有数据都将被删除且不可恢复！确定删除？",g="Delete";this.showConfirm(e,f,c)},MarkHandler:function(){1==this.model.get("IsMark")?!1:!0;this.model.set("IsMark",!0)},PaticipateHandler:function(b){function c(){d.operateRequest(h,{to_user_ids:e.getUserInfo().Id})}var d=this,f=a.$(b.currentTarget),g="确定要退出吗？再次加入需要联系负责人",h="DelMember";this.showConfirm(f,g,c)},RangeHandler:function(a){a.stopPropagation(),this.$el.find(".dropdown_range").show()},changeRange:function(b){function c(){d.$el.find(".dropdown_range li").toggleClass("active"),d.operateRequest("Visibility",{visibility:f})}var d=this,e=a.$(b.currentTarget);if(!e.hasClass("active")){var f=e.attr("data-type"),g=this.model.get("IsVisible");2==g&&1==f?this.showConfirm(this.$el.find(".auth_btn"),"确定要改成公开吗？之前发表的内容将会被公开！",c):c()}},FollowHandler:function(b){function c(){d.operateRequest(g,{to_user_ids:e.getUserInfo().Id}),d.model.set("IsFollow",!f),a.app.vent.trigger("detail:_tita_work:operate")}var d=this,f=this.model.get("IsFollow"),g=1==f?"CancelFollow":"Follow",h=a.$(b.currentTarget);1==f?this.showConfirm(h,'确定取消关注？取消后进展信息将不再<br>推送到"动态"下',c):(this.operateRequest(g,{to_user_ids:e.getUserInfo().Id}).done(function(){d._tipDialog(d.ui.operateBtn,"关注成功，默认所有进展将推送到动态下。",{autoHide:!1})}),this.model.set("IsFollow",!f))},showConfirm:function(a,b,d){var e=this,a=this.$el;this.delDialog||(this.delDialog=new c({fixed:!1,cancel:!0,sure:function(){e.delDialog.$el.hide(),d()}}),this.delDialog.render().$el.appendTo("body")),this.delDialog.show(a,b,{pos:"bottomRight",className:"ask",arrow:!1,leftBias:-30})},_tipDialog:function(a,b,d,e){this.tipDialog&&this.tipDialog.close(),this.tipDialog=new c({type:"tipsy",sure:!1,quirkTheme:!0,cancel:!0,cancelText:"关闭"}),$("body").append(this.tipDialog.render().$el);var f=!1,g=0,h="bottomRight";e&&e.topBias&&(g=e.topBias),e&&e.pos&&(h=e.pos),this.tipDialog.show(a,b,{pos:h,className:"success",arrow:!1,autoHide:f,topBias:g})},operateRequest:function(b,c){{var d=this,e=this.model.get("WorkId");this.model.get("IsVisible")}c.work_id=e;var f={handler:b,data:c},g=a.app.request("Project:updateData",f);return g.done(function(c){d.formApp(),"Mark"!=b&&"Follow"!=b&&"CancelFollow"!=b&&("Delete"==b&&(d.model.get("IsManage")&&0==d.model.get("routerData").relation?a.app.execute("history:navigate","management",!0):a.app.execute("history:navigate","work",!0)),a.app.vent.trigger("detail:_tita_work:operate",{resp:c,handler:b}))}).fail(function(){a.app.vent.trigger("detail:_tita_work:operate")}),g},onClose:function(){a.$("body").off("click.project_action"),this.delDialog&&this.delDialog.close(),this.tipDialog&&this.tipDialog.close()},formApp:function(){this.fromAppView||(this.fromAppView=new d({routerData:this.model.get("routerData")})),this.fromAppView.postData(this.model.get("WorkId"))}})}),!function(a){function b(){return new Date(Date.UTC.apply(Date,arguments))}var c=function(b,c){var f=this;this.element=a(b),this.language=c.language||this.element.data("date-language")||"en",this.language=this.language in d?this.language:"en",this.isRTL=d[this.language].rtl||!1,this.formatType=c.formatType||this.element.data("format-type")||"standard",this.format=e.parseFormat(c.format||this.element.data("date-format")||d[this.language].format||e.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar").parent():!1,this.componentReset=this.element.is(".date")?this.element.find(".add-on .icon-remove").parent():!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=c.linkField||this.element.data("link-field")||!1,this.linkFormat=e.parseFormat(c.linkFormat||this.element.data("link-format")||e.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=c.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=c.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=c.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=c.initialDate||new Date,this._attachEvents(),this.formatViewType="datetime","formatViewType"in c?this.formatViewType=c.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in c?this.minView=c.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=e.convertViewMode(this.minView),this.maxView=e.modes.length-1,"maxView"in c?this.maxView=c.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=e.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in c?this.wheelViewModeNavigation=c.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in c?this.wheelViewModeNavigationInverseDirection=c.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in c?this.wheelViewModeNavigationDelay=c.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in c?this.startViewMode=c.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=e.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in c?this.viewSelect=c.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=e.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in c?this.forceParse=c.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse")),this.picker=a(e.template).appendTo(this.isInline?this.element:"body").on({click:a.proxy(this.click,this),mousedown:a.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(a.fn.mousewheel?this.picker.on({mousewheel:a.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.picker.addClass(this.isInline?"datetimepicker-inline":"datetimepicker-dropdown-"+this.pickerPosition+" dropdown-menu"),this.isRTL&&(this.picker.addClass("datetimepicker-rtl"),this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),a(document).on("mousedown",function(b){0===a(b.target).closest(".datetimepicker").length&&f.hide()}),this.autoclose=!1,"autoclose"in c?this.autoclose=c.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in c?this.keyboardNavigation=c.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=c.todayBtn||this.element.data("date-today-btn")||!1,this.todayHighlight=c.todayHighlight||this.element.data("date-today-highlight")||!1,this.weekStart=(c.weekStart||this.element.data("date-weekstart")||d[this.language].weekStart||0)%7,this.weekEnd=(this.weekStart+6)%7,this.startDate=-1/0,this.endDate=1/0,this.daysOfWeekDisabled=[],this.setStartDate(c.startDate||this.element.data("date-startdate")),this.setEndDate(c.endDate||this.element.data("date-enddate")),this.setDaysOfWeekDisabled(c.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.isInline&&this.show()};c.prototype={constructor:c,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}],[this.component,{click:a.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:a.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:a.proxy(this.show,this)}]];for(var b,c,d=0;d<this._events.length;d++)b=this._events[d][0],c=this._events[d][1],b.on(c)},_detachEvents:function(){for(var a,b,c=0;c<this._events.length;c++)a=this._events[c][0],b=this._events[c][1],a.off(b);this._events=[]},show:function(b){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.forceParse&&this.update(),this.place(),a(window).on("resize",a.proxy(this.place,this)),b&&(b.stopPropagation(),b.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(){this.isVisible&&(this.isInline||(this.picker.hide(),a(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||a(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date})))},remove:function(){this._detachEvents(),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var a=this.getUTCDate();return new Date(a.getTime()+6e4*a.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(a){this.setUTCDate(new Date(a.getTime()-6e4*a.getTimezoneOffset()))},setUTCDate:function(a){a>=this.startDate&&a<=this.endDate?(this.date=a,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:a,startDate:this.startDate,endDate:this.endDate})},setFormat:function(a){this.format=e.parseFormat(a,this.formatType);var b;this.isInput?b=this.element:this.component&&(b=this.element.find("input")),b&&b.val()&&this.setValue()},setValue:function(){var b=this.getFormattedDate();this.isInput?this.element.val(b):(this.component&&this.element.find("input").val(b),this.element.data("date",b)),this.linkField&&a("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(a){return void 0==a&&(a=this.format),e.formatDate(this.date,a,this.language,this.formatType)},setStartDate:function(a){this.startDate=a||-1/0,this.startDate!==-1/0&&(this.startDate=e.parseDate(this.startDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setEndDate:function(a){this.endDate=a||1/0,1/0!==this.endDate&&(this.endDate=e.parseDate(this.endDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(b){this.daysOfWeekDisabled=b||[],a.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=a.map(this.daysOfWeekDisabled,function(a){return parseInt(a,10)}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var b,c,d,e=parseInt(this.element.parents().filter(function(){return"auto"!=a(this).css("z-index")}).first().css("z-index"))+10;this.component?(b=this.component.offset(),d=b.left,("bottom-left"==this.pickerPosition||"top-left"==this.pickerPosition)&&(d+=this.component.outerWidth()-this.picker.outerWidth())):(b=this.element.offset(),d=b.left),c="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?b.top-this.picker.outerHeight():b.top+this.height,this.picker.css({top:c,left:d,zIndex:e})}},update:function(){var a,b=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(a=arguments[0],b=!0):a=this.element.data("date")||(this.isInput?this.element.val():this.element.find("input").val())||this.initialDate,a||(a=new Date,b=!1),this.date=e.parseDate(a,this.format,this.language,this.formatType),b&&this.setValue(),this.viewDate=new Date(this.date<this.startDate?this.startDate:this.date>this.endDate?this.endDate:this.date),this.fill()},fillDow:function(){for(var a=this.weekStart,b="<tr>";a<this.weekStart+7;)b+='<th class="dow">'+d[this.language].daysMin[a++%7]+"</th>";b+="</tr>",this.picker.find(".datetimepicker-days thead").append(b)},fillMonths:function(){for(var a="",b=0;12>b;)a+='<span class="month">'+d[this.language].monthsShort[b++]+"</span>";this.picker.find(".datetimepicker-months td").html(a)},fill:function(){if(null!=this.date&&null!=this.viewDate){var c=new Date(this.viewDate),f=c.getUTCFullYear(),g=c.getUTCMonth(),h=c.getUTCDate(),i=c.getUTCHours(),j=c.getUTCMinutes(),k=this.startDate!==-1/0?this.startDate.getUTCFullYear():-1/0,l=this.startDate!==-1/0?this.startDate.getUTCMonth():-1/0,m=1/0!==this.endDate?this.endDate.getUTCFullYear():1/0,n=1/0!==this.endDate?this.endDate.getUTCMonth():1/0,o=new b(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),p=new Date;if(this.picker.find(".datetimepicker-days thead th:eq(1)").text(d[this.language].months[g]+" "+f),"zh-CN"==this.language&&this.picker.find(".datetimepicker-days thead th:eq(1)").text(f+"年"+d[this.language].months[g]),"time"==this.formatViewType){var q=i%12?i%12:12,r=(10>q?"0":"")+q,s=(10>j?"0":"")+j,t=d[this.language].meridiem[12>i?0:1];this.picker.find(".datetimepicker-hours thead th:eq(1)").text(r+":"+s+" "+t.toUpperCase()),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(r+":"+s+" "+t.toUpperCase())}else this.picker.find(".datetimepicker-hours thead th:eq(1)").text(h+" "+d[this.language].months[g]+" "+f),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(h+" "+d[this.language].months[g]+" "+f),"zh-CN"==this.language&&(this.picker.find(".datetimepicker-hours thead th:eq(1)").text(f+"年"+d[this.language].months[g]+h+"日"),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(f+"年"+d[this.language].months[g]+h+"日"));this.picker.find("tfoot th.today").text(d[this.language].today).toggle(this.todayBtn!==!1),this.updateNavArrows(),this.fillMonths();var u=b(f,g-1,28,0,0,0,0),v=e.getDaysInMonth(u.getUTCFullYear(),u.getUTCMonth());u.setUTCDate(v),u.setUTCDate(v-(u.getUTCDay()-this.weekStart+7)%7);var w=new Date(u);w.setUTCDate(w.getUTCDate()+42),w=w.valueOf();for(var x,y=[];u.valueOf()<w;)u.getUTCDay()==this.weekStart&&y.push("<tr>"),x="",u.getUTCFullYear()<f||u.getUTCFullYear()==f&&u.getUTCMonth()<g?x+=" old":(u.getUTCFullYear()>f||u.getUTCFullYear()==f&&u.getUTCMonth()>g)&&(x+=" new"),this.todayHighlight&&u.getUTCFullYear()==p.getFullYear()&&u.getUTCMonth()==p.getMonth()&&u.getUTCDate()==p.getDate()&&(x+=" today"),u.valueOf()==o&&(x+=" active"),(u.valueOf()+864e5<=this.startDate||u.valueOf()>this.endDate||-1!==a.inArray(u.getUTCDay(),this.daysOfWeekDisabled))&&(x+=" disabled"),y.push('<td class="day'+x+'">'+u.getUTCDate()+"</td>"),u.getUTCDay()==this.weekEnd&&y.push("</tr>"),u.setUTCDate(u.getUTCDate()+1);this.picker.find(".datetimepicker-days tbody").empty().append(y.join("")),y=[];for(var z="",A="",B="",C=0;24>C;C++){var D=b(f,g,h,C);x="",D.valueOf()+36e5<=this.startDate||D.valueOf()>this.endDate?x+=" disabled":i==C&&(x+=" active"),this.showMeridian&&2==d[this.language].meridiem.length?(A=12>C?d[this.language].meridiem[0]:d[this.language].meridiem[1],A!=B&&(""!=B&&y.push("</fieldset>"),y.push('<fieldset class="hour"><legend>'+A.toUpperCase()+"</legend>")),B=A,z=C%12?C%12:12,y.push('<span class="hour'+x+" hour_"+(12>C?"am":"pm")+'">'+z+"</span>"),23==C&&y.push("</fieldset>")):(z=C+":00",y.push('<span class="hour'+x+'">'+z+"</span>"))}this.picker.find(".datetimepicker-hours td").html(y.join("")),y=[],z="",A="",B="";for(var C=0;60>C;C+=this.minuteStep){var D=b(f,g,h,i,C,0);x="",D.valueOf()<this.startDate||D.valueOf()>this.endDate?x+=" disabled":Math.floor(j/this.minuteStep)==Math.floor(C/this.minuteStep)&&(x+=" active"),this.showMeridian&&2==d[this.language].meridiem.length?(A=12>i?d[this.language].meridiem[0]:d[this.language].meridiem[1],A!=B&&(""!=B&&y.push("</fieldset>"),y.push('<fieldset class="minute"><legend>'+A.toUpperCase()+"</legend>")),B=A,z=i%12?i%12:12,y.push('<span class="minute'+x+'">'+z+":"+(10>C?"0"+C:C)+"</span>"),59==C&&y.push("</fieldset>")):(z=C+":00",y.push('<span class="minute'+x+'">'+i+":"+(10>C?"0"+C:C)+"</span>"))}this.picker.find(".datetimepicker-minutes td").html(y.join(""));var E=this.date.getUTCFullYear(),F=this.picker.find(".datetimepicker-months").find("th:eq(1)").text(f).end().find("span").removeClass("active");E==f&&F.eq(this.date.getUTCMonth()).addClass("active"),(k>f||f>m)&&F.addClass("disabled"),f==k&&F.slice(0,l).addClass("disabled"),f==m&&F.slice(n+1).addClass("disabled"),y="",f=10*parseInt(f/10,10);var G=this.picker.find(".datetimepicker-years").find("th:eq(1)").text(f+"-"+(f+9)).end().find("td");f-=1;for(var C=-1;11>C;C++)y+='<span class="year'+(-1==C||10==C?" old":"")+(E==f?" active":"")+(k>f||f>m?" disabled":"")+'">'+f+"</span>",f+=1;G.html(y),this.place()}},updateNavArrows:function(){var a=new Date(this.viewDate),b=a.getUTCFullYear(),c=a.getUTCMonth(),d=a.getUTCDate(),e=a.getUTCHours();switch(this.viewMode){case 0:this.picker.find(".prev").css(this.startDate!==-1/0&&b<=this.startDate.getUTCFullYear()&&c<=this.startDate.getUTCMonth()&&d<=this.startDate.getUTCDate()&&e<=this.startDate.getUTCHours()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(1/0!==this.endDate&&b>=this.endDate.getUTCFullYear()&&c>=this.endDate.getUTCMonth()&&d>=this.endDate.getUTCDate()&&e>=this.endDate.getUTCHours()?{visibility:"hidden"}:{visibility:"visible"});break;case 1:this.picker.find(".prev").css(this.startDate!==-1/0&&b<=this.startDate.getUTCFullYear()&&c<=this.startDate.getUTCMonth()&&d<=this.startDate.getUTCDate()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(1/0!==this.endDate&&b>=this.endDate.getUTCFullYear()&&c>=this.endDate.getUTCMonth()&&d>=this.endDate.getUTCDate()?{visibility:"hidden"}:{visibility:"visible"});break;case 2:this.picker.find(".prev").css(this.startDate!==-1/0&&b<=this.startDate.getUTCFullYear()&&c<=this.startDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(1/0!==this.endDate&&b>=this.endDate.getUTCFullYear()&&c>=this.endDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"});break;case 3:case 4:this.picker.find(".prev").css(this.startDate!==-1/0&&b<=this.startDate.getUTCFullYear()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(1/0!==this.endDate&&b>=this.endDate.getUTCFullYear()?{visibility:"hidden"}:{visibility:"visible"})}},mousewheel:function(b){if(b.preventDefault(),b.stopPropagation(),!this.wheelPause){this.wheelPause=!0;var c=b.originalEvent,d=c.wheelDelta,e=d>0?1:0===d?0:-1;this.wheelViewModeNavigationInverseDirection&&(e=-e),this.showMode(e),setTimeout(a.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay)}},click:function(c){c.stopPropagation(),c.preventDefault();var d=a(c.target).closest("span, td, th, legend");if(1==d.length){if(d.is(".disabled"))return void this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});switch(d[0].nodeName.toLowerCase()){case"th":switch(d[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var f=e.modes[this.viewMode].navStep*("prev"==d[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,f);break;case 1:this.viewDate=this.moveDate(this.viewDate,f);break;case 2:this.viewDate=this.moveMonth(this.viewDate,f);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,f)}this.fill();break;case"today":var g=new Date;g=b(g.getFullYear(),g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),0),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(g),this.fill(),this.autoclose&&this.hide()}break;case"span":if(!d.is(".disabled")){var h=this.viewDate.getUTCFullYear(),i=this.viewDate.getUTCMonth(),j=this.viewDate.getUTCDate(),k=this.viewDate.getUTCHours(),l=this.viewDate.getUTCMinutes(),m=this.viewDate.getUTCSeconds();if(d.is(".month")?(this.viewDate.setUTCDate(1),i=d.parent().find("span").index(d),j=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(i),this.element.trigger({type:"changeMonth",date:this.viewDate}),this.viewSelect>=3&&this._setDate(b(h,i,j,k,l,m,0))):d.is(".year")?(this.viewDate.setUTCDate(1),h=parseInt(d.text(),10)||0,this.viewDate.setUTCFullYear(h),this.element.trigger({type:"changeYear",date:this.viewDate}),this.viewSelect>=4&&this._setDate(b(h,i,j,k,l,m,0))):d.is(".hour")?(k=parseInt(d.text(),10)||0,(d.hasClass("hour_am")||d.hasClass("hour_pm"))&&(12==k&&d.hasClass("hour_am")?k=0:12!=k&&d.hasClass("hour_pm")&&(k+=12)),this.viewDate.setUTCHours(k),this.element.trigger({type:"changeHour",date:this.viewDate}),this.viewSelect>=1&&this._setDate(b(h,i,j,k,l,m,0))):d.is(".minute")&&(l=parseInt(d.text().substr(d.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(l),this.element.trigger({type:"changeMinute",date:this.viewDate}),this.viewSelect>=0&&this._setDate(b(h,i,j,k,l,m,0))),0!=this.viewMode){var n=this.viewMode;this.showMode(-1),this.fill(),n==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide()}break;case"td":if(d.is(".day")&&!d.is(".disabled")){var j=parseInt(d.text(),10)||1,h=this.viewDate.getUTCFullYear(),i=this.viewDate.getUTCMonth(),k=this.viewDate.getUTCHours(),l=this.viewDate.getUTCMinutes(),m=this.viewDate.getUTCSeconds();d.is(".old")?0===i?(i=11,h-=1):i-=1:d.is(".new")&&(11==i?(i=0,h+=1):i+=1),this.viewDate.setUTCFullYear(h),this.viewDate.setUTCDate(j),this.viewDate.setUTCMonth(i),this.element.trigger({type:"changeDay",date:this.viewDate}),this.viewSelect>=2&&this._setDate(b(h,i,j,k,l,m,0))}var n=this.viewMode;this.showMode(-1),this.fill(),n==this.viewMode&&this.autoclose&&this.hide()}}},_setDate:function(a,b){b&&"date"!=b||(this.date=a),b&&"view"!=b||(this.viewDate=a),this.fill(),this.setValue();var c;this.isInput?c=this.element:this.component&&(c=this.element.find("input")),c&&(c.change(),this.autoclose&&(!b||"date"==b)),this.element.trigger({type:"changeDate",date:this.date})},moveMinute:function(a,b){if(!b)return a;var c=new Date(a.valueOf());return c.setUTCMinutes(c.getUTCMinutes()+b*this.minuteStep),c},moveHour:function(a,b){if(!b)return a;var c=new Date(a.valueOf());return c.setUTCHours(c.getUTCHours()+b),c},moveDate:function(a,b){if(!b)return a;var c=new Date(a.valueOf());return c.setUTCDate(c.getUTCDate()+b),c},moveMonth:function(a,b){if(!b)return a;var c,d,e=new Date(a.valueOf()),f=e.getUTCDate(),g=e.getUTCMonth(),h=Math.abs(b);if(b=b>0?1:-1,1==h)d=-1==b?function(){return e.getUTCMonth()==g}:function(){return e.getUTCMonth()!=c},c=g+b,e.setUTCMonth(c),(0>c||c>11)&&(c=(c+12)%12);else{for(var i=0;h>i;i++)e=this.moveMonth(e,b);c=e.getUTCMonth(),e.setUTCDate(f),d=function(){return c!=e.getUTCMonth()}}for(;d();)e.setUTCDate(--f),e.setUTCMonth(c);return e},moveYear:function(a,b){return this.moveMonth(a,12*b)},dateWithinRange:function(a){return a>=this.startDate&&a<=this.endDate},keydown:function(a){if(this.picker.is(":not(:visible)"))return void(27==a.keyCode&&this.show());var b,c,d,e=!1;switch(a.keyCode){case 27:this.hide(),a.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;b=37==a.keyCode?-1:1,viewMode=this.viewMode,a.ctrlKey?viewMode+=2:a.shiftKey&&(viewMode+=1),4==viewMode?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):3==viewMode?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):2==viewMode?(c=this.moveDate(this.date,b),d=this.moveDate(this.viewDate,b)):1==viewMode?(c=this.moveHour(this.date,b),d=this.moveHour(this.viewDate,b)):0==viewMode&&(c=this.moveMinute(this.date,b),d=this.moveMinute(this.viewDate,b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 38:case 40:if(!this.keyboardNavigation)break;b=38==a.keyCode?-1:1,viewMode=this.viewMode,a.ctrlKey?viewMode+=2:a.shiftKey&&(viewMode+=1),4==viewMode?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):3==viewMode?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):2==viewMode?(c=this.moveDate(this.date,7*b),d=this.moveDate(this.viewDate,7*b)):1==viewMode?this.showMeridian?(c=this.moveHour(this.date,6*b),d=this.moveHour(this.viewDate,6*b)):(c=this.moveHour(this.date,4*b),d=this.moveHour(this.viewDate,4*b)):0==viewMode&&(c=this.moveMinute(this.date,4*b),d=this.moveMinute(this.viewDate,4*b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 13:if(0!=this.viewMode){var f=this.viewMode;this.showMode(-1),this.fill(),f==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide();a.preventDefault();break;case 9:this.hide()}if(e){var g;this.isInput?g=this.element:this.component&&(g=this.element.find("input")),g&&g.change(),this.element.trigger({type:"changeDate",date:this.date})}},showMode:function(a){if(a){var b=Math.max(0,Math.min(e.modes.length-1,this.viewMode+a));b>=this.minView&&b<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:b}),this.viewMode=b)}this.picker.find(">div").hide().filter(".datetimepicker-"+e.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(){this._setDate(null,"date")}},a.fn.datetimepicker=function(b){var d=Array.apply(null,arguments);return d.shift(),this.each(function(){var e=a(this),f=e.data("datetimepicker"),g="object"==typeof b&&b;f||e.data("datetimepicker",f=new c(this,a.extend({},a.fn.datetimepicker.defaults,g))),"string"==typeof b&&"function"==typeof f[b]&&f[b].apply(f,d)})},a.fn.datetimepicker.defaults={},a.fn.datetimepicker.Constructor=c;var d=a.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],suffix:["st","nd","rd","th"],today:"Today"}},e={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getDaysInMonth:function(a,b){return[31,e.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},getDefaultFormat:function(a,b){if("standard"==a)return"input"==b?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"==a)return"input"==b?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(a){if("standard"==a)return/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"==a)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(a,b){var c=a.replace(this.validParts(b),"\x00").split("\x00"),d=a.match(this.validParts(b));if(!c||!c.length||!d||0==d.length)throw new Error("Invalid date format.");return{separators:c,parts:d}},parseDate:function(e,f,g,h){if(e instanceof Date){var i=new Date(e.valueOf()-6e4*e.getTimezoneOffset());return i.setMilliseconds(0),i}if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(e)&&(f=this.parseFormat("yyyy-mm-dd",h)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(e)&&(f=this.parseFormat("yyyy-mm-dd hh:ii",h)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(e)&&(f=this.parseFormat("yyyy-mm-dd hh:ii:ss",h)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(e)){var j,k,l=/([-+]\d+)([dmwy])/,m=e.match(/([-+]\d+)([dmwy])/g);e=new Date;for(var n=0;n<m.length;n++)switch(j=l.exec(m[n]),k=parseInt(j[1]),j[2]){case"d":e.setUTCDate(e.getUTCDate()+k);break;case"m":e=c.prototype.moveMonth.call(c.prototype,e,k);break;case"w":e.setUTCDate(e.getUTCDate()+7*k);break;case"y":e=c.prototype.moveYear.call(c.prototype,e,k)}return b(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0)}var o,p,j,m=e&&e.match(this.nonpunctuation)||[],e=new Date(0,0,0,0,0,0,0),q={},r=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P"],s={hh:function(a,b){return a.setUTCHours(b)},h:function(a,b){return a.setUTCHours(b)},HH:function(a,b){return a.setUTCHours(12==b?0:b)},H:function(a,b){return a.setUTCHours(12==b?0:b)},ii:function(a,b){return a.setUTCMinutes(b)},i:function(a,b){return a.setUTCMinutes(b)
},ss:function(a,b){return a.setUTCSeconds(b)},s:function(a,b){return a.setUTCSeconds(b)},yyyy:function(a,b){return a.setUTCFullYear(b)},yy:function(a,b){return a.setUTCFullYear(2e3+b)},m:function(a,b){for(b-=1;0>b;)b+=12;for(b%=12,a.setUTCMonth(b);a.getUTCMonth()!=b;)a.setUTCDate(a.getUTCDate()-1);return a},d:function(a,b){return a.setUTCDate(b)},p:function(a,b){return a.setUTCHours(1==b?a.getUTCHours()+12:a.getUTCHours())}};if(s.M=s.MM=s.mm=s.m,s.dd=s.d,s.P=s.p,e=b(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()),m.length==f.parts.length){for(var n=0,t=f.parts.length;t>n;n++){if(o=parseInt(m[n],10),j=f.parts[n],isNaN(o))switch(j){case"MM":p=a(d[g].months).filter(function(){var a=this.slice(0,m[n].length),b=m[n].slice(0,a.length);return a==b}),o=a.inArray(p[0],d[g].months)+1;break;case"M":p=a(d[g].monthsShort).filter(function(){var a=this.slice(0,m[n].length),b=m[n].slice(0,a.length);return a==b}),o=a.inArray(p[0],d[g].monthsShort)+1;break;case"p":case"P":o=a.inArray(m[n].toLowerCase(),d[g].meridiem)}q[j]=o}for(var u,n=0;n<r.length;n++)u=r[n],u in q&&!isNaN(q[u])&&s[u](e,q[u])}return e},formatDate:function(b,c,f,g){if(null==b)return"";var h;if("standard"==g)h={yy:b.getUTCFullYear().toString().substring(2),yyyy:b.getUTCFullYear(),m:b.getUTCMonth()+1,M:d[f].monthsShort[b.getUTCMonth()],MM:d[f].months[b.getUTCMonth()],d:b.getUTCDate(),D:d[f].daysShort[b.getUTCDay()],DD:d[f].days[b.getUTCDay()],p:2==d[f].meridiem.length?d[f].meridiem[b.getUTCHours()<12?0:1]:"",h:b.getUTCHours(),i:b.getUTCMinutes(),s:b.getUTCSeconds()},h.H=h.h%12==0?12:h.h%12,h.HH=(h.H<10?"0":"")+h.H,h.P=h.p.toUpperCase(),h.hh=(h.h<10?"0":"")+h.h,h.ii=(h.i<10?"0":"")+h.i,h.ss=(h.s<10?"0":"")+h.s,h.dd=(h.d<10?"0":"")+h.d,h.mm=(h.m<10?"0":"")+h.m;else{if("php"!=g)throw new Error("Invalid format type.");h={y:b.getUTCFullYear().toString().substring(2),Y:b.getUTCFullYear(),F:d[f].months[b.getUTCMonth()],M:d[f].monthsShort[b.getUTCMonth()],n:b.getUTCMonth()+1,t:e.getDaysInMonth(b.getUTCFullYear(),b.getUTCMonth()),j:b.getUTCDate(),l:d[f].days[b.getUTCDay()],D:d[f].daysShort[b.getUTCDay()],w:b.getUTCDay(),N:0==b.getUTCDay()?7:b.getUTCDay(),S:b.getUTCDate()%10<=d[f].suffix.length?d[f].suffix[b.getUTCDate()%10-1]:"",a:2==d[f].meridiem.length?d[f].meridiem[b.getUTCHours()<12?0:1]:"",g:b.getUTCHours()%12==0?12:b.getUTCHours()%12,G:b.getUTCHours(),i:b.getUTCMinutes(),s:b.getUTCSeconds()},h.m=(h.n<10?"0":"")+h.n,h.d=(h.j<10?"0":"")+h.j,h.A=h.a.toString().toUpperCase(),h.h=(h.g<10?"0":"")+h.g,h.H=(h.G<10?"0":"")+h.G,h.i=(h.i<10?"0":"")+h.i,h.s=(h.s<10?"0":"")+h.s}for(var b=[],i=a.extend([],c.separators),j=0,k=c.parts.length;k>j;j++)i.length&&b.push(i.shift()),b.push(h[c.parts[j]]);return b.join("")},convertViewMode:function(a){switch(a){case 4:case"decade":a=4;break;case 3:case"year":a=3;break;case 2:case"month":a=2;break;case 1:case"day":a=1;break;case 0:case"hour":a=0}return a},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};e.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+e.headTemplate+e.contTemplate+e.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+e.headTemplate+e.contTemplate+e.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+e.headTemplate+"<tbody></tbody>"+e.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+e.headTemplate+e.contTemplate+e.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+e.headTemplate+e.contTemplate+e.footTemplate+"</table></div></div>",a.fn.datetimepicker.DPGlobal=e,a.fn.datetimepicker.noConflict=function(){return a.fn.datetimepicker=old,this},a(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(b){var c=a(this);c.data("datetimepicker")||(b.preventDefault(),c.datetimepicker("show"))}),a(function(){a('[data-provide="datetimepicker-inline"]').datetimepicker()})}(window.jQuery),define("bootstrap-datetimepicker",function(){}),function(a){a.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],today:"今日",suffix:[],meridiem:[]}}(jQuery),define("$.bootstrapDatetimepicker",["jquery","bootstrap-datetimepicker"],function(a){return function(){var b;return b||a.$.bootstrapDatetimepicker}}(this)),define("views/work/project-detail-top-item-date-view",["talent","templates/work","tdialog","moment","TitaWidget"],function(a,b,c,d,e){return a.ItemView.extend({template:b["work/project-detail-top-item-date"],className:"project_detail_time",initialize:function(){},modelEvents:{change:"render"},ui:{startDate:".project_detail_time_edit .time_begin",endDate:".project_detail_time_edit .time_end"},events:function(){var a={};return a["click "+this.ui.startDate]="showTimePicker",a["click "+this.ui.endDate]="showTimePicker",a},onRender:function(){},showTimePicker:function(a){a.stopPropagation();var b=Talent.$(a.currentTarget),c=this.model.get("startDate"),d=this.model.get("endDate"),f=this.model.get("WorkType");this.dateTimePickerView&&this.dateTimePickerView.close();var g={isShowDateView:!0,isShowCycleView:!1,isShowLongView:!0,format:"YYYY/MM/DD",minDate:"2013/01/01"};2==f&&(g.viewType="long",d=c),g.rangepickerOptions={startDate:c,endDate:d,timePicker:!1,format:"YYYY/MM/DD"},this.dateTimePickerView=new e.DateTimePickerView(g),this.listenTo(this.dateTimePickerView,"sure",function(a,b){var c=b.isLongTerm?2:1;this._renderProjectDate(b.startDate,b.endDate,c)},this),b.parent().append(this.dateTimePickerView.render().el),this.dateTimePickerView.onShow(),this.dateTimePickerView.show(b,{container:b.parent(),pos:"bottom"})},tipMessage:function(a,b,d){this.warnDialog||(this.warnDialog=new c({type:"tipsy"}),$("body").append(this.warnDialog.render().$el)),this.warnDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:d||"warn"})},_renderProjectDate:function(b,c,d){var e=this,f=this.dealUpdateData();f.StartDate!=b&&(f.StartDate=b),f.DeadLine!=c&&(f.DeadLine=c),f.WorkType!=d&&(f.WorkType=d),2==f.WorkType&&(f.DeadLine="",c="");var g={handler:"Update",data:f},h=a.app.request("Project:updateData",g);h.done(function(){if(1==d){var a=Math.ceil((new Date(c).getTime()-(new Date).getTime())/864e5),f=!1;new Date(b).getTime()<(new Date).getTime()?(a>=0&&(a+=1),f=0>a?!0:!1,a=a>30?0:a,a=0>a?Math.abs(a):a):(f=!1,a=0),e.model.set({ExpireDay:a,IsDeadLine:f})}e.model.set({StartDate:b,EndDate:c,WorkType:d,DeadLine:c,endDate:c,startDate:b})})},dealUpdateData:function(){return{WorkId:this.model.get("WorkId"),WorkName:this.model.get("WorkName"),Descripition:this.model.get("Description")||"",StartDate:this.model.get("StartDate")||"",DeadLine:this.model.get("EndDate")||"",Visibility:this.model.get("IsVisible"),Participators:this.model.get("IsParticipate"),WorkType:this.model.get("WorkType")}},onClose:function(){this.warnDialog&&this.warnDialog.close(),this.$el.find(".project_detail_time_edit .time_begin").data("daterangepicker")&&this.$el.find(".project_detail_time_edit .time_begin").data("daterangepicker").remove(),this.$el.find(".project_detail_time_edit .time_end").data("daterangepicker")&&this.$el.find(".project_detail_time_edit .time_end").data("daterangepicker").remove()}})}),define("views/common/tag-view",["talent","templates/common","$.tipsy"],function(a,b){return a.ItemView.extend({defaults:{id:"",tagName:"",color:"",createTime:"",userId:"",getWay:"",shareType:"",objCount:"",showOrter:!1,beCheck:!1,checked:!1,del:!1,gray:!1},template:b["common/tag"],className:"tt-tag-container",ui:{tagWrap:"[data-name=tag-wrap]",tagMain:"[data-name=tag-main]",tagDel:"[data-name=tag-del]",tagOther:"[data-name=tag-other]",shareIn:"[data-name=share-in]",shareOut:"[data-name=share-out]",count:"[data-name=count]"},events:function(){var a={};return a["click "+this.ui.tagWrap]="_clickCheckedHandler",a["click "+this.ui.tagDel]="_clickDelHandler",a["mouseenter "+this.ui.tagWrap]="_mouseenterDelHandler",a["mouseleave "+this.ui.tagWrap]="_mouseleaveDelHandler",a},modelEvents:{"change:checked":"render","change:shareType":"render","change:flash":"_flash"},templateHelpers:function(){return a._.extend({},this.defaults,this.model.toJSON())},initialize:function(){},onRender:function(){a.$(".tipsy").remove(),this.ui.shareIn.tipsy({gravity:"s"}),this.ui.shareOut.tipsy({gravity:"s"}),this.ui.count.tipsy({gravity:"s"}),this._dealChecked()},_dealChecked:function(){this.model.get("beCheck")&&this.model.get("checked")?this.$el.addClass("active"):this.$el.removeClass("active")},_clickCheckedHandler:function(a){return a.stopPropagation(),a.preventDefault(),this.model.get("beCheck")&&!this.model.get("gray")&&(this.$el.hasClass("active")?(this.$el.removeClass("active"),this.model.set("checked",!1),this.trigger("checked")):(this.$el.addClass("active"),this.model.set("checked",!0),this.trigger("checked"))),!1},_mouseenterDelHandler:function(a){a.stopPropagation(),this.model.get("del")&&!this.model.get("gray")&&this.$el.addClass("del-hover")},_mouseleaveDelHandler:function(a){a.stopPropagation(),this.model.get("del")&&!this.model.get("gray")&&this.$el.removeClass("del-hover")},_clickDelHandler:function(a){a.stopPropagation(),this.trigger("del")},_flash:function(){var a=this;this.model.get("flash")&&(this.$el.css("opacity","0.1"),this.$el.animate({opacity:1},500,function(){a.model.set("flash",!1)}))}})}),define("views/work/project-tag-add-dialog-input-checkcolor-view",["talent","templates/work","views/work/project-tag-add-dialog-input-checkcolor-view"],function(a){return a.ItemView.extend({template:JST["work/project-tag-add-dialog-input-checkcolor"],className:"check-color-box",ui:{itemColor:"span"},events:function(){var a={};return a["click "+this.ui.itemColor]="_clickItemColorHanler",a},initialize:function(){this.$el.off("mouseup.check-color-box-view"),this.$el.on("mouseup.check-color-box-view",function(a){a.stopPropagation()})},_clickItemColorHanler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.data("color");this.trigger("changeColor",d)},onClose:function(){this.$el.off("mouseup.check-color-box-view")}})}),define("views/work/project-tag-add-dialog-input-view",["talent","templates/work","$.tipsy","views/work/project-tag-add-dialog-input-checkcolor-view"],function(a,b,c,d){return a.ItemView.extend({template:JST["work/project-tag-add-dialog-input"],className:"input-container",templateHelpers:function(){function a(a,b){return Math.floor(Math.random()*(b-a+1))+a}return this.model.set("color",a(1,6)),{color:this.model.get("color")}},ui:{addBtn:"[data-name=add]",placeholder:"label.placeholder",input:"[data-name=input]",inputWrap:".tu-input-default",checkColorBtn:"span.check-color-btn",checkColorCont:"span.check-color-btn span",inputTip:"p.input-tip",form:"[data-name=form]"},events:function(){var a={};return a["compositionstart "+this.ui.input]="_inputStartHandler",a["compositionend "+this.ui.input]="_inputEndHandler",a["input "+this.ui.input]="_inputHandler",a["focus "+this.ui.input]="_inputFocusHandler",a["blur "+this.ui.input]="_inputBlurHandler",a["click "+this.ui.checkColorBtn]="_clickCheckColorBtnHandler",a["submit "+this.ui.form]="_submitForm",a},modelEvents:{"change:color":"_changeColor","change:addBtnBeClick":"_addBtnStatus","change:changeColorBeClick":"_checkColorBtnStatus"},initialize:function(){this.isIE=this.isIE(),this.isIE8=-1!=window.navigator.userAgent.toUpperCase().indexOf("MSIE 8.0")?!0:!1,this.IME=!1,this.propertychange_val="",this.model.set("addBtnBeClick",!1),this.model.set("changeColorBeClick",!0)},onRender:function(){var a=this;this.ui.input.bind("propertychange",function(b){a._inputHandler(b,a)}),this.ui.checkColorBtn.tipsy({gravity:"s"}),this.checkColorBoxView&&(this.checkColorBoxView.close(),this.checkColorBoxView=null)},isIE:function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1},_inputFocusHandler:function(){this.ui.inputTip.empty(),this.ui.inputTip.html("仅支持中英文、数字与“_”，可输入14个字，最多添加5个标签</p>"),this.ui.input.parents(".tu-input-default").addClass("focusIn"),this.ui.placeholder.hide()},_inputBlurHandler:function(){this.ui.inputTip.empty(),this.ui.input.parents(".tu-input-default").removeClass("focusIn"),this.model.get("tagName")||this.ui.placeholder.show()},_inputStartHandler:function(){this.IME=!0},_inputEndHandler:function(a){this.IME=!1,this.isIE&&this._inputHandler(a,this)},_inputDelHandler:function(a){(46===a.keyCode||8===a.keyCode)&&this._inputHandler(a)},_inputHandler:function(b,c){b.stopPropagation();var d=this,e=a.$(b.currentTarget),f=e.val(),g="";if(d.isIE8&&(d=c),!d.IME){if(d.isIE8){if(f==d.propertychange_val)return;d.propertychange_val=""}g=d._valVerify(f),d.propertychange_val=g,g!=f&&e.val(g),d.model.set("changeColorBeClick",!0),d.model.set("tagName",g),d.trigger("hasInput",g)}},_submitForm:function(){return this.trigger("formSubmif",this.model),!1},_valVerify:function(a){for(var b="",c="",d=/^\w|[\u4E00-\u9FA5]$/,e=/^[\u4E00-\u9FA5]$/,f=0,g=0;g<a.length;g++)d.test(a[g])&&(b+=a[g]);for(var h=0;h<b.length;h++)f+=e.test(b.charAt(h).toString())?2:1,28>=f&&(c+=b[h]);return c},_clickCheckColorBtnHandler:function(a){a.stopPropagation(),this.model.get("changeColorBeClick")&&(this.checkColorBoxView?(this.checkColorBoxView.close(),this.checkColorBoxView=null):(this.checkColorBoxView&&this.checkColorBoxView.close(),this.checkColorBoxView=new d({model:this.model}),this.listenTo(this.checkColorBoxView,"changeColor",function(a){this.checkColorBoxView.close(),this.checkColorBoxView=null,this.model.set("color",a)}),this.$el.append(this.checkColorBoxView.render().$el)))},_changeColor:function(){$(this.ui.checkColorCont).removeClass().addClass("color"+this.model.get("color"))},_addBtnStatus:function(){this.model.get("addBtnBeClick")&&this.model.get("tagName")?(this.ui.inputWrap.hasClass("tu-input-disabled")&&this.ui.inputWrap.removeClass("tu-input-disabled"),this.ui.addBtn.hasClass("tu-button-disabled")&&this.ui.addBtn.removeClass("tu-button-disabled")):(this.ui.inputWrap.hasClass("tu-input-disabled")||this.ui.inputWrap.addClass("tu-input-disabled"),this.ui.addBtn.hasClass("tu-button-disabled")||this.ui.addBtn.addClass("tu-button-disabled"))},_checkColorBtnStatus:function(){this.model.get("changeColorBeClick")?(this.ui.checkColorCont.removeClass("color0").addClass("color"+this.model.get("color")),this.ui.checkColorBtn.attr("original-title","更换颜色")):(this.ui.checkColorBtn.attr("original-title","标签已存在，暂不可更换颜色"),this.ui.checkColorCont.removeClass("color"+this.model.get("color")).addClass("color0"))},onClose:function(){this.checkColorBoxView&&(this.checkColorBoxView.close(),this.checkColorBoxView=null)}})}),define("views/work/project-tag-add-dialog-tag-box-collection-view",["talent","templates/work","views/common/tag-view"],function(a,b,c){return a.CollectionView.extend({itemView:c,initialize:function(){var a=this;this.on("itemview:checked",function(b){a.trigger("checked",b)})},onRender:function(){a._.filter(this.collection.toJSON(),function(a){return 2==a.getWay}).length&&this.$el.prepend('<div class="share-title">共享给我的</div>')}})}),define("views/work/project-tag-add-dialog-tag-box-view",["talent","templates/work","views/common/tag-view","views/common/empty-view","views/work/project-tag-add-dialog-tag-box-collection-view"],function(a,b,c,d,e){return a.ItemView.extend({template:JST["work/project-tag-add-dialog-tag-box"],className:"tag-add-box",ui:{myTagWrap:"[data-name=my-tag]",shareTagWrap:"[data-name=share-tag]"},collectionEvents:{reset:"render",set:"render"},initialize:function(a){this.options=a},_dealCcllection:function(){this.myTagCollection=new a.Collection,this.shareTagCollection=new a.Collection,this.myTagCollection.set(this.collection.where({getWay:1})),this.shareTagCollection.set(this.collection.where({getWay:2}))},onRender:function(){if(this.options.tagAllCollection.length)this._dealCcllection(),this._renderMyTagCollectionView(),this._renderShareTagCollectionView();else{var a=new d({emptyContext:"暂无标签，赶快添加让工作更井井有条吧"});this.ui.myTagWrap.empty(),this.ui.myTagWrap.append(a.render().$el)}},_renderMyTagCollectionView:function(){this.myTagCollectionView&&this.myTagCollectionView.close(),this.myTagCollectionView=new e({collection:this.myTagCollection}),this.listenTo(this.myTagCollectionView,"checked",function(a){a.model.set("getWay",1),this.trigger("checked",a)}),this.ui.myTagWrap.empty(),this.ui.myTagWrap.append(this.myTagCollectionView.render().$el)},_renderShareTagCollectionView:function(){this.shareTagCollection.length&&(this.shareTagCollectionView&&this.shareTagCollectionView.close(),this.shareTagCollectionView=new e({collection:this.shareTagCollection}),this.listenTo(this.shareTagCollectionView,"checked",function(a){a.model.set("getWay",2),this.trigger("checked",a)}),this.ui.shareTagWrap.append(this.shareTagCollectionView.render().$el))}})}),define("views/work/project-tag-add-dialog-view",["talent","templates/work","views/work/project-tag-add-dialog-input-view","views/work/project-tag-add-dialog-tag-box-view"],function(a,b,c,d){var e=a.ItemView.extend({template:a._.template('<img src="'+a.Context.getStaticUrl("images/loading.gif")+'">'),className:"tag-loading"});return a.Layout.extend({template:b["work/project-tag-add-dialog"],className:"tag-add-dialog-container",regions:{loading:"[data-name=loading]",input:"[data-name=input]",tagCont:"[data-name=tag-cont]"},ui:{addBtn:"button[data-name=add]"},events:function(){var a={};return a["click "+this.ui.addBtn]="_clickAddBtnHandler",a},initialize:function(b){this.options=b;var c=this;this.$el.off("mouseup.project-deatil-top-tag-add-layout"),this.$el.on("mouseup.project-deatil-top-tag-add-layout",function(a){a.stopPropagation()}),a.$(document).off("mouseup.project-deatil-top-tag-add-layout"),a.$(document).on("mouseup.project-deatil-top-tag-add-layout",function(){c.close()}),this.tagAllCollection=new a.Collection,this.tagSelectCollection=new a.Collection,this.addBtnBeClick=!1,this._getData()},onRender:function(){this.loadingView=new e,this.loading.show(this.loadingView)},_getData:function(){var b=this;a.app.request("WorkTag:getTagAll").done(function(a){b._dealTagAllData(a),b._renderView()}).fail(function(){})},_dealTagAllData:function(b){var c=this,d=b.tagList;if(d.length){a._.each(d,function(a){a.beCheck=!0}),this.tagAllCollection.reset(d),a._.each(this.collection.toJSON(),function(a){c.tagAllCollection.findWhere({tagName:a.tagName,id:a.id})&&c.tagAllCollection.findWhere({tagName:a.tagName,id:a.id}).set("checked",!0)});var e=this.tagAllCollection.where({checked:!0}).length;a._.each(this.tagAllCollection.toJSON(),function(a){5==e?a.checked||c.tagAllCollection.findWhere({tagName:a.tagName,id:a.id}).set({checked:!1,beCheck:!1,gray:!0}):a.checked||c.tagAllCollection.findWhere({tagName:a.tagName,id:a.id}).set("checked",!1)})}},_renderView:function(){this.loadingView&&this.loadingView.close(),this._renderInputView(),this._renderTagCompositeView()},_renderInputView:function(){this.projectTagAddDialogInputView&&this.projectTagAddDialogInputView.close(),this.projectTagAddDialogInputView=new c,this.listenTo(this.projectTagAddDialogInputView,"hasInput",function(a){this._dealInput(a)}),this.listenTo(this.projectTagAddDialogInputView,"formSubmif",function(a){this.addBtnBeClick&&this._checkFromMyTagCollection(a)}),this.input.show(this.projectTagAddDialogInputView)},_dealInput:function(b){if(b){var c=b.toLowerCase(),d=this.tagAllCollection.where({checked:!0}).length,e=this.tagAllCollection.where({getWay:1}).length;this.addBtnBeClick=!0,this.projectTagAddDialogInputView.model.set("changeColorBeClick",!0),this.tagSelectCollection.reset(a._.filter(this.tagAllCollection.toJSON(),function(a){return-1!=a.tagName.toLowerCase().indexOf(c)?a:void 0}));var f=this.tagSelectCollection.where({getWay:1,tagName:b});5==d&&50==e&&(this.addBtnBeClick=!1),0==f&&50==e&&(this.addBtnBeClick=!1)}else this.addBtnBeClick=!1,this.projectTagAddDialogTagBoxView.collection.reset(this.tagAllCollection.toJSON());this.projectTagAddDialogInputView.model.set("addBtnBeClick",this.addBtnBeClick)},_clickAddBtnHandler:function(a){a.stopPropagation(),this.addBtnBeClick&&this._checkFromMyTagCollection(this.projectTagAddDialogInputView.model)},_checkFromMyTagCollection:function(b){var c=b.toJSON(),d=this.tagSelectCollection.findWhere({tagName:c.tagName,getWay:1}),e=this;if(d)if(d.get("checked"))d.set("flash",!0),this.projectTagAddDialogInputView.model.set("changeColorBeClick",!1);else{if(d.get("gray"))return;d.set("checked",!0),this.trigger("checked",d),this.tagAllCollection.findWhere({tagName:d.get("tagName"),id:d.get("id")}).set("checked",!0),5==this.tagAllCollection.where({checked:!0}).length&&a._.each(this.tagAllCollection.where({checked:!1}),function(a){a.set({gray:!0,beCheck:!1})});var f=[];a._.each(this.tagSelectCollection.toJSON(),function(a){f.push(e.tagAllCollection.findWhere({tagName:a.tagName,id:a.id}).toJSON())}),a.app.request("WorkTag:tagAddTo",{tagId:d.toJSON().id,objId:e.model.get("WorkId"),objType:"4"}).done(function(){e.tagSelectCollection.reset(f)})}else if(this.addBtnBeClick=!1,this.projectTagAddDialogInputView.model.set("addBtnBeClick",!1),this.tagAllCollection.where({checked:!0}).length<5)a.app.request("WorkTag:tagCreateTo",{tagName:c.tagName,color:c.color,objId:e.model.get("WorkId"),objType:"4"}).done(function(a){b.set(a),b.set("checked",!0),b.set("beCheck",!0),e.tagAllCollection.where({checked:!0}).length<5&&e.trigger("checked",b),e.tagAllCollection.unshift(b.toJSON()),e._checkTagAllByChecked()});else{if(50==this.tagAllCollection.where({getWay:1}).length)return;a.app.request("WorkTag:tagAdd",{tagName:c.tagName,color:c.color,shareTypes:""}).done(function(a){a.beCheck=!0,a.checked=!1,e.tagAllCollection.where({checked:!0}).length<5&&e.trigger("checked",a),e.tagAllCollection.unshift(a),e._checkTagAllByChecked()})}},_checkTagAllByChecked:function(){this.projectTagAddDialogInputView.render(),5==this.tagAllCollection.where({checked:!0}).length&&a._.each(this.tagAllCollection.where({checked:!1}),function(a){a.set({gray:!0,beCheck:!1})}),this._renderTagCompositeView()},_renderTagCompositeView:function(){var b=this;this.tagSelectCollection.reset(this.tagAllCollection.toJSON()),this.projectTagAddDialogTagBoxView&&this.projectTagAddDialogTagBoxView.close(),this.projectTagAddDialogTagBoxView=new d({collection:this.tagSelectCollection,tagAllCollection:this.tagAllCollection}),this.listenTo(this.projectTagAddDialogTagBoxView,"checked",function(c){this.projectTagAddDialogInputView.model.set("changeColorBeClick",!0);var d=c.model.toJSON();d.checked?a.app.request("WorkTag:tagAddTo",{tagId:d.id,objId:b.model.get("WorkId"),objType:"4"}):a.app.request("WorkTag:tagRemovefrom",{tagId:d.id,objId:b.model.get("WorkId"),objType:"4"}),this.tagAllCollection.findWhere({tagName:d.tagName,id:d.id}).set("checked",d.checked),5==this.tagAllCollection.where({checked:!0}).length?a._.each(this.tagAllCollection.where({checked:!1}),function(a){a.set({gray:!0,beCheck:!1})}):a._.each(this.tagAllCollection.where({gray:!0}),function(a){a.set({gray:!1,beCheck:!0})}),this.trigger("checked",c.model);var e=[];a._.each(this.tagSelectCollection.toJSON(),function(a){e.push(b.tagAllCollection.findWhere({tagName:a.tagName,id:a.id}).toJSON())}),this.tagSelectCollection.reset(e)}),this.tagCont.show(this.projectTagAddDialogTagBoxView)},onClose:function(){this.$el.off("mouseup.project-deatil-top-tag-add-layout"),a.$(document).off("mouseup.project-deatil-top-tag-add-layout"),this.projectTagAddDialogInputView&&this.projectTagAddDialogInputView.close(),this.projectTagAddDialogTagBoxView&&this.projectTagAddDialogTagBoxView.close()}})}),define("views/work/project-detail-top-item-tag-view",["talent","templates/work","tdialog","moment","TitaWidget","views/common/tag-view","views/work/project-tag-add-dialog-view"],function(a,b,c,d,e,f,g){var h=a.ItemView.extend({template:a._.template("<span >点击添加</span>"),className:"tag-container-empty-text"});return a.CompositeView.extend({template:b["work/project-detail-top-item-tag"],itemView:f,itemViewContainer:"[data-name=tag-container]",className:"project_detail_tag",initialize:function(){var a=this;this.on("itemview:del",function(b){a._deleteTag(b.model.toJSON()),a.collection.remove(b.model)})},emptyView:h,modelEvents:{change:"render"},ui:{addTagBtn:".add_tag"},events:function(){var a={};return a["click "+this.ui.addTagBtn]="_renderAddTagView",a},_deleteTag:function(b){a.app.request("WorkTag:tagRemovefrom",{tagId:b.id,objId:this.model.get("WorkId"),objType:"4"})},_renderAddTagView:function(b){a.$(b.currentTarget);this.projectTagAddDialogView&&this.projectTagAddDialogView.close(),this.projectTagAddDialogView=new g({collection:this.collection,model:this.model}),this.listenTo(this.projectTagAddDialogView,"checked",function(a){this.trigger("checked",a.toJSON())}),this.$el.find(".project_tag_item").append(this.projectTagAddDialogView.render().$el)},onClose:function(){this.projectTagAddDialogView&&this.projectTagAddDialogView.close()}})}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require("../moment")):"function"==typeof define&&define.amd?define("momentZH",["moment"],b):b(a.moment)}(this,function(a){var b=a.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(a,b){return 12===a&&(a=0),"凌晨"===b||"早上"===b||"上午"===b?a:"下午"===b||"晚上"===b?a+12:a>=11?a:a+12},meridiem:function(a,b){var c=100*a+b;return 600>c?"凌晨":900>c?"早上":1130>c?"上午":1230>c?"中午":1800>c?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[下]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[上]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"日";case"M":return a+"月";case"w":case"W":return a+"周";default:return a}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});return b}),define("views/common/plugins/attachment/preview-composite-view",["talent"],function(a){var b=['<div class="view_attvb clearfix">','	<div class="ico_vattvb ">',"	</div>","	<p><%= FileName %><span></p>",'	<a href="javascript:void(0);" title="" class="del_fattvb del_item" >删除</a>',"</div>"].join(""),c=a.ItemView.extend({template:a._.template(b),tagName:"li",events:{"click .del_item":"delItem"},delItem:function(a){this.trigger("delete"),a.stopPropagation()},onRender:function(){var a=this,b=new Image;b.onload=function(){var c=b.width,d=b.height,e=120,f=120,g=a.fixImgSize(c,d,e,f);a.imgSize={width:g.w,height:g.h},b.width=g.w,b.height=g.h,a.$el.find(".ico_vattvb").append(b)},b.onerror=function(){a.$el.find(".view_attvb").html('<div class="warnattachmenttip">读取文件 '+a.model.get("FileName")+" 失败</div>"),a.$el.delay(3e3).slideUp(200)},b.src=this.model.get("imageUrl"),this.$el.find(".ico_vattvb").append(b),this.$el.attr({id:this.model.cid})},fixImgSize:function(a,b,c,d){var e={w:0,h:0},f=a,g=b,h=c,i=d;if(f>0&&g>0){var j=h/i,k=f/g;f>h||g>i?k>j?(e.w=h,e.h=g*(h/f)):(e.w=f*(i/g),e.h=i):(e.w=f,e.h=g)}else e.w=f,e.h=g;return e}}),d=a.CollectionView.extend({itemView:c,tagName:"ul",initialize:function(){var a=this;this.on("itemview:delete",function(b){a.delItem(b)})},delItem:function(a){this.collection.remove(a.model),this.trigger("deleteItem")},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render();var f=e.model.get("timestamp");this.$el.find("#"+f).after(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)}});return d}),define("views/common/plugins/attachment/tita-upload",["talent","Uploader","views/common/plugins/attachment/preview-composite-view","TitaWidget"],function(a,b,c,d){var e=['<a href="javascript:void(0);" title="" data-name="file" class="upload_node <%if(!openYFY){%>upload_new_file<%}%>">文件/图片</a>',"<%if(openYFY){%>",'<div class="tt_upload_type_container" data-name="upload-type">','<dl class="upload_type_item"><span class="upload_new_file">本地上传</span></dl>','<dl class="upload_type_item"><span id="fc_upload" class="fang_cloud_btn">亿方云</span></dl>',"</div>","<%}%>"].join(""),f=a.Context.getUploadOptions();return f.validate.format=null,d.UploaderComponentView.extend({template:a._.template(e),loadingTemplate:a._.template('<div id="<%= timestamp %>"><img src="'+a.Context.getStaticUrl("images/file_load.gif")+'"/></div>'),errorTemplate:a._.template('<div class="warnattachmenttip"><%= msg %></div>'),PreviewView:c,defaults:{errorTime:3e3},ui:{uploadNewFile:".upload_node"},events:function(){var a={};return a["mouseover "+this.ui.uploadNewFile]="showPop",a["mouseout "+this.ui.uploadNewFile]="hidePop",a["click "+this.ui.uploadNewFile]="hidePop",a},showPop:function(a){var b=Talent.$(a.currentTarget);b.data("tipsy")||b.tipsy({title:function(){return'<div style="text-align:left;"><b style="display:block;font-size:14px;">支持拖拽上传<br>最多一次能上传20个</b>大小不超过20M</div>'},gravity:"sw",html:!0,trigger:"manual"}),this.ui.uploadNewFile.tipsy("show")},hidePop:function(){this.ui.uploadNewFile.tipsy("hide")},setTemplate:function(a){this.template=a},dealOptions:function(b){this.options=a._.extend({},this.defaults,f,b)},onAfterUpload:function(b){var c=this,d=b.Result;return d?(a._.map(d,function(d){var e=d.MediaType;return/^jpg|png|gif|jpeg|JPG|PNG|GIF|JPEG$/.test(e)?d.imageUrl=d.ClientUrl:(fileIconName=/^(rar|zip|exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(e)?e:/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(e)?"music":/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(e)?"video":"file",d.imageUrl=a.Context.getStaticUrl("images/feed/"+fileIconName+".png")),d.timestamp=b.timestamp,"上传成功"!=d.Msg&&(c.showErrorView(d.Msg),c.trigger("error",d)),d}),d):void 0},showLoadingView:function(a){this.previewCompositeView.$el.append(this.loadingTemplate({timestamp:a.timestamp}))},hideLoadingView:function(a){var b=a.timestamp;this.previewCompositeView.$el.find("#"+b).hide()}})}),define("views/common/plugins/popup/import-task-view",["talent","templates/common","tdialog","moment","momentZH","views/common/plugins/attachment/tita-upload","helpers/context"],function(a,b,c,d,e,f,g){return a.ItemView.extend({defaults:{displayType:"global",downloadUrl:""},template:b["common/plugins/popup/import-task"],ui:{taskFileUpload:'div[data-name="ux-upload-list"]',loading:".loading"},events:function(){var a={};return a},modelEvents:{},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.apiPath=a.Context.getApiHost(),this.tenantInfo=a.Context.getTenantInfo(),this.userInfo=a.Context.getUserInfo(),this.Dialog=new c({sure:function(){var c=b._getUploadFile(),d=a._.pluck(c,"DfsPath");
b.ui.loading.show(),a.app.request("Task:importTask",{workId:+b.model.get("WorkId"),dfsUrl:d.join(","),type:b.model.get("typeData").type}).done(function(){b.ui.loading.hide(),b.trigger("tipSuccess",b.model.get("typeData")),b.Dialog.$el.hide()}).fail(function(a){b.showError(a)})},cancel:function(){},showClosed:!0,type:"default",minWidth:405,arrow:!1,className:"_tt_dialog ns-import-task tt-common-popup",displayType:"inline"}),"inline"==this.settings.displayType?this.settings.container.append(this.Dialog.render().$el):a.$("body").append(this.Dialog.render().$el)},templateHelpers:function(){return{context:g}},onRender:function(){this.Dialog.show(this.settings.node,this.el,{container:this.settings.container,pos:"topLeft"}),this.Dialog.$el.css("maxWidth",450),this._renderFileUpload()},showError:function(a){this.$(".mBar").html(a),this.Dialog.$el.find(".uibutton").html('<a  href="javascript:void(0);" class="btn btn-sure cancel_dialog">关闭</a>')},_renderFileUpload:function(){var b=this;this.uploaderView=new f({container:this.$el,validate:{format:["csv","CSV"],onceLimt:1,allLimt:2,nameLimt:-1}}),this.uploaderView.setTemplate(a._.template('<a href="javascript:void(0);"  data-name="file" class="upload_node upload_new_file">上传导入'+this.model.get("typeData").name+"文件</a>")),this.uploaderView.render().$el.parent("div").width("100%").find(".upload_file_input").width("180%"),this.uploaderView.on("uploadEnd",function(){b.$(".uploader_container").hide()}),this.uploaderView.on("deleteItem",function(){b.$(".uploader_container").show()}),this.uploaderView.on("error",function(a){b.$el.find('div[id="'+a.timestamp+'"]').remove()})},_getUploadFile:function(){var b=this.uploaderView.fileCollection.where({Msg:"上传成功"}),c=new a.Collection(b);return c.toJSON()},_closePop:function(){this.Dialog&&this.Dialog.close()},onClose:function(){this.Dialog&&this.Dialog.close()}})}),define("views/work/project-detail-top-item-view",["talent","templates/work","views/work/common/project-action-item-view","views/common/bs-tab/bs-tab","$.bootstrapDatetimepicker","tdialog","$.autoresize","views/work/from-app-view","UserSelector","collections/smember-group-collection","views/work/project-detail-top-item-date-view","views/work/project-detail-top-item-tag-view","helpers/context","views/common/plugins/popup/import-task-view","TitaWidget"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return a.ItemView.extend({template:b["work/project-detail-top-item"],timeTemplate:b["work/project-detail-top-item-date"],events:function(){var a={"focusin .input_container":"onInputFocusIn","focusout .input_container":"onInputFocusOut","keyup .input_container":"onInputKeyUp","click .btn_blue":"onSubmit","click .btn_white":"onCancel","click .show-more":"_showMoreContent","click .authority":"_showRange","click .workDescription":"workDescriptions"};return a["click .dropdown_range li"]="_changeRange",a["mouseenter "+this.ui.principal]="_principalEnterHandler",a["mouseleave "+this.ui.principal]="_principalLeaveHandler",a},defaults:{WorkNameLen:100,DescripitionLen:80},ui:{datepicker_ui:"#datepicker",datepickerWrap:".datepicker",workName:".project_detail_title_type",workDescription:".project_detail_description_type",workProgress:".project_detail_progress_type",timeContainer:".project_time_container",actionContainer:".btn-list-container",operateBtn:".project_detail_operate_btn",tabNav:"ul[data-name=tab-nav]",approval:'[data-name="approval"]',principal:'[data-name="project-detail-top-responsible"]',extraInfo:"[data-name=work-extra-info]",tagContainer:".project_tag_container",projectDetailTop:".project_detail_top"},modelEvents:{"change:MembersTotal":"onMembersCountChange","change:TaskTotal":"onTaskTotalChange","change:TrendTotal":"onTrendTotalChange","change:AttachmentTotal":"onAttachmentTotalChange"},initialize:function(b){this.options=b,this.options.isOptEdit||this.model.set({IsEdit:this.options.isOptEdit?this.options.isOptEdit:!1,EditDescription:this.options.isOptEdit?this.model.get("EditDescription"):!1,EditVisible:this.options.isOptEdit?this.model.get("EditVisible"):!1});var c=this,d=this.convertDate(this.model.get("StartDate")),e=this.convertDate(this.model.get("EndDate"));this.model.set({startDate:d,endDate:e,Descripition:this.model.get("Description")}),a.$(document).off("click.task_project_datepicker"),a.$(document).on("click.task_project_datepicker",function(){a.$(".datepicker").hide()}),a.$("body").on("click.project_action",function(b){a.$(b.target).hasClass("authority")||c.$el.find(".dropdown_range").hide()}),this.model.get("viewMode")||this.model.set("viewMode","simple")},templateHelpers:function(){var b=m.getGlobal("navigations").titaWorkDetailNavigation,c=a._.sortBy(b,"score"),c=a._.pluck(c,"navigationValue"),d=a._.where(c,{isUse:!0}),e={"任务":"task","动态":"feed","文件":"file","人员":"user","统计":"statistics","操作记录":"operate","甘特图":"statisticsTasks","里程碑":"milepost"},f=decodeURIComponent(location.hash),g=!0;if(f.indexOf("?")<0){var h=f+"?detail_type=";g=!1}else if(f.indexOf("detail_type=")<0){var h=f+"&detail_type=";g=!1}else var h=f;for(var i=0,j=d.length;j>i;i++){var k=e[d[i].name];d[i].url=g?h.replace(/&detail_type=\w+/,"&detail_type="+k):h+k,d[i].router=k}this.usedNav=d;var l=a._.substring(this.model.get("Principal").Name,12,!0);if(this.model.get("ApplyUser"))var n=a._.substring(this.model.get("ApplyUser").Name,12,!0);return{usedNav:d,isShowEditApproval:this.options.isOptEdit,PrincipalName:l,ApplyUserName:n}},_showMoreContent:function(){var a=this.$el.find(".detail-mode");"simple"==this.model.get("viewMode")?(this.model.set("viewMode","detail"),a.show(),this.$el.find(".show-more").html("收起<span class='icon icon-arrow-up-double'></span>")):(this.model.set("viewMode","simple"),this.$el.find(".show-more").html("展开<span class='icon icon-arrow-down-double'></span>"),a.hide())},onRender:function(){{var a=this;this.model.get("routerData")}this._customView(),this.renderActionView(),this.renderTimeView(),this.renderTagView(),this.userSelectorView=new i({collection:new j}),this.userSelectorView.addNode(this.ui.approval,{container:this.ui.projectDetailTop}),this.ui.approval.on("submit",function(b,c){b.stopPropagation(),a.ui.approval.show(),a._deliverMemberSelect(c)});var b=this.model.get("EditDescription"),c=this.model.get("IsEdit"),d=this.model.get("Status"),e=this.model.get("IsManage"),f=this.model.get("ApplyState");c&&2!=d&&(this.ui.workName.autosize(),this.ui.workName.trigger("autosize.resize")),(e&&2!=d&&(0==f||2==f)||b&&2!=d)&&(this.ui.workDescription.autosize(),this.ui.workDescription.trigger("autosize.resize"))},onShow:function(){var a=this.model.get("EditDescription"),b=this.model.get("IsEdit"),c=this.model.get("Status");b&&2!=c&&(this.ui.workName.autosize(),this.ui.workName.trigger("autosize.resize")),a&&2!=c&&(this.ui.workDescription.autosize(),this.ui.workDescription.trigger("autosize.resize")),this._renderExtroView()},_renderExtroView:function(){var a=this.model.get("customizetDatas")||[];if(a.length){var b=new o.FeedExtraInfoListView({collection:new Talent.Collection(a)});this.ui.extraInfo.html(b.render().el)}},_showRange:function(){var a=this.$el.find(".dropdown_range");"none"==a.css("display")&&a.show()},_changeRange:function(b){function c(){d.$el.find(".dropdown_range li").toggleClass("active"),d.actionView.operateRequest("Visibility",{visibility:f})}var d=this,e=a.$(b.currentTarget);if(!e.hasClass("active")){var f=e.attr("data-type"),g=this.model.get("IsVisible");2==g&&1==f?this._showConfirm(e,"确定要改成公开吗？之前发表的内容将会被公开！",c):c()}},_principalEnterHandler:function(){this.ui.approval.show()},_principalLeaveHandler:function(){this.ui.approval.hide()},_deliverMemberSelect:function(a){function b(){c._operateRequest(a)}var c=this;this._showConfirm(this.$el.find('[data-name="approval"]'),"您确定把负责人的权限转交吗？",b)},_operateRequest:function(b){var c=this.model.get("WorkId"),d=a.app.request("Project:updateData",{handler:"Deliver",data:{work_id:c,to_user_ids:b.Id,email:b.Email}});d.done(function(){a.app.vent.trigger("detail:_tita_work:operate")}).fail(function(){})},_showConfirm:function(a,b,c){var d=this;this.delDialog=new f({fixed:!1,type:"tipsy",cancel:function(){d.delDialog.close()},sure:function(){d.delDialog.close(),c()}}),this.delDialog.render().$el.appendTo("body"),this.delDialog.show(a,b,{pos:"bottom",className:"ask",arrow:!1})},_customView:function(){var a=this.options.globalCoustom;a.social||(this.ui.tabNav.find("li:first").remove(),this.ui.tabNav.find("li").first().addClass("active"))},renderTimeView:function(){var a=new k({model:this.model,isOptEdit:this.options.isOptEdit});this.ui.timeContainer.html(a.render().$el)},renderTagView:function(){this.tagCollection=this.options.tagData,this.projectDetailTopItemTagView&&this.projectDetailTopItemTagView.close(),this.projectDetailTopItemTagView=new l({collection:this.tagCollection,model:this.model}),this.listenTo(this.projectDetailTopItemTagView,"checked",function(a){this._addTagView(a)}),this.ui.tagContainer.append(this.projectDetailTopItemTagView.render().$el)},_addTagView:function(a){a.beCheck=!1,a.del=!0,this.tagCollection.findWhere({id:a.id,tagName:a.tagName})?this.tagCollection.remove(this.tagCollection.findWhere({id:a.id,tagName:a.tagName})):this.tagCollection.unshift(new Talent.Model(a)),this.projectDetailTopItemTagView.collection.reset(this.tagCollection.toJSON())},renderActionView:function(){this.options.isOptEdit&&(this.actionView=new c({model:this.model}),this.ui.actionContainer.append(this.actionView.render().$el),this.listenTo(this.actionView,"popImport",function(a){this._importPop(a)}))},_importPop:function(b){b.name="task"==b.type?"任务":"里程碑",this.model.set("typeData",b),this.importTaskView&&this.importTaskView.close(),this.importTaskView=new n({node:this.ui.operateBtn,displayType:"inline",model:this.model,container:this.$el}),this.listenTo(this.importTaskView,"tipSuccess",function(){this._tipDialog(a.$(".project_detail_operate_btn"),{msg:"操作成功",autoHide:3e3,pos:"bottom"})}),this.importTaskView.render()},_tipDialog:function(b,c){this.tipDialog&&this.tipDialog.close();var d={sure:!1,cancel:!1,pos:"topCenter",klass:"success"};c=a._.extend({},d,c),this.tipDialog=new f({type:"tipsy",sure:c.sure,cancel:c.cancel,autoHide:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(b,c.msg,{pos:c.pos,className:c.klass,arrow:!1,autoHide:c.autoHide,topBias:c.topBias})},showDialogArrow:function(b,c,d,e){var g=this,h={arrow:1,pos:"right",height:300,topBias:8,leftBias:10,arrowBias:10,className:d};g.tDialogViewError||(g.tDialogViewError=new f({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),g.tDialogViewError.render().$el.appendTo("body"));var e=e||{};e=a._.extend(h,e),g.tDialogViewError.show(a.$(b),c,e)},onInputFocusIn:function(b){var c=a.$(b.target);"Descripition"==c.attr("data-type")&&a.$.trim(c.val())==c.attr("text-origion")&&c.val(""),c.hasClass("input_error")||(c.siblings(".project_btn_group").slideDown("slow"),c.addClass("input_focus_bule"))},onInputFocusOut:function(a){this.checkInput(a)},onInputKeyUp:function(a){this.checkInput(a)},workDescriptions:function(a){a.stopPropagation()},onSubmit:function(b){b.stopPropagation();var c=this,d=a.$(b.target).parent(".project_btn_group"),e=d.siblings(".input_container"),f=e.attr("data-type"),g=a.$.trim(e.val()),h=e.attr("text-origion");if(g=g==h?"":g,""==g&&"WorkName"==f)return void this.showDialogArrow(this.ui.workName,"必填项","warn");if("Progress"==f)if(-1==g.indexOf("%")){if(isNaN(g))return void this.showDialogArrow(this.ui.workProgress,"仅限于数字","warn");if(g>100||0>g)return void this.showDialogArrow(this.ui.workProgress,"数字不能大于100或小于0","warn");g+="%",e.val(g)}else{var i=g.indexOf("%"),j=g.substring(0,i);if(isNaN(j))return void this.showDialogArrow(this.ui.workProgress,"仅限于数字","warn");if(j>100||0>j)return void this.showDialogArrow(this.ui.workProgress,"数字不能大于100或小于0","warn");g=j+"%",e.val(g)}else""==g&&this.ui.workDescription.val(this.ui.workDescription.attr("text-origion"));d.prev(this.ui.workName).hasClass("input_error")||d.prev(this.ui.workDescription).hasClass("input_error")||this.updateProject(f,g).done(function(){e.removeClass("input_focus_bule"),d.slideUp("slow"),"Progress"==f&&(c.$el.find(".progress_bar").css({width:g}),"0%"!=g?c.$el.find(".split").removeAttr("style"):c.$el.find(".split").css({background:"#eeeeee"}))})},onCancel:function(b){var c=this;this.tDialogViewError&&c.tDialogViewError.hide();var d=a.$(b.target).parent(".project_btn_group");d.slideUp("slow");var c=this,e=d.siblings(".input_container"),f=e.attr("data-type");"Descripition"==f?(e.val(this.model.get(f)),e.trigger("autosize.resize")):e.val(this.model.get(f)),(""==this.model.get(f)||!this.model.get(f)&&"Descripition"==f)&&(e.val(e.attr("text-origion")),e.trigger("autosize.resize")),e.removeClass("input_error").removeClass("input_focus_bule")},updateProject:function(b,c){var d=new a.$.Deferred,e=this.dealUpdateData();if(e[b]!=c){var f=this;e[b]=c;var g={handler:"Update",data:e};if("Visibility"===b){var h={work_id:e.WorkId,visibility:c};g.handler="Visibility",g.data=h}if("Progress"===b){var h={work_id:e.WorkId,progress:c};g.handler="UpdateProgress",g.data=h}switch(b){case"Visibility":f.model.set("IsVisible",c);break;case"Progress":f.model.set("Progress",c);break;case"Descripition":f.model.set({Description:c,Descripition:c});break;default:f.model.set(b,c)}var i=a.app.request("Project:updateData",g);i.done(function(){f.formApp(),d.resolve()}).fail(function(){a.app.vent.trigger("detail:_tita_work:operate")})}else d.resolve();return d.promise()},dealUpdateData:function(){return{WorkId:this.model.get("WorkId"),WorkName:this.model.get("WorkName"),Descripition:this.model.get("Description")||"",StartDate:this.model.get("StartDate")||"",DeadLine:this.model.get("EndDate")||"",Visibility:this.model.get("IsVisible"),Participators:this.model.get("IsParticipate"),WorkType:this.model.get("WorkType")}},onMembersCountChange:function(){var a=this.model.get("MembersTotal");this.$el.find('a[href$="detail_type=user"] span').empty().html("人员&nbsp;&nbsp;"+a)},onTaskTotalChange:function(){var a=this.model.get("TaskTotal");this.$el.find('a[href$="detail_type=task"] span').empty().html("任务&nbsp;&nbsp;"+a)},onTrendTotalChange:function(){var a=this.model.get("TrendTotal");this.$el.find('a[href$="detail_type=feed"] span').empty().html("动态&nbsp;&nbsp;"+a)},onAttachmentTotalChange:function(){var a=this.model.get("AttachmentTotal");this.$el.find('a[href$="detail_type=file"] span').empty().html("文件&nbsp;&nbsp;"+a)},checkInput:function(b){var c=a.$(b.target),d=c.attr("data-type"),e=a.$.trim(c.val());a._.isStringBeyondLength(e,this.defaults[d+"Len"])&&"WorkName"==d?(c.hasClass("input_error")||c.addClass("input_error"),this.showDialogArrow(c,"最多"+parseInt(this.defaults[d+"Len"])/2+"个字","warn")):(c.hasClass("input_focus_bule")||c.addClass("input_focus_bule"),c.removeClass("input_error"),this.tDialogViewError&&this.tDialogViewError.hide())},checkDateSet:function(a){var b,c,d,e=this.$el.find(".project_detail_time_edit .time_begin"),f=this.$el.find(".project_detail_time_edit .time_end");if(this.curBtnDate.hasClass("time_begin")?(d=!0,b=a,c=this.model.get("endDate")):(b=this.model.get("startDate"),c=a,d=!1),b!=e.attr("text-origion")&&c!=f.attr("text-origion")){var g=new Date(c).getTime()-new Date(b).getTime();return 0>g?!1:(this.model.set({startDate:b,endDate:c}),this.renderTimeView(),!0)}return this.model.set({startDate:b,endDate:c}),this.renderTimeView(),!0},convertDate:function(a){return""!=a&&a?a=a.replace(/\./g,"/"):""},onClose:function(){this.delDialog&&this.delDialog.close(),this.tDialogViewError&&this.tDialogViewError.close(),this.actionView&&this.actionView.close()},formApp:function(){this.fromAppView||(this.fromAppView=new h({routerData:this.model.get("routerData")})),this.fromAppView.postData(this.model.get("WorkId"))}})}),define("views/common/loading-view",["talent"],function(a){return a.ItemView.extend({template:a._.template('<img src="'+a.Context.getStaticUrl("images/loading_v1.gif")+'"><span>&nbsp;加载中...</span>'),className:"_tt_common_loading",hide:function(){this.$el.hide()},show:function(){this.$el.show()}})}),define("views/work/dynamic-composite-view",["talent","templates/work","views/common/loading-view","views/common/empty-view","TitaWidget"],function(a,b,c,d,e){return a.Layout.extend({template:b["work/dynamic-composite"],ui:{pubblog:"div[data-name=pubblog]",feedList:"div[data-name=feedlist]"},regions:{feedList:'div[data-name="feedlist"]',pubblog:"div[data-name=pubblog]"},initialize:function(b){this.options=b,this.i18n=a.Context.getI18n(),this.iWork=this.i18n.work_1,this.userInfo=a.Context.getUserInfo(),this.pageIndex="";var c=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"FeedId"})}});this.feedCollection=new c},onRender:function(){var b=this,d=new c;this.feedList.show(d),a.$.when(this._getFeedData()).done(function(a){b.feedCollection.add(a.Data),b._renderFeedView(a),b._renderPubblog()})},onClose:function(){},_renderPubblog:function(){var b=this.model.get("WorkName"),c=this.model.get("IsVisible")||1,d=2==this.model.get("IsVisible")?"仅项目成员可见":"公开",f=this,g=new e.PublistMblogView({isShowRange:!0,privateText:d,privateValue:c,isShowRangeDropDown:!1,isShowSendSms:!1,atAllText:this.iWork+"所有成员",atAllTipText:"所有"+this.iWork+"成员将收到本条消息",atAllValue:"@["+b+":project_members]",isShowAtAll:1==this.model.get("IsPrincipal")||1==this.model.get("IsParticipate")?!0:!1,id:"work-publish-mlog-"+this.model.get("WorkId"),shape:"line",submitRequest:function(b,c){var d=new a.$.Deferred,e={Content:c.context,ObjType:f.model.get("ObjType"),ObjId:f.model.get("WorkId"),FileUrls:c.files.join(","),Visibility:c.visibility,IsSendSMS:c.isSendSMS,otherDocuments:c.YFYDocuments,AppId:f.options.routerData.appId,AppType:f.options.routerData.appType},g={};return 203==f.options.routerData.appId&&(g={AppObjType:20301}),Talent.app.request("Feed:feedAddShare",a._.extend(e,g)).done(function(a){f._addItemViewFeed(a),d.resolve(a)}).fail(function(a){this._tipMessage(b,a)}),d}});this.pubblog.show(g)},_addItemViewFeed:function(b){var c=this.feedCompositeView.addNewItemFeed(new a.Model(b));this.feedCompositeView.$el.find(".tt_common_emptyinit").remove(),this.feedCompositeView.$el.find("[data-name=feed-list-box]").prepend(c),c.slideDown()},_getObjTopFeed:function(){var b=new a.$.Deferred;return b},_getFeedData:function(){var b=this,c=new a.$.Deferred;return a.app.request("Feed:getObjFeed",{obj_id:this.model.get("WorkId"),obj_type:4,feed_count:20,comment_count:4,start:this.pageIndex,to_user_id:this.userInfo.Id,AppId:this.options.routerData.appId,AppType:this.options.routerData.appType}).done(function(a){var d={isEnd:a.IsEnd,lastId:a.LastId,feeds:a.Data};b.pageIndex=a.LastId,c.resolve(d)}),c},_renderFeedView:function(b){var c=this,f=this.model.get("WorkName");if(!this.feedCompositeView&&(this.feedCompositeView=new e.FeedListView({isInAppPage:!0,mBlogOptions:{defaultHide:!0,params:{ObjType:c.model.get("ObjType"),ObjId:c.model.get("WorkId")},atAllText:this.iWork+"所有成员",atAllTipText:"所有"+this.iWork+"成员将收到本条消息",atAllValue:"@["+f+":project_members]",isShowAtAll:1==c.model.get("IsPrincipal")||1==c.model.get("IsParticipate")?!0:!1},actionMore:{setTopPramas:{titaObj_type:c.model.get("ObjType"),titaObj_id:c.model.get("WorkId")}},requestMoreFeed:function(){var b=new a.$.Deferred;return c._getFeedData().done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)}),b},model:new a.Model(b)}),this.feedList&&this.feedList&&this.feedList.show(this.feedCompositeView),0==b.feeds.length)){var g=new d({emptyContext:"还没有任何动态"});this.feedCompositeView.$el.find("[data-name=feed-list-box]").html(g.render().el)}}})}),define("views/common/file/file-move-view",["talent","templates/common"],function(a,b){var c=a.CompositeView.extend({template:b["common/file/file-move-item"],tagName:"li",initialize:function(){this.collection=this.model.children},appendHtml:function(a,b){a.$el.find("ul:first").append(b.el)},onRender:function(){this.$el.attr({id:this.model.get("Id"),pid:this.model.get("PId"),"data-end":this.model.get("isEnd")})}}),d=a.CollectionView.extend({itemView:c,tagName:"ul",events:function(){var a={};return a["click ul"]="_ulHandler",a["click li"]="_ulHandler",a["click li div[data-name=title]"]="_checkHandler",a["click li span[data-name=toggle]"]="_toggleHandler",a},initialize:function(){this.activeFolder=this.$el.find("li:first")},_ulHandler:function(a){a.stopPropagation()},_toggleHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget).closest("li"),d=c.attr("data-end");"false"==d&&(c.hasClass("unfold")?c.removeClass("unfold"):c.addClass("unfold"))},_checkHandler:function(b){{var c=a.$(b.currentTarget).closest("li");c.attr("data-end")}this.activeFolder=c,this.$el.find("div[data-name=title]").removeClass("active"),c.find("div[data-name=title]:first").addClass("active"),this.trigger("checked",this.activeFolder,{id:parseInt(c.attr("id")),pId:parseInt(c.attr("pid"))})},onShow:function(){this.$el.find("li:first").addClass("unfold").find("div[data-name=title]:first").addClass("active")}}),e=a.ItemView.extend({template:b["common/file/file-move-new"],tagName:"li",onRender:function(){},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},_focusHandler:function(b){a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus")},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=c.val();this.model.set("name",a.$.trim(d))},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.model.get("name");""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.model.set("name",""),this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel"),this.close()}});return a.Layout.extend({template:b["common/file/file-move"],itemFolderTemplate:b["common/file/file-move-item"],className:"tt_document_treedialog",ui:{closed:"span[data-name=file-move-close]",newFolder:"a[data-name=file-move-new-folder]",submit:"a[data-name=file-move-submit]"},regions:{tree:"div[data-name=tree]"},collectionEvents:{reset:"render"},events:function(){var a={};return a["click "+this.ui.closed]="_closeHandler",a["click "+this.ui.submit]="_submitHandler",a["click "+this.ui.newFolder]="_newFolderHandler",a["focus "+this.ui.newFolderForm_input]="_focusNewFolderHandler",a},initialize:function(){this.addAjax=!1,this.model.set({id:0,pId:0})},_submitHandler:function(b){var c=a.$(b.currentTarget);this.trigger("submit",{id:this.model.get("id"),pId:this.model.get("pId")},c)},_closeHandler:function(b){a.$(b.currentTarget);this.trigger("closed"),this.close()},_newFolderHandler:function(){this.newFolderView&&this.newFolderView.close(),this.newFolderView=new e,this.listenTo(this.newFolderView,"submit",function(a){this._submitNewFolderHandler(a)},this),this.listenTo(this.newFolderView,"cancel",function(){this.activeFolder.removeClass("unfold")},this),this.activeFolder.addClass("unfold"),this.activeFolder.find("ul:first").prepend(this.newFolderView.render().el),this.newFolderView.ui.input.focus()},_submitNewFolderHandler:function(b){var d=this;if(!this.addAjax){this.addAjax=!0;var e="mine"==this.model.get("fileType")?"Document:postAddPersonalShareFolder":"Document:postAddShareFolder";a.app.request(e,{parent_doc_id:this.model.get("id"),folder_name:a.$.trim(b)}).done(function(b){b.isEnd=!0,b.PId=d.model.get("id"),b.Id=b.DocumentId,d.addAjax=!1;var e=new c({model:new a.Model(b)});d.activeFolder.find("ul:first").prepend(e.render().el),d.trigger("moveNewFolder",d._dealData([b])[0])}).fail(function(){d.addAjax=!1})}},_dealData:function(b){return a._.map(b,function(b){var c=b.FileType;if(/^jpg|png|gif|jpeg|JPG|PNG|GIF|JPEG$/.test(c))if(b.PreviewUrl){var d=b.PreviewUrl.lastIndexOf(".");b.imageUrl=b.PreviewUrl.substr(0,d)+"_s."+b.PreviewUrl.substr(d+1),"gif"==b.FileType&&(b.imageUrl=b.PreviewUrl)}else b.imageUrl="";else fileIconName=/^(rar|zip|exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx|folder)$/.test(c)?c:/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(c)?"music":/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(c)?"video":"file",b.imageUrl=a.Context.getStaticUrl("images/feed/"+fileIconName+".png");return b.timestamp=(new Date).getTime(),b}),b},onRender:function(){var a=Backbone.Model.extend({initialize:function(){var a=this.get("children");a&&(this.children=new b(a),this.unset("children"))}}),b=Backbone.Collection.extend({model:a});this.treeView=new d({collection:new b(this.collection.toJSON())}),this.activeFolder=this.treeView.$el,this.listenTo(this.treeView,"checked",function(a,b){this.activeFolder=a,this.model.set({id:b.id,pId:b.pId}),this.trigger("checked",a,{id:b.id,pId:b.pId})},this),this.tree.show(this.treeView)}})}),jQuery.fn.pagination=function(a,b){return b=jQuery.extend({items_per_page:10,num_display_entries:10,current_page:0,num_edge_entries:0,link_to:"#",prev_text:"Prev",next_text:"Next",ellipse_text:"...",prev_show_always:!0,next_show_always:!0,callback:function(){return!1}},b||{}),this.each(function(){function c(){return Math.ceil(a/b.items_per_page)}function d(){var a=Math.ceil(b.num_display_entries/2),d=c(),e=d-b.num_display_entries,f=g>a?Math.max(Math.min(g-a,e),0):0,h=g>a?Math.min(g+a,d):Math.min(b.num_display_entries,d);return[f,h]}function e(a){g=a,f();var c=b.callback(a,h);return c}function f(){h.empty();var a=d(),f=c(),i=function(a){return function(b){return e(a,b)}},j=function(a,c){if(a=0>a?0:f>a?a:f-1,c=jQuery.extend({text:a+1,classes:""},c||{}),a==g)var d=jQuery("<span class='current'>"+c.text+"</span>");else var d=jQuery("<a>"+c.text+"</a>").bind("click",i(a)).attr("href",b.link_to.replace(/__id__/,a));c.classes&&d.addClass(c.classes),h.append(d)};if(b.prev_text&&(g>0||b.prev_show_always)&&j(g-1,{text:b.prev_text,classes:"prev"}),a[0]>0&&b.num_edge_entries>0){for(var k=Math.min(b.num_edge_entries,a[0]),l=0;k>l;l++)j(l);b.num_edge_entries<a[0]&&b.ellipse_text&&jQuery("<span>"+b.ellipse_text+"</span>").appendTo(h)}for(var l=a[0];l<a[1];l++)j(l);if(a[1]<f&&b.num_edge_entries>0){f-b.num_edge_entries>a[1]&&b.ellipse_text&&jQuery("<span>"+b.ellipse_text+"</span>").appendTo(h);for(var m=Math.max(f-b.num_edge_entries,a[1]),l=m;f>l;l++)j(l)}b.next_text&&(f-1>g||b.next_show_always)&&j(g+1,{text:b.next_text,classes:"next"})}var g=b.current_page;a=!a||0>a?1:a,b.items_per_page=!b.items_per_page||b.items_per_page<0?1:b.items_per_page;var h=jQuery(this);this.selectPage=function(a){e(a)},this.prevPage=function(){return g>0?(e(g-1),!0):!1},this.nextPage=function(){return g<c()-1?(e(g+1),!0):!1},f()})},define("$.paginate",function(){}),define("views/common/file/file-composite-view",["talent","templates/common","views/common/empty-view","views/common/file/file-move-view","tdialog","$.paginate"],function(a,b,c,d,e){var f=a.ItemView.extend({className:"item_dl",tagName:"li",template:b["common/file/file-item"],templateHelpers:function(){var b=this.model.get("FileType"),c=(a.Context.getUserInfo(),this.model.get("imageUrl")),d=!0;return c||(d=!1),{isShowDelete:this.options.isShowDelete,isShowOriginal:this.options.isShowOriginal,emptyContext:this.options.emptyContext,isShowAction:this.options.isShowAction,isPreview:this.options.isPreview,isShowDownload:this.options.isShowDownload,isShowMove:this.options.isShowMove,isShowRename:this.options.isShowRename,isShowPermissions:this.options.isShowPermissions,iconUrl:a.Context.getStaticUrl("images/file/"+b+".png"),pId:this.options.pId,fileType:this.options.fileType,isImage:d}},initialize:function(a){this.options=a},onRender:function(){this.$el.attr("id",this.model.get("Id"))},modelEvents:{"change:DownloadUrl":"render","change:FileName":"render"}}),g=a.ItemView.extend({template:b["common/file/file-rename"],className:"documentlist_rename",ui:{rename_inputwrap:"div[data-name=rename-inputwrap]",rename_input:"input",rename_sure:"a[data-name=rename-sure]",rename_cancel:"a[data-name=rename-cancel]",form:"form[data-name=rename-form]"},events:function(){var a={};return a["focus "+this.ui.rename_input]="_focusHandler",a["blur "+this.ui.rename_input]="_blurHandler",a["keyup "+this.ui.rename_input]="_keyupHandler",a["click "+this.ui.rename_sure]="_sureHandler",a["click "+this.ui.rename_cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},_focusHandler:function(b){a.$(b.currentTarget);this.ui.rename_inputwrap.removeClass("input-error").addClass("input-focus")},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=c.val();this.model.set("name",a.$.trim(d))},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.rename_inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.preventDefault();var c=(a.$(b.currentTarget),this.model.get("name"));""==a.$.trim(c)?this.ui.rename_inputwrap.removeClass("input-focus").addClass("input-error"):this.trigger("submit",a.$.trim(c))},_cancelHandler:function(b){{var c=a.$(b.currentTarget);c.val()}this.model.set("name",""),this.ui.rename_inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel"),this.$el.remove()}});return a.CompositeView.extend({itemView:f,itemViewContainer:"#project_file_item",template:b["common/file/file-composite"],emptyView:c,ui:{checkAll:"a[data-name=check-all]",moveAll:"button[data-name=btn-move]",deleteAll:"button[data-name=btn-delete]",deleteItem:"a[data-name=delete]",download:"a[data-name=download]",checkItem:"a[data-name=check-item]",checkTotalTxt:"span[data-name=check-total]",pager:"div[data-name=page]",permissionsItem:"a[data-name=permissions]",permissionsDropDown:"div[data-name=permissions-dropdown]",permissionsDropDownItem:"div[data-name=permissions-dropdown] li",rename:"a[data-name=rename]",moveItem:"a[data-name=move]",folderName:"a[data-name=folder-name]",actionArea:"div[data-name=action-area]",enclosure:'div[data-name="my-enclosure"]'},events:function(){var a={};return a["click "+this.ui.checkAll]="_checkAllHandler",a["click "+this.ui.checkItem]="_checkItemHandler",a["click "+this.ui.deleteAll]="_deleteAllHandler",a["click "+this.ui.deleteItem]="_deleteItemHandler",a["click "+this.ui.permissionsItem]="_permissionsItemHandler",a["click "+this.ui.permissionsDropDownItem]="_permissionsDropDownItemHandler",a["click "+this.ui.rename]="_renameItemHandler",a["click "+this.ui.moveAll]="_moveAllHandler",a["click "+this.ui.moveItem]="_moveItemHandler",a["click "+this.ui.folderName]="_enterFolderHandler",a},modelEvents:{"change:checkTotal":"_changeCheckTotalFun","change:total":"_showPage","change:needEnclosure":"_showFuJian","change:isShowDelete":"_isShowDeleteBtn"},collectionEvents:{reset:"_collectionResetFun",add:"_collectionAddRemove",remove:"_collectionAddRemove"},onRender:function(){this._showPage()},_collectionAddRemove:function(){var a=this.collection.length;a>0?this.ui.actionArea.show():this.ui.actionArea.hide()},_isShowDeleteBtn:function(){var a=this.model.get("isShowDelete");a?this.ui.deleteAll.show():this.ui.deleteAll.hide()},_collectionResetFun:function(){this.fileMoveView&&this.fileMoveView.close(),this.tDialogView&&this.tDialogView.close(),this.model.set({fileTotal:0,folderTotal:0,checkTotal:0})},_changeCheckTotalFun:function(){var a=this.$el.find("a[data-name=check-item]").length,b=this.model.get("checkTotal"),c=this.model.get("folderTotal"),d=this.model.get("fileTotal");
b>0?(this.ui.deleteAll.removeClass("btn-disabled"),this.ui.moveAll.removeClass("btn-disabled"),this.ui.checkTotalTxt.html("已选择"+d+"个文件、"+c+"个文件夹")):(this.ui.deleteAll.addClass("btn-disabled"),this.ui.moveAll.addClass("btn-disabled"),this.ui.checkTotalTxt.html("本页全选")),b&&b==a?this.ui.checkAll.addClass("checkbox-checked"):this.ui.checkAll.removeClass("checkbox-checked")},initialize:function(){var b=this;this.i18n=a.Context.getI18n(),this.iWork=this.i18n.work_1,this.activeId=0,this.tajax_moveFolder=!1,this.defaults={emptyContext:this.iWork+"中分享的附件（文件/图片）都会集中显示在这里",types:"file",isPreview:!0,isShowDownload:!0,isShowMove:!1,isShowRename:!1,isShowPermissions:!1,isShowDelete:!1,isShowOriginal:!0,isShowAction:!1,isCreateByProject:!1},this.settings=a._.extend({},this.defaults,this.options,this.model.toJSON()),this.model.set({fileTotal:0,folderTotal:0,checkTotal:0}),a.$(document).off("click.File-Composite-View"),a.$(document).on("click.File-Composite-View",function(){b.ui.permissionsDropDown&&b.ui.permissionsDropDown.hide&&b.ui.permissionsDropDown.hide()}),this.on("isShowEmptyView",function(a){this.emptyView=a.isShowEmptyView?c:null})},onShow:function(){this._showPage()},_showFuJian:function(){var a=this.model.get("needEnclosure"),b=this.ui.enclosure;a?b.show():b.hide()},_checkAllHandler:function(b){var c=a.$(b.currentTarget),d=this.$el.find("a[data-name=check-item]");if(c.hasClass("checkbox-checked"))c.removeClass("checkbox-checked"),d.removeClass("checkbox-checked"),this.model.set("folderTotal",0),this.model.set("fileTotal",0),this.model.set("checkTotal",0);else{var e=0,f=0;c.addClass("checkbox-checked"),d.addClass("checkbox-checked"),a.$.each(d,function(){var a=$(this);"folder"==a.attr("data-type")?e+=1:f+=1}),this.model.set("folderTotal",e),this.model.set("fileTotal",f),this.model.set("checkTotal",d.length)}},_checkItemHandler:function(b){var c=a.$(b.currentTarget),d=(this.ui.checkItem.length,this.model.get("checkTotal")),e=this.model.get("folderTotal"),f=this.model.get("fileTotal"),g=c.attr("data-type");c.hasClass("checkbox-checked")?(c.removeClass("checkbox-checked"),"folder"==g?this.model.set("folderTotal",e-1):this.model.set("fileTotal",f-1),this.model.set("checkTotal",d-1)):(c.addClass("checkbox-checked"),"folder"==g?this.model.set("folderTotal",e+1):this.model.set("fileTotal",f+1),this.model.set("checkTotal",d+1))},_renameItemHandler:function(b){var c=a.$(b.currentTarget);this.id=c.attr("id");var d=this.collection.get(this.id);this.activeLi=c.closest("li"),this.renameView&&this.renameView.close(),this.renameView=new g({model:new a.Model({name:d.get("FileName")})}),this.listenTo(this.renameView,"cancel",function(){this.activeLi.find("div[data-name=name]").show(),this.renameView.close()}),this.listenTo(this.renameView,"submit",function(a){var b=this.collection.get(this.id);b.get("FileName")==a?this.renameView.trigger("cancel"):this.trigger("rename",{id:this.id,name:a})}),this.activeLi.find("div[data-name=name]").hide().after(this.renameView.render().el),this.renameView.ui.rename_input.focus().select()},_moveAllHandler:function(b){var c=a.$(b.currentTarget),d=this._returnCheckedIds();d.length&&(this._requrestFolder(),this._renderMoveDialogView(d,c,"left"))},_moveItemHandler:function(b){var c=a.$(b.currentTarget),d=parseInt(c.attr("id")),e=parseInt(c.attr("pid"));this._requrestFolder(),this._renderMoveDialogView([{id:d,pId:e}],c,"right")},_requrestFolder:function(){var b=this,c="mine"==this.model.get("fileType")?"Document:getPersonalFolders":"Document:getShareFoldersData";this.tajax_moveFolder||(this.tajax_moveFolder=!0,a.app.request(c,{}).done(function(a){b.tajax_moveFolder=!1,b.treeViewOriginalData=a.original,b.fileMoveView.collection.reset(a.process)}).fail(function(){b.tajax_moveFolder=!1}))},_renderMoveDialogView:function(b,c,e){var f=a._.pluck(b,"id"),g=a._.pluck(b,"pId");this.fileMoveView&&this.fileMoveView.close(),this.fileMoveView=new d({collection:new a.Collection,model:new a.Model({fileType:this.model.get("fileType")})}),this.listenTo(this.fileMoveView,"moveNewFolder",function(a){a.PId==this.model.get("pId")&&this.collection.add(a)},this),this.listenTo(this.fileMoveView,"checked",function(){},this),this.listenTo(this.fileMoveView,"submit",function(b,d){var e=(a._.indexOf(f,b.id),this._returnPidsData(b.id));e.push(b.id);var h=a._.intersection(f,e);if(h.length)return void this._tipDialog(d,"warn","不能将文件移动到自身或其子目录下");var i=a._.indexOf(g,b.id);return i>-1?void this._tipDialog(d,"warn","不能将文件移动到自身或其子目录下"):(this.trigger("moveTo",{ids:f,folderId:b.id,folderPid:b.pId},c),void this.fileMoveView.close())}),this.$el.append(this.fileMoveView.render().el);var h=c.offset(),i=c.outerWidth(),j=c.outerHeight(),k=this.fileMoveView.$el,l=k.outerWidth();this.fileMoveView.$el.css("right"==e?{top:h.top+j+5,left:h.left-l+i}:{top:h.top+j+5,left:h.left})},_returnPidsData:function(b){function c(b){var f=a._.findWhere(d,{Id:parseInt(b)});if(!f)return e;var g=f.PId;e.push(g),g&&c(g)}var d=this.treeViewOriginalData,e=[];return c(b),e},_enterFolderHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("href"),e=a.Context.parseUrl(d);this.trigger("enterFolder",e.id)},_deleteAllHandler:function(b){var c=a.$(b.currentTarget),d=this,e=this._returnCheckedIds(),f=a._.pluck(e,"id"),g=this.model.get("fileType"),h=!1,i="",j=0;if("mine"==g){for(;j<e.length;)2==this.collection.get(e[j].id).get("FileSourceType")?(h=!0,e.splice(j,1)):j++;f=a._.pluck(e,"id"),i=h?"我发表过的附件不能被删除，其余内容将被删除。":"您确定要删除这些内容吗？"}else i="你确定要删除这些内容吗?文件夹下的内容都将被删除";this._tipDialogView(c,i,"topCenter",function(){f.length&&d.trigger("deleteAll",{ids:f})})},_deleteItemHandler:function(b){var c=a.$(b.currentTarget),d=this,e=c.attr("data-type"),f=this.model.get("fileType"),g=(2==c.attr("file-type")?!0:!1,"");g="folder"!=e?"您确定要删除该文件么?":"mine"==f?"确定删除该文件夹?上传的文件将被删除,<br />我发表过的附件将转移回默认文件夹":"您确定要删除该文件夹么？该文件夹下的内容都将被删除",this.id=c.attr("id"),this._tipDialogView(c,g,"topRight",function(){d.tDialogView.hide(),d.trigger("deleteItem",{ids:[d.id]})})},_returnCheckedIds:function(){var b=this.$el.find("a[data-name=check-item]"),c=[];return a.$.each(b,function(){var b=a.$(this);if(b.hasClass("checkbox-checked")){var d=parseInt(b.attr("id")),e=parseInt(b.attr("pid"));c.push({id:d,pId:e})}}),c},_permissionsItemHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.offset(),e=c.width(),f=c.outerHeight(),g=this.ui.permissionsDropDown.outerWidth();this.id=c.attr("id");var h=this.collection.get(this.id),i=h.get("DownloadUrl");this.ui.permissionsDropDownItem.find("a").removeClass("active"),i?this.ui.permissionsDropDown.find("li[data-type=true] a").addClass("active"):this.ui.permissionsDropDown.find("li[data-type=false] a").addClass("active"),this.ui.permissionsDropDown.css({top:d.top+f+5,left:d.left+e-g}).show()},_permissionsDropDownItemHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("data-type");this.trigger("permissions",{isDownload:d,id:this.id})},_tipDialogView:function(a,b,c,d){var f=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new e({type:"tipsy",sure:function(){d&&d(),f.tDialogView.close()},cancel:function(){f.tDialogView&&f.tDialogView.close()}}),this.tDialogView.render().$el.appendTo(this.$el),this.tDialogView.show(a,b,{arrow:2,pos:c,className:"ask"})},_showPage:function(){var a=this,b=this.model.get("total");return b?(this.ui.actionArea.show(),10>b?void this.ui.pager.hide():void this.ui.pager.show().empty().pagination(b,{items_per_page:10,prev_text:"前一页",next_text:"后一页",current_page:this.model.get("pageIndex")-1,prev_show_always:!0,next_show_always:!0,link_to:"javascript:void(0)",callback:function(b){a.trigger("page",b+1)}})):(this.ui.actionArea.hide(),void this.ui.pager.hide())},itemViewOptions:function(){return{emptyContext:this.model.get("emptyContext")?this.model.get("emptyContext"):this.settings.emptyContext,isShowDelete:this.model.get("isShowDelete"),isShowOriginal:this.settings.isShowOriginal,isShowAction:void 0!==this.model.get("isShowAction")?this.model.get("isShowAction"):this.settings.isShowAction,isPreview:this.settings.isPreview,isShowDownload:this.settings.isShowDownload,isShowMove:this.settings.isShowMove,isShowRename:this.settings.isShowRename,isShowPermissions:this.settings.isShowPermissions,pId:this.model.get("pId"),fileType:this.model.get("fileType")}},_tipDialog:function(a,b,c){this.tipDialog=new e({type:"tipsy",sure:!1,cancel:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(a,c,{pos:"topCenter",className:b,arrow:!1,autoHide:!0})},onClose:function(){this.tDialogView&&this.tDialogView.close(),a.$(document).off("click.File-Composite-View")},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render(),this.$el.find(this.itemViewContainer).children("li:first-child").length?this.$el.find(this.itemViewContainer).children("li:first-child").before(e.el):this.$el.find(this.itemViewContainer).append(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)}})}),define("views/common/plugins/class/class-treeItem-view",["talent","templates/common","$.tipsy"],function(a,b){return a.CompositeView.extend({template:b["common/plugins/class/class-move-item"],tagName:"li",initialize:function(){this.userInfo=a.Context.getUserInfo(),this.collection=this.model.children},ui:{enterprise:"span[data-name=enterprise]",person:"span[data-name=person]",permission:"span[data-name=lock-permission]"},appendHtml:function(a,b){a.$el.find("ul:first").append(b.el)},templateHelpers:function(){var a=!0;return 2==this.userInfo.Role?a=!0:this.model.get("IsTenant")&&(a=!1),{isEdit:a}},onRender:function(){this.$el.attr({id:this.model.get("id"),parent_id:this.model.get("parent_id"),"data-end":this.model.get("isEnd"),fullName:this.model.get("fullName"),ifAddClass:this.model.get("IsAllowSetPersonalLable")}),this._headIcoTispy()},_headIcoTispy:function(){a.$(this.ui.enterprise).tipsy({fallback:"企业分类",gravity:"s"}),a.$(this.ui.person).tipsy({fallback:"个人分类",gravity:"s"}),a.$(this.ui.permission).tipsy({fallback:"该分类下不允许添加个人分类",gravity:"s"})}})}),define("views/common/plugins/class/class-newFolder-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{type:"new",nameLen:200},template:b["common/plugins/class/class-move-new"],tagName:function(){return"rename"==this.options.type?"div":"li"},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a.click="_elHandler",a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},templateHelpers:function(){return{type:this.settings.type}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.attr("data-type","new-folder-form")},_elHandler:function(a){a.stopPropagation()},_focusHandler:function(b){a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus")},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=a.$.trim(c.val()),e=this.settings.nameLen;return a._.isStringBeyondLength(d,e)?(d=a._.substringWithM(d,e),c.val(d),!1):void 0},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.ui.input.val();this.model.set("name",a.$.trim(d)),""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel",this.model.get("name")),this.close()}})}),define("views/common/plugins/class/class-treeCollection-view",["talent","templates/common","views/common/plugins/class/class-treeItem-view","views/common/plugins/class/class-newFolder-view","tdialog"],function(a,b,c,d,e){return a.CollectionView.extend({defaults:{isEdit:!1},itemView:c,tagName:"ul",events:function(){var a={};return a["click ul"]="_ulHandler",a["click li div[data-name=title]"]="_checkHandler",a["click li span[data-name=toggle]"]="_toggleHandler",a["click li a[data-name=deleted]"]="_deleteHandler",a["click li a[data-name=edit]"]="_editHandler",a},collectionEvents:{reset:"render"},initialize:function(b){this.options=b,this.settings=a._.extend({},this.defaults,this.options),this.activeFolder=this.$el.find("li:first")},onShow:function(){var a=this.settings.isEdit,b=this.$el.find("li:first");b.addClass("unfold"),a?b.addClass("active"):b.find("ul:first").find("li:first").addClass("active")},itemViewOptions:function(){return{isEdit:this.settings.isEdit}},onAfterItemAdded:function(a){this.settings.isEdit||a.$el.find("div[data-name=klass-item-action]").remove()},_ulHandler:function(a){a.stopPropagation()},_toggleHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget).closest("li"),d=c.attr("data-end");"false"==d&&(c.hasClass("unfold")?c.removeClass("unfold"):c.addClass("unfold"))},_checkHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.closest("li"),e=(d.attr("data-end"),c.find("div[data-name=title-name]")),f=parseInt(d.attr("id")),g=d.attr("fullName");if(void 0!=g){var h=g.toString(),i=/^(分类\/)/;h=h.replace(i,"")}var j=this.settings.isEdit;"new-folder-form"!=d.attr("data-type")&&(0!=f||j)&&(this.activeFolder=d,this.$el.find("li").removeClass("active"),d.addClass("active"),this.trigger("checked",this.activeFolder,{id:f,name:a.$.trim(e.html()),fullName:h,parent_id:parseInt(d.attr("parent_id"))}))},_deleteHandler:function(b){var c=this;b.stopPropagation();var d=a.$(b.currentTarget),e=a.$(b.currentTarget).closest("li"),f=e.attr("parent_id"),g=d.attr("id");this._tipDialogView(d,"确定删除吗？子分类及相关信息都将被删除",function(){c.trigger("delete",{id:g,li:e,call:function(){e.remove();var a=c.$el.find('li[parent_id="'+f+'"]');if(!a.length){var b=c.$el.find('li[id="'+f+'"]');b.hasClass("unfold")&&b.find(".icon_tv").remove()}}})})},_editHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.attr("id"),e=a.$(b.currentTarget).closest("li");this._rendRenameView(d,c,e)},_rendRenameView:function(b,c,e){this.renameView&&this.renameView.close();var f=c.closest("div[data-name=title]"),g=f.find("div[data-name=title-name]"),h=g.html();this.renameView=new d({type:"rename",model:new a.Model({name:h})}),this.listenTo(this.renameView,"submit",function(a){this.trigger("rename",{id:b,name:a,node:e,node_name:g})},this),this.listenTo(this.renameView,"close",function(){g.html(this.renameView.model.get("name"))},this),g.html(this.renameView.render().$el),this.renameView.ui.input.focus()},_tipDialogView:function(a,b,c){var d=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new e({type:"tipsy",sure:!0,cancel:!0,sure:function(){c&&c(),d.tDialogView.close()}}),this.tDialogView.render().$el.appendTo(this.$el);var f=$("body").find(".tu-page-container").scrollTop()||0;this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",topBias:f-50,className:"ask"})},onClose:function(){}})}),define("views/common/plugins/class/class-search-view",["talent","templates/common","tdialog"],function(a,b){return a.ItemView.extend({template:b["common/plugins/class/class-search"],className:"class_search",ui:{content:".smember_condition_input",lableUl:"ul[data-name=lable-ul]",lableList:"ul[data-name=lable-list]",lableNameItem:"li[data-name=lablename]",contentHolder:".smember_condition_label",smemberHeaderInput:".smember_header_input"},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.$el.on("click",function(a){a.stopPropagation()}),this.collection=new a.Collection},events:function(){var a={};return a["focusout .smember_condition_input"]="onInputFocusOut",a["focusin .smember_condition_input"]="onInputFocusin",a["click "+this.ui.lableNameItem]="_checkHandler",a["click "+this.ui.contentHolder]="_smemberHandler",a},onRender:function(){var a=this;this.$el.find("#lable-list").hide(),this.$el.find("#lableName").on("keyup",function(){a.lableList()}),this.$el.find("#lableName").on("keypress",function(b){13==b.which&&a.lableList()})},onInputFocusOut:function(){this.ui.smemberHeaderInput.removeClass("input-focus"),""==this.ui.content.val()&&this.ui.contentHolder.show()},_checkHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(d);this.$el.find("#lableName").val(c.text()),this.$el.find("#lable-list").hide(),this.trigger("checkedLable",e.toJSON())},_smemberHandler:function(b){this.ui.contentHolder.hide();a.$(b.currentTarget);this.$el.find("#lableName").focus()},onInputFocusin:function(){this.ui.smemberHeaderInput.addClass("input-focus"),this.ui.contentHolder.hide();var b=a.$.trim(this.ui.content.val());return null==b||""==b?void this.$el.find("#lable-list").hide():void 0},lableList:function(){var b=this,c=a.$.trim(this.ui.content.val());return null==c||""==c?void this.$el.find("#lable-list").hide():void a.app.request("Lable:searchClassData",{user_id:this.userInfo.Id,filter:c}).done(function(a){b.collection.reset(a.lables||[]),b._listPlan(a.lables)}).fail(function(){})},_listPlan:function(b){var c="";null!=b&&b.length>0?a._.each(b,function(a){""!=a.name&&null!=a.name&&void 0!=a.name&&(c+='<li data-name="lablename" parentId ="'+a.parent_id+'" id="'+a.id+'">'+a.name+"</li>")}):c+="<li>无搜索结果</li>",this.ui.lableUl.empty(),this.ui.lableUl.append(c),this.$el.find("#lable-list").show()}})}),define("views/common/plugins/class/class-project-tab-item-view",["talent","templates/common"],function(a,b){var c=a.ItemView.extend({className:"class_project_tab",template:b["common/plugins/class/class-project-tab"],ui:{tabA:"a"},initialize:function(){this.$el.on("click",function(a){a.stopPropagation()})},events:function(){var a={};return a["click "+this.ui.tabA]="_clickTabName",a},_clickTabName:function(b){this.$el.find("a").removeClass("current");var c=a.$(b.currentTarget);c.addClass("current"),this.trigger("changeTree",c.attr("data-id"))},onRender:function(){}});return c}),define("views/common/plugins/class/class-view",["talent","templates/common","views/common/empty-view","views/common/plugins/class/class-treeItem-view","views/common/plugins/class/class-treeCollection-view","views/common/plugins/class/class-search-view","views/common/plugins/class/class-project-tab-item-view","tdialog"],function(a,b,c,d,e,f,g,h){var i=a.ItemView.extend({defaults:{type:"new",nameLen:100},template:b["common/plugins/class/class-move-new"],tagName:function(){return"rename"==this.options.type?"div":"li"},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"span[data-name=file-move-new-submit]",cancel:"span[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]"},events:function(){var a={};return a.click="_elHandler",a["focus "+this.ui.input]="_focusHandler",a["blur "+this.ui.input]="_blurHandler",a["keyup "+this.ui.input]="_keyupHandler",a["click "+this.ui.sure]="_sureHandler",a["click "+this.ui.cancel]="_cancelHandler",a["submit "+this.ui.form]="_sureHandler",a},templateHelpers:function(){return{type:this.settings.type}},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.attr("data-type","new-folder-form")},_elHandler:function(a){a.stopPropagation()},_focusHandler:function(b){var c=a.$(b.currentTarget);this.ui.inputwrap.removeClass("input-error").addClass("input-focus"),"rename"==this.settings.type&&this.model.get("name")&&c.select()},_keyupHandler:function(b){var c=a.$(b.currentTarget),d=a.$.trim(c.val()),e=this.settings.nameLen;return a._.isStringBeyondLength(d,e)?(d=a._.substringWithM(d,e),c.val(d),!1):void 0},_blurHandler:function(b){var c=a.$(b.currentTarget),d=c.val();""==a.$.trim(d)&&this.ui.inputwrap.removeClass("input-focus").addClass("input-error")},_sureHandler:function(b){b.stopPropagation(),b.preventDefault();var c=a.$(b.currentTarget),d=this.ui.input.val();this.model.set("name",a.$.trim(d)),""==a.$.trim(d)?this.ui.inputwrap.removeClass("input-focus").addClass("input-error"):(this.trigger("submit",a.$.trim(d),c),this.close())},_cancelHandler:function(b){b.stopPropagation();{var c=a.$(b.currentTarget);c.val()}this.ui.inputwrap.removeClass("input-focus").removeClass("input-error"),this.trigger("cancel",this.model.get("name")),this.close()}});return a.Layout.extend({defaults:{showTitle:!1,showButtonSure:!1,showButtonAdd:!1,showButtonReset:!1,showButtonCancel:!1,isEdit:!1,isShowSearch:!1,isShowProjectTab:!1},template:b["common/plugins/class/class-move"],itemFolderTemplate:b["common/plugins/class/class-move-item"],className:"tt_class_tree",ui:{closed:"span[data-name=klass-move-close]",newFolder:"button[data-name=klass-move-new-folder]",submit:"button[data-name=klass-move-submit]",title:"div[data-name=title]",actionArea:"div[data-name=klass-action]",emptyArea:"div[data-name=empty]",buttonReset:"button[data-name=klass-move-reset]",buttonCancel:"button[data-name=klass-move-cancel]",searchClass:"div[data-name=search-class]"},regions:{tree:"div[data-name=tree]",emptyArea:"div[data-name=empty]",classProjectTab:'div[data-name="class-project-tab"]'},collectionEvents:{reset:"_collectionReset"},_collectionReset:function(){var a=this.settings.isEdit,b=this.collection.toJSON()[0],c=b.children||[];a?b.length&&this.model.set({id:b[0].id,name:b[0].name}):this.model.set(c.length?{id:c[0].id,name:c[0].name}:{id:0,name:""}),this.render()},events:function(){var a={};return a["click "+this.ui.closed]="_closeHandler",a["click "+this.ui.submit]="_submitHandler",a["click "+this.ui.newFolder]="_newFolderHandler",a["click "+this.ui.buttonReset]="_resetHandler",a["click "+this.ui.buttonCancel]="_closeHandler",a["focus "+this.ui.newFolderForm_input]="_focusNewFolderHandler",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.addAjax=!1,this.model.set({id:0,name:"",parent_id:0}),a.$(document).on("click.documentlist_permissions",function(){$(document).find(".documentlist_permissions").hide(),$(document).find(".activeClass").hide()}),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){var a=this;this._customView(),this.settings.isShowProjectTab?(this._renderClassProjectTabView(),setTimeout(function(){a._changeClassViewCollection(2771)},0)):this._renderTreeView(),this.settings.isShowSearch&&this._searchView(),this._renderEmptyView()},_renderClassProjectTabView:function(){var a=this;this.classProjectTabView=new g,this.classProjectTab.show(this.classProjectTabView),this.listenTo(this.classProjectTabView,"changeTree",function(b){a._changeClassViewCollection(b)})},_changeClassViewCollection:function(b){if(0!=b){var c=this.collection.toJSON(),d=c[0].children,e=[];a._.each(d,function(a){a.id==b&&e.push(a)}),c[0].children=e,this._renderTreeView(c),this.$el.find('li[id="'+b+'"]').addClass("unfold")}else this._renderTreeView()},_searchView:function(){var a=this;this.searchView&&this.searchView.close(),this.searchView=new f,this.listenTo(this.searchView,"checkedLable",function(b){a.trigger("checkedLable",b),a._currentLiTree(b)}),this.ui.searchClass.append(this.searchView.render().el)},_currentLiTree:function(a){function b(a){var d=c.$el.find("div[data-name='tree'] li[id="+a+"]");if(d.length&&0!=a){var e=d.attr("parent_id");d.addClass("unfold"),b(e)}}var c=this,d=c.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').attr("parent_id");b(d),this.$el.find('div[data-name="tree"] li').removeClass("active"),this.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').addClass("active");var e=this.$el.find('div[data-name="tree"] li[id="'+a.id+'"]').position();this.trigger("scrollTop",{id:a.id,top:e.top})},setPosition:function(b,c){var d=b.offset(),e=b.outerWidth(),f=b.outerHeight(),g=this.$el,h=g.outerWidth(),i={pos:"left"},c=a._.extend({},i,c);this.$el.css("right"==c.pos?{top:d.top+f+5,left:d.left-h+e}:{top:d.top+f+5,left:d.left})},_renderEmptyView:function(){var a=this.settings.isEdit,b='请到<a href="#set?page_id=class">个人设置</a>下设置分类';a&&(b="点击 添加类别 添加分类"),this.ui.emptyArea.hide();var d=this.collection.toJSON();if(d.length&&d[0]&&d[0].children)return void this.ui.emptyArea.hide();var e=new c({emptyContext:b});this.emptyArea.show(e),this.ui.emptyArea.show()},_customView:function(){this.settings.showTitle||this.ui.title.remove(),this.settings.showButtonSure||this.ui.submit.remove(),this.settings.showButtonAdd||this.ui.newFolder.remove(),this.settings.showButtonSure||this.settings.showButtonAdd||this.ui.actionArea.remove(),this.settings.showButtonReset||this.ui.buttonReset.remove(),this.settings.showButtonCancel||this.ui.buttonCancel.remove()},_submitHandler:function(b){var c=a.$(b.currentTarget),d=null,e=null,f=null,g=this.model.get("name");""==g?(e=this.searchView.$el.find("#lableName").attr("ids"),d=this.searchView.$el.find("#lableName").val(),f=this.searchView.$el.find("#lableName").attr("parentid")):(e=this.model.get("id"),d=this.model.get("name"),f=this.model.get("parent_id")),this.model.set("id",e),this.model.set("parent_id",f),this.model.set("name",d);var h=this.treeView.collection.models[0].children;h&&!h.length?this.trigger("submit",{id:"",name:"",parent_id:""},c):this.trigger("submit",{id:this.model.get("id"),name:this.model.get("name"),parent_id:this.model.get("parent_id")},c),this.close()},_resetHandler:function(b){a.$(b.currentTarget);this.trigger("reset")},_closeHandler:function(b){a.$(b.currentTarget);this.trigger("closed"),this.close()},_newFolderHandler:function(b){var c=a.$(b.currentTarget),e=this;this.newFolderView&&this.newFolderView.close(),this.newFolderView=new i,this.listenTo(this.newFolderView,"submit",function(b){this.trigger("new",{name:b,parent_id:this.model.get("id"),node:c,call:function(b){b.isEnd=!0;var c=new d({model:new a.Model(b)});e.activeFolder.find("ul:first").prepend(c.render().el),e.ui.emptyArea.hide();var f=b.parent_id;e._addTreeCollectionIcon(f)}})},this),this.listenTo(this.newFolderView,"cancel",function(){this.activeFolder.removeClass("unfold")},this);{var f=this.activeFolder.attr("ifaddclass");this.activeFolder.attr("fullname")}"false"!=f?(this.activeFolder.addClass("unfold"),this.activeFolder.find("ul:first").prepend(this.newFolderView.render().el),this.newFolderView.ui.input.focus()):e._tipDialogView(c,"该分类下不允许创建个人分类")},_addTreeCollectionIcon:function(a){var b=this,c=this.$el.find("li [id='"+a+"']");this.$el.find("#iconTv").removeAttr("id"),c.children(":first").prepend('<span id="iconTv"  class="icon_tv" data-name="toggle"></span>'),this.$el.find("#iconTv").click(function(){var c=b.$el.find("li [id='"+a+"']").hasClass("unfold");c?b.$el.find("li [id='"+a+"']").removeClass("unfold"):b.$el.find("li [id='"+a+"']").addClass("unfold")})},_tipDialogView:function(a,b,c){var d=this;this.tDialogView&&this.tDialogView.close(),this.tDialogView=new h({type:"tipsy",sure:function(){c&&c(),d.tDialogView.close()},cancel:function(){d.tDialogView&&d.tDialogView.close()}}),this.tDialogView.render().$el.appendTo("body"),this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",className:"warn"})},_renderTreeView:function(a){var b=this,c=Backbone.Model.extend({initialize:function(){var a=this.get("children");a&&(this.children=new d(a),this.unset("children"))}}),d=Backbone.Collection.extend({model:c});if(a)var f=a;else var f=this.collection.toJSON();this.treeView=new e({collection:new d(f),isEdit:this.settings.isEdit}),this.activeFolder=this.treeView.$el,this.listenTo(this.treeView,"delete",function(a,c){b.trigger("delete",a,c)}),this.listenTo(this.treeView,"rename",function(a){var c=a.node;c.attr("id")==this.activeFolder.attr("id")&&this.model.set("name",a.name),b.trigger("rename",a)}),this.listenTo(this.treeView,"rename",function(a){var b=a.node;b.attr("id")==this.activeFolder.attr("id")&&this.model.set("name",a.name)}),this.listenTo(this.treeView,"checked",function(a,b){this.activeFolder=a,this.model.set({id:b.id,name:b.name,fullName:b.fullName,parent_id:b.parent_id}),this.trigger("checked",{id:b.id,name:b.name,fullName:b.fullName,parent_id:b.parent_id})},this),this.tree&&this.tree.show(this.treeView)},onClose:function(){this.tDialogView&&this.tDialogView.close(),a.$(document).off("click.documentlist_permissions")}})}),define("views/common/plugins/class/checked-class-composite-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({tagName:"li",template:b["common/plugins/class/checked-class-item"],initialize:function(){},ui:{delItem:".smember_btn_reduce"},events:function(){var a={};return a["click "+this.ui.delItem]="_deleteItem",a},onRender:function(){},_deleteItem:function(){this.trigger("deleteItem",this.model)}});return a.CompositeView.extend({defaults:{emptyContext:"请从左侧点击选择"},itemView:d,template:_.template("<ul></ul>"),itemViewContainer:"ul",emptyView:c,events:function(){var a={};return a},initialize:function(){},onRender:function(){var a=this;this.on("itemview:deleteItem",function(b){a.collection.remove(b.model)})},itemViewOptions:function(){return{emptyContext:this.defaults.emptyContext}}})}),define("views/common/plugins/class/project-view",["talent","templates/common","views/common/empty-view"],function(a,b,c){var d=a.ItemView.extend({template:b["common/plugins/class/work-item"],tagName:"li",onRender:function(){this.$el.attr("id",this.model.get("WorkId"))}}),e=a.CompositeView.extend({itemView:d,itemViewContainer:"ul",template:b["common/plugins/class/work-list"],className:"tt_klass_work",events:{"click li":"_chekcoutItemHandler","click div[data-name=work-title]":"_toggleHandler"},ui:{workList:"ul[data-name=work-list]"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.$el.on("click",function(a){a.stopPropagation()})},onRender:function(){this.settings.isDefaultChecked&&this.$el.find("li:first").addClass("active")},_toggleHandler:function(b){var c=a.$(b.currentTarget),d=c.next("ul"),e=d.is(":hidden");this.ui.workList.hide(),e?(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-minus-square"),d.show()):(c.find("span[data-name=toggle]").removeClass("icon-minus-square").addClass("icon-plus-square"),d.hide())},_chekcoutItemHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("id"),e=this.collection.get(parseInt(d));this.$el.find("li").removeClass("active"),c.addClass("active"),this.trigger("checked",{id:d,name:e.get("WorkName")})}});return a.Layout.extend({template:b["common/plugins/class/project"],className:"tt_class_tree",ui:{emptyArea:"div[data-name=empty]"},regions:{workBox:"div[data-name=work-box]",workJoinBox:"div[data-name=work-box-join]",emptyArea:"div[data-name=empty]"},events:function(){var a={};return a},initialize:function(){this.i18n=a.Context.getI18n(),this.joinCollection=this.options.joinCollection},onRender:function(){this._rendWorkListView(this.workBox,this.collection,"create"),this._rendWorkListView(this.workJoinBox,this.joinCollection,"join"),this._renderEmptyView()},_renderEmptyView:function(){if(this.ui.emptyArea.hide(),this.collection.length||this.joinCollection.length)return void this.ui.emptyArea.hide();var a=new c({emptyContext:"请在"+this.i18n.work_1+"功能下创建"+this.i18n.work_1});this.emptyArea.show(a),this.ui.emptyArea.show()},_rendWorkListView:function(b,c,d){var f="我负责的";"join"==d&&(f="我参与的");var g=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"WorkId"})}}),h=new e({collection:new g(c.toJSON()),model:new a.Model({title:f})});this.listenTo(h,"checked",function(a){this.trigger("checked",a)
},this),b.show(h)}})}),define("views/common/plugins/class/class-tree-component-view",["talent","templates/common","views/common/plugins/class/class-view","views/common/plugins/class/checked-class-composite-view","views/common/plugins/class/project-view"],function(a,b,c,d,e){return a.Layout.extend({defaults:{isShowSearch:!1,title:"",pluginType:0},template:b["common/plugins/class/class-tree-component"],className:"class_data_filter_dropdown",initialize:function(b){var c=this;this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.classCollection=new a.Collection,this.checkedCollection=new a.Collection,b.checkedClassCollection&&(this.checkedCollection=b.checkedClassCollection),a.$(document).off("click.Class-Tree-Component-View"),a.$(document).on("click.Class-Tree-Component-View",function(){c.close()}),this.$el.off("click"),this.$el.on("click",function(a){a.stopPropagation()})},regions:{classArea:".class_data_type_list",checkedTypeList:".class_data_checked_type_list"},ui:{sureBtn:'a[data-handler="Submit"]',canceltBtn:'a[data-handler="Cancel"]',closeBtn:'a[data-handler="Close"]',cleanBtn:'a[data-handler="clean"]',allClass:'[data-name="all"]',allProject:'[data-name="project"]'},events:function(){var a={};return a["click "+this.ui.sureBtn]="_sureChecked",a["click "+this.ui.canceltBtn]="_cancelChecked",a["click "+this.ui.closeBtn]="_cancelChecked",a["click "+this.ui.cleanBtn]="_cleanChecked",a["click "+this.ui.allClass]="_allClass",a["click "+this.ui.allProject]="_allProject",a},templateHelpers:function(){return{title:this.settings.title,pluginType:this.settings.pluginType}},_cleanChecked:function(){this.checkedCollection.reset(),this.close(),this.trigger("emptyClass")},_sureChecked:function(){this.trigger("checkedClass",this.checkedCollection.toJSON()),this.close()},_allClass:function(){this.ui.allClass.addClass("active"),this.ui.allProject.removeClass("active"),this._requestClassData()},_allProject:function(){this.ui.allClass.removeClass("active"),this.ui.allProject.addClass("active"),this._requestProjectData()},_cancelChecked:function(){this.close(),this.trigger("resetClass")},onClose:function(){a.$(document).on("click.Class-Tree-Component-View")},showView:function(){this.$el.show()},hideView:function(){this.$el.hide()},setPositon:function(b,c){b.outerHeight(),b.offset(),b.position();a.Context.setPosition(b,this.$el,{pos:"bottomLeft",container:c||a.$("body")})},onRender:function(){this._requestClassData(),this._renderClassView(),this._renderCheckedClassCompositeView()},_renderCheckedClassCompositeView:function(){this.checkedClassCompositeView=new d({collection:this.checkedCollection}),this.checkedTypeList.show(this.checkedClassCompositeView)},_requestProjectData:function(){var b=this;this.allProjectView?b.classArea.show(b.allProjectView):(this.allProjectView=new e({collection:new a.Collection,joinCollection:new a.Collection,pluginType:this.settings.pluginType}),this.listenTo(this.allProjectView,"checked",function(a){b.checkedCollection.push({id:a.id,name:a.name,fullName:a.name,type:2})}),a.app.request("Project:getProject",{app_id:1,app_type:1}).done(function(a){var c=a.CreateWorks||[],d=a.JoinWorks||[];b.allProjectView.collection.reset(c),b.allProjectView.joinCollection.reset(d),b.classArea.show(b.allProjectView)}))},_requestClassData:function(){var b=this;this.classView?this._renderClassView():a.app.request("Lable:getLableData",{obj_id:this.userInfo.Id,obj_type:1,to_userId:this.options.to_userId||0}).done(function(a){b.classCollection.reset(a.lables),b._renderClassView()}).fail(function(){})},_renderClassView:function(){var a=this;this.classView||(this.classView&&this.classView.close(),this.classView=new c({collection:this.classCollection,edit:!1,isShowSearch:this.settings.isShowSearch,pluginType:this.settings.pluginType}),this.listenTo(this.classView,"checkedLable",function(b){var c=a.checkedCollection.where({id:Number(b.id)});0==c.length?a.checkedCollection.add({id:b.id,name:b.name,fullName:b.fullName||"",type:1}):a.checkedCollection.findWhere({id:Number(b.id)}).set({id:b.id,name:b.name,fullName:b.fullName||"",type:1})},this),this.listenTo(this.classView,"checked",function(b){var c=a.checkedCollection.where({id:b.id});0==c.length&&a.checkedCollection.push({id:b.id,name:b.name,fullName:b.fullName,type:1})},this),this.listenTo(this.classView,"scrollTop",function(b){var c=this.$el.find(".class_data_type_list").height()/2,d=parseInt(this.$el.find(".class_data_type_list .cont_rd").css("paddingTop"));a.$el.find(".class_data_type_list").animate({scrollTop:b.top-c+d})},this)),this.classArea.show(this.classView)}})}),define("views/common/plugins/popup/sort-pop-view",["talent","templates/common","tdialog","moment","momentZH","$.tipsy"],function(a,b,c){return a.ItemView.extend({defaults:{displayType:"inline",container:null,node:null,isShowStar:!0},template:b["common/plugins/popup/sort-pop"],ui:{defaultSort:'[data-name="default"]',startSort:'[data-name="start"]',endSort:'[data-name="end"]',createSort:'[data-name="create"]',star:'[data-name="star"]',item:".item"},events:function(){var a={};return a["click "+this.ui.item]="_chooseHandler",a},modelEvents:{change:"render"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.renderTag=!0,this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",minWidth:90,className:"_tt_dialog ns-sortPop-dialog",displayType:this.settings.displayType}),this.settings.container.append("inline"==this.settings.displayType?this.Dialog.render().$el:this.Dialog.render().$el)},templateHelpers:function(){return this.settings},onRender:function(){var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"bottomRight",arrow:!1,container:this.settings.container}),b.Dialog.hide(),a.$(document).off("click.sortPop"),a.$(document).on("click.sortPop",function(){b.Dialog.hide()}),this.renderTag=!1),this.$("[original-title]").tipsy({gravity:"s"})},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},_chooseHandler:function(a){var b=this.$(a.currentTarget),c=b.attr("data-name"),d=this.model.get("SortType");switch(b.trigger("mouseleave"),c){case"default":d=1;break;case"start":d=3==d?2:3;break;case"end":d=5==d?4:5;break;case"create":d=7==d?6:7;break;case"star":d=8}this.model.set("SortType",d),this.trigger("submit"),this.Dialog.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.sortPop")}})}),define("views/common/plugins/popup/member-sort-view",["talent","templates/common","tdialog","moment","momentZH","$.tipsy"],function(a,b,c){return a.ItemView.extend({defaults:{displayType:"inline",node:null,container:null},template:b["common/plugins/popup/member-sort"],ui:{check:".check",labelTxt:".label",sure:'[data-name="sure"]'},events:function(){var a={};return a["click "+this.ui.check]="_checkHandler",a["click "+this.ui.labelTxt]="_checkHandler",a["click "+this.ui.sure]="_submitHandler",a},modelEvents:{change:"_checkIsEmpty"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.renderTag=!0,this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",className:"_tt_dialog ns-memberSort-dialog",displayType:this.settings.displayType}),this.settings.container.append("inline"==this.settings.displayType?this.Dialog.render().$el:this.Dialog.render().$el);var b=this.collection.findWhere({FidleName:"TaskPrincipal"}),d=this.collection.findWhere({FidleName:"TaskCreate"}),e=this.collection.findWhere({FidleName:"TaskParticipator"}),f=[];b&&f.push({key:"r",value:"1"}),d&&f.push({key:"c",value:"3"}),e&&f.push({key:"p",value:"2"}),this.model.set({checkAll:!0,isEmpty:!1,isShowRes:b,isShowCreate:d,isShowPart:e});for(var g=0,h=f.length;h>g;g++)this.model.set(f[g].key,!0);this.dataSet=f,this.caculateData()},onRender:function(){var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"bottomRight",arrow:!1,container:this.settings.container}),a.$(document).off("click.memberSortPop"),a.$(document).on("click.memberSortPop",function(){b.Dialog.hide()}))},_checkIsEmpty:function(){for(var a="",b="",c=!0,d=this.dataSet,e=this.model.toJSON(),f=0,g=d.length;g>f;f++)a=d[f].key,b=d[f].value,e[a]&&(c=!1);this.model.set({isEmpty:c},{silent:!0})},_checkHandler:function(a){var b=this.$(a.currentTarget).parent().attr("data-type"),c=this.model.toJSON(),d=c[b],e=this.dataSet,f=!0;if(this.model.set(b,!d),"checkAll"==b)for(var g=0,h=e.length;h>g;g++)this.model.set(e[g].key,!d);else{c=this.model.toJSON();for(var g=0,h=e.length;h>g;g++)c[e[g].key]||(f=!1);this.model.set({checkAll:f})}this.renderTag=!1,this.render(),a.stopPropagation()},caculateData:function(){for(var a="",b="",c=[],d=this.dataSet,e=this.model.toJSON(),f=0,g=d.length;g>f;f++)a=d[f].key,b=d[f].value,e[a]&&c.push(b);this.model.set({RelationType:c.join(",")})},_submitHandler:function(){var a=this.ui.sure;a.hasClass("btn-disabled")||(this.caculateData(),this.hide(),this.trigger("submit"))},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.memberSortPop")}})}),define("views/common/plan/plan-data-filter-view",["talent","templates/common","views/common/plugins/class/class-tree-component-view","$.tipsy","helpers/context","views/common/plugins/popup/sort-pop-view","views/common/plugins/popup/member-sort-view"],function(a,b,c,d,e,f,g){var h=a.ItemView.extend({template:b["common/plan/plan-data-filter-dropdown"],className:"tt_data_filter_dropdown",ui:{buttonSubmit:"button[data-name=submit]",dottedTips:'span[data-name="dotted-tips"]'},modelEvents:{"change:allChecked":"render"},events:{"click li":"_clickLiHandler","click button[data-name=submit]":"_submitDataHandler",'click div[data-name="filter-all"] a':"_clickFilterAllHandler"},templateHelpers:function(){return{data:this.options.collection.toJSON()}},initialize:function(){var b=this,c=this.options.collection||new a.Collection([]),d=a._.where(c.toJSON(),{Checked:!0})||[];d=a._.compact(d),this.activeData=a._.pluck(d,"Id")||[],this.activeLen=d.length||0,a.$(document).off("click.Plan-Data-Filter-Dropdown-View"),a.$(document).on("click.Plan-Data-Filter-Dropdown-View",function(){b.close()}),this.$el.off("click"),this.$el.on("click",function(a){a.stopPropagation()}),this.activeLen==this.options.collection.length?this.model.set("allChecked",!0):this.model.set("allChecked",!1)},_clickFilterAllHandler:function(){var b=this;a._.each(this.options.collection.models,function(a){a.set("Checked",!b.model.get("allChecked"))}),this.model.set("allChecked",!this.model.get("allChecked")),this.model.get("allChecked")?(this.activeLen=b.options.collection.length,this.activeData=a._.map(b.options.collection.models,function(a){return a.get("Id")})):(this.activeLen=0,this.activeData=[]),this.activeLen>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled")},onRender:function(){var b=this.activeLen;b>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled"),a.$(this.ui.dottedTips).tipsy({fallback:"虚线下级",gravity:"s"})},onClose:function(){a.$(document).off("click.Plan-Data-Filter-Dropdown-View"),a.$(".tipsy").remove()},_clickLiHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.find("a[data-name=input-checkbox]"),e=this.activeLen,f=this.activeData,g=this.options.collection,h=parseInt(c.attr("id")),i=g.findWhere({Id:h});d.hasClass("checkbox-checked")?(d.removeClass("checkbox-checked"),e-=1,f=a._.without(f,h),i&&i.set("Checked",!1)):(d.addClass("checkbox-checked"),e+=1,f.push(h),i&&i.set("Checked",!0)),this.activeLen=e,this.activeData=f,e>0?this.ui.buttonSubmit.removeClass("btn-disabled"):this.ui.buttonSubmit.addClass("btn-disabled"),e==this.options.collection.length?this.model.set("allChecked",!0):this.model.set("allChecked",!1)},_submitDataHandler:function(b){var c=(a.$(b.currentTarget),this.activeData),d=this.activeLen;this.trigger("submit",c),0!=d&&this.close()}});return a.ItemView.extend({defaults:{status:!0,member:!0,Class:!0,memberType:!0,sortType:!0,isShowStar:!0,isShowDetail:!0,statusCollection:new a.Collection([{Name:"未开始",Id:0,Checked:!0},{Name:"进行中",Id:1,Checked:!0},{Name:"已完成",Id:2,Checked:!0},{Name:"已延迟",Id:3,Checked:!0},{Name:"已取消",Id:4,Checked:!0},{Name:"暂停中",Id:6,Checked:!0}]),memberCollection:new a.Collection,ClassCollection:new a.Collection},template:b["common/plan/plan-data-filter"],className:"tt_data_filter",ui:{sort:'[data-name="sort"]',detail:'[data-name="detail-mode"]',memberType:'[data-type="memberType"]'},events:function(){var a={};return a["click .status-item"]="_clickItemTypeHandler",a["click "+this.ui.detail]="_setDetailHander",a["click "+this.ui.sort]="_popSortHandler",a},modelEvents:{"change:detail_checked":"_detailCheckChange"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo();var b=this.settings.memberCollection;b.each(function(a){a.set("Checked",!0)});var c=this.settings.statusCollection;c.each(function(a){a.set("Checked",!0)}),this.model.set({SortType:1})},templateHelpers:function(){return this.settings.detail_checked=this.model.get("detail_checked")?this.model.get("detail_checked"):!1,this.settings},onRender:function(){var a=this.$el.find("li:first").attr("data-type");this.model.set("type",a)},onShow:function(){this.sortPopView&&this.sortPopView.close(),this.sortPopView=new f({node:this.ui.sort,container:this.$el,model:this.model,isShowStar:this.settings.isShowStar}),this.sortPopView.render(),this.sortPopView.on("submit",function(){this.trigger("dataFilter",this.model.toJSON())},this)},_detailCheckChange:function(){var a=this.model.get("detail_checked"),b=this.ui.detail;b.removeClass("checkbox-checked"),a&&b.addClass("checkbox-checked")},_popSortHandler:function(b){a.$(b.currentTarget);this._closeAllPop(),b.stopPropagation(),this.sortPopView.show()},_setDetailHander:function(){var a=this.model.get("detail_checked");this.model.set({detail_checked:!a}),this.trigger("show_detail",this.model.toJSON())},_setMarkHander:function(){},_closeAllPop:function(){this.dropDownView&&this.dropDownView.close(),this.classTreeComponentView&&this.classTreeComponentView.close(),this.memberSortView&&this.memberSortView.hide(),this.sortPopView&&this.sortPopView.hide()},_clickItemTypeHandler:function(b){b.stopPropagation(),this._closeAllPop();var c=a.$(b.currentTarget),d=c.attr("data-type");"class"==d?this._renderClassTreeView(c,d):"memberType"==d?this._clickMemberHandler():this._renderDropDownView(c,d)},_clickMemberHandler:function(){var b=this,c=this.model.get("to_user_id"),d=this.userInfo.Id,e=!0;c=c?c:d,e=c==d?!0:!1,this.model.set("isSelfView",e),this.memberTypes?this.memberSortView.show():a.app.request("Customize:getData",{obj_id:c,obj_type:1,customize_type:"1,2"}).done(function(c){var d=null,e=null,f=a._.where;d=f(c,{CustomizaBehaviorType:1}),e=f(d[0].Fields,{FieldValue:!0}),b.memberTypes=e,b._renderMemberTypeView()})},_renderMemberTypeView:function(){this.memberSortView&&this.memberSortView.close(),this.memberSortView=new g({node:this.ui.memberType,container:this.$el,model:this.model,collection:new a.Collection(this.memberTypes)}),this.memberSortView.on("submit",function(){this.trigger("dataFilter",this.model.toJSON())},this),this.memberSortView.render()},_renderClassTreeView:function(a,b){var d=this;this.classTreeComponentView&&this.classTreeComponentView.close(),this.classTreeComponentView=new c({checkedClassCollection:this.settings.ClassCollection,isShowSearch:!0,title:"选择类别",pluginType:1}),this.$el.append(this.classTreeComponentView.render().$el),this.classTreeComponentView.setPositon(a,this.$el),this.listenTo(this.classTreeComponentView,"checkedClass",function(a){d.settings.ClassCollection.reset(a),d.model.set(b,a),d.trigger("dataFilter",d.model.toJSON())}),this.listenTo(this.classTreeComponentView,"emptyClass",function(){d.settings.ClassCollection.reset(),d.model.set(b,""),d.trigger("dataFilter",d.model.toJSON())}),this.listenTo(this.classTreeComponentView,"resetClass",function(){d.model.set(b,"")})},_renderDropDownView:function(b,c){{var d=this.settings[c+"Collection"],e=this.model.get("status")||[];this.model.get("member")||[]}a._.each(e,function(a){var b=d.findWhere({Id:a});b&&b.set("Checked",!0)}),"member"==c&&d.each(function(a){var b=a.toJSON();a.set({Type:b.type,Name:b.name,Id:b.userId})}),this.dropDownView&&this.dropDownView.close(),this.dropDownView=new h({model:this.model,collection:d}),this.listenTo(this.dropDownView,"submit",function(a){this.model.set(c,a),this.trigger("dataFilter",this.model.toJSON())},this),this.$el.append(this.dropDownView.render().el),a.Context.setPosition(b,this.dropDownView.$el,{container:this.$el,pos:"bottomRight",leftBias:0,topBias:4})},onClose:function(){this.dropDownView&&this.dropDownView.close(),this.classTreeComponentView&&this.classTreeComponentView.close(),this.memberSortView&&this.memberSortView.close(),this.sortPopView&&this.sortPopView.close()}})}),define("views/work/mile-tab-view",["talent","templates/work","moment","momentZH","$.tipsy"],function(a,b,c){var d=a.ItemView.extend({template:b["work/mile-tab-item"],className:"item",initialize:function(){},templateHelpers:function(){var b=this.model,c=b.collection,d=(c.length,c.indexOf(b));return a._.extend({index:d},this.options)}});return a.CompositeView.extend({template:b["work/mile-tab"],itemView:d,itemViewContainer:".mile-tab",defaults:{pageSize:6},ui:{tab:'[data-name="tab"]',item:".item",pre:'[data-name="pre"]',next:'[data-name="next"]'},events:function(){var a={};return a["click "+this.ui.tab]="_tab",a["click "+this.ui.pre]="_pre",a["click "+this.ui.next]="_next",a},modelEvents:{"change:activeMile":"render"},initialize:function(b){this.settings=a._.extend({},this.defaults,b),this.totalPage=Math.ceil(this.collection.length/this.settings.pageSize),this._setCurrentPage()},templateHelpers:function(){return{length:this.collection.length,_handleDate:this._handleDate,pageSize:this.settings.pageSize}},itemViewOptions:function(){return{_handleDate:this._handleDate,activeMile:this.model.get("activeMile")}},onRender:function(){a.$(".tipsy").remove(),this.$(".avator icon").attr("original-title",""),this.$("[original-title]").tipsy({gravity:"s"}),this.showPage(this.currentPage),this.resetTabWidth()},onShow:function(){this.resetTabWidth(),this._bindResetTabEvent()},_bindResetTabEvent:function(){var b=a._,c=b.bind,d=b.throttle,e=c(this.resetTabWidth,this),f=d(e,500);a.$(window).on("resize.mile-tab-resize",f)},resetTabWidth:function(){var a=this.$el.width(),b=this.collection.length,c=0,d=0;a=a-80-65,b>0&&(d=6>b?b:6,a-=2*(d-1),c=Math.floor(a/d),this.$(".mile-tab .border").css("width",c+"px"))},_setCurrentPage:function(){var a=this.model.get("activeMile"),b=this.collection.findWhere({mileStoneId:+a.mileStoneId}),c=0;b?(c=this.collection.indexOf(b),this.currentPage=Math.ceil((c+1)/this.settings.pageSize)):this.currentPage=1},_pre:function(){this.showPage(this.currentPage-=1)},_next:function(){this.showPage(this.currentPage+=1)},_tab:function(a){a.stopPropagation();var b=this.$(a.currentTarget),c=b.attr("data-id"),d=this.collection.findWhere({mileStoneId:+c});this.model.get("activeMile").mileStoneId!=c&&(d=d?d.toJSON():{mileStoneId:0},this.model.set({activeMile:d}))},showPage:function(a){var b=this.settings.pageSize;this.currentPage=a,a>1?this.ui.pre.show():this.ui.pre.hide(),a>=this.totalPage?this.ui.next.hide():this.ui.next.show(),this.$(".item").hide().slice((a-1)*b,a*b).show(),a>1?this.$(".project-start").hide():this.$(".project-start").show()},_handleDate:function(a){var b=c(new Date(a)),d=c().format("YYYY"),e=a;return b.format("YYYY")==d&&(e=b.format("MM/DD")),e},onClose:function(){}})}),define("views/work/task-view",["talent","templates/work","moment","momentZH","views/common/empty-view","views/common/loading-view","$.tipsy","views/common/plan/plan-data-filter-view","TitaWidget","views/work/mile-tab-view","tdialog"],function(a,b,c,d,e,f,g,h,i,j){a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"taskId"})}});return a.Layout.extend({template:b["work/task"],defaults:function(){var a=this.i18n,b=a.task_1;return{emptyView:e,emptyContext:"需要分解具体的事吗？试试安排一个"+b,inputUserSelectionOptions:{muti:!0,bias:{left:-150,top:0}},OperationEditable:!0,timePickerOpens:"left",bottomArea:{setFileUpload:!0,setPubBtn:{show:!0,defaultText:"发布"},setPrivateBtn:!0},startDate:"",endDate:"",isLongTerm:!1,Private:1,pageSize:50}},ui:{},className:"ns-work-task",regions:{tabArea:'[data-name="mile-task-tab"]',createNewArea:"[data-name=create]",dataFilterArea:"[data-name=task-data-filter]",taskListArea:"[data-name=task-list]"},events:function(){var a={};return a},modelEvents:{"change:activeMile":"_getListData"},templateHelpers:function(){return{mileTotal:this.collection.length}},initialize:function(b){this.i18n=a.Context.getI18n(),this.settings=a._.extend({},this.defaults(),b),this.filterOptions={};var c=this.collection.findWhere({isDefaultWorkMileStone:!0}),d=null;d=c?c.toJSON():{mileStoneId:0},this.model.set({activeMile:d})},onRender:function(){this._getListData()},onShow:function(){this.collection.length>0&&this._renderTabView()},_renderTabView:function(){this.tabView=new j({model:this.model,collection:this.collection}),this.tabArea.show(this.tabView)},_renderCreateView:function(){var b=this,d={privateValue:this.model.get("IsVisible"),sort:[2,3,1],publicOptions:!1,privateOptions:!1,departmentOptions:!1};1==this.model.get("IsVisible")?d.publicOptions={name:"公开",des:"所有人可见"}:d.privateOptions={name:"私密",des:"仅@的人可见"},this.createTaskView=new i.TaskCreateView({classOptions:!1,id:"work_"+this.model.get("WorkId"),shape:"line",privateRangeOptions:d,bottomOptions:{isShowPrivateDropDown:!1},requestSubmit:function(c){c.objId=b.model.get("WorkId"),c.objType=b.model.get("ObjType"),c.AppId=b.model.get("AppId"),c.AppType=b.model.get("AppType"),c.TaskType=b.model.get("taskType"),c.WorkMileStoneId=b.model.get("activeMile").mileStoneId,203==b.model.get("AppId")&&(c.AppObjType=20301,c.TaskType=23);var d=new Talent.$.Deferred;return a.app.request("Task:createTask",c).done(function(a){if(a){var c=b.taskListView.collection.toJSON();return c.unshift(a),b.taskListView.collection.reset(c),d.resolve(a)}}).fail(function(a){d.reject(a)}),d}}),this.listenTo(this.createTaskView,"selectDate",function(a,b){var d=c(new Date(b.startDate)),e=c(new Date(b.endDate)),f=this.model.get("activeMile"),g=c(new Date(this.model.get("StartDate"))),h=c(new Date(this.model.get("EndDate"))),j="所选时段超出了项目起止时间";0!=f.mileStoneId&&(g=c(new Date(f.startDate)),h=c(new Date(f.endDate)),j="所选时段超出了里程碑起止时间"),(d.isBefore(g)||e.isAfter(h))&&i.TipDialogView(a,j,{pos:"topRight"})}),this.createNewArea.show(this.createTaskView)},_getListData:function(b,c,d){var e=this,f=this.model.get("WorkId"),g=this.model.get("activeMile").mileStoneId,b=Number(this.taskListNextNum);b=b&&"number"==typeof b?b:1,this._renderCreateView(),a.app.request("ProjectDetail:getTask",{work_id:f,mile_stone_id:g,startNum:b,count:e.settings.pageSize}).done(function(b){var f=b.tasks||[],g=a.Collection.extend({model:a.Model.extend({idAttribute:"userId"})}),h=a._.pluck(f,"principalUser")||[],i=e.taskListView;e.taskListNextNum=b.nextNum,h=new g(h).toJSON(),c===!0?(f=d(f),i.collection.add(f),f.length<50&&i.hideMoreBtn(),i.loadingCompelte()):e._renderTaskList(f),f.length>0?(e.principals_data=e.principals_data||[],$.merge(e.principals_data,h),principalAll=new g(e.principals_data).toJSON(),e._renderTaskDataFilter(principalAll)):e.planDataFilterView&&e.planDataFilterView.close()})},_renderTaskDataFilter:function(b){this.planDataFilterView&&this.planDataFilterView.close(),this.planDataFilterView=new h({member:!0,memberType:!1,isShowStar:!0,Class:!1,isShowDetail:!1,memberCollection:new a.Collection(b),model:this.model}),this.listenTo(this.planDataFilterView,"dataFilter",function(a){this.filterOptions=a,this._requestSearchData()}),this.dataFilterArea&&this.dataFilterArea.show(this.planDataFilterView)},_renderTaskList:function(a){var b="暂无"+this.i18n.task_1,c=e.extend({defaults:{emptyContext:b}});this.taskListView=new i.TaskListView({data:a,isShowKclass:!1,isShowOwnerTag:!1,isShowPercent:!0,emptyView:c,isShowMoreBtn:this.taskListNextNum?!0:!1,isShowTaskTotal:!1}),this.listenTo(this.taskListView,"showMore",function(a,b,c){this._getListData(b,!0,c)}),this.listenTo(this.taskListView,"openSub",function(a,b){this._getSubPlans(b,1)}),this.taskListArea&&this.taskListArea.show(this.taskListView)},_requestSearchData:function(){{var b=this,c=this.filterOptions.member||[],d=this.filterOptions.status||[],e=this.filterOptions["class"]||[],f=[],g=this.filterOptions.SortType;this.filterOptions.RelationType}_.each(e,function(a){1==a.type?f.push({LableType:17,LableId:a.id}):2==a.type&&f.push({LableType:4,LableId:a.id})}),a.app.request("ProjectDetail:searchTask",{userIds:c.join(","),status:d.join(","),SortType:g,work_id:this.model.get("WorkId"),mile_stone_id:this.model.get("activeMile").mileStoneId}).done(function(a){var c=a&&a.tasks?a.tasks:[];b._renderTaskList(c)})},_getSubPlans:function(b){var c=this.model.get("type"),d=this.filterOptions.member||[],e=this.filterOptions.status||[],f=this.filterOptions["class"]||[],g=[],h=this.filterOptions.SortType,i=this.filterOptions.RelationType;_.each(f,function(a){1==a.type?g.push({LableType:17,LableId:a.id}):2==a.type&&g.push({LableType:4,LableId:a.id})});var j=this.model.get("WorkId"),k=this.model.get("activeMile").mileStoneId;a.app.request("WorkTable:GetSubPlans",{parentTaskId:b.id,diff:c,userIds:d.join(","),status:e.join(","),date:this.model.get("date"),LableModels:g,SortType:h,RelationType:i,work_id:j,mile_stone_id:k}).done(function(a){b.set({tasks:a,currentDeploy:!0})})},onClose:function(){this.tipDialog&&this.tipDialog.close(),this.createTaskView&&this.createTaskView.close(),a.$(".tipsy").remove()}})}),define("views/work/member-composite-view",["talent","templates/work","tdialog","$.tipsy"],function(a,b,c){var d=a.ItemView.extend({className:"project_member_item_info_container",tagName:"li",template:b["work/member-item"],initialize:function(a){this.templateHelpers=a.templateHelpers;var b=this.model.get("Name");nameSubstring=b.length>6?b.substring(0,5,!0)+"...":b,this.model.set("shortName",nameSubstring)},onRender:function(){this.$el.attr("member_user_id",this.model.get("UserId")),this.$el.find("[original-title]").tipsy({gravity:"s"})}});return a.CompositeView.extend({itemView:d,itemViewContainer:"#project_member_list",template:b["work/member-composite"],ui:{add:".member_add_big",deliver:".remove_response",projectMemberContainer:".project_member_container"},events:{"click .remove_member":"deleteMember"},modelEvents:{"change:MembersCount":"onMembersCountChange"},itemViewOptions:function(){return{templateHelpers:{Status:this.model.get("Status"),IsPrincipal:this.model.get("IsPrincipal"),IsParticipate:this.model.get("IsParticipate"),IsCreator:this.model.get("IsCreator"),IsFollow:this.model.get("IsFollow"),Context:"需要其他成员进来分工协作吗？赶快去添加吧",LoginUser:a.Context.getUserInfo().Id,Type:"member",ApplyState:this.model.get("ApplyState"),IsApplyUser:this.model.get("IsApplyUser")}}},initialize:function(a){var a=a||{};this.selectView=a.selectView},onShow:function(){var a=this;this.selectView.addNode(this.ui.add,{muti:!0,container:this.ui.projectMemberContainer}),this.selectView.addNode(this.ui.deliver,{container:this.ui.projectMemberContainer}),this.ui.add.on("submit",function(b,c){var d;d=c.data?c.data:[c],a.addMemberRequest(d)}),this.ui.deliver.on("submit",function(b,c){var c=c||{};c.SAvatar=c.Avatar,c.Avatar={Medium:c.MidAvatar,Small:c.SAvatar},c.UserId=c.Id,a.deliverMemberSelect(c)})},onMembersCountChange:function(){this.$el.find(".project_member_count span").empty().html(this.model.get("MembersCount"))},smemberSelect:function(a){a=a||{};var b=this.collection.where({UserId:a.UserId});b.length>0?this.showDialogArrow(this.ui.add,"该联系人已存在","warn"):this.operateRequest("AddMember",a)},deliverMemberSelect:function(a){function b(){c.operateRequest("Deliver",a)}var c=this;this.showConfirm(this.$el.find(".project_member_container_responsible .project_member_item_info"),"您确定把负责人的权限转交吗？",b)},showConfirm:function(a,b,d){var e=this;this.delDialog=new c({fixed:!1,type:"tipsy",cancel:function(){e.delDialog.close()},sure:function(){e.delDialog.close(),d()}}),this.delDialog.render().$el.appendTo("body"),this.delDialog.show(a,b,{pos:"bottom",className:"ask",arrow:!1})},showDialogArrow:function(b,d,e){var f=this;f.tDialogViewError||(f.tDialogViewError=new c({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),f.tDialogViewError.render().$el.appendTo("body")),f.tDialogViewError.show(a.$(b),d,{arrow:1,pos:"bottomCenter",height:300,topBias:8,leftBias:0,arrowBias:10,className:e,autoHide:!0})},deleteMember:function(b){function c(){f.operateRequest("DelMember",{UserId:e})}var d=a.$(b.target),e=d.parents("li").attr("member_user_id"),f=this;this.showConfirm(a.$(b.target),"您确定删除此成员吗？",c)},addMemberRequest:function(b){var c=this,d=[];a._.each(b,function(a){d.push("department"==a.type?{Id:a.id,Name:a.name,Email:a.name+":"+a.id+":dep_members"}:{Id:a.Id,Name:a.Name,Email:a.Email})});var e={work_id:this.model.get("WorkId"),relation:2,data:d},f=a.app.request("Project:addMember",e);f.done(function(a){c.onAfterAddMember(a,a.Data)}).fail(function(a){c.showDialogArrow(c.ui.add,a,"warn")})},operateRequest:function(b,c){var d=this,e=this.model.get("WorkId"),c=c||{},f=(c.UserId,{handler:b,data:{work_id:e,to_user_ids:c.UserId}});"Deliver"==b&&(f.data.email=c.Email);var g=a.app.request("Project:updateData",f);g.done(function(a){d["onAfter"+b]&&d["onAfter"+b](a,c)}).fail(function(){})},onAfterDelMember:function(a,b){var c=this.collection.where({UserId:parseInt(b.UserId)})[0];this.collection.remove(c),this.model.set({MembersCount:this.model.get("MembersCount")-1,MembersTotal:this.model.get("MembersTotal")-1})},onAfterAddMember:function(a){this.collection.add(a),this.model.set({MembersCount:this.model.get("MembersCount")+a.length}),this.trigger("addMember",a)},onAfterDeliver:function(){a.app.vent.trigger("detail:_tita_work:operate")},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render(),this.$el.find(this.itemViewContainer).find("li:first-child").length?this.$el.find(this.itemViewContainer).find("li:first-child").before(e.el):this.$el.find(this.itemViewContainer).append(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)},onClose:function(){this.delDialog&&this.delDialog.close(),this.tDialogViewError&&this.tDialogViewError.close()}})}),define("views/work/follower-composite-view",["talent","templates/work","tdialog","$.tipsy"],function(a,b,c){var d=a.ItemView.extend({className:"project_member_item_info_container",tagName:"li",template:b["work/member-item"],initialize:function(b){this.templateHelpers=b.templateHelpers;var c=this.model.get("Name");this.model.set("shortName",a._.substring(c,10,!0))},onRender:function(){this.$el.attr("member_user_id",this.model.get("UserId")),this.$el.find("[original-title]").tipsy({gravity:"s"})}});return a.CompositeView.extend({itemView:d,itemViewContainer:"#project_follow_list",template:b["work/follower-composite"],events:{"click .remove_member":"deleteMember"},ui:{add:".member_add_big",projectFollowerAdd:".project_follower_add",projectMemberContainer:".project_member_container"},modelEvents:{"change:followersCount":"onFollowersCountChange"},itemViewOptions:function(){return{templateHelpers:{Status:this.model.get("Status"),IsPrincipal:this.model.get("IsPrincipal"),IsParticipate:this.model.get("IsParticipate"),IsCreator:this.model.get("IsCreator"),IsFollow:this.model.get("IsFollow"),Context:"需要其他成员进来分工协作吗？赶快去添加吧",LoginUser:a.Context.getUserInfo().Id,Type:"follower",ApplyState:this.model.get("ApplyState"),IsApplyUser:this.model.get("IsApplyUser")}}
},initialize:function(a){var a=a||{};this.selectView=a.selectView,this.templateHelpers={count:this.collection.models.length}},onShow:function(){var a=this;this.selectView.addNode(this.ui.add,{muti:!0,container:this.ui.projectMemberContainer}),this.ui.add.on("submit",function(b,c){var d;d=c.data?c.data:[c],a.addFollowRequest(d)})},onFollowersCountChange:function(){this.$el.find(".project_member_count span").empty().html(this.model.get("followersCount"))},showConfirm:function(a,b,d){var e=this;this.delDialog=new c({fixed:!1,type:"tipsy",cancel:function(){e.delDialog.close()},sure:function(){e.delDialog.close(),d()}}),this.delDialog.render().$el.appendTo("body"),this.delDialog.show(a,b,{pos:"bottom",className:"ask",arrow:!1})},deleteMember:function(b){function c(){f.operateRequest("CancelFollow",{UserId:e})}var d=a.$(b.target),e=d.parents("li").attr("member_user_id"),f=this;this.showConfirm(d,"您确定删除此关注者吗？",c)},smemberSelect:function(b){var c=this.model.get("WorkId"),d=this,e={url:"share",data:{visibility:1,content:"快来关注这个项目吧！@["+b.Name+":"+b.Email+"]",ObjId:c,ObjType:4,AppId:0,AppType:0,FileUrls:null},type:"POST"};request=a.app.request("ProjectDetail:shareData",e),request.done(function(){d.showDialogArrow(d.ui.add,"邀请发送成功！","success");var c=a.Context.getWebUrl("/SiteUrlByRoute/"+b.Id+"/SiteUrlByRoute/UserProfileRoute"),e=[];e.push('<li class="project_follower_item_info_container" member_user_id='+b.UserId+">"),e.push("<a href="+c+">"+a._.convertImage({className:"project_follower_item_img",src:b.Avatar.Medium,size:30,name:b.Name,bgColor:b.Avatar.Color})+"</a>"),e.push('<div class="project_member_item_info">'),e.push('<div class="project_member_item_info_name_pad5">'+a._.substring(b.Name,5,!0)+"</div>"),e.push('<div class="project_member_item_info_invite">邀请中</div>'),e.push("</div>"),e.push("</li>");var f=e.join("");d.ui.projectFollowerAdd.next("ul.project_member_container_list").prepend(f)})},showDialogArrow:function(b,d,e){var f=this;f.tDialogViewError||(f.tDialogViewError=new c({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),f.tDialogViewError.render().$el.appendTo("body")),f.tDialogViewError.show(a.$(b),d,{arrow:1,pos:"bottomCenter",className:e,autoHide:!0})},addFollowRequest:function(b){var c=this,d=[];a._.each(b,function(a){d.push("department"==a.type?{Id:a.id,Name:a.name,Email:a.name+":"+a.id+":dep_members"}:{Id:a.Id,Name:a.Name,Email:a.Email})});var e={work_id:this.model.get("WorkId"),relation:3,data:d},f=a.app.request("Project:addMember",e);f.done(function(a){c.onAfterFollow(a,a.Data)}).fail(function(a){c._tipDialog(c.ui.add,a,{autoHide:!1})})},_tipDialog:function(a,b,d,e){this.tipDialog&&this.tipDialog.close(),this.tipDialog=new c({type:"tipsy",sure:!1,quirkTheme:!0,cancel:!0,cancelText:"关闭"}),$("body").append(this.tipDialog.render().$el);var f=!1,g=0,h="bottom";e&&e.topBias&&(g=e.topBias),e&&e.pos&&(h=e.pos),this.tipDialog.show(a,b,{pos:h,className:"success",arrow:!1,autoHide:f,topBias:g})},operateRequest:function(b,c){var d,e,f=this,g=this.model.get("WorkId");d={handler:b,data:{work_id:g,to_user_ids:c.UserId}},e=a.app.request("Project:updateData",d),e.done(function(a){f["onAfter"+b]&&f["onAfter"+b](a,c)}).fail(function(){})},onAfterFollow:function(a){this.collection.add(a),this.model.set({followersCount:this.model.get("followersCount")+a.length,MembersTotal:this.model.get("MembersTotal")+a.length})},onAfterCancelFollow:function(a,b){var c=this.collection.where({UserId:parseInt(b.UserId)})[0];this.collection.remove(c),this.model.set({followersCount:this.model.get("followersCount")-1,MembersTotal:this.model.get("MembersTotal")-1})},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a),d=Marionette.getOption(this,"itemViewOptions");_.isFunction(d)&&(d=d.call(this,a,c));var e=this.buildItemView(a,b,d);this.addChildViewEventForwarding(e),this.children.add(e),e.render(),this.$el.find(this.itemViewContainer).find("li:first-child").length?this.$el.find(this.itemViewContainer).find("li:first-child").before(e.el):this.$el.find(this.itemViewContainer).append(e.el),this._isShown&&Marionette.triggerMethod.call(e,"show"),this.triggerMethod("after:item:added",e)},onClose:function(){this.tDialogViewError&&this.tDialogViewError.remove(),this.tipDialog&&this.tipDialog.close()}})}),define("views/work/member-layout",["talent","templates/work","views/work/member-composite-view","views/work/follower-composite-view","UserSelector","collections/smember-group-collection"],function(a,b,c,d,e,f){return a.Layout.extend({template:b["work/member-layout"],initialize:function(){var a=this.model.get("Members").length,b=this.model.get("Followers").length;this.model.set({MembersCount:a+1,followersCount:b})},regions:{main:".member_container",follower:".follower_container"},onShow:function(){this.userSelector=new e({collection:new f}),this.renderFollowerCompositeView(),this.renderMemberCompositeView()},renderMemberCompositeView:function(){var b=new c({model:this.model,collection:new a.Collection(this.model.get("Members")),selectView:this.userSelector});this.main.show(b),this.listenTo(b,"addMember",function(b){var c=new a.Collection(b),d=c.pluck("UserId"),e=this.followerCompositeView&&this.followerCompositeView.collection.toJSON(),f=a._.filter(e,function(b){var c=a._.indexOf(d,b.UserId);return 0>c?b:void 0});this.model.set({MembersTotal:this.model.get("MembersTotal")+b.length-f.length}),this.followerCompositeView&&this.followerCompositeView.collection.reset(f)})},renderFollowerCompositeView:function(){var b=this;b.followerCompositeView=new d({model:this.model,collection:new a.Collection(this.model.get("Followers")),selectView:this.userSelector}),this.follower.show(this.followerCompositeView)}})}),define("views/common/plugins/class/department-view",["talent","templates/common","views/common/empty-view","tdialog"],function(a,b,c){var d=a.CompositeView.extend({template:b["common/plugins/class/department-item"],tagName:"li",initialize:function(){this.collection=this.model.children},appendHtml:function(a,b){a.$el.find("ul:first").append(b.el)},onRender:function(){this.$el.attr({id:this.model.get("Id"),parent_id:this.model.get("PId"),"data-end":this.model.get("isEnd")})}}),e=a.CollectionView.extend({itemView:d,tagName:"ul",events:function(){var a={};return a["click ul"]="_ulHandler",a["click li"]="_checkHandler",a["click li span[data-name=toggle]"]="_toggleHandler",a},initialize:function(b){this.options=b,this.settings=a._.extend({},this.defaults,this.options),this.activeFolder=this.$el.find("li:first")},onShow:function(){var a=(this.settings.isEdit,this.$el.find("li:first"));a.addClass("unfold"),a.find("ul:first").find("li:first").addClass("active")},_ulHandler:function(a){a.stopPropagation()},_toggleHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget).closest("li"),d=c.attr("data-end");"false"==d&&(c.hasClass("unfold")?c.removeClass("unfold"):c.addClass("unfold"))},_checkHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.closest("li"),e=(d.attr("data-end"),c.find("div[data-name=title-name]")),f=parseInt(d.attr("id"));this.activeFolder=d,this.$el.find("li").removeClass("active"),d.addClass("active"),this.trigger("checked",this.activeFolder,{id:f,name:a.$.trim(e.html()),parent_id:parseInt(d.attr("parent_id"))})}});return a.Layout.extend({defaults:{showTitle:!1,showButtonSure:!1,showButtonReset:!1},template:b["common/plugins/class/department"],className:"tt_class_tree",ui:{closed:"span[data-name=work-klass-close]",submit:"button[data-name=work-klass-submit]",title:"div[data-name=title]",actionArea:"div[data-name=klass-action]",emptyArea:"div[data-name=work-klass-box]",buttonReset:"button[data-name=work-klass-reset]"},regions:{tree:"div[data-name=work-box]",emptyArea:"div[data-name=work-klass-empty]"},collectionEvents:{reset:"_collectionReset"},_collectionReset:function(){var a=this.collection.toJSON(),b=a[0].children||[];this.model.set(b.length?{id:b[0].Id,name:b[0].Name}:{id:0,name:""})},events:function(){var a={};return a["click "+this.ui.closed]="_closeHandler",a["click "+this.ui.submit]="_submitHandler",a["click "+this.ui.buttonReset]="_resetHandler",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.addAjax=!1,this.model.set({id:0,name:"",parent_id:0})},onRender:function(){this._customView(),this._renderTreeView(),this._renderEmptyView()},setPosition:function(b,c){var d=b.offset(),e=b.outerWidth(),f=b.outerHeight(),g=this.$el,h=g.outerWidth(),i={pos:"left"},c=a._.extend({},i,c);this.$el.css("right"==c.pos?{top:d.top+f+5,left:d.left-h+e}:{top:d.top+f+5,left:d.left})},_renderEmptyView:function(){var a=(this.settings.isEdit,"您还未加入任何部门");this.ui.emptyArea.hide();var b=this.collection.toJSON();if(b.length&&b[0]&&b[0].children)return void this.ui.emptyArea.hide();var d=new c({emptyContext:a});this.emptyArea.show(d),this.ui.emptyArea.show()},_customView:function(){this.settings.showTitle||this.ui.title.remove(),this.settings.showButtonSure||this.ui.submit.remove(),this.settings.showButtonSure||this.settings.showButtonAdd||this.ui.actionArea.remove(),this.settings.showButtonReset||this.ui.buttonReset.remove()},_submitHandler:function(b){var c=a.$(b.currentTarget);this.trigger("submit",{id:this.model.get("id"),name:this.model.get("name"),parent_id:this.model.get("parent_id")},c),this.close()},_resetHandler:function(b){a.$(b.currentTarget);this.trigger("reset")},_closeHandler:function(b){a.$(b.currentTarget);this.trigger("closed"),this.close()},_renderTreeView:function(){var a=Backbone.Model.extend({initialize:function(){var a=this.get("children");a&&(this.children=new b(a),this.unset("children"))}}),b=Backbone.Collection.extend({model:a});this.treeView=new e({collection:new b(this.collection.toJSON())}),this.activeFolder=this.treeView.$el,this.listenTo(this.treeView,"checked",function(a,b){this.activeFolder=a,this.model.set({id:b.id,name:b.name,parent_id:b.parent_id}),this.trigger("checked",{id:b.id,name:b.name,parent_id:b.parent_id})},this),this.tree.show(this.treeView)}})}),define("views/work/create/project-create-item-view",["talent","templates/work","UserSelector","collections/smember-group-collection","$.tipsy","moment","momentZH","views/common/plugins/class/class-view","views/common/plugins/class/department-view","tdialog","TitaWidget"],function(a,b,c,d,e,f,g,h,i,j,k){return a.ItemView.extend({template:b["work/create/project-create"],memberItemTemplate:b["work/create/project-create-member-item"],className:"project_create",ui:{projectName:"input[data-type=name]",projectResponsible:"input[data-type=responsible]",projectDescription:"[data-type=description]",projectRange:".project_range",addBtn:'a[data-name="add-project-member"]',addApplyUser:'a[data-name="add-apply-user"]',input:".project_input",timeInput:"input[data-type=time]",inputLabel:"input[data-type=label]",inputDepartment:"input[data-type=department]",title:"span[data-name=title]",buttonSubmit:"a[data-name=submit]",projectDateLabel:'label[data-name="project-default-date"]',addFollower:'a[data-name="add-project-follower"]'},defaults:{nameLen:100,create:!0,isShowInvested:!1,new_projectName_key:"new_projectName_key",new_projectDescription_key:"new_projectDescription_key"},events:function(){var a={};return a["click "+this.ui.projectName]="onNameClick",a["focusin "+this.ui.input]="onFocusIn",a["focusout "+this.ui.input]="onFocusout",a["keydown "+this.ui.input]="onKeyDown",a["keyup "+this.ui.input]="onKeyUp",a["click "+this.ui.input]="onClick",a['click a[data-name="project-delete-member"]']="delMember",a['click a[data-name="delete-apply-user"]']="_delApplyUser",a['click a[data-name="project-delete-follower"]']="_delFollower",a["click .project_create_more_btn"]="showMoreView",a["click .place_holder"]="onPlaceHolderClick",a["click "+this.ui.buttonSubmit]="submitNewProject",a["click .radio_blue"]="onRadioSelect",a["click "+this.ui.projectDateLabel]="_triggerDate",a["click "+this.ui.timeInput]="_renderDatepicker",a},modelEvents:{"change:Principal":"_onResponsibleChange","change:Participators":"_onPaticipatorChange","change:LableName":"_onLabelNameChange","change:DepartmentName":"_onDepartmentNameChange","change:ApplyUser":"_onApplyUserChange","change:followers":"_onFollowersChange"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.userInfo=a.Context.getUserInfo(),this.tenant_function=a.Context.getGlobal("tenant_function");var b=this;if(this.settings.create&&(this.model.set({WorkName:"",LableId:"",LableName:"",Principal:this.userInfo,Participators:[],StartDate:f().format("YYYY/MM/DD"),Description:"",IsVisible:2,EndDate:f().add("days",29).format("YYYY/MM/DD"),DepartmentId:"",DepartmentName:"",WorkType:1,ApplyUser:"",followers:[]}),this.settings.isShowInvested&&this.model.set("IsInvested","")),this.settings.data){this.model.set(this.settings.data);var c=this.model.get("Participators");c&&a._.map(c,function(a){a.Id=a.UserId}),this.model.set("Participators",c)}a.$(document).off("click.task_project_datepicker"),a.$(document).on("click.task_project_datepicker",function(){a.$(".datepicker").hide(),b.classView&&b.classView.close()}),this.checkResponsible=!1,this.userInfo=a.Context.getUserInfo(),this.userInfo.UserId=this.userInfo.Id,this.userInfo.Avatar=this.userInfo.UserAvatar,this.i18n=a.Context.getI18n()},_onChange:function(){var b=a.Context.getLocalStorage();b.setItem(this.settings.new_projectName_key,this.ui.projectName.val())},_onDescriptionChange:function(){var b=a.Context.getLocalStorage();b.setItem(this.settings.new_projectDescription_key,this.ui.projectDescription.val())},templateHelpers:function(){return{i18n:this.i18n,isShowInvested:this.settings.isShowInvested,IsUseWork:this.tenant_function.IsUseWork,create:this.settings.create}},onShow:function(){var b=this;this._customView(),this.ui.projectName.focus(),this.userSelectorView=new c({collection:new d}),this.userSelectorView.addNode(this.ui.addApplyUser,{viewType:"single",input:!0,muti:!1,container:this.$el}),this.userSelectorView.addNode(this.ui.addBtn,{viewType:"single",input:!0,muti:!0,container:this.$el}),this.userSelectorView.addInput(this.ui.projectResponsible,{viewType:"single",input:!0,muti:!1,container:this.$el}),this.userSelectorView.addInput(this.ui.addFollower,{viewType:"single",input:!0,muti:!0,container:this.$el}),this.ui.addBtn.on("submit",function(a,c){b.addMember(c)}),this.ui.addApplyUser.on("submit",function(a,c){b._addApplyUser(c)}),this.ui.addFollower.on("submit",function(a,c){b._addFollower(c)}),this.ui.projectResponsible.on("submit",function(a,c){b.checkResponsible=!0;var c=c||{},d=c.Name||"";c.Name=Talent._.substring(d,6,!0),b.changeResponsible(c)}),this.$el.find("[original-title]").tipsy({gravity:"s"}),this.classCollection=new a.Collection,this.departmentCollection=new a.Collection,this._requestClassData(),this._requestDepartment()},_triggerDate:function(b){var c=a.$(b.currentTarget);c.hide();var d=this.model.get("StartDate"),e=this.model.get("EndDate");this.ui.timeInput.val(e?d+" - "+e:d+" - 长期"),this.ui.timeInput.trigger("click")},_customView:function(){this.model.get("create")||(this.ui.buttonSubmit.html("确定"),this.ui.title.html("编辑"+this.i18n.work_1))},renderMemberView:function(){var b=this,c=this.model.get("Participators");this.$el.find("[original-title]").tipsy("hide");var d="";a._.each(c,function(a){a.dataName="project-delete-member",d+=b.memberItemTemplate(a)}),this.$el.find('ul[data-name="project-member-list"]').empty().append(d),this.$el.find("[original-title]").tipsy({gravity:"s"})},renderFollowerView:function(){var b=this,c=this.model.get("followers");this.$el.find("[original-title]").tipsy("hide");var d="";a._.each(c,function(a){a.dataName="project-delete-follower",d+=b.memberItemTemplate(a)}),this.$el.find('ul[data-name="project-follower-list"]').empty().append(d),this.$el.find("[original-title]").tipsy({gravity:"s"})},changeResponsible:function(b){var c=this,d=this.model.get("ApplyUser"),e=this.model.get("followers");return d.UserId==b.Id?void this._tipMessage(this.$el.find("a.responsible_avatar"),"不可以添加审批人为负责人"):(a._.each(e,function(d){d.UserId==b.Id&&(c._tipMessage(c.$el.find("a.responsible_avatar"),"不可以添加关注者为负责人"),Followers=a._.filter(e,function(a){return a.UserId!=d.UserId}),c.model.set("followers",Followers))}),this.model.set({Principal:b}),this.$el.find(".responsible_avatar").html(a._.convertImage({src:b.UserAvatar.Small,size:30,shape:"radius",name:b.Name,bgColor:b.UserAvatar.Color})),this.$el.find(".project_responsible_input").val("").focusout(),void this.$el.find(".project_responsible label").empty().html(b.Name).show())},addMember:function(b){var c=this,d=this.model.get("Participators")||[],e=[],f=[];if(b.data)a._.each(b.data,function(b){var e=a._.where(d,{Id:b.Id});e.length?c._tipMessage(c.$el.find('a[data-name="add-project-member"]'),"该成员已存在","warn"):(b.UserId=b.Id,b.Avatar=b.UserAvatar,f.push(b))}),e=f.length?d.concat(f):d;else{var g=a._.where(d,{Id:b.Id});g.length?c._tipMessage(c.$el.find('a[data-name="add-project-member"]'),"该成员已存在","warn"):(b.UserId=b.Id,b.Avatar=b.UserAvatar,f.push(b)),e=f.length?d.concat(f):d}var h=this.model.get("ApplyUser"),i=this.model.get("Principal"),j=this.model.get("followers");if(h||i){var k=[];a._.each(e,function(b){i&&b.UserId==i.Id?c._tipMessage(c.$el.find('a[data-name="add-project-member"]'),"负责人不可添加为其他成员","warn"):(k.push(b),j&&a._.each(j,function(a,c){a.UserId==b.UserId&&j.splice(c,1)}))})}this.model.unset("followers"),this.model.set("followers",j),this.model.set("Participators",k)},_addApplyUser:function(a){var b=this.model.get("Principal");return b.Id==a.Id?void this._tipMessage(this.$el.find('a[data-name="add-apply-user"]'),"不可以添加负责人为审批人"):(a.UserId=a.Id,a.Avatar=a.UserAvatar,void this.model.set("ApplyUser",a))},_addFollower:function(b){var c=this,d=this.model.get("followers")||[],e=[],f=[],g=[];if(b.data)a._.each(b.data,function(b){var e=a._.where(d,{Id:b.Id});e.length?c._tipMessage(c.$el.find('a[data-name="add-project-member"]'),"该成员已存在","warn"):(b.UserId=b.Id,b.Avatar=b.UserAvatar,f.push(b))}),e=f.length?d.concat(f):d;else{var h=a._.where(d,{Id:b.Id});h.length?c._tipMessage(c.$el.find('a[data-name="add-project-member"]'),"该成员已存在","warn"):(b.UserId=b.Id,b.Avatar=b.UserAvatar,f.push(b)),e=f.length?d.concat(f):d}var i=this.model.get("Principal"),j=this.model.get("Participators");if(i||j.length){var k=[];a._.each(e,function(a){if(i&&a.UserId==i.Id)c._tipMessage(c.$el.find('a[data-name="add-project-follower"]'),"负责人不可添加为关注者","warn");else if(j.length){var b=c._findUserInParticipators(j,a.UserId);b.length?g.push(b.join("")):k.push(a)}else k.push(a)}),g.length&&this._tipMessage(this.$el.find('a[data-name="add-project-follower"]'),"项目成员不可添加为关注者","warn")}this.model.set("followers",k)},_findUserInParticipators:function(b,c){var d=[];return a._.each(b,function(a){a.UserId==c&&d.push(a.Name)}),d},_tipMessage:function(a,b,c){this.warnDialog||(this.warnDialog=new j({type:"tipsy"}),$("body").append(this.warnDialog.render().$el)),this.warnDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:c||"warn"})},delMember:function(b){var c=a.$(b.currentTarget),d=parseInt(a.$(b.target).parents("li").attr("data-id")),e=this.model.get("Participators"),f=this.model.get("Principal");return f&&f.Id!=this.userInfo.Id&&this.userInfo.Id==d?void this._tipMessage(c,"不能删除自己","warn"):(e=a._.filter(e,function(a){return a.type?a.id!=d:a.UserId!=d}),void this.model.set("Participators",e))},_delApplyUser:function(a){var b=Talent.$(a.currentTarget);b.tipsy("hide"),this.model.set("ApplyUser","")},_delFollower:function(b){var c=Talent.$(b.currentTarget);c.tipsy("hide");var d=parseInt(a.$(b.target).parents("li").attr("data-id")),e=this.model.get("followers");Followers=a._.filter(e,function(a){return a.UserId!=d}),this.model.set("followers",Followers)},_onResponsibleChange:function(){var b=this.model.get("Principal"),c=this.userInfo,d=this.model.get("Participators")||[],e=a._.pluck(d,"Id");if(c.Id!=b.Id)-1==a._.indexOf(e,c.Id)&&(d=[c].concat(d));else if(c.Id==b.Id){var f=a._.indexOf(e,c.Id);-1!=f&&(d=d.slice(0,f).concat(d.slice(f+1,d.length)))}this.model.set("Participators",d)},_onPaticipatorChange:function(){a.$(".tipsy").remove();var b=this.model.get("Participators")||[];b.length>=15?(b.length>15?this.$el.find('ul[data-name="project-member-list"]').css({"padding-left":"5px"}):this.$el.find('ul[data-name="project-member-list"]').removeAttr("style"),this.$el.find('a[data-name="add-project-member"]').css({"margin-left":"5px","margin-bottom":"5px"})):(this.$el.find('ul[data-name="project-member-list"]').removeAttr("style"),this.$el.find('a[data-name="add-project-member"]').removeAttr("style")),this.renderMemberView()},_onFollowersChange:function(){a.$(".tipsy").remove();var b=this.model.get("followers")||[];b.length>=15?(b.length>15?this.$el.find('ul[data-name="project-follower-list"]').css({"padding-left":"5px"}):this.$el.find('ul[data-name="project-follower-list"]').removeAttr("style"),this.$el.find('a[data-name="add-project-follower"]').css({"margin-left":"5px","margin-bottom":"5px"})):(this.$el.find('ul[data-name="project-follower-list"]').removeAttr("style"),this.$el.find('a[data-name="add-project-follower"]').removeAttr("style")),this.renderFollowerView()},_onApplyUserChange:function(){var a=this.model.get("ApplyUser");if(a){this.$el.find("[original-title]").tipsy("hide"),a.dataName="delete-apply-user";var b=this.memberItemTemplate(a);this.$el.find('ul[data-name="project-apply-user"]').empty().append(b),this.$el.find('a[data-name="add-apply-user"]').hide(),this.$el.find('label[data-name="apply-user-default"]').hide()}else this.$el.find("[original-title]").tipsy("hide"),this.$el.find('ul[data-name="project-apply-user"]').empty(),this.$el.find('a[data-name="add-apply-user"]').show(),this.$el.find('label[data-name="apply-user-default"]').show(),this.$el.find(".project_responsible label").addClass("place_holder").removeClass("replace_place_holder"),this.ui.projectResponsible.removeAttr("style");this.$el.find("[original-title]").tipsy({gravity:"s"})},_onLabelNameChange:function(){var a=this.model.get("LableName");this.ui.inputLabel.val(a)},_onDepartmentNameChange:function(){var a=this.model.get("DepartmentName");this.ui.inputDepartment.val(a)},onPlaceHolderClick:function(b){b.stopPropagation();var c=a.$(b.currentTarget);"responsible"==c.siblings("input").attr("data-type")&&(this.checkResponsible=!1),c.hide(),c.parents(".project_input_container").find(".project_input").focus()},onClick:function(a){a.stopPropagation()},onFocusIn:function(b){var c=a.$(b.currentTarget),d=c.attr("data-type");c.parents(".project_input_container").addClass("input_focus_bule"),"label"==d?(b.stopPropagation(),this._renderKlassView(c)):this.classView&&this.classView.close(),"department"==d?(b.stopPropagation(),this._renderDepartmentVIew(c)):this.departmentView&&this.departmentView.close()},onFocusout:function(b){var c=a.$(b.currentTarget),d=(c.parents(".project_input_container").removeClass("input_focus_bule"),c.attr("data-type"));"responsible"!=d||""!=this.valueTrimBr(c.val())&&0!=this.checkResponsible?"name"==d&&""==this.valueTrimBr(c.val())?(c.siblings(".place_holder").show().addClass("tips_error"),c.parent("div").addClass("project_name_input_error"),c.parents(".project_input_container").addClass("input_error")):(this.checkTextError(b),c.parent("div").removeClass("project_name_input_error")):(c.val(""),c.siblings(".place_holder").empty().html(this.model.get("Principal").Name).show(),c.siblings("img").attr("src",this.model.get("Principal").Avatar))},onKeyDown:function(b){var c=a.$(b.target),d=c.attr("data-type"),e=b.keyCode;if("time"==d||"label"==d||"department"==d)if(8==e)switch(c.val(""),d){case"time":this.model.set("StartDate",""),this.model.set("EndDate","");break;case"label":this.model.set("LableId",""),this.model.set("LableName","");break;case"department":this.model.set("DepartmentId",""),this.model.set("DepartmentName","")}else b.preventDefault()},onKeyUp:function(b){{var c=a.$(b.target),d=this.valueTrimBr(c.val()),e=c.attr("data-type");b.keyCode}this.checkTextError(b);var f=c.siblings(".place_holder");c.parent("div").removeClass("project_name_input_error"),f.hide(),"name"==e&&this.model.set("WorkName",d),"description"==e&&this.model.set("Description",d)},onRadioSelect:function(b){var c=a.$(b.target);if(!c.hasClass("radio_blue_checked")){var d=(c.attr("data-type"),c.attr("data-name"));if("invested"==d){var e=1==this.model.get("IsInvested")?!1:!0;this.model.set("IsInvested",e)}else{var f=1==this.model.get("IsVisible")?2:1;this.model.set("IsVisible",f)}var g=c.parents(".project_item_container");g.find(".radio_blue_checked").removeClass("radio_blue_checked"),c.addClass("radio_blue_checked")}},valueTrimBr:function(a){var b=a.replace(/(^\s*)|(\s*$)/g,"").replace(/(^[\s\u3000]*)|([\s\u3000]*$)/g,"").replace(/\n/g," ");return b},checkTextError:function(b){var c=a.$(b.target),d=c.attr("data-type"),e=this.valueTrimBr(c.val());return""==e&&c.siblings(".place_holder").show(),a._.isStringBeyondLength(e,this.defaults[d+"Len"])?(c.parents(".project_input_container").addClass("input_error"),c.parents(".project_item_container").find(".project_input_tips").addClass("tips_error"),!1):(c.parents(".project_input_container").removeClass("input_error"),c.parents(".project_item_container").find(".tips_error").removeClass("tips_error"),!0)},_renderDatepicker:function(a,b,c){a.stopPropagation();var d=Talent.$(a.currentTarget),e=this,g=this.model.get("StartDate"),h=this.model.get("EndDate"),i=this.model.get("WorkType");2==i&&(h=f(new Date(g)).add("years",4).format("YYYY/MM/DD")),this.dateTimePickerView&&this.dateTimePickerView.close();var c={isShowDateView:!0,isShowCycleView:!1,isShowLongView:!0};this.tenant_function.IsUseWork&&(c.count=1,h=g),c.rangepickerOptions={startDate:g,endDate:h,timePicker:!1,format:"YYYY/MM/DD"},this.dateTimePickerView=new k.DateTimePickerView(c),this.listenTo(this.dateTimePickerView,"sure",function(a,b){var c=b.isLongTerm?2:1;e.model.set("WorkType",c),e.model.set("StartDate",b.startDate),2==c?e.model.set("EndDate",""):e.model.set("EndDate",b.endDate),this.ui.timeInput.val(b.isLongTerm?b.startDate+" - 长期":b.startDate+" - "+b.endDate)},this),d.parent().append(this.dateTimePickerView.render().el),this.dateTimePickerView.onShow(),this.dateTimePickerView.show(d,{container:d.parent(),pos:"bottom"})},_requestClassData:function(){var b=this;a.app.request("Lable:getLableData",{obj_id:this.userInfo.Id,obj_type:1}).done(function(a){b.classCollection.reset(a.lables)}).fail(function(){})},_renderKlassView:function(a){this.classView&&this.classView.close(),this.classView=new h({collection:this.classCollection,className:"tt_class_tree_dialog",showTitle:!0,showButtonSure:!0,showButtonReset:!0,isShowProjectTab:this.tenant_function.IsUseWork}),this.classView.collection.reset(this.classCollection.toJSON()),this.listenTo(this.classView,"submit",function(a){this.model.set({LableId:a.id,LableName:a.name})}),this.listenTo(this.classView,"reset",function(){this.model.set({LableId:"",LableName:""})}),this.$el.append(this.classView.render().el),this.classView.setPosition(a)},_requestDepartment:function(){var b=this;a.app.request("Staff:getSimpleDepartsV2",{}).done(function(a){b.departmentCollection.reset(a)}).fail(function(){})},_renderDepartmentVIew:function(b){this.departmentView&&this.departmentView.close(),this.departmentView=new i({collection:new a.Collection,className:"tt_class_tree_dialog",showTitle:!0,showButtonSure:!0,showButtonReset:!0}),this.departmentView.collection.reset(this.departmentCollection.toJSON()),this.listenTo(this.departmentView,"submit",function(a){this.model.set({DepartmentId:a.id,DepartmentName:a.name})}),this.listenTo(this.departmentView,"reset",function(){this.model.set({DepartmentId:"",DepartmentName:""})}),this.$el.append(this.departmentView.render().el),this.departmentView.setPosition(b)},submitNewProject:function(b){var c=this.model.get("WorkName"),d=a.$(b.currentTarget);if(!d.hasClass("btn-disabled")){var e=this.model.get("Description");if(a._.isStringBeyondLength(c,this.defaults.nameLen)||0==c.length)return void this.ui.projectName.parents(".project_input_container").addClass("input_error");var f=this.model.get("Participators")||[],g=[];f.length&&a._.each(f,function(a){var b={};b.Id=a.type?a.id:a.Id,b.Name=a.type?a.name:a.Name,b.Email=a.Email,a.type&&(b.Email=a.name+":"+a.id+":dep_members"),g.push(b)});var h=this.model.get("followers")||[],i=[];h.length&&a._.each(h,function(a){var b={};b.Id=a.type?a.id:a.Id,b.Name=a.type?a.name:a.Name,b.Email=a.Email,a.type&&(b.Email=a.name+":"+a.id+":dep_members"),i.push(b)});var j=this.model.get("ApplyUser"),k=this.model.get("WorkId"),l={WorkName:c,Descripition:e,StartDate:this.model.get("StartDate"),DeadLine:this.model.get("EndDate"),Visibility:this.model.get("IsVisible"),Participators:g,Principal:this.model.get("Principal"),LableId:this.model.get("LableId"),DepartmentId:this.model.get("DepartmentId"),WorkType:this.model.get("WorkType"),ApplyUserId:j?j.UserId:0,work_id:k?k:"",followers:i};this.settings.isShowInvested&&(l.IsInvested=this.model.get("IsInvested")),this.tenant_function.IsUseWork&&(l.WorkType=2),this._disableCreateBtn(),this.trigger("submit",l)}},_disableCreateBtn:function(){this.ui.buttonSubmit.text("正提交...").addClass("btn-disabled")},onClose:function(){this.userSelectorView&&this.userSelectorView.close(),this.warnDialog&&this.warnDialog.close(),this.ui.timeInput.data("daterangepicker")&&this.ui.timeInput.data("daterangepicker").remove()}})}),define("views/work/project-list-sidebar-item-view",["talent","templates/work","views/work/create/project-create-item-view","views/common/new-search/new-search-view"],function(a,b,c,d){return a.ItemView.extend({template:b["work/project-list-sidebar"],sidebarListTemplate:b["work/project-list-sidebar-item"],sidebarListSearchTemplate:b["work/project-list-sidebar-search-item"],className:"work-tabnav-container work-tabnav",defaults:{isShowSearch:!1,isShowImplement:!1,isShowOthers:!1},templateHelpers:function(){var b=this.userInfo.Id,c=this.model.get("routerData").to_user_id;return a._.extend({},this.settings,{userId:this.userInfo.Id,showTagManage:b==c?!0:!1,host:"//"+location.host+"/"+location.pathname,imgUrl:a.Context.getStaticUrl("images/loading.gif"),isShowGIF:this.isShowGIF})},ui:{listItem:"[data-name=list-wraper] a",listArea:'[data-name="list-wraper"]',searchWrap:'[data-name="search-form-wrap"]',arrowBtn:".fold-item .arrow-btn",indicator:"span.indicator_wlsn"},modelEvents:{"change:user":"_renderLiTitle"},events:function(){var a={};return a["click "+this.ui.listItem]="_listItemClickHandler",a["click "+this.ui.arrowBtn]="_arrowBtnClcikHandler",a},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.settings=a._.extend({},this.defaults,this.options),this.isShowGIF=this._isShowGIF()},onRender:function(){var a=this.settings;!a.isShowSearch||203==this.model.get("routerData").appId&&203==this.model.get("routerData").appType||this._renderSearchVeiw(),this.listDataStatus={},this._renderListViewByRelation(),this.renderListByworkid()},_isShowGIF:function(){var a=navigator.userAgent,b=a.indexOf("MSIE")>-1,c=b?/\d+/.exec(a.split(";")[1]):!1;return c&&(c=8>=c?!0:!1),c},slideUp:function(a,b){b.slideUp("slow/200/fast",function(){a.removeClass("tu-icon-fontarrow-up").addClass("tu-icon-fontarrow-down")})},slideDown:function(b,c){var d=new a.$.Deferred;return c.slideDown("slow/200/fast",function(){b.removeClass("tu-icon-fontarrow-down").addClass("tu-icon-fontarrow-up"),d.resolve()}),d.promise()},_renderSearchVeiw:function(){this.searchView&&this.searchView.close(),this.searchView=new d({type:1,skin:"white"}),this.listenTo(this.searchView,"search",function(a){this._searchProject(a)}),this.listenTo(this.searchView,"cancel",function(){this._searchCancleHandler()}),this.ui.searchWrap.append(this.searchView.render().$el)},_searchProject:function(a){var b=this,c=this.model.get("routerData");return a?void this._getListData({filterKey:a,appId:c.appId,appType:c.appType,toUserId:c.to_user_id,isAll:!0}).done(function(c){b._renderSearchSideBar(c.works,a)
}).fail(function(a){b.ui.listArea.html('<div class="empty-list">'+a+"</div>")}):this.ui.listArea.html('<div class="empty-list">请输入项目名称！</div>')},_searchCancleHandler:function(){this.render(),this.trigger("clickCancle")},_getListData:function(b){var c=new a.$.Deferred;return a.app.request("WorkV2:getWorkList",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},_renderListViewByRelation:function(a){var b=this.model.get("routerData"),c=this,a=a||1,d=this.$el.find("ul[data-relation="+a+"]"),e=this.$el.find("a[data-relation="+a+"]").siblings(".arrow-btn"),f=this.userInfo.Id;(3!=a||f==b.to_user_id)&&this._getListData({relation:a,appId:b.app_id,appType:b.app_type,toUserId:b.to_user_id,status:1,isAll:!0}).done(function(f){f.works&&f.works.length?(d.html(c.sidebarListTemplate({value:"",data:f.works,routerData:{relation:a,appId:b.appId,appType:b.appType,to_user_id:b.to_user_id,work_id:c.model.get("routerData").work_id||""}})),e.removeClass("tu-icon-fontarrow-down").addClass("tu-icon-fontarrow-up"),c.slideDown(e,d).done(function(){})):(d.html('<li class="sidebar-empty"><span class="empty-text">暂无数据!</span></li>'),d.slideUp()),c.renderListByworkid(b),a&&3>a&&(a+=1,c._renderListViewByRelation(a))}).fail(function(b){d.html(b),c.slideDown(e,d,a)})},renderListByworkid:function(a){var a=a||this.model.get("routerData"),b=a.relation,c=a.work_id,d=this;b&&c&&1==a.status&&this._getListData({relation:a.relation,appId:a.app_id,appType:a.app_type,toUserId:a.to_user_id,status:a.status,isAll:!0}).done(function(b){if(b.works&&b.works.length){var c=d.$el.find("a[data-relation="+a.relation+"]");c.siblings(".worklist_sidenav").html(d.sidebarListTemplate({value:"",data:b.works,routerData:a})).show(),c.siblings(".arrow-btn").removeClass("tu-icon-fontarrow-down").addClass("tu-icon-fontarrow-up"),d.showActive(a)}}).fail(function(){})},_renderSearchSideBar:function(a,b){this.ui.listArea.html(a&&a.length?this.sidebarListSearchTemplate({value:b,data:a,routerData:this.model.get("routerData")}):'<li class="sidebar-empty"><span class="empty-text">暂无数据!</span></li>')},_arrowBtnClcikHandler:function(b){var c=a.$(b.currentTarget),d=c.siblings(".worklist_sidenav");if(c.hasClass("arrow-btn")){if("block"==d.css("display"))return b&&b.stopPropagation(),this.slideUp(c,d),!1;this.slideDown(c,d)}},_renderLiTitle:function(){var b=this.model.get("user");if(b.Id==this.userInfo.Id)this.$el.find('a[data-name="respon-title"]').html("我负责的"),this.$el.find('a[data-name="paticip-title"]').html("我参与的"),this.$el.find('a[data-name="follow-title"]').html("我关注的");else{var c=a._.substring(b.Name,12,!0);this.$el.find('a[data-name="paticip-title"]').html(c+"参与的"),this.$el.find('a[data-name="follow-title"]').html(c+"关注的"),this.$el.find('a[data-name="respon-title"]').html(c+"负责的")}},showActive:function(a){this.$el.find(".active").removeClass("active");var b=a.relation,c=a.work_id,d=a.status||1,e="&app_id="+a.appId+"&app_type="+a.appType+"&to_user_id="+a.to_user_id,f=c&&1==d?"#work?relation="+b+"&work_id="+c+e:"#work?relation="+b+e,g=this.$el.find('a[href="'+f+'"]');g.hasClass("title-mn")?g.addClass("active"):g.parent("li.item-nav").addClass("active").parents(".sub-menu").show().prev().removeClass("tu-icon-fontarrow-down").addClass("tu-icon-fontarrow-up"),this.$el.find('a[href="'+f+'"] .indicator_wlsn').remove()},_listItemClickHandler:function(b){var c=a.$(b.currentTarget);a.app.vent.trigger("tab:_tita_work:change",c),this.ui.indicator.hide()},onClose:function(){a.$(document).off("click.project-search-blur")}})}),define("views/work/permission-prevent/index-page-view",["talent","templates/work"],function(a,b){var c=a.Layout.extend({template:b["work/permission-prevent/index-page"]});return c}),define("views/work/project-custom-sidebar-view",["talent","templates/work"],function(a,b){return a.ItemView.extend({template:b["work/project-custom-sidebar"],events:{"click  a":"changeRouterData"},initialize:function(){this.routerData=this.options.routerData},onShow:function(){var a=this.model.get("LableTypes"),b=this.routerData.from||"";!b&&a&&a.length&&(b=a[0].Url),this.$el.find(".active").removeClass("active"),this.$el.find('a[href="'+b+'"]').parent("li").addClass("active")},changeRouterData:function(b){b.preventDefault();var c=a.$(b.currentTarget);this.$el.find(".active").removeClass("active"),c.parent().addClass("active"),this.trigger("custom-sidebar-click",c),window.scrollTo(0,0)}})}),define("views/work/project-custom-detail-layout-view",["talent","templates/work"],function(a,b){return a.Layout.extend({template:b["work/project-custom-detail-layout"],className:"tt_page_auto_container",ui:{pageLoading:"div[data-name=page-loading]",iframeBox:"div[data-name=frame-box]"},initialize:function(){this.routerData=this.options.routerData},onClose:function(){a.$("html").css("overflow-y",""),a.$(window).off("resize",this.bindResizeFrame),a.$("#main-region").css("min-height",this.oriMinHeight)},onShow:function(){this._styleFix();var a=this.model.get("LableTypes"),b=this.routerData.from||"";!b&&a&&a.length&&(b=a[0].Url),this.changeFrameUrl(b)},changeFrameUrl:function(a){this.ui.pageLoading.show();var b=this,c=document.createElement("iframe");c.width="100%",c.setAttribute("frameborder","0",0),c.style.display="none",c.attachEvent?c.attachEvent("onload",function(){c.style.display="block",b.$el.find("div[data-name=page-loading]").hide()}):c.onload=function(){c.style.display="block",b.$el.find("div[data-name=page-loading]").hide()},c.src=a,this.ui.iframeBox.html(c),this._resizeFrame()},_styleFix:function(){this.oriOverflow=a.$("html").css("overflow-y"),this.oriMinHeight=a.$("#main-region").css("min-height"),a.$("html").css("overflow-y","hidden"),a.$("#main-region").css("min-height",""),this.$el.css("padding-right",0),this.$el.css("padding-bottom",0),this.bindResizeFrame=a._.bind(this._resizeFrame,this),a.$(window).on("resize",this.bindResizeFrame)},_resizeFrame:function(){var b=a.$(window).height()-a.$("#header-region").height()-30;this.$el.find("iframe").height(b)}})}),define("views/common/membership/membership-tab-composite-view",["talent","templates/common"],function(a,b){var c=a.CompositeView.extend({template:b["common/membership/membership-tab-composite"],tagName:"ul",initialize:function(a){this.options=a||{},this.itemViewOptions={direction:this.options.direction,middleId:this.options.middleId,activeId:this.options.activeId,hasSuperior:"0"==this.model.get("Id")?!1:!0},this.dealData(),this.collection=this.model.subordinate},onRender:function(){1==this.model.get("level")&&this.$el.addClass("first_ul"),2==this.model.get("level")&&this.$el.addClass("second_ul"),this.model.get("Id")==this.options.activeId&&this.$el.find("div:first").addClass("active"),this.options.hasSuperior?"0"==this.model.get("subordinateCount")&&"3"!=this.model.get("level")&&this.$el.find(".membership_line").addClass("membership_line_last"):"0"==this.model.get("subordinateCount")&&(this.$el.find(".membership_line").addClass("membership_line_last"),this.$el.find(".membership_line").css({width:0}))},appendHtml:function(a,b){a.$("li:first").find(".membership_subordinate_container").append(b.el)},dealData:function(){var a=12;(1==this.model.get("level")||2==this.model.get("level"))&&(a=6),this.model.set("subName",this.subString(this.model.get("Name"),a,!0))},subString:function(a,b,c){for(var d=0,e="",f=/[^\x00-\xff]/g,g="",a=a||"",h=a.replace(f,"**").length,i=0;h>i&&(g=a.charAt(i).toString(),null!=g.match(f)?d+=2:d++,!(d>b));i++)e+=g;return c&&h>b&&(e+="..."),e}});return a.CollectionView.extend({itemView:c,events:{"click .membreship_subordinate_btn":"changeActiveId","click .membership_item_short":"changeActiveId","click .membership_item_long":"changeProfileId"},initialize:function(a){this.itemViewOptions=this.model.toJSON()},changeActiveId:function(b){var c=this,d=a.$(b.target).parents("li"),e=d.attr("data-id"),f=d.attr("level");if(3!=f){var g=a.app.request("Membership:getSuperior",{id:e}),h="1"==f?"1-3":"2-3";g.done(function(a){c.trigger("changeActiveId",{middleId:a,direction:h,activeId:e})})}else this.trigger("changeActiveId",{middleId:e,direction:"3-2",activeId:e});b.stopPropagation()},changeProfileId:function(b){{var c=a.$(b.target).parents("li"),d=c.attr("data-id");c.attr("")}this.trigger("changeProfileId",{profileId:d,activeId:d,middleId:this.model.get("middleId")})},onRender:function(){this.$el.find(".second_ul .membership_subordinate_container>ul:last").find(".membership_line").addClass("membership_line_last")},onShow:function(){this.trigger("allItemShow")}})}),function(a){var b=function(b){function c(){!E.find("#BS_scroll").length>0&&(F.style.position="relative",F.style.overflow="hidden",E.append(b.setStyle?['<div style="display:none;top:0;position: absolute;" id="BS_scroll"  >','<em style="min-height: 15px;display:inline-block;" id="BS_scroll_main"></em>',"</div>"].join(""):['<div style="display:none;top:0;position: absolute;right: 1px;width: 11px;" id="BS_scroll"  >','<em style="height:0;background-image: url('+A+'/webim_scroll_bg.png);background-position: -9px 0;background-repeat: repeat-y;width: 11px;min-height: 5px;border-radius: 4px;display:inline-block;" id="BS_scroll_main"></em>',"</div>"].join(""))),s=E.find("#BS_scroll")[0],s.style.zIndex=1e3,t=E.find("#BS_scroll_main")[0],o(F),n(F),d()}function d(){if(containerClientHeight=F.clientHeight,C&&0==containerClientHeight&&(containerClientHeight=F.offsetHeight),containerScrollHeight=E.find("ul").height(),u=containerClientHeight<containerScrollHeight){var a=containerClientHeight/containerScrollHeight,b=parseInt(containerClientHeight*a>D?containerClientHeight*a:D);t.style.height=b-7+"px",x=containerClientHeight-b,w=containerScrollHeight-containerClientHeight;var c=F.scrollTop/w;c>1&&(c=1),0>c&&(c=0),m(c),f()}}function e(){s.style.display="none"}function f(){s.style.display=""}function g(a){H||(H=!0,a=a||widow.event,y=a.clientY,r(a))}function h(a){if(H){a=a||window.event;var b=a.clientY;v=(b-y)/x+G,v>1&&(v=1),0>v&&(v=0),m(v),r(a)}}function i(){H&&(H=!1,G=v)}function j(b){{var b=b||window.event;b.srcElement||b.target}z&&clearTimeout(z),!u||(z=setTimeout(function(){f(),p(document,"mousemove",h),a(document).on("selectstart.sortable",function(){return!1})},300))}function k(){z&&clearTimeout(z),z=setTimeout(function(){e(),q(document,"mousemove",h),a(document).off("selectstart.sortable")},500)}function l(a){if(u){var b=B?a.detail:-a.wheelDelta/40;G=(F.scrollTop+16*b)/w,G>1&&(G=1,d()),0>G&&(G=0),m(G),r(a)}}function m(a){F.scrollTop=a*w,s.style.top=a*x+F.scrollTop+"px",v=a}function n(){p(F,B?"DOMMouseScroll":"mousewheel",l),p(t,"mousedown",g),p(document,"mouseup",i),p(F,"mouseover",j),p(F,"mouseout",k)}function o(){q(F,B?"DOMMouseScroll":"mousewheel",l),q(t,"mousedown",g),q(document,"mouseup",i),q(F,"mouseover",j),q(F,"mouseout",k)}function p(a,b,c){return window.addEventListener?a.addEventListener(b,c,!1):window.attachEvent?a.attachEvent("on"+b,c):{}}function q(a,b,c){return window.addEventListener?a.removeEventListener(b,c,!1):window.detachEvent?a.detachEvent("on"+b,c):{}}function r(a){a.preventDefault?a.preventDefault():a.returnValue=!1}var s,t,u,v,w,x,y,z,A=b.imgUrl||"",B=(b.setStyle,navigator.userAgent.toLowerCase().match(/firefox\/([\d.]+)/)),C=!window.XMLHttpRequest&&window.ActiveXObject,D=20,E=this,F=this[0],G=0,H=!1;c()};a.fn.extend({scrollable:b})}(jQuery),define("$.scrollable",function(){}),function(a,b){function c(a){return""===f?a:(a=a.charAt(0).toUpperCase()+a.substr(1),f+a)}var d=Math,e=b.createElement("div").style,f=function(){for(var a,b="t,webkitT,MozT,msT,OT".split(","),c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in e)return b[c].substr(0,b[c].length-1);return!1}(),g=f?"-"+f.toLowerCase()+"-":"",h=c("transform"),i=c("transitionProperty"),j=c("transitionDuration"),k=c("transformOrigin"),l=c("transitionTimingFunction"),m=c("transitionDelay"),n=/android/gi.test(navigator.appVersion),o=/iphone|ipad/gi.test(navigator.appVersion),p=/hp-tablet/gi.test(navigator.appVersion),q=c("perspective")in e,r="ontouchstart"in a&&!p,s=f!==!1,t=c("transition")in e,u="onorientationchange"in a?"orientationchange":"resize",v=r?"touchstart":"mousedown",w=r?"touchmove":"mousemove",x=r?"touchend":"mouseup",y=r?"touchcancel":"mouseup",z=function(){if(f===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return a[f]}(),A=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),B=function(){return a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout}(),C=q?" translateZ(0)":"",D=function(c,d){var e,f=this;f.wrapper="object"==typeof c?c:b.getElementById(c),f.wrapper.style.overflow="hidden",f.scroller=f.wrapper.children[0],f.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:n,hideScrollbar:o,fadeScrollbar:o&&q,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(e in d)f.options[e]=d[e];f.x=f.options.x,f.y=f.options.y,f.options.useTransform=s&&f.options.useTransform,f.options.hScrollbar=f.options.hScroll&&f.options.hScrollbar,f.options.vScrollbar=f.options.vScroll&&f.options.vScrollbar,f.options.zoom=f.options.useTransform&&f.options.zoom,f.options.useTransition=t&&f.options.useTransition,f.options.zoom&&n&&(C=""),f.scroller.style[i]=f.options.useTransform?g+"transform":"top left",f.scroller.style[j]="0",f.scroller.style[k]="0 0",f.options.useTransition&&(f.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)"),f.options.useTransform?f.scroller.style[h]="translate("+f.x+"px,"+f.y+"px)"+C:f.scroller.style.cssText+=";position:absolute;top:"+f.y+"px;left:"+f.x+"px",f.options.useTransition&&(f.options.fixedScrollbar=!0),f.refresh(),f._bind(u,a),f._bind(v),r||"none"!=f.options.wheelAction&&(f._bind("DOMMouseScroll"),f._bind("mousewheel")),f.options.checkDOMChanges&&(f.checkDOMTime=setInterval(function(){f._checkDOMChanges()},500))};D.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){var b=this;switch(a.type){case v:if(!r&&0!==a.button)return;b._start(a);break;case w:b._move(a);break;case x:case y:b._end(a);break;case u:b._resize();break;case"DOMMouseScroll":case"mousewheel":b._wheel(a);break;case z:b._transitionEnd(a)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(a){var c,e=this;return e[a+"Scrollbar"]?(e[a+"ScrollbarWrapper"]||(c=b.createElement("div"),e.options.scrollbarClass?c.className=e.options.scrollbarClass+a.toUpperCase():c.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(e.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(e.hScrollbar?"7":"2")+"px;top:2px;right:1px"),c.style.cssText+=";pointer-events:none;"+g+"transition-property:opacity;"+g+"transition-duration:"+(e.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(e.options.hideScrollbar?"0":"1"),e.wrapper.appendChild(c),e[a+"ScrollbarWrapper"]=c,c=b.createElement("div"),e.options.scrollbarClass||(c.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+g+"background-clip:padding-box;"+g+"box-sizing:border-box;"+("h"==a?"height:100%":"width:100%")+";"+g+"border-radius:3px;border-radius:3px"),c.style.cssText+=";pointer-events:none;"+g+"transition-property:"+g+"transform;"+g+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+g+"transition-duration:0;"+g+"transform: translate(0,0)"+C,e.options.useTransition&&(c.style.cssText+=";"+g+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),e[a+"ScrollbarWrapper"].appendChild(c),e[a+"ScrollbarIndicator"]=c),"h"==a?(e.hScrollbarSize=e.hScrollbarWrapper.clientWidth,e.hScrollbarIndicatorSize=d.max(d.round(e.hScrollbarSize*e.hScrollbarSize/e.scrollerW),8),e.hScrollbarIndicator.style.width=e.hScrollbarIndicatorSize+"px",e.hScrollbarMaxScroll=e.hScrollbarSize-e.hScrollbarIndicatorSize,e.hScrollbarProp=e.hScrollbarMaxScroll/e.maxScrollX):(e.vScrollbarSize=e.vScrollbarWrapper.clientHeight,e.vScrollbarIndicatorSize=d.max(d.round(e.vScrollbarSize*e.vScrollbarSize/e.scrollerH),8),e.vScrollbarIndicator.style.height=e.vScrollbarIndicatorSize+"px",e.vScrollbarMaxScroll=e.vScrollbarSize-e.vScrollbarIndicatorSize,e.vScrollbarProp=e.vScrollbarMaxScroll/e.maxScrollY),void e._scrollbarPos(a,!0)):void(e[a+"ScrollbarWrapper"]&&(s&&(e[a+"ScrollbarIndicator"].style[h]=""),e[a+"ScrollbarWrapper"].parentNode.removeChild(e[a+"ScrollbarWrapper"]),e[a+"ScrollbarWrapper"]=null,e[a+"ScrollbarIndicator"]=null))},_resize:function(){var a=this;setTimeout(function(){a.refresh()},n?200:0)},_pos:function(a,b){this.zoomed||(a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[h]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+C:(a=d.round(a),b=d.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(a,b){var c,e=this,f="h"==a?e.x:e.y;e[a+"Scrollbar"]&&(f=e[a+"ScrollbarProp"]*f,0>f?(e.options.fixedScrollbar||(c=e[a+"ScrollbarIndicatorSize"]+d.round(3*f),8>c&&(c=8),e[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px"),f=0):f>e[a+"ScrollbarMaxScroll"]&&(e.options.fixedScrollbar?f=e[a+"ScrollbarMaxScroll"]:(c=e[a+"ScrollbarIndicatorSize"]-d.round(3*(f-e[a+"ScrollbarMaxScroll"])),8>c&&(c=8),e[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px",f=e[a+"ScrollbarMaxScroll"]+(e[a+"ScrollbarIndicatorSize"]-c))),e[a+"ScrollbarWrapper"].style[m]="0",e[a+"ScrollbarWrapper"].style.opacity=b&&e.options.hideScrollbar?"0":"1",e[a+"ScrollbarIndicator"].style[h]="translate("+("h"==a?f+"px,0)":"0,"+f+"px)")+C)},_start:function(b){var c,e,f,g,i,j=this,k=r?b.touches[0]:b;j.enabled&&(j.options.onBeforeScrollStart&&j.options.onBeforeScrollStart.call(j,b),(j.options.useTransition||j.options.zoom)&&j._transitionTime(0),j.moved=!1,j.animating=!1,j.zoomed=!1,j.distX=0,j.distY=0,j.absDistX=0,j.absDistY=0,j.dirX=0,j.dirY=0,j.options.zoom&&r&&b.touches.length>1&&(g=d.abs(b.touches[0].pageX-b.touches[1].pageX),i=d.abs(b.touches[0].pageY-b.touches[1].pageY),j.touchesDistStart=d.sqrt(g*g+i*i),j.originX=d.abs(b.touches[0].pageX+b.touches[1].pageX-2*j.wrapperOffsetLeft)/2-j.x,j.originY=d.abs(b.touches[0].pageY+b.touches[1].pageY-2*j.wrapperOffsetTop)/2-j.y,j.options.onZoomStart&&j.options.onZoomStart.call(j,b)),j.options.momentum&&(j.options.useTransform?(c=getComputedStyle(j.scroller,null)[h].replace(/[^0-9\-.,]/g,"").split(","),e=+(c[12]||c[4]),f=+(c[13]||c[5])):(e=+getComputedStyle(j.scroller,null).left.replace(/[^0-9-]/g,""),f=+getComputedStyle(j.scroller,null).top.replace(/[^0-9-]/g,"")),(e!=j.x||f!=j.y)&&(j.options.useTransition?j._unbind(z):B(j.aniTime),j.steps=[],j._pos(e,f),j.options.onScrollEnd&&j.options.onScrollEnd.call(j))),j.absStartX=j.x,j.absStartY=j.y,j.startX=j.x,j.startY=j.y,j.pointX=k.pageX,j.pointY=k.pageY,j.startTime=b.timeStamp||Date.now(),j.options.onScrollStart&&j.options.onScrollStart.call(j,b),j._bind(w,a),j._bind(x,a),j._bind(y,a))},_move:function(a){var b,c,e,f=this,g=r?a.touches[0]:a,i=g.pageX-f.pointX,j=g.pageY-f.pointY,k=f.x+i,l=f.y+j,m=a.timeStamp||Date.now();return f.options.onBeforeScrollMove&&f.options.onBeforeScrollMove.call(f,a),f.options.zoom&&r&&a.touches.length>1?(b=d.abs(a.touches[0].pageX-a.touches[1].pageX),c=d.abs(a.touches[0].pageY-a.touches[1].pageY),f.touchesDist=d.sqrt(b*b+c*c),f.zoomed=!0,e=1/f.touchesDistStart*f.touchesDist*this.scale,e<f.options.zoomMin?e=.5*f.options.zoomMin*Math.pow(2,e/f.options.zoomMin):e>f.options.zoomMax&&(e=2*f.options.zoomMax*Math.pow(.5,f.options.zoomMax/e)),f.lastScale=e/this.scale,k=this.originX-this.originX*f.lastScale+this.x,l=this.originY-this.originY*f.lastScale+this.y,this.scroller.style[h]="translate("+k+"px,"+l+"px) scale("+e+")"+C,void(f.options.onZoom&&f.options.onZoom.call(f,a))):(f.pointX=g.pageX,f.pointY=g.pageY,(k>0||k<f.maxScrollX)&&(k=f.options.bounce?f.x+i/2:k>=0||f.maxScrollX>=0?0:f.maxScrollX),(l>f.minScrollY||l<f.maxScrollY)&&(l=f.options.bounce?f.y+j/2:l>=f.minScrollY||f.maxScrollY>=0?f.minScrollY:f.maxScrollY),f.distX+=i,f.distY+=j,f.absDistX=d.abs(f.distX),f.absDistY=d.abs(f.distY),void(f.absDistX<6&&f.absDistY<6||(f.options.lockDirection&&(f.absDistX>f.absDistY+5?(l=f.y,j=0):f.absDistY>f.absDistX+5&&(k=f.x,i=0)),f.moved=!0,f._pos(k,l),f.dirX=i>0?-1:0>i?1:0,f.dirY=j>0?-1:0>j?1:0,m-f.startTime>300&&(f.startTime=m,f.startX=f.x,f.startY=f.y),f.options.onScrollMove&&f.options.onScrollMove.call(f,a))))},_end:function(c){if(!r||0===c.touches.length){var e,f,g,i,k,l,m,n=this,o=r?c.changedTouches[0]:c,p={dist:0,time:0},q={dist:0,time:0},s=(c.timeStamp||Date.now())-n.startTime,t=n.x,u=n.y;if(n._unbind(w,a),n._unbind(x,a),n._unbind(y,a),n.options.onBeforeScrollEnd&&n.options.onBeforeScrollEnd.call(n,c),n.zoomed)return m=n.scale*n.lastScale,m=Math.max(n.options.zoomMin,m),m=Math.min(n.options.zoomMax,m),n.lastScale=m/n.scale,n.scale=m,n.x=n.originX-n.originX*n.lastScale+n.x,n.y=n.originY-n.originY*n.lastScale+n.y,n.scroller.style[j]="200ms",n.scroller.style[h]="translate("+n.x+"px,"+n.y+"px) scale("+n.scale+")"+C,n.zoomed=!1,n.refresh(),void(n.options.onZoomEnd&&n.options.onZoomEnd.call(n,c));if(!n.moved)return r&&(n.doubleTapTimer&&n.options.zoom?(clearTimeout(n.doubleTapTimer),n.doubleTapTimer=null,n.options.onZoomStart&&n.options.onZoomStart.call(n,c),n.zoom(n.pointX,n.pointY,1==n.scale?n.options.doubleTapZoom:1),n.options.onZoomEnd&&setTimeout(function(){n.options.onZoomEnd.call(n,c)},200)):this.options.handleClick&&(n.doubleTapTimer=setTimeout(function(){for(n.doubleTapTimer=null,e=o.target;1!=e.nodeType;)e=e.parentNode;"SELECT"!=e.tagName&&"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName&&(f=b.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!0,c.view,1,o.screenX,o.screenY,o.clientX,o.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null),f._fake=!0,e.dispatchEvent(f))},n.options.zoom?250:0))),n._resetPos(400),void(n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c));if(300>s&&n.options.momentum&&(p=t?n._momentum(t-n.startX,s,-n.x,n.scrollerW-n.wrapperW+n.x,n.options.bounce?n.wrapperW:0):p,q=u?n._momentum(u-n.startY,s,-n.y,n.maxScrollY<0?n.scrollerH-n.wrapperH+n.y-n.minScrollY:0,n.options.bounce?n.wrapperH:0):q,t=n.x+p.dist,u=n.y+q.dist,(n.x>0&&t>0||n.x<n.maxScrollX&&t<n.maxScrollX)&&(p={dist:0,time:0}),(n.y>n.minScrollY&&u>n.minScrollY||n.y<n.maxScrollY&&u<n.maxScrollY)&&(q={dist:0,time:0})),p.dist||q.dist)return k=d.max(d.max(p.time,q.time),10),n.options.snap&&(g=t-n.absStartX,i=u-n.absStartY,d.abs(g)<n.options.snapThreshold&&d.abs(i)<n.options.snapThreshold?n.scrollTo(n.absStartX,n.absStartY,200):(l=n._snap(t,u),t=l.x,u=l.y,k=d.max(l.time,k))),n.scrollTo(d.round(t),d.round(u),k),void(n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c));if(n.options.snap)return g=t-n.absStartX,i=u-n.absStartY,d.abs(g)<n.options.snapThreshold&&d.abs(i)<n.options.snapThreshold?n.scrollTo(n.absStartX,n.absStartY,200):(l=n._snap(n.x,n.y),(l.x!=n.x||l.y!=n.y)&&n.scrollTo(l.x,l.y,l.time)),void(n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c));n._resetPos(200),n.options.onTouchEnd&&n.options.onTouchEnd.call(n,c)}},_resetPos:function(a){var b=this,c=b.x>=0?0:b.x<b.maxScrollX?b.maxScrollX:b.x,d=b.y>=b.minScrollY||b.maxScrollY>0?b.minScrollY:b.y<b.maxScrollY?b.maxScrollY:b.y;return c==b.x&&d==b.y?(b.moved&&(b.moved=!1,b.options.onScrollEnd&&b.options.onScrollEnd.call(b)),b.hScrollbar&&b.options.hideScrollbar&&("webkit"==f&&(b.hScrollbarWrapper.style[m]="300ms"),b.hScrollbarWrapper.style.opacity="0"),void(b.vScrollbar&&b.options.hideScrollbar&&("webkit"==f&&(b.vScrollbarWrapper.style[m]="300ms"),b.vScrollbarWrapper.style.opacity="0"))):void b.scrollTo(c,d,a||0)},_wheel:function(a){var b,c,d,e,f,g=this;if("wheelDeltaX"in a)b=a.wheelDeltaX/12,c=a.wheelDeltaY/12;else if("wheelDelta"in a)b=c=a.wheelDelta/12;else{if(!("detail"in a))return;b=c=3*-a.detail}return"zoom"==g.options.wheelAction?(f=g.scale*Math.pow(2,1/3*(c?c/Math.abs(c):0)),f<g.options.zoomMin&&(f=g.options.zoomMin),f>g.options.zoomMax&&(f=g.options.zoomMax),void(f!=g.scale&&(!g.wheelZoomCount&&g.options.onZoomStart&&g.options.onZoomStart.call(g,a),g.wheelZoomCount++,g.zoom(a.pageX,a.pageY,f,400),setTimeout(function(){g.wheelZoomCount--,!g.wheelZoomCount&&g.options.onZoomEnd&&g.options.onZoomEnd.call(g,a)},400)))):(d=g.x+b,e=g.y+c,d>0?d=0:d<g.maxScrollX&&(d=g.maxScrollX),e>g.minScrollY?e=g.minScrollY:e<g.maxScrollY&&(e=g.maxScrollY),void(g.maxScrollY<0&&g.scrollTo(d,e,0)))},_transitionEnd:function(a){var b=this;a.target==b.scroller&&(b._unbind(z),b._startAni())},_startAni:function(){var a,b,c,e=this,f=e.x,g=e.y,h=Date.now();if(!e.animating){if(!e.steps.length)return void e._resetPos(400);if(a=e.steps.shift(),a.x==f&&a.y==g&&(a.time=0),e.animating=!0,e.moved=!0,e.options.useTransition)return e._transitionTime(a.time),e._pos(a.x,a.y),e.animating=!1,void(a.time?e._bind(z):e._resetPos(0));c=function(){var i,j,k=Date.now();return k>=h+a.time?(e._pos(a.x,a.y),e.animating=!1,e.options.onAnimationEnd&&e.options.onAnimationEnd.call(e),void e._startAni()):(k=(k-h)/a.time-1,b=d.sqrt(1-k*k),i=(a.x-f)*b+f,j=(a.y-g)*b+g,e._pos(i,j),void(e.animating&&(e.aniTime=A(c))))},c()}},_transitionTime:function(a){a+="ms",this.scroller.style[j]=a,this.hScrollbar&&(this.hScrollbarIndicator.style[j]=a),this.vScrollbar&&(this.vScrollbarIndicator.style[j]=a)},_momentum:function(a,b,c,e,f){var g=6e-4,h=d.abs(a)/b,i=h*h/(2*g),j=0,k=0;return a>0&&i>c?(k=f/(6/(i/h*g)),c+=k,h=h*c/i,i=c):0>a&&i>e&&(k=f/(6/(i/h*g)),e+=k,h=h*e/i,i=e),i*=0>a?-1:1,j=h/g,{dist:i,time:d.round(j)}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return a!=this.wrapper&&(b*=this.scale,c*=this.scale),{left:b,top:c}},_snap:function(a,b){var c,e,f,g,h,i,j=this;for(f=j.pagesX.length-1,c=0,e=j.pagesX.length;e>c;c++)if(a>=j.pagesX[c]){f=c;break}for(f==j.currPageX&&f>0&&j.dirX<0&&f--,a=j.pagesX[f],h=d.abs(a-j.pagesX[j.currPageX]),h=h?d.abs(j.x-a)/h*500:0,j.currPageX=f,f=j.pagesY.length-1,c=0;f>c;c++)if(b>=j.pagesY[c]){f=c;break}return f==j.currPageY&&f>0&&j.dirY<0&&f--,b=j.pagesY[f],i=d.abs(b-j.pagesY[j.currPageY]),i=i?d.abs(j.y-b)/i*500:0,j.currPageY=f,g=d.round(d.max(h,i))||200,{x:a,y:b,time:g}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){var b=this;b.scroller.style[h]="",b.hScrollbar=!1,b.vScrollbar=!1,b._scrollbar("h"),b._scrollbar("v"),b._unbind(u,a),b._unbind(v),b._unbind(w,a),b._unbind(x,a),b._unbind(y,a),b.options.hasTouch||(b._unbind("DOMMouseScroll"),b._unbind("mousewheel")),b.options.useTransition&&b._unbind(z),b.options.checkDOMChanges&&clearInterval(b.checkDOMTime),b.options.onDestroy&&b.options.onDestroy.call(b)},refresh:function(){var a,b,c,e,f=this,g=0,h=0;if(f.scale<f.options.zoomMin&&(f.scale=f.options.zoomMin),f.wrapperW=f.wrapper.clientWidth||1,f.wrapperH=f.wrapper.clientHeight||1,f.minScrollY=-f.options.topOffset||0,f.scrollerW=d.round(f.scroller.offsetWidth*f.scale),f.scrollerH=d.round((f.scroller.offsetHeight+f.minScrollY)*f.scale),f.maxScrollX=f.wrapperW-f.scrollerW,f.maxScrollY=f.wrapperH-f.scrollerH+f.minScrollY,f.dirX=0,f.dirY=0,f.options.onRefresh&&f.options.onRefresh.call(f),f.hScroll=f.options.hScroll&&f.maxScrollX<0,f.vScroll=f.options.vScroll&&(!f.options.bounceLock&&!f.hScroll||f.scrollerH>f.wrapperH),f.hScrollbar=f.hScroll&&f.options.hScrollbar,f.vScrollbar=f.vScroll&&f.options.vScrollbar&&f.scrollerH>f.wrapperH,a=f._offset(f.wrapper),f.wrapperOffsetLeft=-a.left,f.wrapperOffsetTop=-a.top,"string"==typeof f.options.snap)for(f.pagesX=[],f.pagesY=[],e=f.scroller.querySelectorAll(f.options.snap),b=0,c=e.length;c>b;b++)g=f._offset(e[b]),g.left+=f.wrapperOffsetLeft,g.top+=f.wrapperOffsetTop,f.pagesX[b]=g.left<f.maxScrollX?f.maxScrollX:g.left*f.scale,f.pagesY[b]=g.top<f.maxScrollY?f.maxScrollY:g.top*f.scale;else if(f.options.snap){for(f.pagesX=[];g>=f.maxScrollX;)f.pagesX[h]=g,g-=f.wrapperW,h++;for(f.maxScrollX%f.wrapperW&&(f.pagesX[f.pagesX.length]=f.maxScrollX-f.pagesX[f.pagesX.length-1]+f.pagesX[f.pagesX.length-1]),g=0,h=0,f.pagesY=[];g>=f.maxScrollY;)f.pagesY[h]=g,g-=f.wrapperH,h++;f.maxScrollY%f.wrapperH&&(f.pagesY[f.pagesY.length]=f.maxScrollY-f.pagesY[f.pagesY.length-1]+f.pagesY[f.pagesY.length-1])}f._scrollbar("h"),f._scrollbar("v"),f.zoomed||(f.scroller.style[j]="0",f._resetPos(400))},scrollTo:function(a,b,c,d){var e,f,g=this,h=a;for(g.stop(),h.length||(h=[{x:a,y:b,time:c,relative:d}]),e=0,f=h.length;f>e;e++)h[e].relative&&(h[e].x=g.x-h[e].x,h[e].y=g.y-h[e].y),g.steps.push({x:h[e].x,y:h[e].y,time:h[e].time||0});g._startAni()},scrollToElement:function(a,b){var c,e=this;a=a.nodeType?a:e.scroller.querySelector(a),a&&(c=e._offset(a),c.left+=e.wrapperOffsetLeft,c.top+=e.wrapperOffsetTop,c.left=c.left>0?0:c.left<e.maxScrollX?e.maxScrollX:c.left,c.top=c.top>e.minScrollY?e.minScrollY:c.top<e.maxScrollY?e.maxScrollY:c.top,b=void 0===b?d.max(2*d.abs(c.left),2*d.abs(c.top)):b,e.scrollTo(c.left,c.top,b))},scrollToPage:function(a,b,c){var d,e,f=this;c=void 0===c?400:c,f.options.onScrollStart&&f.options.onScrollStart.call(f),f.options.snap?(a="next"==a?f.currPageX+1:"prev"==a?f.currPageX-1:a,b="next"==b?f.currPageY+1:"prev"==b?f.currPageY-1:b,a=0>a?0:a>f.pagesX.length-1?f.pagesX.length-1:a,b=0>b?0:b>f.pagesY.length-1?f.pagesY.length-1:b,f.currPageX=a,f.currPageY=b,d=f.pagesX[a],e=f.pagesY[b]):(d=-f.wrapperW*a,e=-f.wrapperH*b,d<f.maxScrollX&&(d=f.maxScrollX),e<f.maxScrollY&&(e=f.maxScrollY)),f.scrollTo(d,e,c)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(w,a),this._unbind(x,a),this._unbind(y,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(z):B(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(a,b,c,d){var e=this,f=c/e.scale;e.options.useTransform&&(e.zoomed=!0,d=void 0===d?200:d,a=a-e.wrapperOffsetLeft-e.x,b=b-e.wrapperOffsetTop-e.y,e.x=a-a*f+e.x,e.y=b-b*f+e.y,e.scale=c,e.refresh(),e.x=e.x>0?0:e.x<e.maxScrollX?e.maxScrollX:e.x,e.y=e.y>e.minScrollY?e.minScrollY:e.y<e.maxScrollY?e.maxScrollY:e.y,e.scroller.style[j]=d+"ms",e.scroller.style[h]="translate("+e.x+"px,"+e.y+"px) scale("+c+")"+C,e.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},e=null,"undefined"!=typeof exports?exports.iScroll=D:a.iScroll=D}(window,document),define("iScroll",function(){}),define("views/common/membership/membership-tab-layout",["talent","templates/common","views/common/membership/membership-tab-composite-view","$.scrollable","iScroll"],function(a,b,c,d,e){function f(a,b,c,d,e,f){return e.level2.css(c),[function(){e.level1.css(a).animate(b,200,f)},function(){e.level2.animate(d,300,f)}]}function g(a,b,c,d,e,f){return e.level2.css(c),[function(){e.level1.hide().toggle("slow",f)},function(){e.level2.animate(d,200,f)}]}function h(a,b,c,d,e,f){return"0"==e.level1.parents("li").attr("data-id")?(e.level2.css(c),[function(){e.level1.hide().toggle("slow",f)},function(){e.level2.animate(d,200,f)}]):(e.level2.hide(),[function(){e.level1.hide().toggle("slow",f)},function(){e.level2.hide().toggle("slow",f)
}])}function i(a,b){var c=a.model.get("direction"),d=j(a);d.line.hide(),d.level3.hide();var e=[],i=[function(){d.level3.toggle("slow",o)},function(){d.line.toggle("slow",o)},function(){b.resolve()}],k={"margin-left":10,"margin-top":10},l={"margin-left":-5,"margin-top":0};if("3-2"==c)var m={"margin-left":10,width:200,height:80,"margin-top":10},n={width:d.level2.width(),height:d.level2.height(),"margin-left":0,"margin-top":0};else var m={"margin-left":-20},n={"margin-left":0};var o=function(){a.$el.dequeue("slideList")};switch(c){case"3-2":e=f(k,l,m,n,d,o);break;case"2-3":e=g(k,l,m,n,d,o);break;default:e=h(k,l,m,n,d,o)}"0"==d.level1.parents("li").attr("data-id")&&(e=e.slice(1,e.length)),"0"==d.level1.parents("li").attr("data-id")&&0==a.$el.find(".second_ul li:first").attr("data-id")&&(d.level2.css(n),e=e.slice(1,e.length)),e=e.concat(i),a.$el.queue("slideList",e),o()}function j(a){var b=a.$el.find(".second_ul>li>div:first");return{level1:a.$el.find(".first_ul>li>div:first"),level2:b,level3:b.parent().find(".membership_subordinate_container"),line:a.$el.find(".membership_line")}}var k=a.Region.extend({show:function(a){var b=this;this.ensureEl();var c=a.isClosed||_.isUndefined(a.$el),d=a!==this.currentView;d&&this.close(),a.render(),d||c?this.open(a).done(function(){b.currentView=a,Marionette.triggerMethod.call(b,"show",a),Marionette.triggerMethod.call(a,"show")}):(this.currentView=a,Marionette.triggerMethod.call(this,"show",a),Marionette.triggerMethod.call(a,"show"))},open:function(a){var b=new $.Deferred;return this.$el.empty().append(a.el),i(a,b),b.promise()}}),l=a.Layout.extend({template:b["common/membership/membership-tab-layout"],className:"membership_tab_container",regions:{tab:{selector:".membership_tab_staff_container",regionType:k}},ui:{tab:".membership_tab_staff_container",backContainer:".membership_back",backBtn:".membership_back_btn"},events:{"click .membership_back_btn":"showTopStaffView"},modelEvents:{"change:middleId":"renderTabView","change:profileId":"renderProfileView","change:activeId":"renderActive"},initialize:function(){},onRender:function(){},getTabData:function(){var b=new $.Deferred,c=a.app.request("Membership:getDataType",{id:this.model.get("middleId"),activeId:this.model.get("activeId"),type:this.model.get("type")});return c.done(function(a){b.resolve(a)}),b.promise()},renderTabView:function(){var b=this,d=a.Model.extend({initialize:function(){var a=this.get("subordinate");a&&(this.subordinate=new e(a),this.unset("subordinate"))}}),e=a.Collection.extend({model:d});this.getTabData().done(function(a){b.membershipTabCompositeView=new c({collection:new e(a),model:b.model}),0==a[0].Id&&0==a[0].subordinate[0].Id?(b.ui.backBtn.slideUp("slow"),b.ui.tab.addClass("membership_top_staff")):(b.ui.backBtn.slideDown("slow"),b.ui.tab.removeClass("membership_top_staff")),b.renderTabBottomStaff(b.membershipTabCompositeView),b.bindEvents(b.membershipTabCompositeView)})},renderTabBottomStaff:function(a){var b=this;b.tab.show(a),b.topContainer=!1},bindEvents:function(a){var b=this;a.on("changeActiveId",function(a){b.model.set(a)}),a.on("changeProfileId",function(a){b.model.set(a)}),a.on("allItemShow",function(){b.afterTabAllRender()})},afterTabAllRender:function(){this.updateDimension();var b=this,c=a._.debounce(function(){b.updateDimension()},400);$(window).off("resize.membership_page"),$(window).on("resize.membership_page",c)},renderProfileView:function(){var a=this.model.get("profileId");this.trigger("detailIdChanged",a)},renderActive:function(){var a=this.model.get("activeId"),b=this.ui.tab.find('[data-id="'+a+'"]').find("div:first");b.hasClass("active")||(this.ui.tab.find(".active").removeClass("active"),b.addClass("active"))},onShow:function(){this.renderTabView()},showTopStaffView:function(){var b=a.Context.getUserInfo().Id;this.model.set({middleId:b,direction:"2-3"})},getIsMobile:function(){for(var a=navigator.userAgent,b=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),c=!0,d=0;d<b.length;d++)if(a.indexOf(b[d])>0){c=!1;break}return c},updateDimension:function(){var b=a.$("#header-region").outerHeight(),c=(a.$("#main-region").outerHeight(),a.$(window).height()-b),d=c-11-a.$(".membership_tab_top").outerHeight()-a.$(".membership_bottom").outerHeight()-a.$(".membership_back").outerHeight(),f=this.$el.find("#membership_scroll_container");f.height(d);var g=this.getIsMobile();g?f.scrollable({setStyle:!0}):this.tabScroll=new e("membership_scroll_container",{hScrollbar:!1,scrollbarClass:"myScrollbar"})}});return l}),define("views/common/membership/membership-tab-thumb-composite-view",["talent","templates/common","$.scrollable","iScroll","$.tipsy"],function(a,b,c,d){var e=a.ItemView.extend({template:b["common/membership/membership-tab-thumb-item"],tagName:"li",templateHelpers:function(){var a="narrow"==this.mode?30:"team"==this.mode?30:50;return{imgSize:a}},initialize:function(a){this.mode=a.mode||"team"},onRender:function(){this.$el.attr("data-id",this.model.get("Id")),this.$el.find(".membership_thumb_img").tipsy({gravity:"e",fallback:this.model.get("Name")});var a=this.model.get("Type")?this.model.get("Type"):0;a&&this.$el.addClass("dotted_radius_parent")}}),f=a.ItemView.extend({template:a._.template('<div class="membership_empty_tips"><%= text  %></div>'),initialize:function(a){var a=a||{};this.templateHelpers=a}});return a.CompositeView.extend({className:"membership_thumb_container",template:b["common/membership/membership-tab-thumb-composite"],itemView:e,itemViewContainer:".membership_thumb_container",emptyView:f,events:{"click .membership_thumb_img":"changeActiveId","click .membership_fold":"changeMode"},initialize:function(){if(0==this.collection.models.length){var a="membership"==this.model.get("viewName")?"暂无下属":"暂无共享";this.itemViewOptions={text:a}}else this.itemViewOptions={mode:this.model.get("mode")}},onAfterItemAdded:function(a){var b=parseInt(this.model.get("activeId"));(b==parseInt(a.model.get("Id"))||b==parseInt(a.model.get("id")))&&a.$el.find("img").addClass("active")},changeMode:function(){this.trigger("change:mode","wide")},changeActiveId:function(b){var c=a.$(b.currentTarget),d=c.parents("li").attr("data-id");this.$el.find(".membership_thumb_img").removeClass("active"),c.addClass("active"),this.trigger("detailIdChanged",d)},onRender:function(){"share"==this.model.get("viewName")&&this.$el.addClass("membership_share_container"),"membership"==this.model.get("viewName")&&this.$el.find("li").first().after('<div class="membership_fold_container"><div class="membership_fold"><span class="membership_fold_arrow"></span>展开</div></div>')},onShow:function(){this.updateDimension();var b=this,c=a._.debounce(function(){b.updateDimension()},400);$(window).off("resize.membership_page"),$(window).on("resize.membership_page",c)},updateDimension:function(){var b=a.$("#header-region").outerHeight(),c=(a.$("#main-region").outerHeight(),a.$(window).height()-b),e=c-1-a.$(".membership_tab_top").outerHeight()-a.$(".membership_bottom").outerHeight(),f=this.$el.find("#membership_scroll_container");f.height(e);var g=this.getIsMobile();g?f.scrollable({setStyle:!0}):this.tabScroll=new d("membership_scroll_container",{hScrollbar:!1,scrollbarClass:"myScrollbar"})},getIsMobile:function(){for(var a=navigator.userAgent,b=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),c=!0,d=0;d<b.length;d++)if(a.indexOf(b[d])>0){c=!1;break}return c}})}),define("templates/plan",[],function(){return this.JST=this.JST||{},this.JST["plan/g-chart/back-content"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<a class="legendIntroduce" style="display:none;" href="javascript:void(0)">图例说明</a><a class="gantt_btn" href="#plan">\n	<span class="gantt_small_bt"></span>\n\n\n\n\n\n',"personal"==type&&(__p+='\n		<img src="'+(null==(__t=Small)?"":__t)+'" />'+(null==(__t=UserName)?"":__t)+"的"+(null==(__t=year)?"":__t)+"年",month&&(__p+=(null==(__t=month)?"":__t)+"月"),week&&(__p+=" "+(null==(__t=week)?"":__t)),__p+=(null==(__t=i18n.plan_1)?"":__t)+"\n"),__p+=" \n\n","group"==type&&(__p+='\n		<span class="groupText">团队的'+(null==(__t=year)?"":__t)+"年",month&&(__p+=(null==(__t=month)?"":__t)+"月"),__p+="\n			",week&&(__p+=null==(__t=week)?"":__t),__p+=(null==(__t=i18n.plan_1)?"":__t)+"</span>\n"),__p+=" \n\n</a>";return __p},this.JST["plan/g-chart/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="gannt_navBack"></div>\n<div class="_tt_loading_m">努力加载中…</div>\n<div class="gantt-main _tt_plan_container"></div>';return __p},this.JST["plan/histroy/histroy-list-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)ThisYear||(__p+='\n<div class="year_hylt"><span>以下为'+(null==(__t=Year)?"":__t)+"年操作历史</span></div>\n"),__p+="\n<ul>\n	",_.each(Data,function(a,b){__p+='\n		<li class="item_hylt ',Data.length==b+1&&(__p+="noborder"),__p+='">\n		',__p+="undefined"!=typeof a.Today&&a.Today?'\n			<span class="data_hylt">'+(null==(__t=a.Today)?"":__t)+"</span>\n		":'\n			<span class="data_hylt">'+(null==(__t=a.Month)?"":__t)+"月"+(null==(__t=a.Day)?"":__t)+"日</span>\n		",__p+="\n\n		","undefined"!=typeof a.PlanOperationModelsByUser&&a.PlanOperationModelsByUser?(__p+="\n				",_.each(a.PlanOperationModelsByUser,function(a){__p+="\n				<table>\n					<tr> \n						","undefined"!=typeof IsShowAvatar&&IsShowAvatar&&(__p+='\n						<td class="avatar_hylt">\n							<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'">\n\n								'+(null==(__t=_.convertImage({className:"",src:a.User.Avatar.Small,size:30,shape:"radius",name:a.User.Name,bgColor:a.User.Avatar.Color}))?"":__t)+"\n							</a>\n						</td>\n						"),__p+='\n						<td class="cont_hylt">\n							<ul>\n								',_.each(a.PlanOperationModels,function(b){__p+="\n									","1"==b.Source.TepId?(__p+='\n									<li>\n										<!--丹丹在 2013年12月第4周计划表中 添加了计划项 12月第四周的计划-->\n										<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n										<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>","undefined"!=typeof b.Source.PlanTableName&&b.Source.PlanTableName&&(__p+="在&nbsp;"+(null==(__t=b.Source.PlanTableName)?"":__t)+"&nbsp;中"),__p+="&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"\n									</li>\n									"):"2"==b.Source.TepId?(__p+='\n									<li>\n										<!--刚刚 在2013年12月第4周计划表中 中 设置了计划项 30号的计划 的截止时间为 2013年11月22日 23:00-->\n										<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n										<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>","undefined"!=typeof b.Source.PlanTableName&&b.Source.PlanTableName&&(__p+="在&nbsp;"+(null==(__t=b.Source.PlanTableName)?"":__t)+"中&nbsp;"),__p+="&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"&nbsp;"+(null==(__t=b.Source.Content2)?"":__t)+"\n									</li>\n									"):"3"==b.Source.TepId?__p+='\n										<li>\n											<!--丹丹 在2013年12月第4周计划表中 添加共享者 海海-->\n											<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n											<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>&nbsp;在"+(null==(__t=b.Source.PlanName)?"":__t)+"&nbsp;中&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+'&nbsp;<a href="/u/'+(null==(__t=b.Source.ToUserId)?"":__t)+'" title="" class="link_hylt">'+(null==(__t=b.Source.ToUserName)?"":__t)+"</a>\n										</li>\n									":"4"==b.Source.TepId?__p+='\n										<li>\n											<!--丹丹 在12月第四周的计划 中 在计划项 2013年12月第4周计划表 下分解出任务 123-->\n											<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n											<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>&nbsp;在"+(null==(__t=b.Source.PlanTableName)?"":__t)+"&nbsp;中&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"</a>&nbsp;"+(null==(__t=b.Source.Content2)?"":__t)+'&nbsp;<a href="'+(null==(__t=b.Source.TaskUrl)?"":__t)+'" title="" class="link_hylt" target="_blank">'+(null==(__t=b.Source.ObjName)?"":__t)+"</a>\n										</li>\n									":"5"==b.Source.TepId&&(__p+='www\n									<!--x 在xxx计划表中 通过任务xxx 生成了 计划项xxxx-->\n										<li>\n											<span class="hour_hylt">'+(null==(__t=b.Source.CreateDate)?"":__t)+'</span>\n											<a href="'+(null==(__t=a.User.HomeUrl)?"":__t)+'" title="" class="name_hylt">'+(null==(__t=a.User.Name)?"":__t)+"</a>&nbsp;在"+(null==(__t=b.Source.PlanTableName)?"":__t)+"&nbsp;中&nbsp;"+(null==(__t=b.Source.Content1)?"":__t)+'&nbsp;<a href="'+(null==(__t=b.Source.TaskUrl)?"":__t)+'" title="" class="link_hylt" target="_blank">'+(null==(__t=b.Source.ObjName)?"":__t)+"</a>&nbsp;"+(null==(__t=b.Source.Content2)?"":__t)+"&nbsp;"+(null==(__t=b.Source.PlanName)?"":__t)+"\n										</li>\n									"),__p+="\n								"}),__p+="\n							</ul>\n						</td>\n					</tr>\n				</table>\n				"}),__p+="\n			\n		"):(__p+='\n				<table>\n					<tr> \n						<td class="cont_hylt">\n							<ul>\n								',_.each(a.PlanOperationModels,function(a){__p+="\n								\n									","1"==a.Source.TepId?__p+='\n									<!--丹丹 添加了计划项 12月第四周的计划-->\n									<li>\n										<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n										<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"\n									</li>\n									":"2"==a.Source.TepId?__p+='\n									<!--刚刚  设置了计划项 30号的计划 的截止时间为 2013年11月22日 23:00-->\n									<li>\n										<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n										<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"&nbsp;"+(null==(__t=a.Source.Content2)?"":__t)+"\n									</li>\n									":"3"==a.Source.TepId?__p+='\n										<!--丹丹 添加共享者 海海-->\n										<li>\n											<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n											<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+'&nbsp;<a href="/u/'+(null==(__t=a.Source.ToUserId)?"":__t)+'" title="" class="link_hylt">'+(null==(__t=a.Source.ToUserName)?"":__t)+"</a>\n										</li>\n									":"4"==a.Source.TepId?__p+='\n										<!--XX 在计划项 XXX下分解出任务XXXX-->\n										<li>\n\n											<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n											<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"&nbsp;"+(null==(__t=a.Source.Content2)?"":__t)+'&nbsp;<a href="'+(null==(__t=a.Source.TaskUrl)?"":__t)+'" title="" class="link_hylt">'+(null==(__t=a.Source.ObjName)?"":__t)+"</a>\n										</li>\n									":"5"==a.Source.TepId&&(__p+='\n										<!--XX 通过任务XXX(objName)生成了计划项XXX-->\n										<li>\n											<span class="hour_hylt">'+(null==(__t=a.Source.CreateDate)?"":__t)+'</span>\n											<span class="nolink_name_hylt">'+(null==(__t=a.Source.UserName)?"":__t)+"</span>&nbsp;"+(null==(__t=a.Source.Content1)?"":__t)+'&nbsp;<a href="'+(null==(__t=a.Source.TaskUrl)?"":__t)+'" target="_blank" title="" class="link_hylt">'+(null==(__t=a.Source.ObjName)?"":__t)+"</a>&nbsp;"+(null==(__t=a.Source.Content2)?"":__t)+"&nbsp;"+(null==(__t=a.Source.PlanName)?"":__t)+"\n										</li>\n									"),__p+="\n								"}),__p+="\n							</ul>\n						</td>\n					</tr>\n				</table>\n			\n		"),__p+="\n		</li>\n	"}),__p+="\n</ul>\n\n\n";return __p},this.JST["plan/histroy/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="_tt_plan_histroy">\n	<div class="pagetitle"><h2>团队所有操作历史</h2></div>\n\n	<div class="_tt_plan_histroy_list">\n		<div class="_tt_loading_m">努力加载中…</div>\n	</div>\n</div>';return __p},this.JST["plan/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='\n	<!-- side sub nav -->\n	<div class="_tt_layout_tabnav tu-col-3" data-tu-submenu="tu-submenu">\n		<div data-name="side-bar-user-info" class="tt_side_subnav_userinfo"></div>\n		<div data-name="side-bar-nav"></div>\n	</div>\n	<!-- side sub nav end -->\n	<div class="_tt_layout_container  tu-col-13">\n		<div class="_tt_loading_m">努力加载中…</div>		\n	</div>\n	<div class="tt_plan_detail_container"></div>\n	';return __p},this.JST["plan/plan-list-data-nav"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<dl class="list">\r\n	',navData&&navData.length>0&&(__p+="\r\n		",_.each(navData,function(a,b){__p+='\r\n			<dd class="',0==b&&(__p+="noborder"),__p+='">\r\n			',__p+=routerData.isMySelf?'\r\n			<a data-trigger="false" href="#plan?type='+(null==(__t=routerData.type)?"":__t)+"&group_id="+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=routerData.tag_type)?"":__t)+"&tag_id="+(null==(__t=routerData.tag_id)?"":__t)+"&plan_table_id="+(null==(__t=a.PlanTableId)?"":__t)+'" >\r\n				'+(null==(__t=a.Name)?"":__t)+"\r\n			</a>\r\n			":'\r\n			<a data-trigger="false" href="#plan?type='+(null==(__t=routerData.type)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&group_id="+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=routerData.tag_type)?"":__t)+"&tag_id="+(null==(__t=routerData.tag_id)?"":__t)+"&plan_table_id="+(null==(__t=a.PlanTableId)?"":__t)+'">\r\n				'+(null==(__t=a.Name)?"":__t)+"\r\n			</a>\r\n			",__p+="\r\n			\r\n			</dd>\r\n		"}),__p+="\r\n	"),__p+="\r\n</dl>	\r\n";return __p},this.JST["plan/plan-list-empty"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="content">\r\n	',to_user_id!=loginUserId||"personal"!=type||isSearch?"group"!=type||isSearch?(__p+="\r\n		\r\n		","undefined"==typeof IsNotify||1!=IsNotify||isSearch?(__p+="\r\n			",__p+=isSearch?'\r\n				<span class="text">暂无数据</span>\r\n			':'\r\n				<span class="text">Ta还没有写'+(null==(__t=i18n.plan_1)?"":__t)+"</span>\r\n			",__p+="\r\n		"):__p+='\r\n		<span class="text">Ta还没有写'+(null==(__t=i18n.plan_1)?"":__t)+'，你可以</span>\r\n		<a user-id="'+(null==(__t=to_user_id)?"":__t)+'" href="javascript:void(0)" class="btnnotice btn btn-sure">正式通知Ta写'+(null==(__t=i18n.plan_1)?"":__t)+"</a>\r\n		",__p+="\r\n	"):__p+='\r\n		<span class="text">您的团队还没有发布自己的'+(null==(__t=i18n.plan_1)?"":__t)+"</span>\r\n	":__p+='\r\n\r\n		<span class="text">把'+(null==(__t=i18n.plan_1)?"":__t)+"写下来，你就已经成功了一半！</span>\r\n	",__p+="\r\n</div>";return __p},this.JST["plan/plan-list-feedback"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="loadfeed">\r\n	<div class="img_loadfed">\r\n		<span>tita努力加载中...</span>\r\n	</div>\r\n</div>\r\n\r\n';return __p},this.JST["plan/plan-list-layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='	<div class="_tt_plan_table"></div>\r\n	<div class="_tt_pagetab"></div>\r\n	<div data-name="plan-create-form"></div>\r\n	<div data-name="plan-data-filter">\r\n		<div class="_tt_loading_m">努力加载中…</div>\r\n	</div>\r\n	<div class="_tt_planlistcontanier">\r\n		<div class="_tt_loading_m">努力加载中…</div>\r\n	</div>\r\n	<div class="_tt_plan_tab_extra">\r\n		<ul class="tt_plan_feedback_histroy">\r\n			<li>\r\n				<a href="javascript:void(0);" data-trigger="false" type="feedBack">评价沟通</a>\r\n			</li>\r\n			<li><a href="javascript:void(0);" data-trigger="false" type="daily">工作总结</a></li>\r\n			<li><a href="javascript:void(0);" data-trigger="false" type="histroy">操作历史</a></li>\r\n		</ul>\r\n		<div class="_tt_feedback"></div>\r\n		<div class="tt_plan_tab_daily"></div>\r\n		<div class="_tt_tab_histroy"></div>\r\n	</div>\r\n	<div data-name="share-range"></div>\r\n<!--plan end-->';return __p},this.JST["plan/plan-list-sidebar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_side_subnav_wrap">\r\n	',"personal"==routerData.type&&(__p+='\r\n		<div class="subtab_ssw">\r\n			',isShowPlan&&(__p+='\r\n			<li class="active"><a href="#plan?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+'" title=""><span>'+(null==(__t=i18n.plan_1)?"":__t)+"</span></a></li>\r\n			"),__p+="\r\n			",IsUsePlanDaily&&(__p+='\r\n			<li><a href="#daily?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+'" title=""><span>总结</span></a></li>\r\n			'),__p+="\r\n			\r\n		</div>\r\n	"),__p+='\r\n	<div class="year_ssw" data-name="year-list">\r\n		<a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown"><span>'+(null==(__t=current_year)?"":__t)+'</span><b class="caret"></b></a>\r\n		<ul class="dropdown_ssw">\r\n			',_.each(groupDatas,function(a){__p+='\r\n				<li><a href="#plan?group_id='+(null==(__t=a.GroupId)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+'" title="" groupid="'+(null==(__t=a.GroupId)?"":__t)+'">'+(null==(__t=a.GroupName)?"":__t)+"</a></li>\r\n			"}),__p+='\r\n		</ul>\r\n	</div>\r\n	\r\n	<ul class="_tt_side_subnav">			\r\n		',_.each(navData,function(a){__p+="\r\n				",routerData.isMySelf||"personal"!=routerData.type?routerData.isMySelf&&"personal"==routerData.type?__p+='\r\n					<li>\r\n					<a data-trigger="false" href="#plan?group_id='+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=a.TagType)?"":__t)+"&tag_id="+(null==(__t=a.TagId)?"":__t)+'">'+(null==(__t=a.TagName)?"":__t)+"</a>	\r\n					</li>\r\n				":"group"==routerData.type&&(__p+='\r\n					<li>\r\n					<a data-trigger="false" href="#plan?type=group&group_id='+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=a.TagType)?"":__t)+"&tag_id="+(null==(__t=a.TagId)?"":__t)+'">'+(null==(__t=a.TagName)?"":__t)+"</a>	\r\n					</li>\r\n				"):__p+='\r\n				<li>\r\n					<a data-trigger="false" href="#plan?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+"&group_id="+(null==(__t=routerData.group_id)?"":__t)+"&tag_type="+(null==(__t=a.TagType)?"":__t)+"&tag_id="+(null==(__t=a.TagId)?"":__t)+'">'+(null==(__t=a.TagName)?"":__t)+"</a>			\r\n				</li>\r\n				",__p+="	\r\n		"}),__p+="\r\n	</ul>\r\n</div>";return __p},this.JST["plan/plan-notice/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="userwho"></div>\r\n<div class="sendbox"></div>\r\n';return __p},this.JST["plan/plan-notice/sent-box"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="mailtemplate">\r\n	',__p+=IsSendMail?'\r\n	<div class="input-default">\r\n		<textarea name="" rows="" cols="">'+(null==(__t=MailContent)?"":__t)+"</textarea>\r\n	</div>\r\n	":'\r\n	<div class="input-default input-disable">\r\n		<textarea name="" rows="" cols="" disabled="true">'+(null==(__t=MailContent)?"":__t)+"</textarea>\r\n	</div>\r\n	",__p+='\r\n	<ul class="settype">\r\n		<li>\r\n			<a href="javascript:void(0);" class="disabel_check_st"><span class="ico"></span></a>\r\n			<strong>系统通知</strong><span>（内容为系统自动生成）</span>\r\n		</li>\r\n		<li>\r\n			',__p+=IsSendMail?'\r\n			<a href="javascript:void(0);" class="check_st check_check_st"><span class="ico"></span></a>\r\n			':'\r\n			<a href="javascript:void(0);" class="check_st"><span class="ico"></span></a>\r\n			',__p+='\r\n			<strong>正式邮件通知</strong><span>（内容需自行编辑）</span>\r\n		</li>\r\n	</ul>\r\n	<div class="senderwrap">\r\n		<ul class="copytoself">\r\n			',IsSendMail?(__p+="\r\n				",__p+=IsCopySelf?'\r\n				<li><a class="checkbox checkbox-checked" href="javascript:void(0);"><span class="ico"></span></a>\r\n				<span>同时抄送我自己</span></li>\r\n				':'\r\n				<li><a class="checkbox" href="javascript:void(0);"><span class="ico"></span></a>\r\n				<span>同时抄送我自己</span></li>\r\n				',__p+="\r\n			"):__p+='\r\n				<li><a class="disabel_check_st" href="javascript:void(0);"><span class="ico"></span></a>\r\n				<span>同时抄送我自己</span></li>\r\n			',__p+="\r\n		</div>\r\n	</div>\r\n</div>";return __p},this.JST["plan/plan-notice/user-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+=(null==(__t=_.convertImage({className:"avatar_uw",src:UserAvatar.Small,size:30,shape:"radius",name:Name,bgColor:UserAvatar.Color}))?"":__t)+'\r\n\r\n<a href="javascript:void(0);" class="select_uw"><span class="ico"></span></a>\r\n';return __p},this.JST["plan/plan-notice/user-list"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="title_uw">通知对象：</div>\r\n<ul class="list_uw"></ul>';return __p},this.JST["plan/plan-sidebar-top"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)"personal"==routerData.type?(__p+='\n<div class="_tt_selectyearplan">\n	<a href="#italent/home?appid=1&apptype=1&name=TalentProfile-record&to_user_id='+(null==(__t=user.Id)?"":__t)+'" class="avatar_ttsyp" title="'+(null==(__t=user.Name)?"":__t)+'">\n		',__p+="undefined"!=typeof user.UserAvatar&&user.UserAvatar.HasAvatar===!1?"\n			"+(null==(__t=_.convertImage({className:"",src:"qqq",size:50,shape:"radius",name:user.Name,bgColor:user.UserAvatar.Color}))?"":__t)+"\n		":'\n			<img class="radius_img50" src="'+(null==(__t=user.UserAvatar.Medium)?"":__t)+'" width="50" height="50">\n		',__p+='\n	</a>\n	<div class="wrap">  \n		<a class="name_ttsyp" href="#italent/home?appid=1&apptype=1&name=TalentProfile-record&to_user_id='+(null==(__t=user.Id)?"":__t)+'">'+(null==(__t=user.Name)?"":__t)+'</a>\n		<span class="department_ttsyp">'+(null==(__t=user.Department)?"":__t)+"</span>\n		\n    </div>	\n</div>\n"):__p+='\n<div class="tt_side_subnav_group">\n	<span class="ico_ssg"></span>\n	<div class="text_ssg">'+(null==(__t=team_name)?"":__t)+"</div>\n</div>\n";return __p},this.JST["plan/table/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tt_plan_table_container">\r\n	<div class="tt_plan_table_tab">\r\n	\r\n		<div class="_tt_plan_table_btn">\r\n			',14!=tag_id&&(__p+='\r\n			<a href="javascript:void(0)" class="btn" data-name="enter-group">\r\n				',__p+="group"==type?"\r\n					我的"+(null==(__t=i18n.plan_1)?"":__t)+"\r\n				":"\r\n					团队"+(null==(__t=i18n.plan_1)?"":__t)+"\r\n				",__p+='\r\n			</a>\r\n			<a href="#" class="btn gantt_btn">甘特图</a>\r\n			<a href="javascript:void(0)" class="btn btnnoticesuperior">提醒上级查看</a>\r\n			'),__p+='\r\n			<div class="tt_plan_table_btn_right">\r\n				',14!=tag_id&&(__p+='\r\n				<a href="javascript:void(0);" class="btn media_ptbr" data-name="level-view">隔级查看</a>\r\n				',IsUsePlanDaily&&(__p+='\r\n					<a href="#daily?type=group" class="btn media_ptbr">团队日报</a>\r\n				'),__p+='\r\n				<a href="#set?page_id=plan" class="btn media_ptbr">设置团队成员</a>\r\n				<a href="javascript:void(0)" data-trigger="false" class="btn media_ptbr" data-name="up-set">上级规定</a>\r\n				'),__p+='\r\n				<a href="javascript:void(0);" class="btn btnMore">更多<span class="icon-arrow-down-2t"></span></a>\r\n\r\n				<ul class="dropdown_ptbr" data-name="more-drop-down-box">\r\n					<li class="media_ptbr"><a href="javascript:void(0);" data-name="level-view">隔级查看</a></li>\r\n					',IsUsePlanDaily&&(__p+='\r\n						<li class="media_ptbr">\r\n							<a href="#daily?type=group" data-name="enter-group">团队日报</a>\r\n						</li>\r\n					'),__p+='\r\n					\r\n					<li class="media_ptbr"><a href="#set?page_id=plan">设置团队成员</a></li>\r\n					<li class="media_ptbr"><a href="javascript:void(0)" data-name="up-set" data-trigger="false">上级规定</a></li>\r\n					<li data-name="approval-group" class="disabled">\r\n						<a href="javascript:void(0)" data-name="enter-apply">团队'+(null==(__t=i18n.plan_1)?"":__t)+'审批</a>\r\n					</li>\r\n					<li data-type="notice" class="disabled">\r\n						<a href="javascript:void(0);">通知团队写'+(null==(__t=i18n.plan_1)?"":__t)+'</a>\r\n					</li>\r\n					<li data-type="history">\r\n						<a href="#plan/histroy">查看团队所有操作历史<span class="indicator" style="display: none;"></span></a>\r\n					</li>\r\n					<li><a href="'+(null==(__t=printUrl)?"":__t)+'" target="_blank" class="btnPrint">打印与导出</a></li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="tt_plan_table_list_container">\r\n		\r\n	</div>\r\n</div>\r\n\r\n';return __p},this.JST}),define("views/plan/plan-notice/send-view",["talent","templates/plan"],function(a,b){return a.CompositeView.extend({template:b["plan/plan-notice/sent-box"],ui:{inpuCheck:"a.check_st",textarea:".input-default",copyCheck:"a.checkbox"},events:function(){var a={};return a["click "+this.ui.inpuCheck]="_toggelTab",a["click "+this.ui.copyCheck]="onCopyCheck",a},initialize:function(){this.model.set("IsSendMail",!0),this.model.set("IsCopySelf",!0),this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1},modelEvents:{change:"render"},templateHelpers:function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=new Date(a.getTime()+6048e5),f=e.getMonth()+1,g=e.getDate();return{MailContent:this.model.get("MailContent")||"各位：\n请尽快在tita上填写你的"+this.iPlan+",最晚于"+f+"月"+g+"号提交。",RecipientName:this.model.get("RecipientName")||"",SenderName:this.model.get("SenderName")||"",SendTime:this.model.get("SendTime")||b+"年"+c+"月"+d+"日"}},_toggelTab:function(){this.model.get("IsSendMail")?this.model.set("IsSendMail",!1):this.model.set("IsSendMail",!0)},onCopyCheck:function(){this.model.get("IsCopySelf")?this.model.set("IsCopySelf",!1):this.model.set("IsCopySelf",!0)},getCotent:function(){if(this.model.get("IsSendMail")){var b=a.$(this.ui.textarea).find("textarea").val();return b=b.replace(/[\n\r]/g,"</br>")}return""},reset:function(){this.model.set("IsSendMail",!0),this.model.set("IsCopySelf",!0)}})}),define("views/plan/plan-notice/user-item-view",["talent","templates/plan","$.tipsy"],function(a,b){return a.ItemView.extend({tagName:"li",template:b["plan/plan-notice/user-item"],initialize:function(){this.isDisableSelect=this.options.isDisableSelect||!1},onRender:function(){this.isDisableSelect&&a.$(this.el).addClass("disable"),this.model.get("IsActive")?a.$(this.el).addClass("active"):a.$(this.el).removeClass("active"),a.$(this.el).attr("Id",this.model.get("Id")),$(".tipsy").hide(),a.$(this.el).find(".avatar_uw").tipsy({gravity:"s"})},onClose:function(){$(".tipsy").hide()}})}),define("views/plan/plan-notice/user-composite-view",["talent","templates/plan","views/plan/plan-notice/user-item-view","tdialog"],function(a,b,c,d){return a.CompositeView.extend({template:b["plan/plan-notice/user-list"],itemViewContainer:"ul",itemView:c,ui:{item:"li"},events:function(){var a={};return a["click "+this.ui.item]="_selectUser",a["mouseenter "+this.ui.item]="_hoverUser",a["mouseleave "+this.ui.item]="_hoverUser",a},collectionEvents:{change:"render"},initialize:function(){this.userListData=[]},request:function(){{var b=this;a.app.request("UserSubordinate:getSubordinate",{level:2}).done(function(a){b.userListData=a,b.collection.reset(b.addAttr(a))})}},returnUserIds:function(){var b=[];return a._.filter(this.collection.toJSON(),function(c){if(c.IsActive){var d=a._.pick(c,"Id");b.push(a._.values(d))}}),b.join(",")},_selectUser:function(b){var c=this;if(this.model.get("isDisableSelect"))return!0;var e=a.$(b.currentTarget),f=e.index(),g=this.collection.at(f);c.selectUserTipView&&c.selectUserTipView.$el.remove();var h=a._.filter(this.collection.toJSON(),function(a){return a.IsActive?a.IsActive:void 0});return h.length<=1&&g.get("IsActive")?(this.selectUserTipView=new d({fixed:!1,type:"modal",cancel:!1,sure:!1,zindex:1001}),this.selectUserTipView.render().$el.appendTo("body"),this.selectUserTipView.show(e,'<div class="innerhtml_dialog">请至少选择一个通知对象</div>',{arrow:!1,pos:"bottomCenter"}),void setTimeout(function(){c.selectUserTipView.$el.remove()},3e3)):void(g.get("IsActive")?g.set("IsActive",!1):g.set("IsActive",!0))},_hoverUser:function(b){var c=a.$(b.currentTarget);c.toggleClass("hover")},addAttr:function(a){for(var b=0;b<a.length;b++)a[b].IsActive=!0;
return a},reset:function(){this.collection.reset(this.addAttr(this.userListData))},itemViewOptions:function(){var a=this.model.get("isDisableSelect")||!1;return{isDisableSelect:a}}})}),define("views/plan/plan-notice/index-page-view",["talent","templates/common","views/plan/plan-notice/send-view","views/plan/plan-notice/user-composite-view"],function(a,b,c,d){var e=a.Layout.extend({tagName:"div",className:"noticemessage",template:b["plan/plan-notice/index-page"],regions:{userList:".userwho",sendbox:".sendbox"},initialize:function(){var b=this;this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1,this.userIds=[],this.isShowUserList=0==this.options.isShowUserList?!1:!0,this.isToSubordinate=1==this.options.isToSubordinate?!0:!1,this.isToSuperior=1==this.options.isToSuperior?!0:!1,this.superiorUser=this.options.superiorUser&&this.options.superiorUser!={}?this.options.superiorUser:{},this.routerData=this.options.routerData||[],this.loginUser=a.Context.getUserInfo();var e=this.routerData.tag_id,f=this.routerData.startDate||"",g="";g=e&&e>1?e-1+"月":a._.substring(f,6),this.sendView=new c,this.userCompositeView=new d;a.app.request("UserSubordinate:getSubordinate",{level:2}).done(function(c){if(b.isToSuperior)var d=b.superiorUser;else if(b.isToSubordinate)var d=a._.filter(c,function(a){return a.Id==b.routerData.to_user_id});var e=new Date,f=e.getFullYear(),h=e.getMonth()+1,i=e.getDate(),j=new Date(e.getTime()+6048e5),k=(j.getMonth()+1,j.getDate(),"各位");if(b.isToSuperior){k=d[0].Name;var l="你好，我已填好"+g+b.routerData.plan_table_name+b.iPlan+"，请查阅。"}else{b.isToSubordinate&&(k=d[0].Name);var l="请及时交付"+g+b.routerData.plan_table_name+b.iPlan+"，务必严格执行。\n制定"+b.iPlan+"时请遵循以下几点：\n1.要具体、可达、可衡量，突出重点，详情中可以描述目标与措施。\n2.有未完成的，可酌情纳入本期"+b.iPlan+"。"}if(b.sendView.model.set("MailContent",l),b.sendView.model.set("RecipientName",k),b.sendView.model.set("SenderName",b.loginUser.Name),b.sendView.model.set("SendTime",f+"年"+h+"月"+i+"日"),b.isToSubordinate||b.isToSuperior){var m=b.userCompositeView.addAttr(d);b.userCompositeView.model.set("isDisableSelect",!0)}else var m=b.userCompositeView.addAttr(c);b.userCompositeView.collection.reset(m)});this.$el.bind("click",function(a){a.stopPropagation()})},onRender:function(){this.isShowUserList?this.userList.show(this.userCompositeView):this.$el.find(this.regions.userList).hide(),this.sendbox.show(this.sendView)},setuserIds:function(a){this.userIds=a},getUserIds:function(){if(!this.isShowUserList)return this.userIds;var a=this.userCompositeView.returnUserIds(),b=this.sendView.model.get("IsCopySelf")&&this.sendView.model.get("IsSendMail")?!0:!1;return b&&(a=a+","+this.loginUser.Id),a},getMailCont:function(){return this.sendView.getCotent()},getMailSender:function(){return this.loginUser.Name},reset:function(){this.sendView.reset(),this.userCompositeView.reset()}});return e}),define("views/common/membership/membership-tab-operate-view",["talent","templates/common","tdialog","views/plan/plan-notice/index-page-view","$.tipsy"],function(a,b,c,d){var e=a.ItemView.extend({tagName:"li",template:a._.template(['<% if(href != "") {%>',"	<a href=<%= href %>><%= name %></a>","<% } else { %>",'	<a href="javascript:void(0)"><%= name %></a>',"<% } %>"].join("")),initialize:function(){},onRender:function(){"history"==this.model.get("type")&&this.$el.find("a").append('<span class="indicator"></span>'),this.$el.attr("data-type",this.model.get("type"))}});return a.CompositeView.extend({template:b["common/membership/membership-tab-operate"],itemView:e,itemViewContainer:".menu-list",defaults:function(){return{data:[{name:"设置团队成员",href:"#set?page_id=plan",type:"set"},{name:"查看团队日报",href:"#daily?type=group",type:"daily-group"},{name:"通知大家写"+this.iPlan,href:"",type:"notice"},{name:"查看团队所有操作历史",href:"#plan/histroy",type:"history"}]}},events:{"click .membership_bottom_btn":"afterShowDropDownClick","mouseenter .membership_bottom_btn":"overShowDropDownClick","mouseleave .membership_bottom_btn":"leaveShowDropDownClick","click li[data-type=notice]":"renderNoticeDialogView","click li[data-type=daily-group]":"_dailyGroupClick"},modelEvents:{},initialize:function(){this.i18n=a.Context.getI18n(),this.iPlan=this.i18n.plan_1;var b=this.defaults();this.collection=new a.Collection(b.data)},changeMode:function(a){this.$el.find(".membership_bottom").removeClass("short"),this.$el.find(".membership_bottom_btn").tipsy("disable"),"wide"!=a&&(this.$el.find(".membership_bottom_btn").tipsy({gravity:"se",fallback:"团队操作"}),this.$el.find(".membership_bottom").addClass("short"))},onShow:function(){this.getHistroyIndicator();var b=this;a.$("body").off("click.membership_drop"),a.$("body").on("click.membership_drop",function(){b.$el.find(".dropdown-menu").hide(),b.$el.find(".membership_bottom_btn .indicator_all").show(),b.noticeDialogView&&b.noticeDialogView.$el.hide()})},afterShowDropDownClick:function(b){var c=this;b.stopPropagation();var d=a.$(b.currentTarget);a.app.request("Membership:getSubordinateData",{}).done(function(b){var e=a.Context.getUserInfo().Id;!b||!b.length||1==b.length&&b[0].Id==e?c.$el.find("li[data-type=notice]").addClass("disable"):c.$el.find("li[data-type=notice]").removeClass("disable"),d.find(".indicator_all").hide(),d.find(".dropdown-menu").show()})},overShowDropDownClick:function(b){var c=a.$(b.currentTarget);c.addClass("hover")},leaveShowDropDownClick:function(b){var c=a.$(b.currentTarget);c.removeClass("hover")},_dailyGroupClick:function(){var a=this;setTimeout(function(){a.$el.find(".dropdown-menu").hide()},300)},renderNoticeDialogView:function(b){b.stopPropagation();var e=a.$(b.currentTarget);if(!e.hasClass("disable")){this.$el.find(".dropdown-menu").hide();var f=this;this.noticeViewStatus=!0,this.planNoticeIndexPageView=new d({isShowUserList:!0,isToSubordinate:!1,routerData:this.model.get("routerData")});var g=this.planNoticeIndexPageView.render().el;this.noticeDialogView=new c({fixed:!0,type:"modal",sure:function(){f.sendNotce()},cancel:function(){f.planNoticeIndexPageView.close(),f.noticeDialogView.$el.remove()}}),this.noticeDialogView.render().$el.appendTo("body");var h=this.$el.find(".membership_bottom_btn").offset().top-$(document).scrollTop();this.noticeDialogView.show(this.$el.find(".membership_bottom_btn"),g,{arrow:!1,pos:"leftBottom",height:487,arrowBias:-2,domOffTop:h})}},sendNotce:function(){var b=this.model.get("routerData"),c=this,d=this.planNoticeIndexPageView.getUserIds(),e={GroupId:b.group_id,TagId:b.tag_id,PlanTableId:b.plan_table_id,MessageType:12,UserIds:d},f=this.planNoticeIndexPageView.getMailCont(),g="";b.tag_id>1&&(g=b.tag_id-1+"月"),f&&(e.EmailContent=f),e.MessageContent="通知你写计划&nbsp;"+g+b.plan_table_name;a.app.request("PlanCommmon:postSendNotice",e).done(function(){c.planNoticeIndexPageView.close(),c.noticeDialogView.hide(),c.showMsgDialog("通知已发送",c.$el.find(".membership_bottom"))}).fail(function(){c.planNoticeIndexPageView.close(),c.noticeDialogView.hide(),c.showMsgDialog(msg,c.$el.find(".membership_bottom"))})},showMsgDialog:function(a,b){this.dialogView=new c({fixed:!0,type:"tipsy",pos:"leftCenter",sure:!1,cancel:!1,arrow:!1});var d=this;this.dialogView.render().$el.appendTo("body"),this.dialogView.show(b,a,{arrow:1,pos:"leftBottom",arrowBias:-15,topBias:0,className:"success"}),setTimeout(function(){d.dialogView.$el.remove()},3e3)},getHistroyIndicator:function(){var b=this,c=b.$el.find(".indicator");a.app.request("Indicator:getPlanOperationData",{}).done(function(a){return!a||0==a||0>a?void c.hide():void c.show().html(a)})},onClose:function(){a.$("body").off("click.membership_drop"),a.$(".tipsy").remove(),this.dialogView&&this.dialogView.$el&&this.dialogView.$el.remove()}})}),define("views/common/membership/membership-tab-component",["talent","templates/common","views/common/membership/membership-tab-layout","views/common/membership/membership-tab-thumb-composite-view","views/common/membership/membership-tab-operate-view","$.tipsy"],function(a,b,c,d,e){return a.Layout.extend({defaults:{bottomView:"new bottomView()",showShare:!0,type:0},template:b["common/membership/membership-tab-component"],regions:{tabRegion:{selector:"#membership_tab"},operate:"#membership_bottom_container"},ui:{arrow:".membership_arrow_icon",arrowBtn:".membership_arrow",tab:".membership_tab_title",tabLi:".membership_tab_title li"},events:function(){var a={};return a["click "+this.ui.arrowBtn]="afterArrowClick",a["click "+this.ui.tabLi]="afterTabClick",a},modelEvents:{"change:mode":"afterViewModeChange","change:viewName":"afterViewNameChange"},initialize:function(b){var c=this;this.setting=a._.extend({},this.defaults,b);var d=a.app.request("history:getQueryObject");d.done(function(d){c.routerData=d;var f={mode:"narrow",viewName:"membership",showBottom:!1,showTab:!1,bottomView:new e};c.bottomView=b&&b.bottomView||new e;var g=a.$.extend({},f,b);"undefined"!=typeof c.routerData.viewName&&c.routerData.viewName&&(g.viewName=c.routerData.viewName),c.model=new a.Model(g),c.userInfo=a.Context.getUserInfo(),c.userInfo.MidAvatar=c.userInfo.Avatar.replace("_s","_m"),c.options.model&&c.listenTo(c.options.model,"change:viewName",function(){var a=c.options.model.get("viewName");c.model.set("viewName",a),c.$el.find(".membership_tab_title li").removeClass("active"),c.$el.find("li[data-name="+a+"]").addClass("active")})})},onRender:function(){var b=this;a.app.vent.off("membership:show:wide"),a.app.vent.on("membership:show:wide",function(){b.model.set("mode","wide")}),0==this.model.get("showTab")&&this.$el.find(".membership_tab_top").remove(),this.$el.find(".membership_tab_title li span").tipsy({gravity:"se"}),this.ui.arrowBtn.tipsy({title:function(){return"wide"==b.model.get("mode")?"收起隔级查看":"展开隔级查看"},gravity:"e"}),this.afterViewModeChange(!0)},getActiveId:function(){var b=this,c=new a.$.Deferred,d=a.app.request("history:getQueryObject");return d.done(function(d){b.activeId=d.to_user_id?d.to_user_id:a.Context.getUserInfo().Id,c.resolve(b.activeId)}),c.promise()},renderMembershipView:function(){"wide"==this.model.get("mode")?this.renderMembershipTabView():this.renderMembershipTabThumbView(),this.renderBottomOperateView()},renderBottomOperateView:function(){"membership"==this.model.get("viewName")&&1==this.model.get("showBottom")?(this.operate.show(this.bottomView),this.bottomView.changeMode&&this.bottomView.changeMode(this.model.get("mode"))):this.operate&&this.operate.close()},renderMembershipTabThumbView:function(){var b=this;this.getActiveId().done(function(c){var e=a.Context.getUserInfo().Id,f=a.app.request("Membership:getSubordinateData",{id:e,type:b.setting.type});f.done(function(e){var f=(e[0],e);f=1==f.length?[]:f,this.subordinate=f;var g=new d({collection:new a.Collection(f),model:new a.Model({activeId:c,viewName:"membership"})});g.on("change:mode",function(a){b.model.set("mode",a)}),b.tabRegion&&b.tabRegion.show(g),b.bindEvents(g)})})},renderMembershipTabView:function(){var b=this,d=a.Context.getUserInfo().Id;this.getActiveId().done(function(e){b.membershipTabLayout?(d==e&&b.membershipTabLayout.model.set({middleId:e,direction:"down",activeId:e,profileId:e,type:b.setting.type}),b.tabRegion.show(b.membershipTabLayout)):(b.membershipTabLayout=new c({model:new a.Model({middleId:e,direction:"down",activeId:e,profileId:e,type:b.setting.type})}),b.tabRegion.show(b.membershipTabLayout),b.bindEvents(b.membershipTabLayout))})},renderShareView:function(){var b=this;this.getActiveId().done(function(c){a.app.request("Plan:getShareWidthMeData",{}).done(function(a){var d=a;b.afterRenderShareView(c,d)})})},afterRenderShareView:function(b,c){var e=this.model.get("mode");c=c&&c.length?c:[];var f=new d({collection:new a.Collection(c),model:new a.Model({activeId:b,viewName:"share",mode:e})});this.tabRegion.show(f),this.bindEvents(f)},renderNarrowViewByData:function(){var b=this;this.$el.find(".membership_tab_title li span").tipsy("enable"),this.ui.arrow.removeClass("membership_arrow_right").addClass("membership_arrow_left"),this.$el.find(".membership_right").addClass("short"),this.$el.find(".membership_tab_title").fadeIn("fast"),this.getActiveId().done(function(c){a.app.request("Plan:getShareWidthMeData",{}).done(function(e){var f=e||[];a.app.request("Membership:getSubordinateData",{id:c}).done(function(e){b.renderBottomOperateView();var g=(e[0]&&e[0].subordinate,e),h="membership",i=g.length&&1!=g.length?g:[];(1==g.length||0==g.length)&&f.length&&(h="share",i=f);var j=new d({collection:new a.Collection(i),model:new a.Model({activeId:c,viewName:h})});b.tabRegion.show(j),b.bindEvents(j),b.model.set("viewName",h,{silent:!0}),"share"==h?(b.ui.tab.find(".active").removeClass("active"),b.ui.tab.find("li[data-name=share]").addClass("active")):(b.ui.tab.find(".active").removeClass("active"),b.ui.tab.find("li[data-name=membership]").addClass("active"))})})})},afterArrowClick:function(){var a="wide"==this.model.get("mode")?"narrow":"wide";this.model.set("mode",a)},afterViewModeChange:function(){this.tabRegion.close();{var a=this,b=this.model.get("mode");this.model.get("showTab")}"wide"==b?(this.$el.find(".membership_icon_st").tipsy("disable"),this.$el.find(".membership_icon_share").tipsy("disable"),this.ui.arrow.removeClass("membership_arrow_left").addClass("membership_arrow_right"),this.$el.find(".membership_right").removeClass("short"),this.$el.find(".membership_tab_title").removeClass("short").fadeIn("fast"),this.$el.find(".membership_right").animate({width:278},300,function(){a.afterViewNameChange()})):(this.$el.find(".membership_tab_title li span").tipsy("enable"),this.ui.arrow.removeClass("membership_arrow_right").addClass("membership_arrow_left"),this.$el.find(".membership_right").addClass("short"),this.$el.find(".membership_tab_title").fadeIn("fast"),this.$el.find(".membership_right").animate({width:65},300,function(){a.afterViewNameChange()}))},afterTabClick:function(b){a.$(".tipsy").remove();var c=a.$(b.currentTarget);if(!c.hasClass("active")){var d=c.attr("data-name");this.model.set("viewName",d),this.ui.tab.find(".active").removeClass("active"),c.addClass("active");var e=decodeURIComponent(location.hash);a.app.execute("history:navigate",e,!1)}},afterViewNameChange:function(){"membership"==this.model.get("viewName")?this.renderMembershipView():(this.renderShareView(),this.operate.close()),this.$el.find(".membership_tab_title li").removeClass("active"),this.$el.find("li[data-name="+this.model.get("viewName")+"]").addClass("active")},changeRoute:function(a){var b=this.model.get("viewName");return"share"==b?void this.changeShareRoute(a):void this.changeGroupRoute(a)},changeShareRoute:function(b){var c,d=decodeURIComponent(location.hash);c=d.indexOf("?")>0?d.split("?")[0]:d,d=c+"?to_user_id="+b+"&viewName=share",a.app.execute("history:navigate",d,!0)},changeGroupRoute:function(b){var c=decodeURIComponent(location.hash),d="to_user_id="+b;-1!=c.indexOf("to_user_id")?c=c.replace(/to_user_id=\w+/,d):c+=c.indexOf("?")<0?"?to_user_id="+b:"&to_user_id="+b,a.app.execute("history:navigate",c,!0)},routerDataChange:function(){this.ui.arrow.hasClass("membership_arrow_left")&&this.renderMembershipTabThumbView()},bindEvents:function(a){var b=this;a.off("detailIdChanged"),a.on("detailIdChanged",function(a){b.changeRoute(a)})},templateHelpers:function(){return{showShare:this.setting.showShare}},onClose:function(){a.app.vent.off("membership:show:wide")}})}),define("views/common/error-layout-message-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/error-layout-message"],defaults:{content:"暂时没有查看权限",subContent:"",isShowClose:!0},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),a.$(window).on("resize.planDetailLayout",function(){b.setPosition()})},ui:{close:".close_pdtb"},events:function(){var a={};return a["click "+this.ui.close]="onCloseHandler",a},templateHelpers:function(){return{content:this.settings.content,subContent:this.settings.subContent||"",isShowClose:this.settings.isShowClose}},onCloseHandler:function(){this.trigger("errorLayoutMessageView:close")},onRender:function(){this.setPosition()},setPosition:function(){{var b=a.$(window).height(),c=a.$("._tt_header").outerHeight();a.$(document).scrollTop()}a.$(this.el).css({height:b-c}),this.$el.css({height:b-c,"overflow-y":"scroll"})}})}),define("views/work/statistics-view",["talent","templates/work","views/common/empty-view","moment","momentZH","$.tipsy"],function(a,b,c,d){return a.ItemView.extend({template:b["work/statistics"],className:"statistics",ui:{taskChart:"div[data-name=task-chart]",personChart:"div[data-name=person-chart]"},templateHelpers:function(){var a=d().format("YYYY/MM/DD"),b=this.model.get("Pandect");if(b){b.DoneTotal=b.DoneExpired+b.DoneOnTime,b.UndoneTotal=b.UndoneExpired+b.UndoneOnTime;var c=b.DoneTotal/b.TaskTotal*100;c.toString().indexOf(".")&&(c=c.toFixed(1)),b.CompletionRate=c}return{Pandect:b,date:a,IsEmpty:b?!0:!1}},initialize:function(){},onRender:function(){var b=this.model.get("Pandect");if(!b){var d=a.Context.getStaticUrl("images/project/statistics_empty.jpg"),e=this.model.get("routerData"),f="#work?work_id="+this.model.get("WorkId")+"&to_user_id="+e.to_user_id+"&detail_type=task",f=decodeURIComponent(location.hash).replace(/(&detail_type=\w+)/,"&detail_type=task"),g=new c({emptyContext:'如果成员发布了任务，将呈现如下统计图表<br/>现在就去&nbsp;&nbsp;<a data-trigger ="fasle" href="'+f+'">派任务</a><br/><br/><image src="'+d+'"'});return void this.$el.html(g.render().el)}var h=this;require(["highCharts"],function(){h._showTaskProgressChart(),h._showPersonChart()}),this.$el.find("[original-title]").tipsy({gravity:"s"})},onClose:function(){$(".tipsy").remove()},_showTaskProgressChart:function(){var a=this.model.get("Pandect"),b=[];0!=a.UndoneExpired&&b.push({name:"未完成（延期）",color:"#ff7777",y:a.UndoneExpired}),0!=a.UndoneOnTime&&b.push({name:"未完成（当前）",color:"#99c8f2",y:a.UndoneOnTime}),0!=a.DoneExpired&&b.push({name:"已完成（延期）",color:"#ff9662",y:a.DoneExpired}),0!=a.DoneOnTime&&b.push({name:"已完成（按期）",color:"#58c583",y:a.DoneOnTime});var c=[{y:a.UndoneExpired+a.UndoneOnTime,color:"#fff",drilldown:{name:"",categories:["未完成（延期）","未完成（按期）"],data:[a.UndoneExpired,a.UndoneOnTime]}},{y:a.DoneExpired+a.DoneOnTime,color:"#eee",drilldown:{name:"",categories:["已完成（延期）","已完成（按期）"],data:[a.DoneExpired,a.DoneOnTime]}}];this.ui.taskChart.highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,height:280,type:"pie"},title:{text:""},tooltip:{enabled:!1},plotOptions:{pie:{allowPointSelect:!1,cursor:"pointer",shadow:!1,innerSize:"0%",center:["50%","50%"]}},series:[{name:"",size:"60%",data:c,dataLabels:{enabled:!1}},{name:"",size:"80%",innerSize:"60%",data:b,dataLabels:{enabled:!0,color:"#555",connectorColor:"#000000",formatter:function(){var a=this.point.percentage;return a.toString().indexOf(".")&&(a=a.toFixed(1)),this.point.name+"<b>"+a+"%</b>"},style:{fontFamily:"Arial"}}}]})},_showPersonChart:function(){for(var b=this.model.get("StaffProgress"),c=(a._.pluck(b,"PrincipalUser"),[]),d=[],e=[],f=0;f<b.length;f++){var g=b[f],h=g.PrincipalUser;c.push(h.Name);var i=g.TaskDone,j=g.TaskTotal-g.TaskDone;d.push(i),e.push(j)}var k=[{name:"undone",color:"#ddd",data:e},{name:"done",color:"#58c583",data:d}],l=55*c.length;1==c.length&&(l=100),2==c.length&&(l=140),this.ui.personChart.highcharts({chart:{type:"bar",width:600,height:l},title:{text:""},xAxis:{categories:c,title:{text:null},labels:{align:"right",style:{color:"#555"}},lineColor:"#697791",tickWidth:0,lineWidth:2,lineColor:"#c5c5c5"},yAxis:{minorTickLength:0,title:{text:""},stackLabels:{enabled:!0,formatter:function(){var a=this.x;return"（"+d[a]+"/"+this.total+"）"}},gridLineWidth:"0",labels:{enabled:!1}},tooltip:{enabled:!1},plotOptions:{series:{stacking:"noraml",stickyTracking:!1,pointWidth:20}},legend:{enabled:!1},credits:{enabled:!1},series:k})}})}),define("$.daterangepicker",["talent","moment"],function(a,b){var c=function(a,b,c){this.parentEl="body",this.element=$(a),this.isShowing=!1;var d='<div class="daterangepicker dropdown-menu"><div class="calendar first left"></div><div class="calendar second right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input"><label for="daterangepicker_start"></label><input class="input-mini" type="text" name="daterangepicker_start" value="" disabled="disabled" /></div><div class="daterangepicker_end_input"><label for="daterangepicker_end"></label><input class="input-mini" type="text" name="daterangepicker_end" value="" disabled="disabled" /></div><button class="applyBtn" disabled="disabled" type="button"></button>&nbsp;<button class="cancelBtn" type="button"></button></div></div></div>';("object"!=typeof b||null===b)&&(b={}),this.parentEl=$("object"==typeof b&&b.parentEl&&$(b.parentEl).length?b.parentEl:this.parentEl),this.container=$(d).appendTo(this.parentEl),b=$.extend(this.element.data(),b),this.setOptions(b,c),this.container.find(".calendar").on("click.daterangepicker",".prev",$.proxy(this.clickPrev,this)).on("click.daterangepicker",".next",$.proxy(this.clickNext,this)).on("click.daterangepicker","td.available",$.proxy(this.clickDate,this)).on("mouseenter.daterangepicker","td.available",$.proxy(this.hoverDate,this)).on("mouseleave.daterangepicker","td.available",$.proxy(this.updateFormInputs,this)).on("change.daterangepicker","select.yearselect",$.proxy(this.updateMonthYear,this)).on("change.daterangepicker","select.monthselect",$.proxy(this.updateMonthYear,this)).on("change.daterangepicker","select.hourselect,select.minuteselect,select.secondselect,select.ampmselect",$.proxy(this.updateTime,this)),this.container.find(".ranges").on("click.daterangepicker","button.applyBtn",$.proxy(this.clickApply,this)).on("click.daterangepicker","button.cancelBtn",$.proxy(this.clickCancel,this)).on("click.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.showCalendars,this)).on("change.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.inputsChanged,this)).on("keydown.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.inputsKeydown,this)).on("click.daterangepicker","li",$.proxy(this.clickRange,this)).on("mouseenter.daterangepicker","li",$.proxy(this.enterRange,this)).on("mouseleave.daterangepicker","li",$.proxy(this.updateFormInputs,this)),this.element.is("input")?this.element.on({"click.daterangepicker":$.proxy(this.show,this),"focus.daterangepicker":$.proxy(this.show,this),"keyup.daterangepicker":$.proxy(this.updateFromControl,this),"keydown.daterangepicker":$.proxy(this.keydown,this)}):this.element.on("click.daterangepicker",$.proxy(this.toggle,this))};c.prototype={constructor:c,setOptions:function(a,c){if(this.startDate=b().startOf("day"),this.endDate=b().endOf("day"),this.timeZone=b().utcOffset(),this.minDate=!1,this.maxDate=!1,this.dateLimit=!1,this.showDropdowns=!1,this.showWeekNumbers=!1,this.timePicker=!1,this.timePickerSeconds=!1,this.timePickerIncrement=30,this.timePicker12Hour=!0,this.autoApply=!1,this.singleDatePicker=!1,this.ranges={},this.autoHide=!0,this.opens="right",this.element.hasClass("pull-right")&&(this.opens="left"),this.drops="down",this.element.hasClass("dropup")&&(this.drops="up"),this.buttonClasses=["btn","btn-small btn-sm"],this.applyClass="btn-success",this.cancelClass="btn-default",this.format="MM/DD/YYYY",this.separator=" - ",this.locale={applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:b.weekdaysMin(),monthNames:b.monthsShort(),firstDay:b.localeData()._week.dow},this.cb=function(){},"string"==typeof a.format&&(this.format=a.format),"string"==typeof a.separator&&(this.separator=a.separator),"string"==typeof a.startDate&&(this.startDate=b(a.startDate,this.format)),"string"==typeof a.endDate&&(this.endDate=b(a.endDate,this.format)),"string"==typeof a.minDate&&(this.minDate=b(a.minDate,this.format)),"string"==typeof a.maxDate&&(this.maxDate=b(a.maxDate,this.format)),"object"==typeof a.startDate&&(this.startDate=b(a.startDate)),"object"==typeof a.endDate&&(this.endDate=b(a.endDate)),"object"==typeof a.minDate&&(this.minDate=b(a.minDate)),"object"==typeof a.maxDate&&(this.maxDate=b(a.maxDate)),"string"==typeof a.applyClass&&(this.applyClass=a.applyClass),"string"==typeof a.cancelClass&&(this.cancelClass=a.cancelClass),"object"==typeof a.dateLimit&&(this.dateLimit=a.dateLimit),"object"==typeof a.locale&&("object"==typeof a.locale.daysOfWeek&&(this.locale.daysOfWeek=a.locale.daysOfWeek.slice()),"object"==typeof a.locale.monthNames&&(this.locale.monthNames=a.locale.monthNames.slice()),"number"==typeof a.locale.firstDay&&(this.locale.firstDay=a.locale.firstDay),"string"==typeof a.locale.applyLabel&&(this.locale.applyLabel=a.locale.applyLabel),"string"==typeof a.locale.cancelLabel&&(this.locale.cancelLabel=a.locale.cancelLabel),"string"==typeof a.locale.fromLabel&&(this.locale.fromLabel=a.locale.fromLabel),"string"==typeof a.locale.toLabel&&(this.locale.toLabel=a.locale.toLabel),"string"==typeof a.locale.weekLabel&&(this.locale.weekLabel=a.locale.weekLabel),"string"==typeof a.locale.customRangeLabel&&(this.locale.customRangeLabel=a.locale.customRangeLabel)),"string"==typeof a.opens&&(this.opens=a.opens),"string"==typeof a.drops&&(this.drops=a.drops),"boolean"==typeof a.showWeekNumbers&&(this.showWeekNumbers=a.showWeekNumbers),"string"==typeof a.buttonClasses&&(this.buttonClasses=[a.buttonClasses]),"object"==typeof a.buttonClasses&&(this.buttonClasses=a.buttonClasses),"boolean"==typeof a.showDropdowns&&(this.showDropdowns=a.showDropdowns),"boolean"==typeof a.singleDatePicker&&(this.singleDatePicker=a.singleDatePicker,this.singleDatePicker&&(this.endDate=this.startDate.clone())),"boolean"==typeof a.timePicker&&(this.timePicker=a.timePicker),"boolean"==typeof a.timePickerSeconds&&(this.timePickerSeconds=a.timePickerSeconds),"number"==typeof a.timePickerIncrement&&(this.timePickerIncrement=a.timePickerIncrement),"boolean"==typeof a.timePicker12Hour&&(this.timePicker12Hour=a.timePicker12Hour),"boolean"==typeof a.autoApply&&(this.autoApply=a.autoApply,this.autoApply&&this.container.find(".applyBtn, .cancelBtn").addClass("hide")),"boolean"==typeof a.autoHide&&(this.autoHide=a.autoHide),0!=this.locale.firstDay)for(var d=this.locale.firstDay;d>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),d--;var e,f,g;if("undefined"==typeof a.startDate&&"undefined"==typeof a.endDate&&$(this.element).is("input[type=text]")){var h=$(this.element).val(),i=h.split(this.separator);e=f=null,2==i.length?(e=b(i[0],this.format),f=b(i[1],this.format)):this.singleDatePicker&&""!==h&&(e=b(h,this.format),f=b(h,this.format)),null!==e&&null!==f&&(this.startDate=e,this.endDate=f)}if("string"==typeof a.timeZone||"number"==typeof a.timeZone?(this.timeZone="string"==typeof a.timeZone&&"undefined"!=typeof b.tz?-1*b.tz.zone(a.timeZone).parse(new Date):a.timeZone,this.startDate.utcOffset(this.timeZone),this.endDate.utcOffset(this.timeZone)):this.timeZone=b(this.startDate).utcOffset(),"object"==typeof a.ranges){for(g in a.ranges)e="string"==typeof a.ranges[g][0]?b(a.ranges[g][0],this.format):b(a.ranges[g][0]),f="string"==typeof a.ranges[g][1]?b(a.ranges[g][1],this.format):b(a.ranges[g][1]),this.minDate&&e.isBefore(this.minDate)&&(e=b(this.minDate)),this.maxDate&&f.isAfter(this.maxDate)&&(f=b(this.maxDate)),this.minDate&&f.isBefore(this.minDate)||this.maxDate&&e.isAfter(this.maxDate)||(this.ranges[g]=[e,f]);var j="<ul>";for(g in this.ranges)j+="<li>"+g+"</li>";j+="<li>"+this.locale.customRangeLabel+"</li>",j+="</ul>",this.container.find(".ranges ul").remove(),this.container.find(".ranges").prepend(j)}if("function"==typeof c&&(this.cb=c),this.timePicker||(this.startDate=this.startDate.startOf("day"),this.endDate=this.endDate.endOf("day")),this.singleDatePicker?(this.opens=this.opens||"right",this.container.addClass("single"),this.container.find(".calendar.right").show(),this.container.find(".calendar.left").hide(),this.timePicker?this.container.find(".ranges .daterangepicker_start_input, .ranges .daterangepicker_end_input").hide():this.container.find(".ranges").hide(),this.container.find(".calendar.right").hasClass("single")||this.container.find(".calendar.right").addClass("single")):(this.container.removeClass("single"),this.container.find(".calendar.right").removeClass("single"),this.container.find(".calendar.left").show(),this.container.find(".ranges").show()),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.oldChosenLabel=this.chosenLabel,this.leftCalendar={month:b([this.startDate.year(),this.startDate.month(),1,this.startDate.hour(),this.startDate.minute(),this.startDate.second()]),calendar:[]},this.rightCalendar={month:b([this.endDate.year(),this.endDate.month(),1,this.endDate.hour(),this.endDate.minute(),this.endDate.second()]),calendar:[]},"right"==this.opens||"center"==this.opens){var k=this.container.find(".calendar.first"),l=this.container.find(".calendar.second");l.hasClass("single")&&(l.removeClass("single"),k.addClass("single")),k.removeClass("left").addClass("right"),l.removeClass("right").addClass("left"),this.singleDatePicker&&(k.show(),l.hide())}"undefined"!=typeof a.ranges||this.singleDatePicker||this.container.addClass("show-calendar"),this.autoHide?this.container.removeClass("opensleft opensright").addClass("opens"+this.opens):this.container.removeClass("opensleft opensright openscenter").addClass("open"),this.updateView(),this.updateCalendars();var m=this.container;$.each(this.buttonClasses,function(a,b){m.find("button").addClass(b)}),this.container.find(".daterangepicker_start_input label").html(this.locale.fromLabel),this.container.find(".daterangepicker_end_input label").html(this.locale.toLabel),this.applyClass.length&&this.container.find(".applyBtn").addClass(this.applyClass),this.cancelClass.length&&this.container.find(".cancelBtn").addClass(this.cancelClass),this.container.find(".applyBtn").html(this.locale.applyLabel),this.container.find(".cancelBtn").html(this.locale.cancelLabel)},setStartDate:function(a){"string"==typeof a&&(this.startDate=b(a,this.format).utcOffset(this.timeZone)),"object"==typeof a&&(this.startDate=b(a)),this.timePicker||(this.startDate=this.startDate.startOf("day")),this.oldStartDate=this.startDate.clone(),this.updateView(),this.updateCalendars(),this.updateInputText()},setEndDate:function(a){"string"==typeof a&&(this.endDate=b(a,this.format).utcOffset(this.timeZone)),"object"==typeof a&&(this.endDate=b(a)),this.timePicker||(this.endDate=this.endDate.endOf("day")),this.oldEndDate=this.endDate.clone(),this.updateView(),this.updateCalendars(),this.updateInputText()},updateView:function(){this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute()),this.updateFormInputs()},updateFormInputs:function(){this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.format)),this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.format)),this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")&&this.element.val().length){var a=this.element.val().split(this.separator),c=null,d=null;2===a.length&&(c=b(a[0],this.format).utcOffset(this.timeZone),d=b(a[1],this.format).utcOffset(this.timeZone)),(this.singleDatePicker||null===c||null===d)&&(c=b(this.element.val(),this.format).utcOffset(this.timeZone),d=c),d.isBefore(c)||(this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.startDate=c,this.endDate=d,this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.updateCalendars())}},keydown:function(a){(9===a.keyCode||13===a.keyCode)&&this.hide()
},notify:function(){this.updateView(),this.updateInputText(),this.cb(this.startDate,this.endDate,this.chosenLabel)},move:function(){var a,b={top:0,left:0},c=$(window).width();this.parentEl.is("body")||(b={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()},c=this.parentEl[0].clientWidth+this.parentEl.offset().left),a="up"==this.drops?this.element.offset().top-this.container.outerHeight()-b.top:this.element.offset().top+this.element.outerHeight()-b.top,this.container["up"==this.drops?"addClass":"removeClass"]("dropup"),"left"==this.opens?(this.container.css({top:a,right:c-this.element.offset().left-this.element.outerWidth(),left:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):"center"==this.opens?(this.container.css({top:a,left:this.element.offset().left-b.left+this.element.outerWidth()/2-this.container.outerWidth()/2,right:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):(this.container.css({top:a,left:this.element.offset().left-b.left,right:"auto"}),this.container.offset().left+this.container.outerWidth()>$(window).width()&&this.container.css({left:"auto",right:0}))},toggle:function(){this.autoHide&&(this.element.hasClass("active")?this.hide():this.show())},show:function(){this.isShowing||(this.element.addClass("active"),this.container.show(),this.move(),this._outsideClickProxy=$.proxy(function(a){this.outsideClick(a)},this),$(document).on("mousedown.daterangepicker",this._outsideClickProxy).on("touchend.daterangepicker",this._outsideClickProxy).on("click.daterangepicker","[data-toggle=dropdown]",this._outsideClickProxy).on("focusin.daterangepicker",this._outsideClickProxy),this.isShowing=!0,this.element.trigger("show.daterangepicker",this))},outsideClick:function(a){var b=$(a.target);this.autoHide||"focusin"==a.type||b.closest(this.element).length||b.closest(this.container).length||b.closest(".calendar-date").length||this.hide()},hide:function(){this.isShowing&&($(document).off(".daterangepicker"),this.element.removeClass("active"),this.container.hide(),this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.isShowing=!1,this.element.trigger("hide.daterangepicker",this))},enterRange:function(a){var b=a.target.innerHTML;if(b==this.locale.customRangeLabel)this.updateView();else{var c=this.ranges[b];this.container.find("input[name=daterangepicker_start]").val(c[0].format(this.format)),this.container.find("input[name=daterangepicker_end]").val(c[1].format(this.format))}},showCalendars:function(){this.container.addClass("show-calendar"),this.move(),this.element.trigger("showCalendar.daterangepicker",this)},hideCalendars:function(){this.container.removeClass("show-calendar"),this.element.trigger("hideCalendar.daterangepicker",this)},inputsChanged:function(a){var c=$(a.target),d=b(c.val(),this.format);if(d.isValid()){var e,f;if("daterangepicker_start"===c.attr("name")){if(e=!1!==this.minDate&&d.isBefore(this.minDate)?this.minDate:d,f=this.endDate,"object"==typeof this.dateLimit){var g=b(e).add(this.dateLimit).endOf("day");f.isAfter(g)&&(f=g)}}else if(e=this.startDate,f=!1!==this.maxDate&&d.isAfter(this.maxDate)?this.maxDate:d.endOf("day"),"object"==typeof this.dateLimit){var h=b(f).subtract(this.dateLimit).startOf("day");e.isBefore(h)&&(e=h)}this.setCustomDates(e,f)}},inputsKeydown:function(a){13===a.keyCode&&(this.inputsChanged(a),this.notify())},updateInputText:function(){this.element.is("input")&&!this.singleDatePicker?(this.element.val(this.startDate.format(this.format)+this.separator+this.endDate.format(this.format)),this.element.trigger("change")):this.element.is("input")&&(this.element.val(this.endDate.format(this.format)),this.element.trigger("change"))},clickRange:function(a){var b=a.target.innerHTML;if(this.chosenLabel=b,b==this.locale.customRangeLabel)this.showCalendars();else{var c=this.ranges[b];this.startDate=c[0],this.endDate=c[1],this.timePicker||(this.startDate.startOf("day"),this.endDate.endOf("day")),this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute()),this.updateCalendars(),this.updateInputText(),this.hideCalendars(),this.hide(),this.element.trigger("apply.daterangepicker",this),this.autoApply&&this.notify()}},clickPrev:function(a){var b=$(a.target).parents(".calendar");b.hasClass("left")?this.leftCalendar.month.subtract(1,"month"):this.rightCalendar.month.subtract(1,"month"),this.updateCalendars()},clickNext:function(a){var b=$(a.target).parents(".calendar");b.hasClass("left")?this.leftCalendar.month.add(1,"month"):this.rightCalendar.month.add(1,"month"),this.updateCalendars()},hoverDate:function(a){var b=$(a.target).attr("data-title"),c=b.substr(1,1),d=b.substr(3,1),e=$(a.target).parents(".calendar");e.hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[c][d].format(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[c][d].format(this.format))},setCustomDates:function(a,c){if(this.chosenLabel=this.locale.customRangeLabel,a.isAfter(c)){var d=this.endDate.diff(this.startDate);c=b(a).add(d,"ms"),this.maxDate&&c.isAfter(this.maxDate)&&(c=this.maxDate.clone())}this.startDate=a,this.endDate=c,this.updateView(),this.updateCalendars(),this.autoApply&&(this.notify(),this.element.trigger("apply.daterangepicker",this))},clickDate:function(a){var c,d,e=$(a.target).attr("data-title"),f=e.substr(1,1),g=e.substr(3,1),h=$(a.target).parents(".calendar");if(h.hasClass("left")){if(c=this.leftCalendar.calendar[f][g],d=this.endDate,"object"==typeof this.dateLimit){var i=b(c).add(this.dateLimit).endOf("day");d.isAfter(i)&&(d=i)}}else if(c=this.startDate,d=this.rightCalendar.calendar[f][g],"object"==typeof this.dateLimit){var j=b(d).subtract(this.dateLimit).startOf("day");c.isBefore(j)&&(c=j)}this.singleDatePicker&&h.hasClass("left")?d=c.clone():this.singleDatePicker&&h.hasClass("right")&&(c=d.clone()),h.find("td").removeClass("active"),$(a.target).addClass("active"),this.setCustomDates(c,d),this.timePicker||d.endOf("day"),this.singleDatePicker&&!this.timePicker&&this.clickApply()},clickApply:function(){this.updateInputText(),this.hide(),this.element.trigger("apply.daterangepicker",this)},clickCancel:function(){this.startDate=this.oldStartDate,this.endDate=this.oldEndDate,this.chosenLabel=this.oldChosenLabel,this.updateView(),this.updateCalendars(),this.hide(),this.element.trigger("cancel.daterangepicker",this)},updateMonthYear:function(a){var b=$(a.target).closest(".calendar").hasClass("left"),c=b?"left":"right",d=this.container.find(".calendar."+c),e=parseInt(d.find(".monthselect").val(),10),f=d.find(".yearselect").val();b||this.singleDatePicker||(f<this.startDate.year()||f==this.startDate.year()&&e<this.startDate.month())&&(e=this.startDate.month(),f=this.startDate.year()),this.minDate&&(f<this.minDate.year()||f==this.minDate.year()&&e<this.minDate.month())&&(e=this.minDate.month(),f=this.minDate.year()),this.maxDate&&(f>this.maxDate.year()||f==this.maxDate.year()&&e>this.maxDate.month())&&(e=this.maxDate.month(),f=this.maxDate.year()),this[c+"Calendar"].month.month(e).year(f),this.updateCalendars()},updateTime:function(a){var b=$(a.target).closest(".calendar"),c=b.hasClass("left"),d=parseInt(b.find(".hourselect").val(),10),e=parseInt(b.find(".minuteselect").val(),10),f=0;if(this.timePickerSeconds&&(f=parseInt(b.find(".secondselect").val(),10)),this.timePicker12Hour){var g=b.find(".ampmselect").val();"PM"===g&&12>d&&(d+=12),"AM"===g&&12===d&&(d=0)}if(c){var h=this.startDate.clone();h.hour(d),h.minute(e),h.second(f),this.startDate=h,this.leftCalendar.month.hour(d).minute(e).second(f),this.singleDatePicker&&(this.endDate=h.clone())}else{var i=this.endDate.clone();i.hour(d),i.minute(e),i.second(f),this.endDate=i,this.singleDatePicker&&(this.startDate=i.clone()),this.rightCalendar.month.hour(d).minute(e).second(f)}this.updateView(),this.updateCalendars(),this.autoApply&&(this.notify(),this.element.trigger("apply.daterangepicker",this))},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.month(),this.leftCalendar.month.year(),this.leftCalendar.month.hour(),this.leftCalendar.month.minute(),this.leftCalendar.month.second(),"left"),this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.month(),this.rightCalendar.month.year(),this.rightCalendar.month.hour(),this.rightCalendar.month.minute(),this.rightCalendar.month.second(),"right"),this.container.find(".calendar.left").empty().html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate,"left")),this.container.find(".calendar.right").empty().html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.singleDatePicker?this.minDate:this.startDate,this.maxDate,"right")),this.container.find(".ranges li").removeClass("active");var a=!0,b=0;for(var c in this.ranges)this.timePicker?this.startDate.isSame(this.ranges[c][0])&&this.endDate.isSame(this.ranges[c][1])&&(a=!1,this.chosenLabel=this.container.find(".ranges li:eq("+b+")").addClass("active").html()):this.startDate.format("YYYY-MM-DD")==this.ranges[c][0].format("YYYY-MM-DD")&&this.endDate.format("YYYY-MM-DD")==this.ranges[c][1].format("YYYY-MM-DD")&&(a=!1,this.chosenLabel=this.container.find(".ranges li:eq("+b+")").addClass("active").html()),b++;a&&(this.chosenLabel=this.container.find(".ranges li:last").addClass("active").html(),this.showCalendars())},buildCalendar:function(a,c,d,e,f,g){var h,i=b([c,a]).daysInMonth(),j=b([c,a,1]),k=b([c,a,i]),l=b(j).subtract(1,"month").month(),m=b(j).subtract(1,"month").year(),n=b([m,l]).daysInMonth(),o=j.day(),p=[];for(p.firstDay=j,p.lastDay=k,h=0;6>h;h++)p[h]=[];var q=n-o+this.locale.firstDay+1;q>n&&(q-=7),o==this.locale.firstDay&&(q=n-6);var r,s,t=b([m,l,q,12,e,f]);for(h=0,r=0,s=0;42>h;h++,r++,t=b(t).add(24,"hour"))h>0&&r%7===0&&(r=0,s++),p[s][r]=t.clone().hour(d),t.hour(12),this.minDate&&p[s][r].format("YYYY-MM-DD")==this.minDate.format("YYYY-MM-DD")&&p[s][r].isBefore(this.minDate)&&"left"==g&&(p[s][r]=this.minDate.clone()),this.maxDate&&p[s][r].format("YYYY-MM-DD")==this.maxDate.format("YYYY-MM-DD")&&p[s][r].isAfter(this.maxDate)&&"right"==g&&(p[s][r]=this.maxDate.clone());return p},renderDropdowns:function(a,b,c){for(var d=a.month(),e=a.year(),f=c&&c.year()||e+5,g=b&&b.year()||e-50,h='<select class="monthselect">',i=e==g,j=e==f,k=0;12>k;k++)(!i||k>=b.month())&&(!j||k<=c.month())&&(h+="<option value='"+k+"'"+(k===d?" selected='selected'":"")+">"+this.locale.monthNames[k]+"</option>");h+="</select>";for(var l='<select class="yearselect">',m=g;f>=m;m++)l+='<option value="'+m+'"'+(m===e?' selected="selected"':"")+">"+m+"</option>";return l+="</select>",h+l},renderCalendar:function(a,b,c,d,e){var f='<div class="calendar-date">';f+='<table class="table-condensed">',f+="<thead>",f+="<tr>",this.showWeekNumbers&&(f+="<th></th>"),f+=!c||c.isBefore(a.firstDay)?'<th class="prev available"><i class="fa fa-arrow-left icon icon-arrow-left glyphicon glyphicon-arrow-left"></i></th>':"<th></th>";var g=this.locale.monthNames[a[1][1].month()]+a[1][1].format(" YYYY");this.showDropdowns&&(g=this.renderDropdowns(a[1][1],c,d)),f+='<th colspan="5" class="month">'+g+"</th>",f+=!d||d.isAfter(a.lastDay)?'<th class="next available"><i class="fa fa-arrow-right icon icon-arrow-right glyphicon glyphicon-arrow-right"></i></th>':"<th></th>",f+="</tr>",f+="<tr>",this.showWeekNumbers&&(f+='<th class="week">'+this.locale.weekLabel+"</th>"),$.each(this.locale.daysOfWeek,function(a,b){f+="<th>"+b+"</th>"}),f+="</tr>",f+="</thead>",f+="<tbody>";for(var h=0;6>h;h++){f+="<tr>",this.showWeekNumbers&&(f+='<td class="week">'+a[h][0].week()+"</td>");for(var i=0;7>i;i++){var j="available ";j+=a[h][i].month()==a[1][1].month()?"":"off",a[h][i].isSame(new Date,"day")&&(j+=" today "),c&&a[h][i].isBefore(c,"day")||d&&a[h][i].isAfter(d,"day")?j=" off disabled ":a[h][i].format("YYYY-MM-DD")==b.format("YYYY-MM-DD")?(j+=" active ",a[h][i].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")&&(j+=" start-date "),a[h][i].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")&&(j+=" end-date ")):a[h][i]>=this.startDate&&a[h][i]<=this.endDate&&(j+=" in-range ",a[h][i].isSame(this.startDate)&&(j+=" start-date "),a[h][i].isSame(this.endDate)&&(j+=" end-date "));var k="r"+h+"c"+i;f+='<td class="'+j.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" data-title="'+k+'">'+a[h][i].date()+"</td>"}f+="</tr>"}f+="</tbody>",f+="</table>",f+="</div>";var l;if(this.timePicker){f+='<div class="calendar-time">',f+='<select class="hourselect">';var m=0,n=23;c&&("left"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==c.format("YYYY-MM-DD")&&(m=c.hour(),b.hour()<m&&b.hour(m),this.timePicker12Hour&&m>=12&&b.hour()>=12&&(m-=12),this.timePicker12Hour&&12==m&&(m=1)),d&&("right"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==d.format("YYYY-MM-DD")&&(n=d.hour(),b.hour()>n&&b.hour(n),this.timePicker12Hour&&n>=12&&b.hour()>=12&&(n-=12));var o=0,p=23,q=b.hour();for(this.timePicker12Hour&&(o=1,p=12,q>=12&&(q-=12),0===q&&(q=12)),l=o;p>=l;l++)f+=l==q?'<option value="'+l+'" selected="selected">'+l+"</option>":m>l||l>n?'<option value="'+l+'" disabled="disabled" class="disabled">'+l+"</option>":'<option value="'+l+'">'+l+"</option>";f+="</select> : ",f+='<select class="minuteselect">';var r=0,s=59;for(c&&("left"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD h A")==c.format("YYYY-MM-DD h A")&&(r=c.minute(),b.minute()<r&&b.minute(r)),d&&("right"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD h A")==d.format("YYYY-MM-DD h A")&&(s=d.minute(),b.minute()>s&&b.minute(s)),l=0;60>l;l+=this.timePickerIncrement){var t=l;10>t&&(t="0"+t),f+=l==b.minute()?'<option value="'+l+'" selected="selected">'+t+"</option>":r>l||l>s?'<option value="'+l+'" disabled="disabled" class="disabled">'+t+"</option>":'<option value="'+l+'">'+t+"</option>"}if(f+="</select> ",this.timePickerSeconds){for(f+=': <select class="secondselect">',l=0;60>l;l+=this.timePickerIncrement){var t=l;10>t&&(t="0"+t),f+=l==b.second()?'<option value="'+l+'" selected="selected">'+t+"</option>":'<option value="'+l+'">'+t+"</option>"}f+="</select>"}if(this.timePicker12Hour){f+='<select class="ampmselect">';var u="",v="";c&&("left"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==c.format("YYYY-MM-DD")&&c.hour()>=12&&(u=' disabled="disabled" class="disabled"'),d&&("right"==e||this.singleDatePicker)&&b.format("YYYY-MM-DD")==d.format("YYYY-MM-DD")&&d.hour()<12&&(v=' disabled="disabled" class="disabled"'),f+=b.hour()>=12?'<option value="AM"'+u+'>AM</option><option value="PM" selected="selected"'+v+">PM</option>":'<option value="AM" selected="selected"'+u+'>AM</option><option value="PM"'+v+">PM</option>",f+="</select>"}f+="</div>"}return f},remove:function(){this.container.remove(),this.element.off(".daterangepicker"),this.element.removeData("daterangepicker")}},$.fn.daterangepicker=function(a,b){return this.each(function(){var d=$(this);d.data("daterangepicker")&&d.data("daterangepicker").remove(),d.data("daterangepicker",new c(d,a,b))}),this}}),define("templates/set",[],function(){return this.JST=this.JST||{},this.JST["set/app/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="_tt_loading_m">努力加载中…</div>	';return __p},this.JST["set/approvals/approval-check"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="report_pop_container">\n	<div class="report_pop_header">\n		设置计划项范围\n		<a href="javascript:void(0)" class="icon-dialog-closed" data-handler="Close"></a>\n	</div>\n	<div class="report_pop_content">\n		<div class="report_search_content_left">\n			<span>所有类别</span>\n			<div class="report_type_list"></div>\n		</div>\n		<div class="report_search_content_center">\n			<span class="smember_search_arrow_icon search_arrow_icon"></span>\n		</div>\n		<div class="report_search_content_right">\n			<span>已选类别</span>\n			<div class="report_checked_type_list"></div>\n		</div>\n	</div>\n	<div class="smember_footer">\n		<a href="javascript:void(0)" class="btn btn-cancel" data-handler="clean">清除全部</a>\n		<a href="javascript:void(0)" class="btn cancel_rd" data-handler="Cancel">取消</a>\n		<a href="javascript:void(0)" class="btn btn-sure sure_rd" data-handler="Submit">确定</a>		\n	</div>\n</div>\n';return __p},this.JST["set/approvals/approval-class-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="checked_name">'+(null==(__t=name)?"":__t)+'</div>\n<a href="javascript:void(0)" data-handler="Delete" class="smember_btn_reduce">\n	<span></span>\n\n</a>';return __p},this.JST["set/approvals/approval-index-content"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="ap-cue ap-cf">下属工作变更通知到我并让我审批</div>\n<div class="ap-select-range ap-bc" data-name="ap-select-range"></div>\n<div class="report_type_pop" data-name="report-type-pop"></div>\n<div class="ap-select-type ap-bc" data-name="ap-select-type"></div>\n<div class="action_dgs ap-bc">\n	<a href="javascript:void(0)" class="btn btn-sure" data-name="submit-submit">保存</a>\n</div>';return __p},this.JST["set/approvals/approval-list-check"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<a href="javascript:void(0);" id="'+(null==(__t=Id)?"":__t)+'" class="checkbox ',Value&&(__p+="checkbox-checked"),__p+='" data-name="check-item" name="items">\n	<span class="ico"></span>\n</a><span>'+(null==(__t=Name)?"":__t)+"</span>\n\n";return __p},this.JST["set/approvals/approval-no-content"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="ap">计划审批设置</div>\n<div class="ap-cue ap-cf">下属工作变更通知到我并让我审批</div>\n<div class="ap-select-range ap-bc" data-name="ap-select-range">\n	<span class="approval_title">范围:</span>\n	<div class="approval_desc">\n		<div class="input-default approval-input" data-name="report-type-checked"></div>\n	</div>\n</div>\n<div class="ap-select-type ap-bc" data-name="ap-select-type">\n	<span class="approval_title">类型:</span>\n<div class="approval_desc" id="approval_desc">\n	<ul>\n		<li>\n			<a href="javascript:void(0);" title="" id="checkedAll" data-name="checkedAll" class="checkbox"><span class="ico"></span></a><span>全选</span>\n		</li>\n		<li class="li-check">\n			<a href="javascript:void(0);" class="checkbox"><span class="ico"></span></a><span>fwfewfewf</span>\n		</li>\n		<li class="li-check">\n			<a href="javascript:void(0);" class="checkbox"><span class="ico"></span></a><span>fwfewfewf</span>\n		</li>\n		<li class="li-check">\n			<a href="javascript:void(0);" class="checkbox"><span class="ico"></span></a><span>fwfewfewf</span>\n		</li>\n		<li class="li-check">\n			<a href="javascript:void(0);" class="checkbox"><span class="ico"></span></a><span>fwfewfewf</span>\n		</li>\n		<li class="li-check">\n			<a href="javascript:void(0);" class="checkbox"><span class="ico"></span></a><span>fwfewfewf</span>\n		</li>\n		<li class="li-check">\n			<a href="javascript:void(0);" class="checkbox"><span class="ico"></span></a><span>fwfewfewf</span>\n		</li>\n	</ul>\n</div>\n</div>\n<div class="action_dgs ap-bc">\n	<a href="javascript:void(0)" class="btn btn-sure" data-name="submit-submit">保存</a>\n</div>';return __p},this.JST["set/approvals/approval-select-type"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<span class="approval_title">类型:</span>\n<div class="approval_desc" id="approval_desc">\n	<ul>\n		<li>\n			<a href="javascript:void(0);" title="" id="checkedAll" data-name="checkedAll" class="checkbox ',allChecked&&(__p+="checkbox-checked"),__p+='"><span class="ico"></span></a><span>全选</span>\n		</li>\n	</ul>\n</div>';return __p},this.JST["set/approvals/approval-type-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<span class="approval_title">范围:</span>\n<div class="approval_desc">\n	<div class="input-default approval-input ',typeString&&(__p+="input-blur"),__p+='" data-name="report-type-checked">		\n			',__p+=typeString?"\n				"+(null==(__t=typeString)?"":__t)+"\n			":"\n				所有范围\n			",__p+="\n	</div>\n</div>";return __p},this.JST["set/approvals/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="ap">计划审批设置</div>\n<div data-name="container"><div class="_tt_loading_m">努力加载中…</div></div>\n';return __p},this.JST["set/avatar/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tu-container-title ">\n  <h2 class="h2">修改头像</h2>\n</div>\n<div class="tt-set-avatar-container">\n	<div class="top-btn-cont">\n		<span class="tu-btn tu-btn-small tu-btn-sure upload_node upload_new_file" data-name="file">上传头像</span>\n		<span type="button" class="tu-btn tu-btn-small ',userAvatar.HasAvatar||(__p+="hidden"),__p+='" data-name="reset-btn">恢复默认头像</span>\n	</div>\n	<div class="img-crop-box tu-clearfix">\n		<div class="img-crop-cont">\n			<div class="loading-content">\n				',__p+=isShowGIF?'\n			    	<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="68" height="60">\n			    ':'\n			        <div class="spinner">\n			            <div class="rect1"></div>\n			            <div class="rect2"></div>\n			            <div class="rect3"></div>\n			            <div class="rect4"></div>\n			        </div>\n			    ',__p+='\n			    <div class="text-loading">\n			        上传中，请稍后…\n			    </div>\n			</div>\n			<img src="" alt="" class="img-original hidden">\n		</div>\n		<div class="img-preview-cont ',userAvatar.HasAvatar&&(__p+="hideDefAvatar"),__p+='">\n			<div class="pre-title">预览</div>\n			<div class="item ">\n				<div class="pre-s-box">\n					<img class="pre-s pre-img" src="',userAvatar.HasAvatar&&(__p+=null==(__t=userAvatar.Small)?"":__t),__p+='" >\n					'+(null==(__t=_.convertImage({className:"defAvatar",src:"",size:30,shape:"radius",name:name,bgColor:userAvatar.Color}))?"":__t)+'\n				</div>\n				<span class="txt">30*30</span>\n			</div>\n			<div class="item ">\n				<div class="pre-m-box">\n					\n					<img class="pre-m pre-img" src="',userAvatar.HasAvatar&&(__p+=null==(__t=userAvatar.Medium)?"":__t),__p+='" >\n					'+(null==(__t=_.convertImage({className:"defAvatar",src:"",size:50,shape:"radius",name:name,bgColor:userAvatar.Color}))?"":__t)+'\n				</div>\n				<span class="txt">50*50</span>\n			</div>\n			<div class="item ">\n				<div class="pre-b-box">\n					<img class="pre-b pre-img" src="',userAvatar.HasAvatar&&(__p+=null==(__t=userAvatar.Large)?"":__t),__p+='" >\n					'+(null==(__t=_.convertImage({className:"defAvatar",src:"",size:150,shape:"radius",name:name,bgColor:userAvatar.Color}))?"":__t)+'\n				</div>\n				<span class="txt">150*150</span>\n			</div>\n		</div>\n	</div>\n	<p class="tip-txt"><span class="tu-icon-wiki tip-icon"></span>提示：仅支持jpg、jpeg、gif、png格式，建议图片最小尺寸150*150px</p>\n	<div class="bottom-btn-cont">\n		<button class="tu-btn tu-btn-small tu-btn-sure hidden" data-name="submit-btn">保存</button>\n	</div>\n</div>';return __p},this.JST["set/capital/capital-manage-main-in-info"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tu-row-fuild">\n	<div class="tu-col-6">\n		<div class="info-item">\n			<div class="top">\n				<span class="left-line orange"></span>\n				<span class="tt_text">可提现金额（元）<a href="//service.tita.com/pages/viewpage.action?pageId=2261213" target="_blank" class="tu-icon-wiki" original-title="每日提现总金额最多1000元"></a></span> \n			</div>\n			<div class="money">'+(null==(__t=unDrawCashFee)?"":__t)+'</div>\n		</div>\n		<div class="info-item inner-sec">\n			<div class="top">\n				<button class="tu-btn tu-btn-small ',__p+=0==unDrawCashFee?"disabled":"orange",__p+='" data-name="cash-fee-btn">提现</button>\n			</div>\n			<div>\n				<a href="javascript:;" data-name="attention" class="attention-btn">\n					',__p+=null==wxUser?"\n					关注tita服务号\n					":"\n					修改提现信息\n					",__p+='\n				</a>\n			</div>\n		</div>\n	</div>\n	<div class="tu-col-5">\n		<div class="info-item">\n			<div class="top">\n				<span class="left-line green"></span>\n				<span class="tt_text">累计提现金额（元）</span>\n			</div>\n			<div class="money green">'+(null==(__t=drawedCashFee)?"":__t)+'</div>\n		</div>\n	</div>\n	<div class="tu-col-5">\n		<div class="info-item">\n			<div class="top">\n				<span class="left-line blue"></span>\n				<span class="tt_text">打赏总收入（元）</span>\n			</div>\n			<div class="money blue">'+(null==(__t=cashTotalFee)?"":__t)+"</div>\n		</div>\n	</div>\n</div>";return __p},this.JST["set/capital/capital-manage-main-list-collection"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tu-table">\n	<table>\n		<colgroup>\n			<col span="1" width="20%"></col>\n			',__p+=2!=listType?'\n				<col span="1" width="10%"></col>\n				<col span="1" width="30%"></col>\n			':'\n				<col span="1" width="40%"></col>\n			',__p+='\n			<col span="1" width="15%"></col>\n			<col span="1" width="15%"></col>\n			<col span="1" width="10%"></col>\n		</colgroup>\n		<thead>\n			<tr>\n				<th>交易时间</th>\n				',__p+=2!=listType?"\n				<th>事项</th>\n				<th></th>\n				":"\n				<th>微信提现交易单号</th>\n				",__p+="\n				",1==listType?__p+="\n					<th>打赏人</th>\n				":2==listType?__p+="\n					<th>交易方</th>\n				":3==listType&&(__p+="\n					<th>收赏人</th>\n				"),__p+="\n				<th>金额（元）</th>\n				<th>状态</th>\n			</tr>\n		</thead>\n		<tbody></tbody>\n	</table>\n</div>";return __p},this.JST["set/capital/capital-manage-main-list-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+="<td>\n	"+(null==(__t=createDate)?"":__t)+"\n</td>\n",2!=listType&&(__p+='\n<td>\n	<span class="color-'+(null==(__t=obj.color)?"":__t)+'">'+(null==(__t=objTypeName)?"":__t)+"</span>\n</td>\n"),__p+='\n<td class="matter">\n	',__p+=2==listType?'\n		<span class="cont">单号-'+(null==(__t=orderId)?"":__t)+"</span>\n	":'\n		<a class="cont" href="'+(null==(__t=href)?"":__t)+'">'+(null==(__t=objName)?"":__t)+"</a>\n	",__p+="\n</td>\n<td>\n\n	",1==listType?__p+="\n		"+(null==(__t=_.substringWithM(fromUser.name,12,!0))?"":__t)+"\n	":2==listType?__p+="\n		"+(null==(__t=productBody)?"":__t)+"\n	":3==listType&&(__p+="\n		"+(null==(__t=_.substringWithM(toUser.name,12,!0))?"":__t)+"\n	"),__p+="\n	\n</td>\n<td>\n	",__p+=1==listType?'\n	<span class="color-g">\n	+'+(null==(__t=totalFee)?"":__t)+"\n	</span>\n	":2==listType?'\n	<span class="color-r">\n	-'+(null==(__t=totalFee)?"":__t)+"\n	</span>\n	":"\n	-"+(null==(__t=totalFee)?"":__t)+"\n	",__p+='\n</td>\n<td>\n	<span class="color-',6==status?__p+="r":1==status&&(__p+="g"),__p+='">\n	'+(null==(__t=statusTxt)?"":__t)+"\n	</span>\n</td>";return __p},this.JST["set/capital/capital-manage-main-second-nav"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tu-tabbable-custom">\n	<ul class="tu-nav-tabs ">\n		<li class="',1==list_type&&(__p+="active"),__p+='">\n			<a href="#set?page_id=capital&relation=1&list_type=1" data-trigger="false" data-name="nav">收赏记录</a>\n		</li>\n		<li class="',2==list_type&&(__p+="active"),__p+='">\n			<a href="#set?page_id=capital&relation=1&list_type=2" data-trigger="false" data-name="nav">提现记录</a>\n		</li>\n	</ul>\n	<div class="tu-nav-content"></div>\n</div>';return __p},this.JST["set/capital/capital-manage-main"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div data-name="info"></div>\n<div data-name="second-nav"></div>\n<div data-name="list-cont"></div>\n<div data-name="pagination" class="tu-pagelist">\n	<div data-name="pagination-container" class="tu-pagination"></div>\n</div>';return __p},this.JST["set/capital/capital-manage-top-nav"]=function(obj){obj||(obj={});{var __p="";_.escape,Array.prototype.join}with(obj)__p+='<ul class="tu-nav-tabs ">\n	<li class="',1==relation&&(__p+="active"),__p+='" data-name="nav-item">\n		<a href="#set?page_id=capital&relation=1" data-trigger="false">收到的赏金</a>\n	</li>\n	<li class="',2==relation&&(__p+="active"),__p+='" data-name="nav-item">\n		<a href="#set?page_id=capital&relation=2" data-trigger="false">发出的赏金</a>\n	</li>\n	\n</ul>\n<div class="tu-nav-content"></div>\n';return __p},this.JST["set/capital/capital-manage"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div data-name="top-nav"></div>\n<div data-name="main-content"></div>';return __p},this.JST["set/capital/capital-modal-form"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='\n	<li class="item-form tu-clearfix">\n		<div class="hide-input">\n			<input id="none" type="password">\n		</div>\n		<div class="item-tt" data-name="item-title">密码</div>\n		<div class="item-input">\n			<div class="tu-input-default" data-name="input-wrap">\n			    <label for="'+(null==(__t=timestamp)?"":__t)+'" class="placeholder" data-name="placeholder">请输入密码</label>\n			    <input id="'+(null==(__t=timestamp)?"":__t)+'" type=\'password\' data-name="input-text">\n			</div>\n			<div class="error-wrap">\n				<div class="error-tip" data-name="error-tip">密码不正确，请重新输入</div>\n			</div>\n		</div>\n	</li>\n	<!-- <li class="item-form tu-clearfix">\n		<label class="label-from">金额</label>\n		<div class="tu-input-default">\n		    <label class="placeholder" for=\'q\'>最多可提现金额：188.88 元</label>\n		    <input type=\'text\' id=\'q\'>\n		</div>\n	</li> -->\n';return __p},this.JST["set/capital/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="tu-container-title">\n	<h2 class="h2">赏金管理</h2>\n</div>\n<div data-name="_tt_layout_container">\n</div>';return __p},this.JST["set/capital/success-info"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n	<meta charset="UTF-8">\n	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">\n	<meta name="renderer" content="webkit">\n	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">\n	<meta name="author" content="网站作者">\n	<meta name="keywords" content="关键词1,关键词2">\n	<meta name="description" content="描述语句">\n	<title>文档标题</title>\n</head>\n<body>\n	<style>\n		* {\n			margin: 0;\n			padding: 0;\n		}\n\n\n\n\n		.success-info {\n			padding: 15px;\n		}\n		.success-info h5 {\n			font-size: 14px;\n			line-height: 30px;\n		}\n		.success-info li {\n			font-size: 12px;\n			line-height: 24px;\n			color: #70808B;\n		}\n\n\n\n\n\n		.success-tip {\n			\n		}\n		.success-tip h5 {\n			text-align: center;\n			line-height: 30px;\n		}\n		.success-tip .icon-dialog-success {\n			font-size: 20px;\n		}\n		.success-tip .txt-green, .success-tip .icon-dialog-success {\n			color: #59B37E;\n		}\n		.success-tip p {\n			font-size: 12px;\n			color: #70808B;\n		}\n	\n		.attention-flow {\n			p {\n				font-size: 14px;\n				line-height: 36px;\n				color: #2F3B44;\n			}\n		}\n	</style>\n	<div class="success-info">\n		<h5 class="tittle">您申请提现的金额：100.00元</h5>\n		<ul>\n			<li>提现账户信息：</li>\n			<li>微信号：10086</li>\n			<li>姓名：10086</li>\n			<li>联系电话：10086</li>\n		</ul>\n	</div>\n\n	<div>---------------</div>\n	\n	<div class="success-tip">\n		<h5>\n			<span class="icon-dialog-success"></span>提现<span class="txt-green">申请</span>提交成功！\n		</h5>\n		<p>\n			提现金额将在两个工作日内打到您的微信账户，请及时查收\n		</p>\n	</div>\n	<br>\n	<br>\n	<br>\n	<div>---------------</div>\n	<br>\n	<br>\n	<br>\n	<div class="attention-flow">\n		<p>您尚未关注tita服务号，请在关注并授权后提现</p>\n		<img src="../../../images/set/attention-flow.png" alt="">\n	</div>\n\n</body>\n</html>';return __p},this.JST["set/class/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="pagetitle">\n	<h2 class="set_pagetitle"><span>分类设置</span></h2>\n</div>\n<div data-name="class-area" class="common_class_tree"></div>\n<!-- start wxd 企业分类 -->\n<div class="set-enter hide">\n	<div class="pagetitle">\n		<h2 class="set_pagetitle"><span>企业分类设置</span></h2>\n	</div>\n	<div data-name="class-area-enterprise" class="common_class_tree"></div>\n</div>\n<!-- end -->\n<br/><br/><br/><br/><br/><br/><br/><br/><br/> 	';
return __p},this.JST["set/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='\n	<!-- side sub nav -->\n	<div class="_tt_layout_tabnav tu-col-3" data-tu-submenu="tu-submenu">\n	<br/><br/> \n	</div>\n	<!-- side sub nav end -->\n	<div class="_tt_layout_container tu-col-13">\n		<div class="_tt_loading_m">努力加载中…</div>		\n	</div>\n	<!--pullscreen-->\n	<div class="tt_set_pullscreen_container"></div>';return __p},this.JST["set/language/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<h2 class="title">更改语言项</h2>\n<p class="topbar">\n	选择iTalent首选显示语言\n</p>\n<div class="choose">\n	<div class="default item">\n		<span class="radio radio-checked" data-type="default"></span> \n		<span class="label">默认显示语言</span>\n		<span class="txt">中文（简体）</span>\n	</div>\n	<div class="language item">\n		<span class="radio" data-type="all"></span>\n		<span class="label">首选显示语言</span>\n		<div class="select_lang disable" data-name="language-select">\n			<span data-name=\'language-select-txt\'>请选择</span>\n			<span class="icon-arrow-down"></span>\n\n		</div>\n			\n		\n	</div>\n</div>\n\n<div class="button">\n    <button class="btn btn-sure" data-name="sure-item">同意</button>\n	<button class="btn btn-cancel" data-name="cancel-item">取消</button>\n</div>';return __p},this.JST["set/personal/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<h2 class="title">'+(null==(__t=taskName)?"":__t)+'个性化设置</h2>\n<div class="main">\n	<div class="block block1" data-name="todo">\n		<div class="sub-title">工作台、计划显示哪些'+(null==(__t=taskName)?"":__t)+'？</div>\n		<div class="list">\n			<div class="item disable">\n				<a href="javascript:void(0)" class="checkbox-disable">\n					<span class="ico"></span>\n				</a>\n				<span class="label">我负责的'+(null==(__t=taskName)?"":__t)+'（必选）</span>\n			</div>\n			<div class="item" data-type="1">\n				<a href="javascript:void(0)" class="checkbox'+(null==(__t=TaskParticipator?"-checked":"")?"":__t)+'">\n					<span class="ico"></span>\n				</a>\n				<span class="label">我参与的'+(null==(__t=taskName)?"":__t)+'</span>\n			</div>\n			<div class="item"  data-type="2">\n				<a href="javascript:void(0)" class="checkbox'+(null==(__t=TaskCreate?"-checked":"")?"":__t)+'">\n					<span class="ico"></span>\n				</a>\n				<span class="label">我派发的'+(null==(__t=taskName)?"":__t)+'</span>\n			</div>\n		</div>\n		<button class="btn btn-sure" data-name="save" data-type="1">保存</button>\n	</div>\n	\n	<div class="block block2" data-name="accept">\n		<div class="sub-title">我参与的'+(null==(__t=taskName)?"":__t)+'是否需要接受？</div>\n		<div class="list">\n	\n			<div class="item" data-type="1">\n				<a href="javascript:void(0)" class="radio'+(null==(__t=IsAcceptTaskToPlanTable?"-checked":"")?"":__t)+'"><span class="ico"></span></a>\n				<span class="label">默认系统自动接受，直接进入计划表</span>\n			</div>\n			<div class="item" data-type="2">\n				<a href="javascript:void(0)" class="radio'+(null==(__t=IsAcceptTaskToPlanTable?"":"-checked")?"":__t)+'"><span class="ico"></span></a>\n				<span class="label">需要接受（手动点击确认接受）</span>\n			</div>\n		</div>\n		<button class="btn btn-sure" data-name="save" data-type="2">保存</button>\n	</div>\n	\n\n	<!-- <div class="block block3" data-name="pop">\n		<div class="sub-title">todo结束是否需要弹出填写心得弹窗？</div>\n		<div class="list">\n			<div class="item" data-type="1">\n				<a href="javascript:void(0)" class="radio-checked"><span class="ico"></span></a>\n				<span class="label">默认弹出</span>\n			</div>\n			<div class="item" data-type="2">\n				<a href="javascript:void(0)" class="radio"><span class="ico"></span></a>\n				<span class="label">不弹出</span>\n			</div>\n		</div>\n	</div>\n\n	<button class="btn btn-sure" data-name="save">保存</button> -->\n</div>\n';return __p},this.JST["set/plan/daily-set-remind-date"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='	<div class="title_dgs">团队'+(null==(__t=typeText)?"":__t)+'管理设置</div>\n	<div class="group_dgs">\n		<span class="left_dgs">下属'+(null==(__t=typeText)?"":__t)+"提交超过这个时间点，算迟交"+(null==(__t=typeText)?"":__t)+'，时间设置：</span>\n		<div class="select_dgs first_sdgs" data-name="submit-day">\n			<span data-name=\'submit-day-value\'>'+(null==(__t=lateDayTxt)?"":__t)+'</span>\n			<span class="icon-arrow-down ico_segr"></span>\n		</div>\n		<div class="select_dgs" data-name="submit-hour">\n			<span data-name=\'submit-hour-value\'>'+(null==(__t=lateHour)?"":__t)+'</span>\n			<span class="icon-arrow-down ico_segr"></span>\n		</div>\n		<span class="left_dgs"></span>                                           \n	</div>\n	<ul class="remind_dgs">\n		<div class="remind_title">自动提醒大家写'+(null==(__t=typeText)?"":__t)+'：</div>\n		<li>\n			<span class="radio-item"  data-name="radio" data-key="0">\n				<span class="icon '+(null==(__t=PeriodType?"radio":"radio-checked")?"":__t)+'"></span>\n				<span class="txt">不再提醒</span>\n			</span> \n		</li>\n		<li>\n			<span class="radio-item"  data-name="radio" data-key="'+(null==(__t=PeriodTypeKey)?"":__t)+'">\n				<span class="icon '+(null==(__t=PeriodType==PeriodTypeKey?"radio-checked":"radio")?"":__t)+'"></span>\n				<span class="txt">'+(null==(__t=remindTxt)?"":__t)+'</span>\n			</span> \n		\n			<div class="select_dgs" data-name="remind-workday-select">\n				<span data-name=\'remind-workday-value\'>'+(null==(__t=remindDayTxt)?"":__t)+'</span>\n				<span class="icon-arrow-down ico_segr"></span>\n			</div>\n		</li>\n		<li>\n			',1==dailyType&&(__p+='\n				<span class="radio-item"  data-name="radio" data-key="4">\n					<span class="icon '+(null==(__t=4==PeriodType?"radio-checked":"radio")?"":__t)+'"></span>\n					<span class="txt">每天</span>\n				</span> \n			'),__p+='\n			<div class="select_dgs" data-name="remind-everyday-select">\n				<span data-name=\'remind-everyday-value\'>'+(null==(__t=remindHour)?"":__t)+'</span>\n				<span class="icon-arrow-down ico_segr"></span>\n			</div>\n		</li>\n	</ul>\n	<div class="action_dgs"><a href="javascript:void(0);" class="btn btn-sure" data-name="submit-submit">保存</a></div>	';return __p},this.JST["set/plan/dotted-detail"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj){__p+='<div class="ap-title">\n	<div class="higher-level">我的虚线汇报人</div>\n	<a class="delete-btn" href="javascript:void(0)" data-name="delete"></a>\n</div>\n<div class="dotted-content">\n	<div class="mydotted">\n		';{var data=DottedLineUser,user=data.UserAvatar,name=data.Name;data.Id}__p+="\n		"+(null==(__t=_.convertImage({className:"icon",src:user.Medium,size:50,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n		<div class="right">\n			<div class="name">'+(null==(__t=name)?"":__t)+'</div>\n			<div class="depart">'+(null==(__t=data.Department||"部门")?"":__t)+"/"+(null==(__t=data.Position||"职位")?"":__t)+'</div>\n		</div>\n	</div>\n	<div class="my-dotted-content">\n\n		<div class="tittle">ta的审批规定</div>\n		<div class="apply-wraper">\n			<span class="left-hand" data-name="left-hand">类型：</span>\n			<div class="applySet" data-name="apply"></div>\n		</div>\n		\n	</div>\n</div>'}return __p},this.JST["set/plan/index-page"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="pagetitle">\n	<h2 class="set_pagetitle"><span>上级与团队</span></h2>\n</div>\n<div class="_tt_set_container">\n	\n</div>\n\n<div class="daily-set-remind-date" data-name=\'daily-set-remind-date\'>\n	\n</div>\n<div class="border"></div>\n<div class="week-set-remind-date" data-name=\'week-set-remind-date\'>\n	\n</div>\n<div class="border"></div>\n<div class="month-set-remind-date" data-name=\'month-set-remind-date\'>\n	\n</div>\n<!--pullscreen-->\n<!-- <div class="tt_set_pullscreen_container"></div> -->';return __p},this.JST["set/plan/set-plan-user"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj){__p+='\n<div class="supordinate-wraper">\n	\n	<div class="supordinate-inner">\n		';var suplength=DottedLineSupriors.length,supSize=3,suplines=Math.floor(suplength/supSize),supRemains=suplength%supSize,sublength=Subordinates.length,subSize=3,sublines=Math.ceil(sublength/subSize);if(__p+='\n		<span class="sup-txt '+(null==(__t=suplength>0?"":"nodata")?"":__t)+'">直属上级</span>\n		<div class="supordinate '+(null==(__t=0==suplength?"supordinate0":1==suplength?"supordinate1":"")?"":__t)+'">\n			<div class="viki '+(null==(__t=suplength>0?"":"nodata")?"":__t)+'">\n				虚线汇报人 <a class="help" original-title="什么是虚线汇报" href="//service.tita.com/pages/viewpage.action?pageId=590264" target="_blank"></a>\n			</div>\n			<div class="supord" data-name="supord">\n				',supRemains>0){__p+='\n					<div class="line">\n						<div class="wraper">\n						';for(var i=0;supRemains>i;i++){__p+="\n							";var data=DottedLineSupriors[i],user=data.UserAvatar,name=data.Name,id=data.Id;__p+='\n							<div class="item" data-name="item" userid="'+(null==(__t=id)?"":__t)+'">\n								<div class="avator" data-name="avator"  original-title="删除：'+(null==(__t=name)?"":__t)+'">\n									'+(null==(__t=_.convertImage({className:"icon_avator",src:user.Medium,size:50,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n									<span class="delete" data-name="delete">\n										<span class="icon"></span>\n									</span>\n								</div>\n								<div class="right">\n									<span class="name">'+(null==(__t=_.substring(name,8,!0))?"":__t)+'</span>\n									<a data-trigger="false" href="#set?page_id=plan&dotted_id='+(null==(__t=id)?"":__t)+'" class="set">设置</a>\n								</div>\n							</div>\n						'}__p+="\n						</div>\n					</div>\n				"}__p+="\n				";for(var j=0;suplines>j;j++){__p+='\n				<div class="line">\n					<div class="wraper">\n					';for(var i=0;supSize>i;i++){__p+="\n						";var data=DottedLineSupriors[i+supRemains+j*supSize],user=data.UserAvatar,name=data.Name,id=data.Id;__p+='\n						<div class="item" data-name="item" userid="'+(null==(__t=id)?"":__t)+'">\n							<div class="avator" data-name="avator"  original-title="删除：'+(null==(__t=name)?"":__t)+'">\n								'+(null==(__t=_.convertImage({className:"icon_avator",src:user.Medium,size:50,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n								<span class="delete" data-name="delete">\n									<span class="icon"></span>\n								</span>\n							</div>\n							<div class="right">\n								<span class="name">'+(null==(__t=_.substring(name,8,!0))?"":__t)+'</span>\n								<a data-trigger="false" href="#set?page_id=plan&dotted_id='+(null==(__t=id)?"":__t)+'" class="set">设置</a>\n							</div>\n						</div>\n					'}__p+="\n					</div>\n				</div>\n				"}if(__p+='\n			\n			</div>\n			<div class="bottom-right">\n				<span class="right-border-end"></span>\n				<span class="mid-bottom"></span>\n				<a class="btn-add-person" original-title="添加" data-name="add-dotted"><span class="icon-add-big"></span></a>\n				<div class="noreport unable">点击这里可以设置虚线汇报人，共享您的部分工作给ta</div>\n			</div>\n			<div class="bottom-left">\n				<span class="left-border-end"></span>\n				<div class="myboss" data-name="item">\n					',SuperiorUser){__p+="\n						";var data=SuperiorUser,user=data.UserAvatar,name=data.Name,id=data.Id;__p+='\n						<div class="avator">\n							'+(null==(__t=_.convertImage({className:"icon_avator",src:user.Medium,size:50,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n						</div>\n						<div class="right">\n\n							<span class="name">'+(null==(__t=_.substring(name,8,!0))?"":__t)+'</span>\n							<a  data-trigger="false" href="#set?page_id=plan&sup_id='+(null==(__t=id)?"":__t)+'" class="set">查看上级规定</a>\n\n						</div>\n					'}else __p+='\n						<div class="avator">\n							<span class="icon_default_person"></span>\n						</div>\n					';__p+="\n				</div>\n				",SuperiorUser||(__p+='\n					<div class="nosub unable">\n						您还没有直属上级，请联系管理员帮您设置\n					</div>\n				'),__p+='\n			</div>\n		</div>\n\n	</div>\n	\n</div>\n<div class="subordinate-wraper" data-name="subordinate">\n	<div class="sub-inner">\n		<div class="subordinate">\n			<div class="topborder">\n				',Talent.Context.getGlobal("tenant_function").IsUseSetOrg&&(__p+='\n				<a class="btn-add-person" original-title="添加" data-name="add-sub"><span class="icon-add-big"></span></a>\n				'),__p+='\n				<span class="right-border-end"></span>\n				<span class="left-border-end"></span>\n				<span class="mid-top"></span>\n				';var data=mine,user=data.UserAvatar,name=data.Name;__p+="\n				"+(null==(__t=_.convertImage({className:"myself",src:user.Medium,size:64,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n\n			</div>\n\n			<div class="subord">\n				';for(var j=0;sublines>j;j++){__p+='\n				<div class="line">\n\n					';for(var i=0;sublength-i>j*subSize&&subSize>i;i++){__p+="\n						";var data=Subordinates[i+subSize*j].User,user=data.UserAvatar,name=data.Name,id=data.Id;__p+='\n						<div class="item" data-name="item" userid="'+(null==(__t=id)?"":__t)+'">\n							\n							<div class="avator" data-name="avator" original-title="删除：'+(null==(__t=name)?"":__t)+'">\n								\n								'+(null==(__t=_.convertImage({className:"icon_avator",src:user.Medium,size:50,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n								<span class="delete" data-name="delete">\n									<span class="icon"></span>\n								</span>\n							</div>\n							<div class="right">\n								<span class="name">'+(null==(__t=_.substring(name,8,!0))?"":__t)+'</span>\n								<a data-trigger="false" href="#set?page_id=plan&sub_id='+(null==(__t=id)?"":__t)+'" class="set" data-name="set">设置</a>\n							</div>\n						</div>\n					'}__p+="\n				</div>\n				"}__p+="\n			</div>\n		</div>\n		",1>sublength&&(__p+="\n			",__p+=Talent.Context.getGlobal("tenant_function").IsUseSetOrg?'\n				<span class="tip-txt unable">点击这里添加下属</span>\n			':'\n				<span class="tip-txt unable">不允许个人添加下属，请联系超管进行设置</span>\n			',__p+="\n			\n		"),__p+="\n		\n\n	</div>\n	\n</div>\n"}return __p},this.JST["set/plan/sub-detail-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj){__p+="\n";var data=DottedLineUser,user=data.UserAvatar,name=data.Name,id=data.Id;__p+='\n<a href="#italent/home?appid=1&apptype=1&name=TalentProfile-record&to_user_id='+(null==(__t=id)?"":__t)+'" class="icon">\n	'+(null==(__t=_.convertImage({className:"icon",src:user.Medium,size:50,shape:"radius",name:name,bgColor:user.Color}))?"":__t)+'\n</a>\n<div class="right">\n	<div class="line">\n		<a href="#italent/home?appid=1&apptype=1&name=TalentProfile-record&to_user_id='+(null==(__t=id)?"":__t)+'" class="name">'+(null==(__t=name)?"":__t)+'</a>\n		<span class="depart">（ '+(null==(__t=data.Department||"部门")?"":__t)+"/"+(null==(__t=data.Position||"职位")?"":__t)+' ）</span>\n		<span class="icon-delete" data-name="deleteItem" userid="'+(null==(__t=id)?"":__t)+'"></span>\n	</div>\n</div>\n'}return __p},this.JST["set/plan/sub-detail"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<!-- <div class="tt_screen"> -->\n	<div class="ap-title">\n		<div class="higher-level">我的下属</div>\n		<a class="delete-btn" href="javascript:void(0)" data-name="delete"></a>\n	</div>\n	<div class="sub-content">\n		<div class="sub">\n			'+(null==(__t=_.convertImage({className:"icon",src:UserAvatar.Medium,size:50,shape:"radius",name:Name,bgColor:UserAvatar.Color}))?"":__t)+'\n			<div class="right">\n				<div class="name">'+(null==(__t=Name)?"":__t)+'</div>\n				<div class="depart">'+(null==(__t=Department||"部门")?"":__t)+"/"+(null==(__t=Position||"职位")?"":__t)+'</div>\n			</div>\n		</div>\n		<div class="dotted">\n			<div class="tittle">ta的虚线汇报人</div>\n\n			<div class="addArea">\n				<a class="btn-add-person" original-title="添加" data-name="add-dotted"><span class="icon-add-big"></span></a>\n\n				<span class="des">帮ta设置虚线汇报人</span>\n			</div>\n\n			<div class="list">\n				\n				\n			</div>\n		</div>\n	</div>\n<!-- </div> -->\n';return __p},this.JST["set/planbench/index-page"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='\n<div class="tt_set_planbench">\n	<div class="title_pb">\n		<h2><span class="h_tpb">'+(null==(__t=i18n.plan_1)?"":__t)+'表共享者</span> <span class="total_tpb" data-name="plan-user-total">0</span>个</h2>\n		<p>所有'+(null==(__t=i18n.plan_1)?"":__t)+'表将默认共享给以下人员:</p>\n	</div>\n	<div class="mebers_pb" data-name="plan-user">\n		<div class="_tt_loading_m">努力加载中…</div>	\n	</div>\n	<div class="space_pb"></div>\n	',IsUsePlanDaily&&(__p+='\n		<div class="title_pb">\n			<h2><span class="h_tpb">总结共享者</span> <span class="total_tpb" data-name="daily-user-total">0</span>个</h2>\n			<p>所有日报、周报、月报将默认共享给以下人员：</p>\n		</div>\n	<div class="mebers_pb" data-name="daily-user">\n		<div class="_tt_loading_m">努力加载中…</div>\n	</div>\n	'),__p+='\n	<div class="space_pb"></div>\n	<div class="sync_pb" style="display:none">\n		<div class="title_pb">\n			<h2><span class="h_tpb">'+(null==(__t=i18n.plan_1)?"":__t)+'项下分解任务状态同步</span></h2>\n		</div>\n		<ul class="list_spb">\n			<li>\n				<a href="javascript:void(0);" title="" class="checkbox checkbox-checked"><span class="ico"></span></a>\n				<span>当'+(null==(__t=i18n.plan_1)?"":__t)+"项完成时，该"+(null==(__t=i18n.plan_1)?"":__t)+'项下分解的任务也自动完成</span>\n			</li>\n			<li>\n				<a href="javascript:void(0);" title="" class="checkbox"><span class="ico"></span></a>\n				<span>当'+(null==(__t=i18n.plan_1)?"":__t)+"项下分解的任务全部完成时，该",i18n.plan_1,__p+='项也自动完成</span>\n			</li>\n		</ul>\n		<div class="action_spb">\n			<button class="btn btn-sure">保存</button>\n		</div>\n	</div>\n</div>';return __p},this.JST["set/set-sidebar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<!-- <li><a href="#set?url='+(null==(__t=webPath)?"":__t)+'/Setting/Avatar&page_id=avatar" data-trigger="false">修改头像</a></li> -->\n<li><a href="#set?page_id=avatar" data-trigger="false">修改头像</a></li>\n',IsShowChangePwd&&(__p+='\n<li><a href="#set?url='+(null==(__t=webPath)?"":__t)+'/Setting/Password&page_id=password" data-trigger="false">修改密码</a></li>\n'),__p+='\n\n<li><a href="#set?url='+(null==(__t=webPath)?"":__t)+'/UserDomainSettings/MailSet&page_id=mail" data-trigger="false">邮件设置</a></li>\n<li><a href="#set?page_id=plan" data-trigger="false">上级与团队</a></li>\n\n',isShowPlan&&IsUsePlanDaily?__p+='\n<li><a href="#set?page_id=planbench" data-trigger="false">'+(null==(__t=i18n.plan_1)?"":__t)+"与总结共享</a></li>\n":isShowPlan?__p+='\n<li><a href="#set?page_id=planbench" data-trigger="false">'+(null==(__t=i18n.plan_1)?"":__t)+"</a></li>\n":IsUsePlanDaily&&(__p+='\n<li><a href="#set?page_id=planbench" data-trigger="false">总结共享</a></li>\n'),__p+="\n",isShowPlan&&(__p+='\n<li><a href="#set?page_id=approvals" data-trigger="false">'+(null==(__t=i18n.plan_1)?"":__t)+'审批设置</a></li>\n<li><a href="#set?page_id=class" data-trigger="false">分类设置</a></li>\n<li><a href="#set?page_id=personal" data-trigger="false">个性化设置</a></li>\n'),__p+="\n",IsShowReward&&(__p+='\n<li><a href="#set?page_id=capital" data-trigger="false">赏金管理</a></li>\n'),__p+="\n",IsShowLogout&&(__p+='\n<li><a href="#set?url='+(null==(__t=webPath)?"":__t)+'/Setting/CancellUser&page_id=cancel" data-trigger="false">注销帐号</a></li>\n');return __p},this.JST["set/user-list-add-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<a href="/u/'+(null==(__t=User.Id)?"":__t)+'" id="'+(null==(__t=User.Id)?"":__t)+'" class="avatar_mla">\n'+(null==(__t=_.convertImage({src:User.UserAvatar.Medium,size:50,shape:"radius",name:User.Name,bgColor:User.UserAvatar.Color,className:1==User.Type?"radius_dashed_img50 photo":" photo"}))?"":__t)+'\n</a>\n<div class="ainfo_mla">\n	<p>'+(null==(__t=User.Name)?"":__t)+"</p>\n	",0==Type&&(__p+='\n	<a href="javascript:void(0);" class="del_mla" data-name="delete" id="'+(null==(__t=User.Id)?"":__t)+'">删除</a>\n	'),__p+="\n</div>";return __p},this.JST["set/user-list-add"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="add_mla">\n	<a class="btn-add-person " href="javascript:void(0);" data-name="add"><span class="icon-add-big"></span></a>\n</div>\n<ul class="list_mla">\n</ul>';return __p},this.JST}),define("views/common/plugins/select/select-view",["talent","templates/set"],function(a){return a.ItemView.extend({defaults:{height:"120",data:{key:"02:00",value:"02:00"},rangeValue:[{key:"00:00",value:"00:00"},{key:"01:00",value:"01:00"},{key:"02:00",value:"02:00"},{key:"03:00",value:"03:00"},{key:"04:00",value:"04:00"},{key:"05:00",value:"05:00"},{key:"06:00",value:"06:00"},{key:"07:00",value:"07:00"},{key:"08:00",value:"08:00"},{key:"09:00",value:"09:00"},{key:"10:00",value:"10:00"},{key:"11:00",value:"11:00"},{key:"12:00",value:"12:00"},{key:"13:00",value:"13:00"},{key:"14:00",value:"14:00"},{key:"15:00",value:"15:00"},{key:"16:00",value:"16:00"},{key:"17:00",value:"17:00"},{key:"18:00",value:"18:00"},{key:"19:00",value:"19:00"},{key:"20:00",value:"20:00"},{key:"21:00",value:"21:00"},{key:"22:00",value:"22:00"},{key:"23:00",value:"23:00"}]},className:"ns-select",tagName:"ul",template:a._.template('<%_.each(rangeValue,function(item,index){%><li data-key="<%=item.key%>"><span class="icon-right-small-default icon_shs"></span><span class="txt"><%=item.value%></span></li><%})%>'),ui:{li:"li"},modelEvents:{"change:data":"render"},events:function(){var a={};return a["click li"]="_itemHandler",a},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),this.model.set(this.settings),this.$el.off("mousedown.Hour-Select-View"),this.$el.on("mousedown.Hour-Select-View",function(a){a.stopPropagation()}),a.$(document).off("mousedown.Hour-Select-View"),a.$(document).on("mousedown.Hour-Select-View",function(){b.$el.hide()})},onRender:function(){this.$el.css("height","78px")},_itemHandler:function(b){b.stopPropagation();for(var c=a.$(b.currentTarget),d=c.attr("data-key"),e=null,f=this.settings.rangeValue,g=0,h=f.length;h>g;g++)f[g].key==d&&(e=f[g]);this.$el.find("li").removeClass("active"),c.addClass("active"),this.trigger("select",e),this.model.set({data:e},{silent:!0}),this.$el.hide()},show:function(a,b){var c=(a.offset(),a.outerHeight(),a.outerWidth()-2,this.model.get("data")),d=this.$el.find("li");d.removeClass("active"),this.$el.scrollTop(0);var e=this.$el.find('li[data-key="'+c.key+'"]');e.addClass("active"),Talent.Context.setPosition(a,this.$el,{container:b?b:$("body"),pos:"bottom"}),this.$el.show(),e.length&&this.$el.scrollTop(e.position().top)},hide:function(){this.$el.hide()},onClose:function(){this.$el.off("mousedown.Hour-Select-View"),a.$(document).off("mousedown.Hour-Select-View")}})}),define("views/common/plugins/popup/transfer-task-view",["talent","templates/common","tdialog","moment","momentZH","views/common/plugins/select/select-view"],function(a,b,c,d,e,f){return a.ItemView.extend({defaults:{displayType:"inline",node:null,isShowStar:!0,data:null,defaultData:null,isShowCancelMile:!0},template:b["common/plugins/popup/transfer-task-pop"],ui:{cancel:'[data-name="cancel"]',sure:'[data-name="sure"]',cancelMile:'[data-name="cancel-mile"]',chooseMile:'[data-name="choose-miles"]',txtLabel:'[data-name="choose-miles"] .txt',icon:'[data-name="choose-miles"] .icon'},events:function(){var a={};return a["click "+this.ui.cancel]="_onCancel",a["click "+this.ui.sure]="_onSure",a["click "+this.ui.cancelMile]="_onCancelMile",a["click "+this.ui.chooseMile]="_chooseLevel",a},modelEvents:{change:"render"},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.settings.container=this.settings.container||$("body"),this.model.set({data:this.settings.defaultData}),this.renderTag=!0,this._renderDialog()},_renderDialog:function(){var b=this;this.Dialog=new c({sure:!1,cancel:!1,showClosed:!1,type:"default",minWidth:400,className:"_tt_dialog tt-common-popup ns-transfer-task",displayType:this.settings.displayType}),"inline"==this.settings.displayType?this.settings.container.append(this.Dialog.render().$el):a.$("body").append(this.Dialog.render().$el),this.Dialog.$el.on("click",function(a){a.stopPropagation(),b.selectView&&b.selectView.$el.hide()})},_renderSelectView:function(){this.selectView&&this.selectView.close(),this.selectView=new f({data:this.settings.defaultData,rangeValue:this.settings.data,height:this.settings.height||!1}),this.listenTo(this.selectView,"select",function(a){var b=(a.key,a.value);this.ui.txtLabel.text(b),this.ui.chooseMile.addClass("selected"),this.model.set({data:a},{silent:!0})},this),this.$el.append(this.selectView.render().el)},templateHelpers:function(){return this.settings},onRender:function(){this._renderSelectView();var b=this;this.renderTag&&(this.Dialog.show(this.settings.node,this.el,{pos:"topLeft",arrow:!1,container:this.settings.container}),b.Dialog.hide(),a.$(document).off("click.transferTaskPop"),a.$(document).on("click.transferTaskPop",function(){b.Dialog.hide()}),this.renderTag=!1)},_chooseLevel:function(a){var b=this.$(a.currentTarget);this.selectView.show(b,this.$el),a.stopPropagation()},_onCancel:function(){this.hide()},_onSure:function(){this.trigger("sure",this.model.get("data")),this.hide()},_onCancelMile:function(){this.trigger("cancelMile"),this.hide()},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},onClose:function(){this.Dialog&&this.Dialog.close(),a.$(document).off("click.transferTaskPop"),this.selectView&&this.selectView.close()}})}),define("views/work/project-milepost-view",["talent","templates/work","tdialog","TitaWidget","$.autoresize","moment","momentZH","$.tipsy","UserSelector","collections/smember-group-collection","$.daterangepicker","views/common/empty-view","views/common/plugins/popup/transfer-task-view","helpers/context"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a.ItemView.extend({template:b["work/work-mile-task-item"],className:"taskItem",ui:{},events:function(){var a={};return a},initialize:function(){},templateHelpers:function(){var a=this.model,b=f(a.get("startDate")),c=f(a.get("deadline")),d=b.format("YYYY/MM/DD"),e=c.format("YYYY/MM/DD"),g=f().format("YYYY");return b.format("YYYY")==g&&(d=b.format("MM/DD")),c.format("YYYY")==g&&(e=c.format("MM/DD")),{startDate:d,endDate:e,Context:n}},onRender:function(){var a=this.model,b=a.collection,c=b.length,d=b.indexOf(a);d==c-1&&this.$el.addClass("last")},onClose:function(){}}),p=a.CompositeView.extend({template:b["work/work-milepost-item"],className:"milepost-item",itemView:o,itemViewContainer:".sub-container",emptyView:l,ui:{milepostName:".input_container",dateLabel:'[data-name="date"]',packUp:'[data-name="packup"]',sub:".sub-container-wraper"},templateHelpers:function(){if(0==this.model.id)return{};var a=this.model,b=a.collection,c=b.length,d=b.indexOf(a),e=d==c-1,g=f(a.get("startDate")),h=f(a.get("endDate")),i=g.format("YYYY/MM/DD"),j=h.format("YYYY/MM/DD"),k=f().format("YYYY"),l=a.toJSON();return g.format("YYYY")==k&&(i=g.format("MM/DD")),h.format("YYYY")==k&&(j=h.format("MM/DD")),{isLast:e,index:d,startDate:i,endDate:j,isWarn:3==l.status&&(0==l.finishTaskTotal||l.finishTaskTotal!=l.taskTotal)}},events:function(){var a={};return a["click "+this.ui.dateLabel]="_renderDatepicker",a},collectionEvents:{add:"_collectionLengthChange",remove:"_collectionLengthChange",reset:"_collectionLengthChange"},initialize:function(){},itemViewOptions:function(){return{emptyContext:"暂无可转移任务"}},onRender:function(){var a=this.model.get("editable"),b=this;this.$(".principle .icon").attr({"original-title":a?"修改负责人":""}),2==this.model.get("status")&&this.$el.addClass("current"),setTimeout(function(){b.ui.milepostName.autosize(),b.ui.milepostName.trigger("autosize.resize")},0)},_renderDatepicker:function(b){b.stopPropagation();var c=Talent.$(b.currentTarget),e=this;this.dateTimePickerView&&this.dateTimePickerView.close();var g={isShowDateView:!0,isShowCycleView:!1,isShowLongView:!1,isShowTab:!1};g.rangepickerOptions={startDate:this.model.get("startDate"),endDate:this.model.get("endDate"),timePicker:!1,format:"YYYY/MM/DD"},this.dateTimePickerView=new d.DateTimePickerView(g),this.listenTo(this.dateTimePickerView,"sure",function(b,c){var d=f(new Date(c.startDate)),g=f(new Date(c.endDate)),h=f(e.model.get("startDate")),i=f(e.model.get("endDate")),j=e.options.detailModel,k=f(j.get("StartDate")),l=f(j.get("EndDate")),m=e.model.toJSON(),n=e.options.detailModel.get("WorkId");(d.format("YYYY/MM/DD")!=h.format("YYYY/MM/DD")||g.format("YYYY/MM/DD")!=i.format("YYYY/MM/DD"))&&((d.isBefore(k)||g.isAfter(l))&&e.trigger("outOfRange",e.ui.dateLabel),a.app.request("WorkMile:updateDate",{workMileStoneId:m.mileStoneId,workId:n,mileStoneName:m.mileStoneName,startDate:d.format("YYYY/MM/DD"),endDate:g.format("YYYY/MM/DD"),principalId:m.user.UserId}).done(function(){setTimeout(function(){e.trigger("request")},2e3)}))},this),this.$el.append(this.dateTimePickerView.render().el),this.dateTimePickerView.onShow(),this.dateTimePickerView.show(c,{container:this.$el,pos:"bottom"})},_collectionLengthChange:function(){this.collection.length>0?this.ui.packUp.show():this.ui.packUp.hide()},onClose:function(){this.dateTimePickerView&&this.dateTimePickerView.close()}}),q=a.CompositeView.extend({template:b["work/work-milepost-composite"],noClassTemplate:b["work/work-mile-no-class-item"],itemView:p,itemViewContainer:".milepost-container",className:"ns-work-milepost",emptyView:l,ui:{createArea:'div[data-name="create"]',milepostName:".input_container",principleUser:'div[data-name="principle"]',transfer:'[data-name="transfer"]',transferTask:'[data-name="transfer-task"]',deleteMile:'[data-name="delete"]',operate:".operate",sub:".sub-container-wraper",packUp:'[data-name="packup"]',noClass:".no-class-item"},initialize:function(){var b=this;this.userInfo=n.getUserInfo(),a.$(document).on("click.milepost-operate-pop",function(){b.$(".operate-btns").hide()}),this.on("itemview:outOfRange",function(a,b){this._tipDialog(b,{topBias:0,msg:"所选时段超出了项目起止时间",klass:"warn",autoHide:3e3,pos:"bottomRight"})},this),this.on("itemview:request",function(){this.trigger("request")},this)},itemViewOptions:function(){return{detailModel:this.model,emptyContext:"尚未设置里程碑"}},events:function(){var a={};return a["focusin "+this.ui.milepostName]="onInputFocusIn",a["click .btn_blue"]="onSubmit",a["click .btn_white"]="onCancel",a["click "+this.ui.deleteMile]="_deleteMile",a["click "+this.ui.operate]="_onOperate",a["click "+this.ui.packUp]="_packUp",a["click "+this.ui.transferTask]="_transferTask",a["click "+this.ui.transfer]="_getTasks",a},collectionEvents:{add:"_collectionLengthChange",remove:"_collectionLengthChange",rest:"_collectionLengthChange"},onRender:function(){var a=this,b=(this.userInfo.Id,this.model.get("Principal"),this.model.get("CreateUser"),this.model.get("IsPrincipal")),c=this.model.get("IsCreator");IsManage=this.model.get("IsManage"),(b||c||IsManage)&&this._renderCreateView(),this.$("[original-title]").tipsy({gravity:"s"}),this.userSelectorView=new i({collection:new j});var d=this.$('[data-name="principle"]').filter(".cursor");this.userSelectorView.addNode(d,{muti:!1,container:this.$el}),d.on("submit",function(b,c){b.stopPropagation(),a._changeResiponsile(b,c)}),this._checkHasTask(),this._renderNoClassView(),this._isShowNoClassView()},_collectionLengthChange:function(){this._isShowNoClassView()},_checkHasTask:function(){var b=this;a.app.request("WorkMile:getMileTask",{workId:this.model.get("WorkId"),mileStoneId:0}).done(function(a){a&&a.length&&b.collection.length>0?b.ui.noClass.show():b.ui.noClass.hide()})},_renderNoClassView:function(){var b=a.Model.extend({collection:this.collection,idAttribute:"mileStoneId"});this.noClassView=new p({detailModel:this.model,model:new b({mileStoneId:0}),template:this.noClassTemplate}),this.ui.noClass.html(this.noClassView.render().$el)},_isShowNoClassView:function(){this.collection.length>0?this.$(".no-class-item").show():this.$(".no-class-item").hide()},_transferTask:function(b){b.stopPropagation();{var c=this,d=this.$(b.currentTarget),e=this._getModelByNodes(d);this.model.toJSON()}if(taskId=d.attr("task-id"),workId=this.model.get("WorkId"),view=this._getChildViewById(e.id),oldWorkMileStoneId=e.id,isShowCancelMile=!0,defaultData={key:e.get("mileStoneId"),value:e.get("mileStoneName")},0==e.id){view=this.noClassView;
{this.collection.at(0)}defaultData={key:0,value:"未设置里程碑的任务"},isShowCancelMile=!1}this.transferTaskView&&this.transferTaskView.close(),this.transferTaskView=new m({node:d,data:this._formatKeyValueMile(this.collection),defaultData:defaultData,isShowCancelMile:isShowCancelMile,height:150,container:d.parents(".taskItem")}),this.listenTo(this.transferTaskView,"sure",function(b){var g=c.collection.get(b.key),h=view.collection.findWhere({feedId:taskId}),i=f(h.get("startDate").split(" ")[0]),j=f(h.get("deadline").split(" ")[0]),k=f(g.get("startDate")),l=f(g.get("endDate"));(i.isBefore(k)||j.isAfter(l))&&c._tipDialog(d,{topBias:0,msg:"任务时间超出里程碑的起止时间",klass:"warn",autoHide:3e3,pos:"bottomRight"}),a.app.request("WorkMile:updateTaskMileStone",{workMileStoneId:b.key,oldWorkMileStoneId:oldWorkMileStoneId,workId:workId,taskId:taskId}).done(function(){var a=view.collection,b=a.findWhere({feedId:taskId});a.remove(b),g&&g.set("taskTotal",g.get("taskTotal")+1),e.set("taskTotal",e.get("taskTotal")-1)})}),this.listenTo(this.transferTaskView,"cancelMile",function(){a.app.request("WorkMile:updateTaskMileStone",{workMileStoneId:0,oldWorkMileStoneId:oldWorkMileStoneId,workId:workId,taskId:taskId}).done(function(){var a=view.collection,b=a.findWhere({feedId:taskId});a.remove(b),e.set("taskTotal",e.get("taskTotal")-1)})}),this.transferTaskView.render(),this.transferTaskView.show()},_formatKeyValueMile:function(a){for(var b=a.toJSON(),c=[],d=0,e=b.length;e>d;d++)c.push({key:b[d].mileStoneId,value:b[d].mileStoneName});return c},_packUp:function(){this.ui.sub.hide()},_onOperate:function(a){var b=this.$(a.currentTarget);dropdowns=b.siblings(".operate-btns"),dropdowns.show(),a.stopPropagation()},_changeResiponsile:function(b,c){var d=this,e=d.$(b.currentTarget),f=d._getModelByNodes(e);f.get("editable")&&a.app.request("WorkTable:checkworkuser",{workId:this.model.get("WorkId"),toUserId:c.Id}).done(function(){a.app.request("WorkMile:updatePrincipal",{workMileStoneId:f.get("mileStoneId"),workId:d.model.get("WorkId"),mileStoneName:f.get("mileStoneName"),startDate:f.get("startDate"),endDate:f.get("endDate"),principalId:c.Id}).done(function(){d.trigger("request")}).fail(function(a){d._tipDialog(e,{topBias:0,msg:a,klass:"warn",autoHide:3e3,pos:"bottomRight"})})}).fail(function(){d._tipDialog(e,{topBias:0,msg:"非项目成员不能成为里程碑负责人",klass:"warn",pos:"bottom",autoHide:3e3})})},_getChildViewById:function(a){var b=null;return this.children.each(function(c){c.model.id==a&&(b=c)}),b},_getTasks:function(b){var c=this,d=this.$(b.currentTarget),e=d.parents(".milepost-item").find(".principle").attr("data-id"),f=this._getChildViewById(e);a.app.request("WorkMile:getMileTask",{workId:this.model.get("WorkId"),mileStoneId:e}).done(function(a){a&&a.length?0!=e?(f.collection.reset(a),f.ui.sub.show()):(c.noClassView.collection.reset(a),c.noClassView.ui.sub.show()):c._tipDialog(d.parents(".milepost-item").find(".operate"),{topBias:0,msg:"暂无可转移任务",klass:"warn",autoHide:3e3,pos:"bottomRight"})})},_getModelByNodes:function(b){var c=b.parents(".milepost-item").find(".principle").attr("data-id"),d=this.collection.get(c),e=a.Model.extend({collection:this.collection,idAttribute:"mileStoneId"});return d||(d=new e({mileStoneId:c})),d},onSubmit:function(b){b.stopPropagation();var c=this.$(b.currentTarget).parent(),d=this._getModelByNodes(c),e=c.siblings(".input_container"),f=e.val();e.removeClass("input_focus_bule"),c.slideUp("slow"),a.app.request("WorkMile:updateName",{workMileStoneId:d.id,workId:this.model.get("WorkId"),mileStoneName:f,startDate:d.get("startDate"),endDate:d.get("endDate"),principalId:d.get("user").UserId}).done(function(){d.set({mileStoneName:f})}).fail(function(){e.val(d.get("mileStoneName"))})},onCancel:function(a){var b=this.$(a.currentTarget).parent(),c=this._getModelByNodes(b),d=b.siblings(".input_container");d.val(c.get("mileStoneName")),b.slideUp("slow"),d.removeClass("input_error input_focus_bule")},onInputFocusIn:function(a){var b=this.$(a.target);b.hasClass("input_error")||(b.siblings(".project_btn_group").slideDown("slow"),b.addClass("input_focus_bule"))},_renderCreateView:function(){var b=this;this.taskCreateView=new TaskCreateView({defaultText:"填写心得",emptyContext:"需要分解具体的事吗？试试添加新的心得",shape:"line",topArea:{classTypeShow:!1,leftInput:{show:!0,defaultText:"创建新里程碑",iconShow:!0,iconClassName:"icon-milepost"},principalShow:!0,setCycle:!1,setDoubleDate:!0,showLong:!1,format:"YYYY/MM/DD",timePicker:!1},tabToolArea:{setApplyUserShow:!1},bottomArea:{setFileUpload:!1,setPubBtn:{show:!0,defaultText:"创建"},setPrivateBtn:!1,isShowPackUpBtn:!1,setMessage:!1},PrincipalUser:this.model.get("Principal")}),this.listenTo(this.taskCreateView,"postData",function(c){var d=c.PrincipalUser;a.app.request("WorkTable:checkworkuser",{workId:this.model.get("WorkId"),toUserId:d}).done(function(){a.app.request("WorkMile:addMile",{workId:b.model.get("WorkId"),mileStoneName:c.TaskName,startDate:f(c.StartDate).format("YYYY/MM/DD"),endDate:f(c.EndDate).format("YYYY/MM/DD"),PrincipalId:c.PrincipalUser}).done(function(){b.trigger("request")})}).fail(function(){b._tipDialog(b.taskCreateView.$(".pub_cpsw "),{topBias:0,msg:"非项目成员不能成为里程碑负责人",klass:"warn",pos:"bottom",autoHide:3e3}),b.taskCreateView._submitError()})}),this.listenTo(this.taskCreateView,"selectDate",function(a){var b=f(f(a.startDate).format("YYYY/MM/DD")),c=f(f(a.endDate).format("YYYY/MM/DD")),d=this.model,e=f(f(d.get("StartDate")).format("YYYY/MM/DD")),g=f(f(d.get("EndDate")).format("YYYY/MM/DD"));(b.isBefore(e)||c.isAfter(g))&&this._tipDialog(a.node,{topBias:0,msg:"所选时段超出了项目起止时间",klass:"warn",autoHide:3e3,pos:"bottomRight"})}),this.ui.createArea.html(this.taskCreateView.render().el)},_renderCreateView:function(){var b=this;this.taskCreateView=new d.TaskCreateView({privateRangeOptions:!1,extendPersonOptions:!1,applyUserOptions:!1,participatorOptions:!1,replaceOptions:!1,hourDateOptions:!1,classOptions:!1,richEditorOptions:!1,nameOptions:{defaultText:"创建新里程碑",iconShow:!0,iconClassName:"icon-milepost"},dataTimeRangeOptions:{isShowTab:!1,isShowCycleView:!1,isShowLongView:!1,rangepickerOptions:{timePicker:!1,format:"YYYY/MM/DD"}},bottomOptions:{isShowFileUpload:!1,isShowPrivateBtn:!1,isShowMessage:!1,isShowPackUpBtn:!1,pubBtnText:"创建"},requestSubmit:function(c){var d=new Talent.$.Deferred,e=c.PrincipalUser;return a.app.request("WorkTable:checkworkuser",{workId:b.model.get("WorkId"),toUserId:e}).done(function(){a.app.request("WorkMile:addMile",{workId:b.model.get("WorkId"),mileStoneName:c.TaskName,startDate:f(new Date(c.StartDate)).format("YYYY/MM/DD"),endDate:f(new Date(c.EndDate)).format("YYYY/MM/DD"),PrincipalId:c.PrincipalUser}).done(function(){b.trigger("request"),d.resolve()})}).fail(function(a){d.reject(a)}),d}}),this.listenTo(this.taskCreateView,"selectDate",function(a,b){var c=f(new Date(b.startDate)).format("YYYY/MM/DD"),d=f(new Date(b.endDate)).format("YYYY/MM/DD"),e=this.model,g=f(new Date(e.get("StartDate"))).format("YYYY/MM/DD"),h=f(new Date(e.get("EndDate"))).format("YYYY/MM/DD");(f(new Date(c)).isBefore(g)||f(new Date(d)).isAfter(h))&&this._tipDialog(a,{topBias:-47,msg:"所选时段超出了项目起止时间",klass:"warn",autoHide:3e3,pos:"bottomRight"})}),this.ui.createArea.html(this.taskCreateView.render().el)},_deleteMile:function(b){var d=this,e=this.$(b.currentTarget),f=this._getModelByNodes(e);return f.get("taskTotal")>0?this._tipDialog(e.parents(".milepost-item").find(".operate"),{msg:"该里程碑下有待执行的任务，请转移任务后才能删除该里程碑",klass:"warn",autoHide:3e3,pos:"bottomRight"}):(this.delDialog&&this.delDialog.close(),this.delDialog=new c({type:"tipsy",cancel:!0,sure:function(){a.app.request("WorkMile:deleteMile",{workMileStoneId:f.id}).done(function(){d.collection.remove(f),d.render(),d.delDialog.close()})}}),this.delDialog.render().$el.appendTo("body"),void this.delDialog.show(e.parents(".milepost-right").find(".operate"),"此操作不可恢复，您确定删除吗？",{pos:"bottomRight",className:"ask",arrow:!1}))},_tipDialog:function(b,d){this.tipDialog&&this.tipDialog.close();var e={sure:!1,cancel:!1,pos:"topCenter",klass:"success"};d=a._.extend({},e,d),this.tipDialog=new c({type:"tipsy",sure:d.sure,cancel:d.cancel,autoHide:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(b,d.msg,{pos:d.pos,className:d.klass,arrow:!1,autoHide:d.autoHide,topBias:d.topBias})},onClose:function(){this.taskCreateView&&this.taskCreateView.close(),this.transferTaskView&&this.transferTaskView.close(),a.$(document).off("click.milepost-operate-pop"),this.delDialog&&this.delDialog.close(),this.tipDialog&&this.tipDialog.close()}});return q}),"undefined"==typeof window.dhx4&&(window.dhx4={version:"4.1.3",skin:null,skinDetect:function(a){return{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace"}[this.readFromCss(a+"_skin_detect")]||null},readFromCss:function(a,b){var c=document.createElement("DIV");c.className=a,null!=document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c);var d=c[b||"offsetWidth"];return c.parentNode.removeChild(c),c=null,d},lastId:1,newId:function(){return this.lastId++},zim:{data:{},step:5,first:function(){return 100},last:function(){var a=this.first();for(var b in this.data)a=Math.max(a,this.data[b]);return a},reserve:function(a){return this.data[a]=this.last()+this.step,this.data[a]},clear:function(a){null!=this.data[a]&&(this.data[a]=null,delete this.data[a])}},s2b:function(a){return"string"==typeof a&&(a=a.toLowerCase()),1==a||1==a||"true"==a||"1"==a||"yes"==a||"y"==a},s2j:function(s){var obj=null;dhx4.temp=null;try{eval("dhx4.temp="+s)}catch(e){dhx4.temp=null}return obj=dhx4.temp,dhx4.temp=null,obj},absLeft:function(a){return"string"==typeof a&&(a=document.getElementById(a)),this.getOffset(a).left},absTop:function(a){return"string"==typeof a&&(a=document.getElementById(a)),this.getOffset(a).top},_aOfs:function(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}},_aOfsRect:function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},getOffset:function(a){return a.getBoundingClientRect?this._aOfsRect(a):this._aOfs(a)},_isObj:function(a){return null!=a&&"object"==typeof a&&"undefined"==typeof a.length},_copyObj:function(a){if(this._isObj(a)){var b={};for(var c in a)b[c]="object"==typeof a[c]&&null!=a[c]?this._copyObj(a[c]):a[c]}else for(var b=[],c=0;c<a.length;c++)b[c]="object"==typeof a[c]&&null!=a[c]?this._copyObj(a[c]):a[c];return b},screenDim:function(){var a=navigator.userAgent.indexOf("MSIE")>=0,b={};return b.left=document.body.scrollLeft,b.right=b.left+(window.innerWidth||document.body.clientWidth),b.top=Math.max((a?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop),b.bottom=b.top+(a?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight),b},selectTextRange:function(a,b,c){a="string"==typeof a?document.getElementById(a):a;var d=a.value.length;if(b=Math.max(Math.min(b,d),0),c=Math.min(c,d),a.setSelectionRange)try{a.setSelectionRange(b,c)}catch(e){}else if(a.createTextRange){var f=a.createTextRange();f.moveStart("character",b),f.moveEnd("character",c-d);try{f.select()}catch(e){}}},transData:null,transDetect:function(){if(null==this.transData){this.transData={transProp:!1,transEv:null};var a={MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"transitionend",transition:"transitionend"};for(var b in a)0==this.transData.transProp&&null!=document.documentElement.style[b]&&(this.transData.transProp=b,this.transData.transEv=a[b]);a=null}return this.transData},_xmlNodeValue:function(a){for(var b="",c=0;c<a.childNodes.length;c++)b+=null!=a.childNodes[c].nodeValue?a.childNodes[c].nodeValue.toString().replace(/^[\n\r\s]{0,}/,"").replace(/[\n\r\s]{0,}$/,""):"";return b}},window.dhx4.isIE=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isIE6=null==window.XMLHttpRequest&&navigator.userAgent.indexOf("MSIE")>=0,window.dhx4.isIE7=navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0,window.dhx4.isIE8=navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isOpera=navigator.userAgent.indexOf("Opera")>=0,window.dhx4.isChrome=navigator.userAgent.indexOf("Chrome")>=0,window.dhx4.isKHTML=navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0,window.dhx4.isFF=navigator.userAgent.indexOf("Firefox")>=0,window.dhx4.isIPad=navigator.userAgent.search(/iPad/gi)>=0),"undefined"==typeof window.dhx4.ajax&&(window.dhx4.ajax={cache:!1,method:"get",parse:function(a){if("string"!=typeof a)return a;if(a=a.replace(/^[\s]+/,""),window.DOMParser&&!dhx4.isIE)var b=(new window.DOMParser).parseFromString(a,"text/xml");else if(window.ActiveXObject!==window.undefined){var b=new window.ActiveXObject("Microsoft.XMLDOM");b.async="false",b.loadXML(a)}return b},xmltop:function(a,b,c){if("undefined"==typeof b.status||b.status<400){var d=b.responseXML?b.responseXML||b:dhx4.ajax.parse(b.responseText||b);if(d&&null!==d.documentElement&&!d.getElementsByTagName("parsererror").length)return d.getElementsByTagName(a)[0]}return-1!==c&&dhx4.callEvent("onLoadXMLError",["Incorrect XML",arguments[1],c]),document.createElement("DIV")},xpath:function(a,b){if(b.nodeName||(b=b.responseXML||b),dhx4.isIE)return b.selectNodes(a)||[];for(var c,d=[],e=(b.ownerDocument||b).evaluate(a,b,null,XPathResult.ANY_TYPE,null);c=e.iterateNext();)d.push(c);return d},query:function(a){dhx4.ajax._call(a.method||"GET",a.url,a.data||"",a.async||!0,a.callback,null,a.headers)},get:function(a,b){this._call("GET",a,null,!0,b)},getSync:function(a){return this._call("GET",a,null,!1)},put:function(a,b,c){this._call("PUT",a,b,!0,c)},del:function(a,b,c){this._call("DELETE",a,b,!0,c)},post:function(a,b,c){1==arguments.length?b="":2!=arguments.length||"function"!=typeof b&&"function"!=typeof window[b]?b=String(b):(c=b,b=""),this._call("POST",a,b,!0,c)},postSync:function(a,b){return b=null==b?"":String(b),this._call("POST",a,b,!1)},getLong:function(a,b){this._call("GET",a,null,!0,b,{url:a})},postLong:function(a,b,c){2==arguments.length&&(c=b,b=""),this._call("POST",a,b,!0,c,{url:a,postData:b})},_call:function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==d&&(h.onreadystatechange=function(){if(4==h.readyState||1==i&&3==h.readyState){if((200!=h.status||""==h.responseText)&&!dhx4.callEvent("onAjaxError",[h]))return;window.setTimeout(function(){"function"==typeof e&&e.apply(window,[{xmlDoc:h}]),null!=f&&("undefined"!=typeof f.postData?dhx4.ajax.postLong(f.url,f.postData,e):dhx4.ajax.getLong(f.url,e)),e=null,h=null},1)}}),"GET"==a&&1!=this.cache&&(b+=(b.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),h.open(a,b,d),g)for(var j in g)h.setRequestHeader(j,g[j]);else"POST"==a.toUpperCase()||"PUT"==a||"DELETE"==a?h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==a&&(c=null);return h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c),d?void 0:{xmlDoc:h}}}),"undefined"==typeof window.dhx4._eventable&&(window.dhx4._eventable=function(a,b){return"clear"==b?(a.detachAllEvents(),a.dhxevs=null,a.attachEvent=null,a.detachEvent=null,a.checkEvent=null,a.callEvent=null,a.detachAllEvents=null,void(a=null)):(a.dhxevs={data:{}},a.attachEvent=function(a,b){a=String(a).toLowerCase(),this.dhxevs.data[a]||(this.dhxevs.data[a]={});var c=window.dhx4.newId();return this.dhxevs.data[a][c]=b,c},a.detachEvent=function(a){for(var b in this.dhxevs.data){var c=0;for(var d in this.dhxevs.data[b])d==a?(this.dhxevs.data[b][d]=null,delete this.dhxevs.data[b][d]):c++;0==c&&(this.dhxevs.data[b]=null,delete this.dhxevs.data[b])}},a.checkEvent=function(a){return a=String(a).toLowerCase(),null!=this.dhxevs.data[a]},a.callEvent=function(a,b){if(a=String(a).toLowerCase(),null==this.dhxevs.data[a])return!0;var c=!0;for(var d in this.dhxevs.data[a])c=this.dhxevs.data[a][d].apply(this,b)&&c;return c},a.detachAllEvents=function(){for(var a in this.dhxevs.data){for(var b in this.dhxevs.data[a])this.dhxevs.data[a][b]=null,delete this.dhxevs.data[a][b];this.dhxevs.data[a]=null,delete this.dhxevs.data[a]}},void(a=null))},dhx4._eventable(dhx4)),"undefined"==typeof window.dhtmlx&&(window.dhtmlx={extend:function(a,b){for(var c in b)a[c]||(a[c]=b[c]);return a},extend_api:function(a,b,c){var d=window[a];d&&(window[a]=function(a){if(a&&"object"==typeof a&&!a.tagName){var c=d.apply(this,b._init?b._init(a):arguments);for(var e in dhtmlx)b[e]&&this[b[e]](dhtmlx[e]);for(var e in a)b[e]?this[b[e]](a[e]):0===e.indexOf("on")&&this.attachEvent(e,a[e])}else var c=d.apply(this,arguments);return b._patch&&b._patch(this),c||this},window[a].prototype=d.prototype,c&&dhtmlx.extend(window[a].prototype,c))},url:function(a){return-1!=a.indexOf("?")?"&":"?"}}),_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,(-1!=navigator.appVersion.indexOf("MSIE 8.0")||-1!=navigator.appVersion.indexOf("MSIE 9.0")||-1!=navigator.appVersion.indexOf("MSIE 10.0")||document.documentMode>7)&&"BackCompat"!=document.compatMode&&(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),"undefined"==typeof window.dhtmlxEvent,null==dhtmlxEvent.touchDelay&&(dhtmlxEvent.touchDelay=2e3),"undefined"==typeof dhtmlxEvent.initTouch&&(dhtmlxEvent.initTouch=function(){function a(){if(c){var a=document.createEvent("HTMLEvents");a.initEvent("dblclick",!0,!0),c.dispatchEvent(a),b=c=null}}var b,c,d,e;dhtmlxEvent(document.body,"touchstart",function(f){c=f.touches[0].target,d=f.touches[0].clientX,e=f.touches[0].clientY,b=window.setTimeout(a,dhtmlxEvent.touchDelay)}),dhtmlxEvent(document.body,"touchmove",function(a){b&&(Math.abs(a.touches[0].clientX-d)>50||Math.abs(a.touches[0].clientY-e)>50)&&(window.clearTimeout(b),b=c=!1)}),dhtmlxEvent(document.body,"touchend",function(){b&&(window.clearTimeout(b),b=c=!1)}),dhtmlxEvent.initTouch=function(){}}),window.dhtmlx||(window.dhtmlx={}),function(){function a(a,b){var d=a.callback;c(!1),a.box.parentNode.removeChild(a.box),m=a.box=null,d&&d(b)}function b(b){if(m){b=b||event;var c=b.which||event.keyCode;return dhtmlx.message.keyboard&&((13==c||32==c)&&a(m,!0),27==c&&a(m,!1)),b.preventDefault&&b.preventDefault(),!(b.cancelBubble=!0)}}function c(a){c.cover||(c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover));document.body.scrollHeight;c.cover.style.display=a?"inline-block":"none"}function d(a,b){var c="dhtmlx_"+a.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+c+"' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){n.area||(n.area=document.createElement("DIV"),n.area.className="dhtmlx_message_area",n.area.style[n.position]="5px",document.body.appendChild(n.area)),n.hide(a.id);var b=document.createElement("DIV");return b.innerHTML="<div>"+a.text+"</div>",b.className="dhtmlx-info dhtmlx-"+a.type,b.onclick=function(){n.hide(a.id),a=null},"bottom"==n.position&&n.area.firstChild?n.area.insertBefore(b,n.area.firstChild):n.area.appendChild(b),a.expire>0&&(n.timers[a.id]=window.setTimeout(function(){n.hide(a.id)},a.expire)),n.pull[a.id]=b,b=null,a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type,f.setAttribute("dhxbox",1);var g="";if(b.width&&(f.style.width=b.width),b.height&&(f.style.height=b.height),b.title&&(g+='<div class="dhtmlx_popup_title">'+b.title+"</div>"),g+='<div class="dhtmlx_popup_text"><span>'+(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">',c&&(g+=d(b.ok||"OK",!0)),e&&(g+=d(b.cancel||"Cancel",!1)),b.buttons)for(var h=0;h<b.buttons.length;h++)g+=d(b.buttons[h],h);if(g+="</div>",f.innerHTML=g,b.content){var i=b.content;"string"==typeof i&&(i=document.getElementById(i)),"none"==i.style.display&&(i.style.display=""),f.childNodes[b.title?1:0].appendChild(i)}return f.onclick=function(c){c=c||event;var d=c.target||c.srcElement;if(d.className||(d=d.parentNode),"dhtmlx_popup_button"==d.className.split(" ")[0]){var e=d.getAttribute("result");e="true"==e||("false"==e?!1:e),a(b,e)}},b.box=f,(c||e)&&(m=b),f}function g(a,d,e){var g=a.tagName?a:f(a,d,e);a.hidden||c(!0),document.body.appendChild(g);var h=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-g.offsetWidth)/2)),i=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-g.offsetHeight)/2));return g.style.top="top"==a.position?"-3px":i+"px",g.style.left=h+"px",g.onkeydown=b,g.focus(),a.hidden&&dhtmlx.modalbox.hide(g),g}function h(a){return g(a,!0,!1)}function i(a){return g(a,!0,!0)}function j(a){return g(a)}function k(a,b,c){return"object"!=typeof a&&("function"==typeof b&&(c=b,b=""),a={text:a,type:b,callback:c}),a}function l(a,b,c,d){return"object"!=typeof a&&(a={text:a,type:b,expire:c,id:d}),a.id=a.id||n.uid(),a.expire=a.expire||n.expire,a}var m=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",b,!0),dhtmlx.alert=function(){var a=k.apply(this,arguments);return a.type=a.type||"confirm",h(a)},dhtmlx.confirm=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",i(a)},dhtmlx.modalbox=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",j(a)},dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var n=dhtmlx.message=function(a){a=l.apply(this,arguments),a.type=a.type||"info";var b=a.type.split("-")[0];switch(b){case"alert":return h(a);case"confirm":return i(a);case"modalbox":return j(a);default:return e(a)}};n.seed=(new Date).valueOf(),n.uid=function(){return n.seed++},n.expire=4e3,n.keyboard=!0,n.position="top",n.pull={},n.timers={},n.hideAll=function(){for(var a in n.pull)n.hide(a)},n.hide=function(a){var b=n.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b),b=null},2e3),b.className+=" hidden",n.timers[a]&&window.clearTimeout(n.timers[a]),delete n.pull[a])}}(),dataProcessor.prototype={setTransactionMode:function(a,b){"object"==typeof a?(this._tMode=a.mode||this._tMode,this._headers=this._headers||a.headers,this._payload=this._payload||a.payload):(this._tMode=a,this._tSend=b),"REST"==this._tMode&&(this._tSend=!1,this._endnm=!0)},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=dhx4.s2b(a)},setDataColumns:function(a){this._columns="string"==typeof a?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=dhx4.s2b(a)},enablePartialDataSend:function(a){this._changed=dhx4.s2b(a)},setUpdateMode:function(a,b){this.autoUpdate="cell"==a,this.updateMode=a,this.dnd=b},ignore:function(a,b){this._silent_mode=!0,a.call(b||window),this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a);c=c||"updated";var e=this.obj.getUserData(a,this.action_param);e&&"updated"==c&&(c=e),b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,this.action_param,"")),b||this._clearUpdateFlag(a),this.markRow(a,b,c),b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);if(e&&(d=this.styles[e],b=!0),this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(var f=0;f<e.details.length;f++)e.details[f]&&this.obj[this._methods[1]](a,f,d)}},getState:function(a){return this.obj.getUserData(a,this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}}),this._invalid[a]=b},checkBeforeUpdate:function(){return!0},sendData:function(a){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof a||this._tSend?this.sendAllData():this._in_progress[a]?!1:(this.messages=[],!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",[a,this.messages])?!1:void this._beforeSendData(this._getRowData(a),a))):void 0},_beforeSendData:function(a,b){return this.callEvent("onBeforeUpdate",[b,this.getState(b),a])?void this._sendData(a,b):!1},serialize:function(a,b){if("string"==typeof a)return a;if("undefined"!=typeof b)return this.serialize_one(a,"");var c=[],d=[];for(var e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));return c.push("ids="+this.escape(d.join(","))),dhtmlx.security_key&&c.push("dhx_security="+dhtmlx.security_key),c.join("&")},serialize_one:function(a,b){if("string"==typeof a)return a;var c=[];for(var d in a)if(a.hasOwnProperty(d)){if(("id"==d||d==this.action_param)&&"REST"==this._tMode)continue;c.push(this.escape((b||"")+d)+"="+this.escape(a[d]))}return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());var c=this,d=function(d){var e=[];if(b)e.push(b);else if(a)for(var f in a)e.push(f);return c.afterUpdate(c,d,e)},e=this.serverProcessor+(this._user?dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)dhx4.ajax.get(e+(-1!=e.indexOf("?")?"&":"?")+this.serialize(a,b),d);else if("POST"==this._tMode)dhx4.ajax.post(e,this.serialize(a,b),d);else if("REST"==this._tMode){var f=this.getState(b),g=e.replace(/(\&|\?)editing\=true/,""),h="",i="post";if("inserted"==f?h=this.serialize(a,b):"deleted"==f?(i="DELETE",g=g+("/"==g.slice(-1)?"":"/")+b):(i="PUT",h=this.serialize(a,b),g=g+("/"==g.slice(-1)?"":"/")+b),this._payload)for(var j in this._payload)g=g+dhtmlx.url(g)+this.escape(j)+"="+this.escape(this._payload[j]);dhx4.ajax.query({url:g,method:i,headers:this._headers,data:h,callback:d})}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]){if(this.is_invalid(this.updatedRows[b]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(){for(var a={},b=!1,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];this._in_progress[d]||this.is_invalid(d)||this.callEvent("onBeforeUpdate",[d,this.getState(d),this._getRowData(d)])&&(a[d]=this._getRowData(d,d+this.post_delim),b=!0,this._in_progress[d]=(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return""!==a}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){var b=0;for(b=0;b<this.updatedRows.length&&a!=this.updatedRows[b];b++);return b},defineAction:function(a,b){this._uActions||(this._uActions=[]),this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f="error"!=c&&"invalid"!=c;if(f||this.set_invalid(a,c),this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];"wait"!=this._in_progress[e]&&this.setUpdated(a,!1);var g=a;switch(c){case"inserted":case"insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case"delete":case"deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}"wait"!=this._in_progress[e]?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,this.action_param))),this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c){if(window.JSON)try{var d=JSON.parse(b.xmlDoc.responseText),e=d.action||this.getState(c)||"updated",f=d.sid||c[0],g=d.tid||c[0];return a.afterUpdateCallback(f,g,e,d),void a.finalizeUpdate()}catch(h){}var i=dhx4.ajax.xmltop("data",b.xmlDoc);if(!i)return this.cleanUpdate(c);var j=dhx4.ajax.xpath("//data/action",i);if(!j.length)return this.cleanUpdate(c);for(var k=0;k<j.length;k++){var l=j[k],e=l.getAttribute("type"),f=l.getAttribute("sid"),g=l.getAttribute("tid");a.afterUpdateCallback(f,g,e,l)}a.finalizeUpdate()},cleanUpdate:function(a){if(a)for(var b=0;b<a.length;b++)delete this._in_progress[a[b]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2e3,this._user=b||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(a,b,c,d){this.afterAutoUpdate(a,b,c,d)}),this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b){return"collision"==b?(this._need_update=!0,!1):!0},fullSync:function(){return 1==this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(a,b){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=b,void this._loader.loadXML(a))},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),c=this.serverProcessor+dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&");c=c.replace("editing=true&",""),this.getUpdates(c,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));var c=a._loader.doXPath("//update");if(c.length){a._silent_mode=!0;for(var d=0;d<c.length;d++){var e=c[d].getAttribute("status"),f=c[d].getAttribute("id"),g=c[d].getAttribute("parent");switch(e){case"inserted":a.callEvent("insertCallback",[c[d],f,g]);break;case"updated":a.callEvent("updateCallback",[c[d],f,g]);break;case"deleted":a.callEvent("deleteCallback",[c[d],f,g])}}a._silent_mode=!1}a._update_busy=!1,a=null})}},window.Gantt={_seed:0},Gantt.plugin=function(a){this._ganttPlugin.push(a),a(window.gantt)
},Gantt._ganttPlugin=[],Gantt.getGanttInstance=function(){function dhtmlxDetachEvent(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}function dhtmlxDnD(a,b){b&&(this._settings=b),dhtmlxEventable(this),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(c){b.original_target={target:c.target||c.srcElement},this.dragStart(a,c)},this))}var gantt={version:"3.3.0"};gantt={version:"3.3.0"},dhtmlxEventable=function(obj){obj._silent_mode=!1,obj._silentStart=function(){this._silent_mode=!0},obj._silentEnd=function(){this._silent_mode=!1},obj.attachEvent=function(a,b,c){return a="ev_"+a.toLowerCase(),this[a]||(this[a]=new this._eventCatcher(c||this)),a+":"+this[a].addEvent(b)},obj.callEvent=function(a,b){return this._silent_mode?!0:(a="ev_"+a.toLowerCase(),this[a]?this[a].apply(this,b):!0)},obj.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]},obj._eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var a=!0,b=0;b<dhx_catch.length;b++)if(dhx_catch[b]){var c=dhx_catch[b].apply(obj,arguments);a=a&&c}return a};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(a){dhx_catch[a]=null},z},obj.detachEvent=function(a){if(a){var b=a.split(":");this[b[0]].removeEvent(b[1])}},obj.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&delete this[a]},obj=null},dhtmlx.copy=function(a){var b,c,d;if(a&&"object"==typeof a){for(d={},c=[Array,Date,Number,String,Boolean],b=0;b<c.length;b++)a instanceof c[b]&&(d=b?new c[b](a):new c[b]);for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&(d[b]=dhtmlx.copy(a[b]))}return d||a},dhtmlx.mixin=function(a,b,c){for(var d in b)(!a[d]||c)&&(a[d]=b[d]);return a},dhtmlx.defined=function(a){return"undefined"!=typeof a},dhtmlx.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++,this._seed},dhtmlx.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},gantt._get_position=function(a){var b=0,c=0;if(a.getBoundingClientRect){var d=a.getBoundingClientRect(),e=document.body,f=document.documentElement,g=window.pageYOffset||f.scrollTop||e.scrollTop,h=window.pageXOffset||f.scrollLeft||e.scrollLeft,i=f.clientTop||e.clientTop||0,j=f.clientLeft||e.clientLeft||0;return b=d.top+g-i,c=d.left+h-j,{y:Math.round(b),x:Math.round(c),width:a.offsetWidth,height:a.offsetHeight}}for(;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{y:b,x:c,width:a.offsetWidth,height:a.offsetHeight}},gantt._detectScrollSize=function(){var a=document.createElement("div");a.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;",document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),b},window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b,c){var d=document.createElement("DIV");d.id="gantt_"+dhtmlx.uid(),d.style.width="100%",d.style.height="100%",d.cmp="grid",c=c||window.gantt,document.body.appendChild(d),this.attachObject(d.id);var e=this.vs[this.av];e.grid=c,c.init(d.id,a,b),d.firstChild.style.border="none",e.gridId=d.id,e.gridObj=d;var f="_viewRestore";return this.vs[this[f]()].grid}),"undefined"!=typeof window.dhtmlXCellObject&&(dhtmlXCellObject.prototype.attachGantt=function(a,b,c){var d=document.createElement("DIV");d.id="gantt_"+dhtmlx.uid(),d.style.width="100%",d.style.height="100%",d.cmp="grid",document.body.appendChild(d),this.attachObject(d.id),c=c||window.gantt,c.init(d.id,a,b),d.firstChild.style.border="none";return d=null,this.callEvent("_onContentAttach",[]),this.dataObj}),dhtmlxEventable(gantt),dhx4.ajax.cache=!0,gantt._click={},gantt._dbl_click={},gantt._context_menu={},gantt._on_click=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a),d=!0;if(null!==c?d=!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[c,a]):gantt.callEvent("onEmptyClick",[a]),d){var e=gantt._find_ev_handler(a,b,gantt._click,c);if(!e)return;c&&gantt.getTask(c)&&gantt.config.select_task&&gantt.selectTask(c)}},gantt._on_contextmenu=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(b),d=gantt.locate(b,gantt.config.link_attribute),e=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[c,d,a]);return e||(a.preventDefault?a.preventDefault():a.returnValue=!1),e},gantt._find_ev_handler=function(a,b,c,d){for(var e=!0;b;){var f=gantt._getClassName(b);if(f){f=f.split(" ");for(var g=0;g<f.length;g++)if(f[g]&&c[f[g]]){var h=c[f[g]].call(gantt,a,d,b);e=e&&!("undefined"!=typeof h&&h!==!0)}}b=b.parentNode}return e},gantt._on_dblclick=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a),d=!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[c,a]);if(d){var e=gantt._find_ev_handler(a,b,gantt._dbl_click,c);if(!e)return;null!==c&&gantt.getTask(c)&&d&&gantt.config.details_on_dblclick&&gantt.showLightbox(c)}},gantt._on_mousemove=function(a){if(gantt.checkEvent("onMouseMove")){var b=gantt.locate(a);gantt._last_move_event=a,gantt.callEvent("onMouseMove",[b,a])}},dhtmlxDnD.prototype={dragStart:function(a,b){this.config={obj:a,marker:null,started:!1,pos:this.getPosition(b),sensitivity:4},this._settings&&dhtmlx.mixin(this.config,this._settings,!0);var c=dhtmlx.bind(function(b){return this.dragMove(a,b)},this),d=(dhtmlx.bind(function(b){return this.dragScroll(a,b)},this),dhtmlx.bind(function(a){return dhtmlx.defined(this.config.updates_per_second)&&!gantt._checkTimeout(this,this.config.updates_per_second)?!0:c(a)},this)),e=dhtmlx.bind(function(){return dhtmlxDetachEvent(document.body,"mousemove",d),dhtmlxDetachEvent(document.body,"mouseup",e),this.dragEnd(a)},this);dhtmlxEvent(document.body,"mousemove",d),dhtmlxEvent(document.body,"mouseup",e),document.body.className+=" gantt_noselect"},dragMove:function(a,b){if(!this.config.marker&&!this.config.started){var c=this.getPosition(b),d=c.x-this.config.pos.x,e=c.y-this.config.pos.y,f=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2));if(f>this.config.sensitivity){if(this.config.started=!0,this.config.ignore=!1,this.callEvent("onBeforeDragStart",[a,this.config.original_target])===!1)return this.config.ignore=!0,!0;var g=this.config.marker=document.createElement("div");g.className="gantt_drag_marker",g.innerHTML="Dragging object",document.body.appendChild(g),this.callEvent("onAfterDragStart",[a,this.config.original_target])}else this.config.ignore=!0}this.config.ignore||(b.pos=this.getPosition(b),this.config.marker.style.left=b.pos.x+"px",this.config.marker.style.top=b.pos.y+"px",this.callEvent("onDragMove",[a,b]))},dragEnd:function(){this.config.marker&&(this.config.marker.parentNode.removeChild(this.config.marker),this.config.marker=null,this.callEvent("onDragEnd",[])),document.body.className=document.body.className.replace(" gantt_noselect","")},getPosition:function(a){var b=0,c=0;return a=a||window.event,a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}}},gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(a,b){return this.close(b),!1},this),this._click.gantt_open=dhtmlx.bind(function(a,b){return this.open(b),!1},this),this._click.gantt_row=dhtmlx.bind(function(a,b,c){if(null!==b){var d=this.getTask(b);this.config.scroll_on_click&&this.showDate(d.start_date),this.callEvent("onTaskRowClick",[b,c])}},this),this._click.gantt_grid_head_cell=dhtmlx.bind(function(a,b,c){var d=c.getAttribute("column_id");if(this.callEvent("onGridHeaderClick",[d,a])){if("add"==d)return void this._click.gantt_add(a,this.config.root_id);if(this.config.sort){for(var e,f=d,g=0;this.config.columns.length;g++)if(this.config.columns[g].name==d){e=this.config.columns[g];break}if(e&&void 0!==e.sort&&e.sort!==!0&&(f=e.sort,!f))return;var h=this._sort&&this._sort.direction&&this._sort.name==d?this._sort.direction:"desc";h="desc"==h?"asc":"desc",this._sort={name:d,direction:h},this.sort(f,"desc"==h)}}},this),!this.config.sort&&this.config.order_branch&&this._init_dnd(),this._click.gantt_add=dhtmlx.bind(function(a,b){if(!this.config.readonly){var c={};return this.createTask(c,b?b:this.config.root_id),!1}},this),this._init_resize&&this._init_resize()},gantt._render_grid=function(){this._is_grid_visible()&&(this._calc_grid_width(),this._render_grid_header())},gantt._calc_grid_width=function(){for(var a=this.getGridColumns(),b=0,c=[],d=[],e=0;e<a.length;e++){var f=parseInt(a[e].width,10);window.isNaN(f)&&(f=50,c.push(e)),d[e]=f,b+=f}if(this.config.autofit||c.length){{var g=this._get_grid_width()-b;g/(c.length>0?c.length:d.length>0?d.length:1)}if(c.length>0)for(var h=g/(c.length?c.length:1),e=0;e<c.length;e++){var i=c[e];d[i]+=h}else for(var h=g/(d.length?d.length:1),e=0;e<d.length;e++)d[e]+=h;for(var e=0;e<d.length;e++)a[e].width=d[e]}else this.config.grid_width=b},gantt._render_grid_header=function(){for(var a=this.getGridColumns(),b=[],c=0,d=this.locale.labels,e=this.config.scale_height-2,f=0;f<a.length;f++){var g=f==a.length-1,h=a[f];g&&this._get_grid_width()>c+h.width&&(h.width=this._get_grid_width()-c),c+=h.width;var i=this._sort&&h.name==this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"",j=["gantt_grid_head_cell","gantt_grid_head_"+h.name,g?"gantt_last_cell":"",this.templates.grid_header_class(h.name,h)].join(" "),k="width:"+(h.width-(g?1:0))+"px;",l=h.label||d["column_"+h.name];l=l||"";var m="<div class='"+j+"' style='"+k+"' column_id='"+h.name+"'>"+l+i+"</div>";b.push(m)}this.$grid_scale.style.height=this.config.scale_height-1+"px",this.$grid_scale.style.lineHeight=e+"px",this.$grid_scale.style.width=c-1+"px",this.$grid_scale.innerHTML=b.join("")},gantt._render_grid_item=function(a){if(!gantt._is_grid_visible())return null;for(var b=this.getGridColumns(),c=[],d=0;d<b.length;d++){var e,f,g=d==b.length-1,h=b[d];"add"==h.name?f="<div class='gantt_add'></div>":(f=h.template?h.template(a):a[h.name],f instanceof Date&&(f=this.templates.date_grid(f,a)),f="<div class='gantt_tree_content'>"+f+"</div>");var i="gantt_cell"+(g?" gantt_last_cell":""),j="";if(h.tree){for(var k=0;k<a.$level;k++)j+=this.templates.grid_indent(a);var l=this._has_children(a.id);l?(j+=this.templates.grid_open(a),j+=this.templates.grid_folder(a)):(j+=this.templates.grid_blank(a),j+=this.templates.grid_file(a))}var m="width:"+(h.width-(g?1:0))+"px;";dhtmlx.defined(h.align)&&(m+="text-align:"+h.align+";"),e="<div class='"+i+"' style='"+m+"'>"+j+f+"</div>",c.push(e)}var i=a.$index%2===0?"":" odd";if(i+=a.$transparent?" gantt_transparent":"",i+=a.$dataprocessor_class?" "+a.$dataprocessor_class:"",this.templates.grid_row_class){var n=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);n&&(i+=" "+n)}this.getState().selected_task==a.id&&(i+=" gantt_selected");var o=document.createElement("div");return o.className="gantt_row"+i,o.style.height=this.config.row_height+"px",o.style.lineHeight=gantt.config.row_height+"px",o.setAttribute(this.config.task_attribute,a.id),o.innerHTML=c.join(""),o},gantt.open=function(a){gantt._set_item_state(a,!0),this.callEvent("onTaskOpened",[a])},gantt.close=function(a){gantt._set_item_state(a,!1),this.callEvent("onTaskClosed",[a])},gantt._set_item_state=function(a,b){a&&this._pull[a]&&(this._pull[a].$open=b,gantt._refresh_on_toggle_element(a))},gantt._refresh_on_toggle_element=function(){this.refreshData()},gantt._is_grid_visible=function(){return this.config.grid_width&&this.config.show_grid},gantt._get_grid_width=function(){return this._is_grid_visible()?this._is_chart_visible()?this.config.grid_width:this._x:0},gantt.moveTask=function(a,b,c){var d=arguments[3];if(d){if(d===a)return;c=this.getParent(d),b=this.getTaskIndex(d)}if(a!=c){c=c||this.config.root_id;var e=this.getTask(a),f=this.getParent(e.id),g=(this.getChildren(this.getParent(e.id)),this.getChildren(c));if(-1==b&&(b=g.length+1),f==c){var h=this.getTaskIndex(a);if(h==b)return}if(this.callEvent("onBeforeTaskMove",[a,c,b])!==!1){this._replace_branch_child(f,a),g=this.getChildren(c);var i=g[b];i?g=g.slice(0,b).concat([a]).concat(g.slice(b)):g.push(a),this.setParent(e,c),this._branches[c]=g,e.$level=this.calculateTaskLevel(e),e.$drop_target=1*b>0?d?(this.getTaskIndex(a)>this.getTaskIndex(d)?"next:":"")+d:"next:"+gantt.getPrevSibling(a):g[1*b+1]?g[1*b+1]:c,this.callEvent("onAfterTaskMove",[a,c,b])&&this.refreshData()}}},gantt._init_dnd=function(){var a=new dhtmlxDnD(this.$grid_data,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);if(!d)return!1;this.hideQuickInfo&&this._hideQuickInfo();var e=this.locate(c),f=gantt.getTask(e);return gantt._is_readonly(f)?!1:(a.config.initial_open_state=f.$open,this.callEvent("onRowDragStart",[e,c.target||c.srcElement,c])?void 0:!1)},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);a.config.marker.innerHTML=d.outerHTML,a.config.id=this.locate(c);var e=this.getTask(a.config.id);a.config.index=this.getTaskIndex(a.config.id),a.config.parent=e.parent,e.$open=!1,e.$transparent=!0,this.refreshData()},this)),a.lastTaskOfLevel=function(a){for(var b=gantt._order,c=gantt._pull,d=null,e=0,f=b.length;f>e;e++)c[b[e]].$level==a&&(d=c[b[e]]);return d?d.id:null},a._getGridPos=dhtmlx.bind(function(a){var b=this._get_position(this.$grid_data),c=b.x,d=a.pos.y-10;return d<b.y&&(d=b.y),d>b.y+this.$grid_data.offsetHeight-this.config.row_height&&(d=b.y+this.$grid_data.offsetHeight-this.config.row_height),b.x=c,b.y=d,b},this),a.attachEvent("onDragMove",dhtmlx.bind(function(b,c){function d(a,b){return a.$level==b.$level||gantt.config.order_branch_free}var e=a.config,f=a._getGridPos(c);e.marker.style.left=f.x+10+"px",e.marker.style.top=f.y+"px",f=a._getGridPos(c);var g=(f.x,f.y),h=document.elementFromPoint(f.x-document.body.scrollLeft+1,g-document.body.scrollTop),i=this.locate(h),j=this.getTask(a.config.id);if(this.isTaskExists(i)||(i=a.lastTaskOfLevel(gantt.config.order_branch_free?j.$level:0),i==a.config.id&&(i=null)),this.isTaskExists(i)){var k=gantt._get_position(h),l=this.getTask(i);if(k.y+h.offsetHeight/2<g){var m=this.getGlobalTaskIndex(l.id),n=this._pull[this._order[m+1]];if(n){if(n.id==j.id)return;l=n}else if(n=this._pull[this._order[m]],d(n,j)&&n.id!=j.id)return void this.moveTask(j.id,-1,this.getParent(n.id))}for(var m=this.getGlobalTaskIndex(l.id),o=this._pull[this._order[m-1]],p=1;(!o||o.id==l.id)&&m-p>=0;)o=this._pull[this._order[m-p]],p++;if(j.id==l.id)return;d(l,j)&&j.id!=l.id?this.moveTask(j.id,0,0,l.id):l.$level!=j.$level-1||gantt.getChildren(l.id).length?o&&d(o,j)&&j.id!=o.id&&this.moveTask(j.id,-1,this.getParent(o.id)):this.moveTask(j.id,0,l.id)}return!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(){var b=this.getTask(a.config.id);this.callEvent("onBeforeRowDragEnd",[a.config.id,a.config.parent,a.config.index])===!1?(this.moveTask(a.config.id,a.config.index,a.config.parent),b.$drop_target=null):this.callEvent("onRowDragEnd",[a.config.id,b.$drop_target]),b.$transparent=!1,b.$open=a.config.initial_open_state,this.refreshData()},this))},gantt.getGridColumns=function(){return this.config.columns},gantt._has_children=function(a){return this.getChildren(a).length>0},gantt._render_grid_header_resize=function(){for(var a=this.getGridColumns(),b=0,c=this.config.scale_height,d=(this._get_position(this.$grid_scale),0);d<a.length;d++){var e=(d==a.length-1,a[d]);if(b+=e.width,e.resize){var f=document.createElement("div");f.className="gantt_grid_column_resize_wrap",f.style.top="0px",f.style.height=c+"px",f.innerHTML="<div class='gantt_grid_column_resize'></div>",f.setAttribute(this.config.grid_resizer_column_attribute,d),this.$grid_scale.appendChild(f),f.style.left=Math.max(0,b-1-f.offsetWidth/2)+"px"}}if(this.config.grid_resize){var g=document.createElement("div");g.className="gantt_grid_resize_wrap",g.style.top="0px",g.style.height=this.$grid.offsetHeight+"px",g.innerHTML="<div class='gantt_grid_resize'></div>",g.setAttribute(this.config.grid_resizer_attribute,!0),this.$grid_scale.appendChild(g),g.style.left=Math.max(0,this.config.grid_width-1-g.offsetWidth/2)+"px"}},gantt._init_resize=function(){var a=new dhtmlxDnD(this.$grid_scale,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){var c=this._locateHTML(b,this.config.grid_resizer_column_attribute);if(!c)return!1;var d=this.locate(b,this.config.grid_resizer_column_attribute),e=this.getGridColumns()[d];return gantt.callEvent("onColumnResizeStart",[d,e])===!1?!1:void 0},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this.locate(c,this.config.grid_resizer_column_attribute);a.config.marker.innerHTML="",a.config.marker.className+=" gantt_grid_resize_area",a.config.marker.style.height=this.$grid.offsetHeight+"px",a.config.marker.style.top="0px",a.config.drag_index=d},this)),a.attachEvent("onDragMove",dhtmlx.bind(function(){var b=a.config,c=this.getGridColumns(),d=this._get_position(this.$grid_scale),e=parseInt(b.marker.style.left,10),f=this.config.min_grid_column_width,g=this.$grid_data.offsetWidth-this.config.min_grid_column_width*(c.length-b.drag_index-2),h=0,i=0;e-=d.x-1;for(var j=0;j<b.drag_index;j++)f+=c[j].width,h+=c[j].width;return f>e&&(e=f),this.config.keep_grid_width&&e>g&&(e=g),i=e-h,b.marker.style.top=d.y+"px",b.marker.style.left=d.x-1+h+"px",b.marker.style.width=i+"px",b.left=e-1,gantt.callEvent("onColumnResize",[b.drag_index,c[b.drag_index],i-1]),!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(){for(var b=this.getGridColumns(),c=0,d=parseInt(a.config.drag_index,10),e=b[d],f=0;d>f;f++)c+=b[f].width;var g=e.min_width&&a.config.left-c<e.min_width?e.min_width:a.config.left-c;if(gantt.callEvent("onColumnResizeEnd",[d,e,g])!==!1&&e.width!=g){if(e.width=g,this.config.keep_grid_width)for(var f=d+1,h=b.length;h>f;f++)b[f].width="add"==b[f].name?1*b[f].width||44:null;else{for(var f=d,h=b.length;h>f;f++)c+=b[f].width;this.config.grid_width=c}this.render()}},this));var b=new dhtmlxDnD(this.$grid,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(b.config.sensitivity=this.config.dnd_sensitivity),b.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){var c=this._locateHTML(b,this.config.grid_resizer_attribute);return c?gantt.callEvent("onGridResizeStart",[gantt.config.grid_width])===!1?!1:void 0:!1},this)),b.attachEvent("onAfterDragStart",dhtmlx.bind(function(){b.config.marker.innerHTML="",b.config.marker.className+=" gantt_grid_resize_area",b.config.marker.style.height=this.$grid.offsetHeight+"px",b.config.marker.style.top="0px"},this)),b.attachEvent("onDragMove",dhtmlx.bind(function(){for(var a=b.config,c=this.config.columns,d=this._get_position(this.$grid),e=parseInt(a.marker.style.left,10),f=0,g=0;g<c.length;g++)c[g].hide||(f+=c[g].min_width?c[g].min_width:this.config.min_grid_column_width);return e-=d.x-1,f>e&&(e=f),a.marker.style.top=d.y+"px",a.marker.style.left=d.x-1+"px",a.marker.style.width=e+"px",a.left=e-1,gantt.callEvent("onGridResize",[this.config.grid_width,e-1]),!0},this)),b.attachEvent("onDragEnd",dhtmlx.bind(function(){for(var a=this.config.columns,c=0,d=b.config.left,e=0,f=a.length;f>e;e++)a[e].hide||(c+=a[e].width);for(var g=a.length,h=d-c,e=0;g>e;e++)if(!a[e].hide){var i=Math.floor(h*(a[e].width/c));c-=a[e].width;var j=a[e].width+i;(a[e].min_width&&j>=a[e].min_width||!a[e].min_width||j>a[e].width)&&(h-=i,a[e].width=j)}for(var k=h>0?1:-1;h>0&&1===k||0>h&&-1===k;){var l=h;for(e=0;g>e;e++){var m=a[e].width+k;if((a[e].min_width&&m>=a[e].min_width||!a[e].min_width||j>a[e].width)&&(h-=k,a[e].width=m,0==h))break}if(l==h)break}gantt.callEvent("onGridResizeEnd",[this.config.grid_width,d])!==!1&&(this.config.grid_width=d,this.render())},this))},gantt.attachEvent("onGanttRender",function(){gantt._render_grid_header_resize()}),function(){var a=gantt._has_children;gantt._has_children=function(b){return a.apply(this,arguments)?!0:this.isTaskExists(b)?this.getTask(b).$has_child:!1}}(),gantt._need_dynamic_loading=function(a){if(gantt.config.branch_loading&&gantt._load_url){var b=gantt.getUserData(a,"was_rendered");if(!b&&gantt._has_children(a))return!0}return!1},gantt._refresh_on_toggle_element=function(a){gantt._need_dynamic_loading(a)||this.refreshData()},gantt.attachEvent("onTaskOpened",function(a){if(gantt.config.branch_loading&&gantt._load_url&&gantt._need_dynamic_loading(a)){var b=gantt._load_url;b=b.replace(/(\?|&)?parent_id=.+&?/,"");var c=b.indexOf("?")>=0?"&":"?",d=0;this._cached_scroll_pos&&this._cached_scroll_pos.y&&(d=Math.max(this._cached_scroll_pos.y,0)),gantt.load(b+c+"parent_id="+encodeURIComponent(a),this._load_type,function(){d&&gantt.scrollTo(null,d)}),gantt.setUserData(a,"was_rendered",!0)}}),gantt.getGridColumns=function(){for(var a=gantt.config.columns,b=[],c=0;c<a.length;c++)a[c].hide||b.push(a[c]);return b},gantt.getGridColumn=function(a){for(var b=gantt.config.columns,c=0;c<b.length;c++)if(b[c].name==a)return b[c];return null},gantt._scale_helpers={getSum:function(a,b,c){void 0===c&&(c=a.length-1),void 0===b&&(b=0);for(var d=0,e=b;c>=e;e++)d+=a[e];return d},setSumWidth:function(a,b,c,d){var e=b.width;void 0===d&&(d=e.length-1),void 0===c&&(c=0);var f=d-c+1;if(!(c>e.length-1||0>=f||d>e.length-1)){var g=this.getSum(e,c,d),h=a-g;this.adjustSize(h,e,c,d),this.adjustSize(-h,e,d+1),b.full_width=this.getSum(e)}},splitSize:function(a,b){for(var c=[],d=0;b>d;d++)c[d]=0;return this.adjustSize(a,c),c},adjustSize:function(a,b,c,d){c||(c=0),void 0===d&&(d=b.length-1);for(var e=d-c+1,f=this.getSum(b,c,d),g=0,h=c;d>=h;h++){var i=Math.floor(a*(f?b[h]/f:1/e));f-=b[h],a-=i,e--,b[h]+=i,g+=i}b[b.length-1]+=a},sortScales:function(a){function b(a,b){var c=new Date(1970,0,1);return gantt.date.add(c,b,a)-c}a.sort(function(a,c){return b(a.unit,a.step)<b(c.unit,c.step)?1:b(a.unit,a.step)>b(c.unit,c.step)?-1:0})},primaryScale:function(){return gantt._init_template("date_scale"),{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,css:gantt.templates.scale_cell_class}},prepareConfigs:function(a,b,c,d){for(var e=this.splitSize(d,a.length),f=c,g=[],h=a.length-1;h>=0;h--){var i=h==a.length-1,j=this.initScaleConfig(a[h]);i&&this.processIgnores(j),this.initColSizes(j,b,f,e[h]),this.limitVisibleRange(j),i&&(f=j.full_width),g.unshift(j)}for(var h=0;h<g.length-1;h++)this.alineScaleColumns(g[g.length-1],g[h]);for(var h=0;h<g.length;h++)this.setPosSettings(g[h]);return g},setPosSettings:function(a){for(var b=0,c=a.trace_x.length;c>b;b++)a.left.push((a.width[b-1]||0)+(a.left[b-1]||0))},_ignore_time_config:function(a){return this.config.skip_off_time?!this.isWorkTime(a):!1},processIgnores:function(a){a.ignore_x={},a.display_count=a.count},initColSizes:function(a,b,c,d){var e=c;a.height=d;var f=void 0===a.display_count?a.count:a.display_count;f||(f=1),a.col_width=Math.floor(e/f),b&&a.col_width<b&&(a.col_width=b,e=a.col_width*f),a.width=[];for(var g=a.ignore_x||{},h=0;h<a.trace_x.length;h++)a.width[h]=g[a.trace_x[h].valueOf()]||a.display_count==a.count?0:1;this.adjustSize(e-this.getSum(a.width),a.width),a.full_width=this.getSum(a.width)},initScaleConfig:function(a){var b=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:0,width:[],left:[],trace_x:[]},a);return this.eachColumn(a.unit,a.step,function(a){b.count++,b.trace_x.push(new Date(a))}),b},iterateScales:function(a,b,c,d,e){for(var f=b.trace_x,g=a.trace_x,h=c||0,i=d||g.length-1,j=0,k=1;k<f.length;k++)for(var l=h;i>=l;l++)+g[l]!=+f[k]||(e&&e.apply(this,[j,k,h,l]),h=l,j=k)},alineScaleColumns:function(a,b,c,d){this.iterateScales(a,b,c,d,function(c,d,e,f){var g=this.getSum(a.width,e,f-1),h=this.getSum(b.width,c,d-1);h!=g&&this.setSumWidth(g,b,c,d-1)})},eachColumn:function(a,b,c){var d=new Date(gantt._min_date),e=new Date(gantt._max_date);gantt.date[a+"_start"]&&(d=gantt.date[a+"_start"](d));var f=new Date(d);for(+f>=+e&&(e=gantt.date.add(f,b,a));+e>+f;){c.call(this,new Date(f));var g=f.getTimezoneOffset();f=gantt.date.add(f,b,a),f=gantt._correct_dst_change(f,g,b,a),gantt.date[a+"_start"]&&(f=gantt.date[a+"_start"](f))}},limitVisibleRange:function(a){var b=a.trace_x,c=0,d=a.width.length-1,e=0;if(+b[0]<+gantt._min_date&&c!=d){var f=Math.floor(a.width[0]*((b[1]-gantt._min_date)/(b[1]-b[0])));e+=a.width[0]-f,a.width[0]=f,b[0]=new Date(gantt._min_date)}var g=b.length-1,h=b[g],i=gantt.date.add(h,a.step,a.unit);if(+i>+gantt._max_date&&g>0){var f=a.width[g]-Math.floor(a.width[g]*((i-gantt._max_date)/(i-h)));e+=a.width[g]-f,a.width[g]=f}if(e){for(var j=this.getSum(a.width),k=0,l=0;l<a.width.length;l++){var m=Math.floor(e*(a.width[l]/j));a.width[l]+=m,k+=m}this.adjustSize(e-k,a.width)}}},gantt._scale_helpers.processIgnores=function(a){var b=a.count;if(a.ignore_x={},gantt.ignore_time||gantt.config.skip_off_time){var c=gantt.ignore_time||function(){return!1};b=0;for(var d=0;d<a.trace_x.length;d++)c.call(gantt,a.trace_x[d])||this._ignore_time_config.call(gantt,a.trace_x[d])?(a.ignore_x[a.trace_x[d].valueOf()]=!0,a.ignored_colls=!0):b++}a.display_count=b},gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var a=gantt.config.drag_mode;this.set_actions();var b={before_start:"onBeforeTaskDrag",before_finish:"onBeforeTaskChanged",after_finish:"onAfterTaskDrag"};for(var c in this._events)for(var d in a)this._events[c][d]=b[c];this._handlers[a.move]=this._move,this._handlers[a.resize]=this._resize,this._handlers[a.progress]=this._resize_progress},set_actions:function(){var a=gantt.$task_data;dhtmlxEvent(a,"mousemove",dhtmlx.bind(function(a){this.on_mouse_move(a||event)},this)),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(a){this.on_mouse_down(a||event)},this)),dhtmlxEvent(a,"mouseup",dhtmlx.bind(function(a){this.on_mouse_up(a||event)},this))},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start_x:null,start_y:null,obj:null,left:null}},_resize:function(a,b,c){var d=gantt.config,e=this._drag_task_coords(a,c);c.left?(a.start_date=gantt.dateFromPos(e.start+b),a.start_date||(a.start_date=new Date(gantt.getState().min_date))):(a.end_date=gantt.dateFromPos(e.end+b),a.end_date||(a.end_date=new Date(gantt.getState().max_date))),a.end_date-a.start_date<d.min_duration&&(c.left?a.start_date=gantt.calculateEndDate(a.end_date,-1):a.end_date=gantt.calculateEndDate(a.start_date,1)),gantt._init_task_timing(a)},_resize_progress:function(a,b,c){var d=this._drag_task_coords(a,c),e=Math.max(0,c.pos.x-d.start);a.progress=Math.min(1,e/(d.end-d.start))},_move:function(a,b,c){var d=this._drag_task_coords(a,c),e=gantt.dateFromPos(d.start+b),f=gantt.dateFromPos(d.end+b);e?f?(a.start_date=e,a.end_date=f):(a.end_date=new Date(gantt.getState().max_date),a.start_date=gantt.dateFromPos(gantt.posFromDate(a.end_date)-(d.end-d.start))):(a.start_date=new Date(gantt.getState().min_date),a.end_date=gantt.dateFromPos(gantt.posFromDate(a.start_date)+(d.end-d.start)))},_drag_task_coords:function(a,b){var c=b.obj_s_x=b.obj_s_x||gantt.posFromDate(a.start_date),d=b.obj_e_x=b.obj_e_x||gantt.posFromDate(a.end_date);return{start:c,end:d}},on_mouse_move:function(a){this.drag.start_drag&&this._start_dnd(a);var b=this.drag;if(b.mode){if(!gantt._checkTimeout(this,40))return;this._update_on_move(a)}},_update_on_move:function(a){var b=this.drag;if(b.mode){var c=gantt._get_mouse_pos(a);if(b.pos&&b.pos.x==c.x)return;b.pos=c;var d=gantt.dateFromPos(c.x);if(!d||isNaN(d.getTime()))return;var e=c.x-b.start_x,f=gantt.getTask(b.id);if(this._handlers[b.mode]){var g=dhtmlx.mixin({},f),h=dhtmlx.mixin({},f);this._handlers[b.mode].apply(this,[h,e,b]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id,!0),gantt.callEvent("onTaskDrag",[f.id,b.mode,h,g,a]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id),gantt.refreshTask(b.id)}}},on_mouse_down:function(a,b){if(2!=a.button){var c=gantt.locate(a),d=null;if(gantt.isTaskExists(c)&&(d=gantt.getTask(c)),!gantt._is_readonly(d)&&!this.drag.mode){this.clear_drag_state(),b=b||a.target||a.srcElement;var e=gantt._getClassName(b);if(!e||!this._get_drag_mode(e))return b.parentNode?this.on_mouse_down(a,b.parentNode):void 0;var f=this._get_drag_mode(e);if(f)if(f.mode&&f.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+f.mode]){if(c=gantt.locate(b),d=dhtmlx.copy(gantt.getTask(c)||{}),gantt._is_readonly(d))return this.clear_drag_state(),!1;if(gantt._is_flex_task(d)&&f.mode!=gantt.config.drag_mode.progress)return void this.clear_drag_state();f.id=c;var g=gantt._get_mouse_pos(a);f.start_x=g.x,f.start_y=g.y,f.obj=d,this.drag.start_drag=f}else this.clear_drag_state();else if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[e.split(" ")[0]])&&b.parentNode)return this.on_mouse_down(a,b.parentNode)}}},_fix_dnd_scale_time:function(a,b){function c(a){gantt.isWorkTime(a.start_date)||(a.start_date=gantt.calculateEndDate(a.start_date,-1,gantt.config.duration_unit))}function d(a){gantt.isWorkTime(new Date(a.end_date-1))||(a.end_date=gantt.calculateEndDate(a.end_date,1,gantt.config.duration_unit))}var e=gantt._tasks.unit,f=gantt._tasks.step;gantt.config.round_dnd_dates||(e="minute",f=gantt.config.time_step),b.mode==gantt.config.drag_mode.resize?b.left?(a.start_date=gantt.roundDate({date:a.start_date,unit:e,step:f}),c(a)):(a.end_date=gantt.roundDate({date:a.end_date,unit:e,step:f}),d(a)):b.mode==gantt.config.drag_mode.move&&(a.start_date=gantt.roundDate({date:a.start_date,unit:e,step:f}),c(a),a.end_date=gantt.calculateEndDate(a.start_date,a.duration,gantt.config.duration_unit))},_fix_working_times:function(a,b){var b=b||{mode:gantt.config.drag_mode.move};gantt.config.work_time&&gantt.config.correct_work_time&&(b.mode==gantt.config.drag_mode.resize?b.left?a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}):a.end_date=gantt.getClosestWorkTime({date:a.end_date,dir:"past"}):b.mode==gantt.config.drag_mode.move&&gantt.correctTaskWorkTime(a))},on_mouse_up:function(a){var b=this.drag;if(b.mode&&b.id){var c=gantt.getTask(b.id);if(gantt.config.work_time&&gantt.config.correct_work_time&&this._fix_working_times(c,b),this._fix_dnd_scale_time(c,b),gantt._init_task_timing(c),this._fireEvent("before_finish",b.mode,[b.id,b.mode,dhtmlx.copy(b.obj),a])){var d=b.id;gantt._init_task_timing(c),this._fireEvent("after_finish",b.mode,[d,b.mode,a]),this.clear_drag_state(),gantt.updateTask(c.id)}else b.obj._dhx_changed=!1,dhtmlx.mixin(c,b.obj,!0),gantt.updateTask(c.id)}this.clear_drag_state()},_get_drag_mode:function(a){var b=gantt.config.drag_mode,c=(a||"").split(" "),d=c[0],e={mode:null,left:null};switch(d){case"gantt_task_line":case"gantt_task_content":e.mode=b.move;break;case"gantt_task_drag":e.mode=b.resize,e.left=c[1]&&-1!==c[1].indexOf("left",c[1].length-"left".length)?!0:!1;break;case"gantt_task_progress_drag":e.mode=b.progress;break;case"gantt_link_control":case"gantt_link_point":e.mode=b.ignore;break;default:e=null}return e},_start_dnd:function(a){var b=this.drag=this.drag.start_drag;delete b.start_drag;var c=gantt.config,d=b.id;c["drag_"+b.mode]&&gantt.callEvent("onBeforeDrag",[d,b.mode,a])&&this._fireEvent("before_start",b.mode,[d,b.mode,a])?delete b.start_drag:this.clear_drag_state()},_fireEvent:function(a,b,c){dhtmlx.assert(this._events[a],"Invalid stage:{"+a+"}");var d=this._events[a][b];return dhtmlx.assert(d,"Unknown after drop mode:{"+b+"}"),dhtmlx.assert(c,"Invalid event arguments"),gantt.checkEvent(d)?gantt.callEvent(d,c):!0}},gantt.roundTaskDates=function(a){var b=gantt._tasks_dnd.drag;b||(b={mode:gantt.config.drag_mode.move}),gantt._tasks_dnd._fix_dnd_scale_time(a,b)},gantt._render_link=function(a){for(var b=this.getLink(a),c=gantt._get_link_renderers(),d=0;d<c.length;d++)c[d].render_item(b)
},gantt._get_link_type=function(a,b){var c=null;return a&&b?c=gantt.config.links.start_to_start:!a&&b?c=gantt.config.links.finish_to_start:a||b?a&&!b&&(c=gantt.config.links.start_to_finish):c=gantt.config.links.finish_to_finish,c},gantt.isLinkAllowed=function(a,b,c,d){var e=null;if(e="object"==typeof a?a:{source:a,target:b,type:this._get_link_type(c,d)},!e)return!1;if(!(e.source&&e.target&&e.type))return!1;if(e.source==e.target)return!1;var f=!0;return this.checkEvent("onLinkValidation")&&(f=this.callEvent("onLinkValidation",[e])),f},gantt._render_link_element=function(a){var b=this._path_builder.get_points(a),c=gantt._drawer,d=c.get_lines(b),e=document.createElement("div"),f="gantt_task_link";a.color&&(f+=" gantt_link_inline_color");var g=this.templates.link_class?this.templates.link_class(a):"";g&&(f+=" "+g),this.config.highlight_critical_path&&this.isCriticalLink&&this.isCriticalLink(a)&&(f+=" gantt_critical_link"),e.className=f,e.setAttribute(gantt.config.link_attribute,a.id);for(var h=0;h<d.length;h++){h==d.length-1&&(d[h].size-=gantt.config.link_arrow_size);var i=c.render_line(d[h],d[h+1]);a.color&&(i.firstChild.style.backgroundColor=a.color),e.appendChild(i)}var j=d[d.length-1].direction,k=gantt._render_link_arrow(b[b.length-1],j);return a.color&&(k.style.borderColor=a.color),e.appendChild(k),e},gantt._render_link_arrow=function(a,b){var c=document.createElement("div"),d=gantt._drawer,e=a.y,f=a.x,g=gantt.config.link_arrow_size,h=gantt.config.row_height,i="gantt_link_arrow gantt_link_arrow_"+b;switch(b){case d.dirs.right:e-=(g-h)/2,f-=g;break;case d.dirs.left:e-=(g-h)/2;break;case d.dirs.up:f-=g;break;case d.dirs.down:e+=2*g,f-=g}return c.style.cssText=["top:"+e+"px","left:"+f+"px"].join(";"),c.className=i,c},gantt._drawer={current_pos:null,dirs:{left:"left",right:"right",up:"up",down:"down"},path:[],clear:function(){this.current_pos=null,this.path=[]},point:function(a){this.current_pos=dhtmlx.copy(a)},get_lines:function(a){this.clear(),this.point(a[0]);for(var b=1;b<a.length;b++)this.line_to(a[b]);return this.get_path()},line_to:function(a){var b=dhtmlx.copy(a),c=this.current_pos,d=this._get_line(c,b);this.path.push(d),this.current_pos=b},get_path:function(){return this.path},get_wrapper_sizes:function(a){var b,c=gantt.config.link_wrapper_width,d=(gantt.config.link_line_width,a.y+(gantt.config.row_height-c)/2);switch(a.direction){case this.dirs.left:b={top:d,height:c,lineHeight:c,left:a.x-a.size-c/2,width:a.size+c};break;case this.dirs.right:b={top:d,lineHeight:c,height:c,left:a.x-c/2,width:a.size+c};break;case this.dirs.up:b={top:d-a.size,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c};break;case this.dirs.down:b={top:d,lineHeight:a.size+2*c,height:a.size+2*c,left:a.x-c/2,width:c}}return b},get_line_sizes:function(a){var b,c=gantt.config.link_line_width,d=gantt.config.link_wrapper_width,e=a.size+c;switch(a.direction){case this.dirs.left:case this.dirs.right:b={height:c,width:e,marginTop:(d-c)/2,marginLeft:(d-c)/2};break;case this.dirs.up:case this.dirs.down:b={height:e,width:c,marginTop:(d-c)/2,marginLeft:(d-c)/2}}return b},render_line:function(a){var b=this.get_wrapper_sizes(a),c=document.createElement("div");c.style.cssText=["top:"+b.top+"px","left:"+b.left+"px","height:"+b.height+"px","width:"+b.width+"px"].join(";"),c.className="gantt_line_wrapper";var d=this.get_line_sizes(a),e=document.createElement("div");return e.style.cssText=["height:"+d.height+"px","width:"+d.width+"px","margin-top:"+d.marginTop+"px","margin-left:"+d.marginLeft+"px"].join(";"),e.className="gantt_link_line_"+a.direction,c.appendChild(e),c},_get_line:function(a,b){var c=this.get_direction(a,b),d={x:a.x,y:a.y,direction:this.get_direction(a,b)};return d.size=Math.abs(c==this.dirs.left||c==this.dirs.right?a.x-b.x:a.y-b.y),d},get_direction:function(a,b){var c=0;return c=b.x<a.x?this.dirs.left:b.x>a.x?this.dirs.right:b.y>a.y?this.dirs.down:this.dirs.up}},gantt._y_from_ind=function(a){return a*gantt.config.row_height},gantt._path_builder={path:[],clear:function(){this.path=[]},current:function(){return this.path[this.path.length-1]},point:function(a){return a?(this.path.push(dhtmlx.copy(a)),a):this.current()},point_to:function(a,b,c){c=c?{x:c.x,y:c.y}:dhtmlx.copy(this.point());var d=gantt._drawer.dirs;switch(a){case d.left:c.x-=b;break;case d.right:c.x+=b;break;case d.up:c.y-=b;break;case d.down:c.y+=b}return this.point(c)},get_points:function(a){var b=this.get_endpoint(a),c=gantt.config,d=b.e_y-b.y,e=b.e_x-b.x,f=gantt._drawer.dirs;this.clear(),this.point({x:b.x,y:b.y});var g=2*c.link_arrow_size,h=b.e_x>b.x;if(a.type==gantt.config.links.start_to_start)this.point_to(f.left,g),h?(this.point_to(f.down,d),this.point_to(f.right,e)):(this.point_to(f.right,e),this.point_to(f.down,d)),this.point_to(f.right,g);else if(a.type==gantt.config.links.finish_to_start)if(h=b.e_x>b.x+2*g,this.point_to(f.right,g),h)e-=g,this.point_to(f.down,d),this.point_to(f.right,e);else{e-=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.right,g)}else if(a.type==gantt.config.links.finish_to_finish)this.point_to(f.right,g),h?(this.point_to(f.right,e),this.point_to(f.down,d)):(this.point_to(f.down,d),this.point_to(f.right,e)),this.point_to(f.left,g);else if(a.type==gantt.config.links.start_to_finish)if(h=b.e_x>b.x-2*g,this.point_to(f.left,g),h){e+=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.left,g)}else e+=g,this.point_to(f.down,d),this.point_to(f.right,e);return this.path},get_endpoint:function(a){var b=gantt.config.links,c=!1,d=!1;a.type==b.start_to_start?c=d=!0:a.type==b.finish_to_finish?c=d=!1:a.type==b.finish_to_start?(c=!1,d=!0):a.type==b.start_to_finish?(c=!0,d=!1):dhtmlx.assert(!1,"Invalid link type");var e=gantt._get_task_visible_pos(gantt._pull[a.source],c),f=gantt._get_task_visible_pos(gantt._pull[a.target],d);return{x:e.x,e_x:f.x,y:e.y,e_y:f.y}}},gantt._init_links_dnd=function(){function a(a,b,c){var d=gantt._get_task_pos(a,!!b);return d.y+=gantt._get_task_height()/2,c=c||0,d.x+=(b?-1:1)*c,d}function b(a){var b=d(),c=["gantt_link_tooltip"];b.from&&b.to&&c.push(gantt.isLinkAllowed(b.from,b.to,b.from_start,b.to_start)?"gantt_allowed_link":"gantt_invalid_link");var e=gantt.templates.drag_link_class(b.from,b.from_start,b.to,b.to_start);e&&c.push(e);var f="<div class='"+e+"'>"+gantt.templates.drag_link(b.from,b.from_start,b.to,b.to_start)+"</div>";a.innerHTML=f}function c(a,b){a.style.left=b.x+5+"px",a.style.top=b.y+5+"px"}function d(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start}}function e(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=null,gantt._link_target_task_start=!0}function f(a,b,c,e){var f=i(),j=d(),k=["gantt_link_direction"];gantt.templates.link_direction_class&&k.push(gantt.templates.link_direction_class(j.from,j.from_start,j.to,j.to_start));var l=Math.sqrt(Math.pow(c-a,2)+Math.pow(e-b,2));if(l=Math.max(0,l-3)){f.className=k.join(" ");var m=(e-b)/(c-a),n=Math.atan(m);2==h(a,c,b,e)?n+=Math.PI:3==h(a,c,b,e)&&(n-=Math.PI);var o=Math.sin(n),p=Math.cos(n),q=Math.round(b),r=Math.round(a),s=["-webkit-transform: rotate("+n+"rad)","-moz-transform: rotate("+n+"rad)","-ms-transform: rotate("+n+"rad)","-o-transform: rotate("+n+"rad)","transform: rotate("+n+"rad)","width:"+Math.round(l)+"px"];if(-1!=window.navigator.userAgent.indexOf("MSIE 8.0")){s.push('-ms-filter: "'+g(o,p)+'"');var t=Math.abs(Math.round(a-c)),u=Math.abs(Math.round(e-b));switch(h(a,c,b,e)){case 1:q-=u;break;case 2:r-=t,q-=u;break;case 3:r-=t}}s.push("top:"+q+"px"),s.push("left:"+r+"px"),f.style.cssText=s.join(";")}}function g(a,b){return"progid:DXImageTransform.Microsoft.Matrix(M11 = "+b+",M12 = -"+a+",M21 = "+a+",M22 = "+b+",SizingMethod = 'auto expand')"}function h(a,b,c,d){return b>=a?c>=d?1:4:c>=d?2:3}function i(){return k._direction||(k._direction=document.createElement("div"),gantt.$task_links.appendChild(k._direction)),k._direction}function j(){k._direction&&(k._direction.parentNode&&k._direction.parentNode.removeChild(k._direction),k._direction=null)}var k=new dhtmlxDnD(this.$task_bars,{sensitivity:0,updates_per_second:60}),l="task_left",m="task_right",n="gantt_link_point",o="gantt_link_control";k.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){var d=c.target||c.srcElement;if(e(),gantt.getState().drag_id)return!1;if(gantt._locate_css(d,n)){gantt._locate_css(d,l)&&(gantt._link_source_task_start=!0);var f=gantt._link_source_task=this.locate(c),g=gantt.getTask(f);if(gantt._is_readonly(g))return e(),!1;var h=0;return gantt._get_safe_type(g.type)==gantt.config.types.milestone&&(h=(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2),this._dir_start=a(g,!!gantt._link_source_task_start,h),!0}return!1},this)),k.attachEvent("onAfterDragStart",dhtmlx.bind(function(){b(k.config.marker)},this)),k.attachEvent("onDragMove",dhtmlx.bind(function(d,e){var g=k.config,h=k.getPosition(e);c(g.marker,h);var i=gantt._is_link_drop_area(e),j=gantt._link_target_task,l=gantt._link_landing,n=gantt._link_target_task_start,p=gantt.locate(e),q=!0;if(i&&(q=!gantt._locate_css(e,m),i=!!p),gantt._link_target_task=p,gantt._link_landing=i,gantt._link_target_task_start=q,i){var r=gantt.getTask(p),s=gantt._locate_css(e,o),t=0;s&&(t=Math.floor(s.offsetWidth/2)),this._dir_end=a(r,!!gantt._link_target_task_start,t)}else this._dir_end=gantt._get_mouse_pos(e);var u=!(l==i&&j==p&&n==q);return u&&(j&&gantt.refreshTask(j,!1),p&&gantt.refreshTask(p,!1)),u&&b(g.marker),f(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y),!0},this)),k.attachEvent("onDragEnd",dhtmlx.bind(function(){var a=d();if(a.from&&a.to&&a.from!=a.to){var b=gantt._get_link_type(a.from_start,a.to_start),c={source:a.from,target:a.to,type:b};c.type&&gantt.isLinkAllowed(c)&&gantt.addLink(c)}e(),a.from&&gantt.refreshTask(a.from,!1),a.to&&gantt.refreshTask(a.to,!1),j()},this)),gantt._is_link_drop_area=function(a){return!!gantt._locate_css(a,o)}},gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start}},gantt._init_tasks=function(){function a(a,b,c,d){for(var e=0;e<a.length;e++)a[e].change_id(b,c),a[e].render_item(d)}this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}},this._click.gantt_task_link=dhtmlx.bind(function(a){var b=this.locate(a,gantt.config.link_attribute);b&&this.callEvent("onLinkClick",[b,a])},this),this._click.gantt_scale_cell=dhtmlx.bind(function(a){var b=gantt._get_mouse_pos(a),c=gantt.dateFromPos(b.x),d=Math.floor(gantt._day_index_by_date(c)),e=gantt._tasks.trace_x[d];gantt.callEvent("onScaleClick",[a,e])},this),this._dbl_click.gantt_task_link=dhtmlx.bind(function(a,b){var b=this.locate(a,gantt.config.link_attribute);this._delete_link_handler(b,a)},this),this._dbl_click.gantt_link_point=dhtmlx.bind(function(a,b,c){var b=this.locate(a),d=this.getTask(b),e=null;return c.parentNode&&gantt._getClassName(c.parentNode)&&(e=gantt._getClassName(c.parentNode).indexOf("_left")>-1?d.$target[0]:d.$source[0]),e&&this._delete_link_handler(e,a),!1},this),this._tasks_dnd.init(),this._init_links_dnd(),this._link_layers.clear();var b=this.addLinkLayer({renderer:this._render_link_element,container:this.$task_links,filter:gantt._create_filter(["_filter_link","_is_chart_visible"])});this._linkRenderer=this._link_layers.getRenderer(b),this._task_layers.clear();var c=this.addTaskLayer({renderer:this._render_task_element,container:this.$task_bars,filter:gantt._create_filter(["_filter_task","_is_chart_visible"])});this._taskRenderer=this._task_layers.getRenderer(c),this.addTaskLayer({renderer:this._render_grid_item,container:this.$grid_data,filter:gantt._create_filter(["_filter_task","_is_grid_visible"])}),this.addTaskLayer({renderer:this._render_bg_line,container:this.$task_bg,filter:gantt._create_filter(["_filter_task","_is_chart_visible","_is_std_background"])}),this._onTaskIdChange&&this.detachEvent(this._onTaskIdChange),this._onTaskIdChange=this.attachEvent("onTaskIdChange",function(b,c){var d=this._get_task_renderers();a(d,b,c,this.getTask(c))}),this._onLinkIdChange&&this.detachEvent(this._onLinkIdChange),this._onLinkIdChange=this.attachEvent("onLinkIdChange",function(b,c){var d=this._get_link_renderers();a(d,b,c,this.getLink(c))})},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&gantt[f].apply(gantt,[b.id,b])!==!1)}return c}},gantt._is_chart_visible=function(){return!!this.config.show_chart},gantt._filter_task=function(a,b){var c=null,d=null;return this.config.start_date&&this.config.end_date&&(c=this.config.start_date.valueOf(),d=this.config.end_date.valueOf(),+b.start_date>d||+b.end_date<+c)?!1:!0},gantt._filter_link=function(a,b){return this.config.show_links?!gantt.isTaskVisible(b.source)||!gantt.isTaskVisible(b.target)||gantt._isAllowedUnscheduledTask(gantt.getTask(b.source))||gantt._isAllowedUnscheduledTask(gantt.getTask(b.target))?!1:this.callEvent("onBeforeLinkDisplay",[a,b]):!1},gantt._is_std_background=function(){return!this.config.static_background},gantt._delete_link_handler=function(a,b){if(a&&this.callEvent("onLinkDblClick",[a,b])){var c=gantt.getLink(a);if(gantt._is_readonly(c))return;var d="",e=gantt.locale.labels.link+" "+this.templates.link_description(this.getLink(a))+" "+gantt.locale.labels.confirm_link_deleting;window.setTimeout(function(){gantt._dhtmlx_confirm(e,d,function(){gantt.deleteLink(a)})},gantt.config.touch?300:1)}},gantt.getTaskNode=function(a){return this._taskRenderer.rendered[a]},gantt.getLinkNode=function(a){return this._linkRenderer.rendered[a]},gantt._get_tasks_data=function(){for(var a=[],b=0;b<this._order.length;b++){var c=this._pull[this._order[b]];c.$index=b,this.resetProjectDates(c),a.push(c)}return a},gantt._get_links_data=function(){var a=[];for(var b in this._lpull)a.push(this._lpull[b]);return a},gantt._render_data=function(){if(this.callEvent("onBeforeDataRender",[]),this._is_render_active()){this._sync_order(),this._update_layout_sizes(),this.config.static_background&&this._render_bg_canvas();for(var a=this._get_tasks_data(),b=this._get_task_renderers(),c=0;c<b.length;c++)b[c].render_items(a);var d=gantt._get_links_data();b=this._get_link_renderers();for(var c=0;c<b.length;c++)b[c].render_items(d);this.callEvent("onDataRender",[])}},gantt._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var b=this.$task_data.childNodes,c=0,d=b.length;d>c;c++){var e=b[c];this._is_layer(e)&&e.style&&(e.style.width=a.full_width+"px")}if(this._is_grid_visible()){for(var f=this.getGridColumns(),g=0,c=0;c<f.length;c++)g+=f[c].width;this.$grid_data.style.width=Math.max(g-1,0)+"px"}},gantt._scale_range_unit=function(){var a=this.config.scale_unit;if(this.config.scale_offset_minimal){var b=this._get_scales();a=b[b.length-1].unit}return a},gantt._init_tasks_range=function(){var a=this._scale_range_unit();if(this.config.start_date&&this.config.end_date)return this._min_date=this.date[a+"_start"](new Date(this.config.start_date)),void(this._max_date=this.date[a+"_start"](new Date(this.config.end_date)));this._get_tasks_data();var b=this.getSubtaskDates();this._min_date=b.start_date,this._max_date=b.end_date,this._max_date&&this._max_date||(this._min_date=new Date,this._max_date=new Date(this._min_date)),this._min_date=this.date[a+"_start"](this._min_date),this._min_date=this.calculateEndDate(this.date[a+"_start"](this._min_date),-1,a),this._max_date=this.date[a+"_start"](this._max_date),this._max_date=this.calculateEndDate(this._max_date,2,a)},gantt._prepare_scale_html=function(a){var b=[],c=null,d=null,e=null;(a.template||a.date)&&(d=a.template||this.date.date_to_str(a.date)),e=a.css||function(){},!a.css&&this.config.inherit_scale_class&&(e=gantt.templates.scale_cell_class);for(var f=0;f<a.count;f++){c=new Date(a.trace_x[f]);var g=d.call(this,c),h=a.width[f],i="",j="",k="";if(h){i="width:"+h+"px;",k="gantt_scale_cell"+(f==a.count-1?" gantt_last_cell":""),j=e.call(this,c),j&&(k+=" "+j);var l="<div class='"+k+"' style='"+i+"'>"+g+"</div>";b.push(l)}}return b.join("")},gantt._get_scales=function(){var a=this._scale_helpers,b=[a.primaryScale()].concat(this.config.subscales);return a.sortScales(b),b},gantt._render_tasks_scales=function(){this._init_tasks_range(),this._scroll_resize(),this._set_sizes();var a="",b=0,c=0,d=0;if(this._is_chart_visible()){var e=this._scale_helpers,f=this._get_scales();d=this.config.scale_height-1;for(var g=this._get_resize_options(),h=g.x?Math.max(this.config.autosize_min_width,0):this.$task.offsetWidth,i=e.prepareConfigs(f,this.config.min_column_width,h,d),j=this._tasks=i[i.length-1],k=[],l=this.templates.scale_row_class,m=0;m<i.length;m++){var n="gantt_scale_line",o=l(i[m]);o&&(n+=" "+o),k.push('<div class="'+n+'" style="height:'+i[m].height+"px;line-height:"+i[m].height+'px">'+this._prepare_scale_html(i[m])+"</div>")}a=k.join(""),b=j.full_width+this.$scroll_ver.offsetWidth+"px",c=j.full_width+"px",d+="px"}this.$task.style.display=this._is_chart_visible()?"":"none",this.$task_scale.style.height=d,this.$task_data.style.width=this.$task_scale.style.width=b,this.$task_scale.innerHTML=a},gantt._render_bg_line=function(a){var b=gantt._tasks,c=b.count,d=document.createElement("div");if(gantt.config.show_task_cells)for(var e=0;c>e;e++){var f=b.width[e],g="";if(f>0){var h=document.createElement("div");h.style.width=f+"px",g="gantt_task_cell"+(e==c-1?" gantt_last_cell":""),j=this.templates.task_cell_class(a,b.trace_x[e]),j&&(g+=" "+j),h.className=g,d.appendChild(h)}}var i=a.$index%2!==0,j=gantt.templates.task_row_class(a.start_date,a.end_date,a),k="gantt_task_row"+(i?" odd":"")+(j?" "+j:"");return this.getState().selected_task==a.id&&(k+=" gantt_selected"),d.className=k,d.style.height=gantt.config.row_height+"px",d.setAttribute(this.config.task_attribute,a.id),d},gantt._render_bg_canvas=function(){},gantt._adjust_scales=function(){if(this.config.fit_tasks){var a=+this._min_date,b=+this._max_date;if(this._init_tasks_range(),+this._min_date!=a||+this._max_date!=b)return this.render(),this.callEvent("onScaleAdjusted",[]),!0}return!1},gantt.refreshTask=function(a,b){if(this._is_render_active()){var c=this._get_task_renderers(),d=this.getTask(a);if(d&&this.isTaskVisible(a)){for(var e=0;e<c.length;e++)c[e].render_item(d);if(void 0!==b&&!b)return;for(var e=0;e<d.$source.length;e++)gantt.refreshLink(d.$source[e]);for(var e=0;e<d.$target.length;e++)gantt.refreshLink(d.$target[e])}else this._render_data()}},gantt.refreshLink=function(a){if(this._is_render_active())if(this.isLinkExists(a))this._render_link(a);else for(var b=this._get_link_renderers(),c=0;c<b.length;c++)b[c].remove_item(a)},gantt._combine_item_class=function(a,b,c){var d=[a];b&&d.push(b);var e=gantt.getState(),f=this.getTask(c);this._get_safe_type(f.type)==this.config.types.milestone&&d.push("gantt_milestone"),this._get_safe_type(f.type)==this.config.types.project&&d.push("gantt_project"),this._is_flex_task(f)&&d.push("gantt_dependent_task"),this.config.select_task&&c==e.selected_task&&d.push("gantt_selected"),c==e.drag_id&&(d.push("gantt_drag_"+e.drag_mode),e.touch_drag&&d.push("gantt_touch_"+e.drag_mode));var g=gantt._get_link_state();if(g.link_source_id==c&&d.push("gantt_link_source"),g.link_target_id==c&&d.push("gantt_link_target"),this.config.highlight_critical_path&&this.isCriticalTask&&this.isCriticalTask(f)&&d.push("gantt_critical_task"),g.link_landing_area&&g.link_target_id&&g.link_source_id&&g.link_target_id!=g.link_source_id){var h=g.link_source_id,i=g.link_source_start,j=g.link_target_start,k=gantt.isLinkAllowed(h,c,i,j),l="";l=k?j?"link_start_allow":"link_finish_allow":j?"link_start_deny":"link_finish_deny",d.push(l)}return d.join(" ")},gantt._render_pair=function(a,b,c,d){var e=gantt.getState();+c.end_date<=+e.max_date&&a.appendChild(d(b+" task_right")),+c.start_date>=+e.min_date&&a.appendChild(d(b+" task_left"))},gantt._get_task_height=function(){var a=this.config.task_height;return"full"==a&&(a=this.config.row_height-5),a=Math.min(a,this.config.row_height),Math.max(a,0)},gantt._get_milestone_width=function(){return this._get_task_height()},gantt._get_visible_milestone_width=function(){var a=gantt._get_task_height();return Math.sqrt(2*a*a)},gantt.getTaskPosition=function(a,b,c){var d=this.posFromDate(b||a.start_date),e=this.posFromDate(c||a.end_date);e=Math.max(d,e);var f=this.getTaskTop(a.id),g=this.config.task_height;return{left:d,top:f,height:g,width:Math.max(e-d,0)}},gantt._get_task_width=function(a){return Math.round(this._get_task_pos(a,!1).x-this._get_task_pos(a,!0).x)},gantt._is_readonly=function(a){return a&&a[this.config.editable_property]?!1:a&&a[this.config.readonly_property]||this.config.readonly},gantt._task_default_render=function(a){if(!this._isAllowedUnscheduledTask(a)){var b=this._get_task_pos(a),c=this.config,d=this._get_task_height(),e=Math.floor((this.config.row_height-d)/2);this._get_safe_type(a.type)==c.types.milestone&&c.link_line_width>1&&(e+=1);var f=document.createElement("div"),g=gantt._get_task_width(a),h=this._get_safe_type(a.type);f.setAttribute(this.config.task_attribute,a.id),c.show_progress&&h!=this.config.types.milestone&&this._render_task_progress(a,f,g);var i=gantt._render_task_content(a,g);a.textColor&&(i.style.color=a.textColor),f.appendChild(i);var j=this._combine_item_class("gantt_task_line",this.templates.task_class(a.start_date,a.end_date,a),a.id);(a.color||a.progressColor||a.textColor)&&(j+=" gantt_task_inline_color"),f.className=j;var k=["left:"+b.x+"px","top:"+(e+b.y)+"px","height:"+d+"px","line-height:"+d+"px","width:"+g+"px"];a.color&&k.push("background-color:"+a.color),a.textColor&&k.push("color:"+a.textColor),f.style.cssText=k.join(";");var l=this._render_leftside_content(a);return l&&f.appendChild(l),l=this._render_rightside_content(a),l&&f.appendChild(l),this._is_readonly(a)||(c.drag_resize&&!this._is_flex_task(a)&&h!=this.config.types.milestone&&gantt._render_pair(f,"gantt_task_drag",a,function(a){var b=document.createElement("div");return b.className=a,b}),c.drag_links&&this.config.show_links&&gantt._render_pair(f,"gantt_link_control",a,function(a){var b=document.createElement("div");b.className=a,b.style.cssText=["height:"+d+"px","line-height:"+d+"px"].join(";");var c=document.createElement("div");return c.className="gantt_link_point",b.appendChild(c),b})),f}},gantt._render_task_element=function(a){var b=this.config.type_renderers,c=b[this._get_safe_type(a.type)],d=this._task_default_render;return c||(c=d),c.call(this,a,dhtmlx.bind(d,this))},gantt._render_side_content=function(a,b,c){if(!b)return null;var d=b(a.start_date,a.end_date,a);if(!d)return null;var e=document.createElement("div");return e.className="gantt_side_content "+c,e.innerHTML=d,e},gantt._render_leftside_content=function(a){var b="gantt_left "+gantt._get_link_crossing_css(!0,a);return gantt._render_side_content(a,this.templates.leftside_text,b)},gantt._render_rightside_content=function(a){var b="gantt_right "+gantt._get_link_crossing_css(!1,a);return gantt._render_side_content(a,this.templates.rightside_text,b)},gantt._get_conditions=function(a){return a?{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]}:{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]}},gantt._get_link_crossing_css=function(a,b){var c=gantt._get_conditions(a);for(var d in c)for(var e=b[d],f=0;f<e.length;f++)for(var g=gantt.getLink(e[f]),h=0;h<c[d].length;h++)if(g.type==c[d][h])return"gantt_link_crossing";return""},gantt._render_task_content=function(a){var b=document.createElement("div");return this._get_safe_type(a.type)!=this.config.types.milestone&&(b.innerHTML=this.templates.task_text(a.start_date,a.end_date,a)),b.className="gantt_task_content",b},gantt._render_task_progress=function(a,b,c){var d=1*a.progress||0;c=Math.max(c-2,0);var e=document.createElement("div"),f=Math.round(c*d);if(f=Math.min(c,f),a.progressColor&&(e.style.backgroundColor=a.progressColor,e.style.opacity=1),e.style.width=f+"px",e.className=this.templates.progress_class?this.templates.progress_class(a):"gantt_task_progress",e.innerHTML=this.templates.progress_text(a.start_date,a.end_date,a),b.appendChild(e),this.config.drag_progress&&!gantt._is_readonly(a)){var g=document.createElement("div");g.style.left=f+"px",g.className="gantt_task_progress_drag",e.appendChild(g),b.appendChild(g)}},gantt._get_line=function(a){var b={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3,year:31536e3};return b[a]||0},gantt.dateFromPos=function(a){var b=this._tasks;if(0>a||a>b.full_width||!b.full_width)return null;var c=this._findBinary(this._tasks.left,a),d=this._tasks.left[c],e=b.width[c]||b.col_width,f=0;e&&(f=(a-d)/e);var g=0;f&&(g=gantt._get_coll_duration(b,b.trace_x[c]));var h=new Date(b.trace_x[c].valueOf()+Math.round(f*g));return h},gantt.posFromDate=function(a){var b=gantt._day_index_by_date(a);dhtmlx.assert(b>=0,"Invalid day index");var c=Math.floor(b),d=b%1,e=gantt._tasks.left[Math.min(c,gantt._tasks.width.length-1)];return c==gantt._tasks.width.length&&(e+=gantt._tasks.width[gantt._tasks.width.length-1]),d&&(e+=c<gantt._tasks.width.length?gantt._tasks.width[c]*(d%1):1),e},gantt._day_index_by_date=function(a){var b=new Date(a).valueOf(),c=gantt._tasks.trace_x,d=gantt._tasks.ignore_x;if(b<=this._min_date)return 0;if(b>=this._max_date)return c.length;for(var e=gantt._findBinary(c,b),f=+gantt._tasks.trace_x[e];d[f];)f=gantt._tasks.trace_x[++e];return f?e+(a-c[e])/gantt._get_coll_duration(gantt._tasks,c[e]):0},gantt._findBinary=function(a,b){for(var c,d,e,f=0,g=a.length-1;g>=f;)if(c=Math.floor((f+g)/2),d=+a[c],e=+a[c-1],b>d)f=c+1;else{if(!(d>b))return c;if(!isNaN(e)&&b>e)return c-1;g=c-1}return a.length-1},gantt._get_coll_duration=function(a,b){return gantt.date.add(b,a.step,a.unit)-b},gantt._get_x_pos=function(a,b){b=b!==!1;gantt.posFromDate(b?a.start_date:a.end_date)},gantt.getTaskTop=function(a){return this._y_from_ind(this.getGlobalTaskIndex(a))},gantt._get_task_coord=function(a,b,c){b=b!==!1,c=c||0;var d=this._get_safe_type(a.type)==this.config.types.milestone,e=null;e=b||d?a.start_date||this._default_task_date(a):a.end_date||this.calculateEndDate(this._default_task_date(a));var f=this.posFromDate(e),g=this.getTaskTop(a.id);return d&&(b?f-=c:f+=c),{x:f,y:g}},gantt._get_task_pos=function(a,b){b=b!==!1;var c=gantt._get_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._get_task_visible_pos=function(a,b){b=b!==!1;var c=gantt._get_visible_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._correct_shift=function(a,b){return a-=6e4*(new Date(gantt._min_date).getTimezoneOffset()-new Date(a).getTimezoneOffset())*(b?-1:1)},gantt._get_mouse_pos=function(a){if(a.pageX||a.pageY)var b={x:a.pageX,y:a.pageY};var c=_isIE?document.documentElement:document.body,b={x:a.clientX+c.scrollLeft-c.clientLeft,y:a.clientY+c.scrollTop-c.clientTop},d=gantt._get_position(gantt.$task_data);return b.x=b.x-d.x+gantt.$task_data.scrollLeft,b.y=b.y-d.y+gantt.$task_data.scrollTop,b},gantt._is_layer=function(a){return a&&a.hasAttribute&&a.hasAttribute(this.config.layer_attribute)},gantt._task_renderer=function(a,b,c,d){return this._task_area_pulls||(this._task_area_pulls={}),this._task_area_renderers||(this._task_area_renderers={}),this._task_area_renderers[a]?this._task_area_renderers[a]:(b||dhtmlx.assert(!1,"Invalid renderer call"),c&&c.setAttribute(this.config.layer_attribute,!0),this._task_area_renderers[a]={render_item:function(e,f){var g=gantt._task_area_pulls[a];if(f=f||c,d&&!d(e))return void this.remove_item(e.id);var h=b.call(gantt,e);h&&(g[e.id]?this.replace_item(e.id,h):(g[e.id]=h,f.appendChild(h)))},clear:function(b){this.rendered=gantt._task_area_pulls[a]={},b=b||c,b&&(b.innerHTML="")},render_items:function(a,b){b=b||c,this.clear(b);for(var d=document.createDocumentFragment(),e=0,f=a.length;f>e;e++)this.render_item(a[e],d);b.appendChild(d)},replace_item:function(a,b){var c=this.rendered[a];c&&c.parentNode&&c.parentNode.replaceChild(b,c),this.rendered[a]=b},remove_item:function(a){var b=this.rendered[a];b&&b.parentNode&&b.parentNode.removeChild(b),delete this.rendered[a]},change_id:function(a,b){this.rendered[b]=this.rendered[a],delete this.rendered[a]},rendered:this._task_area_pulls[a],node:c,unload:function(){this.clear(),delete gantt._task_area_renderers[a],delete gantt._task_area_pulls[a]}},this._task_area_renderers[a])},gantt._clear_renderers=function(){for(var a in this._task_area_renderers)this._task_renderer(a).unload()},gantt._render_bg_canvas=function(){var a=gantt._tasks,b=gantt.$task_bg,c=document.createElement("canvas"),d=gantt.config.row_height,e=a.col_width;if(c.getContext){c.height=d,c.width=e;var f=document.createElement("div"),g=document.createElement("div");f.className="gantt_task_row",g.className="gantt_task_cell",f.style.display=g.style.display="none",b.appendChild(f),f.appendChild(g);var h=c.getContext("2d");h.beginPath(),h.moveTo(0,d),h.lineTo(e,d),h.lineWidth=1,h.strokeStyle=getComputedStyle(f).getPropertyValue("border-bottom-color")||"#ebebeb",h.stroke(),h.beginPath(),h.moveTo(e,d),h.lineTo(e,0),h.lineWidth=1,h.strokeStyle=getComputedStyle(g).getPropertyValue("border-right-color")||"#ebebeb",h.stroke(),a.fill_img=c.toDataURL(),b.style.height=d*gantt._order.length+"px",b.style.backgroundImage="url("+a.fill_img+")",b.removeChild(f)}},gantt.attachEvent("onGanttReady",function(){gantt._task_layers.add(),gantt._link_layers.add()}),gantt._layers={prepareConfig:function(a){"function"==typeof a&&(a={renderer:a});a.id=dhtmlx.uid();return a.container||(a.container=document.createElement("div")),a},create:function(a,b){return{tempCollection:[],renderers:{},container:a,getRenderers:function(){var a=[];for(var b in this.renderers)a.push(this.renderers[b]);return a},getRenderer:function(a){return this.renderers[a]},add:function(a){if(a&&this.tempCollection.push(a),this.container())for(var c=this.container(),d=this.tempCollection,e=0;e<d.length;e++){var a=d[e],f=a.container,g=a.id,h=a.topmost;if(!f.parentNode)if(h)c.appendChild(f);else{var i=b?b():c.firstChild;i?c.insertBefore(f,i):c.appendChild(f)}this.renderers[g]=gantt._task_renderer(g,a.renderer,f,a.filter),this.tempCollection.splice(e,1),e--}},remove:function(a){this.renderers[a].unload(),delete this.renderers[a]},clear:function(){for(var a in this.renderers)this.renderers[a].unload();this.renderers={}}}}},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&gantt[f].call(gantt,b.id,b)!==!1)}return c}},gantt._add_generic_layer=function(a,b){return function(c){return void 0===c.filter&&(c.filter=gantt._create_filter(b)),c=gantt._layers.prepareConfig(c),a.add(c),c.id}},gantt._task_layers=gantt._layers.create(function(){return gantt.$task_data},function(){return gantt.$task_links}),gantt._link_layers=gantt._layers.create(function(){return gantt.$task_data}),gantt.addTaskLayer=gantt._add_generic_layer(gantt._task_layers,["_filter_task","_is_chart_visible"]),gantt.removeTaskLayer=function(a){gantt._task_layers.remove(a)},gantt.addLinkLayer=gantt._add_generic_layer(gantt._link_layers,["_filter_link","_is_chart_visible"]),gantt.removeLinkLayer=function(a){gantt._link_layers.remove(a)},gantt._get_task_renderers=function(){return this._task_layers.getRenderers()
},gantt._get_link_renderers=function(){return this._link_layers.getRenderers()},gantt._pull={},gantt._branches={},gantt._order=[],gantt._lpull={},gantt._order_full=[],gantt.load=function(a,b,c){this._load_url=a,dhtmlx.assert(arguments.length,"Invalid load arguments"),this.callEvent("onLoadStart",[]);var d="json",e=null;arguments.length>=3?(d=b,e=c):"string"==typeof arguments[1]?d=arguments[1]:"function"==typeof arguments[1]&&(e=arguments[1]),this._load_type=d,dhx4.ajax.get(a,dhtmlx.bind(function(a){this.on_load(a,d),this.callEvent("onLoadEnd",[]),"function"==typeof e&&e.call(this)},this))},gantt.parse=function(a,b){this.on_load({xmlDoc:{responseText:a}},b)},gantt.serialize=function(a){return a=a||"json",this[a].serialize()},gantt.on_load=function(a,b){this.callEvent("onBeforeParse",[]),b||(b="json"),dhtmlx.assert(this[b],"Invalid data type:'"+b+"'");var c=a.xmlDoc.responseText,d=this[b].parse(c,a);this._process_loading(d)},gantt._process_loading=function(a){a.collections&&this._load_collections(a.collections);for(var b,c=a.data,d=0;d<c.length;d++)b=c[d],this._init_task(b),this.callEvent("onTaskLoading",[b])&&(this._order_full.push(b.id),this._pull[b.id]=b);for(var d in this._pull)b=this._pull[d],this.setParent(b,this.getParent(b)||this.config.root_id);for(var d=0;d<this._order_full.length;d++)b=this._pull[this._order_full[d]],this._add_branch(b),b.$level=this.calculateTaskLevel(b);if(this._sync_order(),this._init_links(a.links||(a.collections?a.collections.links:[])),this.callEvent("onParse",[]),this.render(),this.config.initial_scroll){var e=this._order[0]||this.config.root_id;e&&this.showTask(e)}},gantt._init_links=function(a){if(a)for(var b=0;b<a.length;b++)if(a[b]){var c=this._init_link(a[b]);this._lpull[c.id]=c}this._sync_links()},gantt._load_collections=function(a){var b=!1;for(var c in a)if(a.hasOwnProperty(c)){b=!0;var d=a[c],e=this.serverList[c];if(!e)continue;e.splice(0,e.length);for(var f=0;f<d.length;f++){var g=d[f],h=dhtmlx.copy(g);h.key=h.value;for(var i in g)if(g.hasOwnProperty(i)){if("value"==i||"label"==i)continue;h[i]=g[i]}e.push(h)}}b&&this.callEvent("onOptionsLoad",[])},gantt._sync_order=function(a){this._order=[],this._sync_order_item({parent:this.config.root_id,$open:!0,$ignore:!0,id:this.config.root_id}),a||(this._scroll_resize(),this._set_sizes())},gantt.attachEvent("onBeforeTaskDisplay",function(a,b){return!b.$ignore}),gantt._sync_order_item=function(a){if(a.id&&this._filter_task(a.id,a)&&this.callEvent("onBeforeTaskDisplay",[a.id,a])&&this._order.push(a.id),a.$open){var b=this.getChildren(a.id);if(b)for(var c=0;c<b.length;c++)this._sync_order_item(this._pull[b[c]])}},gantt.getTaskCount=function(){return this._order_full.length},gantt.getVisibleTaskCount=function(){return this._order.length},gantt.getTaskIndex=function(a){for(var b=this.getChildren(this.getParent(a)),c=0;c<b.length;c++)if(b[c]==a)return c;return-1},gantt.getGlobalTaskIndex=function(a){dhtmlx.assert(a,"Invalid argument");for(var b=this._order,c=0,d=b.length;d>c;c++)if(b[c]==a)return c;return-1},gantt._get_visible_order=gantt.getGlobalTaskIndex,gantt.eachTask=function(a,b,c){b=b||this.config.root_id,c=c||this;var d=this.getChildren(b);if(d)for(var e=0;e<d.length;e++){var f=this._pull[d[e]];a.call(c,f),this.hasChild(f.id)&&this.eachTask(a,f.id,c)}},gantt.json={parse:function(data){return dhtmlx.assert(data,"Invalid data"),"string"==typeof data&&(window.JSON?data=JSON.parse(data):(gantt._temp=eval("("+data+")"),data=gantt._temp||{},gantt._temp=null)),data.dhx_security&&(dhtmlx.security_key=data.dhx_security),data},_copyLink:function(a){var b={};for(var c in a)b[c]=a[c];return b},_copyObject:function(a){var b={};for(var c in a)"$"!=c.charAt(0)&&(b[c]=a[c],b[c]instanceof Date&&(b[c]=gantt.templates.xml_format(b[c])));return b},serialize:function(){var a=[],b=[];gantt.eachTask(function(b){gantt.resetProjectDates(b),a.push(this._copyObject(b))},gantt.config.root_id,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return{data:a,links:b}}},gantt.xml={_xmlNodeToJSON:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=a.attributes[d].value;if(!b){for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];1==e.nodeType&&(c[e.tagName]=e.firstChild?e.firstChild.nodeValue:"")}c.text||(c.text=a.firstChild?a.firstChild.nodeValue:"")}return c},_getCollections:function(a){for(var b={},c=dhx4.ajax.xpath("//coll_options",a),d=0;d<c.length;d++)for(var e=c[d].getAttribute("for"),f=b[e]=[],g=dhx4.ajax.xpath(".//item",c[d]),h=0;h<g.length;h++){for(var i=g[h],j=i.attributes,k={key:g[h].getAttribute("value"),label:g[h].getAttribute("label")},l=0;l<j.length;l++){var m=j[l];"value"!=m.nodeName&&"label"!=m.nodeName&&(k[m.nodeName]=m.nodeValue)}f.push(k)}return b},_getXML:function(a,b,c){c=c||"data",b.getXMLTopNode||(b=dhx4.ajax.parse(b));var d=dhx4.ajax.xmltop(c,b.xmlDoc);if(d.tagName!=c)throw"Invalid XML data";var e=d.getAttribute("dhx_security");return e&&(dhtmlx.security_key=e),d},parse:function(a,b){b=this._getXML(a,b);for(var c={},d=c.data=[],e=dhx4.ajax.xpath("//task",b),f=0;f<e.length;f++)d[f]=this._xmlNodeToJSON(e[f]);return c.collections=this._getCollections(b),c},_copyLink:function(a){return"<item id='"+a.id+"' source='"+a.source+"' target='"+a.target+"' type='"+a.type+"' />"},_copyObject:function(a){return"<task id='"+a.id+"' parent='"+(a.parent||"")+"' start_date='"+a.start_date+"' duration='"+a.duration+"' open='"+!!a.open+"' progress='"+a.progress+"' end_date='"+a.end_date+"'><![CDATA["+a.text+"]]></task>"},serialize:function(){for(var a=[],b=[],c=gantt.json.serialize(),d=0,e=c.data.length;e>d;d++)a.push(this._copyObject(c.data[d]));for(var d=0,e=c.links.length;e>d;d++)b.push(this._copyLink(c.links[d]));return"<data>"+a.join("")+"<coll_options for='links'>"+b.join("")+"</coll_options></data>"}},gantt.oldxml={parse:function(a,b){b=gantt.xml._getXML(a,b,"projects");for(var c={collections:{links:[]}},d=c.data=[],e=dhx4.ajax.xpath("//task",b),f=0;f<e.length;f++){d[f]=gantt.xml._xmlNodeToJSON(e[f]);var g=e[f].parentNode;d[f].parent="project"==g.tagName?"project-"+g.getAttribute("id"):g.parentNode.getAttribute("id")}e=dhx4.ajax.xpath("//project",b);for(var f=0;f<e.length;f++){var h=gantt.xml._xmlNodeToJSON(e[f],!0);h.id="project-"+h.id,d.push(h)}for(var f=0;f<d.length;f++){var h=d[f];h.start_date=h.startdate||h.est,h.end_date=h.enddate,h.text=h.name,h.duration=h.duration/8,h.open=1,h.duration||h.end_date||(h.duration=1),h.predecessortasks&&c.collections.links.push({target:h.id,source:h.predecessortasks,type:gantt.config.links.finish_to_start})}return c},serialize:function(){dhtmlx.message("Serialization to 'old XML' is not implemented")}},gantt.serverList=function(a,b){return b?this.serverList[a]=b.slice(0):this.serverList[a]||(this.serverList[a]=[]),this.serverList[a]},gantt._working_time_helper={units:["year","month","week","day","hour","minute"],hours:[8,17],dates:{0:!1,6:!1},_working_units_cache:{_cache:{},get:function(a,b){if(!a||!b)return-1;var c=this._cache,d=b.getTime(),e=-1;return c&&c[a]&&void 0!==c[a][d]&&(e=c[a][d]),e},put:function(a,b,c){if(!a||!b)return!1;var d=this._cache,e=b.getTime();return c=!!c,d?(d[a]||(d[a]={}),d[a][e]=c,!0):!1},clear:function(){this._cache={}}},_get_unit_order:function(a){for(var b=0,c=this.units.length;c>b;b++)if(this.units[b]==a)return b;dhtmlx.assert(!1,"Incorrect duration unit")},_timestamp:function(a){var b=null;return a.day||0===a.day?b=a.day:a.date&&(b=gantt.date.date_part(new Date(a.date)).valueOf()),b},set_time:function(a){var b=void 0!==a.hours?a.hours:!0,c=this._timestamp(a);null!==c?this.dates[c]=b:this.hours=b,this._working_units_cache.clear()},unset_time:function(a){if(a){var b=this._timestamp(a);null!==b&&delete this.dates[b]}else this.hours=[];this._working_units_cache.clear()},is_working_unit:function(a,b,c){if(!gantt.config.work_time)return!0;var d=this._working_units_cache.get(b,a);return-1==d&&(d=this._check_is_working_unit(a,b,c),this._working_units_cache.put(b,a,d)),d},_check_is_working_unit:function(a,b,c){return void 0===c&&(c=this._get_unit_order(b)),void 0===c?!1:c&&!this.is_working_unit(a,this.units[c-1],c-1)?!1:this["is_work_"+b]?this["is_work_"+b](a):!0},is_work_day:function(a){var b=this.get_working_hours(a);return b instanceof Array?b.length>0:!1},is_work_hour:function(a){for(var b=this.get_working_hours(a),c=a.getHours(),d=0;d<b.length;d+=2){if(void 0===b[d+1])return b[d]==c;if(c>=b[d]&&c<b[d+1])return!0}return!1},get_working_hours:function(a){var b=this._timestamp({date:a}),c=!0;return void 0!==this.dates[b]?c=this.dates[b]:void 0!==this.dates[a.getDay()]&&(c=this.dates[a.getDay()]),c===!0?this.hours:c?c:[]},get_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1,g=0;e.valueOf()<f.valueOf();)this.is_working_unit(e,c)&&g++,e=gantt.date.add(e,d,c);return g},is_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1;e.valueOf()<f.valueOf();){if(this.is_working_unit(e,c))return!0;e=gantt.date.add(e,d,c)}return!1},add_worktime:function(a,b,c,d){if(!c)return!1;var e=new Date(a),f=0,d=d||1,b=1*b;if(gantt.config.work_time){for(;b>f;){var g=gantt.date.add(e,d,c);this.is_working_unit(d>0?e:g,c)&&f++,e=g}return e}return gantt.date.add(e,d*b,c)},get_closest_worktime:function(a){if(this.is_working_unit(a.date,a.unit))return a.date;var b=a.unit,c=gantt.date[b+"_start"](a.date),d=new Date(c),e=new Date(c),f=!0,g=3e3,h=0,i="any"==a.dir||!a.dir,j=1;for("past"==a.dir&&(j=-1);!this.is_working_unit(c,b);){i&&(c=f?d:e,j=-1*j);var k=c.getTimezoneOffset();if(c=gantt.date.add(c,j,b),c=gantt._correct_dst_change(c,k,j,b),gantt.date[b+"_start"]&&(c=gantt.date[b+"_start"](c)),i&&(f?d=c:e=c),f=!f,h++,h>g)return dhtmlx.assert(!1,"Invalid working time check"),!1}return(c==e||"past"==a.dir)&&(c=gantt.date.add(c,1,b)),c}},gantt.getTask=function(a){return dhtmlx.assert(a,"Invalid argument for gantt.getTask"),dhtmlx.assert(this._pull[a],"Task not found id="+a),this._pull[a]},gantt.getTaskByTime=function(a,b){var c=this._pull,d=[];if(a||b){a=+a||-1/0,b=+b||1/0;for(var e in c){var f=c[e];+f.start_date<b&&+f.end_date>a&&d.push(f)}}else for(var e in c)d.push(c[e]);return d},gantt.isTaskExists=function(a){return dhtmlx.defined(this._pull[a])},gantt.isUnscheduledTask=function(a){return!!a.unscheduled||!a.start_date},gantt._isAllowedUnscheduledTask=function(a){return a.unscheduled&&gantt.config.show_unscheduled},gantt.isTaskVisible=function(a){if(!this._pull[a])return!1;var b=this._pull[a];if(!(+b.start_date<+this._max_date&&+b.end_date>+this._min_date||gantt._isAllowedUnscheduledTask(b)))return!1;for(var c=0,d=this._order.length;d>c;c++)if(this._order[c]==a)return!0;return!1},gantt.updateTask=function(a,b){return dhtmlx.defined(b)||(b=this.getTask(a)),this.callEvent("onBeforeTaskUpdate",[a,b])===!1?!1:(this._pull[b.id]=b,this._is_parent_sync(b)||this._resync_parent(b),this._isAllowedUnscheduledTask(b)&&(this._init_task(b),this._sync_links()),this._update_parents(b.id),this.refreshTask(b.id),this.callEvent("onAfterTaskUpdate",[a,b]),this._sync_order(),void this._adjust_scales())},gantt._add_branch=function(a,b){var c=this.getParent(a);this.hasChild(c)||(this._branches[c]=[]);for(var d=this.getChildren(c),e=!1,f=0,g=d.length;g>f;f++)if(d[f]==a.id){e=!0;break}e||(1*b==b?d.splice(b,0,a.id):d.push(a.id)),this._sync_parent(a)},gantt._move_branch=function(a,b,c){this.setParent(a,c),this._sync_parent(a),this._replace_branch_child(b,a.id),this.isTaskExists(c)||c==this.config.root_id?this._add_branch(a):delete this._branches[a.id],a.$level=this.calculateTaskLevel(a),this._sync_order()},gantt._resync_parent=function(a){this._move_branch(a,a.$rendered_parent,this.getParent(a))},gantt._sync_parent=function(a){a.$rendered_parent=this.getParent(a)},gantt._is_parent_sync=function(a){return a.$rendered_parent==this.getParent(a)},gantt._replace_branch_child=function(a,b,c){var d=this.getChildren(a);if(d){for(var e=[],f=0;f<d.length;f++)d[f]!=b?e.push(d[f]):c&&e.push(c);this._branches[a]=e}this._sync_order()},gantt.addTask=function(a,b,c){return dhtmlx.defined(b)||(b=this.getParent(a)||0),this.isTaskExists(b)||(b=0),this.setParent(a,b),a=this._init_task(a),this.callEvent("onBeforeTaskAdd",[a.id,a])===!1?!1:(this._pull[a.id]=a,this._add_branch(a,c),this.refreshData(),this._adjust_scales(),this.callEvent("onAfterTaskAdd",[a.id,a]),a.id)},gantt._default_task_date=function(a,b){var c=b&&b!=this.config.root_id?this.getTask(b):!1,d="";if(c)d=c.start_date;else{var e=this._order[0];d=e?this.getTask(e).start_date?this.getTask(e).start_date:this.getTask(e).end_date?this.calculateEndDate(this.getTask(e).end_date,-this.config.duration_step):"":this.config.start_date||this.getState().min_date}return dhtmlx.assert(d,"Invalid dates"),new Date(d)},gantt._set_default_task_timing=function(a){a.start_date=a.start_date||gantt._default_task_date(a,this.getParent(a)),a.duration=a.duration||this.config.duration_step,a.end_date=a.end_date||this.calculateEndDate(a.start_date,a.duration)},gantt.createTask=function(a,b,c){if(a=a||{},a.id=dhtmlx.uid(),a.start_date||(a.start_date=gantt._default_task_date(a,b)),void 0===a.text&&(a.text=gantt.locale.labels.new_task),void 0===a.duration&&(a.duration=1),b){this.setParent(a,b);var d=this.getTask(b);d.$open=!0}return this.callEvent("onTaskCreated",[a])?(this.config.details_on_create?(a.$new=!0,this._pull[a.id]=this._init_task(a),this._add_branch(a,c),a.$level=this.calculateTaskLevel(a),this.selectTask(a.id),this.refreshData(),this.showLightbox(a.id)):this.addTask(a,b,c)&&(this.showTask(a.id),this.selectTask(a.id)),a.id):null},gantt.deleteTask=function(a){return this._deleteTask(a)},gantt._getChildLinks=function(a){var b=this.getTask(a);if(!b)return[];for(var c=b.$source.concat(b.$target),d=this.getChildren(b.id),e=0;e<d.length;e++)c=c.concat(this._getChildLinks(d[e]));for(var f={},e=0;e<c.length;e++)f[c[e]]=!0;c=[];for(var e in f)c.push(e);return c},gantt._getTaskTree=function(a){var b=this.getTask(a);if(!b)return[];for(var c=[],d=this.getChildren(b.id),e=0;e<d.length;e++)c.push(d[e]),c=c.concat(this._getTaskTree(d[e]));return c},gantt._deleteRelatedLinks=function(a,b){var c=this._dp&&!b,d="",e=c?"off"!=this._dp.updateMode:!1;c&&(d=this._dp.updateMode,this._dp.setUpdateMode("off"));for(var f=0;f<a.length;f++)c&&(this._dp.setGanttMode("links"),this._dp.setUpdated(a[f],!0,"deleted")),this._deleteLink(a[f],!0);c&&(this._dp.setUpdateMode(d),e&&this._dp.sendAllData())},gantt._deleteRelatedTasks=function(a,b){var c=this._dp&&!b,d="";c&&(d=this._dp.updateMode,this._dp.setGanttMode("tasks"),this._dp.setUpdateMode("off"));for(var e=this._getTaskTree(a),f=0;f<e.length;f++){var g=e[f];this._unset_task(g),c&&this._dp.setUpdated(g,!0,"deleted")}c&&this._dp.setUpdateMode(d)},gantt._unset_task=function(a){var b=this.getTask(a);this._update_flags(a,null),delete this._pull[a],this._move_branch(b,this.getParent(b),null)},gantt._deleteTask=function(a,b){var c=this.getTask(a);if(!b&&this.callEvent("onBeforeTaskDelete",[a,c])===!1)return!1;var d=gantt._getChildLinks(a);return this._deleteRelatedTasks(a,b),this._deleteRelatedLinks(d,b),this._unset_task(a),b||(this.callEvent("onAfterTaskDelete",[a,c]),this.refreshData()),!0},gantt.clearAll=function(){this._clear_data(),this.callEvent("onClear",[]),this.refreshData()},gantt._clear_data=function(){this._pull={},this._branches={},this._order=[],this._order_full=[],this._lpull={},this._update_flags(),this.userdata={}},gantt._update_flags=function(a,b){void 0===a?(this._lightbox_id=this._selected_task=null,this._tasks_dnd.drag&&(this._tasks_dnd.drag.id=null)):(this._lightbox_id==a&&(this._lightbox_id=b),this._selected_task==a&&(this._selected_task=b),this._tasks_dnd.drag&&this._tasks_dnd.drag.id==a&&(this._tasks_dnd.drag.id=b))},gantt.changeTaskId=function(a,b){var c=this._pull[b]=this._pull[a];this._pull[b].id=b,delete this._pull[a];for(var d in this._pull){var e=this._pull[d];this.getParent(e)==a&&this.setParent(e,b)}this._update_flags(a,b),this._replace_branch_child(this.getParent(c),a,b),this.callEvent("onTaskIdChange",[a,b])},gantt._get_duration_unit=function(){return 1e3*gantt._get_line(this.config.duration_unit)||this.config.duration_unit},gantt._get_safe_type=function(){return"task"},gantt._get_type_name=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return b;return"task"},gantt.getWorkHours=function(a){return this._working_time_helper.get_working_hours(a)},gantt.setWorkTime=function(a){this._working_time_helper.set_time(a)},gantt.isWorkTime=function(a,b){var c=this._working_time_helper;return c.is_working_unit(a,b||this.config.duration_unit)},gantt.correctTaskWorkTime=function(a){gantt.config.work_time&&gantt.config.correct_work_time&&(gantt.isWorkTime(a.start_date)?gantt.isWorkTime(new Date(+a.end_date-1))||(a.end_date=gantt.calculateEndDate(a.start_date,a.duration)):(a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}),a.end_date=gantt.calculateEndDate(a.start_date,a.duration)))},gantt.getClosestWorkTime=function(a){var b=this._working_time_helper;return a instanceof Date&&(a={date:a}),a.dir=a.dir||"any",a.unit=a.unit||this.config.duration_unit,b.get_closest_worktime(a)},gantt.calculateDuration=function(a,b){var c=this._working_time_helper;return c.get_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt._hasDuration=function(a,b){var c=this._working_time_helper;return c.is_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt.calculateEndDate=function(a,b,c){var d=this._working_time_helper,e=b>=0?1:-1;return d.add_worktime(a,Math.abs(b),c||this.config.duration_unit,e*this.config.duration_step)},gantt._init_task=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a.start_date&&(a.start_date=gantt.date.parseDate(a.start_date,"xml_date")),a.end_date&&(a.end_date=gantt.date.parseDate(a.end_date,"xml_date")),a.start_date?!a.end_date&&a.duration&&(a.end_date=this.calculateEndDate(a.start_date,a.duration)):a.end_date&&void 0!==a.duration&&(a.start_date=this.calculateEndDate(a.end_date,-a.duration)),this._isAllowedUnscheduledTask(a)&&this._set_default_task_timing(a),gantt._init_task_timing(a),a.start_date&&a.end_date&&gantt.correctTaskWorkTime(a),a.$source=[],a.$target=[],void 0===a.parent&&this.setParent(a,this.config.root_id),dhtmlx.defined(a.$open)||(a.$open=dhtmlx.defined(a.open)?a.open:this.config.open_tree_initially),a.$level=this.calculateTaskLevel(a),a},gantt._init_task_timing=function(a){var b=this._get_safe_type(a.type);void 0===a.$rendered_type?a.$rendered_type=b:a.$rendered_type!=b&&(delete a.$no_end,delete a.$no_start,a.$rendered_type=b),void 0!==a.$no_end&&void 0!==a.$no_start||b==this.config.types.milestone||(b==this.config.types.project?(a.$no_end=a.$no_start=!0,this._set_default_task_timing(a)):(a.$no_end=!(a.end_date||a.duration),a.$no_start=!a.start_date,this._isAllowedUnscheduledTask(a)&&(a.$no_end=a.$no_start=!1))),b==this.config.types.milestone&&(a.end_date=a.start_date),a.start_date&&a.end_date&&(a.duration=this.calculateDuration(a.start_date,a.end_date)),a.duration=a.duration||0},gantt._is_flex_task=function(a){return!(!a.$no_end&&!a.$no_start)},gantt.resetProjectDates=function(a){if(a.$no_end||a.$no_start){var b=this.getSubtaskDates(a.id);this._assign_project_dates(a,b.start_date,b.end_date)}},gantt.getSubtaskDates=function(a){var b=null,c=null,d=void 0!==a?a:gantt.config.root_id;return this.eachTask(function(a){this._get_safe_type(a.type)==gantt.config.types.project||this.isUnscheduledTask(a)||(a.start_date&&!a.$no_start&&(!b||b>a.start_date.valueOf())&&(b=a.start_date.valueOf()),a.end_date&&!a.$no_end&&(!c||c<a.end_date.valueOf())&&(c=a.end_date.valueOf()))},d),{start_date:b?new Date(b):null,end_date:c?new Date(c):null}},gantt._assign_project_dates=function(a,b,c){a.$no_start&&(a.start_date=b&&1/0!=b?new Date(b):this._default_task_date(a,this.getParent(a))),a.$no_end&&(a.end_date=c&&c!=-1/0?new Date(c):this.calculateEndDate(a.start_date,this.config.duration_step)),(a.$no_start||a.$no_end)&&this._init_task_timing(a)},gantt._update_parents=function(a,b){if(a){for(var c=this.getTask(a),d=this.getParent(c);!c.$no_end&&!c.$no_start&&d&&this.isTaskExists(d);)c=this.getTask(d),d=this.getParent(c);(c.$no_start||c.$no_end)&&(gantt.resetProjectDates(c),b||this.refreshTask(c.id,!0)),d&&this.isTaskExists(d)&&this._update_parents(d,b)}},gantt.isChildOf=function(a,b){if(!this.isTaskExists(a))return!1;if(b===this.config.root_id)return this.isTaskExists(a);for(var c=this.getTask(a),d=this.getParent(a);c&&this.isTaskExists(d);){if(c=this.getTask(d),c&&c.id==b)return!0;d=this.getParent(c)}return!1},gantt.roundDate=function(a){a instanceof Date&&(a={date:a,unit:gantt._tasks.unit,step:gantt._tasks.step});var b,c,d=a.date,e=a.step,f=a.unit;if(f==gantt._tasks.unit&&e==gantt._tasks.step&&+d>=+gantt._min_date&&+d<=+gantt._max_date){var g=Math.floor(gantt._day_index_by_date(d));c=new Date(gantt._tasks.trace_x[g]),b=new Date(c),gantt._tasks.trace_x[g+1]&&(b=new Date(gantt._tasks.trace_x[g+1]))}else{for(b=gantt.date[f+"_start"](new Date(this._min_date));+d>+b;){b=gantt.date[f+"_start"](gantt.date.add(b,e,f));var h=b.getTimezoneOffset();b=gantt.date.add(b,e,f),b=gantt._correct_dst_change(b,h,b,f),gantt.date[f+"_start"]&&(b=gantt.date[f+"_start"](b))}c=gantt.date.add(b,-1*e,f)}return a.dir&&"future"==a.dir?b:a.dir&&"past"==a.dir?c:Math.abs(d-c)<Math.abs(b-d)?c:b},gantt.attachEvent("onBeforeTaskUpdate",function(a,b){return gantt._init_task_timing(b),!0}),gantt.attachEvent("onBeforeTaskAdd",function(a,b){return gantt._init_task_timing(b),!0}),gantt.calculateTaskLevel=function(a){for(var b=0;this.getParent(a)&&this.isTaskExists(this.getParent(a));)a=this.getTask(this.getParent(a)),b++;return b},gantt.sort=function(a,b,c,d){var e=!d;this.isTaskExists(c)||(c=this.config.root_id),a||(a="order");var f="string"==typeof a?function(b,c){if(b[a]==c[a])return 0;var d=b[a]>c[a];return d?1:-1}:a;if(b){var g=f;f=function(a,b){return g(b,a)}}var h=this.getChildren(c);if(h){for(var i=[],j=h.length-1;j>=0;j--)i[j]=this._pull[h[j]];i.sort(f);for(var j=0;j<i.length;j++)h[j]=i[j].id,this.sort(a,b,h[j],!0)}e&&this.render()},gantt.getNext=function(a){for(var b=0;b<this._order.length-1;b++)if(this._order[b]==a)return this._order[b+1];return null},gantt.getPrev=function(a){for(var b=1;b<this._order.length;b++)if(this._order[b]==a)return this._order[b-1];return null},gantt._get_parent_id=function(a){var b=this.config.root_id;return a&&(b=a.parent),b},gantt.getParent=function(a){var b=null;return a.id?b=a:this.isTaskExists(a)&&(b=gantt.getTask(a)),this._get_parent_id(b)},gantt.setParent=function(a,b){a.parent=b},gantt.getSiblings=function(a){if(!this.isTaskExists(a))return[];var b=this.getParent(a);return this.getChildren(b)},gantt.getNextSibling=function(a){for(var b=this.getSiblings(a),c=0,d=b.length;d>c;c++)if(b[c]==a)return b[c+1]||null;return null},gantt.getPrevSibling=function(a){for(var b=this.getSiblings(a),c=0,d=b.length;d>c;c++)if(b[c]==a)return b[c-1]||null;return null},gantt._dp_init=function(a){a.setTransactionMode("POST",!0),a.serverProcessor+=(-1!=a.serverProcessor.indexOf("?")?"&":"?")+"editing=true",a._serverProcessor=a.serverProcessor,a.styles={updated:"gantt_updated",inserted:"gantt_inserted",deleted:"gantt_deleted",invalid:"gantt_invalid",error:"gantt_error",clear:""},a._methods=["_row_style","setCellTextStyle","_change_id","_delete_task"],a.setGanttMode=function(b){var c=a.modes||{};a._ganttMode&&(c[a._ganttMode]={_in_progress:a._in_progress,_invalid:a._invalid,updatedRows:a.updatedRows});var d=c[b];d||(d=c[b]={_in_progress:{},_invalid:{},updatedRows:[]}),a._in_progress=d._in_progress,a._invalid=d._invalid,a.updatedRows=d.updatedRows,a.modes=c,a._ganttMode=b},this._sendTaskOrder=function(b,c){c.$drop_target&&(a.setGanttMode("tasks"),this.getTask(b).target=c.$drop_target,a.setUpdated(b,!0,"order"),delete this.getTask(b).$drop_target)},this.attachEvent("onAfterTaskAdd",function(b){a.setGanttMode("tasks"),a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterTaskUpdate",function(b,c){a.setGanttMode("tasks"),a.setUpdated(b,!0),gantt._sendTaskOrder(b,c)}),this.attachEvent("onAfterTaskDelete",function(b){a.setGanttMode("tasks"),a.setUpdated(b,!0,"deleted"),"off"==a.updateMode||a._tSend||a.sendAllData()}),this.attachEvent("onAfterLinkUpdate",function(b){a.setGanttMode("links"),a.setUpdated(b,!0)}),this.attachEvent("onAfterLinkAdd",function(b){a.setGanttMode("links"),a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterLinkDelete",function(b){a.setGanttMode("links"),a.setUpdated(b,!0,"deleted")}),this.attachEvent("onRowDragEnd",function(a){gantt._sendTaskOrder(a,gantt.getTask(a))}),a.attachEvent("onBeforeDataSending",function(){var a=this._serverProcessor;if("REST"==this._tMode){var b=this._ganttMode.substr(0,this._ganttMode.length-1);a=a.substring(0,a.indexOf("?")>-1?a.indexOf("?"):a.length),this.serverProcessor=a+("/"==a.slice(-1)?"":"/")+b}else this.serverProcessor=a+window.dhtmlx.url(a)+"gantt_mode="+this._ganttMode;return!0}),this._init_dp_live_update_hooks(a);var b=a.afterUpdate;a.afterUpdate=function(){var c;c=3==arguments.length?arguments[1]:arguments[4];var d=a._ganttMode,e=c.filePath;d="REST"!=this._tMode?-1!=e.indexOf("gantt_mode=links")?"links":"tasks":e.indexOf("/link")>e.indexOf("/task")?"links":"tasks",a.setGanttMode(d);var f=b.apply(a,arguments);return a.setGanttMode(d),f},a._getRowData=dhtmlx.bind(function(b){var c;c="tasks"==a._ganttMode?this.isTaskExists(b)?this.getTask(b):{id:b}:this.isLinkExists(b)?this.getLink(b):{id:b},c=dhtmlx.copy(c);var d={};for(var e in c)if("$"!=e.substr(0,1)){var f=c[e];d[e]=f instanceof Date?this.templates.xml_format(f):null===f?"":f}return c.$no_start&&(c.start_date="",c.duration=""),c.$no_end&&(c.end_date="",c.duration=""),d[a.action_param]=this.getUserData(b,a.action_param),d},this),this._change_id=dhtmlx.bind(function(b,c){"tasks"!=a._ganttMode?this.changeLinkId(b,c):this.changeTaskId(b,c)},this),this._row_style=function(b,c){if("tasks"==a._ganttMode&&gantt.isTaskExists(b)){var d=gantt.getTask(b);d.$dataprocessor_class=c,gantt.refreshTask(b)}},this._delete_task=function(){},this._dp=a,gantt._patch_dhx4_ajax()},gantt._patch_dhx4_ajax=function(){var a=parseInt((dhx4.version||"").split(".").join(""),10);413>=a&&(window.dhx4.ajax._call=function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==d&&(h.onreadystatechange=function(){if(4==h.readyState||1==i&&3==h.readyState){if((200!=h.status||""==h.responseText)&&!dhx4.callEvent("onAjaxError",[h]))return;window.setTimeout(function(){"function"==typeof e&&e.apply(window,[{xmlDoc:h,filePath:b}]),null!=f&&("undefined"!=typeof f.postData?dhx4.ajax.postLong(f.url,f.postData,e):dhx4.ajax.getLong(f.url,e)),e=null,h=null},1)}}),"GET"==a&&1!=this.cache&&(b+=(b.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),h.open(a,b,d),g)for(var j in g)h.setRequestHeader(j,g[j]);else"POST"==a.toUpperCase()||"PUT"==a||"DELETE"==a?h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==a&&(c=null);return h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c),d?void 0:{xmlDoc:h,filePath:b}}),gantt._patch_dhx4_ajax=function(){}},gantt.getUserData=function(a,b){return this.userdata||(this.userdata={}),this.userdata[a]&&this.userdata[a][b]?this.userdata[a][b]:""},gantt.setUserData=function(a,b,c){this.userdata||(this.userdata={}),this.userdata[a]||(this.userdata[a]={}),this.userdata[a][b]=c},gantt._init_link=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a},gantt._sync_links=function(){for(var a in this._pull)this._pull[a].$source=[],this._pull[a].$target=[];for(var a in this._lpull){var b=this._lpull[a];this._pull[b.source]&&this._pull[b.source].$source.push(a),this._pull[b.target]&&this._pull[b.target].$target.push(a)}},gantt.getLink=function(a){return dhtmlx.assert(this._lpull[a],"Link doesn't exist"),this._lpull[a]},gantt.getLinks=function(){var a=[];for(var b in gantt._lpull)a.push(gantt._lpull[b]);return a},gantt.isLinkExists=function(a){return dhtmlx.defined(this._lpull[a])},gantt.addLink=function(a){return a=this._init_link(a),this.callEvent("onBeforeLinkAdd",[a.id,a])===!1?!1:(this._lpull[a.id]=a,this._sync_links(),this._render_link(a.id),this.callEvent("onAfterLinkAdd",[a.id,a]),a.id)},gantt.updateLink=function(a,b){return dhtmlx.defined(b)||(b=this.getLink(a)),this.callEvent("onBeforeLinkUpdate",[a,b])===!1?!1:(this._lpull[a]=b,this._sync_links(),this._render_link(a),this.callEvent("onAfterLinkUpdate",[a,b]),!0)},gantt.deleteLink=function(a){return this._deleteLink(a)},gantt._deleteLink=function(a,b){var c=this.getLink(a);return b||this.callEvent("onBeforeLinkDelete",[a,c])!==!1?(delete this._lpull[a],this._sync_links(),this.refreshLink(a),b||this.callEvent("onAfterLinkDelete",[a,c]),!0):!1},gantt.changeLinkId=function(a,b){this._lpull[b]=this._lpull[a],this._lpull[b].id=b,delete this._lpull[a],this._sync_links(),this.callEvent("onLinkIdChange",[a,b])},gantt.getChildren=function(a){return dhtmlx.defined(this._branches[a])?this._branches[a]:[]},gantt.hasChild=function(a){return dhtmlx.defined(this._branches[a])&&this._branches[a].length},gantt.refreshData=function(){this._render_data()},gantt._configure=function(a,b,c){for(var d in b)("undefined"==typeof a[d]||c)&&(a[d]=b[d])},gantt._init_skin=function(){gantt._get_skin(!1),gantt._init_skin=function(){}},gantt._get_skin=function(a){if(!gantt.skin||a)for(var b=document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c].href.match("dhtmlxgantt_([a-z]+).css");if(d){gantt.skin=d[1];break}}gantt.skin||(gantt.skin="terrace");var e=gantt.skins[gantt.skin];this._configure(gantt.config,e.config,a);var f=gantt.getGridColumns();f[1]&&"undefined"==typeof f[1].width&&(f[1].width=e._second_column_width),f[2]&&"undefined"==typeof f[2].width&&(f[2].width=e._third_column_width),e._lightbox_template&&(gantt._lightbox_template=e._lightbox_template),gantt.resetLightbox()},gantt.resetSkin=function(){this.skin="",this._get_skin(!0)},gantt.skins={},gantt._lightbox_methods={},gantt._lightbox_template="<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>",gantt.showLightbox=function(a){if(a&&!gantt._is_readonly(this.getTask(a))&&this.callEvent("onBeforeLightbox",[a])){var b=this.getTask(a),c=this.getLightbox(this._get_safe_type(b.type));this._center_lightbox(c),this.showCover(),this._fill_lightbox(a,c),this.callEvent("onLightbox",[a])}},gantt._get_timepicker_step=function(){if(this.config.round_dnd_dates){var a=gantt._tasks,b=this._get_line(a.unit)*a.step/60;return(b>=1440||!this._is_chart_visible())&&(b=this.config.time_step),b}return this.config.time_step},gantt.getLabel=function(a,b){for(var c=this._get_typed_lightbox_config(),d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""},gantt.updateCollection=function(a,b){b=b.slice(0);var c=gantt.serverList(a);return c?(c.splice(0,c.length),c.push.apply(c,b||[]),void gantt.resetLightbox()):!1},gantt.getLightboxType=function(){return this._get_safe_type(this._lightbox_type)},gantt.getLightbox=function(a){if(void 0===a&&(a=this.getLightboxType()),!this._lightbox||this.getLightboxType()!=this._get_safe_type(a)){this._lightbox_type=this._get_safe_type(a);var b=document.createElement("DIV");b.className="gantt_cal_light";var c=this._is_lightbox_timepicker();(gantt.config.wide_form||c)&&(b.className+=" gantt_cal_light_wide"),c&&(gantt.config.wide_form=!0,b.className+=" gantt_cal_light_full"),b.style.visibility="hidden";for(var d=this._lightbox_template,e=this.config.buttons_left,f=0;f<e.length;f++){var g=this.config._migrate_buttons[e[f]]?this.config._migrate_buttons[e[f]]:e[f];
d+="<div class='gantt_btn_set gantt_left_btn_set "+g+"_set'><div dhx_button='1' class='"+g+"'></div><div>"+this.locale.labels[g]+"</div></div>"}e=this.config.buttons_right;for(var f=0;f<e.length;f++){var g=this.config._migrate_buttons[e[f]]?this.config._migrate_buttons[e[f]]:e[f];d+="<div class='gantt_btn_set gantt_right_btn_set "+g+"_set' style='float:right;'><div dhx_button='1' class='"+g+"'></div><div>"+this.locale.labels[g]+"</div></div>"}d+="</div>",b.innerHTML=d,gantt.config.drag_lightbox&&(b.firstChild.onmousedown=gantt._ready_to_dnd,b.firstChild.onselectstart=function(){return!1},b.firstChild.style.cursor="pointer",gantt._init_dnd_events()),document.body.insertBefore(b,document.body.firstChild),this._lightbox=b;var h=this._get_typed_lightbox_config(a);d=this._render_sections(h);for(var i=b.getElementsByTagName("div"),f=0;f<i.length;f++){var j=i[f];if("gantt_cal_larea"==j.className){j.innerHTML=d;break}}this.resizeLightbox(),this._init_lightbox_events(this),b.style.display="none",b.style.visibility="visible"}return this._lightbox},gantt._render_sections=function(a){for(var b="",c=0;c<a.length;c++){var d=this.form_blocks[a[c].type];if(d){a[c].id="area_"+dhtmlx.uid();var e=a[c].hidden?" style='display:none'":"",f="";a[c].button&&(f="<div class='gantt_custom_button' index='"+c+"'><div class='gantt_custom_button_"+a[c].button+"'></div><div>"+this.locale.labels["button_"+a[c].button]+"</div></div>"),this.config.wide_form&&(b+="<div class='gantt_wrap_section' "+e+">"),b+="<div id='"+a[c].id+"' class='gantt_cal_lsection'>"+f+this.locale.labels["section_"+a[c].name]+"</div>"+d.render.call(this,a[c]),b+="</div>"}}return b},gantt.resizeLightbox=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px",b.style.height=b.scrollHeight+"px",a.style.height=b.scrollHeight+this.config.lightbox_additional_height+"px",b.style.height=b.scrollHeight+"px"}},gantt._center_lightbox=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px",a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+(document.body.offsetWidth-a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}},gantt.showCover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="gantt_cal_cover";var a=void 0!==document.height?document.height:document.body.offsetHeight,b=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(a,b)+"px",document.body.appendChild(this._cover)}},gantt._init_lightbox_events=function(){gantt.lightbox_events={},gantt.lightbox_events.gantt_save_btn=function(){gantt._save_lightbox()},gantt.lightbox_events.gantt_delete_btn=function(){gantt.callEvent("onLightboxDelete",[gantt._lightbox_id])&&(gantt.isTaskExists(gantt._lightbox_id)?gantt.$click.buttons["delete"](gantt._lightbox_id):gantt.hideLightbox())},gantt.lightbox_events.gantt_cancel_btn=function(){gantt._cancel_lightbox()},gantt.lightbox_events["default"]=function(a,b){if(b.getAttribute("dhx_button"))gantt.callEvent("onLightboxButton",[b.className,b,a]);else{var c,d,e,f=gantt._getClassName(b);-1!=f.indexOf("gantt_custom_button")&&(-1!=f.indexOf("gantt_custom_button_")?(c=b.parentNode.getAttribute("index"),e=b.parentNode.parentNode):(c=b.getAttribute("index"),e=b.parentNode,b=b.firstChild));var g=gantt._get_typed_lightbox_config();c&&(d=gantt.form_blocks[g[c].type],d.button_click(c,b,e,e.nextSibling))}},dhtmlxEvent(gantt.getLightbox(),"click",function(a){a=a||window.event;var b=a.target?a.target:a.srcElement,c=gantt._getClassName(b);if(c||(b=b.previousSibling,c=gantt._getClassName(b)),b&&c&&0===c.indexOf("gantt_btn_set")&&(b=b.firstChild,c=gantt._getClassName(b)),b&&c){var d=dhtmlx.defined(gantt.lightbox_events[b.className])?gantt.lightbox_events[b.className]:gantt.lightbox_events["default"];return d(a,b)}return!1}),gantt.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case gantt.keys.edit_save:if((a||event).shiftKey)return;gantt._save_lightbox();break;case gantt.keys.edit_cancel:gantt._cancel_lightbox()}}},gantt._cancel_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxCancel",[this._lightbox_id,a.$new]),gantt.isTaskExists(a.id)&&a.$new&&this._deleteTask(a.id,!0),this.refreshData(),this.hideLightbox()},gantt._save_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxSave",[this._lightbox_id,a,!!a.$new])&&(a.$new?(delete a.$new,this.addTask(a)):this.isTaskExists(a.id)&&(dhtmlx.mixin(this.getTask(a.id),a,!0),this.updateTask(a.id)),this.refreshData(),this.hideLightbox())},gantt._resolve_default_mapping=function(a){var b=a.map_to,c={time:!0,time_optional:!0,duration:!0,duration_optional:!0};return c[a.type]&&("auto"==a.map_to?b={start_date:"start_date",end_date:"end_date",duration:"duration"}:"string"==typeof a.map_to&&(b={start_date:a.map_to})),b},gantt.getLightboxValues=function(){var a={};gantt.isTaskExists(this._lightbox_id)&&(a=dhtmlx.mixin({},this.getTask(this._lightbox_id)));for(var b=this._get_typed_lightbox_config(),c=0;c<b.length;c++){var d=document.getElementById(b[c].id);d=d?d.nextSibling:d;var e=this.form_blocks[b[c].type];if(e){var f=e.get_value.call(this,d,a,b[c]),g=gantt._resolve_default_mapping(b[c]);if("string"==typeof g&&"auto"!=g)a[g]=f;else if("object"==typeof g)for(var h in g)g[h]&&(a[g[h]]=f[h])}}return a},gantt.hideLightbox=function(){var a=this.getLightbox();a&&(a.style.display="none"),this._lightbox_id=null,this.hideCover(),this.callEvent("onAfterLightbox",[])},gantt.hideCover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},gantt.resetLightbox=function(){gantt._lightbox&&!gantt._custom_lightbox&&gantt._lightbox.parentNode.removeChild(gantt._lightbox),gantt._lightbox=null},gantt._set_lightbox_values=function(a,b){var c=a,d=b.getElementsByTagName("span");gantt.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=gantt.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.task_time(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.task_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var e=this._get_typed_lightbox_config(this.getLightboxType()),f=0;f<e.length;f++){var g=e[f];if(this.form_blocks[g.type]){var h=document.getElementById(g.id).nextSibling,i=this.form_blocks[g.type],j=gantt._resolve_default_mapping(e[f]),k=dhtmlx.defined(c[j])?c[j]:g.default_value;i.set_value.call(gantt,h,k,c,g),g.focus&&i.focus.call(gantt,h)}}a.id&&(gantt._lightbox_id=a.id)},gantt._fill_lightbox=function(a,b){var c=this.getTask(a);this._set_lightbox_values(c,b)},gantt.getLightboxSection=function(a){var b=this._get_typed_lightbox_config(),c=0;for(c;c<b.length&&b[c].name!=a;c++);var d=b[c];if(!d)return null;this._lightbox||this.getLightbox();var e=document.getElementById(d.id),f=e.nextSibling,g={section:d,header:e,node:f,getValue:function(a){return gantt.form_blocks[d.type].get_value.call(gantt,f,a||{},d)},setValue:function(a,b){return gantt.form_blocks[d.type].set_value.call(gantt,f,a,b||{},d)}},h=this._lightbox_methods["get_"+d.type+"_control"];return h?h(g):g},gantt._lightbox_methods.get_template_control=function(a){return a.control=a.node,a},gantt._lightbox_methods.get_select_control=function(a){return a.control=a.node.getElementsByTagName("select")[0],a},gantt._lightbox_methods.get_textarea_control=function(a){return a.control=a.node.getElementsByTagName("textarea")[0],a},gantt._lightbox_methods.get_time_control=function(a){return a.control=a.node.getElementsByTagName("select"),a},gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd),dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd),gantt._init_dnd_events=function(){}},gantt._move_while_dnd=function(a){if(gantt._dnd_start_lb){document.gantt_unselectable||(document.body.className+=" gantt_unselectable",document.gantt_unselectable=!0);var b=gantt.getLightbox(),c=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=gantt._lb_start[1]+c[1]-gantt._dnd_start_lb[1]+"px",b.style.left=gantt._lb_start[0]+c[0]-gantt._dnd_start_lb[0]+"px"}},gantt._ready_to_dnd=function(a){var b=gantt.getLightbox();gantt._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)],gantt._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]},gantt._finish_dnd=function(){gantt._lb_start&&(gantt._lb_start=gantt._dnd_start_lb=!1,document.body.className=document.body.className.replace(" gantt_unselectable",""),document.gantt_unselectable=!1)},gantt._focus=function(a,b){if(a&&a.focus)if(gantt.config.touch);else try{b&&a.select&&a.select(),a.focus()}catch(c){}},gantt.form_blocks={getTimePicker:function(a,b){var c=a.time_format;if(!c){var c=["%d","%m","%Y"];gantt._get_line(gantt._tasks.unit)<gantt._get_line("day")&&c.push("%H:%i")}a._time_format_order={size:0};var d=this.config,e=this.date.date_part(new Date(gantt._min_date.valueOf())),f=1440,g=0;gantt.config.limit_time_select&&(f=60*d.last_hour+1,g=60*d.first_hour,e.setHours(d.first_hour));for(var h="",i=0;i<c.length;i++){var j=c[i];i>0&&(h+=" ");var k="";switch(j){case"%Y":a._time_format_order[2]=i,a._time_format_order.size++;var l,m,n,o;a.year_range&&(isNaN(a.year_range)?a.year_range.push&&(n=a.year_range[0],o=a.year_range[1]):l=a.year_range),l=l||10,m=m||Math.floor(l/2),n=n||e.getFullYear()-m,o=o||n+l;for(var p=n;o>p;p++)k+="<option value='"+p+"'>"+p+"</option>";break;case"%m":a._time_format_order[1]=i,a._time_format_order.size++;for(var p=0;12>p;p++)k+="<option value='"+p+"'>"+this.locale.date.month_full[p]+"</option>";break;case"%d":a._time_format_order[0]=i,a._time_format_order.size++;for(var p=1;32>p;p++)k+="<option value='"+p+"'>"+p+"</option>";break;case"%H:%i":a._time_format_order[3]=i,a._time_format_order.size++;var p=g,q=e.getDate();for(a._time_values=[];f>p;){var r=this.templates.time_picker(e);k+="<option value='"+p+"'>"+r+"</option>",a._time_values.push(p),e.setTime(e.valueOf()+60*this._get_timepicker_step()*1e3);var s=e.getDate()!=q?1:0;p=24*s*60+60*e.getHours()+e.getMinutes()}}if(k){var t=a.readonly?"disabled='disabled'":"",u=b?" style='display:none'":"";h+="<select "+t+u+">"+k+"</select>"}}return h},_fill_lightbox_select:function(a,b,c,d){if(a[b+d[0]].value=c.getDate(),a[b+d[1]].value=c.getMonth(),a[b+d[2]].value=c.getFullYear(),dhtmlx.defined(d[3])){var e=60*c.getHours()+c.getMinutes();e=Math.round(e/gantt._get_timepicker_step())*gantt._get_timepicker_step();var f=a[b+d[3]];f.value=e,f.setAttribute("data-value",e)}},template:{render:function(a){var b=(a.height||"30")+"px";return"<div class='gantt_cal_ltext gantt_cal_template' style='height:"+b+";'></div>"},set_value:function(a,b){a.innerHTML=b||""},get_value:function(a){return a.innerHTML||""},focus:function(){}},textarea:{render:function(a){var b=(a.height||"130")+"px";return"<div class='gantt_cal_ltext' style='height:"+b+";'><textarea></textarea></div>"},set_value:function(a,b){a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},select:{render:function(a){for(var b=(a.height||"23")+"px",c="<div class='gantt_cal_ltext' style='height:"+b+";'><select style='width:100%;'>",d=0;d<a.options.length;d++)c+="<option value='"+a.options[d].key+"'>"+a.options[d].label+"</option>";return c+="</select></div>"},set_value:function(a,b,c,d){var e=a.firstChild;!e._dhx_onchange&&d.onchange&&(e.onchange=d.onchange,e._dhx_onchange=!0),"undefined"==typeof b&&(b=(e.options[0]||{}).value),e.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},time:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a),c=["<div style='height:"+(a.height||30)+"px;padding-top:0px;font-size:inherit;text-align:center;' class='gantt_section_time'>"];return c.push(b),a.single_date?(b=this.form_blocks.getTimePicker.call(this,a,!0),c.push("<span></span>")):c.push("<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"),c.push(b),c.push("</div>"),c.join("")},set_value:function(a,b,c,d){{var e=d,f=a.getElementsByTagName("select"),g=d._time_format_order;d._time_format_size}if(e.auto_end_date)for(var h=function(){k=new Date(f[g[2]].value,f[g[1]].value,f[g[0]].value,0,0),l=gantt.calculateEndDate(k,1),this.form_blocks._fill_lightbox_select(f,g.size,l,g,e)},i=0;4>i;i++)f[i].onchange=h;var j=gantt._resolve_default_mapping(d);"string"==typeof j&&(j={start_date:j});var k=c[j.start_date]||new Date,l=c[j.end_date]||gantt.calculateEndDate(k,1);this.form_blocks._fill_lightbox_select(f,0,k,g,e),this.form_blocks._fill_lightbox_select(f,g.size,l,g,e)},get_value:function(a,b,c){var d=a.getElementsByTagName("select"),e=c._time_format_order,f=0,g=0;if(dhtmlx.defined(e[3])){var h=parseInt(d[e[3]].value,10);f=Math.floor(h/60),g=h%60}var i=new Date(d[e[2]].value,d[e[1]].value,d[e[0]].value,f,g);if(f=g=0,dhtmlx.defined(e[3])){var h=parseInt(d[e.size+e[3]].value,10);f=Math.floor(h/60),g=h%60}var j=new Date(d[e[2]+e.size].value,d[e[1]+e.size].value,d[e[0]+e.size].value,f,g);i>=j&&(j=gantt.date.add(i,gantt._get_timepicker_step(),"minute"));var k=gantt._resolve_default_mapping(c),l={start_date:new Date(i),end_date:new Date(j)};return"string"==typeof k?l.start_date:l},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},duration:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a);b="<div class='gantt_time_selects'>"+b+"</div>";var c=this.locale.labels[this.config.duration_unit+"s"],d=a.single_date?' style="display:none"':"",e=a.readonly?" disabled='disabled'":"",f="<div class='gantt_duration' "+d+"><input type='button' class='gantt_duration_dec' value='-'"+e+"><input type='text' value='5' class='gantt_duration_value'"+e+"><input type='button' class='gantt_duration_inc' value='+'"+e+"> "+c+" <span></span></div>",g="<div style='height:"+(a.height||30)+"px;padding-top:0px;font-size:inherit;' class='gantt_section_time'>"+b+" "+f+"</div>";return g},set_value:function(a,b,c,d){function e(){var b=gantt.form_blocks.duration._get_start_date.call(gantt,a,d),c=gantt.form_blocks.duration._get_duration.call(gantt,a,d),e=gantt.calculateEndDate(b,c);l.innerHTML=gantt.templates.task_date(e)}function f(a){var b=j.value;b=parseInt(b,10),window.isNaN(b)&&(b=0),b+=a,1>b&&(b=1),j.value=b,e()}var g=d,h=a.getElementsByTagName("select"),i=a.getElementsByTagName("input"),j=i[1],k=[i[0],i[2]],l=a.getElementsByTagName("span")[0],m=d._time_format_order;k[0].onclick=dhtmlx.bind(function(){f(-1*this.config.duration_step)},this),k[1].onclick=dhtmlx.bind(function(){f(1*this.config.duration_step)},this),h[0].onchange=e,h[1].onchange=e,h[2].onchange=e,h[3]&&(h[3].onchange=e),j.onkeydown=dhtmlx.bind(function(a){a=a||window.event;var b=a.charCode||a.keyCode||a.which;return 40==b?(f(-1*this.config.duration_step),!1):38==b?(f(1*this.config.duration_step),!1):void window.setTimeout(function(){e()},1)},this),j.onchange=dhtmlx.bind(function(){e()},this);var n=gantt._resolve_default_mapping(d);"string"==typeof n&&(n={start_date:n});var o=c[n.start_date]||new Date,p=c[n.end_date]||gantt.calculateEndDate(o,1),q=Math.round(c[n.duration])||gantt.calculateDuration(o,p);gantt.form_blocks._fill_lightbox_select(h,0,o,m,g),j.value=q,e()},_get_start_date:function(a,b){var c=a.getElementsByTagName("select"),d=b._time_format_order,e=0,f=0;if(dhtmlx.defined(d[3])){var g=c[d[3]],h=parseInt(g.value,10);isNaN(h)&&g.hasAttribute("data-value")&&(h=parseInt(g.getAttribute("data-value"),10)),e=Math.floor(h/60),f=h%60}return new Date(c[d[2]].value,c[d[1]].value,c[d[0]].value,e,f)},_get_duration:function(a){var b=a.getElementsByTagName("input")[1];return b=parseInt(b.value,10),(!b||window.isNaN(b))&&(b=1),0>b&&(b*=-1),b},get_value:function(a,b,c){var d=gantt.form_blocks.duration._get_start_date(a,c),e=gantt.form_blocks.duration._get_duration(a,c),f=gantt.calculateEndDate(d,e),g=gantt._resolve_default_mapping(c),h={start_date:new Date(d),end_date:new Date(f),duration:e};return"string"==typeof g?h.start_date:h},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},parent:{_filter:function(a,b,c){var d=b.filter||function(){return!0};a=a.slice(0);for(var e=0;e<a.length;e++){var f=a[e];(f.id==c||gantt.isChildOf(f.id,c)||d(f.id,f)===!1)&&(a.splice(e,1),e--)}return a},_display:function(a,b){var c=[],d=[];b&&(c=gantt.getTaskByTime(),a.allow_root&&c.unshift({id:gantt.config.root_id,text:a.root_label||""}),c=this._filter(c,a,b),a.sort&&c.sort(a.sort));for(var e=a.template||gantt.templates.task_text,f=0;f<c.length;f++){var g=e.apply(gantt,[c[f].start_date,c[f].end_date,c[f]]);void 0===g&&(g=""),d.push({key:c[f].id,label:g})}return a.options=d,a.map_to=a.map_to||"parent",gantt.form_blocks.select.render.apply(this,arguments)},render:function(a){return gantt.form_blocks.parent._display(a,!1)},set_value:function(a,b,c,d){var e=document.createElement("div");e.innerHTML=gantt.form_blocks.parent._display(d,c.id);var f=e.removeChild(e.firstChild);return a.onselect=null,a.parentNode.replaceChild(f,a),gantt.form_blocks.select.set_value.apply(gantt,[f,b,c,d])},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(gantt,arguments)}}},gantt._is_lightbox_timepicker=function(){for(var a=this._get_typed_lightbox_config(),b=0;b<a.length;b++)if("time"==a[b].name&&"time"==a[b].type)return!0;return!1},gantt._dhtmlx_confirm=function(a,b,c,d){if(!a)return c();var e={text:a};b&&(e.title=b),d&&(e.ok=d),c&&(e.callback=function(a){a&&c()}),dhtmlx.confirm(e)},gantt._get_typed_lightbox_config=function(a){void 0===a&&(a=this.getLightboxType());var b=this._get_type_name(a);return gantt.config.lightbox[b+"_sections"]?gantt.config.lightbox[b+"_sections"]:gantt.config.lightbox.sections},gantt._silent_redraw_lightbox=function(a){var b=this.getLightboxType();if(this.getState().lightbox){var c=this.getState().lightbox,d=this.getLightboxValues(),e=dhtmlx.copy(this.getTask(c));this.resetLightbox();var f=dhtmlx.mixin(e,d,!0),g=this.getLightbox(a?a:void 0);this._center_lightbox(this.getLightbox()),this._set_lightbox_values(f,g)}else this.resetLightbox(),this.getLightbox(a?a:void 0);this.callEvent("onLightboxChange",[b,this.getLightboxType()])},gantt._extend_to_optional=function(a){var b=a,c={render:b.render,focus:b.focus,set_value:function(a,d,e,f){var g=gantt._resolve_default_mapping(f);if(!e[g.start_date]||"start_date"==g.start_date&&this._isAllowedUnscheduledTask(e)){c.disable(a,f);var h={};for(var i in g)h[g[i]]=e[i];return b.set_value.call(gantt,a,d,h,f)}return c.enable(a,f),b.set_value.call(gantt,a,d,e,f)},get_value:function(a,c,d){return d.disabled?{start_date:null}:b.get_value.call(gantt,a,c,d)},update_block:function(a,b){if(gantt.callEvent("onSectionToggle",[gantt._lightbox_id,b]),a.style.display=b.disabled?"none":"block",b.button){var c=a.previousSibling.firstChild.firstChild,d=gantt.locale.labels,e=b.disabled?d[b.name+"_enable_button"]:d[b.name+"_disable_button"];c.nextSibling.innerHTML=e}gantt.resizeLightbox()},disable:function(a,b){b.disabled=!0,c.update_block(a,b)},enable:function(a,b){b.disabled=!1,c.update_block(a,b)},button_click:function(a,b,d,e){if(gantt.callEvent("onSectionButton",[gantt._lightbox_id,d])!==!1){var f=gantt._get_typed_lightbox_config()[a];f.disabled?c.enable(e,f):c.disable(e,f)}}};return c},gantt.form_blocks.duration_optional=gantt._extend_to_optional(gantt.form_blocks.duration),gantt.form_blocks.time_optional=gantt._extend_to_optional(gantt.form_blocks.time),gantt._init_dp_live_update_hooks=function(a){a.attachEvent("insertCallback",gantt._insert_callback),a.attachEvent("updateCallback",gantt._update_callback),a.attachEvent("deleteCallback",gantt._delete_callback)},gantt._update_callback=function(a,b){var c=a.data||gantt.xml._xmlNodeToJSON(a.firstChild);if(gantt.isTaskExists(b)){var d=gantt.getTask(b);for(var e in c){var f=c[e];switch(e){case"id":continue;case"start_date":case"end_date":f=gantt.templates.xml_date(f);break;case"duration":d.end_date=gantt.calculateEndDate(d.start_date,f)}d[e]=f}gantt.updateTask(b),gantt.refreshData()}},gantt._insert_callback=function(a,b,c,d){var e=a.data||gantt.xml._xmlNodeToJSON(a.firstChild),f={add:gantt.addTask,isExist:gantt.isTaskExists};"links"==d&&(f.add=gantt.addLink,f.isExist=gantt.isLinkExists),f.isExist.call(gantt,b)||(e.id=b,f.add.call(gantt,e))},gantt._delete_callback=function(a,b,c,d){var e={"delete":gantt.deleteTask,isExist:gantt.isTaskExists};"links"==d&&(e["delete"]=gantt.deleteLink,e.isExist=gantt.isLinkExists),e.isExist.call(gantt,b)&&e["delete"].call(gantt,b)},gantt._get_safe_type=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return a;return gantt.config.types.task},gantt.form_blocks.typeselect={render:function(a){var b=gantt.config.types,c=gantt.locale.labels,d=[],e=a.filter||function(){return!0};for(var f in b)!e(f,b[f])==!1&&d.push({key:b[f],label:c["type_"+f]});a.options=d;var g=a.onchange;return a.onchange=function(){gantt.getState().lightbox;gantt.changeLightboxType(this.value),"function"==typeof g&&g.apply(this,arguments)},gantt.form_blocks.select.render.apply(gantt,arguments)},set_value:function(){return gantt.form_blocks.select.set_value.apply(gantt,arguments)},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(this,arguments)}},function(){function a(){return gantt._cached_functions.update_if_changed(gantt),gantt._cached_functions.active||gantt._cached_functions.activate(),!0}gantt._cached_functions={cache:{},mode:!1,critical_path_mode:!1,wrap_methods:function(a,b){if(b._prefetch_originals)for(var c in b._prefetch_originals)b[c]=b._prefetch_originals[c];b._prefetch_originals={};for(var c=0;c<a.length;c++)this.prefetch(a[c],b)},prefetch:function(a,b){var c=b[a];if(c){var d=this;b._prefetch_originals[a]=c,b[a]=function(){if(d.active){var b=d.get_arguments_hash(Array.prototype.slice.call(arguments));d.cache[a]||(d.cache[a]={});var e=d.cache[a];if(d.has_cached_value(e,b))return d.get_cached_value(e,b);var f=c.apply(this,arguments);return d.cache_value(e,b,f),f}return c.apply(this,arguments)}}return c},cache_value:function(a,b,c){this.is_date(c)&&(c=new Date(c)),a[b]=c},has_cached_value:function(a,b){return a.hasOwnProperty(b)},get_cached_value:function(a,b){var c=a[b];return this.is_date(c)&&(c=new Date(c)),c},is_date:function(a){return a&&a.getUTCDate},get_arguments_hash:function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.stringify_argument(a[c]));return"("+b.join(";")+")"},stringify_argument:function(a){var b="";return b=a.id?a.id:this.is_date(a)?a.valueOf():a,b+""},activate:function(){this.clear(),this.active=!0},deactivate:function(){this.clear(),this.active=!1},clear:function(){this.cache={}},setup:function(a){var b=[],c=["isCriticalTask","isCriticalLink","_isProjectEnd","_getProjectEnd"];"auto"==this.mode?a.config.highlight_critical_path&&(b=c):this.mode===!0&&(b=c),this.wrap_methods(b,a)},update_if_changed:function(a){var b=this.critical_path_mode!=a.config.highlight_critical_path||this.mode!==a.config.optimize_render;b&&(this.critical_path_mode=a.config.highlight_critical_path,this.mode=a.config.optimize_render,this.setup(a))}},gantt.attachEvent("onBeforeGanttRender",a),gantt.attachEvent("onBeforeDataRender",a),gantt.attachEvent("onBeforeParse",a),gantt.attachEvent("onDataRender",function(){gantt._cached_functions.deactivate()}),gantt.attachEvent("onBeforeGanttReady",function(){return gantt._cached_functions.update_if_changed(gantt),!0})}(),dhtmlx.assert=function(a,b){a||gantt.config.show_errors&&gantt.callEvent("onError",[b])!==!1&&dhtmlx.message({type:"error",text:b,expire:-1})},gantt.init=function(a,b,c){this.callEvent("onBeforeGanttReady",[]),b&&c&&(this.config.start_date=this._min_date=new Date(b),this.config.end_date=this._max_date=new Date(c)),this._init_skin(),this.date.init(),this.config.scroll_size||(this.config.scroll_size=this._detectScrollSize()),dhtmlxEvent(window,"resize",this._on_resize),this.init=function(a){this.$container&&this.$container.parentNode&&(this.$container.parentNode.removeChild(this.$container),this.$container=null),this._reinit(a)},this._reinit(a)},gantt._reinit=function(a){this._init_html_area(a),this._set_sizes(),this._clear_renderers(),this.resetLightbox(),this._update_flags(),this._init_touch_events(),this._init_templates(),this._init_grid(),this._init_tasks(),this._set_scroll_events(),dhtmlxEvent(this.$container,"click",this._on_click),dhtmlxEvent(this.$container,"dblclick",this._on_dblclick),dhtmlxEvent(this.$container,"mousemove",this._on_mousemove),dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu),this.callEvent("onGanttReady",[]),this.render()},gantt._init_html_area=function(a){this._obj="string"==typeof a?document.getElementById(a):a,window.gantt!==gantt&&(this._obj.gantt=gantt),dhtmlx.assert(this._obj,"Invalid html container: "+a);var b="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div>";b+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>",this._obj.innerHTML=b,this.$container=this._obj.firstChild;var c=this.$container.childNodes;this.$grid=c[0],this.$task=c[1],this.$scroll_ver=c[2],this.$scroll_hor=c[3],this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>",this.$grid_scale=this.$grid.childNodes[0],this.$grid_data=this.$grid.childNodes[1],this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>",this.$task_scale=this.$task.childNodes[0],this.$task_data=this.$task.childNodes[1],this.$task_bg=this.$task_data.childNodes[0],this.$task_links=this.$task_data.childNodes[1],this.$task_bars=this.$task_data.childNodes[2]},gantt.$click={buttons:{edit:function(a){gantt.showLightbox(a)},"delete":function(a){var b=gantt.locale.labels.confirm_deleting,c=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(b,c,function(){var b=gantt.getTask(a);b.$new?(gantt._deleteTask(a,!0),gantt.refreshData()):gantt.deleteTask(a),gantt.hideLightbox()})}}},gantt._calculate_content_height=function(){var a=this.config.scale_height,b=this._order.length*this.config.row_height,c=this._scroll_hor?this.config.scroll_size+1:0;return this._is_grid_visible()||this._is_chart_visible()?a+b+2+c:0},gantt._calculate_content_width=function(){{var a=this._get_grid_width(),b=this._tasks?this._tasks.full_width:0;this._scroll_ver?this.config.scroll_size+1:0}return this._is_chart_visible()||(b=0),this._is_grid_visible()||(a=0),a+b+1},gantt._get_resize_options=function(){var a={x:!1,y:!1};return"xy"==this.config.autosize?a.x=a.y=!0:"y"==this.config.autosize||this.config.autosize===!0?a.y=!0:"x"==this.config.autosize&&(a.x=!0),a},gantt._clean_el_size=function(a){return 1*(a||"").toString().replace("px","")||0},gantt._get_box_styles=function(){var a=null;a=window.getComputedStyle?window.getComputedStyle(this._obj,null):{width:this._obj.clientWidth,height:this._obj.clientHeight};var b=["width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],c={boxSizing:"border-box"==a.boxSizing};a.MozBoxSizing&&(c.boxSizing="border-box"==a.MozBoxSizing);for(var d=0;d<b.length;d++)c[b[d]]=a[b[d]]?this._clean_el_size(a[b[d]]):0;var e={horPaddings:c.paddingLeft+c.paddingRight+c.borderLeftWidth+c.borderRightWidth,vertPaddings:c.paddingTop+c.paddingBottom+c.borderTopWidth+c.borderBottomWidth,borderBox:c.boxSizing,innerWidth:c.width,innerHeight:c.height,outerWidth:c.width,outerHeight:c.height};return e.borderBox?(e.innerWidth-=e.horPaddings,e.innerHeight-=e.vertPaddings):(e.outerWidth+=e.horPaddings,e.outerHeight+=e.vertPaddings),e},gantt._do_autosize=function(){var a=this._get_resize_options(),b=this._get_box_styles();if(a.y){var c=this._calculate_content_height();b.borderBox&&(c+=b.vertPaddings),this._obj.style.height=c+"px"}if(a.x){var d=this._calculate_content_width();b.borderBox&&(d+=b.horPaddings),this._obj.style.width=d+"px"}},gantt._set_sizes=function(){this._do_autosize();var a=this._get_box_styles();if(this._y=a.innerHeight,!(this._y<20)){this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";var b=Math.max(this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2,0);this.$grid_data.style.height=this.$task_data.style.height=b+"px";var c=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=c+"px",this.$grid.style.display=0===c?"none":"",a=this._get_box_styles(),this._x=a.innerWidth,this._x<20||(this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px",this.$task.style.width=Math.max(this._x-this._get_grid_width()-2,0)+"px")}},gantt.getScrollState=function(){return this.$task&&this.$task_data?{x:this.$task.scrollLeft,y:this.$task_data.scrollTop}:null},gantt._save_scroll_state=function(a,b){var c={};this._cached_scroll_pos=this._cached_scroll_pos||{},void 0!==a&&(c.x=Math.max(a,0)),void 0!==b&&(c.y=Math.max(b,0)),dhtmlx.mixin(this._cached_scroll_pos,c,!0)},gantt._restore_scroll_state=function(){return this._cached_scroll_pos||null},gantt.scrollTo=function(a,b){1*a==a&&(this.$task.scrollLeft=a,this._save_scroll_state(a,void 0)),1*b==b&&(this.$task_data.scrollTop=b,this.$grid_data.scrollTop=b,this._save_scroll_state(void 0,b));var c=gantt._restore_scroll_state()||{x:0,y:0};this.callEvent("onGanttScroll",[c.x,c.y])},gantt.showDate=function(a){var b=this.posFromDate(a),c=Math.max(b-this.config.task_scroll_offset,0);this.scrollTo(c)},gantt.showTask=function(a){var b=this.getTaskNode(a);if(b){var c=Math.max(b.offsetLeft-this.config.task_scroll_offset,0),d=b.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this.scrollTo(c,d)}},gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes(),gantt._scroll_resize()},gantt.render=function(){if(this._is_render_active()){this.callEvent("onBeforeGanttRender",[]);var a=dhtmlx.copy(this._restore_scroll_state()),b=null;if(a&&(b=gantt.dateFromPos(a.x+this.config.task_scroll_offset)),this._render_grid(),this._render_tasks_scales(),this._scroll_resize(),this._on_resize(),this._render_data(),this.config.preserve_scroll&&a){var c=gantt._restore_scroll_state(),d=gantt.dateFromPos(c.x);(+b!=+d||c.y!=a.y)&&(b&&this.showDate(b),gantt.scrollTo(void 0,a.y))}this.callEvent("onGanttRender",[])}},gantt._set_scroll_events=function(){function a(a){var c=gantt._get_resize_options();gantt._wheel_time=new Date;var d=b?-20*a.deltaX:2*a.wheelDeltaX,e=b?-40*a.deltaY:a.wheelDelta;if(d&&Math.abs(d)>Math.abs(e)){if(c.x)return!0;var f=d/-40,g=gantt.$task.scrollLeft+30*f;gantt.scrollTo(g,null),gantt.$scroll_hor.scrollTop=h}else{if(c.y)return!0;var f=e/-40;"undefined"==typeof e&&(f=a.detail);var h=gantt.$scroll_ver.scrollTop+30*f;if(!gantt.config.prevent_default_scroll&&gantt._cached_scroll_pos&&gantt._cached_scroll_pos.y==h)return!0;gantt.scrollTo(null,h),gantt.$scroll_ver.scrollTop=h}return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(new Date-(gantt._wheel_time||0)<100)return!0;if(!gantt._touch_scroll_active){var a=gantt.$scroll_hor.scrollLeft;gantt.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=a,gantt.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=gantt.$task.scrollLeft,b=gantt.$scroll_hor.scrollLeft;
b!=a&&(gantt.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=gantt.$task_data.scrollTop,b=gantt.$scroll_ver.scrollTop;b!=a&&(gantt.$scroll_ver.scrollTop=a)});var b=_isFF&&!window._KHTMLrv;b?dhtmlxEvent(gantt.$container,"wheel",a):dhtmlxEvent(gantt.$container,"mousewheel",a)},gantt._scroll_resize=function(){if(!(this._x<20||this._y<20)){var a=this._get_grid_width(),b=Math.max(this._x-a,0),c=Math.max(this._y-this.config.scale_height,0),d=this.config.scroll_size+1,e=Math.max(this.$task_data.offsetWidth-d,0),f=this.config.row_height*this._order.length,g=this._get_resize_options(),h=this._scroll_hor=g.x?!1:e>b,i=this._scroll_ver=g.y?!1:f>c,h=h?"block":"none";this.$scroll_hor.style&&this.$scroll_hor.style&&this.$scroll_hor.firstChild&&this.$scroll_ver.firstChild&&(this.$scroll_hor.style.display=h?"block":"none",this.$scroll_hor.style.height=(h?8:0)+"px",this.$scroll_hor.style.width=Math.max(this._x-(i?d:2),0)+"px",this.$scroll_hor.firstChild.style.width=e+a+d+2+"px",this.$scroll_ver.style.display=i?"block":"none",this.$scroll_ver.style.width=(i?8:0)+"px",this.$scroll_ver.style.height=Math.max(this._y-(h?d:0)-this.config.scale_height,0)+"px",this.$scroll_ver.style.top=this.config.scale_height+"px",this.$scroll_ver.firstChild.style.height=this.config.scale_height+f+"px")}},gantt._getClassName=function(a){if(!a)return"";var b=a.className||"";return b.baseVal&&(b=b.baseVal),b.indexOf||(b=""),gantt._trim(b)},gantt.locate=function(a){var b=gantt._get_target_node(a),c=gantt._getClassName(b);if((c||"").indexOf("gantt_task_cell")>=0)return null;for(var d=arguments[1]||this.config.task_attribute;b;){if(b.getAttribute){var e=b.getAttribute(d);if(e)return e}b=b.parentNode}return null},gantt._get_target_node=function(a){var b;return a.tagName?b=a:(a=a||window.event,b=a.target||a.srcElement),b},gantt._trim=function(a){var b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};return b.apply(a)},gantt._locate_css=function(a,b,c){void 0===c&&(c=!0);for(var d=gantt._get_target_node(a),e="";d;){if(e=gantt._getClassName(d)){var f=e.indexOf(b);if(f>=0){if(!c)return d;var g=0===f||!gantt._trim(e.charAt(f-1)),h=f+b.length>=e.length||!gantt._trim(e.charAt(f+b.length));if(g&&h)return d}}d=d.parentNode}return null},gantt._locateHTML=function(a,b){var c=gantt._get_target_node(a);for(b=b||this.config.task_attribute;c;){if(c.getAttribute){var d=c.getAttribute(b);if(d)return c}c=c.parentNode}return null},gantt.getTaskRowNode=function(a){for(var b=this.$grid_data.childNodes,c=this.config.task_attribute,d=0;d<b.length;d++)if(b[d].getAttribute){var e=b[d].getAttribute(c);if(e==a)return b[d]}return null},gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:new Date(this._min_date),max_date:new Date(this._max_date),lightbox:this._lightbox_id,touch_drag:this._touch_drag}},gantt._checkTimeout=function(a,b){if(!b)return!0;var c=1e3/b;return 1>c?!0:a._on_timeout?!1:(setTimeout(function(){delete a._on_timeout},c),a._on_timeout=!0,!0)},gantt.selectTask=function(a){if(!this.config.select_task)return!1;if(a){if(this._selected_task==a)return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[a]))return!1;this.unselectTask(),this._selected_task=a,this.refreshTask(a),this.callEvent("onTaskSelected",[a])}return this._selected_task},gantt.unselectTask=function(a){var a=a||this._selected_task;a&&(this._selected_task=null,this.refreshTask(a),this.callEvent("onTaskUnselected",[a]))},gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null},gantt.changeLightboxType=function(a){return this.getLightboxType()==a?!0:void gantt._silent_redraw_lightbox(a)},gantt._is_render_active=function(){return!this._skip_render},gantt._correct_dst_change=function(a,b,c,d){var e=gantt._get_line(d)*c;if(e>3600&&86400>e){var f=a.getTimezoneOffset()-b;f&&(a=gantt.date.add(a,f,"minute"))}return a},gantt.batchUpdate=function(a){var b,c=this._dp&&"off"!=this._dp.updateMode;c&&(b=this._dp.updateMode,this._dp.setUpdateMode("off")),this._skip_render=!0;try{a()}catch(d){}this._skip_render=!1,this.render(),c&&(this._dp.setUpdateMode(b),this._dp.sendData())},gantt.date={init:function(){for(var a=gantt.locale.date.month_short,b=gantt.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;for(var a=gantt.locale.date.month_full,b=gantt.locale.date.month_full_hash={},c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){var b=new Date(a);return a.setHours(0),this.hour_start(a),a.getHours()&&(a.getDate()<b.getDate()||a.getMonth()<b.getMonth()||a.getFullYear()<b.getFullYear())&&a.setTime(a.getTime()+36e5*(24-a.getHours())),a},time_part:function(a){return(a.valueOf()/1e3-60*a.getTimezoneOffset())%86400},week_start:function(a){var b=a.getDay();return gantt.config.start_on_monday&&(0===b?b=6:b--),this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){return a.setDate(1),this.date_part(a)},year_start:function(a){return a.setMonth(0),this.month_start(a)},day_start:function(a){return this.date_part(a)},hour_start:function(a){return a.getMinutes()&&a.setMinutes(0),this.minute_start(a),a},minute_start:function(a){return a.getSeconds()&&a.setSeconds(0),a.getMilliseconds()&&a.setMilliseconds(0),a},_add_days:function(a,b){var c=new Date(a.valueOf());return c.setDate(c.getDate()+b),b>=0&&!a.getHours()&&c.getHours()&&(c.getDate()<=a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case"day":d=gantt.date._add_days(d,b);break;case"week":d=gantt.date._add_days(d,7*b);break;case"month":d.setMonth(d.getMonth()+b);break;case"year":d.setYear(d.getFullYear()+b);break;case"hour":d.setTime(d.getTime()+60*b*60*1e3);break;case"minute":d.setTime(d.getTime()+60*b*1e3);break;default:return gantt.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return 10>a?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){return a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return'"+gantt.date.to_fixed(date.getDate())+"';case"%m":return'"+gantt.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+gantt.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+gantt.locale.date.day_short[date.getDay()]+"';case"%l":return'"+gantt.locale.date.day_full[date.getDay()]+"';case"%M":return'"+gantt.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+gantt.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+gantt.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+gantt.date.to_fixed(date.getHours())+"';case"%i":return'"+gantt.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+gantt.date.to_fixed(date.getSeconds())+"';case"%W":return'"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+"';default:return a}}),b&&(a=a.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case"%j":case"%d":c+="set[2]=temp["+e+"]||1;";break;case"%n":case"%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case"%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":c+="set[3]=temp["+e+"]||0;";break;case"%i":c+="set[4]=temp["+e+"]||0;";break;case"%Y":c+="set[0]=temp["+e+"]||0;";break;case"%a":case"%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":c+="set[5]=temp["+e+"]||0;";break;case"%M":c+="set[1]=gantt.locale.date.month_short_hash[temp["+e+"]]||0;";break;case"%F":c+="set[1]=gantt.locale.date.month_full_hash[temp["+e+"]]||0;"}var f="set[0],set[1],set[2],set[3],set[4],set[5]";return b&&(f=" Date.UTC("+f+")"),new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+f+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();0===b&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));var d=c.getFullYear(),e=Math.round((c.getTime()-new Date(d,0,1).getTime())/864e5),f=1+Math.floor(e/7);return f},getUTCISOWeek:function(a){return this.getISOWeek(a)},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())},parseDate:function(a,b){return"string"==typeof a&&(dhtmlx.defined(b)&&(b="string"==typeof b?dhtmlx.defined(gantt.templates[b])?gantt.templates[b]:gantt.date.str_to_date(b):gantt.templates.xml_date),a=a?b(a):null),a}},gantt.date.quarter_start=function(a){gantt.date.month_start(a);var b,c=a.getMonth();return b=c>=9?9:c>=6?6:c>=3?3:0,a.setMonth(b),a},gantt.date.add_quarter=function(a,b){return gantt.date.add(a,3*b,"month")},gantt.config||(gantt.config={}),gantt.config||(gantt.config={}),gantt.templates||(gantt.templates={}),function(){dhtmlx.mixin(gantt.config,{links:{finish_to_start:"0",start_to_start:"1",finish_to_finish:"2",start_to_finish:"3"},types:{task:"task",project:"project",milestone:"milestone"},duration_unit:"day",work_time:!1,correct_work_time:!1,skip_off_time:!1,autosize:!1,autosize_min_width:0,show_links:!0,show_task_cells:!0,static_background:!1,branch_loading:!1,show_loading:!1,show_chart:!0,show_grid:!0,min_duration:36e5,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:!0,server_utc:!1,show_progress:!0,fit_tasks:!1,select_task:!0,scroll_on_click:!0,preserve_scroll:!0,readonly:!1,date_grid:"%Y-%m-%d",drag_links:!0,drag_progress:!0,drag_resize:!0,drag_move:!0,drag_mode:{resize:"resize",progress:"progress",move:"move",ignore:"ignore"},round_dnd_dates:!0,link_wrapper_width:20,root_id:0,autofit:!1,columns:[{name:"text",tree:!0,width:"*",resize:!0},{name:"start_date",align:"center",resize:!0},{name:"duration",align:"center"},{name:"add",width:"44"}],step:1,scale_unit:"day",scale_offset_minimal:!0,subscales:[],inherit_scale_class:!1,time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",layer_attribute:"data-layer",buttons_left:["gantt_save_btn","gantt_cancel_btn"],_migrate_buttons:{dhx_save_btn:"gantt_save_btn",dhx_cancel_btn:"gantt_cancel_btn",dhx_delete_btn:"gantt_delete_btn"},buttons_right:["gantt_delete_btn"],lightbox:{sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"time",type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",readonly:!0,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",single_date:!0,map_to:"auto"}]},drag_lightbox:!0,sort:!1,details_on_create:!0,details_on_dblclick:!0,initial_scroll:!0,task_scroll_offset:100,order_branch:!1,order_branch_free:!1,task_height:"full",min_column_width:70,min_grid_column_width:70,grid_resizer_column_attribute:"column_index",grid_resizer_attribute:"grid_resizer",keep_grid_width:!1,grid_resize:!1,show_unscheduled:!0,readonly_property:"readonly",editable_property:"editable",type_renderers:{},open_tree_initially:!1,optimize_render:"auto",prevent_default_scroll:!1,show_errors:!0}),gantt.keys={edit_save:13,edit_cancel:27},gantt._init_template=function(a,b,c){var d=this._reg_templates||{};c=c||a,this.config[a]&&d[c]!=this.config[a]&&(b&&this.templates[c]||(this.templates[c]=this.date.date_to_str(this.config[a]),d[c]=this.config[a])),this._reg_templates=d},gantt._init_templates=function(){var a=gantt.locale.labels;a.gantt_save_btn=a.icon_save,a.gantt_cancel_btn=a.icon_cancel,a.gantt_delete_btn=a.icon_delete;var b=this.date.date_to_str,c=this.config;gantt._init_template("date_scale",!0),gantt._init_template("date_grid",!0,"grid_date_format"),gantt._init_template("task_date",!0),dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(c.xml_date,c.server_utc),xml_format:b(c.xml_date,c.server_utc),api_date:this.date.str_to_date(c.api_date),progress_text:function(){return""},grid_header_class:function(){return""},task_text:function(a,b,c){return c.text},task_class:function(){return""},grid_row_class:function(){return""},task_row_class:function(){return""},task_cell_class:function(){return""},scale_cell_class:function(){return""},scale_row_class:function(){return""},grid_indent:function(){return"<div class='gantt_tree_indent'></div>"},grid_folder:function(a){return"<div class='gantt_tree_icon gantt_folder_"+(a.$open?"open":"closed")+"'></div>"},grid_file:function(){return"<div class='gantt_tree_icon gantt_file'></div>"},grid_open:function(a){return"<div class='gantt_tree_icon gantt_"+(a.$open?"close":"open")+"'></div>"},grid_blank:function(){return"<div class='gantt_tree_icon gantt_blank'></div>"},date_grid:function(a,b){return b&&gantt.isUnscheduledTask(b)&&gantt.config.show_unscheduled?gantt.templates.task_unscheduled_time(b):gantt.templates.grid_date_format(a)},task_time:function(a,b,c){return gantt.isUnscheduledTask(c)&&gantt.config.show_unscheduled?gantt.templates.task_unscheduled_time(c):gantt.templates.task_date(a)+" - "+gantt.templates.task_date(b)},task_unscheduled_time:function(){return""},time_picker:b(c.time_picker),link_class:function(){return""},link_description:function(a){var b=gantt.getTask(a.source),c=gantt.getTask(a.target);return"<b>"+b.text+"</b> &ndash;  <b>"+c.text+"</b>"},drag_link:function(a,b,c,d){a=gantt.getTask(a);var e=gantt.locale.labels,f="<b>"+a.text+"</b> "+(b?e.link_start:e.link_end)+"<br/>";return c&&(c=gantt.getTask(c),f+="<b> "+c.text+"</b> "+(d?e.link_start:e.link_end)+"<br/>"),f},drag_link_class:function(a,b,c,d){var e="";if(a&&c){var f=gantt.isLinkAllowed(a,c,b,d);e=" "+(f?"gantt_link_allow":"gantt_link_deny")}return"gantt_link_tooltip"+e}}),this.callEvent("onTemplatesReady",[])}}(),window.jQuery&&!function(a){var b=[];a.fn.dhx_gantt=function(c){if(c=c||{},"string"!=typeof c){var d=[];return this.each(function(){if(this&&this.getAttribute)if(this.gantt)d.push("object"==typeof this.gantt?this.gantt:window.gantt);else{var a=window.gantt.$container?Gantt.getGanttInstance():window.gantt;for(var b in c)"data"!=b&&(a.config[b]=c[b]);a.init(this),c.data&&a.parse(c.data),d.push(a)}}),1===d.length?d[0]:d}return b[c]?b[c].apply(this,[]):void a.error("Method "+c+" does not exist on jQuery.dhx_gantt")}}(jQuery),window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b){var c=document.createElement("DIV");c.id="gantt_"+dhtmlx.uid(),c.style.width="100%",c.style.height="100%",c.cmp="grid",document.body.appendChild(c),this.attachObject(c.id);var d=this.vs[this.av];d.grid=gantt,gantt.init(c.id,a,b),c.firstChild.style.border="none",d.gridId=c.id,d.gridObj=c;var e="_viewRestore";return this.vs[this[e]()].grid}),gantt.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{new_task:"New task",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Task will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80},gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80},gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70},gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{gantt_delete_btn:"icon_delete",gantt_save_btn:"icon_save"}},gantt.config.touch_drag=500,gantt.config.touch=!0,gantt.config.touch_feedback=!0,gantt._touch_feedback=function(){gantt.config.touch_feedback&&navigator.vibrate&&navigator.vibrate(1)},gantt._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||a.pointerType==a.MSPOINTER_TYPE_MOUSE}):this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&a.touches.length>1?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,clientX:a.touches[0].clientX,clientY:a.touches[0].clientY}:a},function(){return!1}))},gantt._touch_events=function(a,b,c){function d(a){return a&&a.preventDefault&&a.preventDefault(),(a||event).cancelBubble=!0,!1}function e(a){var b=gantt._task_area_pulls,c=gantt.getTask(a);if(c&&gantt.isTaskVisible(a))for(var d in b)if(c=b[d][a],c&&c.getAttribute("task_id")&&c.getAttribute("task_id")==a){var e=c.cloneNode(!0);return l=c,b[d][a]=e,c.style.display="none",e.className+=" gantt_drag_move ",c.parentNode.appendChild(e),e}}var f,g=0,h=!1,i=!1,j=null,k=null,l=null;this._gantt_touch_event_ready||(this._gantt_touch_event_ready=1,dhtmlxEvent(gantt.$container,a[0],function(a){if(!c(a)&&h){k&&clearTimeout(k);var e=b(a);if(gantt._tasks_dnd.drag.id||gantt._tasks_dnd.drag.start_drag)return gantt._tasks_dnd.on_mouse_move(e),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1;if(e&&j){var l=j.pageX-e.pageX,m=j.pageY-e.pageY;if(!i&&(Math.abs(l)>5||Math.abs(m)>5)&&(gantt._touch_scroll_active=i=!0,g=0,f=gantt.getScrollState()),i){gantt.scrollTo(f.x+l,f.y+m);var n=gantt.getScrollState();if(f.x!=n.x&&m>2*l||f.y!=n.y&&l>2*m)return d(a)}}return d(a)}})),dhtmlxEvent(this.$container,"contextmenu",function(a){return h?d(a):void 0}),dhtmlxEvent(this.$container,a[1],function(a){if(!c(a)){if(a.touches&&a.touches.length>1)return void(h=!1);if(h=!0,j=b(a),j&&g){var f=new Date;500>f-g?(gantt._on_dblclick(j),d(a)):g=f}else g=new Date;k=setTimeout(function(){var a=gantt.locate(j);!a||gantt._locate_css(j,"gantt_link_control")||gantt._locate_css(j,"gantt_grid_data")||(gantt._tasks_dnd.on_mouse_down(j),gantt._tasks_dnd.drag&&gantt._tasks_dnd.drag.start_drag&&(e(a),gantt._tasks_dnd._start_dnd(j),gantt._touch_drag=!0,gantt.refreshTask(a),gantt._touch_feedback())),k=null},gantt.config.touch_drag)}}),dhtmlxEvent(this.$container,a[2],function(a){if(!c(a)){k&&clearTimeout(k),gantt._touch_drag=!1,h=!1;var d=b(a);gantt._tasks_dnd.on_mouse_up(d),l&&(gantt.refreshTask(gantt.locate(l)),l.parentNode&&(l.parentNode.removeChild(l),gantt._touch_feedback())),gantt._touch_scroll_active=h=i=!1,l=null}})};for(var i=0;i<Gantt._ganttPlugin.length;i++)Gantt._ganttPlugin[i](gantt);return gantt._internal_id=Gantt._seed++,Gantt.$syncFactory&&Gantt.$syncFactory(gantt),gantt},window.gantt=Gantt.getGanttInstance(),dhtmlx&&(dhtmlx.attaches=dhtmlx.attaches||[],dhtmlx.attaches.attachGantt=function(a,b,c){var d=document.createElement("DIV");return d.id="dhxSchedObj_"+this._genStr(12),d.style.cssText="width:100%; height:100%;",document.body.appendChild(d),this.attachObject(d.id,!1,!0),c=c||(window.gantt.$container?Gantt.getGanttInstance():window.gantt),this.vs[this.av].sched=c,this.vs[this.av].schedId=d.id,c.destructor=function(){},c.init(d.id,a,b),this.vs[this._viewRestore()].sched}),define("gantt",function(a){return function(){var b;return b||a.gantt}}(this)),Gantt.plugin(function(a){a._markers||(a._markers={}),a.config.show_markers=!0,a.attachEvent("onClear",function(){a._markers={}}),a.attachEvent("onGanttReady",function(){function b(b){if(!a.config.show_markers)return!1;if(!b.start_date)return!1;var c=a.getState();if(!(+b.start_date>+c.max_date||+b.end_date&&+b.end_date<+c.min_date||+b.start_date<+c.min_date)){var d=document.createElement("div");d.setAttribute("marker_id",b.id);var e="gantt_marker";a.templates.marker_class&&(e+=" "+a.templates.marker_class(b)),b.css&&(e+=" "+b.css),b.title&&(d.title=b.title),d.className=e;var f=a.posFromDate(b.start_date);if(d.style.left=f+"px",d.style.height=Math.max(a._y_from_ind(a._order.length),0)+"px",b.end_date){var g=a.posFromDate(b.end_date);d.style.width=Math.max(g-f,0)+"px"}return b.text&&(d.innerHTML="<div class='gantt_marker_content' >"+b.text+"</div>"),d}}var c=document.createElement("div");c.className="gantt_marker_area",a.$task_data.appendChild(c),a.$marker_area=c,a._markerRenderer=a._task_renderer("markers",b,a.$marker_area,null)}),a.attachEvent("onDataRender",function(){a.renderMarkers()}),a.getMarker=function(a){return this._markers?this._markers[a]:null},a.addMarker=function(a){return a.id=a.id||dhtmlx.uid(),this._markers[a.id]=a,a.id},a.deleteMarker=function(a){return this._markers&&this._markers[a]?(delete this._markers[a],!0):!1},a.updateMarker=function(a){this._markerRenderer&&this._markerRenderer.render_item(a)},a.renderMarkers=function(){if(!this._markers)return!1;if(!this._markerRenderer)return!1;var a=[];for(var b in this._markers)a.push(this._markers[b]);return this._markerRenderer.render_items(a),!0}}),define("ganttMarker",function(){}),Gantt.plugin(function(a){a._tooltip={},a._tooltip_class="gantt_tooltip",a.config.tooltip_timeout=30,a.config.tooltip_offset_y=20,a.config.tooltip_offset_x=10,a._create_tooltip=function(){return this._tooltip_html||(this._tooltip_html=document.createElement("div"),this._tooltip_html.className=a._tooltip_class),this._tooltip_html},a._is_cursor_under_tooltip=function(a,b){return a.x>=b.pos.x&&a.x<=b.pos.x+b.width?!0:a.y>=b.pos.y&&a.y<=b.pos.y+b.height?!0:!1},a._show_tooltip=function(b,c){if(!a.config.touch||a.config.touch_tooltip){var d=this._create_tooltip();d.innerHTML=b,a.$task_data.appendChild(d);var e=d.offsetWidth+20,f=d.offsetHeight+40,g=this.$task.offsetHeight,h=this.$task.offsetWidth,i=this.getScrollState();c.y+=i.y;var j={x:c.x,y:c.y};c.x+=1*a.config.tooltip_offset_x||0,c.y+=1*a.config.tooltip_offset_y||0,c.y=Math.min(Math.max(i.y,c.y),i.y+g-f),c.x=Math.min(Math.max(i.x,c.x),i.x+h-e),a._is_cursor_under_tooltip(j,{pos:c,width:e,height:f})&&(j.x+e>h+i.x&&(c.x=j.x-(e-20)-(1*a.config.tooltip_offset_x||0)),j.y+f>g+i.y&&(c.y=j.y-(f-40)-(1*a.config.tooltip_offset_y||0))),d.style.left=c.x+"px",d.style.top=c.y+"px"}},a._hide_tooltip=function(){this._tooltip_html&&this._tooltip_html.parentNode&&this._tooltip_html.parentNode.removeChild(this._tooltip_html),this._tooltip_id=0},a._is_tooltip=function(b){var c=b.target||b.srcElement;return a._is_node_child(c,function(a){return a.className==this._tooltip_class})},a._is_task_line=function(b){var c=b.target||b.srcElement;return a._is_node_child(c,function(a){return a==this.$task_data})},a._is_node_child=function(b,c){for(var d=!1;b&&!d;)d=c.call(a,b),b=b.parentNode;return d},a._tooltip_pos=function(b){if(b.pageX||b.pageY)var c={x:b.pageX,y:b.pageY};var d=_isIE?document.documentElement:document.body,c={x:b.clientX+d.scrollLeft-d.clientLeft,y:b.clientY+d.scrollTop-d.clientTop},e=a._get_position(a.$task_data);return c.x=c.x-e.x,c.y=c.y-e.y,c},a.attachEvent("onMouseMove",function(b,c){if(this.config.tooltip_timeout){document.createEventObject&&!document.createEvent&&(c=document.createEventObject(c));var d=this.config.tooltip_timeout;this._tooltip_id&&!b&&(isNaN(this.config.tooltip_hide_timeout)||(d=this.config.tooltip_hide_timeout)),clearTimeout(a._tooltip_ev_timer),a._tooltip_ev_timer=setTimeout(function(){a._init_tooltip(b,c)},d)}else a._init_tooltip(b,c)}),a._init_tooltip=function(a,b){if(!this._is_tooltip(b)&&(a!=this._tooltip_id||this._is_task_line(b))){if(!a)return this._hide_tooltip();this._tooltip_id=a;var c=this.getTask(a),d=this.templates.tooltip_text(c.start_date,c.end_date,c);return d?void this._show_tooltip(d,this._tooltip_pos(b)):void this._hide_tooltip()}},a.attachEvent("onMouseLeave",function(b){a._is_tooltip(b)||this._hide_tooltip()}),a.templates.tooltip_date_format=a.date.date_to_str("%Y-%m-%d"),a.templates.tooltip_text=function(b,c,d){return"<b>Task:</b> "+d.text+"<br/><b>Start date:</b> "+a.templates.tooltip_date_format(b)+"<br/><b>End date:</b> "+a.templates.tooltip_date_format(c)}}),define("ganttTips",function(){}),gantt.config.day_date="%M %d日 %D",gantt.config.default_date="%Y年 %M %d日",gantt.config.month_date="%Y年 %M",gantt.locale={date:{month_full:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],month_short:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],day_full:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],day_short:["日","一","二","三","四","五","六"]},labels:{dhx_cal_today_button:"今天",day_tab:"日",week_tab:"周",month_tab:"月",new_event:"新建日程",icon_save:"保存",icon_cancel:"关闭",icon_details:"详细",icon_edit:"编辑",icon_delete:"删除",confirm_closing:"请确认是否撤销修改!",confirm_deleting:"是否删除日程?",section_description:"描述",section_time:"时间范围",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},define("ganttCN",function(){}),define("views/common/gantt/gantt-layout-view",["talent","templates/common","moment","tdialog","gantt","ganttMarker","ganttTips","ganttCN"],function(a,b,c,d,e){return a.ItemView.extend({template:b["common/gantt/gantt-layout"],legendTemplate:b["common/gantt/gantt-legend"],regions:{chart:".gantt-body"},className:"gantt",defaults:{width:1200,height:600,getSubUrl:"",data:{startDate:"",endDate:""}},initialize:function(b){var d=this;this.nowDate=c().toDate(),this.settings=a._.extend({},this.defaults,b);var e=d.$(".gantt-main"),f=e.width();if(d.settings.data.Data){var g=d.settings.data.Data.tasks;d.model.set("work",!1),g.isWork=!1}else{var g=d.settings.data.tasks;d.model.set("work",!0),g.isWork=!0}var h=0;if(h=620,h=g.length>20?620:28*g.length+110,this.model.set({width:f,height:h}),g[0])if("score"in g[0]){var i=!0;d.model.set("score",!0)}else{var i=!1;d.model.set("score",!1)}else{var i=!1;d.model.set("score",!1)}this.setGanttConfig(g.isWork,i),this.setGanttTmeplates(),this.overRiderGanttMethod(),this.addGanttMarker(),this.addGanttEvent(),this.setScaleConfig("1")},getBackupColumn:function(){var a={name:"startDate",label:"日期",template:function(a){var b=c(a.backStartDate).format("YYYY-MM-DD"),d=c(a.backEndDate).format("YYYY-MM-DD");return"milestone1"==a.type&&"未设置里程碑"==a.name||a.title?"":b+" - "+d},align:"center",resize:!0};return a},getBackSorce:function(){var a={name:"score",label:"评分",resize:!0,width:"60",align:"center",width:80,template:function(a){return 2==a.status&&!a.score||a.title?"":a.score?a.score:"-"}};return a},getBackComplate:function(){var a={name:"finishProgress",label:"完成度",resize:!0,width:"60",align:"center"};return a},mockData:function(){for(var a=[{id:1,name:"项目1",finishProgress:"120/130",type:"4",score:"60%",endDate:"2015/07/12",startDate:"2015/06/22",endDate:"2015/07/12",finishDate:"2015/07/13",isLongTerm:!1},{id:11,name:"产品设计",principalUser:"jack",type:"27",finishProgress:"120/130",score:"60%",startDate:"2015/06/22",endDate:"2015/07/12",finishDate:"2015/07/13",isLongTerm:!1,parentId:"1"}],b=0;10>b;b++){var c={id:b+100,name:"Task #"+(b+3),principalUser:"jack",type:"7",finishProgress:"120/130",score:"60%",startDate:"2015/06/22",endDate:"2015/07/12",finishDate:"2015/07/13",isLongTerm:!1,parentId:"11",progressColor:"#74bdff"};a.push(c)}return a},initGantt:function(){this.$el.find(this.ui.ganttBody)[0];e.init("grid-configuration")},setGanttConfig:function(a,b){var c=this;e.config.grid_width=450,e.config.readonly=!0,e.config.row_height=25,e.config.grid_resize=!0,e.config.columns=[{name:"name",resize:!0,label:"事项名称",tree:!0,template:function(a){var b=a.name,c="";return"project"==a.type?c="项目:":"milestone1"==a.type&&"未设置里程碑"!=b&&(c="里程碑:"),c+b}},{name:"principalUser",resize:!0,label:"负责人",align:"center",template:function(a){return a.principalUser?a.principalUser:""}}];var d=c.getBackComplate(),f=c.getBackSorce(),g=c.getBackupColumn();a&&e.config.columns.push(d),b&&e.config.columns.push(f),e.config.columns.push(g)},setGanttTmeplates:function(){var a=this;e.templates.grid_file=function(){return""},e.templates.grid_folder=function(){return""},e.templates.progress_text=function(){return""},e.templates.grid_header_class=function(){return"gridTitle gridFont"},e.templates.scale_cell_class=function(){return"gridTitle"},e.templates.scale_row_class=function(){return"gridTitle"},e.templates.task_text=function(a,b,d){var e=d.finishDate,f=d.endTime,g=d.status,h=d.type;return"project"==h||"milestone1"==h||"title"==h?"":"2"==g?c(e).format()==c(f).format()?"按期完成":c(e)<c(f)?"提前完成":"延期完成":"4"==g?"已取消":"6"==g?"已暂停":"0"==g?"未开始":"3"==g?"延迟":"1"==g?"进行中":void 0},e.templates.progress_class=function(a){var b=a.type,d=a.status,e=a.finishDate,f=a.endTime,g=a.startDate,h=a.progress;return"project"==b||"title"==b?"hideTest":"milestone1"==b?"未设置里程碑"==a.name?"hideTest":"heightSmall":"2"==d?c(e).format()==c(f).format()?"testGreen progressGreen":c(e)<c(f)?"gantt_task_progress testGreen":"testGreen":"4"==d?"darkgray":"6"==d?"pause":"0"==d?"gantt_task_progress_blue":"3"==d?c(g)>c(e)?"setdelay":c(e)<c(g)?"setdelay":1==h?"gantt_task_progress_blue":"setdelay":"1"==d?"gantt_task_progress_blue":void 0},e.templates.task_class=function(b,d,e){{var f=e.type,g=e.status,h=e.finishDate,i=e.endTime,j=e.startDate;e.progress}return"project"==f||"title"==f?"hideTest":"milestone1"==f?"未设置里程碑"==e.name?"hideTest":"heightSmall":"2"==g?c(h).format()==c(i).format()?"testGreen progressGreen":c(h)<c(j)?"testGreen":c(h)<c(i)?"testGreen cancle":"testRed":"4"==g?c(h)<c(i)?"cancle":"testRed":"6"==g?c(h)>c(i)?"testRed":c(h)<c(j)?"pause":"cancle":"0"==g?c(i)<a.nowDate?"testRed":"gantt_task_progress_blue":"3"==g?c(h)<c(i)?"setdelay":c(j)>c(h)?"setdelay":"testRed":"1"==g?c(i)<a.nowDate?"testRed":"gantt_task_progress_blue":void 0},e.templates.tooltip_text=function(a,b,c){var a=c.startDate,b=c.endDate;return("milestone1"==c.type||"project"==c.type)&&(a=c.backStartDate,b=c.backEndDate),"title"==c.type?"<div class='gantt-tip'><b>名称:</b> "+c.name:"<div class='gantt-tip'><b>名称:</b> "+c.name+"<br/><b>开始时间:</b> "+a+"<br/><b>结束时间:</b> "+b+"</div>"},e.attachEvent("onMouseMove",function(){})},overRiderGanttMethod:function(){e._render_grid_item=function(a){if(!e._is_grid_visible())return null;
for(var b=this.getGridColumns(),c=[],d=0;d<b.length;d++){var f,g,h=d==b.length-1,i=b[d];"add"==i.name?g="<div class='gantt_add'></div>":(g=i.template?i.template(a):a[i.name],g instanceof Date&&(g=this.templates.date_grid(g,a)),g="<div class='gantt_tree_content gantt_tree_content_"+a.type+"' >"+g+"</div>");var j="gantt_cell"+(h?" gantt_last_cell":""),k="";if(i.tree){for(var l=0;l<a.$level;l++)k+=this.templates.grid_indent(a);var m=this._has_children(a.id);m?(k+=this.templates.grid_open(a),k+=this.templates.grid_folder(a)):(k+=this.templates.grid_blank(a),k+=this.templates.grid_file(a))}var n="width:"+(i.width-(h?1:0))+"px;";dhtmlx.defined(i.align)&&(n+="text-align:"+i.align+";"),f="<div class='"+j+"' style='"+n+"'>"+k+g+"</div>",c.push(f)}var j=a.$index%2===0?"":" odd";if(j+=a.$transparent?" gantt_transparent":"",j+=a.$dataprocessor_class?" "+a.$dataprocessor_class:"",this.templates.grid_row_class){var o=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);o&&(j+=" "+o)}var p="";a.title&&(p+=" newGantt_title"),this.getState().selected_task==a.id&&(j+=" gantt_selected");var q=document.createElement("div");return q.className="gantt_row"+j+p,q.style.height=this.config.row_height+"px",q.style.lineHeight=e.config.row_height+"px",q.setAttribute(this.config.task_attribute,a.id),q.innerHTML=c.join(""),q},e._set_scroll_events=function(){function a(a){var c=e._get_resize_options();e._wheel_time=new Date;var d=b?-20*a.deltaX:2*a.wheelDeltaX,f=b?-40*a.deltaY:a.wheelDelta;if(d&&Math.abs(d)>Math.abs(f)){if(c.x)return!0;var g=d/-40,h=e.$task.scrollLeft+30*g;e.scrollTo(h,null),e.$scroll_hor.scrollTop=i}else{if(c.y)return!0;var g=f/-40;"undefined"==typeof f&&(g=a.detail);var i=e.$scroll_ver.scrollTop+30*g;if(!e.config.prevent_default_scroll&&e._cached_scroll_pos&&e._cached_scroll_pos.y==i)return!0;e.scrollTo(null,i),e.$scroll_ver.scrollTop=i}return!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(new Date-(e._wheel_time||0)<100)return!0;if(!e._touch_scroll_active){var a=e.$scroll_hor.scrollLeft;e.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!e._touch_scroll_active){var a=e.$scroll_ver.scrollTop;e.$grid_data.scrollTop=a,e.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=e.$task.scrollLeft,b=e.$scroll_hor.scrollLeft;b!=a&&(e.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=e.$task_data.scrollTop,b=e.$scroll_ver.scrollTop;b!=a&&(e.$scroll_ver.scrollTop=a)});var b=_isFF&&!window._KHTMLrv;b?dhtmlxEvent(e.$container,"wheel",a):dhtmlxEvent(e.$container,"mousewheel",a)},e._get_task_pos=function(a,b){b=b!==!1;var c=e._get_milestone_width()/2,d=this._get_task_coord(a,b,c);return"milestone1"==a.type&&(d.y=d.y+11),d},e._has_children=function(a){return this.getChildren(a).length>0||e.getTask(a).isHasChild},e._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var b=this.$task_data.childNodes,c=0,d=b.length;d>c;c++){var e=b[c];this._is_layer(e)&&e.style&&(e.style.width=a.full_width+"px")}if(this._is_grid_visible())for(var f=this.getGridColumns(),g=0,c=0;c<f.length;c++)g+=f[c].width},e.date._add_days=function(a,b){var c=new Date(a.valueOf());return c.setMilliseconds(c.getMilliseconds()+24*b*60*60*1e3),b>=0&&!a.getHours()&&c.getHours()&&(c.getDate()<=a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c}},addGanttMarker:function(){var a=this,b=e.date.date_to_str(e.config.task_date),c=new Date(a.nowDate);e.addMarker({start_date:c,css:"today",text:"Today",title:"Today: "+b(c)})},addGanttEvent:function(){var b=this;b.taskOpenEvent=e.attachEvent("onTaskOpened",function(c){var d=e._has_children(c),f=e.getChildren(c).length,g=e.getTask(c),h=g.workId;d&&0>=f&&a.$.ajax({url:b.settings.getSubUrl,data:{partent_id:c,work_id:h},type:"get"}).done(function(a){var d=a.Data;b.dealData(d),b.addTask(d,c)})}),b.taskClickEvent=e.attachEvent("onTaskClick",function(b,c){var d=e.getTask(b),f=$(c.target).hasClass("gantt_tree_icon");return f?!0:("task"==d.type&&a.app.vent.trigger("global-pull-screen",b,"task"),c.cancelBubble=!0,!0)})},removeEvent:function(){var a=this;e.detachEvent(a.taskOpenEvent),e.detachEvent(a.taskClickEvent)},addTask:function(a,b){for(var c=a.length,d=0;c>d;d++){var f=a[d];e.addTask(f,b)}},setScaleConfig:function(a){var b=this;switch(a){case"1":e.config.scale_unit="month",e.config.step=1,e.config.date_scale="%Y年 %M",e.config.subscales=[{unit:"day",step:1,date:"%j"}],e.config.scale_height=50;break;case"2":var c=function(a){var c=a.getYear(),d=a.getMonth()+1,e=a.getDate(),f=b.getWeekMonth(c,d,e);return"第"+f+"周"};e.config.scale_unit="month",e.config.date_scale="%Y年 %M",e.config.step=1,e.config.subscales=[{unit:"week",step:1,template:c}],e.config.scale_height=50;break;case"3":e.config.scale_unit="year",e.config.date_scale=" %Y",e.config.subscales=[{unit:"month",step:1,date:"%M"}],e.config.scale_height=50,e.templates.date_scale=null;break;case"4":var d=function(a){var b,c=a.getMonth();return b=c>=9?4:c>=6?3:c>=3?2:1,"第"+b+"季度"};e.config.scale_unit="year",e.config.step=1,e.config.date_scale="%Y年",e.config.min_column_width=50,e.config.scale_height=50,e.config.subscales=[{unit:"quarter",step:1,template:d},{unit:"month",step:1,date:"%M"}];break;case"5":var d=function(a){var b,c=a.getMonth();return b=c>=9?4:c>=6?3:c>=3?2:1,"第"+b+"季度"};e.config.scale_unit="year",e.config.step=1,e.config.date_scale="%Y年",e.config.scale_height=50,e.config.subscales=[{unit:"quarter",step:1,template:d},{unit:"month",step:1,date:"%M"}]}},getWeekMonth:function(a,b,c){var d=new Date(a,parseInt(b)-1,c),e=d.getDay(),f=d.getDate();return Math.ceil((f+6-e)/7)},renderGantt:function(){e.render()},operateColumn:function(a){e.getGridColumns();e.getGridColumn("finishProgress")&&(e.getGridColumn("finishProgress").hide=!a),e.getGridColumn("score")&&(e.getGridColumn("score").hide=!a),e.getGridColumn("startDate").hide=!a},bindEvent:function(){var a=this;this.ui.scaleChange.bind("change",function(){var b=a.ui.scaleChange.val();a.setScaleConfig(b),e.render()}),this.ui.showDate.bind("click",function(){var b=a.ui.showDate.prop("checked");a.operateColumn(b),e.config.grid_resize=!0,e.render()}),this.ui.exportPDF.bind("click",function(){}),this.ui.legend.bind("click",function(b){a.lengendHandler(b)})},dealData:function(a){for(var b=this,d=a.length,e=0;d>e;e++){var f=a[e],g=f.type,h=f.status;f.backStartDate=f.startDate,f.backEndDate=f.endDate,f.fullName&&(f.name=f.fullName);var i=f.startDate=f.startTime,j=f.endDate=f.endTime,k=f.finishDate;27!=g&&(0==h||1==h?(f.finishDate=b.nowDate,k=b.nowDate):2==h||4==h||6==h||c(j)<c(b.nowDate)&&(f.finishDate=b.nowDate,k=b.nowDate)),i=c(i),f.start_date=c(f.startTime),j=c(j).valueOf(),k=c(k).valueOf();var l=b.getTimeDur(i,j);if(i>k)f.duration=l,f.progress=0;else{var m=j-k;if(0>m){l=b.getTimeDur(i,k);var n=(j-i)/(k-i).toFixed(2);f.progress=n}else{var n=(k-i)/(j-i).toFixed(2);f.progress=n}f.duration=l}f.open="4"==f.type||"27"==f.type?!0:!f.isHasChild,f.type="5"==f.type?"title":"4"==f.type?"project":"27"==g?"milestone1":"task",f.parent=f.parentId,f.order=20}var o={data:a,links:[]};return o},events:function(){},getTimeDur:function(a,b){var c=(b-a)/864e5;return c},lengendHandler:function(){var b=this,c=this.$el.find(".gantt_btn"),e=this.legendTemplate();if(!this.legendViewIsShow){this.legendViewIsShow=!0,this.lengedView=new d({fixed:!1,type:"modal",sure:!1,cancel:!1}),this.lengedView.render().$el.appendTo("body");var f={arrow:1,arrowBias:187,topBias:0,leftBias:-5,autoHide:!1};this.lengedView.show(c,e,f),a.$("body").off("click.legendIntroduce"),a.$("body").on("click.legendIntroduce",function(c){var d=a.$(c.target);d.hasClass("gantt_btn")||0!=d.parents(".gantt_btn").length||b.lengedView&&(b.lengedView.hide(),b.legendViewIsShow=!1)})}},ui:{ganttBody:"#grid-configuration",scaleChange:"#gattConfigScale",showDate:"#showDate",exportPDF:"#exportPDF",legend:"#legend",ganttEmpty:".gantt_empty",ganttTool:"#gantt-tool",loading:"._tt_loading_m",allContainer:"#gantt-all-container"},events:function(){var a={};return a},onRender:function(){},onShow:function(){var a=this,b={},c=[];a.settings.data.tasks?(a.data=b=a.settings.data,a.tasks=c=a.settings.data.tasks):(a.data=b=a.settings.data.Data,a.tasks=c=a.settings.data.Data.tasks),c.length>1?(a.initGantt(b.startDate,b.endDate),a.bindEvent(),e.parse(a.dealData(c)),a.ui.loading.hide(),a.ui.ganttBody.show(),a.ui.ganttTool.show()):(a.ui.loading.hide(),a.ui.ganttEmpty.show(),a.ui.ganttTool.hide(),this.ui.ganttBody.hide())},onClose:function(){this.tasks.length>1&&(e.close(),e.clearAll())}})}),define("views/work/tag/siderbar-item-view",["talent","templates/work","$.tipsy"],function(a,b){return a.ItemView.extend({template:b["work/tag/siderbar-item"],tagName:"li",className:"item-nav clearfix",templateHelpers:function(){return{relation:this.settings.relation,tagId:this.settings.tagId}},ui:{count:"span.cont",shareIn:"span.share-in",shareOut:"span.share-out"},initialize:function(a){this.settings=a},onRender:function(){a.$(".tipsy").remove(),this.ui.shareIn.tipsy({fallback:"上级共享",gravity:"s"}),this.ui.shareOut.tipsy({fallback:"已共享给直属下级",gravity:"s"}),this.ui.count.tipsy({fallback:"标签下工作事项数量",gravity:"s"}),this._addActive()},_addActive:function(){var a=this.settings.relation,b=this.model.get("id");1==a&&b==this.settings.tagId&&this.$el.addClass("active")}})}),function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(jQuery),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;i>h;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(c[e]=a.isPlainObject(f)?a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,this.each(h?function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}:function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),d===b)return f[c]===b?null:f[c];f[c]=d}else{if(d===b)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow?"":b.element.css("overflow-x"),d=b.isWindow?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]);return{element:c,isWindow:d,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:0>d?"left":c>0?"right":"center",vertical:0>f?"top":e>0?"bottom":"middle"};l>n&&h(c+d)<n&&(i.horizontal="center"),m>p&&h(e+f)<p&&(i.vertical="middle"),i.important=g(h(c),h(d))>g(h(e),h(f))?"horizontal":"vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&0>=j?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):a.left=j>0&&0>=i?e:i>j?e+f-b.collisionWidth:e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&0>=j?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):a.top=j>0&&0>=i?e:i>j?e+f-b.collisionHeight:e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];0>k?(c=a.left+m+n+o+b.collisionWidth-g-f,(0>c||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];0>k?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(0>d||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&11>e,b.innerHTML="",c.removeChild(b)}()}(jQuery),function(a){a.widget("ui.draggable",a.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;
return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"original"!==this.options.helper||a.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1):!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;return e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(document).width()-this.helperProportions.width-this.margins.left,(a(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:e.scrollTop(),left:e.scrollLeft()}),{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*d}},_generatePosition:function(b){var c,d,e,f,g=this.options,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=b.pageX,j=b.pageY;return this.offset.scroll||(this.offset.scroll={top:h.scrollTop(),left:h.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,b.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),b.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),b.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),b.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"ui-sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("ui-draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("ui-draggable"),e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("ui-draggable").options;b.css("cursor")&&(c._cursor=b.css("cursor")),b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("ui-draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("ui-draggable");b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName&&(b.overflowOffset=b.scrollParent.offset())},drag:function(b){var c=a(this).data("ui-draggable"),d=c.options,e=!1;c.scrollParent[0]!==document&&"HTML"!==c.scrollParent[0].tagName?(d.axis&&"x"===d.axis||(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-c.overflowOffset.top<d.scrollSensitivity&&(c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed)),d.axis&&"y"===d.axis||(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-c.overflowOffset.left<d.scrollSensitivity&&(c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed))):(d.axis&&"x"===d.axis||(b.pageY-a(document).scrollTop()<d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed))),d.axis&&"y"===d.axis||(b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)))),e!==!1&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}}),a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("ui-draggable"),c=b.options;b.snapElements=[],a(c.snap.constructor!==String?c.snap.items||":data(ui-draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!==b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("ui-draggable"),o=n.options,p=o.snapTolerance,q=c.offset.left,r=q+n.helperProportions.width,s=c.offset.top,t=s+n.helperProportions.height;for(l=n.snapElements.length-1;l>=0;l--)h=n.snapElements[l].left,i=h+n.snapElements[l].width,j=n.snapElements[l].top,k=j+n.snapElements[l].height,h-p>r||q>i+p||j-p>t||s>k+p||!a.contains(n.snapElements[l].item.ownerDocument,n.snapElements[l].item)?(n.snapElements[l].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=!1):("inner"!==o.snapMode&&(d=Math.abs(j-t)<=p,e=Math.abs(k-s)<=p,f=Math.abs(h-r)<=p,g=Math.abs(i-q)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j-n.helperProportions.height,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i}).left-n.margins.left)),m=d||e||f||g,"outer"!==o.snapMode&&(d=Math.abs(j-s)<=p,e=Math.abs(k-t)<=p,f=Math.abs(h-q)<=p,g=Math.abs(i-r)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k-n.helperProportions.height,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[l].snapping&&(d||e||f||g||m)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=d||e||f||g||m)}}),a.ui.plugin.add("draggable","stack",{start:function(){var b,c=this.data("ui-draggable").options,d=a.makeArray(a(c.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});d.length&&(b=parseInt(a(d[0]).css("zIndex"),10)||0,a(d).each(function(c){a(this).css("zIndex",b+c)}),this.css("zIndex",b+d.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a){function b(a,b,c){return a>b&&b+c>a}a.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b=this.options,c=b.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(c)?c:function(a){return a.is(c)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[],a.ui.ddmanager.droppables[b.scope].push(this),b.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var b=0,c=a.ui.ddmanager.droppables[this.options.scope];b<c.length;b++)c[b]===this&&c.splice(b,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){"accept"===b&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return d&&(d.currentItem||d.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"ui-droppable");return b.options.greedy&&!b.options.disabled&&b.options.scope===d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance)?(e=!0,!1):void 0}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(a,c,d){if(!c.offset)return!1;var e,f,g=(a.positionAbs||a.position.absolute).left,h=g+a.helperProportions.width,i=(a.positionAbs||a.position.absolute).top,j=i+a.helperProportions.height,k=c.offset.left,l=k+c.proportions.width,m=c.offset.top,n=m+c.proportions.height;switch(d){case"fit":return g>=k&&l>=h&&i>=m&&n>=j;case"intersect":return k<g+a.helperProportions.width/2&&h-a.helperProportions.width/2<l&&m<i+a.helperProportions.height/2&&j-a.helperProportions.height/2<n;case"pointer":return e=(a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left,f=(a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top,b(f,m,c.proportions.height)&&b(e,k,c.proportions.width);case"touch":return(i>=m&&n>=i||j>=m&&n>=j||m>i&&j>n)&&(g>=k&&l>=g||h>=k&&l>=h||k>g&&h>l);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions.height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions={width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight})}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a.data(this,"ui-droppable").options.scope===e}),f.length&&(d=a.data(f[0],"ui-droppable"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}}(jQuery),function(a){function b(a){return parseInt(a,10)||0}function c(a){return!isNaN(parseInt(a,10))}a.widget("ui.resizable",a.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String&&(this.handles[c]=a(this.handles[c],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),a(this.handles[c]).length},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(c){var d,e,f,g=this.options,h=this.element.position(),i=this.element;return this.resizing=!0,/absolute/.test(i.css("position"))?i.css({position:"absolute",top:i.css("top"),left:i.css("left")}):i.is(".ui-draggable")&&i.css({position:"absolute",top:h.top,left:h.left}),this._renderProxy(),d=b(this.helper.css("left")),e=b(this.helper.css("top")),g.containment&&(d+=a(g.containment).scrollLeft()||0,e+=a(g.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:d,top:e},this.size=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()},this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()},this.originalPosition={left:d,top:e},this.sizeDiff={width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()},this.originalMousePosition={left:c.pageX,top:c.pageY},this.aspectRatio="number"==typeof g.aspectRatio?g.aspectRatio:this.originalSize.width/this.originalSize.height||1,f=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===f?this.axis+"-resize":f),i.addClass("ui-resizable-resizing"),this._propagate("start",c),!0},_mouseDrag:function(b){var c,d=this.helper,e={},f=this.originalMousePosition,g=this.axis,h=this.position.top,i=this.position.left,j=this.size.width,k=this.size.height,l=b.pageX-f.left||0,m=b.pageY-f.top||0,n=this._change[g];return n?(c=n.apply(this,[b,l,m]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),this.position.top!==h&&(e.top=this.position.top+"px"),this.position.left!==i&&(e.left=this.position.left+"px"),this.size.width!==j&&(e.width=this.size.width+"px"),this.size.height!==k&&(e.height=this.size.height+"px"),d.css(e),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(e)||this._trigger("resize",b,this.ui()),!1):!1},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&a.ui.hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(a){var b,d,e,f,g,h=this.options;g={minWidth:c(h.minWidth)?h.minWidth:0,maxWidth:c(h.maxWidth)?h.maxWidth:1/0,minHeight:c(h.minHeight)?h.minHeight:0,maxHeight:c(h.maxHeight)?h.maxHeight:1/0},(this._aspectRatio||a)&&(b=g.minHeight*this.aspectRatio,e=g.minWidth/this.aspectRatio,d=g.maxHeight*this.aspectRatio,f=g.maxWidth/this.aspectRatio,b>g.minWidth&&(g.minWidth=b),e>g.minHeight&&(g.minHeight=e),d<g.maxWidth&&(g.maxWidth=d),f<g.maxHeight&&(g.maxHeight=f)),this._vBoundaries=g},_updateCache:function(a){this.offset=this.helper.offset(),c(a.left)&&(this.position.left=a.left),c(a.top)&&(this.position.top=a.top),c(a.height)&&(this.size.height=a.height),c(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,d=this.size,e=this.axis;return c(a.height)?a.width=a.height*this.aspectRatio:c(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===e&&(a.left=b.left+(d.width-a.width),a.top=null),"nw"===e&&(a.top=b.top+(d.height-a.height),a.left=b.left+(d.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,d=this.axis,e=c(a.width)&&b.maxWidth&&b.maxWidth<a.width,f=c(a.height)&&b.maxHeight&&b.maxHeight<a.height,g=c(a.width)&&b.minWidth&&b.minWidth>a.width,h=c(a.height)&&b.minHeight&&b.minHeight>a.height,i=this.originalPosition.left+this.originalSize.width,j=this.position.top+this.size.height,k=/sw|nw|w/.test(d),l=/nw|ne|n/.test(d);return g&&(a.width=b.minWidth),h&&(a.height=b.minHeight),e&&(a.width=b.maxWidth),f&&(a.height=b.maxHeight),g&&k&&(a.left=i-b.minWidth),e&&k&&(a.left=i-b.maxWidth),h&&l&&(a.top=j-b.minHeight),f&&l&&(a.top=j-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var a,b,c,d,e,f=this.helper||this.element;for(a=0;a<this._proportionallyResizeElements.length;a++){if(e=this._proportionallyResizeElements[a],!this.borderDif)for(this.borderDif=[],c=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],d=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")],b=0;b<c.length;b++)this.borderDif[b]=(parseInt(c[b],10)||0)+(parseInt(d[b],10)||0);e.css({height:f.height()-this.borderDif[0]-this.borderDif[2]||0,width:f.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}
}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).data("ui-resizable"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var c,d,e,f,g,h,i,j=a(this).data("ui-resizable"),k=j.options,l=j.element,m=k.containment,n=m instanceof a?m.get(0):/parent/.test(m)?l.parent().get(0):m;n&&(j.containerElement=a(n),/document/.test(m)||m===document?(j.containerOffset={left:0,top:0},j.containerPosition={left:0,top:0},j.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(c=a(n),d=[],a(["Top","Right","Left","Bottom"]).each(function(a,e){d[a]=b(c.css("padding"+e))}),j.containerOffset=c.offset(),j.containerPosition=c.position(),j.containerSize={height:c.innerHeight()-d[3],width:c.innerWidth()-d[1]},e=j.containerOffset,f=j.containerSize.height,g=j.containerSize.width,h=a.ui.hasScroll(n,"left")?n.scrollWidth:g,i=a.ui.hasScroll(n)?n.scrollHeight:f,j.parentData={element:n,left:e.left,top:e.top,width:h,height:i}))},resize:function(b){var c,d,e,f,g=a(this).data("ui-resizable"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio),g.position.top=g._helper?i.top:0),g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top,c=Math.abs((g._helper?g.offset.left-l.left:g.offset.left-l.left)+g.sizeDiff.width),d=Math.abs((g._helper?g.offset.top-l.top:g.offset.top-i.top)+g.sizeDiff.height),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f&&(c-=g.parentData.left),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio))},stop:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=function(b){a(b).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};"object"!=typeof c.alsoResize||c.alsoResize.parentNode?d(c.alsoResize):c.alsoResize.length?(c.alsoResize=c.alsoResize[0],d(c.alsoResize)):a.each(c.alsoResize,function(a){d(a)})},resize:function(b,c){var d=a(this).data("ui-resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,d){a(b).each(function(){var b=a(this),e=a(this).data("ui-resizable-alsoresize"),f={},g=d&&d.length?d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(g,function(a,b){var c=(e[b]||0)+(h[b]||0);c&&c>=0&&(f[b]=c||null)}),b.css(f)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?i(e.alsoResize):a.each(e.alsoResize,function(a,b){i(a,b)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).data("ui-resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).data("ui-resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size,e=b.originalSize,f=b.originalPosition,g=b.axis,h="number"==typeof c.grid?[c.grid,c.grid]:c.grid,i=h[0]||1,j=h[1]||1,k=Math.round((d.width-e.width)/i)*i,l=Math.round((d.height-e.height)/j)*j,m=e.width+k,n=e.height+l,o=c.maxWidth&&c.maxWidth<m,p=c.maxHeight&&c.maxHeight<n,q=c.minWidth&&c.minWidth>m,r=c.minHeight&&c.minHeight>n;c.grid=h,q&&(m+=i),r&&(n+=j),o&&(m-=i),p&&(n-=j),/^(se|s|e)$/.test(g)?(b.size.width=m,b.size.height=n):/^(ne)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.top=f.top-l):/^(sw)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.left=f.left-k):(b.size.width=m,b.size.height=n,b.position.top=f.top-l,b.position.left=f.left-k)}})}(jQuery),function(a){a.widget("ui.selectable",a.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX,top:b.pageY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");return e?(d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1):void 0}))},_mouseDrag:function(b){if(this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX,i=b.pageY;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f,top:g,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}})}(jQuery),function(a){function b(a,b,c){return a>b&&b+c>a}function c(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}a.widget("ui.sortable",a.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||c(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(b),a(b.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(d=a(this),!1):void 0}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),d&&(!this.options.handle||c||(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),e))?(this.currentItem=d,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&i>d+j,m="y"===this.options.axis||b+k>f&&g>b+k,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var c="x"===this.options.axis||b(this.positionAbs.top+this.offset.click.top,a.top,a.height),d="y"===this.options.axis||b(this.positionAbs.left+this.offset.click.left,a.left,a.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&"right"===g||"down"===f?2:1:f&&("down"===f?2:1):!1},_intersectsWithSides:function(a){var c=b(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),d=b(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"===f&&d||"left"===f&&!d:e&&("down"===e&&c||"up"===e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c,d,e,f,g=[],h=[],i=this._connectWith();if(i&&b)for(c=i.length-1;c>=0;c--)for(e=a(i[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&h.push([a.isFunction(f.options.items)?f.options.items.call(f.element):a(f.options.items,f.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),f]);for(h.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),c=h.length-1;c>=0;c--)h[c][0].each(function(){g.push(this)});return a(g)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;j>d;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){(!c||d.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(d){var e,f,g,h,i,j,k,l,m,n,o=null,p=null;for(e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(o&&a.contains(this.containers[e].element[0],o.element[0]))continue;o=this.containers[e],p=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",d,this._uiHash(this)),this.containers[e].containerCache.over=0);if(o)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(g=1e4,h=null,n=o.floating||c(this.currentItem),i=n?"left":"top",j=n?"width":"height",k=this.positionAbs[i]+this.offset.click[i],f=this.items.length-1;f>=0;f--)a.contains(this.containers[p].element[0],this.items[f].item[0])&&this.items[f].item[0]!==this.currentItem[0]&&(!n||b(this.positionAbs.top+this.offset.click.top,this.items[f].top,this.items[f].height))&&(l=this.items[f].item.offset()[i],m=!1,Math.abs(l-k)>Math.abs(l+this.items[f][j]-k)&&(m=!0,l+=this.items[f][j]),Math.abs(l-k)<g&&(g=Math.abs(l-k),h=this.items[f],this.direction=m?"up":"down"));if(!h&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;h?this._rearrange(d,h,null,!0):this._rearrange(d,null,this.containers[p].element,!0),this._trigger("change",d,this._uiHash()),this.containers[p]._trigger("change",d,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(!d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){this.reverting=!1;var c,d=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(c in this._storedCSS)("auto"===this._storedCSS[c]||"static"===this._storedCSS[c])&&(this._storedCSS[c]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))
}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||d.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(d.push(function(a){this._trigger("remove",a,this._uiHash())}),d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),c=this.containers.length-1;c>=0;c--)b||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[c])),this.containers[c].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[c])),this.containers[c].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),c=0;c<d.length;c++)d[c].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(c=0;c<d.length;c++)d[c].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a){var b=0,c={},d={};c.height=c.paddingTop=c.paddingBottom=c.borderTopWidth=c.borderBottomWidth="hide",d.height=d.paddingTop=d.paddingBottom=d.borderTopWidth=d.borderBottomWidth="show",a.widget("ui.accordion",{version:"1.10.3",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var b=this.options;this.prevShow=this.prevHide=a(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),b.collapsible||b.active!==!1&&null!=b.active||(b.active=0),this._processPanels(),b.active<0&&(b.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():a(),content:this.active.length?this.active.next():a()}},_createIcons:function(){var b=this.options.icons;b&&(a("<span>").addClass("ui-accordion-header-icon ui-icon "+b.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(b.header).addClass(b.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),a=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){return"active"===a?void this._activate(b):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||this.options.active!==!1||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()),void("disabled"===a&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!b)))},_keydown:function(b){if(!b.altKey&&!b.ctrlKey){var c=a.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),f=!1;switch(b.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._eventHandler(b);break;case c.HOME:f=this.headers[0];break;case c.END:f=this.headers[d-1]}f&&(a(b.target).attr("tabIndex",-1),a(f).attr("tabIndex",0),f.focus(),b.preventDefault())}},_panelKeyDown:function(b){b.keyCode===a.ui.keyCode.UP&&b.ctrlKey&&a(b.currentTarget).prev().focus()},refresh:function(){var b=this.options;this._processPanels(),b.active===!1&&b.collapsible===!0||!this.headers.length?(b.active=!1,this.active=a()):b.active===!1?this._activate(0):this.active.length&&!a.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(b.active=!1,this.active=a()):this._activate(Math.max(0,b.active-1)):b.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var c,d=this.options,e=d.heightStyle,f=this.element.parent(),g=this.accordionId="ui-accordion-"+(this.element.attr("id")||++b);this.active=this._findActive(d.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(b){var c=a(this),d=c.attr("id"),e=c.next(),f=e.attr("id");d||(d=g+"-header-"+b,c.attr("id",d)),f||(f=g+"-panel-"+b,e.attr("id",f)),c.attr("aria-controls",f),e.attr("aria-labelledby",d)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(d.event),"fill"===e?(c=f.height(),this.element.siblings(":visible").each(function(){var b=a(this),d=b.css("position");"absolute"!==d&&"fixed"!==d&&(c-=b.outerHeight(!0))}),this.headers.each(function(){c-=a(this).outerHeight(!0)}),this.headers.next().each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===e&&(c=0,this.headers.next().each(function(){c=Math.max(c,a(this).css("height","").height())}).height(c))},_activate:function(b){var c=this._findActive(b)[0];c!==this.active[0]&&(c=c||this.active[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return"number"==typeof b?this.headers.eq(b):a()},_setupEvents:function(b){var c={keydown:"_keydown"};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,c),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e[0]===d[0],g=f&&c.collapsible,h=g?a():e.next(),i=d.next(),j={oldHeader:d,oldPanel:i,newHeader:g?a():e,newPanel:h};b.preventDefault(),f&&!c.collapsible||this._trigger("beforeActivate",b,j)===!1||(c.active=g?!1:this.headers.index(e),this.active=f?a():e,this._toggle(j),d.removeClass("ui-accordion-header-active ui-state-active"),c.icons&&d.children(".ui-accordion-header-icon").removeClass(c.icons.activeHeader).addClass(c.icons.header),f||(e.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),c.icons&&e.children(".ui-accordion-header-icon").removeClass(c.icons.header).addClass(c.icons.activeHeader),e.next().addClass("ui-accordion-content-active")))},_toggle:function(b){var c=b.newPanel,d=this.prevShow.length?this.prevShow:b.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=c,this.prevHide=d,this.options.animate?this._animate(c,d,b):(d.hide(),c.show(),this._toggleComplete(b)),d.attr({"aria-expanded":"false","aria-hidden":"true"}),d.prev().attr("aria-selected","false"),c.length&&d.length?d.prev().attr("tabIndex",-1):c.length&&this.headers.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1),c.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(a,b,e){var f,g,h,i=this,j=0,k=a.length&&(!b.length||a.index()<b.index()),l=this.options.animate||{},m=k&&l.down||l,n=function(){i._toggleComplete(e)};return"number"==typeof m&&(h=m),"string"==typeof m&&(g=m),g=g||m.easing||l.easing,h=h||m.duration||l.duration,b.length?a.length?(f=a.show().outerHeight(),b.animate(c,{duration:h,easing:g,step:function(a,b){b.now=Math.round(a)}}),void a.hide().animate(d,{duration:h,easing:g,complete:n,step:function(a,c){c.now=Math.round(a),"height"!==c.prop?j+=c.now:"content"!==i.options.heightStyle&&(c.now=Math.round(f-b.outerHeight()-j),j=0)}})):b.animate(c,h,g,n):a.animate(d,h,g,n)},_toggleComplete:function(a){var b=a.oldPanel;b.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),b.length&&(b.parent()[0].className=b.parent()[0].className),this._trigger("activate",null,a)}})}(jQuery),function(a){var b=0;a.widget("ui.autocomplete",{version:"1.10.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var b,c,d,e=this.element[0].nodeName.toLowerCase(),f="textarea"===e,g="input"===e;this.isMultiLine=f?!0:g?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[f||g?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly"))return b=!0,d=!0,void(c=!0);b=!1,d=!1,c=!1;var f=a.ui.keyCode;switch(e.keyCode){case f.PAGE_UP:b=!0,this._move("previousPage",e);break;case f.PAGE_DOWN:b=!0,this._move("nextPage",e);break;case f.UP:b=!0,this._keyEvent("previous",e);break;case f.DOWN:b=!0,this._keyEvent("next",e);break;case f.ENTER:case f.NUMPAD_ENTER:this.menu.active&&(b=!0,e.preventDefault(),this.menu.select(e));break;case f.TAB:this.menu.active&&this.menu.select(e);break;case f.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(e),e.preventDefault());break;default:c=!0,this._searchTimeout(e)}},keypress:function(d){if(b)return b=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&d.preventDefault());if(!c){var e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:this._move("previousPage",d);break;case e.PAGE_DOWN:this._move("nextPage",d);break;case e.UP:this._keyEvent("previous",d);break;case e.DOWN:this._keyEvent("next",d)}}},input:function(a){return d?(d=!1,void a.preventDefault()):void this._searchTimeout(a)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(a){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(a),void this._change(a))}}),this._initSource(),this.menu=a("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(b){b.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var c=this.menu.element[0];a(b.target).closest(".ui-menu-item").length||this._delay(function(){var b=this;this.document.one("mousedown",function(d){d.target===b.element[0]||d.target===c||a.contains(c,d.target)||b.close()})})},menufocus:function(b,c){if(this.isNewMenu&&(this.isNewMenu=!1,b.originalEvent&&/^mouse/.test(b.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){a(b.target).trigger(b.originalEvent)});var d=c.item.data("ui-autocomplete-item");!1!==this._trigger("focus",b,{item:d})?b.originalEvent&&/^key/.test(b.originalEvent.type)&&this._value(d.value):this.liveRegion.text(d.value)},menuselect:function(a,b){var c=b.item.data("ui-autocomplete-item"),d=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d,this.selectedItem=c})),!1!==this._trigger("select",a,{item:c})&&this._value(c.value),this.term=this._value(),this.close(a),this.selectedItem=c}}),this.liveRegion=a("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(a,b){this._super(a,b),"source"===a&&this._initSource(),"appendTo"===a&&this.menu.element.appendTo(this._appendTo()),"disabled"===a&&b&&this.xhr&&this.xhr.abort()},_appendTo:function(){var b=this.options.appendTo;return b&&(b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)),b||(b=this.element.closest(".ui-front")),b.length||(b=this.document[0].body),b},_initSource:function(){var b,c,d=this;a.isArray(this.options.source)?(b=this.options.source,this.source=function(c,d){d(a.ui.autocomplete.filter(b,c.term))}):"string"==typeof this.options.source?(c=this.options.source,this.source=function(b,e){d.xhr&&d.xhr.abort(),d.xhr=a.ajax({url:c,data:b,dataType:"json",success:function(a){e(a)},error:function(){e([])}})}):this.source=this.options.source},_searchTimeout:function(a){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,a))},this.options.delay)},search:function(a,b){return a=null!=a?a:this._value(),this.term=this._value(),a.length<this.options.minLength?this.close(b):this._trigger("search",b)!==!1?this._search(a):void 0},_search:function(a){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:a},this._response())},_response:function(){var a=this,c=++b;return function(d){c===b&&a.__response(d),a.pending--,a.pending||a.element.removeClass("ui-autocomplete-loading")}},__response:function(a){a&&(a=this._normalize(a)),this._trigger("response",null,{content:a}),!this.options.disabled&&a&&a.length&&!this.cancelSearch?(this._suggest(a),this._trigger("open")):this._close()},close:function(a){this.cancelSearch=!0,this._close(a)},_close:function(a){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",a))},_change:function(a){this.previous!==this._value()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(b){return b.length&&b[0].label&&b[0].value?b:a.map(b,function(b){return"string"==typeof b?{label:b,value:b}:a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(b){var c=this.menu.element.empty();this._renderMenu(c,b),this.isNewMenu=!0,this.menu.refresh(),c.show(),this._resizeMenu(),c.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(b,c){var d=this;a.each(c,function(a,c){d._renderItemData(b,c)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-autocomplete-item",b)},_renderItem:function(b,c){return a("<li>").append(a("<a>").text(c.label)).appendTo(b)},_move:function(a,b){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(a)||this.menu.isLastItem()&&/^next/.test(a)?(this._value(this.term),void this.menu.blur()):void this.menu[a](b):void this.search(null,b)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(a,b){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(a,b),b.preventDefault())}}),a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(b,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(c),"i");return a.grep(b,function(a){return d.test(a.label||a.value||a)})}}),a.widget("ui.autocomplete",a.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(a){return a+(a>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(a){var b;this._superApply(arguments),this.options.disabled||this.cancelSearch||(b=a&&a.length?this.options.messages.results(a.length):this.options.messages.noResults,this.liveRegion.text(b))}})}(jQuery),function(a){var b,c,d,e,f="ui-button ui-widget ui-state-default ui-corner-all",g="ui-state-hover ui-state-active ",h="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",i=function(){var b=a(this);setTimeout(function(){b.find(":ui-button").button("refresh")},1)},j=function(b){var c=b.name,d=b.form,e=a([]);return c&&(c=c.replace(/'/g,"\\'"),e=d?a(d).find("[name='"+c+"']"):a("[name='"+c+"']",b.ownerDocument).filter(function(){return!this.form})),e};a.widget("ui.button",{version:"1.10.3",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,i),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var g=this,h=this.options,k="checkbox"===this.type||"radio"===this.type,l=k?"":"ui-state-active",m="ui-state-focus";null===h.label&&(h.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(f).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){h.disabled||this===b&&a(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){h.disabled||a(this).removeClass(l)}).bind("click"+this.eventNamespace,function(a){h.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){g.buttonElement.addClass(m)}).bind("blur"+this.eventNamespace,function(){g.buttonElement.removeClass(m)}),k&&(this.element.bind("change"+this.eventNamespace,function(){e||g.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(a){h.disabled||(e=!1,c=a.pageX,d=a.pageY)}).bind("mouseup"+this.eventNamespace,function(a){h.disabled||(c!==a.pageX||d!==a.pageY)&&(e=!0)})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return h.disabled||e?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(h.disabled||e)return!1;a(this).addClass("ui-state-active"),g.buttonElement.attr("aria-pressed","true");var b=g.element[0];j(b).not(b).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return h.disabled?!1:(a(this).addClass("ui-state-active"),b=this,void g.document.one("mouseup",function(){b=null}))}).bind("mouseup"+this.eventNamespace,function(){return h.disabled?!1:void a(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(b){return h.disabled?!1:void((b.keyCode===a.ui.keyCode.SPACE||b.keyCode===a.ui.keyCode.ENTER)&&a(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",h.disabled),this._resetButton()},_determineButtonType:function(){var a,b,c;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(a=this.element.parents().last(),b="label[for='"+this.element.attr("id")+"']",this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible"),c=this.element.is(":checked"),c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",c)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(f+" "+g+" "+h).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(a,b){return this._super(a,b),"disabled"===a?void(b?this.element.prop("disabled",!0):this.element.prop("disabled",!1)):void this._resetButton()},refresh:function(){var b=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");b!==this.options.disabled&&this._setOption("disabled",b),"radio"===this.type?j(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var b=this.buttonElement.removeClass(h),c=a("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),d=this.options.icons,e=d.primary&&d.secondary,f=[];d.primary||d.secondary?(this.options.text&&f.push("ui-button-text-icon"+(e?"s":d.primary?"-primary":"-secondary")),d.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||(f.push(e?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",a.trim(c)))):f.push("ui-button-text-only"),b.addClass(f.join(" "))}}),a.widget("ui.buttonset",{version:"1.10.3",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,b){"disabled"===a&&this.buttons.button("option",a,b),this._super(a,b)},refresh:function(){var b="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(a,b){function c(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},a.extend(this._defaults,this.regional[""]),this.dpDiv=d(a("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function d(b){var c="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return b.delegate(c,"mouseout",function(){a(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&a(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&a(this).removeClass("ui-datepicker-next-hover")}).delegate(c,"mouseover",function(){a.datepicker._isDisabledDatepicker(f.inline?b.parent()[0]:f.input[0])||(a(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),a(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&a(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&a(this).addClass("ui-datepicker-next-hover"))})}function e(b,c){a.extend(b,c);for(var d in c)null==c[d]&&(b[d]=c[d]);return b}a.extend(a.ui,{datepicker:{version:"1.10.3"}});var f,g="datepicker";a.extend(c.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(a){return e(this._defaults,a||{}),this},_attachDatepicker:function(b,c){var d,e,f;d=b.nodeName.toLowerCase(),e="div"===d||"span"===d,b.id||(this.uuid+=1,b.id="dp"+this.uuid),f=this._newInst(a(b),e),f.settings=a.extend({},c||{}),"input"===d?this._connectDatepicker(b,f):e&&this._inlineDatepicker(b,f)},_newInst:function(b,c){var e=b[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:e,input:b,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:c,dpDiv:c?d(a("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(b,c){var d=a(b);c.append=a([]),c.trigger=a([]),d.hasClass(this.markerClassName)||(this._attachments(d,c),d.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(c),a.data(b,g,c),c.settings.disabled&&this._disableDatepicker(b))},_attachments:function(b,c){var d,e,f,g=this._get(c,"appendText"),h=this._get(c,"isRTL");c.append&&c.append.remove(),g&&(c.append=a("<span class='"+this._appendClass+"'>"+g+"</span>"),b[h?"before":"after"](c.append)),b.unbind("focus",this._showDatepicker),c.trigger&&c.trigger.remove(),d=this._get(c,"showOn"),("focus"===d||"both"===d)&&b.focus(this._showDatepicker),("button"===d||"both"===d)&&(e=this._get(c,"buttonText"),f=this._get(c,"buttonImage"),c.trigger=a(this._get(c,"buttonImageOnly")?a("<img/>").addClass(this._triggerClass).attr({src:f,alt:e,title:e}):a("<button type='button'></button>").addClass(this._triggerClass).html(f?a("<img/>").attr({src:f,alt:e,title:e}):e)),b[h?"before":"after"](c.trigger),c.trigger.click(function(){return a.datepicker._datepickerShowing&&a.datepicker._lastInput===b[0]?a.datepicker._hideDatepicker():a.datepicker._datepickerShowing&&a.datepicker._lastInput!==b[0]?(a.datepicker._hideDatepicker(),a.datepicker._showDatepicker(b[0])):a.datepicker._showDatepicker(b[0]),!1}))},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b,c,d,e,f=new Date(2009,11,20),g=this._get(a,"dateFormat");g.match(/[DM]/)&&(b=function(a){for(c=0,d=0,e=0;e<a.length;e++)a[e].length>c&&(c=a[e].length,d=e);return d},f.setMonth(b(this._get(a,g.match(/MM/)?"monthNames":"monthNamesShort"))),f.setDate(b(this._get(a,g.match(/DD/)?"dayNames":"dayNamesShort"))+20-f.getDay())),a.input.attr("size",this._formatDate(a,f).length)}},_inlineDatepicker:function(b,c){var d=a(b);d.hasClass(this.markerClassName)||(d.addClass(this.markerClassName).append(c.dpDiv),a.data(b,g,c),this._setDate(c,this._getDefaultDate(c),!0),this._updateDatepicker(c),this._updateAlternate(c),c.settings.disabled&&this._disableDatepicker(b),c.dpDiv.css("display","block"))},_dialogDatepicker:function(b,c,d,f,h){var i,j,k,l,m,n=this._dialogInst;return n||(this.uuid+=1,i="dp"+this.uuid,this._dialogInput=a("<input type='text' id='"+i+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),a("body").append(this._dialogInput),n=this._dialogInst=this._newInst(this._dialogInput,!1),n.settings={},a.data(this._dialogInput[0],g,n)),e(n.settings,f||{}),c=c&&c.constructor===Date?this._formatDate(n,c):c,this._dialogInput.val(c),this._pos=h?h.length?h:[h.pageX,h.pageY]:null,this._pos||(j=document.documentElement.clientWidth,k=document.documentElement.clientHeight,l=document.documentElement.scrollLeft||document.body.scrollLeft,m=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[j/2-100+l,k/2-150+m]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),n.settings.onSelect=d,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),a.blockUI&&a.blockUI(this.dpDiv),a.data(this._dialogInput[0],g,n),this},_destroyDatepicker:function(b){var c,d=a(b),e=a.data(b,g);d.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),a.removeData(b,g),"input"===c?(e.append.remove(),e.trigger.remove(),d.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===c||"span"===c)&&d.removeClass(this.markerClassName).empty())},_enableDatepicker:function(b){var c,d,e=a(b),f=a.data(b,g);
e.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),"input"===c?(b.disabled=!1,f.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===c||"span"===c)&&(d=e.children("."+this._inlineClass),d.children().removeClass("ui-state-disabled"),d.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=a.map(this._disabledInputs,function(a){return a===b?null:a}))},_disableDatepicker:function(b){var c,d,e=a(b),f=a.data(b,g);e.hasClass(this.markerClassName)&&(c=b.nodeName.toLowerCase(),"input"===c?(b.disabled=!0,f.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===c||"span"===c)&&(d=e.children("."+this._inlineClass),d.children().addClass("ui-state-disabled"),d.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=a.map(this._disabledInputs,function(a){return a===b?null:a}),this._disabledInputs[this._disabledInputs.length]=b)},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]===a)return!0;return!1},_getInst:function(b){try{return a.data(b,g)}catch(c){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(c,d,f){var g,h,i,j,k=this._getInst(c);return 2===arguments.length&&"string"==typeof d?"defaults"===d?a.extend({},a.datepicker._defaults):k?"all"===d?a.extend({},k.settings):this._get(k,d):null:(g=d||{},"string"==typeof d&&(g={},g[d]=f),void(k&&(this._curInst===k&&this._hideDatepicker(),h=this._getDateDatepicker(c,!0),i=this._getMinMaxDate(k,"min"),j=this._getMinMaxDate(k,"max"),e(k.settings,g),null!==i&&g.dateFormat!==b&&g.minDate===b&&(k.settings.minDate=this._formatDate(k,i)),null!==j&&g.dateFormat!==b&&g.maxDate===b&&(k.settings.maxDate=this._formatDate(k,j)),"disabled"in g&&(g.disabled?this._disableDatepicker(c):this._enableDatepicker(c)),this._attachments(a(c),k),this._autoSize(k),this._setDate(k,h),this._updateAlternate(k),this._updateDatepicker(k))))},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){var b=this._getInst(a);b&&this._updateDatepicker(b)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);return c&&!c.inline&&this._setDateFromField(c,b),c?this._getDate(c):null},_doKeyDown:function(b){var c,d,e,f=a.datepicker._getInst(b.target),g=!0,h=f.dpDiv.is(".ui-datepicker-rtl");if(f._keyEvent=!0,a.datepicker._datepickerShowing)switch(b.keyCode){case 9:a.datepicker._hideDatepicker(),g=!1;break;case 13:return e=a("td."+a.datepicker._dayOverClass+":not(."+a.datepicker._currentClass+")",f.dpDiv),e[0]&&a.datepicker._selectDay(b.target,f.selectedMonth,f.selectedYear,e[0]),c=a.datepicker._get(f,"onSelect"),c?(d=a.datepicker._formatDate(f),c.apply(f.input?f.input[0]:null,[d,f])):a.datepicker._hideDatepicker(),!1;case 27:a.datepicker._hideDatepicker();break;case 33:a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 34:a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 35:(b.ctrlKey||b.metaKey)&&a.datepicker._clearDate(b.target),g=b.ctrlKey||b.metaKey;break;case 36:(b.ctrlKey||b.metaKey)&&a.datepicker._gotoToday(b.target),g=b.ctrlKey||b.metaKey;break;case 37:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,h?1:-1,"D"),g=b.ctrlKey||b.metaKey,b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(f,"stepBigMonths"):-a.datepicker._get(f,"stepMonths"),"M");break;case 38:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,-7,"D"),g=b.ctrlKey||b.metaKey;break;case 39:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,h?-1:1,"D"),g=b.ctrlKey||b.metaKey,b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?+a.datepicker._get(f,"stepBigMonths"):+a.datepicker._get(f,"stepMonths"),"M");break;case 40:(b.ctrlKey||b.metaKey)&&a.datepicker._adjustDate(b.target,7,"D"),g=b.ctrlKey||b.metaKey;break;default:g=!1}else 36===b.keyCode&&b.ctrlKey?a.datepicker._showDatepicker(this):g=!1;g&&(b.preventDefault(),b.stopPropagation())},_doKeyPress:function(b){var c,d,e=a.datepicker._getInst(b.target);return a.datepicker._get(e,"constrainInput")?(c=a.datepicker._possibleChars(a.datepicker._get(e,"dateFormat")),d=String.fromCharCode(null==b.charCode?b.keyCode:b.charCode),b.ctrlKey||b.metaKey||" ">d||!c||c.indexOf(d)>-1):void 0},_doKeyUp:function(b){var c,d=a.datepicker._getInst(b.target);if(d.input.val()!==d.lastVal)try{c=a.datepicker.parseDate(a.datepicker._get(d,"dateFormat"),d.input?d.input.val():null,a.datepicker._getFormatConfig(d)),c&&(a.datepicker._setDateFromField(d),a.datepicker._updateAlternate(d),a.datepicker._updateDatepicker(d))}catch(e){}return!0},_showDatepicker:function(b){if(b=b.target||b,"input"!==b.nodeName.toLowerCase()&&(b=a("input",b.parentNode)[0]),!a.datepicker._isDisabledDatepicker(b)&&a.datepicker._lastInput!==b){var c,d,f,g,h,i,j;c=a.datepicker._getInst(b),a.datepicker._curInst&&a.datepicker._curInst!==c&&(a.datepicker._curInst.dpDiv.stop(!0,!0),c&&a.datepicker._datepickerShowing&&a.datepicker._hideDatepicker(a.datepicker._curInst.input[0])),d=a.datepicker._get(c,"beforeShow"),f=d?d.apply(b,[b,c]):{},f!==!1&&(e(c.settings,f),c.lastVal=null,a.datepicker._lastInput=b,a.datepicker._setDateFromField(c),a.datepicker._inDialog&&(b.value=""),a.datepicker._pos||(a.datepicker._pos=a.datepicker._findPos(b),a.datepicker._pos[1]+=b.offsetHeight),g=!1,a(b).parents().each(function(){return g|="fixed"===a(this).css("position"),!g}),h={left:a.datepicker._pos[0],top:a.datepicker._pos[1]},a.datepicker._pos=null,c.dpDiv.empty(),c.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),a.datepicker._updateDatepicker(c),h=a.datepicker._checkOffset(c,h,g),c.dpDiv.css({position:a.datepicker._inDialog&&a.blockUI?"static":g?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),c.inline||(i=a.datepicker._get(c,"showAnim"),j=a.datepicker._get(c,"duration"),c.dpDiv.zIndex(a(b).zIndex()+1),a.datepicker._datepickerShowing=!0,a.effects&&a.effects.effect[i]?c.dpDiv.show(i,a.datepicker._get(c,"showOptions"),j):c.dpDiv[i||"show"](i?j:null),a.datepicker._shouldFocusInput(c)&&c.input.focus(),a.datepicker._curInst=c))}},_updateDatepicker:function(b){this.maxRows=4,f=b,b.dpDiv.empty().append(this._generateHTML(b)),this._attachHandlers(b),b.dpDiv.find("."+this._dayOverClass+" a").mouseover();var c,d=this._getNumberOfMonths(b),e=d[1],g=17;b.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),e>1&&b.dpDiv.addClass("ui-datepicker-multi-"+e).css("width",g*e+"em"),b.dpDiv[(1!==d[0]||1!==d[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),b.dpDiv[(this._get(b,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),b===a.datepicker._curInst&&a.datepicker._datepickerShowing&&a.datepicker._shouldFocusInput(b)&&b.input.focus(),b.yearshtml&&(c=b.yearshtml,setTimeout(function(){c===b.yearshtml&&b.yearshtml&&b.dpDiv.find("select.ui-datepicker-year:first").replaceWith(b.yearshtml),c=b.yearshtml=null},0))},_shouldFocusInput:function(a){return a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&!a.input.is(":focus")},_checkOffset:function(b,c,d){var e=b.dpDiv.outerWidth(),f=b.dpDiv.outerHeight(),g=b.input?b.input.outerWidth():0,h=b.input?b.input.outerHeight():0,i=document.documentElement.clientWidth+(d?0:a(document).scrollLeft()),j=document.documentElement.clientHeight+(d?0:a(document).scrollTop());return c.left-=this._get(b,"isRTL")?e-g:0,c.left-=d&&c.left===b.input.offset().left?a(document).scrollLeft():0,c.top-=d&&c.top===b.input.offset().top+h?a(document).scrollTop():0,c.left-=Math.min(c.left,c.left+e>i&&i>e?Math.abs(c.left+e-i):0),c.top-=Math.min(c.top,c.top+f>j&&j>f?Math.abs(f+h):0),c},_findPos:function(b){for(var c,d=this._getInst(b),e=this._get(d,"isRTL");b&&("hidden"===b.type||1!==b.nodeType||a.expr.filters.hidden(b));)b=b[e?"previousSibling":"nextSibling"];return c=a(b).offset(),[c.left,c.top]},_hideDatepicker:function(b){var c,d,e,f,h=this._curInst;!h||b&&h!==a.data(b,g)||this._datepickerShowing&&(c=this._get(h,"showAnim"),d=this._get(h,"duration"),e=function(){a.datepicker._tidyDialog(h)},a.effects&&(a.effects.effect[c]||a.effects[c])?h.dpDiv.hide(c,a.datepicker._get(h,"showOptions"),d,e):h.dpDiv["slideDown"===c?"slideUp":"fadeIn"===c?"fadeOut":"hide"](c?d:null,e),c||e(),this._datepickerShowing=!1,f=this._get(h,"onClose"),f&&f.apply(h.input?h.input[0]:null,[h.input?h.input.val():"",h]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),a.blockUI&&(a.unblockUI(),a("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(b){if(a.datepicker._curInst){var c=a(b.target),d=a.datepicker._getInst(c[0]);(c[0].id!==a.datepicker._mainDivId&&0===c.parents("#"+a.datepicker._mainDivId).length&&!c.hasClass(a.datepicker.markerClassName)&&!c.closest("."+a.datepicker._triggerClass).length&&a.datepicker._datepickerShowing&&(!a.datepicker._inDialog||!a.blockUI)||c.hasClass(a.datepicker.markerClassName)&&a.datepicker._curInst!==d)&&a.datepicker._hideDatepicker()}},_adjustDate:function(b,c,d){var e=a(b),f=this._getInst(e[0]);this._isDisabledDatepicker(e[0])||(this._adjustInstDate(f,c+("M"===d?this._get(f,"showCurrentAtPos"):0),d),this._updateDatepicker(f))},_gotoToday:function(b){var c,d=a(b),e=this._getInst(d[0]);this._get(e,"gotoCurrent")&&e.currentDay?(e.selectedDay=e.currentDay,e.drawMonth=e.selectedMonth=e.currentMonth,e.drawYear=e.selectedYear=e.currentYear):(c=new Date,e.selectedDay=c.getDate(),e.drawMonth=e.selectedMonth=c.getMonth(),e.drawYear=e.selectedYear=c.getFullYear()),this._notifyChange(e),this._adjustDate(d)},_selectMonthYear:function(b,c,d){var e=a(b),f=this._getInst(e[0]);f["selected"+("M"===d?"Month":"Year")]=f["draw"+("M"===d?"Month":"Year")]=parseInt(c.options[c.selectedIndex].value,10),this._notifyChange(f),this._adjustDate(e)},_selectDay:function(b,c,d,e){var f,g=a(b);a(e).hasClass(this._unselectableClass)||this._isDisabledDatepicker(g[0])||(f=this._getInst(g[0]),f.selectedDay=f.currentDay=a("a",e).html(),f.selectedMonth=f.currentMonth=c,f.selectedYear=f.currentYear=d,this._selectDate(b,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear)))},_clearDate:function(b){var c=a(b);this._selectDate(c,"")},_selectDate:function(b,c){var d,e=a(b),f=this._getInst(e[0]);c=null!=c?c:this._formatDate(f),f.input&&f.input.val(c),this._updateAlternate(f),d=this._get(f,"onSelect"),d?d.apply(f.input?f.input[0]:null,[c,f]):f.input&&f.input.trigger("change"),f.inline?this._updateDatepicker(f):(this._hideDatepicker(),this._lastInput=f.input[0],"object"!=typeof f.input[0]&&f.input.focus(),this._lastInput=null)},_updateAlternate:function(b){var c,d,e,f=this._get(b,"altField");f&&(c=this._get(b,"altFormat")||this._get(b,"dateFormat"),d=this._getDate(b),e=this.formatDate(c,d,this._getFormatConfig(b)),a(f).each(function(){a(this).val(e)}))},noWeekends:function(a){var b=a.getDay();return[b>0&&6>b,""]},iso8601Week:function(a){var b,c=new Date(a.getTime());return c.setDate(c.getDate()+4-(c.getDay()||7)),b=c.getTime(),c.setMonth(0),c.setDate(1),Math.floor(Math.round((b-c)/864e5)/7)+1},parseDate:function(b,c,d){if(null==b||null==c)throw"Invalid arguments";if(c="object"==typeof c?c.toString():c+"",""===c)return null;var e,f,g,h,i=0,j=(d?d.shortYearCutoff:null)||this._defaults.shortYearCutoff,k="string"!=typeof j?j:(new Date).getFullYear()%100+parseInt(j,10),l=(d?d.dayNamesShort:null)||this._defaults.dayNamesShort,m=(d?d.dayNames:null)||this._defaults.dayNames,n=(d?d.monthNamesShort:null)||this._defaults.monthNamesShort,o=(d?d.monthNames:null)||this._defaults.monthNames,p=-1,q=-1,r=-1,s=-1,t=!1,u=function(a){var c=e+1<b.length&&b.charAt(e+1)===a;return c&&e++,c},v=function(a){var b=u(a),d="@"===a?14:"!"===a?20:"y"===a&&b?4:"o"===a?3:2,e=new RegExp("^\\d{1,"+d+"}"),f=c.substring(i).match(e);if(!f)throw"Missing number at position "+i;return i+=f[0].length,parseInt(f[0],10)},w=function(b,d,e){var f=-1,g=a.map(u(b)?e:d,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)});if(a.each(g,function(a,b){var d=b[1];return c.substr(i,d.length).toLowerCase()===d.toLowerCase()?(f=b[0],i+=d.length,!1):void 0}),-1!==f)return f+1;throw"Unknown name at position "+i},x=function(){if(c.charAt(i)!==b.charAt(e))throw"Unexpected literal at position "+i;i++};for(e=0;e<b.length;e++)if(t)"'"!==b.charAt(e)||u("'")?x():t=!1;else switch(b.charAt(e)){case"d":r=v("d");break;case"D":w("D",l,m);break;case"o":s=v("o");break;case"m":q=v("m");break;case"M":q=w("M",n,o);break;case"y":p=v("y");break;case"@":h=new Date(v("@")),p=h.getFullYear(),q=h.getMonth()+1,r=h.getDate();break;case"!":h=new Date((v("!")-this._ticksTo1970)/1e4),p=h.getFullYear(),q=h.getMonth()+1,r=h.getDate();break;case"'":u("'")?x():t=!0;break;default:x()}if(i<c.length&&(g=c.substr(i),!/^\s+/.test(g)))throw"Extra/unparsed characters found in date: "+g;if(-1===p?p=(new Date).getFullYear():100>p&&(p+=(new Date).getFullYear()-(new Date).getFullYear()%100+(k>=p?0:-100)),s>-1)for(q=1,r=s;;){if(f=this._getDaysInMonth(p,q-1),f>=r)break;q++,r-=f}if(h=this._daylightSavingAdjust(new Date(p,q-1,r)),h.getFullYear()!==p||h.getMonth()+1!==q||h.getDate()!==r)throw"Invalid date";return h},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(a,b,c){if(!b)return"";var d,e=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,g=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,h=(c?c.monthNames:null)||this._defaults.monthNames,i=function(b){var c=d+1<a.length&&a.charAt(d+1)===b;return c&&d++,c},j=function(a,b,c){var d=""+b;if(i(a))for(;d.length<c;)d="0"+d;return d},k=function(a,b,c,d){return i(a)?d[b]:c[b]},l="",m=!1;if(b)for(d=0;d<a.length;d++)if(m)"'"!==a.charAt(d)||i("'")?l+=a.charAt(d):m=!1;else switch(a.charAt(d)){case"d":l+=j("d",b.getDate(),2);break;case"D":l+=k("D",b.getDay(),e,f);break;case"o":l+=j("o",Math.round((new Date(b.getFullYear(),b.getMonth(),b.getDate()).getTime()-new Date(b.getFullYear(),0,0).getTime())/864e5),3);break;case"m":l+=j("m",b.getMonth()+1,2);break;case"M":l+=k("M",b.getMonth(),g,h);break;case"y":l+=i("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case"@":l+=b.getTime();break;case"!":l+=1e4*b.getTime()+this._ticksTo1970;break;case"'":i("'")?l+="'":m=!0;break;default:l+=a.charAt(d)}return l},_possibleChars:function(a){var b,c="",d=!1,e=function(c){var d=b+1<a.length&&a.charAt(b+1)===c;return d&&b++,d};for(b=0;b<a.length;b++)if(d)"'"!==a.charAt(b)||e("'")?c+=a.charAt(b):d=!1;else switch(a.charAt(b)){case"d":case"m":case"y":case"@":c+="0123456789";break;case"D":case"M":return null;case"'":e("'")?c+="'":d=!0;break;default:c+=a.charAt(b)}return c},_get:function(a,c){return a.settings[c]!==b?a.settings[c]:this._defaults[c]},_setDateFromField:function(a,b){if(a.input.val()!==a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,e=this._getDefaultDate(a),f=e,g=this._getFormatConfig(a);try{f=this.parseDate(c,d,g)||e}catch(h){d=b?"":d}a.selectedDay=f.getDate(),a.drawMonth=a.selectedMonth=f.getMonth(),a.drawYear=a.selectedYear=f.getFullYear(),a.currentDay=d?f.getDate():0,a.currentMonth=d?f.getMonth():0,a.currentYear=d?f.getFullYear():0,this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(b,c,d){var e=function(a){var b=new Date;return b.setDate(b.getDate()+a),b},f=function(c){try{return a.datepicker.parseDate(a.datepicker._get(b,"dateFormat"),c,a.datepicker._getFormatConfig(b))}catch(d){}for(var e=(c.toLowerCase().match(/^c/)?a.datepicker._getDate(b):null)||new Date,f=e.getFullYear(),g=e.getMonth(),h=e.getDate(),i=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,j=i.exec(c);j;){switch(j[2]||"d"){case"d":case"D":h+=parseInt(j[1],10);break;case"w":case"W":h+=7*parseInt(j[1],10);break;case"m":case"M":g+=parseInt(j[1],10),h=Math.min(h,a.datepicker._getDaysInMonth(f,g));break;case"y":case"Y":f+=parseInt(j[1],10),h=Math.min(h,a.datepicker._getDaysInMonth(f,g))}j=i.exec(c)}return new Date(f,g,h)},g=null==c||""===c?d:"string"==typeof c?f(c):"number"==typeof c?isNaN(c)?d:e(c):new Date(c.getTime());return g=g&&"Invalid Date"===g.toString()?d:g,g&&(g.setHours(0),g.setMinutes(0),g.setSeconds(0),g.setMilliseconds(0)),this._daylightSavingAdjust(g)},_daylightSavingAdjust:function(a){return a?(a.setHours(a.getHours()>12?a.getHours()+2:0),a):null},_setDate:function(a,b,c){var d=!b,e=a.selectedMonth,f=a.selectedYear,g=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=g.getDate(),a.drawMonth=a.selectedMonth=a.currentMonth=g.getMonth(),a.drawYear=a.selectedYear=a.currentYear=g.getFullYear(),e===a.selectedMonth&&f===a.selectedYear||c||this._notifyChange(a),this._adjustInstDate(a),a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){var b=!a.currentYear||a.input&&""===a.input.val()?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return b},_attachHandlers:function(b){var c=this._get(b,"stepMonths"),d="#"+b.id.replace(/\\\\/g,"\\");b.dpDiv.find("[data-handler]").map(function(){var b={prev:function(){a.datepicker._adjustDate(d,-c,"M")},next:function(){a.datepicker._adjustDate(d,+c,"M")},hide:function(){a.datepicker._hideDatepicker()},today:function(){a.datepicker._gotoToday(d)},selectDay:function(){return a.datepicker._selectDay(d,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return a.datepicker._selectMonthYear(d,this,"M"),!1},selectYear:function(){return a.datepicker._selectMonthYear(d,this,"Y"),!1}};a(this).bind(this.getAttribute("data-event"),b[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=new Date,P=this._daylightSavingAdjust(new Date(O.getFullYear(),O.getMonth(),O.getDate())),Q=this._get(a,"isRTL"),R=this._get(a,"showButtonPanel"),S=this._get(a,"hideIfNoPrevNext"),T=this._get(a,"navigationAsDateFormat"),U=this._getNumberOfMonths(a),V=this._get(a,"showCurrentAtPos"),W=this._get(a,"stepMonths"),X=1!==U[0]||1!==U[1],Y=this._daylightSavingAdjust(a.currentDay?new Date(a.currentYear,a.currentMonth,a.currentDay):new Date(9999,9,9)),Z=this._getMinMaxDate(a,"min"),$=this._getMinMaxDate(a,"max"),_=a.drawMonth-V,ab=a.drawYear;if(0>_&&(_+=12,ab--),$)for(b=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-U[0]*U[1]+1,$.getDate())),b=Z&&Z>b?Z:b;this._daylightSavingAdjust(new Date(ab,_,1))>b;)_--,0>_&&(_=11,ab--);for(a.drawMonth=_,a.drawYear=ab,c=this._get(a,"prevText"),c=T?this.formatDate(c,this._daylightSavingAdjust(new Date(ab,_-W,1)),this._getFormatConfig(a)):c,d=this._canAdjustMonth(a,-1,ab,_)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+c+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"e":"w")+"'>"+c+"</span></a>":S?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+c+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"e":"w")+"'>"+c+"</span></a>",e=this._get(a,"nextText"),e=T?this.formatDate(e,this._daylightSavingAdjust(new Date(ab,_+W,1)),this._getFormatConfig(a)):e,f=this._canAdjustMonth(a,1,ab,_)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+e+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"w":"e")+"'>"+e+"</span></a>":S?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+e+"'><span class='ui-icon ui-icon-circle-triangle-"+(Q?"w":"e")+"'>"+e+"</span></a>",g=this._get(a,"currentText"),h=this._get(a,"gotoCurrent")&&a.currentDay?Y:P,g=T?this.formatDate(g,h,this._getFormatConfig(a)):g,i=a.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(a,"closeText")+"</button>",j=R?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Q?i:"")+(this._isInRange(a,h)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+g+"</button>":"")+(Q?"":i)+"</div>":"",k=parseInt(this._get(a,"firstDay"),10),k=isNaN(k)?0:k,l=this._get(a,"showWeek"),m=this._get(a,"dayNames"),n=this._get(a,"dayNamesMin"),o=this._get(a,"monthNames"),p=this._get(a,"monthNamesShort"),q=this._get(a,"beforeShowDay"),r=this._get(a,"showOtherMonths"),s=this._get(a,"selectOtherMonths"),t=this._getDefaultDate(a),u="",w=0;w<U[0];w++){for(x="",this.maxRows=4,y=0;y<U[1];y++){if(z=this._daylightSavingAdjust(new Date(ab,_,a.selectedDay)),A=" ui-corner-all",B="",X){if(B+="<div class='ui-datepicker-group",U[1]>1)switch(y){case 0:B+=" ui-datepicker-group-first",A=" ui-corner-"+(Q?"right":"left");break;case U[1]-1:B+=" ui-datepicker-group-last",A=" ui-corner-"+(Q?"left":"right");break;default:B+=" ui-datepicker-group-middle",A=""}B+="'>"}for(B+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+A+"'>"+(/all|left/.test(A)&&0===w?Q?f:d:"")+(/all|right/.test(A)&&0===w?Q?d:f:"")+this._generateMonthYearHeader(a,_,ab,Z,$,w>0||y>0,o,p)+"</div><table class='ui-datepicker-calendar'><thead><tr>",C=l?"<th class='ui-datepicker-week-col'>"+this._get(a,"weekHeader")+"</th>":"",v=0;7>v;v++)D=(v+k)%7,C+="<th"+((v+k+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+m[D]+"'>"+n[D]+"</span></th>";for(B+=C+"</tr></thead><tbody>",E=this._getDaysInMonth(ab,_),ab===a.selectedYear&&_===a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,E)),F=(this._getFirstDayOfMonth(ab,_)-k+7)%7,G=Math.ceil((F+E)/7),H=X&&this.maxRows>G?this.maxRows:G,this.maxRows=H,I=this._daylightSavingAdjust(new Date(ab,_,1-F)),J=0;H>J;J++){for(B+="<tr>",K=l?"<td class='ui-datepicker-week-col'>"+this._get(a,"calculateWeek")(I)+"</td>":"",v=0;7>v;v++)L=q?q.apply(a.input?a.input[0]:null,[I]):[!0,""],M=I.getMonth()!==_,N=M&&!s||!L[0]||Z&&Z>I||$&&I>$,K+="<td class='"+((v+k+6)%7>=5?" ui-datepicker-week-end":"")+(M?" ui-datepicker-other-month":"")+(I.getTime()===z.getTime()&&_===a.selectedMonth&&a._keyEvent||t.getTime()===I.getTime()&&t.getTime()===z.getTime()?" "+this._dayOverClass:"")+(N?" "+this._unselectableClass+" ui-state-disabled":"")+(M&&!r?"":" "+L[1]+(I.getTime()===Y.getTime()?" "+this._currentClass:"")+(I.getTime()===P.getTime()?" ui-datepicker-today":""))+"'"+(M&&!r||!L[2]?"":" title='"+L[2].replace(/'/g,"&#39;")+"'")+(N?"":" data-handler='selectDay' data-event='click' data-month='"+I.getMonth()+"' data-year='"+I.getFullYear()+"'")+">"+(M&&!r?"&#xa0;":N?"<span class='ui-state-default'>"+I.getDate()+"</span>":"<a class='ui-state-default"+(I.getTime()===P.getTime()?" ui-state-highlight":"")+(I.getTime()===Y.getTime()?" ui-state-active":"")+(M?" ui-priority-secondary":"")+"' href='#'>"+I.getDate()+"</a>")+"</td>",I.setDate(I.getDate()+1),I=this._daylightSavingAdjust(I);B+=K+"</tr>"}_++,_>11&&(_=0,ab++),B+="</tbody></table>"+(X?"</div>"+(U[0]>0&&y===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=B}u+=x}return u+=j,a._keyEvent=!1,u},_generateMonthYearHeader:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q=this._get(a,"changeMonth"),r=this._get(a,"changeYear"),s=this._get(a,"showMonthAfterYear"),t="<div class='ui-datepicker-title'>",u="";if(f||!q)u+="<span class='ui-datepicker-month'>"+g[b]+"</span>";else{for(i=d&&d.getFullYear()===c,j=e&&e.getFullYear()===c,u+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",k=0;12>k;k++)(!i||k>=d.getMonth())&&(!j||k<=e.getMonth())&&(u+="<option value='"+k+"'"+(k===b?" selected='selected'":"")+">"+h[k]+"</option>");u+="</select>"}if(s||(t+=u+(!f&&q&&r?"":"&#xa0;")),!a.yearshtml)if(a.yearshtml="",f||!r)t+="<span class='ui-datepicker-year'>"+c+"</span>";else{for(l=this._get(a,"yearRange").split(":"),m=(new Date).getFullYear(),n=function(a){var b=a.match(/c[+\-].*/)?c+parseInt(a.substring(1),10):a.match(/[+\-].*/)?m+parseInt(a,10):parseInt(a,10);return isNaN(b)?m:b},o=n(l[0]),p=Math.max(o,n(l[1]||"")),o=d?Math.max(o,d.getFullYear()):o,p=e?Math.min(p,e.getFullYear()):p,a.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";p>=o;o++)a.yearshtml+="<option value='"+o+"'"+(o===c?" selected='selected'":"")+">"+o+"</option>";a.yearshtml+="</select>",t+=a.yearshtml,a.yearshtml=null}return t+=this._get(a,"yearSuffix"),s&&(t+=(!f&&q&&r?"":"&#xa0;")+u),t+="</div>"},_adjustInstDate:function(a,b,c){var d=a.drawYear+("Y"===c?b:0),e=a.drawMonth+("M"===c?b:0),f=Math.min(a.selectedDay,this._getDaysInMonth(d,e))+("D"===c?b:0),g=this._restrictMinMax(a,this._daylightSavingAdjust(new Date(d,e,f)));a.selectedDay=g.getDate(),a.drawMonth=a.selectedMonth=g.getMonth(),a.drawYear=a.selectedYear=g.getFullYear(),("M"===c||"Y"===c)&&this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),e=c&&c>b?c:b;return d&&e>d?d:e},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){var b=this._get(a,"numberOfMonths");return null==b?[1,1]:"number"==typeof b?[1,b]:b},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return new Date(a,b,1).getDay()},_canAdjustMonth:function(a,b,c,d){var e=this._getNumberOfMonths(a),f=this._daylightSavingAdjust(new Date(c,d+(0>b?b:e[0]*e[1]),1));return 0>b&&f.setDate(this._getDaysInMonth(f.getFullYear(),f.getMonth())),this._isInRange(a,f)},_isInRange:function(a,b){var c,d,e=this._getMinMaxDate(a,"min"),f=this._getMinMaxDate(a,"max"),g=null,h=null,i=this._get(a,"yearRange");return i&&(c=i.split(":"),d=(new Date).getFullYear(),g=parseInt(c[0],10),h=parseInt(c[1],10),c[0].match(/[+\-].*/)&&(g+=d),c[1].match(/[+\-].*/)&&(h+=d)),(!e||b.getTime()>=e.getTime())&&(!f||b.getTime()<=f.getTime())&&(!g||b.getFullYear()>=g)&&(!h||b.getFullYear()<=h)},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff");return b="string"!=typeof b?b:(new Date).getFullYear()%100+parseInt(b,10),{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);var e=b?"object"==typeof b?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),e,this._getFormatConfig(a))}}),a.fn.datepicker=function(b){if(!this.length)return this;a.datepicker.initialized||(a(document).mousedown(a.datepicker._checkExternalClick),a.datepicker.initialized=!0),0===a("#"+a.datepicker._mainDivId).length&&a("body").append(a.datepicker.dpDiv);var c=Array.prototype.slice.call(arguments,1);return"string"!=typeof b||"isDisabled"!==b&&"getDate"!==b&&"widget"!==b?"option"===b&&2===arguments.length&&"string"==typeof arguments[1]?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(c)):this.each(function(){"string"==typeof b?a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this].concat(c)):a.datepicker._attachDatepicker(this,b)}):a.datepicker["_"+b+"Datepicker"].apply(a.datepicker,[this[0]].concat(c))},a.datepicker=new c,a.datepicker.initialized=!1,a.datepicker.uuid=(new Date).getTime(),a.datepicker.version="1.10.3"}(jQuery),function(a){var b={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},c={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("ui.dialog",{version:"1.10.3",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(b){var c=a(this).css(b).offset().top;0>c&&a(this).css("top",b.top-c)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&a.fn.draggable&&this._makeDraggable(),this.options.resizable&&a.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var b=this.options.appendTo;return b&&(b.jquery||b.nodeType)?a(b):this.document.find(b||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),a=b.parent.children().eq(b.index),a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,close:function(b){var c=this;this._isOpen&&this._trigger("beforeClose",b)!==!1&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||a(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){c._trigger("close",b)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(a,b){var c=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return c&&!b&&this._trigger("focus",a),c},open:function(){var b=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=a(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable(),b._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var a=this.element.find("[autofocus]");a.length||(a=this.element.find(":tabbable")),a.length||(a=this.uiDialogButtonPane.find(":tabbable")),a.length||(a=this.uiDialogTitlebarClose.filter(":tabbable")),a.length||(a=this.uiDialog),a.eq(0).focus()},_keepFocus:function(b){function c(){var b=this.document[0].activeElement,c=this.uiDialog[0]===b||a.contains(this.uiDialog[0],b);c||this._focusTabbable()}b.preventDefault(),c.call(this),this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)return b.preventDefault(),void this.close(b);
if(b.keyCode===a.ui.keyCode.TAB){var c=this.uiDialog.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==this.uiDialog[0]||b.shiftKey?b.target!==d[0]&&b.target!==this.uiDialog[0]||!b.shiftKey||(e.focus(1),b.preventDefault()):(d.focus(1),b.preventDefault())}},mousedown:function(a){this._moveToTop(a)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var b;this.uiDialogTitlebar=a("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=a("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(a){a.preventDefault(),this.close(a)}}),b=a("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(b),this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title||a.html("&#160;"),a.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=a("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),a.isEmptyObject(c)||a.isArray(c)&&!c.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(a.each(c,function(c,d){var e,f;d=a.isFunction(d)?{click:d,text:c}:d,d=a.extend({type:"button"},d),e=d.click,d.click=function(){e.apply(b.element[0],arguments)},f={icons:d.icons,text:d.showText},delete d.icons,delete d.showText,a("<button></button>",d).button(f).appendTo(b.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,e){a(this).addClass("ui-dialog-dragging"),c._blockFrames(),c._trigger("dragStart",d,b(e))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(e,f){d.position=[f.position.left-c.document.scrollLeft(),f.position.top-c.document.scrollTop()],a(this).removeClass("ui-dialog-dragging"),c._unblockFrames(),c._trigger("dragStop",e,b(f))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,d=this.options,e=d.resizable,f=this.uiDialog.css("position"),g="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:this._minHeight(),handles:g,start:function(d,e){a(this).addClass("ui-dialog-resizing"),c._blockFrames(),c._trigger("resizeStart",d,b(e))},resize:function(a,d){c._trigger("resize",a,b(d))},stop:function(e,f){d.height=a(this).height(),d.width=a(this).width(),a(this).removeClass("ui-dialog-resizing"),c._unblockFrames(),c._trigger("resizeStop",e,b(f))}}).css("position",f)},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=this.uiDialog.is(":visible");a||this.uiDialog.show(),this.uiDialog.position(this.options.position),a||this.uiDialog.hide()},_setOptions:function(d){var e=this,f=!1,g={};a.each(d,function(a,d){e._setOption(a,d),a in b&&(f=!0),a in c&&(g[a]=d)}),f&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(a,b){var c,d,e=this.uiDialog;"dialogClass"===a&&e.removeClass(this.options.dialogClass).addClass(b),"disabled"!==a&&(this._super(a,b),"appendTo"===a&&this.uiDialog.appendTo(this._appendTo()),"buttons"===a&&this._createButtons(),"closeText"===a&&this.uiDialogTitlebarClose.button({label:""+b}),"draggable"===a&&(c=e.is(":data(ui-draggable)"),c&&!b&&e.draggable("destroy"),!c&&b&&this._makeDraggable()),"position"===a&&this._position(),"resizable"===a&&(d=e.is(":data(ui-resizable)"),d&&!b&&e.resizable("destroy"),d&&"string"==typeof b&&e.resizable("option","handles",b),d||b===!1||this._makeResizable()),"title"===a&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var a,b,c,d=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),d.minWidth>d.width&&(d.width=d.minWidth),a=this.uiDialog.css({height:"auto",width:d.width}).outerHeight(),b=Math.max(0,d.minHeight-a),c="number"==typeof d.maxHeight?Math.max(0,d.maxHeight-a):"none","auto"===d.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,d.height-a)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(b){return a(b.target).closest(".ui-dialog").length?!0:!!a(b.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var b=this,c=this.widgetFullName;a.ui.dialog.overlayInstances||this._delay(function(){a.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(d){b._allowInteraction(d)||(d.preventDefault(),a(".ui-dialog:visible:last .ui-dialog-content").data(c)._focusTabbable())})}),this.overlay=a("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),a.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(a.ui.dialog.overlayInstances--,a.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),a.ui.dialog.overlayInstances=0,a.uiBackCompat!==!1&&a.widget("ui.dialog",a.ui.dialog,{_position:function(){var b,c=this.options.position,d=[],e=[0,0];c?(("string"==typeof c||"object"==typeof c&&"0"in c)&&(d=c.split?c.split(" "):[c[0],c[1]],1===d.length&&(d[1]=d[0]),a.each(["left","top"],function(a,b){+d[a]===d[a]&&(e[a]=d[a],d[a]=b)}),c={my:d[0]+(e[0]<0?e[0]:"+"+e[0])+" "+d[1]+(e[1]<0?e[1]:"+"+e[1]),at:d.join(" ")}),c=a.extend({},a.ui.dialog.prototype.options.position,c)):c=a.ui.dialog.prototype.options.position,b=this.uiDialog.is(":visible"),b||this.uiDialog.show(),this.uiDialog.position(c),b||this.uiDialog.hide()}})}(jQuery),function(a){a.widget("ui.menu",{version:"1.10.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,a.proxy(function(a){this.options.disabled&&a.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(a){a.preventDefault()},"click .ui-state-disabled > a":function(a){a.preventDefault()},"click .ui-menu-item:has(a)":function(b){var c=a(b.target).closest(".ui-menu-item");!this.mouseHandled&&c.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(b),c.has(".ui-menu").length?this.expand(b):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(b){var c=a(b.currentTarget);c.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(b,c)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var c=this.active||this.element.children(".ui-menu-item").eq(0);b||this.focus(a,c)},blur:function(b){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(b)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(b){a(b.target).closest(".ui-menu").length||this.collapseAll(b),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var b=a(this);b.data("ui-menu-submenu-carat")&&b.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(b){function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var d,e,f,g,h,i=!0;switch(b.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(b);break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(b);break;case a.ui.keyCode.HOME:this._move("first","first",b);break;case a.ui.keyCode.END:this._move("last","last",b);break;case a.ui.keyCode.UP:this.previous(b);break;case a.ui.keyCode.DOWN:this.next(b);break;case a.ui.keyCode.LEFT:this.collapse(b);break;case a.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(b);break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:this._activate(b);break;case a.ui.keyCode.ESCAPE:this.collapse(b);break;default:i=!1,e=this.previousFilter||"",f=String.fromCharCode(b.keyCode),g=!1,clearTimeout(this.filterTimer),f===e?g=!0:f=e+f,h=new RegExp("^"+c(f),"i"),d=this.activeMenu.children(".ui-menu-item").filter(function(){return h.test(a(this).children("a").text())}),d=g&&-1!==d.index(this.active.next())?this.active.nextAll(".ui-menu-item"):d,d.length||(f=String.fromCharCode(b.keyCode),h=new RegExp("^"+c(f),"i"),d=this.activeMenu.children(".ui-menu-item").filter(function(){return h.test(a(this).children("a").text())})),d.length?(this.focus(b,d),d.length>1?(this.previousFilter=f,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}i&&b.preventDefault()},_activate:function(a){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(a):this.select(a))},refresh:function(){var b,c=this.options.icons.submenu,d=this.element.find(this.options.menus);d.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var b=a(this),d=b.prev("a"),e=a("<span>").addClass("ui-menu-icon ui-icon "+c).data("ui-menu-submenu-carat",!0);d.attr("aria-haspopup","true").prepend(e),b.attr("aria-labelledby",d.attr("id"))}),b=d.add(this.element),b.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),b.children(":not(.ui-menu-item)").each(function(){var b=a(this);/[^\-\u2014\u2013\s]/.test(b.text())||b.addClass("ui-widget-content ui-menu-divider")}),b.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!a.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(a,b){"icons"===a&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(b.submenu),this._super(a,b)},focus:function(a,b){var c,d;this.blur(a,a&&"focus"===a.type),this._scrollIntoView(b),this.active=b.first(),d=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",d.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),c=b.children(".ui-menu"),c.length&&/^mouse/.test(a.type)&&this._startOpening(c),this.activeMenu=b.parent(),this._trigger("focus",a,{item:b})},_scrollIntoView:function(b){var c,d,e,f,g,h;this._hasScroll()&&(c=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,d=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,e=b.offset().top-this.activeMenu.offset().top-c-d,f=this.activeMenu.scrollTop(),g=this.activeMenu.height(),h=b.height(),0>e?this.activeMenu.scrollTop(f+e):e+h>g&&this.activeMenu.scrollTop(f+e-g+h))},blur:function(a,b){b||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",a,{item:this.active}))},_startOpening:function(a){clearTimeout(this.timer),"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(a)},this.delay))},_open:function(b){var c=a.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(b.parents(".ui-menu")).hide().attr("aria-hidden","true"),b.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(b,c){clearTimeout(this.timer),this.timer=this._delay(function(){var d=c?this.element:a(b&&b.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element),this._close(d),this.blur(b),this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element),a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){var d;this.active&&(d="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0)),d&&d.length&&this.active||(d=this.activeMenu.children(".ui-menu-item")[b]()),this.focus(c,d)},nextPage:function(b){var c,d,e;return this.active?void(this.isLastItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d-e<0}),this.focus(b,c)):this.focus(b,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(b)},previousPage:function(b){var c,d,e;return this.active?void(this.isFirstItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d+e>0}),this.focus(b,c)):this.focus(b,this.activeMenu.children(".ui-menu-item").first()))):void this.next(b)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(b){this.active=this.active||a(b.target).closest(".ui-menu-item");var c={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(b,!0),this._trigger("select",b,c)}})}(jQuery),function(a,b){a.widget("ui.progressbar",{version:"1.10.3",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(a){return a===b?this.options.value:(this.options.value=this._constrainedValue(a),void this._refreshValue())},_constrainedValue:function(a){return a===b&&(a=this.options.value),this.indeterminate=a===!1,"number"!=typeof a&&(a=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,a))},_setOptions:function(a){var b=a.value;delete a.value,this._super(a),this.options.value=this._constrainedValue(b),this._refreshValue()},_setOption:function(a,b){"max"===a&&(b=Math.max(this.min,b)),this._super(a,b)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var b=this.options.value,c=this._percentage();this.valueDiv.toggle(this.indeterminate||b>this.min).toggleClass("ui-corner-right",b===this.options.max).width(c.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=a("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":b}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==b&&(this.oldValue=b,this._trigger("change")),b===this.options.max&&this._trigger("complete")}})}(jQuery),function(a){var b=5;a.widget("ui.slider",a.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;c>b;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):this.range=a([])},_setupEvents:function(){var a=this.handles.add(this.range).filter("a");this._off(a),this._on(a,this._handleEvents),this._hoverable(a),this._focusable(a)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return l.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h===!1?!1:(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),0>d&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&d>c)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),void this._change(null,0)):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),void this._change(null,b);if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;e>d;d+=1)this._change(null,d);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=this._animateOff?!1:h.animate,k={};this.options.values&&this.options.values.length?this.handles.each(function(d){c=(i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())*100,k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?(d-e)/(f-e)*100:0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(c){var d,e,f,g,h=a(c.target).data("ui-slider-handle-index");switch(c.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(c.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(c.target).addClass("ui-state-active"),d=this._start(c,h),d===!1))return}switch(g=this.options.step,e=f=this.options.values&&this.options.values.length?this.values(h):this.value(),c.keyCode){case a.ui.keyCode.HOME:f=this._valueMin();break;case a.ui.keyCode.END:f=this._valueMax();break;case a.ui.keyCode.PAGE_UP:f=this._trimAlignValue(e+(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.PAGE_DOWN:f=this._trimAlignValue(e-(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(e===this._valueMax())return;f=this._trimAlignValue(e+g);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(e===this._valueMin())return;f=this._trimAlignValue(e-g)}this._slide(c,h,f)},click:function(a){a.preventDefault()},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}})}(jQuery),function(a){function b(a){return function(){var b=this.element.val();a.apply(this,arguments),this._refresh(),b!==this.element.val()&&this._trigger("change")}}a.widget("ui.spinner",{version:"1.10.3",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var b={},c=this.element;return a.each(["min","max","step"],function(a,d){var e=c.attr(d);void 0!==e&&e.length&&(b[d]=e)}),b},_events:{keydown:function(a){this._start(a)&&this._keydown(a)&&a.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(a){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",a)))},mousewheel:function(a,b){if(b){if(!this.spinning&&!this._start(a))return!1;this._spin((b>0?1:-1)*this.options.step,a),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(a)},100),a.preventDefault()}},"mousedown .ui-spinner-button":function(b){function c(){var a=this.element[0]===this.document[0].activeElement;a||(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d}))}var d;d=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),b.preventDefault(),c.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,c.call(this)}),this._start(b)!==!1&&this._repeat(null,a(b.currentTarget).hasClass("ui-spinner-up")?1:-1,b)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(b){return a(b.currentTarget).hasClass("ui-state-active")?this._start(b)===!1?!1:void this._repeat(null,a(b.currentTarget).hasClass("ui-spinner-up")?1:-1,b):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var a=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=a.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*a.height())&&a.height()>0&&a.height(a.height()),this.options.disabled&&this.disable()},_keydown:function(b){var c=this.options,d=a.ui.keyCode;switch(b.keyCode){case d.UP:return this._repeat(null,1,b),!0;case d.DOWN:return this._repeat(null,-1,b),!0;case d.PAGE_UP:return this._repeat(null,c.page,b),!0;case d.PAGE_DOWN:return this._repeat(null,-c.page,b),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(a){return this.spinning||this._trigger("start",a)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(a,b,c){a=a||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,b,c)
},a),this._spin(b*this.options.step,c)},_spin:function(a,b){var c=this.value()||0;this.counter||(this.counter=1),c=this._adjustValue(c+a*this._increment(this.counter)),this.spinning&&this._trigger("spin",b,{value:c})===!1||(this._value(c),this.counter++)},_increment:function(b){var c=this.options.incremental;return c?a.isFunction(c)?c(b):Math.floor(b*b*b/5e4-b*b/500+17*b/200+1):1},_precision:function(){var a=this._precisionOf(this.options.step);return null!==this.options.min&&(a=Math.max(a,this._precisionOf(this.options.min))),a},_precisionOf:function(a){var b=a.toString(),c=b.indexOf(".");return-1===c?0:b.length-c-1},_adjustValue:function(a){var b,c,d=this.options;return b=null!==d.min?d.min:0,c=a-b,c=Math.round(c/d.step)*d.step,a=b+c,a=parseFloat(a.toFixed(this._precision())),null!==d.max&&a>d.max?d.max:null!==d.min&&a<d.min?d.min:a},_stop:function(a){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",a))},_setOption:function(a,b){if("culture"===a||"numberFormat"===a){var c=this._parse(this.element.val());return this.options[a]=b,void this.element.val(this._format(c))}("max"===a||"min"===a||"step"===a)&&"string"==typeof b&&(b=this._parse(b)),"icons"===a&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(b.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(b.down)),this._super(a,b),"disabled"===a&&(b?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:b(function(a){this._super(a),this._value(this.element.val())}),_parse:function(a){return"string"==typeof a&&""!==a&&(a=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(a,10,this.options.culture):+a),""===a||isNaN(a)?null:a},_format:function(a){return""===a?"":window.Globalize&&this.options.numberFormat?Globalize.format(a,this.options.numberFormat,this.options.culture):a},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(a,b){var c;""!==a&&(c=this._parse(a),null!==c&&(b||(c=this._adjustValue(c)),a=this._format(c))),this.element.val(a),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:b(function(a){this._stepUp(a)}),_stepUp:function(a){this._start()&&(this._spin((a||1)*this.options.step),this._stop())},stepDown:b(function(a){this._stepDown(a)}),_stepDown:function(a){this._start()&&(this._spin((a||1)*-this.options.step),this._stop())},pageUp:b(function(a){this._stepUp((a||1)*this.options.page)}),pageDown:b(function(a){this._stepDown((a||1)*this.options.page)}),value:function(a){return arguments.length?void b(this._value).call(this,a):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(a,b){function c(){return++e}function d(a){return a.hash.length>1&&decodeURIComponent(a.href.replace(f,""))===decodeURIComponent(location.href.replace(f,""))}var e=0,f=/#.*$/;a.widget("ui.tabs",{version:"1.10.3",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var b=this,c=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",c.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(b){a(this).is(".ui-state-disabled")&&b.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){a(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),c.active=this._initialActive(),a.isArray(c.disabled)&&(c.disabled=a.unique(c.disabled.concat(a.map(this.tabs.filter(".ui-state-disabled"),function(a){return b.tabs.index(a)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(c.active):a(),this._refresh(),this.active.length&&this.load(c.active)},_initialActive:function(){var b=this.options.active,c=this.options.collapsible,d=location.hash.substring(1);return null===b&&(d&&this.tabs.each(function(c,e){return a(e).attr("aria-controls")===d?(b=c,!1):void 0}),null===b&&(b=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===b||-1===b)&&(b=this.tabs.length?0:!1)),b!==!1&&(b=this.tabs.index(this.tabs.eq(b)),-1===b&&(b=c?!1:0)),!c&&b===!1&&this.anchors.length&&(b=0),b},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):a()}},_tabKeydown:function(b){var c=a(this.document[0].activeElement).closest("li"),d=this.tabs.index(c),e=!0;if(!this._handlePageNav(b)){switch(b.keyCode){case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:d++;break;case a.ui.keyCode.UP:case a.ui.keyCode.LEFT:e=!1,d--;break;case a.ui.keyCode.END:d=this.anchors.length-1;break;case a.ui.keyCode.HOME:d=0;break;case a.ui.keyCode.SPACE:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d);case a.ui.keyCode.ENTER:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d===this.options.active?!1:d);default:return}b.preventDefault(),clearTimeout(this.activating),d=this._focusNextTab(d,e),b.ctrlKey||(c.attr("aria-selected","false"),this.tabs.eq(d).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",d)},this.delay))}},_panelKeydown:function(b){this._handlePageNav(b)||b.ctrlKey&&b.keyCode===a.ui.keyCode.UP&&(b.preventDefault(),this.active.focus())},_handlePageNav:function(b){return b.altKey&&b.keyCode===a.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):b.altKey&&b.keyCode===a.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(b,c){function d(){return b>e&&(b=0),0>b&&(b=e),b}for(var e=this.tabs.length-1;-1!==a.inArray(d(),this.options.disabled);)b=c?b+1:b-1;return b},_focusNextTab:function(a,b){return a=this._findNextTab(a,b),this.tabs.eq(a).focus(),a},_setOption:function(a,b){return"active"===a?void this._activate(b):"disabled"===a?void this._setupDisabled(b):(this._super(a,b),"collapsible"===a&&(this.element.toggleClass("ui-tabs-collapsible",b),b||this.options.active!==!1||this._activate(0)),"event"===a&&this._setupEvents(b),void("heightStyle"===a&&this._setupHeightStyle(b)))},_tabId:function(a){return a.attr("aria-controls")||"ui-tabs-"+c()},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var b=this.options,c=this.tablist.children(":has(a[href])");b.disabled=a.map(c.filter(".ui-state-disabled"),function(a){return c.index(a)}),this._processTabs(),b.active!==!1&&this.anchors.length?this.active.length&&!a.contains(this.tablist[0],this.active[0])?this.tabs.length===b.disabled.length?(b.active=!1,this.active=a()):this._activate(this._findNextTab(Math.max(0,b.active-1),!1)):b.active=this.tabs.index(this.active):(b.active=!1,this.active=a()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var b=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return a("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=a(),this.anchors.each(function(c,e){var f,g,h,i=a(e).uniqueId().attr("id"),j=a(e).closest("li"),k=j.attr("aria-controls");d(e)?(f=e.hash,g=b.element.find(b._sanitizeSelector(f))):(h=b._tabId(j),f="#"+h,g=b.element.find(f),g.length||(g=b._createPanel(h),g.insertAfter(b.panels[c-1]||b.tablist)),g.attr("aria-live","polite")),g.length&&(b.panels=b.panels.add(g)),k&&j.data("ui-tabs-aria-controls",k),j.attr({"aria-controls":f.substring(1),"aria-labelledby":i}),g.attr("aria-labelledby",i)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(b){return a("<div>").attr("id",b).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(b){a.isArray(b)&&(b.length?b.length===this.anchors.length&&(b=!0):b=!1);for(var c,d=0;c=this.tabs[d];d++)b===!0||-1!==a.inArray(d,b)?a(c).addClass("ui-state-disabled").attr("aria-disabled","true"):a(c).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=b},_setupEvents:function(b){var c={click:function(a){a.preventDefault()}};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,c),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(b){var c,d=this.element.parent();"fill"===b?(c=d.height(),c-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var b=a(this),d=b.css("position");"absolute"!==d&&"fixed"!==d&&(c-=b.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){c-=a(this).outerHeight(!0)}),this.panels.each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===b&&(c=0,this.panels.each(function(){c=Math.max(c,a(this).height("").height())}).height(c))},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e.closest("li"),g=f[0]===d[0],h=g&&c.collapsible,i=h?a():this._getPanelForTab(f),j=d.length?this._getPanelForTab(d):a(),k={oldTab:d,oldPanel:j,newTab:h?a():f,newPanel:i};b.preventDefault(),f.hasClass("ui-state-disabled")||f.hasClass("ui-tabs-loading")||this.running||g&&!c.collapsible||this._trigger("beforeActivate",b,k)===!1||(c.active=h?!1:this.tabs.index(f),this.active=g?a():f,this.xhr&&this.xhr.abort(),j.length||i.length||a.error("jQuery UI Tabs: Mismatching fragment identifier."),i.length&&this.load(this.tabs.index(f),b),this._toggle(b,k))},_toggle:function(b,c){function d(){f.running=!1,f._trigger("activate",b,c)}function e(){c.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),g.length&&f.options.show?f._show(g,f.options.show,d):(g.show(),d())}var f=this,g=c.newPanel,h=c.oldPanel;this.running=!0,h.length&&this.options.hide?this._hide(h,this.options.hide,function(){c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),e()}):(c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),h.hide(),e()),h.attr({"aria-expanded":"false","aria-hidden":"true"}),c.oldTab.attr("aria-selected","false"),g.length&&h.length?c.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1),g.attr({"aria-expanded":"true","aria-hidden":"false"}),c.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(b){var c,d=this._findActive(b);d[0]!==this.active[0]&&(d.length||(d=this.active),c=d.find(".ui-tabs-anchor")[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return b===!1?a():this.tabs.eq(b)},_getIndex:function(a){return"string"==typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))),a},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){a.data(this,"ui-tabs-destroy")?a(this).remove():a(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var b=a(this),c=b.data("ui-tabs-aria-controls");c?b.attr("aria-controls",c).removeData("ui-tabs-aria-controls"):b.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(c){var d=this.options.disabled;d!==!1&&(c===b?d=!1:(c=this._getIndex(c),d=a.isArray(d)?a.map(d,function(a){return a!==c?a:null}):a.map(this.tabs,function(a,b){return b!==c?b:null})),this._setupDisabled(d))},disable:function(c){var d=this.options.disabled;if(d!==!0){if(c===b)d=!0;else{if(c=this._getIndex(c),-1!==a.inArray(c,d))return;d=a.isArray(d)?a.merge([c],d).sort():[c]}this._setupDisabled(d)}},load:function(b,c){b=this._getIndex(b);var e=this,f=this.tabs.eq(b),g=f.find(".ui-tabs-anchor"),h=this._getPanelForTab(f),i={tab:f,panel:h};d(g[0])||(this.xhr=a.ajax(this._ajaxSettings(g,c,i)),this.xhr&&"canceled"!==this.xhr.statusText&&(f.addClass("ui-tabs-loading"),h.attr("aria-busy","true"),this.xhr.success(function(a){setTimeout(function(){h.html(a),e._trigger("load",c,i)},1)}).complete(function(a,b){setTimeout(function(){"abort"===b&&e.panels.stop(!1,!0),f.removeClass("ui-tabs-loading"),h.removeAttr("aria-busy"),a===e.xhr&&delete e.xhr},1)})))},_ajaxSettings:function(b,c,d){var e=this;return{url:b.attr("href"),beforeSend:function(b,f){return e._trigger("beforeLoad",c,a.extend({jqXHR:b,ajaxSettings:f},d))}}},_getPanelForTab:function(b){var c=a(b).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+c))}})}(jQuery),function(a){function b(b,c){var d=(b.attr("aria-describedby")||"").split(/\s+/);d.push(c),b.data("ui-tooltip-id",c).attr("aria-describedby",a.trim(d.join(" ")))}function c(b){var c=b.data("ui-tooltip-id"),d=(b.attr("aria-describedby")||"").split(/\s+/),e=a.inArray(c,d);-1!==e&&d.splice(e,1),b.removeData("ui-tooltip-id"),d=a.trim(d.join(" ")),d?b.attr("aria-describedby",d):b.removeAttr("aria-describedby")}var d=0;a.widget("ui.tooltip",{version:"1.10.3",options:{content:function(){var b=a(this).attr("title")||"";return a("<a>").text(b).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(b,c){var d=this;return"disabled"===b?(this[c?"_disable":"_enable"](),void(this.options[b]=c)):(this._super(b,c),void("content"===b&&a.each(this.tooltips,function(a,b){d._updateContent(b)})))},_disable:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d[0],b.close(e,!0)}),this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.is("[title]")&&b.data("ui-tooltip-title",b.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.data("ui-tooltip-title")&&b.attr("title",b.data("ui-tooltip-title"))})},open:function(b){var c=this,d=a(b?b.target:this.element).closest(this.options.items);d.length&&!d.data("ui-tooltip-id")&&(d.attr("title")&&d.data("ui-tooltip-title",d.attr("title")),d.data("ui-tooltip-open",!0),b&&"mouseover"===b.type&&d.parents().each(function(){var b,d=a(this);d.data("ui-tooltip-open")&&(b=a.Event("blur"),b.target=b.currentTarget=this,c.close(b,!0)),d.attr("title")&&(d.uniqueId(),c.parents[this.id]={element:this,title:d.attr("title")},d.attr("title",""))}),this._updateContent(d,b))},_updateContent:function(a,b){var c,d=this.options.content,e=this,f=b?b.type:null;return"string"==typeof d?this._open(b,a,d):(c=d.call(a[0],function(c){a.data("ui-tooltip-open")&&e._delay(function(){b&&(b.type=f),this._open(b,a,c)})}),void(c&&this._open(b,a,c)))},_open:function(c,d,e){function f(a){j.of=a,g.is(":hidden")||g.position(j)}var g,h,i,j=a.extend({},this.options.position);if(e){if(g=this._find(d),g.length)return void g.find(".ui-tooltip-content").html(e);d.is("[title]")&&(c&&"mouseover"===c.type?d.attr("title",""):d.removeAttr("title")),g=this._tooltip(d),b(d,g.attr("id")),g.find(".ui-tooltip-content").html(e),this.options.track&&c&&/^mouse/.test(c.type)?(this._on(this.document,{mousemove:f}),f(c)):g.position(a.extend({of:d},this.options.position)),g.hide(),this._show(g,this.options.show),this.options.show&&this.options.show.delay&&(i=this.delayedShow=setInterval(function(){g.is(":visible")&&(f(j.of),clearInterval(i))},a.fx.interval)),this._trigger("open",c,{tooltip:g}),h={keyup:function(b){if(b.keyCode===a.ui.keyCode.ESCAPE){var c=a.Event(b);c.currentTarget=d[0],this.close(c,!0)}},remove:function(){this._removeTooltip(g)}},c&&"mouseover"!==c.type||(h.mouseleave="close"),c&&"focusin"!==c.type||(h.focusout="close"),this._on(!0,d,h)}},close:function(b){var d=this,e=a(b?b.currentTarget:this.element),f=this._find(e);this.closing||(clearInterval(this.delayedShow),e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title")),c(e),f.stop(!0),this._hide(f,this.options.hide,function(){d._removeTooltip(a(this))}),e.removeData("ui-tooltip-open"),this._off(e,"mouseleave focusout keyup"),e[0]!==this.element[0]&&this._off(e,"remove"),this._off(this.document,"mousemove"),b&&"mouseleave"===b.type&&a.each(this.parents,function(b,c){a(c.element).attr("title",c.title),delete d.parents[b]}),this.closing=!0,this._trigger("close",b,{tooltip:f}),this.closing=!1)},_tooltip:function(b){var c="ui-tooltip-"+d++,e=a("<div>").attr({id:c,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return a("<div>").addClass("ui-tooltip-content").appendTo(e),e.appendTo(this.document[0].body),this.tooltips[c]=b,e},_find:function(b){var c=b.data("ui-tooltip-id");return c?a("#"+c):a()},_removeTooltip:function(a){a.remove(),delete this.tooltips[a.attr("id")]},_destroy:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d[0],b.close(e,!0),a("#"+c).remove(),d.data("ui-tooltip-title")&&(d.attr("title",d.data("ui-tooltip-title")),d.removeData("ui-tooltip-title"))})}})}(jQuery),function(a,b){var c="ui-effects-";a.effects={effect:{}},function(a,b){function c(a,b,c){var d=l[b.type]||{};return null==a?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max<a?d.max:a)}function d(b){var c=j(),d=c._rgba=[];return b=b.toLowerCase(),o(i,function(a,e){var f,g=e.re.exec(b),h=g&&e.parse(g),i=e.space||"rgba";return h?(f=c[i](h),c[k[i].cache]=f[k[i].cache],d=c._rgba=f._rgba,!1):void 0}),d.length?("0,0,0,0"===d.join()&&a.extend(d,f.transparent),c):f[b]}function e(a,b,c){return c=(c+1)%1,1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}var f,g="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",h=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],j=a.Color=function(b,c,d,e){return new a.Color.fn.parse(b,c,d,e)},k={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},l={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},m=j.support={},n=a("<p>")[0],o=a.each;n.style.cssText="background-color:rgba(1,1,1,.5)",m.rgba=n.style.backgroundColor.indexOf("rgba")>-1,o(k,function(a,b){b.cache="_"+a,b.props.alpha={idx:3,type:"percent",def:1}}),j.fn=a.extend(j.prototype,{parse:function(e,g,h,i){if(e===b)return this._rgba=[null,null,null,null],this;(e.jquery||e.nodeType)&&(e=a(e).css(g),g=b);var l=this,m=a.type(e),n=this._rgba=[];return g!==b&&(e=[e,g,h,i],m="array"),"string"===m?this.parse(d(e)||f._default):"array"===m?(o(k.rgba.props,function(a,b){n[b.idx]=c(e[b.idx],b)}),this):"object"===m?(e instanceof j?o(k,function(a,b){e[b.cache]&&(l[b.cache]=e[b.cache].slice())}):o(k,function(b,d){var f=d.cache;o(d.props,function(a,b){if(!l[f]&&d.to){if("alpha"===a||null==e[a])return;l[f]=d.to(l._rgba)}l[f][b.idx]=c(e[a],b,!0)}),l[f]&&a.inArray(null,l[f].slice(0,3))<0&&(l[f][3]=1,d.from&&(l._rgba=d.from(l[f])))}),this):void 0},is:function(a){var b=j(a),c=!0,d=this;return o(k,function(a,e){var f,g=b[e.cache];return g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],o(e.props,function(a,b){return null!=g[b.idx]?c=g[b.idx]===f[b.idx]:void 0})),c}),c},_space:function(){var a=[],b=this;return o(k,function(c,d){b[d.cache]&&a.push(c)}),a.pop()},transition:function(a,b){var d=j(a),e=d._space(),f=k[e],g=0===this.alpha()?j("transparent"):this,h=g[f.cache]||f.to(g._rgba),i=h.slice();return d=d[f.cache],o(f.props,function(a,e){var f=e.idx,g=h[f],j=d[f],k=l[e.type]||{};null!==j&&(null===g?i[f]=j:(k.mod&&(j-g>k.mod/2?g+=k.mod:g-j>k.mod/2&&(g-=k.mod)),i[f]=c((j-g)*b+g,e)))}),this[e](i)},blend:function(b){if(1===this._rgba[3])return this;var c=this._rgba.slice(),d=c.pop(),e=j(b)._rgba;return j(a.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var b="rgba(",c=a.map(this._rgba,function(a,b){return null==a?b>2?1:0:a});return 1===c[3]&&(c.pop(),b="rgb("),b+c.join()+")"},toHslaString:function(){var b="hsla(",c=a.map(this.hsla(),function(a,b){return null==a&&(a=b>2?1:0),b&&3>b&&(a=Math.round(100*a)+"%"),a});return 1===c[3]&&(c.pop(),b="hsl("),b+c.join()+")"},toHexString:function(b){var c=this._rgba.slice(),d=c.pop();return b&&c.push(~~(255*d)),"#"+a.map(c,function(a){return a=(a||0).toString(16),1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),j.fn.parse.prototype=j.fn,k.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=a[3],h=Math.max(d,e,f),i=Math.min(d,e,f),j=h-i,k=h+i,l=.5*k;return b=i===h?0:d===h?60*(e-f)/j+360:e===h?60*(f-d)/j+120:60*(d-e)/j+240,c=0===j?0:.5>=l?j/k:j/(2-k),[Math.round(b)%360,c,l,null==g?1:g]},k.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],f=a[3],g=.5>=d?d*(1+c):d+c-d*c,h=2*d-g;return[Math.round(255*e(h,g,b+1/3)),Math.round(255*e(h,g,b)),Math.round(255*e(h,g,b-1/3)),f]},o(k,function(d,e){var f=e.props,g=e.cache,i=e.to,k=e.from;j.fn[d]=function(d){if(i&&!this[g]&&(this[g]=i(this._rgba)),d===b)return this[g].slice();var e,h=a.type(d),l="array"===h||"object"===h?d:arguments,m=this[g].slice();return o(f,function(a,b){var d=l["object"===h?a:b.idx];null==d&&(d=m[b.idx]),m[b.idx]=c(d,b)}),k?(e=j(k(m)),e[g]=m,e):j(m)},o(f,function(b,c){j.fn[b]||(j.fn[b]=function(e){var f,g=a.type(e),i="alpha"===b?this._hsla?"hsla":"rgba":d,j=this[i](),k=j[c.idx];return"undefined"===g?k:("function"===g&&(e=e.call(this,k),g=a.type(e)),null==e&&c.empty?this:("string"===g&&(f=h.exec(e),f&&(e=k+parseFloat(f[2])*("+"===f[1]?1:-1))),j[c.idx]=e,this[i](j)))})})}),j.hook=function(b){var c=b.split(" ");o(c,function(b,c){a.cssHooks[c]={set:function(b,e){var f,g,h="";if("transparent"!==e&&("string"!==a.type(e)||(f=d(e)))){if(e=j(f||e),!m.rgba&&1!==e._rgba[3]){for(g="backgroundColor"===c?b.parentNode:b;(""===h||"transparent"===h)&&g&&g.style;)try{h=a.css(g,"backgroundColor"),g=g.parentNode}catch(i){}e=e.blend(h&&"transparent"!==h?h:"_default")}e=e.toRgbaString()}try{b.style[c]=e}catch(i){}}},a.fx.step[c]=function(b){b.colorInit||(b.start=j(b.elem,c),b.end=j(b.end),b.colorInit=!0),a.cssHooks[c].set(b.elem,b.start.transition(b.end,b.pos))}})},j.hook(g),a.cssHooks.borderColor={expand:function(a){var b={};return o(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a}),b}},f=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function c(b){var c,d,e=b.ownerDocument.defaultView?b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,f={};if(e&&e.length&&e[0]&&e[e[0]])for(d=e.length;d--;)c=e[d],"string"==typeof e[c]&&(f[a.camelCase(c)]=e[c]);else for(c in e)"string"==typeof e[c]&&(f[c]=e[c]);return f}function d(b,c){var d,e,g={};for(d in c)e=c[d],b[d]!==e&&(f[d]||(a.fx.step[d]||!isNaN(parseFloat(e)))&&(g[d]=e));return g}var e=["add","remove","toggle"],f={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=function(a){("none"!==a.end&&!a.setAttr||1===a.pos&&!a.setAttr)&&(jQuery.style(a.elem,c,a.end),a.setAttr=!0)}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a.effects.animateClass=function(b,f,g,h){var i=a.speed(f,g,h);return this.queue(function(){var f,g=a(this),h=g.attr("class")||"",j=i.children?g.find("*").addBack():g;j=j.map(function(){var b=a(this);return{el:b,start:c(this)}}),f=function(){a.each(e,function(a,c){b[c]&&g[c+"Class"](b[c])})},f(),j=j.map(function(){return this.end=c(this.el[0]),this.diff=d(this.start,this.end),this}),g.attr("class",h),j=j.map(function(){var b=this,c=a.Deferred(),d=a.extend({},i,{queue:!1,complete:function(){c.resolve(b)}});return this.el.animate(this.diff,d),c.promise()}),a.when.apply(a,j.get()).done(function(){f(),a.each(arguments,function(){var b=this.el;a.each(this.diff,function(a){b.css(a,"")})}),i.complete.call(g[0])})})},a.fn.extend({addClass:function(b){return function(c,d,e,f){return d?a.effects.animateClass.call(this,{add:c},d,e,f):b.apply(this,arguments)}}(a.fn.addClass),removeClass:function(b){return function(c,d,e,f){return arguments.length>1?a.effects.animateClass.call(this,{remove:c},d,e,f):b.apply(this,arguments)}}(a.fn.removeClass),toggleClass:function(c){return function(d,e,f,g,h){return"boolean"==typeof e||e===b?f?a.effects.animateClass.call(this,e?{add:d}:{remove:d},f,g,h):c.apply(this,arguments):a.effects.animateClass.call(this,{toggle:d},e,f,g)}}(a.fn.toggleClass),switchClass:function(b,c,d,e,f){return a.effects.animateClass.call(this,{add:c,remove:b},d,e,f)}})}(),function(){function d(b,c,d,e){return a.isPlainObject(b)&&(c=b,b=b.effect),b={effect:b},null==c&&(c={}),a.isFunction(c)&&(e=c,d=null,c={}),("number"==typeof c||a.fx.speeds[c])&&(e=d,d=c,c={}),a.isFunction(d)&&(e=d,d=null),c&&a.extend(b,c),d=d||c.duration,b.duration=a.fx.off?0:"number"==typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,b.complete=e||c.complete,b}function e(b){return!b||"number"==typeof b||a.fx.speeds[b]?!0:"string"!=typeof b||a.effects.effect[b]?a.isFunction(b)?!0:"object"!=typeof b||b.effect?!1:!0:!0}a.extend(a.effects,{version:"1.10.3",save:function(a,b){for(var d=0;d<b.length;d++)null!==b[d]&&a.data(c+b[d],a[0].style[b[d]])},restore:function(a,d){var e,f;for(f=0;f<d.length;f++)null!==d[f]&&(e=a.data(c+d[f]),e===b&&(e=""),a.css(d[f],e))},setMode:function(a,b){return"toggle"===b&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e={width:b.width(),height:b.height()},f=document.activeElement;try{f.id}catch(g){f=document.body}return b.wrap(d),(b[0]===f||a.contains(b[0],f))&&a(f).focus(),d=b.parent(),"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),b.css(e),d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;return b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).focus()),b},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e}}),a.fn.extend({effect:function(){function b(b){function d(){a.isFunction(f)&&f.call(e[0]),a.isFunction(b)&&b()}var e=a(this),f=c.complete,h=c.mode;(e.is(":hidden")?"hide"===h:"show"===h)?(e[h](),d()):g.call(e[0],c,d)}var c=d.apply(this,arguments),e=c.mode,f=c.queue,g=a.effects.effect[c.effect];return a.fx.off||!g?e?this[e](c.duration,c.complete):this.each(function(){c.complete&&c.complete.call(this)}):f===!1?this.each(b):this.queue(f||"fx",b)},show:function(a){return function(b){if(e(b))return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="show",this.effect.call(this,c)}}(a.fn.show),hide:function(a){return function(b){if(e(b))return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="hide",this.effect.call(this,c)}}(a.fn.hide),toggle:function(a){return function(b){if(e(b)||"boolean"==typeof b)return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="toggle",this.effect.call(this,c)}}(a.fn.toggle),cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}})}(),function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,a+2)}}),a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}}),a.each(b,function(b,c){a.easing["easeIn"+b]=c,a.easing["easeOut"+b]=function(a){return 1-c(1-a)},a.easing["easeInOut"+b]=function(a){return.5>a?c(2*a)/2:1-c(-2*a+2)/2
}})}()}(jQuery),function(a){var b=/up|down|vertical/,c=/up|left|vertical|horizontal/;a.effects.effect.blind=function(d,e){var f,g,h,i=a(this),j=["position","top","bottom","left","right","height","width"],k=a.effects.setMode(i,d.mode||"hide"),l=d.direction||"up",m=b.test(l),n=m?"height":"width",o=m?"top":"left",p=c.test(l),q={},r="show"===k;i.parent().is(".ui-effects-wrapper")?a.effects.save(i.parent(),j):a.effects.save(i,j),i.show(),f=a.effects.createWrapper(i).css({overflow:"hidden"}),g=f[n](),h=parseFloat(f.css(o))||0,q[n]=r?g:0,p||(i.css(m?"bottom":"right",0).css(m?"top":"left","auto").css({position:"absolute"}),q[o]=r?h:g+h),r&&(f.css(n,0),p||f.css(o,h+g)),f.animate(q,{duration:d.duration,easing:d.easing,queue:!1,complete:function(){"hide"===k&&i.hide(),a.effects.restore(i,j),a.effects.removeWrapper(i),e()}})}}(jQuery),function(a){a.effects.effect.bounce=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"effect"),j="hide"===i,k="show"===i,l=b.direction||"up",m=b.distance,n=b.times||5,o=2*n+(k||j?1:0),p=b.duration/o,q=b.easing,r="up"===l||"down"===l?"top":"left",s="up"===l||"left"===l,t=g.queue(),u=t.length;for((k||j)&&h.push("opacity"),a.effects.save(g,h),g.show(),a.effects.createWrapper(g),m||(m=g["top"===r?"outerHeight":"outerWidth"]()/3),k&&(f={opacity:1},f[r]=0,g.css("opacity",0).css(r,s?2*-m:2*m).animate(f,p,q)),j&&(m/=Math.pow(2,n-1)),f={},f[r]=0,d=0;n>d;d++)e={},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q).animate(f,p,q),m=j?2*m:m/2;j&&(e={opacity:0},e[r]=(s?"-=":"+=")+m,g.animate(e,p,q)),g.queue(function(){j&&g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}),u>1&&t.splice.apply(t,[1,0].concat(t.splice(u,o+1))),g.dequeue()}}(jQuery),function(a){a.effects.effect.clip=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","height","width"],i=a.effects.setMode(g,b.mode||"hide"),j="show"===i,k=b.direction||"vertical",l="vertical"===k,m=l?"height":"width",n=l?"top":"left",o={};a.effects.save(g,h),g.show(),d=a.effects.createWrapper(g).css({overflow:"hidden"}),e="IMG"===g[0].tagName?d:g,f=e[m](),j&&(e.css(m,0),e.css(n,f/2)),o[m]=j?f:0,o[n]=j?0:f/2,e.animate(o,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){j||g.hide(),a.effects.restore(g,h),a.effects.removeWrapper(g),c()}})}}(jQuery),function(a){a.effects.effect.drop=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","opacity","height","width"],g=a.effects.setMode(e,b.mode||"hide"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i?"pos":"neg",l={opacity:h?1:0};a.effects.save(e,f),e.show(),a.effects.createWrapper(e),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0)/2,h&&e.css("opacity",0).css(j,"pos"===k?-d:d),l[j]=(h?"pos"===k?"+=":"-=":"pos"===k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})}}(jQuery),function(a){a.effects.effect.explode=function(b,c){function d(){t.push(this),t.length===l*m&&e()}function e(){n.css({visibility:"visible"}),a(t).remove(),p||n.hide(),c()}var f,g,h,i,j,k,l=b.pieces?Math.round(Math.sqrt(b.pieces)):3,m=l,n=a(this),o=a.effects.setMode(n,b.mode||"hide"),p="show"===o,q=n.show().css("visibility","hidden").offset(),r=Math.ceil(n.outerWidth()/m),s=Math.ceil(n.outerHeight()/l),t=[];for(f=0;l>f;f++)for(i=q.top+f*s,k=f-(l-1)/2,g=0;m>g;g++)h=q.left+g*r,j=g-(m-1)/2,n.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*r,top:-f*s}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:r,height:s,left:h+(p?j*r:0),top:i+(p?k*s:0),opacity:p?0:1}).animate({left:h+(p?0:j*r),top:i+(p?0:k*s),opacity:p?1:0},b.duration||500,b.easing,d)}}(jQuery),function(a){a.effects.effect.fade=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"toggle");d.animate({opacity:e},{queue:!1,duration:b.duration,easing:b.easing,complete:c})}}(jQuery),function(a){a.effects.effect.fold=function(b,c){var d,e,f=a(this),g=["position","top","bottom","left","right","height","width"],h=a.effects.setMode(f,b.mode||"hide"),i="show"===h,j="hide"===h,k=b.size||15,l=/([0-9]+)%/.exec(k),m=!!b.horizFirst,n=i!==m,o=n?["width","height"]:["height","width"],p=b.duration/2,q={},r={};a.effects.save(f,g),f.show(),d=a.effects.createWrapper(f).css({overflow:"hidden"}),e=n?[d.width(),d.height()]:[d.height(),d.width()],l&&(k=parseInt(l[1],10)/100*e[j?0:1]),i&&d.css(m?{height:0,width:k}:{height:k,width:0}),q[o[0]]=i?e[0]:k,r[o[1]]=i?e[1]:0,d.animate(q,p,b.easing).animate(r,p,b.easing,function(){j&&f.hide(),a.effects.restore(f,g),a.effects.removeWrapper(f),c()})}}(jQuery),function(a){a.effects.effect.highlight=function(b,c){var d=a(this),e=["backgroundImage","backgroundColor","opacity"],f=a.effects.setMode(d,b.mode||"show"),g={backgroundColor:d.css("backgroundColor")};"hide"===f&&(g.opacity=0),a.effects.save(d,e),d.show().css({backgroundImage:"none",backgroundColor:b.color||"#ffff99"}).animate(g,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===f&&d.hide(),a.effects.restore(d,e),c()}})}}(jQuery),function(a){a.effects.effect.pulsate=function(b,c){var d,e=a(this),f=a.effects.setMode(e,b.mode||"show"),g="show"===f,h="hide"===f,i=g||"hide"===f,j=2*(b.times||5)+(i?1:0),k=b.duration/j,l=0,m=e.queue(),n=m.length;for((g||!e.is(":visible"))&&(e.css("opacity",0).show(),l=1),d=1;j>d;d++)e.animate({opacity:l},k,b.easing),l=1-l;e.animate({opacity:l},k,b.easing),e.queue(function(){h&&e.hide(),c()}),n>1&&m.splice.apply(m,[1,0].concat(m.splice(n,j+1))),e.dequeue()}}(jQuery),function(a){a.effects.effect.puff=function(b,c){var d=a(this),e=a.effects.setMode(d,b.mode||"hide"),f="hide"===e,g=parseInt(b.percent,10)||150,h=g/100,i={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()};a.extend(b,{effect:"scale",queue:!1,fade:!0,mode:e,complete:c,percent:f?g:100,from:f?i:{height:i.height*h,width:i.width*h,outerHeight:i.outerHeight*h,outerWidth:i.outerWidth*h}}),d.effect(b)},a.effects.effect.scale=function(b,c){var d=a(this),e=a.extend(!0,{},b),f=a.effects.setMode(d,b.mode||"effect"),g=parseInt(b.percent,10)||(0===parseInt(b.percent,10)?0:"hide"===f?0:100),h=b.direction||"both",i=b.origin,j={height:d.height(),width:d.width(),outerHeight:d.outerHeight(),outerWidth:d.outerWidth()},k={y:"horizontal"!==h?g/100:1,x:"vertical"!==h?g/100:1};e.effect="size",e.queue=!1,e.complete=c,"effect"!==f&&(e.origin=i||["middle","center"],e.restore=!0),e.from=b.from||("show"===f?{height:0,width:0,outerHeight:0,outerWidth:0}:j),e.to={height:j.height*k.y,width:j.width*k.x,outerHeight:j.outerHeight*k.y,outerWidth:j.outerWidth*k.x},e.fade&&("show"===f&&(e.from.opacity=0,e.to.opacity=1),"hide"===f&&(e.from.opacity=1,e.to.opacity=0)),d.effect(e)},a.effects.effect.size=function(b,c){var d,e,f,g=a(this),h=["position","top","bottom","left","right","width","height","overflow","opacity"],i=["position","top","bottom","left","right","overflow","opacity"],j=["width","height","overflow"],k=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],m=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],n=a.effects.setMode(g,b.mode||"effect"),o=b.restore||"effect"!==n,p=b.scale||"both",q=b.origin||["middle","center"],r=g.css("position"),s=o?h:i,t={height:0,width:0,outerHeight:0,outerWidth:0};"show"===n&&g.show(),d={height:g.height(),width:g.width(),outerHeight:g.outerHeight(),outerWidth:g.outerWidth()},"toggle"===b.mode&&"show"===n?(g.from=b.to||t,g.to=b.from||d):(g.from=b.from||("show"===n?t:d),g.to=b.to||("hide"===n?t:d)),f={from:{y:g.from.height/d.height,x:g.from.width/d.width},to:{y:g.to.height/d.height,x:g.to.width/d.width}},("box"===p||"both"===p)&&(f.from.y!==f.to.y&&(s=s.concat(l),g.from=a.effects.setTransition(g,l,f.from.y,g.from),g.to=a.effects.setTransition(g,l,f.to.y,g.to)),f.from.x!==f.to.x&&(s=s.concat(m),g.from=a.effects.setTransition(g,m,f.from.x,g.from),g.to=a.effects.setTransition(g,m,f.to.x,g.to))),("content"===p||"both"===p)&&f.from.y!==f.to.y&&(s=s.concat(k).concat(j),g.from=a.effects.setTransition(g,k,f.from.y,g.from),g.to=a.effects.setTransition(g,k,f.to.y,g.to)),a.effects.save(g,s),g.show(),a.effects.createWrapper(g),g.css("overflow","hidden").css(g.from),q&&(e=a.effects.getBaseline(q,d),g.from.top=(d.outerHeight-g.outerHeight())*e.y,g.from.left=(d.outerWidth-g.outerWidth())*e.x,g.to.top=(d.outerHeight-g.to.outerHeight)*e.y,g.to.left=(d.outerWidth-g.to.outerWidth)*e.x),g.css(g.from),("content"===p||"both"===p)&&(l=l.concat(["marginTop","marginBottom"]).concat(k),m=m.concat(["marginLeft","marginRight"]),j=h.concat(l).concat(m),g.find("*[width]").each(function(){var c=a(this),d={height:c.height(),width:c.width(),outerHeight:c.outerHeight(),outerWidth:c.outerWidth()};o&&a.effects.save(c,j),c.from={height:d.height*f.from.y,width:d.width*f.from.x,outerHeight:d.outerHeight*f.from.y,outerWidth:d.outerWidth*f.from.x},c.to={height:d.height*f.to.y,width:d.width*f.to.x,outerHeight:d.height*f.to.y,outerWidth:d.width*f.to.x},f.from.y!==f.to.y&&(c.from=a.effects.setTransition(c,l,f.from.y,c.from),c.to=a.effects.setTransition(c,l,f.to.y,c.to)),f.from.x!==f.to.x&&(c.from=a.effects.setTransition(c,m,f.from.x,c.from),c.to=a.effects.setTransition(c,m,f.to.x,c.to)),c.css(c.from),c.animate(c.to,b.duration,b.easing,function(){o&&a.effects.restore(c,j)})})),g.animate(g.to,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){0===g.to.opacity&&g.css("opacity",g.from.opacity),"hide"===n&&g.hide(),a.effects.restore(g,s),o||("static"===r?g.css({position:"relative",top:g.to.top,left:g.to.left}):a.each(["top","left"],function(a,b){g.css(b,function(b,c){var d=parseInt(c,10),e=a?g.to.left:g.to.top;return"auto"===c?e+"px":d+e+"px"})})),a.effects.removeWrapper(g),c()}})}}(jQuery),function(a){a.effects.effect.shake=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","height","width"],g=a.effects.setMode(e,b.mode||"effect"),h=b.direction||"left",i=b.distance||20,j=b.times||3,k=2*j+1,l=Math.round(b.duration/k),m="up"===h||"down"===h?"top":"left",n="up"===h||"left"===h,o={},p={},q={},r=e.queue(),s=r.length;for(a.effects.save(e,f),e.show(),a.effects.createWrapper(e),o[m]=(n?"-=":"+=")+i,p[m]=(n?"+=":"-=")+2*i,q[m]=(n?"-=":"+=")+2*i,e.animate(o,l,b.easing),d=1;j>d;d++)e.animate(p,l,b.easing).animate(q,l,b.easing);e.animate(p,l,b.easing).animate(o,l/2,b.easing).queue(function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}),s>1&&r.splice.apply(r,[1,0].concat(r.splice(s,k+1))),e.dequeue()}}(jQuery),function(a){a.effects.effect.slide=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","width","height"],g=a.effects.setMode(e,b.mode||"show"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i,l={};a.effects.save(e,f),e.show(),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0),a.effects.createWrapper(e).css({overflow:"hidden"}),h&&e.css(j,k?isNaN(d)?"-"+d:-d:d),l[j]=(h?k?"+=":"-=":k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})}}(jQuery),function(a){a.effects.effect.transfer=function(b,c){var d=a(this),e=a(b.to),f="fixed"===e.css("position"),g=a("body"),h=f?g.scrollTop():0,i=f?g.scrollLeft():0,j=e.offset(),k={top:j.top-h,left:j.left-i,height:e.innerHeight(),width:e.innerWidth()},l=d.offset(),m=a("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(b.className).css({top:l.top-h,left:l.left-i,height:d.innerHeight(),width:d.innerWidth(),position:f?"fixed":"absolute"}).animate(k,b.duration,b.easing,function(){m.remove(),c()})}}(jQuery),define("jquery.ui",function(){}),define("views/work/tag/siderbar-view",["talent","templates/work","views/work/tag/siderbar-item-view","jquery.ui"],function(a,b,c){return a.CompositeView.extend({template:b["work/tag/siderbar"],itemView:c,tagName:"ul",className:"tu-nav-sub",itemViewContainer:"[data-name=my-used-tag-cont]",itemViewOptions:function(){return{relation:this.model.get("relation"),tagId:this.model.get("tagId")}},ui:{myTagBtn:"a[data-name=my-tag-btn]",myUsedTag:"li.item-nav",iconArrow:".icon-arrow",myUsedTagCont:"[data-name=my-used-tag-cont]",myUsedTagLi:"[data-name=my-used-tag-cont] li",tagManageBtn:"a[data-name=tag-manage-btn]"},events:function(){var a={};return a["click "+this.ui.myTagBtn]="_clickMyTagBtnHandler",a["click "+this.ui.myUsedTag]="_clickMyUsedTagHandler",a["click "+this.ui.tagManageBtn]="_clickTagManageBtnHandler",a},templateHelpers:function(){return{showMyTag:this.collection.length?!0:!1}},initialize:function(){this.myUsedTagListDown=!0,this.isMove=!1},onRender:function(){this.showActive(),this._tagDrop()},onShow:function(){this.$el.css("min-height",this.$el.parent().height())},_clickMyTagBtnHandler:function(){this.myUsedTagListDown?(this.myUsedTagListDown=!1,this.ui.iconArrow.removeClass("tu-icon-fontarrow-up").addClass("tu-icon-fontarrow-down"),this.ui.myUsedTagCont.slideUp()):(this.myUsedTagListDown=!0,this.ui.iconArrow.removeClass("tu-icon-fontarrow-down").addClass("tu-icon-fontarrow-up"),this.ui.myUsedTagCont.slideDown())},_clickMyUsedTagHandler:function(b){var c=a.$(b.currentTarget);this.addActiveClass(c,"active"),this.trigger("clickUsedTag",c),window.scrollTo(0,0)},_clickTagManageBtnHandler:function(b){var c=a.$(b.currentTarget);this.addActiveClass(c,"active"),this.trigger("clickTagManage",c),window.scrollTo(0,0)},addActiveClass:function(a,b){this.$el.find("."+b).removeClass(b),a.addClass(b)},showActive:function(){this.model.toJSON()},_tagDrop:function(){var b=this;this.ui.myUsedTagCont.sortable({axis:"y",placeholder:"placeholder",cursor:"move",revert:300,delay:300,start:function(a,b){b.item.addClass("rotate")}}),this.ui.myUsedTagCont.on("sortstop",function(c,d){var e=d.item.find("a[data-name=my-used-tag]").attr("id"),f=b.ui.myUsedTagCont.find("[data-name=my-used-tag]").get(),g=[];d.item.removeClass("rotate"),a.$.each(f,function(a,b){g.push($(b).attr("id"))}),b._afterDrop(e,g)})},_afterDrop:function(b,c){var d={};c.length<2||(a.$.each(c,function(a,e){e===b&&(0===a?(d.beforeId="",d.tagId=e,d.afterId=c[a+1]):a==c.length-1?(d.beforeId=c[a-1],d.tagId=e,d.afterId=""):(d.beforeId=c[a-1],d.tagId=e,d.afterId=c[a+1]))}),this._postSortData(d))},_postSortData:function(b){a.app.request("WorkTag:tagDragSort",b).done(function(){})},delTag:function(b){var c=this;a._.each(b,function(a){var b=a.get("id");c.collection.findWhere({id:b})&&c.collection.remove(c.collection.findWhere({id:b}))})}})}),define("views/work/tag/right-works-item-view",["talent","templates/work","$.tipsy"],function(a,b){return a.ItemView.extend({template:b["work/tag/right-works-item"],tagName:"tr",ui:{nameTip:"span[data-name=name-tip]"},templateHelpers:function(){return{subName:a.Context.subString(this.model.get("principalUserName"),12,!1)}},onRender:function(){this.ui.nameTip.tipsy({gravity:"s"})}})}),define("views/work/tag/right-works-collection-view",["talent","templates/work","views/work/tag/right-works-item-view"],function(a,b,c){return a.CompositeView.extend({template:b["work/tag/right-works-collection"],itemView:c,itemViewContainer:"tbody"})}),define("views/work/tag/right-works-view",["talent","templates/work","$.paginate","$.tipsy","views/common/empty-view","views/work/tag/right-works-collection-view"],function(a,b,c,d,e,f){return a.ItemView.extend({template:b["work/tag/right-works"],ui:{workItemsContainer:"[data-name=work-items-container]",pagination:"[data-name=pagination]",paginationContainer:"[data-name=pagination-container]",projectNum:"[data-name=project-num]",tagManageMain:"div.tag-manage-main"},initialize:function(){this.pageIndex=1},onRender:function(){this._showPagination(),this._getWorkItemsByTag()},_getWorkItemsByTag:function(){var b={pageIndex:this.pageIndex,pageSize:20,tagId:this.model.get("tagId"),objType:4},c=this;a.app.request("WorkTag:getWorkItemsByTag",b).done(function(a){if(a.workItems&&a.workItems.length)c._renderWorkItemsCollectionView(a.workItems);else{var b=new e({emptyContext:"该标签已经删除"});c.ui.tagManageMain.empty(),c.ui.tagManageMain.append(b.render().$el)}c._showPagination(a.totalCount),c.ui.projectNum.html(a.totalCount)})},_renderWorkItemsCollectionView:function(b){this.workItemsCollectionView&&this.workItemsCollectionView.close(),this.workItemsCollectionView=new f({collection:new a.Collection(b)}),this.ui.workItemsContainer.append(this.workItemsCollectionView.render().$el)},_showPagination:function(a){var b=this;a&&a>20?(this.ui.pagination.show(),this.ui.paginationContainer.empty().pagination(a,{items_per_page:20,prev_text:"<",next_text:">",current_page:this.pageIndex-1,prev_show_always:!0,next_show_always:!0,link_to:"javascript:void(0)",callback:function(a){b.pageIndex=a+1,b._getWorkItemsByTag()}}),this._paginationExtend(a)):(this.ui.paginationContainer.empty(),this.ui.pagination.hide())},_paginationExtend:function(a){if(a){this.ui.pagination.find(".tu-pagination-extend").remove();var b=this.pageIndex,c=$('<div class="tu-pagination-extend"></div>'),d=20*(b-1),e=a-d,f=d+1,g=d+20;20>=e&&(g=a),c.html('显示第<span class="num">'+f+'</span>至<span class="num">'+g+'</span>项结果，共<span class="num">'+a+"</span>项"),this.ui.pagination.append(c)}}})}),define("views/work/tag/right-tag-manage-tag-collection-view",["talent","templates/work","views/common/tag-view","$.infotip"],function(a,b,c){return a.CompositeView.extend({template:b["work/tag/right-tag-manage-tag-collection"],itemView:c,itemViewContainer:"[data-name=tag-wrap]",className:"tag-list-collection-wrap",ui:{shareBtn:"[data-name=share-btn]",deleteBtn:"[data-name=delete-btn]"},events:function(){var a={};return a["click "+this.ui.shareBtn]="_clickShareBtnHandler",a["click "+this.ui.deleteBtn]="_clickDeleteBtnHandler",a},templateHelpers:function(){return{hasDeleteBtn:this.settings.hasDeleteBtn||!1,hasShareBtn:this.settings.hasShareBtn||!1}},initialize:function(a){var b=this;this.settings=a,this.on("itemview:checked",function(){b._dealBtn()}),this.showTip=!1,this.isSubmit=!1},onRender:function(){a._.filter(this.collection.toJSON(),function(a){return 2==a.getWay}).length&&this.$el.prepend('<div class="share-title">共享给我的</div>')},_dealBtn:function(){this.collection.where({checked:!0}).length?(this.ui.shareBtn.removeClass("disabled"),this.ui.deleteBtn.removeClass("disabled")):(this.ui.shareBtn.addClass("disabled"),this.ui.deleteBtn.addClass("disabled"))},_clickShareBtnHandler:function(b){var c=a.$(b.currentTarget);this.checkedTag=[],this.checkedTag=this.collection.where({checked:!0});var d=this;this.checkedTag.length&&!this.showTip&&(this.showTip=!0,c.infotip({placement:"bottom",align:"left",type:"confirm",trigger:"manual",hashead:!1,body:"您的标签将共享给您的下属，统一管理工作",okHide:function(){if(!d.isSubmit){d.isSubmit=!0;var b={tagIds:[],shareTypes:[1]};a._.each(d.checkedTag,function(a){b.tagIds.push(a.toJSON().id)}),a.app.request("WorkTag:tagShare",b).done(function(){_.each(d.checkedTag,function(a){d.collection.findWhere({id:a.id}).set({shareType:"1",checked:!1,showOrter:!0})}),d._dealBtn(),c.infotip("hide"),d.showTip=!1,d.isSubmit=!1}).fail(function(){})}}}),c.infotip("show"),c.on("hidden",function(){d.showTip=!1,d.isSubmit=!1}))},_clickDeleteBtnHandler:function(b){var c=a.$(b.currentTarget),d=this;this.checkedTag=[],this.checkedTag=this.collection.where({checked:!0}),this.checkedTag.length&&!this.showTip&&(this.showTip=!0,c.infotip({placement:"bottom",align:"left",type:"confirm",trigger:"manual",hashead:!1,body:"确定删除吗？所有标签相关信息都将被删除",okHide:function(){if(!d.isSubmit){d.isSubmit=!0;var b={tagIds:[]};a._.each(d.checkedTag,function(a){b.tagIds.push(a.toJSON().id)}),a.app.request("WorkTag:tagDelete",b).done(function(){d.collection.remove(d.checkedTag),d.trigger("deleteTag",d.checkedTag),d._dealBtn(),c.infotip("hide"),d.showTip=!1,d.isSubmit=!1}).fail(function(){})}}}),c.infotip("show"),c.on("hidden",function(){d.showTip=!1,d.isSubmit=!1}))}})}),define("views/work/tag/right-tag-manage-tagbox-view",["talent","templates/work","views/common/empty-view","views/common/tag-view","views/work/tag/right-tag-manage-tag-collection-view"],function(a,b,c,d,e){return a.ItemView.extend({template:b["work/tag/right-tag-manage-tagbox"],ui:{myTagWrap:"[data-name=my-tag]",shareTagWrap:"[data-name=share-tag]"},collectionEvents:{add:"render"},initialize:function(a){this.settings=a},onRender:function(){this.collection.length?(this._dealCcllection(),this._renderMyTagCollectionView(),this._renderShareTagCollectionView()):this._renderEmptyView()},_dealCcllection:function(){if(this.myTagCollection=new a.Collection,this.shareTagCollection=new a.Collection,this.myTagCollection.set(this.collection.where({getWay:1})),this.shareTagCollection.set(this.collection.where({getWay:2})),!this.settings.hasDirectSubs){var b=[];a._.each(this.shareTagCollection.toJSON(),function(a){a.beCheck=!1,b.push(a)}),this.shareTagCollection.reset(b)}},_renderMyTagCollectionView:function(){this.myTagCollection.length&&(this.myTagCollectionView&&this.myTagCollectionView.close(),this.myTagCollectionView=new e({collection:this.myTagCollection,hasDeleteBtn:!0,hasShareBtn:this.settings.hasDirectSubs}),this.listenTo(this.myTagCollectionView,"deleteTag",function(a){this.collection.remove(a),this.collection.length?this.myTagCollection.length||this.myTagCollectionView.close():this._renderEmptyView(),this.trigger("deleteTag",a)}),this.ui.myTagWrap.empty(),this.ui.myTagWrap.append(this.myTagCollectionView.render().$el))},_renderShareTagCollectionView:function(){this.shareTagCollection.length&&(this.shareTagCollectionView&&this.shareTagCollectionView.close(),this.shareTagCollectionView=new e({collection:this.shareTagCollection,hasShareBtn:this.settings.hasDirectSubs}),this.ui.shareTagWrap.append(this.shareTagCollectionView.render().$el))},_renderEmptyView:function(){this.emptyView&&this.emptyView.close(),this.emptyView=new c({emptyContext:"暂无标签，赶快添加让工作更井井有条吧"}),this.myTagCollectionView&&this.myTagCollectionView.close(),this.ui.myTagWrap.empty(),this.ui.myTagWrap.append(this.emptyView.render().$el)}})}),define("views/work/tag/right-tag-manage-create-tag-checkcolor-view",["talent","templates/work"],function(a,b){return a.ItemView.extend({template:b["work/tag/right-tag-manage-create-tag-checkcolor"],className:"check-color-box",ui:{itemColor:"span"},templateHelpers:function(){},events:function(){var a={};return a["click "+this.ui.itemColor]="_clickItemColorHanler",a},modelEvents:{change:"render"},initialize:function(){this.$el.off("mouseup.check-color-box-view"),this.$el.on("mouseup.check-color-box-view",function(a){a.stopPropagation()})},_clickItemColorHanler:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.data("color");this.model.set("color",d)},onClose:function(){this.$el.off("mouseup.check-color-box-view")}})}),define("views/work/tag/right-tag-manage-create-tag-input-view",["talent","templates/work"],function(a,b){return a.ItemView.extend({template:b["work/tag/right-tag-manage-create-tag-input"],className:"",ui:{placeholder:"label.placeholder",input:"[data-name=input]",inputTip:"p.input-tip"},templateHelpers:function(){},events:function(){var a={};return a["compositionstart "+this.ui.input]="_inputStartHandler",a["compositionend "+this.ui.input]="_inputEndHandler",a["input "+this.ui.input]="_inputHandler",a["focus "+this.ui.input]="_inputFocusHandler",a["blur "+this.ui.input]="_inputBlurHandler",a},modelEvents:{},initialize:function(){this.isIE=this.isIE(),this.isIE8=-1!=window.navigator.userAgent.toUpperCase().indexOf("MSIE 8.0")?!0:!1,this.IME=!1,this.propertychange_val="",this.addBtnBeClick=!0},onRender:function(){var a=this;this.ui.input.bind("propertychange",function(b){a._inputHandler(b,a)})},isIE:function(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1},_inputFocusHandler:function(b){var c=a.$(b.currentTarget);this.ui.inputTip.empty(),this.ui.inputTip.html("仅支持中英文、数字与“_”，可输入14个字</p>"),c.parent().addClass("focusIn"),this.ui.placeholder.hide()},_inputBlurHandler:function(b){var c=a.$(b.currentTarget);this.ui.inputTip.empty(),c.parent().removeClass("focusIn"),this.model.get("tagName")||(c.parent().addClass("error"),this.ui.placeholder.show())},_inputStartHandler:function(){this.IME=!0},_inputEndHandler:function(a){this.IME=!1,this.isIE&&this._inputHandler(a,this)},_inputHandler:function(b,c){b.stopPropagation();var d=this,e=a.$(b.currentTarget),f=e.val(),g="";if(d.isIE8&&(d=c),!d.IME){if(d.isIE8){if(f==d.propertychange_val)return;d.propertychange_val=""}g=d._valVerify(f),d.propertychange_val=g,""!=g&&e.parent().removeClass("error"),g!=f&&e.val(g),d.model.set("tagName",g)}},_valVerify:function(a){for(var b="",c="",d=/^\w|[\u4E00-\u9FA5]|[\uFE30-\uFFA0]$/,e=/^[\u4E00-\u9FA5]|[\uFE30-\uFFA0]$/,f=0,g=0;g<a.length;g++)d.test(a[g])&&(b+=a[g]);for(var h=0;h<b.length;h++)f+=e.test(b.charAt(h).toString())?2:1,28>=f&&(c+=b[h]);return c}})}),define("views/work/tag/right-tag-manage-create-tag-view",["talent","templates/work","views/work/tag/right-tag-manage-create-tag-checkcolor-view","views/work/tag/right-tag-manage-create-tag-input-view"],function(a,b,c,d){return a.ItemView.extend({template:b["work/tag/right-tag-manage-create-tag"],className:"create-tag-dialog",ui:{checkColorWrap:"[data-name=check-color-wrap]",tagNameWrap:"[data-name=tag-name-wrap]",checkBox:"div.check-box"},events:function(){var a={};return a["click "+this.ui.div]="_clickCreateTagBtnHanler",a["click "+this.ui.checkBox]="_clickShareBtnHanler",a},templateHelpers:function(){return{hasDirectSubs:this.settings.hasDirectSubs}},initialize:function(a){this.settings=a},onRender:function(){this._renderCheckColorView(),this._renderTagNameView()},_renderCheckColorView:function(){this.checkColorBoxView&&this.checkColorBoxView.close(),this.checkColorBoxView=new c({model:this.model}),this.ui.checkColorWrap.append(this.checkColorBoxView.render().$el)},_renderTagNameView:function(){this.tagInputView&&this.tagInputView.close(),this.tagInputView=new d({model:this.model}),this.ui.tagNameWrap.append(this.tagInputView.render().$el)},_clickShareBtnHanler:function(b){var c=a.$(b.currentTarget);c.hasClass("active")?(c.removeClass("active"),this.model.set("shareTypes","")):(c.addClass("active"),this.model.set("shareTypes","1"))}})}),define("views/work/tag/right-tag-manage-view",["talent","templates/work","views/work/tag/right-tag-manage-tagbox-view","views/work/tag/right-tag-manage-create-tag-view","$.modal","$.infotip"],function(a,b,c,d){return a.ItemView.extend({template:b["work/tag/right-tag-manage"],className:"",ui:{tagContainer:"[data-name=tag-container]",createTagBtn:"[data-name=create-tag]"},events:function(){var a={};return a["click "+this.ui.createTagBtn]="_clickCreateTagBtnHanler",a},templateHelpers:function(){return{createTagBtnClick:this.collection.where({getWay:1}).length<50?!0:!1}},initialize:function(a){var b=this;this.settings=a||{},this.collection.on("remove",function(){b._dealNewTagBtnStatus()}),this.hasDirectSubs=this.settings.hasDirectSubs,this.createTagBtnClick=this.collection.where({getWay:1}).length<50?!0:!1},onRender:function(){this._renderView(),a.$(".tipsy").remove(),this.ui.createTagBtn.tipsy({gravity:"e"})},_renderView:function(){this.rightTagManageTagboxView&&this.rightTagManageTagboxView.close(),this.rightTagManageTagboxView=new c({collection:this.collection,hasDirectSubs:this.hasDirectSubs}),this.listenTo(this.rightTagManageTagboxView,"deleteTag",function(a){this.trigger("deleteTag",a),this._dealNewTagBtnStatus()}),this.ui.tagContainer.append(this.rightTagManageTagboxView.render().$el)},_dealNewTagBtnStatus:function(){this.collection.where({getWay:1}).length<50?(this.createTagBtnClick=!0,this.ui.createTagBtn.removeClass("disabled")):(this.createTagBtnClick=!1,this.ui.createTagBtn.addClass("disabled"))},_clickCreateTagBtnHanler:function(){function b(a,b){return Math.floor(Math.random()*(b-a+1))+a}var c=this,d=this.hasDirectSubs?175:125;this.createTagBtnClick&&(this.createModel=new a.Model,this.createModel.set("color",b(1,6)),this.createModel.on("change:tagName",function(){c.createModel.get("tagName")?c.crateTagDialog&&c.crateTagDialog.modal("okToggle"):c.crateTagDialog&&c.crateTagDialog.modal("okToggle","disabled")}),this.crateTagDialog=$.confirm({title:"创建新的标签",body:this._renderCreateTagDialog(),height:d,width:"auto",backdrop:"static",okHide:function(){var a=this,b=c.createModel.toJSON(),d=a.$element.find("[data-ok=modal]");return b.tagName?(c.collection.findWhere({getWay:1,tagName:b.tagName})&&(d.infotip({animation:!1,type:"attention",trigger:"manual",placement:"top",align:"right",container:a.$element,hasfoot:!1,html:!0,body:'<div><span class="icon-dialog-warn" style="font-size: 18px; margin-right: 10px; vertical-align: text-bottom;"></span>该标签已存在！</div>'}),d.infotip("show")),c._psotAddTagData().done(function(){a.$element.find("[data-name=input]").attr("disabled","disabled"),d.infotip({animation:!1,type:"attention",trigger:"manual",placement:"top",align:"right",container:a.$element,hasfoot:!1,html:!0,body:'<div><span class="icon-dialog-success" style="font-size: 18px; margin-right: 10px; vertical-align: text-bottom;"></span>发布成功！</div>'}),d.infotip("show"),c.crateTagDialog&&c.crateTagDialog.modal("okToggle","disabled"),d.on("hidden",function(){c.crateTagDialog.modal("hide")})}),!1):(this.$element.find("[data-name=input]").parent().addClass("error"),!1)},shown:function(){var a=$(this).find(".tu-input-default").width();$(this).find("[data-name=input]").width(a)}}),this.createModel.get("tagName")||c.crateTagDialog&&c.crateTagDialog.modal("okToggle","disabled"))},_renderCreateTagDialog:function(){return this.createTagView&&this.createTagView.close(),this.createTagView=new d({model:this.createModel,hasDirectSubs:this.hasDirectSubs}),this.listenTo(this.createTagView,"changeColor",function(){}),this.createTagView.render().el},_psotAddTagData:function(){var b={tagName:this.createModel.get("tagName"),color:this.createModel.get("color"),shareTypes:this.createModel.get("shareTypes")||""},c=this,d=$.Deferred();return a.app.request("WorkTag:tagAdd",b).done(function(a){a.beCheck=!0,a.getWay=1,a.shareType=c.createModel.get("shareTypes"),a.showOrter="1"==c.createModel.get("shareTypes")?!0:!1,c.collection.unshift(a),c._dealNewTagBtnStatus(),d.resolve()}).fail(function(){}),d.promise()},_showTipDialog:function(a,b,c){this.Dialog&&this.Dialog.close(),this.Dialog=new TitaWidget.TDialogView({type:"tipsy",skin:"skin2",sure:c.sure,cancel:c.cancel,sureText:"确定",cancelText:"取消",maxWidth:"400",minWidth:"400",showClosed:!0}),c.container.append(this.Dialog.render().$el),this.listenTo(this.Dialog,"hide",function(){c.closeCallback&&c.closeCallback()}),this.Dialog.show(b,a,{pos:c.pos,className:c.className,container:c.container,autoHide:c.autoHide||!1,topBias:c.topBias||0,leftBias:c.leftBias||0})}})}),define("views/work/tag/right-container-view",["talent","templates/work","views/work/tag/right-works-view","views/work/tag/right-tag-manage-view"],function(a,b,c,d){return a.ItemView.extend({template:b["work/tag/right-container"],className:"tag-right-manage",modelEvents:{change:"_renderViewByRelation"},onRender:function(){this._renderViewByRelation()},_renderViewByRelation:function(){var a=this.model.get("relation");1==a?this._renderWorkItems():2==a&&this._getTagManageData()},_renderWorkItems:function(){this.closeVeiw(),this.rightWorksView=new c({model:this.model}),this.$el.append(this.rightWorksView.render().$el)},_getTagManageData:function(){var b=this;a.app.request("WorkTag:getTagAll").done(function(a){b._renderTagManage(a)}).fail(function(){})},_renderTagManage:function(b){var c=b.tagList;c.length&&a._.each(c,function(a){a.beCheck=!0,(2==a.getWay||1==a.shareType||""!=a.objCount)&&(a.showOrter=!0)}),this.closeVeiw(),this.rightTagManageView=new d({model:this.model,hasDirectSubs:b.hasDirectSubs,collection:new a.Collection(c)}),this.listenTo(this.rightTagManageView,"deleteTag",function(a){this.trigger("deleteTag",a)
}),this.$el.append(this.rightTagManageView.render().$el)},closeVeiw:function(){this.rightWorksView&&this.rightWorksView.close(),this.rightTagManageView&&this.rightTagManageView.close()}})}),define("views/work/tag/index-page-view",["talent","templates/work","views/work/tag/siderbar-view","views/work/tag/right-container-view"],function(a,b,c,d){var e=a.Layout.extend({template:b["work/tag/index-page"],className:"_tt_layout_tag_manage",regions:{tabnav:"[data-name=tabnav]",container:"[data-name=container]"},ui:{tabnav:"[data-name=tabnav]"},onShow:function(){var b=this;a.app.request("history:getQueryObject").done(function(a){b.routerData=a,b._getMyUsedTag()}),this._setClientHeight()},_getMyUsedTag:function(){var b=this;a.app.request("WorkTag:getMyUsedTag").done(function(a){b._judgeData(a)})},_judgeData:function(b){var c=(this.routerData,b.tagList);a._.isEmpty(this.routerData)&&(c&&c.length?this.routerData=a._.extend({relation:1,pageIndex:1,pageSize:20,tagId:c[0].id,tagName:c[0].tagName},this.routerData):this.routerData.relation=2),this._renderSiderbar(c,this.routerData),this._renderRightContainerView()},_renderSiderbar:function(b,d){this.siderbarView&&this.siderbarView.close(),this.siderbarView=new c({collection:new a.Collection(b),model:new a.Model(d)}),this.listenTo(this.siderbarView,"clickUsedTag",function(b){var c=b.find("a").attr("href"),d=b.find("[data-name=tagName]").html(),e=a.Context.parseUrl(c);e.tagName=d,this.rightContainerView&&this.rightContainerView.model.set(e)}),this.listenTo(this.siderbarView,"clickTagManage",function(){this.rightContainerView&&this.rightContainerView.model.set({relation:2})}),this.tabnav.show(this.siderbarView)},_renderRightContainerView:function(){this.rightContainerView&&this.rightContainerView.close(),this.rightContainerView=new d({model:new a.Model(this.routerData)}),this.listenTo(this.rightContainerView,"deleteTag",function(a){this.siderbarView&&this.siderbarView.delTag(a)}),this.container.show(this.rightContainerView)},_setClientHeight:function(){var b=this.ui.tabnav,c=a.Context.setMainRegionsHeight;c(b);var d=a._.debounce(function(){c(b)},300);$(window).off("resize.Work-Tag-Index-Page-View"),$(window).on("resize.Work-Tag-Index-Page-View",d)}});return a.BasePageView.extend({mainViewClass:e,pageTitle:"按标签查看",layout:window.top==window?"master-layout":"empty-layout",hideSidebar:window.top==window?!1:!0,layoutViewOptions:{hideSubMenu:!1}})}),define("views/work/implementation/report-work-item-view",["talent","templates/work","$.tipsy"],function(a,b){return a.ItemView.extend({template:b["work/implementation/report-work-item"],className:"panel-item",ui:{prevMile:".switch-milepost.prev",nextMile:".switch-milepost.next",showMoreContent:".show-more",mileList:".milepost-list .list-milepost"},events:function(){var a={};return a["click "+this.ui.showMoreContent]="_showMoreContent",a["click "+this.ui.prevMile]="_showPrevMile",a["click "+this.ui.nextMile]="_showNextMile",a},initialize:function(){var a=this.model.get("workMileStones").length;this.model.set({currentYear:(new Date).getUTCFullYear(),statusValue:{1:"未开始",2:"未完成-当前",3:"未完成-延期",4:"已完成-按期",5:"已完成-延期"}}),this.model.set(a>5?{showFromIndex:0,showToIndex:4,viewChart:!1,showMileTotal:5,allMilesLen:a}:{showFromIndex:0,showToIndex:a-1,viewChart:!1,showMileTotal:a,allMilesLen:a}),this._isShowNextPrev()},onRender:function(){var b=this;this.model.get("viewChart")&&this._showCharts(),a.$(".tipsy").remove(),this.$el.find("[original-title]").tipsy({gravity:"s"}),this._getMileItemWidth(),$(window).on("resize",a._.debounce(function(){b._getMileItemWidth()},300))},onShow:function(){this._getMileItemWidth()},onClose:function(){a.$(".tipsy").remove()},_showCharts:function(){var a=this,b=[{name:"已完成-按期",color:"#58C583"},{name:"已完成-延期",color:"#FF9662"},{name:"未完成-当前",color:"#99C8F2"},{name:"未完成-延期",color:"#FF7777"}];require(["highCharts"],function(){var c=a.model.get("workMileStones");a.$el.find(".mile-chart[data-index]").each(function(a,d){var e=c[$(d).data("index")];b[3].y=Math.round(100*e.unfinishTaskDelayTotal/(e.taskTotal||1)),b[2].y=Math.round(100*e.unfinishTaskOnTimeTotal/(e.taskTotal||1)),b[0].y=Math.round(100*e.finishTaskOnTimeTotal/(e.taskTotal||1)),b[1].y=Math.round(100*e.finishTaskDelayTotal/(e.taskTotal||1));for(var f=b[0].y,g="",h=0;3>=h;h++)if(0!=b[h].y){b[h].sliced=!0,b[h].selected=!0,g=b[h].color,f=b[h].y;break}$(d).highcharts({chart:{type:"pie",width:100,height:100,backgroundColor:"#F6F8F9"},credits:{enabled:!1},title:{text:f+"%",align:"center",style:{fontSize:"26px",fontFamily:"Arial",fontWeight:"bold",color:g},y:50},tooltip:{enabled:!0,pointFormat:"{series.color}",valueSuffix:"%",followPointer:!0,style:{color:"#333333",fontSize:"12px",padding:"4px"}},plotOptions:{pie:{allowPointSelect:!1,cursor:"pointer",showInLegend:!0,size:100,innerSize:70,center:[40,30],slicedOffset:0,point:{events:{legendItemClick:function(){return!1}}},events:{click:function(a){var b=a.point.y;i.setTitle({text:b+"%",style:{fontSize:"26px",fontFamily:"Arial",color:a.point.color}})}}}},legend:{enabled:!1},xAxis:{categories:["未完成-延期","未完成-当前","已完成-按期","已完成-延期","未开始"]},series:[{type:"pie",name:"",data:b}]}).show();var i=$(d).highcharts()})}),this._setMileChartHeight()},_isShowNextPrev:function(){var a=this.model.toJSON();this.model.set({showPrev:!1,showNext:!1}),5==a.showMileTotal&&a.showToIndex+1<a.allMilesLen&&this.model.set({showNext:!0}),5==a.showMileTotal&&a.showFromIndex>0&&this.model.set({showPrev:!0})},_getMileItemWidth:function(){var a=this.ui.mileList.width(),b=this.model.get("showMileTotal"),c=Math.floor(a/b)-5;(2==b||3==b)&&(c-=1),this.$el.find(".chart-milepost-item").width(c)},_showPrevMile:function(){var a=this.model.toJSON();return 0==a.showFromIndex?!1:(this.model.set({showFromIndex:a.showFromIndex-5,showToIndex:a.showToIndex-5}),this._isShowNextPrev(),void this.render())},_showNextMile:function(){var a=this.model.toJSON();return a.showToIndex+1==a.allMilesLen?!1:(this.model.set({showFromIndex:a.showFromIndex+5,showToIndex:a.showToIndex+5}),this._isShowNextPrev(),void this.render())},_setMileChartHeight:function(){if(this.model.get("viewChart")){var b=[];this.$el.find(".chart-item").each(function(a,c){b.push($(c).height())}),this.$el.find(".milepost-list").height(96+a._.max(b)).find(".chart-item").height(a._.max(b))}},_showMoreContent:function(){this.model.get("viewChart")?this.model.set("viewChart",!1):this.model.set("viewChart",!0),this.render(),this._getMileItemWidth(),this._setMileChartHeight()}})}),define("views/work/implementation/report-work-composite-view",["talent","templates/work","views/work/implementation/report-work-item-view","views/common/empty-view"],function(a,b,c){return a.CompositeView.extend({template:b["work/implementation/report-work-composite"],itemViewContainer:".report-work-list",itemView:c,ui:{showMore:"[data-name=show-more]",legendInfoTip:".legend-info-tip",legendTip:".legend-tip"},events:function(){var a={};return a["click "+this.ui.showMore]="showMoreWork",a},initialize:function(b){this.model.set("total",b.total),this.model.set("totalWork",b.models.length),this.collection=new a.Collection(0==b.total?[]:b.models),this.submitParam=b.submitParam},onRender:function(){var a=this.model.get("total"),b=this.model.get("totalWork");b==a&&this.ui.showMore.hide()},onClose:function(){},showMoreWork:function(){var b=this;this.submitParam.pageNum=this.submitParam.pageNum+1;this.model.get("total");a.app.request("Report:getWorkImplementation",this.submitParam).done(function(a){a.models.length>0&&(b.model.set("totalWork",a.models.length),b.collection.add(a.models)),a.models.length<10&&b.ui.showMore.hide()})},_showLegendTip:function(a){var b=$(a.currentTarget),c=b.offset();this.ui.legendInfoTip.css({position:"absolute",top:c.top+30+"px",left:c.left-70+"px","z-index":1e3}).show()},_hideLegendTip:function(){this.ui.legendInfoTip.hide()}})}),define("views/common/search-filter/search-filter-date-view",["talent","templates/common","moment","momentZH","TitaWidget"],function(a,b,c,d,e){return a.ItemView.extend({template:b["common/search-filter/search-filter-date"],defaults:{startDate:c().startOf("month").format("YYYY/MM/DD"),endDate:c().endOf("month").format("YYYY/MM/DD")},ui:{content:".input-default"},events:function(){var a={};return a["click "+this.ui.content]="_timeBindPicker",a},initialize:function(){this.model.get("startDate")||this.model.set("startDate",this.defaults.startDate),this.model.get("endDate")||this.model.set("endDate",this.defaults.endDate)},onRender:function(){},_timeBindPicker:function(a){var b=this;a.stopPropagation();var c=Talent.$(a.currentTarget);this.ui.content.addClass("input-focus"),this.dateTimePickerView&&this.dateTimePickerView.close(),this.dateTimePickerView=new e.DateTimePickerView({rangepickerOptions:{startDate:this.model.get("startDate"),endDate:this.model.get("endDate"),format:"YYYY/MM/DD",timePicker:!1},isShowDateView:!0,isShowCycleView:!1,isShowLongView:!1,isShowTab:!1,leftBias:0}),this.listenTo(this.dateTimePickerView,"sure",function(a,c){var d=c.startDate,e=c.endDate;b.model.set("startDate",d),b.model.set("endDate",e),b.ui.content.html(d+"-"+e).addClass("input-blur"),b.trigger("changeDate",d,e),b.ui.content.removeClass("input-focus")},this),this.listenTo(this.dateTimePickerView,"cancel",function(){b.ui.content.removeClass("input-focus")}),this.$el.append(this.dateTimePickerView.render().el),this.dateTimePickerView.onShow(),this.dateTimePickerView.show(c,{container:this.$el,pos:"bottomLeft",leftBias:0})},onClose:function(){this.ui.content.data("daterangepicker")&&this.ui.content.data("daterangepicker").remove()}})}),define("views/common/search-filter/search-filter-staff-view",["talent","templates/common","$.tipsy","views/common/empty-view","tdialog"],function(a,b,c,d,e){var f=a.ItemView.extend({tagName:"div",className:"staff",template:b["common/search-filter/search-filter-staff"],ui:{checkbox:"a.checkbox"},initialize:function(){this.model.set("checked",!0)},modelEvents:{"change:checked":"render"},events:function(){var a={};return a["click "+this.ui.checkbox]="_changeCheckbox",a},_changeCheckbox:function(){this.trigger("click")},onRender:function(){this.$el.find("[original-title]").tipsy({gravity:"s"});var a=this.model.get("Type")?this.model.get("Type"):0;a&&this.$el.addClass("dotted_radius_parent")}});return a.CompositeView.extend({defaults:{emptyContext:"该部门还没有人哦"},itemView:f,template:b["common/search-filter/staff-list-composite"],itemViewContainer:".report_desc",emptyView:d,ui:{allChecked:'a[data-name="all-checked"]'},events:function(){var a={};return a["click "+this.ui.allChecked]="_changeChecked",a},collectionEvents:{},initialize:function(){this.userInfo=a.Context.getUserInfo()},onRender:function(){var a=this;this.on("itemview:click",function(b){a._changeCollection(b)});var b=_.map(this.collection.models,function(a){return a.get("Id")});this.model.set("userIds",b)},_changeChecked:function(b){var c=a.$(b.currentTarget);c.hasClass("checkbox-checked")?c.removeClass("checkbox-checked"):c.addClass("checkbox-checked");var d=c.hasClass("checkbox-checked")?!0:!1;a._.map(this.collection.models,function(a){a.set("checked",d)}),this._changeModelUserIds()},_changeCollection:function(a){a.model.set("checked",!a.model.get("checked"));var b=this.collection.where({checked:!0});0==b.length&&(a.model.set("checked",!0),this.ui.allChecked&&this.ui.allChecked.removeClass("checkbox-checked")),b.length==this.collection.length?this.ui.allChecked&&this.ui.allChecked.addClass("checkbox-checked"):this.ui.allChecked&&this.ui.allChecked.removeClass("checkbox-checked"),this._changeModelUserIds()},_tipMessage:function(a,b,c){this.delDialog||(this.delDialog=new e({type:"tipsy"}),$("body").append(this.delDialog.render().$el)),this.delDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:c||"warn"})},_changeModelUserIds:function(){var a=this.collection.where({checked:!0}),b=_.map(a,function(a){return a.get("Id")});this.model.set("userIds",b)},getStatus:function(){return this.model.get("userIds")||this.ui.allChecked.click(),this.model.get("userIds")},itemViewOptions:function(){return{emptyContext:this.defaults.emptyContext}},templateHelpers:function(){var a=this.collection.length,b=!0;return(0==a||1==a)&&(b=!1),{isShowAll:b}}})}),define("views/common/search-filter/search-filter-type-view",["talent","templates/common","views/common/plugins/class/class-tree-component-view"],function(a,b,c){return a.ItemView.extend({template:b["common/search-filter/search-filter-type"],initialize:function(){},ui:{inputLabel:".input-default"},modelEvents:{"change:typeList":"render"},events:function(){var a={};return a["click "+this.ui.inputLabel]="_onLabelClick",a},_onLabelClick:function(b){b.stopPropagation();a.$(b.currentTarget);this.ui.inputLabel.addClass("input-focus"),this._renderTypePopView()},_renderTypePopView:function(){var b=this;this.classTreeComponentView&&this.classTreeComponentView.close(),this.classTreeComponentView=new c({checkedClassCollection:new a.Collection(this.model.get("typeList")||[]),isShowSearch:!0,to_userId:this.model.get("UserIds"),title:"选择类别",pluginType:1}),this.classTreeComponentView.render(),this.$el.append(this.classTreeComponentView.$el),this.classTreeComponentView.setPositon(this.ui.inputLabel,this.$el),this.listenTo(this.classTreeComponentView,"close",function(){b.$el.find(".input-default").removeClass("input-focus")}),this.listenTo(this.classTreeComponentView,"checkedClass",function(a){b.model.set("typeList",a)}),this.listenTo(this.classTreeComponentView,"emptyClass",function(){b.model.set("typeList",[])})}})}),define("views/common/search-filter/search-filter-status-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/search-filter/search-filter-status"],ui:{checkStatus:'[data-name="status"]',checkAll:'[data-name="all"]'},className:"report-status",defaults:{ing:!0,done:!0,postbone:!0,cancel:!0,unstart:!0,stop:!0},events:function(){var a={};return a["click "+this.ui.checkStatus]="_checkStatus",a["click "+this.ui.checkAll]="_checkAll",a},initialize:function(a){this._initOptions(a),this.mapping={unstart:0,ing:1,done:2,postbone:3,cancel:4,stop:6}},modelEvents:{change:"render"},_setMappingStatus:function(){var a=this.model.toJSON(),b=[];a.ing&&b.push(1),a.done&&b.push(2),a.postbone&&b.push(3),a.cancel&&b.push(4),a.unstart&&b.push(0),a.stop&&b.push(6),a.ing||a.done||a.postbone||a.cancel||a.unstart||a.stop||b.push(1,2,3,4,0,6),this.model.set("status",b,{silent:!0})},_initOptions:function(b){var c=a._.extend({},this.defaults,b,this.model.toJSON());checkAll=!1,c.ing&&c.done&&c.postbone&&c.cancel&&c.unstart&&c.stop&&(checkAll=!0),c.checkAll=checkAll,this.model.set(c),this._setMappingStatus()},_checkStatus:function(a){var b=$(a.currentTarget),c=b.attr("data-type"),d=+b.attr("data-status"),e=this.model.toJSON(),f=!1;e[c]=!d,e.ing&&e.done&&e.postbone&&e.cancel&&e.unstart&&e.stop&&(f=!0),e.checkAll=f,this.model.set(e),this._setMappingStatus()},_checkAll:function(a){var b=$(a.currentTarget),c=(b.attr("data-type"),!+b.attr("data-status")),d=this.model.toJSON();d.checkAll=c,d.ing=d.done=d.postbone=d.cancel=d.unstart=d.stop=c,this.model.set(d),this._setMappingStatus()}})}),define("views/common/search-filter/search-filter-range-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/search-filter/search-filter-range"],ui:{checkRange:'[data-name="range"]',checkAll:'[data-name="range-all"]'},defaults:{pass:!0,charge:!0,join:!0},modelEvents:{change:"render"},className:"report-range",events:function(){var a={};return a["click "+this.ui.checkRange]="_checkRange",a["click "+this.ui.checkAll]="_checkAll",a},initialize:function(a){this.mapping={charge:1,join:2,pass:3},this._initOptions(a)},_initOptions:function(b){var c=a._.extend({},this.defaults,b,this.model.toJSON());checkAll=!1,c.pass&&c.charge&&c.join&&(checkAll=!0),c.checkRangeAll=checkAll,this.model.set(c),this._setStatus()},_setStatus:function(){var a=this.model.toJSON(),b=[];a.pass&&b.push(3),a.join&&b.push(2),a.charge&&b.push(1),a.pass||a.charge||a.join||b.push(1,2,3),this.model.set("ranges",b,{silent:!0})},_checkRange:function(a){var b=$(a.currentTarget),c=b.attr("data-type"),d=+b.attr("data-status"),e=this.model.toJSON(),f=!1;e[c]=!d,e.pass&&e.charge&&e.join&&(f=!0),e.checkRangeAll=f,this.model.set(e),this._setStatus()},_checkAll:function(a){var b=$(a.currentTarget),c=(b.attr("data-type"),!+b.attr("data-status")),d=this.model.toJSON();d.checkRangeAll=c,d.pass=d.charge=d.join=c,this.model.set(d),this._setStatus()}})}),define("views/common/search-filter/search-filter-key-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/search-filter/search-filter-key"],initialize:function(){},ui:{inputLabel:".input-default",input:"input"},modelEvents:{"change:typeList":"render"},events:function(){var a={};return a["click "+this.ui.inputLabel]="_onLabelClick",a["blur "+this.ui.input]="_onInputBlur",a},_onLabelClick:function(b){b.stopPropagation();a.$(b.currentTarget);this.ui.inputLabel.addClass("input-focus")},_onInputBlur:function(){this.ui.inputLabel.removeClass("input-focus")},onRender:function(){var a=this;"placeholder"in document.createElement("input")?window.ActiveXObject||"ActiveXObject"in window?this.$el.find("input").focus(function(a){var b=$(a.currentTarget);b.removeClass("placeholder")}).blur(function(b){var c=$(b.currentTarget);""==c.val()&&c.addClass("placeholder"),a.model.set("keyWord",c.val())}).each(function(a,b){($(b).val()==$(b).attr("placeholder")||""==$(b).val())&&$(b).addClass("placeholder")}):this.$el.find("input").blur(function(b){var c=$(b.currentTarget);a.model.set("keyWord",c.val())}):this.$el.find("input").focus(function(a){var b=$(a.currentTarget);b.val()==b.attr("placeholder")&&b.val("").removeClass("placeholder")}).blur(function(b){var c=$(b.currentTarget);a.model.set("keyWord",c.val()),""==c.val()&&c.val(c.attr("placeholder")).addClass("placeholder")}).each(function(a,b){""==$(b).val()&&$(b).val($(b).attr("placeholder")).addClass("placeholder")})}})}),define("views/common/search-filter/search-filter-component-view",["talent","templates/common","views/common/search-filter/search-filter-date-view","views/common/search-filter/search-filter-staff-view","views/common/search-filter/search-filter-type-view","views/common/search-filter/search-filter-status-view","views/common/search-filter/search-filter-range-view","views/common/search-filter/search-filter-key-view"],function(a,b,c,d,e,f,g,h){return a.Layout.extend({template:b["common/search-filter/search-filter-component"],defaults:{TimeLabelText:"时间",StaffLabelText:"人员",TypeLabelText:"类别",StatusLabelText:"状态",RangeLabelText:"范围",KeyLabelText:"名称",keyPlaceHolder:"输入关键字",keyWord:"",isShowTime:!0,isShowStaff:!0,isShowType:!0,isShowStatus:!0,isShowRange:!0,isShowKey:!1},regions:{date:'div[data-name="report-date"]',staff:'div[data-name="report-staff"]',typeName:'div[data-name="report-type"]',typePop:'div[data-name="report-type-pop"]',statusFilterArea:'div[data-name="report_status_filter"]',rangeFilterArea:'div[data-name="report_range_filter"]',keyFilterArea:'div[data-name="report_key_filter"]'},modelEvents:{change:"_changeData"},initialize:function(b){var c=a._.extend({},this.defaults,b);this.model.set(c)},onShow:function(){this.model.get("isShowTime")&&this._renderDateItemView(),this.model.get("isShowStaff")&&this._renderStaffCompositeView(),this.model.get("isShowType")&&this._renderTypeItemView(),this.model.get("isShowStatus")&&this._renderStatusFilterView(),this.model.get("isShowRange")&&this._renderRangeFilterView(),this.model.get("isShowKey")&&this._renderKeyFilterView(),this._changeData()},_changeData:function(){var a=this.model.toJSON(),b={pass:a.pass,charge:a.charge,join:a.join},c={unstart:a.unstart,ing:a.ing,done:a.done,postbone:a.postbone,cancel:a.cancel,stop:a.stop};this.trigger("changeFilterData",b,c,a.userIds)},_renderStatusFilterView:function(){var a=this.statusFilterView=new f({model:this.model});this.statusFilterArea.show(a)},_renderRangeFilterView:function(){var a=this.rangeFilterView=new g({model:this.model});this.rangeFilterArea.show(a)},_renderTypeItemView:function(){this.typeItemView=new e({model:this.model}),this.typeName.show(this.typeItemView)},_renderDateItemView:function(){var a=new c({model:this.model});this.date.show(a)},_renderStaffCompositeView:function(){this.staffCompositeView=new d({model:this.model,collection:this.collection}),this.staff&&this.staff.show(this.staffCompositeView)},_renderKeyFilterView:function(){this.reportFilterKeyView=new h({model:this.model,collection:this.collection}),this.keyFilterArea&&this.keyFilterArea.show(this.reportFilterKeyView)}})}),define("views/work/implementation/report-work-view",["talent","templates/work","views/work/implementation/report-work-composite-view","tdialog","views/common/empty-view","moment","momentZH","views/common/search-filter/search-filter-component-view","views/common/gantt/gantt-layout-view"],function(a,b,c,d,e,f,g,h,i){return a.Layout.extend({template:b["work/implementation/report-work"],regions:{chart:'[data-name="report-chart"]',filterComponent:'[data-name="report-filter-component"]'},ui:{chartBtn:'[data-name="work-chart"]',gantBtn:'[data-name="work-gant"]',legendTip:".legend-tip",legendInfoTip:".legend-info-tip",chart:'[data-name="report-chart"]'},modelEvents:{"change:data":"_renderData"},events:function(){var a={};return a["mouseenter "+this.ui.legendInfoTip]="_showLegendTip",a["mouseleave "+this.ui.legendInfoTip]="_hideLegendTip",a["mouseenter "+this.ui.legendTip]="_showLegendTip",a["mouseleave "+this.ui.legendTip]="_hideLegendTip",a["click "+this.ui.chartBtn]="_viewChart",a["click "+this.ui.gantBtn]="_viewGant",a},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.model.set({startDate:f().add("years",-1).format("YYYY/MM/DD"),endDate:f().format("YYYY/MM/DD")})},onRender:function(){{var a=this.model.get("routerData");a.sidebar_type,a.page_type}this._onRenderFilterComponetView()},onShow:function(){},_viewChart:function(b){if(0==this.model.get("userIds").length){var d=a.$(b.currentTarget);return this._tipMessage(d,"没有数据","warn"),this._renderEmptyView(),!1}var e=this._getRequestData(),f=this;a.app.request("Report:getWorkImplementation",e).done(function(a){f.$el.find(".legend-info").show(),0==a.total?f._renderEmptyView():(a.submitParam=e,f.workListView=new c(a),f.chart.show(f.workListView))})},_viewGant:function(){var b=this._getRequestData(),c=this;a.app.request("Project:getImplementationGant",b).done(function(a){var b=Talent.Context.getApiUrl("Work/GrantSubTask"),d=a.tasks,e=0;e=d.length>20?620:28*d.length+120;var f=c.ui.chart;c.gantView=new i({width:f.width(),height:e,getSubUrl:b,data:a}),c.listenTo(c.gantView,"gantt:resizeend",function(){}),c.chart.show(c.gantView)})},_showLegendTip:function(){var a=this.ui.legendTip.offset();clearTimeout(this.legendTime),this.ui.legendInfoTip.css({position:"absolute",top:a.top+22+"px",left:a.left-70+"px","z-index":1e3}).show()},_hideLegendTip:function(){var a=this;this.legendTime=setTimeout(function(){a.ui.legendInfoTip.hide()},500)},_onRenderFilterComponetView:function(){var a=this.model.get("routerData"),b=(a.sidebar_type,a.page_type,{model:this.model,collection:this.collection,TimeLabelText:"起止时间",StaffLabelText:"负责人",KeyLabelText:"项目名称",keyPlaceHolder:"输入关键字",isShowTime:!0,isShowStaff:!0,isShowType:!1,isShowStatus:!1,isShowRange:!1,isShowKey:!0});this.filterComponentView=new h(b),this.filterComponent.show(this.filterComponentView)},_renderData:function(){this._renderEmptyView()},_renderEmptyView:function(){var a=new e({emptyContext:"暂无数据"});this.chart.show(a)},_getRequestData:function(){this._appendHtml();var b=this.model.get("routerData"),c=1;"organ"==b.page_type&&(c=2);var d=this.model.toJSON();return{userDepartmentId:a.Context.getUserInfo().DepartmentId,toUserDepartmentId:d.deptId,startDate:d.startDate,endDate:d.endDate,userIds:d.userIds.join(","),keyWord:d.keyWord,pageNum:1,pageSize:10,type:c}},_appendHtml:function(){this.$el.find('div[data-name="report-chart"]').html('<div class="_tt_loading_m">努力加载中…</div>')},_tipMessage:function(a,b,c){this.delDialog||(this.delDialog=new d({type:"tipsy"}),$("body").append(this.delDialog.render().$el)),this.delDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:c||"warn"})}})}),define("views/common/treeview/tree-view",["talent","templates/common"],function(a,b){var c=a.CompositeView.extend({template:b["common/treeview/tree-item"],tagName:"li",initialize:function(){this.collection=this.model.children},appendHtml:function(a,b){a.$el.find("ul:first").append(b.el)},onRender:function(){this.$el.attr({id:this.model.get("Id"),pid:this.model.get("PId"),"data-end":this.model.get("isEnd")})}}),d=a.CollectionView.extend({itemView:c,tagName:"ul",events:function(){var a={};return a["click ul"]="_ulHandler",a["click li"]="_checkHandler",a["click li span[data-name=toggle]"]="_toggleHandler",a},initialize:function(){this.activeFolder=this.$el.find("li:first")},onRender:function(){var a=this.$el.find("li:first");a.addClass("unfold")},_ulHandler:function(a){a.stopPropagation()},_toggleHandler:function(b){b.stopPropagation();var c=a.$(b.currentTarget).closest("li"),d=c.attr("data-end");"false"==d&&(c.hasClass("unfold")?c.removeClass("unfold"):c.addClass("unfold"))},_checkHandler:function(b){var c=a.$(b.currentTarget),d=c.closest("li"),e=d.find("div[data-name=title]:first");this.activeFolder=c,this.$el.find("div[data-name=title]").removeClass("active"),e.addClass("active"),this.trigger("checked",this.activeFolder,{id:parseInt(c.attr("id")),pId:parseInt(c.attr("pid")),name:e.html()})},onShow:function(){this.$el.find("li:first").addClass("unfold").find("div[data-name=title]:first").addClass("active")}});return Talent.ItemView.extend({template:a._.template("<div/>"),className:"tt_tree_view",onRender:function(){function b(d){a._.each(d,function(d){var e=d.Id,f=a._.where(c,{PId:e});return f=a._.compact(f),f.length?(d.children=f,d.isEnd=!1,void b(f)):(d.children=null,void(d.isEnd=!0))})}var c=this.model.get("data"),e=c[0],f=a._.where(c,{PId:e.PId});b(f);var g=Backbone.Model.extend({initialize:function(){var a=this.get("children");a&&(this.children=new h(a),this.unset("children"))}}),h=Backbone.Collection.extend({model:g});this.treeView=new d({collection:new h(f)}),this.listenTo(this.treeView,"checked",function(a,b){this.trigger("checked",a,b)},this),this.$el.html(this.treeView.render().el)}})}),define("views/work/implementation/index-page-view",["talent","templates/work","moment","momentZH","views/common/bs-tab/bs-tab","views/work/implementation/report-work-view","views/common/treeview/tree-view","views/common/empty-view","views/common/loading-view"],function(a,b,c,d,e,f,g,h,i){var j=a.Layout.extend({template:b["work/implementation/index-page"],className:"_tt_layout_subnav_fluid",sideBarTemplate:b["work/implementation/report-list-sidebar"],initialize:function(){this.userInfo=a.Context.getUserInfo();{var b=c().format("YYYY/M/DD").split("/");b[0],b[1]}this.model.set({deptId:this.userInfo.DepartmentId}),this.routerData={page_type:"group",sidebar_type:"myself"},a.Context.setPageTitle("项目执行情况"),this.depIdArray={},this.userCollection=new a.Collection},regions:{sideBar:"div[data-name='side-bar']",filterRegion:".report_container"},ui:{sideBar:"div[data-name='side-bar']"},onRender:function(){this.model.get("localDate");this._getRouterData(),this._renderPageSideBar(),this._renderByPageTypeView(),this._setClientHeight()},_getRouterData:function(){var b=this;a.app.request("history:getQueryObject").done(function(c){b.routerData=a._.extend({},b.routerData,c),"organ"==b.routerData.page_type&&(b.routerData.sidebar_type="")})},_renderLoadingView:function(){this.loadingView&&this.loadingView.close(),this.loadingView=new i,this.filterRegion.show(this.loadingView)},_renderByPageTypeView:function(){var a=this,b=this.routerData.page_type;this.sideBarTabView&&this.sideBarTabView.close(),this.reportWorkView&&this.reportWorkView.close(),"group"==b?(this._renderSideBar(),this._renderSearchView()):this._getDepartmentData().done(function(b){b&&(a._renderSideBarTreeview(b),a._renderSearchView())})},_renderSearchView:function(){var a=this,b=this.routerData.page_type;if("group"==b&&this._getMyGroupData(),"organ"==b){var c=this.model.get("deptId");if(!this.depIdArray[c])return void this._getStaffByDepIdData().done(function(){a._rendOrganByTabType()});this._rendOrganByTabType()}},_rendOrganByTabType:function(){var a=this.routerData.page_type;if("organ"==a){var b=this.model.get("deptId"),c=this.depIdArray[b];if(!c.length)return void this._renderEmptyView("该部门还没有下属")}this._renderWorkView()},_getMyGroupData:function(){var b=this,c=this.routerData.sidebar_type;"myself"==c?(this.userCollection.reset(this.userInfo),this._rendOrganByTabType()):(this.reportWorkView&&this.reportWorkView.close(),a.app.request("Membership:getSubordinateData",{id:this.userInfo.Id,type:0}).done(function(a){var a=a||[];return 1==a.length?void b._renderEmptyView():(b.userCollection.reset(1==a.length?[]:a),void b._rendOrganByTabType())}))},_getStaffByDepIdData:function(){var b=this,c=this.model.get("deptId"),d=new a.$.Deferred;return a.app.request("Staff:GetDepartmentUsers",{department_id:this.userInfo.DepartmentId,to_departmentId:c,type:2}).done(function(e){b.depIdArray[c]=new a.Collection(e&&e.length?e:[]),d.resolve(e)}).fail(function(a){d.reject(a)}),d},_renderPageSideBar:function(){var b=this,c=new e({el:this.$el.find(".subtab_ssw"),eventTriggerName:"Report-Index-Page-View-Sidebar-main"});a.app.vent.off("tab:Report-Index-Page-View-Sidebar-main:change"),a.app.vent.on("tab:Report-Index-Page-View-Sidebar-main:change",function(c){var d=a.Context.parseUrl(c.attr("href"));b.routerData.page_type=d.page_type,b.routerData.sidebar_type=("group"==b.routerData.page_type,"myself"),b._renderByPageTypeView()}),c.setDefault({page_type:this.routerData.page_type})},_renderSideBar:function(){var b=this;this.ui.sideBar.html(this.sideBarTemplate()),this.sideBarTabView=new e({el:this.$el.find("._tt_side_subnav"),eventTriggerName:"Report-Index-Page-View-Sidebar-group"}),a.app.vent.off("tab:Report-Index-Page-View-Sidebar-group:change"),a.app.vent.on("tab:Report-Index-Page-View-Sidebar-group:change",function(c){var d=a.Context.parseUrl(c.attr("href"));b.routerData.sidebar_type=d.sidebar_type,b._renderSearchView()}),this.sideBarTabView.setDefault({sidebar_type:this.routerData.sidebar_type})},_renderEmptyView:function(b){{var c=b||"暂无数据",d=this.routerData.page_type;this.userInfo.Role}if("organ"!=d||b||(c="领导可以按照组织查看部门工作汇总，请超管或<br />系统管理员在&nbsp;【同事页】&nbsp;中设置公司老板和部门领导"),"group"==d&&!b){var e=a.Context.getGlobal("tenant_function");c=e.IsUseSetOrg?'您还没有下属，请在&nbsp;<a href="#set?page_id=plan">我的团队设置</a>&nbsp;里添加下属':"您还没有下属，请联系超管设置"}var f=new h({emptyContext:c});this.filterRegion.show(f)},_renderWorkView:function(){var a=this.userCollection,b=this.routerData.page_type;if("organ"==b){var c=this.model.get("deptId");a=this.depIdArray[c]}this.model.set("routerData",this.routerData),this.reportWorkView=new f({model:this.model,collection:a}),this.filterRegion.show(this.reportWorkView)},_getDepartmentData:function(){var b=this,c=new a.$.Deferred;return a.app.request("Staff:getAllDeparts",{department_id:this.userInfo.DepartmentId}).done(function(a){c.resolve(a)}).fail(function(a){b._renderEmptyView(),c.reject(a)}),c},_renderSideBarTreeview:function(b){this.treeview=new g({model:new a.Model({data:b})}),this.listenTo(this.treeview,"checked",function(a,b){this.model.set({deptId:b.id}),this._renderSearchView(),this._setClientHeight()},this),this.listenTo(this.treeview,"clickfolder",function(){this._setClientHeight()},this),this.sideBar.show(this.treeview);var c=this.treeview.$el.find("li:first");this.model.set("deptId",c.attr("id")),c.find(".title_tv:first").addClass("active")},_setClientHeight:function(){var b=this.$el.find("._tt_layout_container"),c=a.Context.setMainRegionsHeight;c(b);var d=a._.debounce(function(){c(b)
},300);$(window).off("resize.Report-Index-Page-View"),$(window).on("resize.Report-Index-Page-View",d)},onClose:function(){a.app.vent.off("tab:Report-Index-Page-View-Sidebar-main:change"),a.app.vent.off("tab:Report-Index-Page-View-Sidebar-group:change"),$(window).off("resize.Report-Index-Page-View")}});return a.BasePageView.extend({mainViewClass:j,layout:window.top==window?"master-layout":"empty-layout"})}),define("views/work/index-page-view",["talent","templates/work","views/common/bs-tab/bs-tab","views/work/project-detail-layout","views/work/project-list-main-view","views/work/project-detail-top-item-view","views/work/dynamic-composite-view","views/common/file/file-composite-view","views/work/task-view","views/work/member-layout","views/work/project-list-sidebar-item-view","views/work/create/project-create-item-view","views/common/loading-view","views/work/permission-prevent/index-page-view","views/work/project-custom-sidebar-view","views/work/project-custom-detail-layout-view","views/common/membership/membership-tab-component","views/common/error-layout-message-view","$.paginate","moment","momentZH","tdialog","views/work/dynamic-composite-view","views/work/member-layout","views/work/statistics-view","views/work/project-milepost-view","views/common/gantt/gantt-layout-view","helpers/context","TitaWidget","views/work/tag/index-page-view","views/work/implementation/index-page-view"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D=new a.Model,E=a.Layout.extend({className:"tu-row-fuild",template:b["work/index-page"],regions:{sidebar:"#work_left_view",main:"#work_main_region"},initialize:function(){this.customTelent=B.getGlobal("tenant_function"),this.customWork=!1,this.customTelent&&this.customTelent.IsUseWork&&(this.customWork=this.customTelent.IsUseWork),this.i18n=B.getI18n(),this.iWork=this.i18n.work_1,this.globalCoustom=B.getGlobal("tenant_function"),this.userInfo=a.Context.getUserInfo(),this._getUsedNav()},_getUsedNav:function(){for(var b=B.getGlobal("navigations").titaWorkDetailNavigation,c=a._.sortBy(b,"score"),c=a._.pluck(c,"navigationValue"),d=a._.where(c,{isUse:!0}),e={"任务":"task","动态":"feed","文件":"file","人员":"user","统计":"statistics","操作记录":"operate","甘特图":"statisticsTasks","里程碑":"milepost"},f=0,g=d.length;g>f;f++)d[f].router=e[d[f].name];this.usedNav=d},onRender:function(){a.app.vent.off("detail:_tita_work:operate"),a.app.vent.on("detail:_tita_work:operate",this.renderPartialViewByRouter,this)},onShow:function(){a.app.vent.off("tab:_tita_work:change"),a.app.vent.on("tab:_tita_work:change",this.onTabClick,this);var b=this,c=a.app.request("history:getQueryObject");c.done(function(c){b.routerData=a._.isEmpty(c)||c.relation?a._.extend({relation:1,status:1,pageIndex:1},c):c,b.routerData.status=c.status||1,b.routerData.relation=c.relation||1,b.routerData.appId=c.app_id||1,b.routerData.appType=c.app_type||1,b.routerData.taskType=c.task_type?c.task_type:0,b.routerData.FeedId=c.FeedId?c.FeedId:0,b.routerData.to_user_id=c.to_user_id?c.to_user_id:b.userInfo.Id,b.custom_hideSidebar="true"==c.hidesidebar?!0:!1,b.custom_isEdit="false"==c.isoptedit?!1:!0,D.set("routerData",b.routerData),b._customConfig(),b.custom_hideSidebar?b.$el.addClass("work-hide-sidebar"):b.renderSidebar(),b.renderPartialViewByRouter()}),this._setClientHeight(),a._.splash("work"),setTimeout(function(){a.$("#BizQQWAP").hide()},4e3)},_customConfig:function(){var b=this.routerData;this.sidebarConfig={isShowSearch:!0,isShowImplement:a.Context.IsOpenWorkMilePost(),isShowOthers:this.userInfo.Id==b.to_user_id?!0:!1},this.projectListConfig={isShowApproval:1==b.relation?!0:!1,isShowCretae:!0},B.setPageTitle("tita-"+this.iWork),203==b.appType&&(a.app.vent.trigger("sidebar-view:click","#work?app_id=203&app_type=203"),this.sidebarConfig={isShowSearch:!1,isShowImplement:!1,isShowOthers:!1},this.projectListConfig={isShowApproval:!1,isShowCretae:!1},B.setPageTitle("招聘职位")),402==b.appType&&B.setPageTitle("目标管理")},_changeAvtar:function(){var b=this,c=this.routerData.to_user_id;c!=this.userInfo.Id&&a.app.request("User:getData",{ids:[c]}).done(function(a){var d=a[c];b.sidebarItemView.model.set("user",d)})},onTabClick:function(b){this.$el.parents(".tu-page-container").scrollTop(0);var c={};return b.attr("href")?c=B.parseUrl(b.attr("href")):b.attr("data-id")&&(c.work_id=b.attr("data-id")),c.status||a.$("body").animate({"scroll-top":0},500),c.appId=this.routerData.appId||1,c.appType=this.routerData.appType||1,c.taskType=this.routerData.taskType||0,c.to_user_id=this.routerData.to_user_id||this.userInfo.Id,this.routerData=c,c.detail_type?(this.detailModel.set("routerData",c),void this.renderProjectDetailMainRegion()):void this.renderPartialViewByRouter()},renderSidebar:function(){var b=this,c=this.routerData;if(!c.work_id||c.edit||!this.customWork){var d=({appId:c.appId,appType:c.appType,relation:c.relation,toUserId:c.to_user_id,status:1,isAll:!0},a._.extend({model:new a.Model({routerData:c,user:b.userInfo})},b.sidebarConfig));this.sidebarItemView=new k(d),this.sidebar&&this.sidebar.show(this.sidebarItemView),b._changeAvtar()}},renderPartialViewByRouter:function(){var a=this.routerData;if(a.create)return void(a.work_id?this._renderProjectEditView():this.renderProjectCreateView());if(this.customWork&&a.edit&&a.work_id)return void this._renderProjectEditView();if(a.work_id){if(this.customWork)return void this._renderCustomView();this.renderProjectDetailView()}else this.routerData.pageIndex=1,this.renderProjectListView();2!=this.routerData.status&&this.sidebarItemView&&this.sidebarItemView.renderListByworkid(a),this.sidebarItemView&&this.sidebarItemView.showActive(a)},_renderCustomView:function(){var a=this;this._requestWorkDetailData().done(function(b){$(window).scrollTop(0),a._renderCustomSideBar(b),a._renderCustomDetailView(b)})},_renderCustomSideBar:function(b){var c=this.routerData;this.projectCustomSidebarView=new o({model:new a.Model(b),routerData:c}),this.listenTo(this.projectCustomSidebarView,"custom-sidebar-click",function(a){var b=a.attr("href");this.projectCustomDetailLayoutView.changeFrameUrl(b)},this),this.sidebar&&this.sidebar.show(this.projectCustomSidebarView)},_renderCustomDetailView:function(b){var c=this.routerData;this.projectCustomDetailLayoutView=new p({model:new a.Model(b),routerData:c}),this.main.show(this.projectCustomDetailLayoutView)},renderProjectCreateView:function(b){var b=b||"",c=!1,d=b?!1:!0;this.projectCreateView=new l({model:new a.Model({create:d}),isShowInvested:!1,data:b}),this.listenTo(this.projectCreateView,"submit",function(e){var f={WorkName:e.WorkName,Descripition:e.Descripition,StartDate:e.StartDate,DeadLine:e.DeadLine,PrincipalId:e.Principal.Id,Visibility:e.Visibility,AddObjectModels:e.Participators,LableId:e.LableId,DepartmentId:e.DepartmentId,WorkType:e.WorkType,ApplyUserId:e.ApplyUserId,ReCreateWorkId:e.work_id};if(this.customWork&&(f.IsInvested=e.IsInvested),this.customWork||(f.IsReCreate=e.work_id?!0:!1),!c)if(c=!0,!d&&this.customWork){var g=b.WorkId;f.WorkId=g,a.app.request("Project:postUpdateAllData",f).done(function(b){{var b=b||{};b.WorkId}a.app.execute("history:navigate","#work?work_id="+g,!0),c=!1})}else{var f={workName:e.WorkName,description:e.Descripition,startDate:e.StartDate,endDate:e.DeadLine,principalId:e.Principal.Id,visibility:e.Visibility,participators:e.Participators,followers:e.followers,isLong:2==e.WorkType?!0:!1,applyUserId:e.ApplyUserId,reCreateWorkId:e.work_id},h=this.userInfo.Id;a.app.request("WorkV2:createProject",f).done(function(b){var b=b||{},d=b.WorkId;h!=f.principalId?a.app.execute("history:navigate","#work?relation=2&work_id="+d,!0):a.app.execute("history:navigate","#work?work_id="+d,!0),c=!1})}}),this.main.show(this.projectCreateView),this._setClientHeight()},_tipMessage:function(a,b,c){this.warnDialog||(this.warnDialog=new v({type:"tipsy"}),$("body").append(this.warnDialog.render().$el)),this.warnDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:c||"warn"})},_renderProjectEditView:function(){var a=this;this._requestWorkDetailData().done(function(b){a.renderProjectCreateView(b)})},renderProjectListView:function(){var b=this,c=this.routerData,d={relation:c.relation||1,status:1,orderType:1,pageNum:1,pageSize:20,appId:c.appId,appType:c.appType,toUserId:c.to_user_id};this.routerData.status=1,this.routerData.orderType=1;var f;f=4!=c.relation?this._getListData(d):this._getTenantListData(d),f.done(function(c){b.projectListMainView&&b.projectListMainView.close();var d=a.Collection.extend({model:a.Model.extend({idAttribute:"WorkId"})}),f=a._.extend({model:new a.Model({routerData:b.routerData,data:c}),collection:new d(c.works)},b.projectListConfig);b.projectListMainView=new e(f),b.main&&b.main.show(b.projectListMainView),b._setClientHeight()})},_getListData:function(b){var c=new a.$.Deferred;return a.app.request("WorkV2:getWorkList",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},_getTenantListData:function(b){var c=new a.$.Deferred;return a.app.request("WorkV2:getTenantWorkList",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},_requestWorkDetailData:function(){var b=this.routerData,c=new a.$.Deferred;return a.app.request("ProjectDetail:getDetailData",{work_id:b.work_id}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c},renderProjectDetailView:function(){{var b=this;this.routerData}this.projectDetailView=new d,b.main&&b.main.show(this.projectDetailView);var c=this._requestWorkDetailData();c.done(function(c){if(0==c.Code)return void(b.main&&b.main.show(new n({model:new a.Model(c)})));var c=c||{};c.routerData=b.routerData;a.Model.extend({idAttribute:"WorkId"});b.detailModel?b.detailModel.set(c):b.detailModel=new a.Model(c),c.tagList&&c.tagList.length&&a._.each(c.tagList,function(a){a.del=!0}),b.tagCollection?b.tagCollection.reset(c.tagList):b.tagCollection=new a.Collection(c.tagList),b.renderProjectDetailTopNavView(),b.renderProjectDetailMainRegion()})},renderPagination:function(){var a=this,b=this.routerData,c=this.projectListCompositeView.model.get("data"),d=1==parseInt(b.status)?c.DoingTotal:c.DoneTotal;20>=d?a.projectListCompositeView.$el.find(".pagination").hide():a.projectListCompositeView.$el.find(".pagination").show().empty().pagination(parseInt(d),{items_per_page:20,prev_text:"前一页",next_text:"后一页",current_page:b.pageIndex-1,prev_show_always:!0,next_show_always:!0,link_to:"javascript:void(0)",callback:function(b){a.routerData.pageIndex=b+1,a.renderProjectListView()}})},renderProjectDetailTopNavView:function(){{var a=this,b=(this.routerData,this.detailModel),d=b.set({isShowTab:!0,ObjType:4});d&&d.toJSON()}a.projectDetailTopItemView=new f({model:d,globalCoustom:this.globalCoustom,isOptEdit:a.custom_isEdit,tagData:a.tagCollection}),a.projectDetailView.tab&&a.projectDetailView.tab.show(a.projectDetailTopItemView);var e=new c({el:a.projectDetailTopItemView.$el.find(".project_detail_nav"),eventTriggerName:"_tita_work"});this.globalCoustom.social||(this.routerData.detail_type="task");var g=this.usedNav[0].router,h=a.detailModel.get("ApplyState");!h||1!=h&&3!=h||(g="operate"),e.setDefault({detail_type:a.routerData.detail_type||g})},_dealData:function(b){return a._.map(b,function(a){var b=a.FileType;if(/^jpg|png|gif|jpeg|JPG|PNG|GIF|JPEG$/.test(b))if(a.PreviewUrl)if(a.DocumentSource&&3==a.DocumentSource)a.imageUrl=a.ImageUrl;else{var c=a.PreviewUrl.lastIndexOf(".");a.imageUrl=a.PreviewUrl.substr(0,c)+"_s."+a.PreviewUrl.substr(c+1),"gif"==a.FileType&&(a.imageUrl=a.PreviewUrl)}else a.imageUrl="";else fileIconName=/^(rar|zip|exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx|folder)$/.test(b)?b:/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(b)?"music":/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(b)?"video":"file",a.imageUrl=B.getStaticUrl("images/feed/"+fileIconName+".png");return a.timestamp=(new Date).getTime(),a}),b},updateTaskTime:function(a){return!1},renderProjectDetailMainRegion:function(){var b=this,c=this.routerData,d=this.detailModel,e=(d&&d.toJSON(),this.usedNav[0].router),f=b.detailModel.get("ApplyState");(1==f||3==f)&&(e="operate");var j=c.detail_type||e,k=_.extend({},c,{detail_type:j}),l={feed:w,user:x,file:h,operate:C.TrackView,task:i,statistics:y,milepost:z};if("feed"==j)return this.dynamicCompositeViews=new g({model:d,routerData:c}),b.projectDetailView&&b.projectDetailView.main&&b.projectDetailView.main.$el&&this._addClassByDetailType(j),this.projectDetailView.main&&this.projectDetailView.main.show(this.dynamicCompositeViews),void this._setClientHeight();this.projectDetailView&&this.projectDetailView.main&&this.projectDetailView.main.show(new m);var n=a.app.request("ProjectDetail:getData",k);n.done(function(c){var e=c,f=b.detailModel.get("ApplyState"),g=b.detailModel.get("IsApplyUser"),h=b.detailModel.get("IsPrincipal"),i=b.detailModel.get("Status"),k=b.detailModel.get("IsCreator");IsManage=b.detailModel.get("IsManage"),"file"===j&&(d.set({AttachmentTotal:e.Total,needEnclosure:!1,fileType:"work",isShowAction:!1,emptyContext:"分享的附件（文件/图片）都会集中显示在这里"}),e=b._dealData(e.Docments)),"user"===j&&(d.set({Followers:e.Followers,Members:e.Members,isShowDeliver:2==f&&(g||h||IsManage)&&1==i||0==f&&(h||k||IsManage)&&1==i}),e=[]),"task"===j&&d.set({detai_checkd:!1,taskType:b.routerData.taskType}),"operate"==j&&(e={comments:c,total:0}),"statistics"==j&&(d.set({Pandect:e.Pandect,StaffProgress:e.StaffProgress}),e=[]);var m=null,n=a.Collection;if("task"==j?n=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"Id"})}}):"milepost"==j&&(n=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"mileStoneId"})}})),m=new n(e),"statisticsTasks"==j){var o=a.Context.getApiUrl("Work/GrantSubTask"),p=b.$(".project_detail_content"),q=c.tasks,r=0;r=620,r=q.length>20?620:28*q.length+110,b.gantView=new A({width:p.width(),height:r,getSubUrl:o,data:c}),b.listenTo(b.gantView,"gantt:resizeend",function(){}),b.projectDetailView&&b.projectDetailView.main&&b.projectDetailView.main.show(b.gantView)}else b.childViews=b.childViews||{},"operate"==j?b.childViews[j+"View"]=new l[j]({model:new a.Model(e),defaultCount:1e3}):(b.childViews[j+"View"]=new l[j]({model:d,collection:m,TaskSource:3,createLabName:d.get("WorkName"),createLabId:d.get("WorkId")}),b.childViews[j+"View"].on("request",function(){b.renderProjectDetailMainRegion()})),b.projectDetailView&&b.projectDetailView.main&&b.projectDetailView.main.show(b.childViews[j+"View"]),b.projectDetailView&&b.projectDetailView.main&&b.projectDetailView.main.$el&&b._addClassByDetailType(j);"file"==j&&(b.file_pageIndex=1,b._renderFilePagination(b.childViews[j+"View"])),b._setClientHeight()})},_addClassByDetailType:function(a){{var b=this.projectDetailView.main.$el;this.main.$el}b[0].className="project_detail_content "+a},_renderFilePagination:function(b){var c=this,d=b.model.get("AttachmentTotal"),e=this.routerData;20>=d?b.$el.find(".pagination").hide():b.$el.find(".pagination").show().empty().pagination(d,{items_per_page:20,prev_text:"前一页",next_text:"后一页",current_page:c.file_pageIndex-1,prev_show_always:!0,next_show_always:!0,link_to:"javascript:void(0)",callback:function(d){c.file_pageIndex=d+1,a.app.request("ProjectDetail:getData",{work_id:b.model.get("WorkId"),detail_type:"file",pageNum:c.file_pageIndex,pageSize:20,app_id:e.appId,app_type:e.appType}).done(function(d){a.$(document).scrollTop(0),b.collection.reset(c._dealData(d.Docments))})}})},_setClientHeight:function(){var b=(this.$el.find(".work-tabnav").height(),this),c=this.$el.find(".work-tabnav"),d=a.Context.getGlobal("usingNewMenu")||!1,e=B.setMainRegionsHeight;e(c,this);var f=a._.debounce(function(){d?e(c,b):e(c)},300);$(window).off("resize.Work-Indepx-PageView"),$(window).on("resize.Work-Indepx-PageView",f)},onClose:function(){a.app.vent.off("tab:_tita_work:change"),a.app.vent.off("detail:_tita_work:operate")}}),F=new q({type:1});return F.changeGroupRoute=function(b){var c=decodeURIComponent(location.hash),d=a.Context.parseUrl(c),e=d.app_id||1,f=d.app_type||1,g="#work?relation=1&app_id="+e+"&app_type="+f+"&to_user_id="+b;a.app.execute("history:navigate",g,!0)},a.BasePageView.extend({mainViewClass:E,layout:window.top==window?"master-layout":"empty-layout",hideSidebar:window.top==window?!1:!0,layoutViewOptions:{hideSubMenu:!1,showRightSidebar:function(){return{showRightSidebar:!0,rightSidebarView:F}}}})});