(function($){function maybeCall(thing,ctx){return typeof thing=="function"?thing.call(ctx):thing}function isElementInDOM(ele){while(ele=ele.parentNode){if(ele==document)return true}return false}function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;this.fixTitle()}Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find(".tipsy-inner")[this.options.html?"html":"text"](title);$tip[0].className="tipsy";$tip.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);var tp;switch(gravity.charAt(0)){case"n":tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case"s":tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case"e":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case"w":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break}if(gravity.length==2){if(gravity.charAt(1)=="w"){tp.left=pos.left+pos.width/2-15}else{tp.left=pos.left+pos.width/2-actualWidth+15}}$tip.css(tp).addClass("tipsy-"+gravity);$tip.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+gravity.charAt(0);if(this.options.className){$tip.addClass(maybeCall(this.options.className,this.$element[0]))}if(this.options.fade){$tip.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{$tip.css({visibility:"visible",opacity:this.options.opacity})}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove()})}else{this.tip().remove()}},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("original-title")!="string"){$e.attr("original-title",$e.attr("title")||"").removeAttr("title")}},getTitle:function(){var title,$e=this.$element,o=this.options;this.fixTitle();var title,o=this.options;if(typeof o.title=="string"){title=$e.attr(o.title=="title"?"original-title":o.title)}else if(typeof o.title=="function"){title=o.title.call($e[0])}title=(""+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');this.$tip.data("tipsy-pointee",this.$element[0])}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};$.fn.tipsy=function(options){if(options===true){return this.data("tipsy")}else if(typeof options=="string"){var tipsy=this.data("tipsy");if(tipsy)tipsy[options]();return this}options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,"tipsy");if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,"tipsy",tipsy)}return tipsy}function enter(){var tipsy=get(this);tipsy.hoverState="in";if(options.delayIn==0){tipsy.show()}else{tipsy.fixTitle();setTimeout(function(){if(tipsy.hoverState=="in")tipsy.show()},options.delayIn)}}function leave(){var tipsy=get(this);tipsy.hoverState="out";if(options.delayOut==0){tipsy.hide()}else{setTimeout(function(){if(tipsy.hoverState=="out")tipsy.hide()},options.delayOut)}}if(!options.live)this.each(function(){get(this)});if(options.trigger!="manual"){var binder=options.live?"live":"bind",eventIn=options.trigger=="hover"?"mouseenter":"focus",eventOut=options.trigger=="hover"?"mouseleave":"blur";this[binder](eventIn,enter)[binder](eventOut,leave)}return this};$.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:.8,title:"title",trigger:"hover"};$.fn.tipsy.revalidate=function(){$(".tipsy").each(function(){var pointee=$.data(this,"tipsy-pointee");if(!pointee||!isElementInDOM(pointee)){$(this).remove()}})};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options};$.fn.tipsy.autoNS=function(){return $(this).offset().top>$(document).scrollTop()+$(window).height()/2?"s":"n"};$.fn.tipsy.autoWE=function(){return $(this).offset().left>$(document).scrollLeft()+$(window).width()/2?"e":"w"};$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:prefer.length>1?prefer[1]:false},boundTop=$(document).scrollTop()+margin,boundLeft=$(document).scrollLeft()+margin,$this=$(this);if($this.offset().top<boundTop)dir.ns="n";if($this.offset().left<boundLeft)dir.ew="w";if($(window).width()+$(document).scrollLeft()-$this.offset().left<margin)dir.ew="e";if($(window).height()+$(document).scrollTop()-$this.offset().top<margin)dir.ns="s";return dir.ns+(dir.ew?dir.ew:"")}}})(jQuery);define("$.tipsy",["$"],function(){});define("tita-network",["talent"],function(Talent){var $=Talent.$,xssFrame;var apiPath=BSGlobal["apiPath"],locationOrigin=location.host,isSameDomain=apiPath.split("//")[1]===locationOrigin;$.support.cors=true;var now=new Date;var networkDeferred=new $.Deferred;if(isSameDomain){networkDeferred.resolve();return networkDeferred}xssFrame=$('<iframe style="display:none" src="'+BSGlobal["apiPath"]+'/iframe.html" id="tita-apipath-iframe"></iframe>');xssFrame.on("load",function(){networkDeferred.resolve()});xssFrame.appendTo("body");return networkDeferred});(function($){$.fn.extend({slimScroll:function(options){var defaults={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var o=$.extend(defaults,options);this.each(function(){var isOverPanel,isOverBar,isDragg,queueHide,touchDif,barHeight,percentScroll,lastScroll,divS="<div></div>",minBarHeight=30,releaseScroll=false;var me=$(this);if(me.parent().hasClass(o.wrapperClass)){var offset=me.scrollTop();bar=me.closest("."+o.barClass);rail=me.closest("."+o.railClass);getBarHeight();if($.isPlainObject(options)){if("height"in options&&options.height=="auto"){me.parent().css("height","auto");me.css("height","auto");var height=me.parent().parent().height();me.parent().css("height",height);me.css("height",height)}if("scrollTo"in options){offset=parseInt(o.scrollTo)}else if("scrollBy"in options){offset+=parseInt(o.scrollBy)}else if("destroy"in options){bar.remove();rail.remove();me.unwrap();return}scrollContent(offset,false,true)}return}else if($.isPlainObject(options)){if("destroy"in options){return}}o.height=o.height=="auto"?me.parent().height():o.height;var wrapper=$(divS).addClass(o.wrapperClass).css({position:"relative",overflow:"hidden",width:o.width,height:o.height});me.css({overflow:"hidden",width:o.width,height:o.height});var rail=$(divS).addClass(o.railClass).css({width:o.size,height:"100%",position:"absolute",top:0,display:o.alwaysVisible&&o.railVisible?"block":"none","border-radius":o.railBorderRadius,background:o.railColor,opacity:o.railOpacity,zIndex:90});var bar=$(divS).addClass(o.barClass).css({background:o.color,width:o.size,position:"absolute",top:0,opacity:o.opacity,display:o.alwaysVisible?"block":"none","border-radius":o.borderRadius,BorderRadius:o.borderRadius,MozBorderRadius:o.borderRadius,WebkitBorderRadius:o.borderRadius,zIndex:99});var posCss=o.position=="right"?{right:o.distance}:{left:o.distance};rail.css(posCss);bar.css(posCss);me.wrap(wrapper);me.parent().append(bar);me.parent().append(rail);if(o.railDraggable){bar.bind("mousedown",function(e){var $doc=$(document);isDragg=true;t=parseFloat(bar.css("top"));pageY=e.pageY;$doc.bind("mousemove.slimscroll",function(e){currTop=t+e.pageY-pageY;bar.css("top",currTop);scrollContent(0,bar.position().top,false)});$doc.bind("mouseup.slimscroll",function(e){isDragg=false;hideBar();$doc.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(e){e.stopPropagation();e.preventDefault();return false})}rail.hover(function(){showBar()},function(){hideBar()});bar.hover(function(){isOverBar=true},function(){isOverBar=false});me.hover(function(){isOverPanel=true;showBar();hideBar()},function(){isOverPanel=false;hideBar()});me.bind("touchstart",function(e,b){if(e.originalEvent.touches.length){touchDif=e.originalEvent.touches[0].pageY}});me.bind("touchmove",function(e){if(!releaseScroll){e.originalEvent.preventDefault()}if(e.originalEvent.touches.length){var diff=(touchDif-e.originalEvent.touches[0].pageY)/o.touchScrollStep;scrollContent(diff,true);touchDif=e.originalEvent.touches[0].pageY}});getBarHeight();if(o.start==="bottom"){bar.css({top:me.outerHeight()-bar.outerHeight()});scrollContent(0,true)}else if(o.start!=="top"){scrollContent($(o.start).position().top,null,true);if(!o.alwaysVisible){bar.hide()}}attachWheel(this);function _onWheel(e){if(!isOverPanel){return}var e=e||window.event;var delta=0;if(e.wheelDelta){delta=-e.wheelDelta/120}if(e.detail){delta=e.detail/3}var target=e.target||e.srcTarget||e.srcElement;if($(target).closest("."+o.wrapperClass).is(me.parent())){scrollContent(delta,true)}if(e.preventDefault&&!releaseScroll){e.preventDefault()}if(!releaseScroll){e.returnValue=false}}function scrollContent(y,isWheel,isJump){releaseScroll=false;var delta=y;var maxTop=me.outerHeight()-bar.outerHeight();if(isWheel){delta=parseInt(bar.css("top"))+y*parseInt(o.wheelStep)/100*bar.outerHeight();delta=Math.min(Math.max(delta,0),maxTop);delta=y>0?Math.ceil(delta):Math.floor(delta);bar.css({top:delta+"px"})}percentScroll=parseInt(bar.css("top"))/(me.outerHeight()-bar.outerHeight());delta=percentScroll*(me[0].scrollHeight-me.outerHeight());if(isJump){delta=y;var offsetTop=delta/me[0].scrollHeight*me.outerHeight();offsetTop=Math.min(Math.max(offsetTop,0),maxTop);bar.css({top:offsetTop+"px"})}me.scrollTop(delta);me.trigger("slimscrolling",~~delta);showBar();hideBar()}function attachWheel(target){if(window.addEventListener){target.addEventListener("DOMMouseScroll",_onWheel,false);target.addEventListener("mousewheel",_onWheel,false)}else{document.attachEvent("onmousewheel",_onWheel)}}function getBarHeight(){barHeight=Math.max(me.outerHeight()/me[0].scrollHeight*me.outerHeight(),minBarHeight);bar.css({height:barHeight+"px"});var display=barHeight==me.outerHeight()?"none":"block";bar.css({display:display})}function showBar(){getBarHeight();clearTimeout(queueHide);if(percentScroll==~~percentScroll){releaseScroll=o.allowPageScroll;if(lastScroll!=percentScroll){var msg=~~percentScroll==0?"top":"bottom";me.trigger("slimscroll",msg)}}else{releaseScroll=false}lastScroll=percentScroll;if(barHeight>=me.outerHeight()){releaseScroll=true;return}bar.stop(true,true).fadeIn("fast");if(o.railVisible){rail.stop(true,true).fadeIn("fast")}}function hideBar(){if(!o.alwaysVisible){queueHide=setTimeout(function(){if(!(o.disableFadeOut&&isOverPanel)&&!isOverBar&&!isDragg){bar.fadeOut("slow");rail.fadeOut("slow")}},1e3)}}});return this}});$.fn.extend({slimscroll:$.fn.slimScroll})})(jQuery);define("$.slimscroll",function(){});define("tita-common",["talent","$.slimscroll"],function(talent,slimscroll){var jst=function(){this["JST"]=this["JST"]||{};this["JST"]["common/italent/app-select-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<ul>\n	\n</ul>\n<a href="javascript:void(0);" title="" class="closed"></a>'}return __p};this["JST"]["common/layouts/master-layout"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div id="header-region" data-name="header-region"></div>\n\n<div class="_tt_layout_body">\n	<div id="sidebar-region"></div>\n	<div id="main-region" class="_tt_layout_container_fluid"></div>\n	<div id="right-sidebar-region"></div>\n\n</div>\n<div id="footer-region" class="_tt_footer"></div>\n<div id="pull-screen-region"></div>\n\n'}return __p};this["JST"]["common/page-regions/tita-footer"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="box_foot">\n	<span class="copyright_foot">京ICP备05051632号 京公安网备110108002767号</span>   \n	<span class="link_foot">\n		<a href="'+((__t=HelpUrl)==null?"":__t)+'" style="margin-left:0" target="_blank">帮助中心</a>\n		<a href="'+((__t=HelpUrl)==null?"":__t)+'/ProIntro/TitaIntroduce">使用手册</a>\n		<a href="'+((__t=HelpUrl)==null?"":__t)+'/App/MobilePageDescribe" target="_blank">手机客户端</a>\n		<a href="'+((__t=HelpUrl)==null?"":__t)+'/CooperationZone/Index" target="_blank" >媒体报道</a>\n		<a href="http://weibo.com/titacom" target="_blank">官方微博</a>\n		<a href="/blog" target="_blank">官方博客</a>\n		<a href="'+((__t=HelpUrl)==null?"":__t)+'/CommonProblem/SafyAndPrivate" target="_blank">安全与隐私</a>\n		<a href="'+((__t=HelpUrl)==null?"":__t)+'/ContactUs/Index" target="_blank">联系我们</a>\n	</span>\n</div>\n\n\n'}return __p};this["JST"]["common/page-regions/tita-header"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(tenantInfo.Logo){__p+='\n<a class="logo" href="#'+((__t=homeIndex)==null?"":__t)+'" title="返回首页" data-name="logo"><img src="" alt="" /></a>\n'}else{__p+='\n<a class="logo logo_1" href="#'+((__t=homeIndex)==null?"":__t)+'" title="返回首页" data-name="logo"></a>\n'}__p+='\n\n\n<span class="brand" data-name="brand">\n	'+((__t=tenantInfo.Abbreviation)==null?"":__t)+"\n</span>\n";if(typeof headerAppData!="undefined"&&headerAppData.length>0){__p+='\n<a class="italent_show_app_container"  href="javascript:void(0)"><span class="italent_show_app"></span></a>\n'}__p+='\n\n\n\n<ul class="_tt_headnav" data-name="head-nav">\n	';if(isShowTask){__p+='\n	<li class="task_tthn ico_tthn" data-name="head-task">\n		<a href="'+((__t=webHost)==null?"":__t)+'#more/tasks" original-title="'+((__t=i18n.task_1)==null?"":__t)+'中心">'+((__t=i18n.task_1)==null?"":__t)+"中心</a>\n	</li>\n	"}__p+='\n	\n	<li class="todo_tthn ico_tthn" data-name="head-to-do">\n		<a href="'+((__t=webHost)==null?"":__t)+'#more/messages?messageType=1&isRead=2" data-name="no-msg" original-title="待办">\n			<span class="red-remind-num" data-name="head-to-do-indicator">'+((__t=todoIndicator)==null?"":__t)+'</span>\n			待办\n		</a>\n\n	</li>\n	<li class="msg_tthn ico_tthn" data-name="head-message">\n		<a href="'+((__t=webHost)==null?"":__t)+'#more/messages?messageType=2&isRead=2" data-name="no-msg" original-title="通知">\n			<div class="red-remind-num" data-name="head-message-indicator">'+((__t=messageIndicator)==null?"":__t)+'</div>\n			通知\n		</a>\n	</li>\n	<li class="logout_tthn">\n		<a href="javascript:void(0);" class="avatar_ltthn">\n			'+((__t=_.TitaCommon_convertImage({className:"radius_img30",src:loginUserInfo.UserAvatar.Small,size:30,shape:"radius",name:loginUserInfo.Name,bgColor:loginUserInfo.UserAvatar.Color}))==null?"":__t)+'\n		</a>\n		<a href="javascript:void(0);" class="namewrap_tthn"><span class="name_tthn">';print(loginUserInfo.Name.substring(0,3));__p+='</span><b class="caret"></b></a>\n		<ul class="menu_ltthn">\n			<li class="profile_ltthn"><a href="'+((__t=webHost)==null?"":__t)+'#italent/home?name=TalentProfile-record">个人主页</a></li>\n			<li class="archives_ltthn"><a href="'+((__t=webHost)==null?"":__t)+'#more/archives">简档编辑</a></li>\n			<li class="set_ltthn"><a href="'+((__t=webHost)==null?"":__t)+""+((__t=avatarUrl)==null?"":__t)+'">个人设置</a></li>\n			<li><a data-name="logout" href="'+((__t=logoutUrl)==null?"":__t)+'">退出登录</a></li>\n		</ul>\n	</li>\n</ul>\n<div class="tt_headsearch" data-name="head-search">\n	<div class="text_tths"><input type="search"><label class="label_tths" data-name="head-search-label">搜索'+((__t=i18n.workmate_1)==null?"":__t)+"、动态、"+((__t=i18n.work_1)==null?"":__t)+'等</label></div>\n	<a href="javascript:void(0);" class="btn_tths" data-name=\'head-search-button\' original-title="搜索全站内容"></a>\n</div>\n';if(isShowPlatform){__p+='\n<a href="'+((__t=webHost)==null?"":__t)+'#platform" class="platform_th" data-name="head-platform" original-title="回到首页"></a>\n'}__p+="\n"}return __p};this["JST"]["common/page-regions/tita-sidebar"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<a href="'+((__t=url)==null?"":__t)+'" class="'+((__t=type_class)==null?"":__t)+'_ttsn" data-type="'+((__t=navigationType)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" ';if(typeof target!=="undefined"){__p+='target="'+((__t=target)==null?"":__t)+'"'}__p+="> \n	<strong></strong><span>"+((__t=name)==null?"":__t)+"</span>\n	";if(url=="#home"){__p+='\n	<em class="red-remind" data-name="tita-sidebar-home-indicator"></em>\n	'}__p+="\n</a>\n"}return __p};this["JST"]["common/plugins/indicator/indicator-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n	<span class="inner_indi">\n		<a href="'+((__t=href)==null?"":__t)+'" target="_blank">\n			<span class="num_inii" data-name="indicator-num">'+((__t=IndicatorValue)==null?"":__t)+"</span>\n			<span>"+((__t=Contents)==null?"":__t)+"</span>\n		</a>\n	</span>\n"}return __p};this["JST"]["common/plugins/indicator/indicator"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="indicater_tri" data-name="indicator-wrap">\n	<a href="javascript:void(0)" class="tri" data-name="indicator"></a>\n	<div class="indicater" data-name="indicator-list-wrap">\n   		<ul class="list_indi"></ul>\n	</div>\n</div>\''}return __p};this["JST"]["common/plugins/message/message-pop-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<a class="item-wraper" data-name="item" href="'+((__t=typeData.url)==null?"":__t)+'">\n	<span class="icon-wraper '+((__t=typeData.iconClass)==null?"":__t)+'">\n	<span class="icon"></span>\n	</span>\n	<span class="name">'+((__t=content)==null?"":__t)+' <span class="num">'+((__t=value)==null?"":__t)+'</span></span>\n	<span class="time">'+((__t=date)==null?"":__t)+"</span>\n</a>\n\n"}return __p};this["JST"]["common/plugins/message/message-pop"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="pop-head">\n	<span class="arrow"></span>\n	<span class="number">你有 <strong data-name="total-num">'+((__t=total)==null?"":__t)+'条新</strong> 通知</span>\n	<a class="all" href="'+((__t=titaHost)==null?"":__t)+'#more/messages?messageType=2&isRead=2" data-name="all">查看全部</a>\n</div>\n<div class="pop-main" data-name="message-main">\n	\n</div>'}return __p};this["JST"]["common/plugins/message/remain-pop-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<a class="item-wraper" data-name="item" href="'+((__t=url)==null?"":__t)+'">\n\n	'+((__t=_.TitaCommon_convertImage({className:"icon",src:User.avatar.Medium,size:50,shape:"radius",name:User.name,bgColor:User.avatar.Color}))==null?"":__t)+'\n	<div class="item-right">\n		<div class="top">\n			<span class="name">'+((__t=_.TitaCommon_substring(User.name,8,false))==null?"":__t)+'</span>\n			<span class="title">'+((__t=subTitle)==null?"":__t)+'</span>\n			<span class="time">'+((__t=createDate)==null?"":__t)+'</span>\n		</div>\n		<p class="detail">\n			'+((__t=_.TitaCommon_substring(content,64,true))==null?"":__t)+"\n		</p>\n	</div>\n</a>\n\n"}return __p};this["JST"]["common/plugins/message/remain-pop"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="pop-head">\n	<span class="arrow"></span>\n	<span class="icon"></span>\n	<span class="label">待办</span>\n	<span class="number">共<strong data-name="total-num">'+((__t=total)==null?"":__t)+'条</strong></span>\n\n	<a class="all" href="'+((__t=titaHost)==null?"":__t)+'#more/messages?messageType=1&isRead=1" data-name="all">查看全部</a>\n</div>\n<div class="pop-main" data-name="remain-main">\n	\n	\n</div>'}return __p};this["JST"]["common/plugins/remindme-widget/remindme-time-picker"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){_.each(data,function(value,key){__p+="\n	<li data-id= "+((__t=value["value"])==null?"":__t)+" >"+((__t=value.text)==null?"":__t)+"</li>\n"})}return __p};this["JST"]["common/plugins/remindme-widget/remindme-widget-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="remindme_item_animate">\n	<span class="icon"></span><span class="remind_title">提醒</span>\n</div>\n<div class="remindme_item_content">\n	<p class="remindme_item_content_tips">\n		'+((__t=Time)==null?"":__t)+"\n		<span>"+__e(Content)+'</span>\n	</p>\n	<p class="remindme_item_content_content">\n		<span class="remindme_item_content_type">'+((__t=typeText)==null?"":__t)+'</span>\n		<a href="'+((__t=Url)==null?"":__t)+'" class="remindme_item_content_title">'+((__t=ObjName)==null?"":__t)+"</a>\n	</p>\n	";if(RemindUser){__p+='\n		<p class="remindme_item_content_tips"><span>提醒发起人:'+((__t=RemindUser.Name)==null?"":__t)+"</span></p>\n	"}__p+='\n</div>\n<div class="remindme_item_btn_group">\n	<a href="javascript:void(0)" data-handler="show_tip" class="btn_remindme_blue btn_remindme_later">稍后<span></span></a>\n	<a href="javascript:void(0)" class="btn_remindme_default btn_remindme_clear">消除<span></span></a>\n</div>\n<div class="remindme_all_operate">\n	<a href="javascript:void(0)" data-handler="prev" class="btn_remindme_arrow_prev btn_remindme_prev"></a>\n	<span class="remindme_all_now_count">'+((__t=index+1)==null?"":__t)+"/"+((__t=count)==null?"":__t)+'</span>\n	<a href="javascript:void(0)" data-handler="next" class="btn_remindme_arrow_next btn_remindme_next"></a>\n	<a href="javascript:void(0)" class="btn_remindme_tip">展开</a>\n</div>'}return __p};this["JST"]["common/plugins/remindme-widget/remindme-widget"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<ul class="remindme_list_container">\n	\n</ul>\n<div class="remindme_list_foot">\n	<div class="remindme_foot_line"></div>\n	<div class="remindme_item_animate"></div>\n	<div class="remindme_item_content"></div>\n	<div class="remindme_item_btn_group"> \n		<a href="javascript:void(0)" class="btn_remindme_blue btn_remindme_later_all">全部稍后<span></span></a>\n		<a href="javascript:void(0)" class="btn_remindme_default btn_remindme_clear_all">全部消除<span></span></a>\n	</div>\n	<div class="remindme_all_operate">\n		<span class="remindme_list_foot_count">共<span>'+((__t=count)==null?"":__t)+'</span>个提醒</span>\n		<span class="btn_remindme_tip">收起</span>\n		<a href="javascript:void(0)" class="a"></a>\n	</div>\n</div>'}return __p};return this["JST"]}();var apiServer=BSGlobal.apiPath;var _mappingDocumentTitle={};var localContext={start:BSGlobal.start,getGlobal:function(key){return BSGlobal[key]},getTenantInfo:function(){return BSGlobal.tenantInfo},getUserInfo:function(){return BSGlobal.loginUserInfo},getStaticUrl:function(url){var staticServer=BSGlobal.staticPath;return staticServer+"/"+url},getApiUrl:function(url){var uid=this.getUserInfo().Id;var tid=this.getTenantInfo().Id;return apiServer+"/api/v1/"+tid+"/"+uid+"/"+url},getApiHost:function(){return apiServer},getI18n:function(){var i18n={home_1:"动态",plan_1:"计划",work_1:"项目",document_1:"文件",workmate_1:"同事",app_1:"应用",task_1:"任务",task_2:"循环任务",schedule_1:"日程",share_1:"分享",sharing_1:"分享",follow_1:"立即关注",following_1:"正在关注",cancelfollow_1:"取消关注",myfollowmate_1:"我关注的",myfans_1:"我的粉丝",publishshare_1:"发分享",publishtask_1:"派任务",myfollowfeed_1:"与我相关",mypublishfeed_1:"我发表的",myleavefeed_1:"@我的",myreplayfeed_1:"回复我的",mycollectfeed_1:"我收藏的",myallfeed_1:"所有动态",message_1:"消息",remind_1:"提醒",myschedule_1:"我的日程",href_1:"常用链接",invitemate_1:"邀请同事",helpcenter_1:"帮助中心",onlineuser_1:"在线同事"};var localI18n={guide_1:"打开导览"};if(BSGlobal&&BSGlobal.BSi18n){return talent._.extend({},BSGlobal.BSi18n,localI18n)}return talent._.extend({},i18n,localI18n)},getWebUrl:function(url){return BSGlobal.titaHost+"/"+url},setPageTitle:function(title){var hash=location.hash.split("?")[0];if(title){document.title=title;_mappingDocumentTitle[hash]=title}else{var MTitle=_mappingDocumentTitle[hash];if(!MTitle)return;document.title=_mappingDocumentTitle[hash]}},setPosition:function(relNode,dialogNode,options){var bodyEl=talent.$("body");var defaults={parentEl:bodyEl,pos:"bottomRight",leftBias:0,topBias:0,boundingEl:bodyEl};options=talent._.extend({},defaults,options);var parentEl=options.parentEl,relNodeH=relNode.outerHeight(),relNodeW=relNode.outerWidth(),domW=dialogNode.outerWidth(),domH=dialogNode.outerHeight(),boundingEl=options.boundingEl,boundingElOffset=boundingEl.offset(),domOffset=parentEl.offset(),elPos={},relPos=relNode.position();if(relNode==parentEl){relPos={left:0,top:0}}switch(options.pos){case"top":{elPos={top:-domH,left:-(domW-relNodeW)/2}}break;case"topLeft":{elPos={top:-domH,left:0}}break;case"topRight":{elPos={top:-domH,left:relNodeW-domW}}break;case"bottom":{elPos={top:relNodeH,left:-(domW-relNodeW)/2}}break;case"bottomLeft":{elPos={top:relNodeH,left:0}}break;case"bottomRight":{elPos={top:relNodeH,left:relNodeW-domW}}break}elPos.left+=relPos.left;elPos.top+=relPos.top;if(options.leftBias){elPos.left=elPos.left+options.leftBias}if(options.topBias){elPos.top=elPos.top+options.topBias}domOffset.left+=elPos.left;domOffset.top+=elPos.top;if(domOffset.left<boundingElOffset.left){elPos.left+=boundingElOffset.left-domOffset.left}else if(domOffset.left-boundingElOffset.left>boundingEl[0].scrollWidth-domW){elPos.left-=domOffset.left-boundingElOffset.left-(boundingEl[0].scrollWidth-domW)}if(domOffset.top<boundingElOffset.top){elPos.top+=boundingElOffset.top-domOffset.top}else if(domOffset.top-boundingElOffset.top>boundingEl[0].scrollHeight-domH){elPos.top-=domOffset.top-boundingElOffset.top-(boundingEl[0].scrollHeight-domH)}dialogNode.css(elPos)},getLoginUrl:function(){var url=this.getWebUrl("Account/LogIn");return url+"?ReturnUrl="+encodeURIComponent(location.href)},setMainRegionsHeight:function(main){var tabHeight=talent.$("._tt_layout_tabnav").height();var headH=talent.$("#header-region").outerHeight();var footH=talent.$("#footer-region").outerHeight();var mainH=talent.$("#main-region").outerHeight();var HH=$(window).height()-headH-footH;var setHeight=HH;if(talent.$("._tt_layout_tabnav").length){setHeight=HH>tabHeight?HH:tabHeight;setHeight=mainH>setHeight?mainH:setHeight}else{if(HH<mainH){setHeight=mainH}}main.css({minHeight:setHeight})},decodeScript:function(Content){if(Content.length==0)return"";s=Content.replace(/&lt;/g,"<");s=s.replace(/&gt;/g,">");s=s.replace(/&nbsp;/g," ");s=s.replace(/&apos;/g,"'");s=s.replace(/&quot;/g,'"');s=s.replace(/&amp;/g,"&");return s}};_.TitaCommon_substring=function(str,len,hasDot){if(!str){str=""}var newLength=0;var newStr="";var chineseRegex=/[^\x00-\xff]/g;var singleChar="";var strLength=str.replace(chineseRegex,"**").length;for(var i=0;i<strLength;i++){singleChar=str.charAt(i).toString();if(singleChar.match(chineseRegex)!=null){newLength+=2}else{newLength++}if(newLength>len){break}newStr+=singleChar}if(hasDot&&strLength>len){newStr+="..."}return newStr};_.TitaCommon_convertImage=function(obj){var html="";var obj=obj||{};var defults={className:"",size:30,shape:"radius",name:"",src:""};obj=_.extend({},defults,obj);if(obj.bgColor){if(obj.size==50){obj.subName=_.TitaCommon_substring(obj.name,6,false)}else if(obj.size==30){obj.subName=_.TitaCommon_substring(obj.name,3,false)}else if(obj.size==64){obj.subName=_.TitaCommon_substring(obj.name,6,false)}html=['<span class="',obj.shape,"_img",obj.size," ",obj.className,'" style="background-color:',obj.bgColor,';"  original-title="',obj.name,'">',obj.subName,"</span>"].join("")}else{html=['<img class="',obj.shape,"_img",obj.size," ",obj.className,'" width="',obj.size,'" height="',obj.size,'" src="',obj.src,'" original-title="',obj.name,'" />'].join("")}return html};_.TitaCommon_preventMouseWheel=function(node){$(node).off("mousewheel.preventDefault");$(node).on("mousewheel.preventDefault",function(e,d){if(d>0){this.scrollTop-=30}else{this.scrollTop+=30}e.preventDefault()})};var PERMISSION_GRANTED="granted",PERMISSION_DENIED="denied",PERMISSION_UNKNOWN="unknown";var a=[],iv,i=0;function swaptitle(title){if(a.length===0){a=[document.title]}a.push(title);if(!iv){iv=setInterval(function(){if(a.indexOf(document.title)===-1){a[0]=document.title}document.title=a[++i%a.length]},1e3)}}function swapTitleCancel(){if(a.length===0){return}if("external"in window&&"msSiteModeClearIconOverlay"in window.external){window.external.msSiteModeClearIconOverlay()}clearInterval(iv);iv=false;document.title=a[0];a=[]}function addEvent(el,name,func){if(name.match(" ")){var a=name.split(" ");for(var i=0;i<a.length;i++){addEvent(el,a[i],func)}}if(el.addEventListener){el.removeEventListener(name,func,false);el.addEventListener(name,func,false)}else{el.detachEvent("on"+name,func);el.attachEvent("on"+name,func)}}function check_permission(){if("external"in window&&"msIsSiteMode"in window.external){return window.external.msIsSiteMode()?PERMISSION_GRANTED:PERMISSION_UNKNOWN}else if("webkitNotifications"in window){return window.webkitNotifications.checkPermission()===0?PERMISSION_GRANTED:PERMISSION_DENIED}else if("mozNotification"in window.navigator){return PERMISSION_GRANTED}else{return PERMISSION_UNKNOWN}}function update_permission(){window.Notification.permission=check_permission();return window.Notification.permission}if(!Object(window.Notification).permission){window.Notification=function(message,options){if(!(this instanceof window.Notification)){return new window.Notification(message,options)}var n,self=this;options=options||{};this.body=options.body||"";this.icon=options.icon||"";this.lang=options.lang||"";this.tag=options.tag||"";this.close=function(){if(Object(n).close){n.close()}self.onclose()};this.onclick=function(){};this.onclose=function(){};if("external"in window&&"msIsSiteMode"in window.external){if(window.external.msIsSiteMode()){window.external.msSiteModeActivate();if(this.icon){window.external.msSiteModeSetIconOverlay(this.icon,message)}}}else if("webkitNotifications"in window){if(window.webkitNotifications.checkPermission()===0){n=window.webkitNotifications.createNotification(this.icon,message,this.body);n.show();n.onclick=function(){self.onclick();window.focus();setTimeout(function(){n.cancel()},1e3)}}}else if("mozNotification"in window.navigator){var m=window.navigator.mozNotification.createNotification(message,this.body,this.icon);m.show()}};window.Notification.requestPermission=function(cb){cb=cb||function(){};if("external"in window&&"msIsSiteMode"in window.external){try{if(!window.external.msIsSiteMode()){window.external.msAddSiteMode();cb(PERMISSION_UNKNOWN)}}catch(e){}cb(update_permission())}else if("webkitNotifications"in window){window.webkitNotifications.requestPermission(function(){cb(update_permission())})}else{cb(update_permission())}};update_permission()}var BaseCollection={request:function(options){var deferred=new Talent.$.Deferred;options=Talent._.extend({},options);options.url=options.url||this.url;options.url=localContext.getApiUrl(options.url);if(options.mockData){action(options.mockData);

}return deferred.promise();function action(resp){var code=resp.Code;if(code==1){var data=resp.Data;if(resp.ExtendedData){data=Talent._.extend({},resp.Data,resp.ExtendedData)}deferred.resolve(data)}else{if(code==401){login()}deferred.reject(resp.Message)}}function login(){location.href=localContext.getLoginUrl();throw new Error("401")}}};var IndicatorColllection={indicatorClear:function(options){var deferred=new Talent.$.Deferred;var defaults={messageType:0,indicatorType:0};var options=Talent._.extend({},defaults,options);var url="Indicator/Clear";var params="?message_type="+options["messageType"]+"&indicator_type="+options["indicatorType"];BaseCollection.request({url:url+params,type:"DELETE"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred}};var ToColllection={getTodoData:function(options){var defaults={app_type:-1,app_id:-1,page_num:1,page_size:20,status:1};var options=talent._.extend({},defaults,options);var deferred=new talent.$.Deferred;var url="todo/Get";BaseCollection.request({url:url,data:options,type:"get"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred}};var MessagePopItemView=Talent.ItemView.extend({template:jst["common/plugins/message/message-pop-item"],className:"item",defaults:{titaHost:""},templateHelpers:function(){var type=this.model.get("type"),indicatorType=this.model.get("indicatorType"),titaHost=this.settings.titaHost,appId=this.model.get("appId"),appType=this.model.get("appType");var defaultType={iconClass:"work-notice",url:titaHost+"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType};this.typeMap={mCommentIndicator:{iconClass:"reply-me",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mLeaveIndicator:{iconClass:"at-me",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mTaoShangIndicator:{iconClass:"reward-out",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mLeaveAllIndicator:{iconClass:"notice",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mWorkIndicator:{iconClass:"work-notice",url:titaHost+"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType},mfollowIndicator:{iconClass:"fans",url:titaHost+"#staff?name=fans"},mLeaveWorkIndicator:{iconClass:"at-project",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mLeaveDepartmentIndicator:{iconClass:"department",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mLeaveTeamIndicator:{iconClass:"at-team",url:titaHost+"#more/indicatormsg?indicatorType="+indicatorType},mtitadashang:{iconClass:"reward-in",url:titaHost+"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType},mTeamIndicator:{iconClass:"team-notice",url:titaHost+"#more/messages?messageType=2&isRead=1&tabAppId="+appId+"&tabAppType="+appType}};return{typeData:this.typeMap[type]?this.typeMap[type]:defaultType}},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)},onRender:function(){}});var MessagePopView=Talent.CompositeView.extend({template:jst["common/plugins/message/message-pop"],className:"ns-message-pop",itemView:MessagePopItemView,itemViewContainer:'[data-name="message-main"]',defaults:{titaHost:""},ui:{main:'[data-name="message-main"]',all:'[data-name="all"]',item:'[data-name="item"]',totalNum:'[data-name="total-num"]'},events:function(){var events={};events["click "+this.ui.all]="hide";events["click "+this.ui.item]="_itemHandler";return events},modelEvents:{"change:total":"_onTotalChange"},collectionEvents:{reset:"_countTotal"},initialize:function(){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);Talent.$(document).off("mouseup.headView-message-pop");Talent.$(document).on("mouseup.headView-message-pop",function(){self.hide()});Talent.app.vent.on("global-headview-PopClose",function(){self.hide()});this.$el.on("mouseup",function(event){event.stopPropagation()});this.isShow=false;this._countTotal()},templateHelpers:function(){return{titaHost:this.settings.titaHost}},onRender:function(){this.$el.on("click",function(ev){ev.stopPropagation()});if(this.collection.length>5){this.ui.main.slimScroll({height:"255px",size:"7px",color:"#637283",railOpacity:.3})}},show:function(relNode,options){var defaults={pos:"bottomRight",leftBias:72,topBias:10};var options=Talent._.extend({},defaults,options);this.isShow=true;localContext.setPosition(relNode,this.$el,options);this.$el.show()},hide:function(){this.$el.hide();this.isShow=false},_itemHandler:function(event){this.hide()},_countTotal:function(){var total=0;if(this.collection.length==0){this.hide()}this.collection.each(function(item){total+=Number(item.get("value"))});this.model.set({total:total});if(this.collection.length>5){this.ui.main.slimScroll({height:"255px",size:"7px",color:"#637283",railOpacity:.3})}},_onTotalChange:function(){var total=this.model.get("total");this.ui.totalNum.text(total+"条新")},itemViewOptions:function(){return{titaHost:this.settings.titaHost}},onClose:function(){Talent.$(document).off("click.headView-message-pop")}});var TodoPopItemView=Talent.ItemView.extend({template:jst["common/plugins/message/remain-pop-item"],className:"item",defaults:{titaHost:""},templateHelpers:function(){var model=this.model,type=model.get("todoType"),host=this.settings.titaHost,url=host+"#more/messages?messageType=1",isPush=model.get("isPush");if(type==1){if(isPush){url+="&pullScreeId="+model.get("objId")+'&pullScreenOpen=true&pullScreenType=task"'}else{url=model.get("objUrl")}}else if(type==2){url=host+"#more/apply?name=plan"}else if(type==3){url=host+"#more/apply?name=work"}else if(type==4){url=model.get("objUrl")}return{url:url}},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)},onRender:function(){}});var TodoPopView=Talent.CompositeView.extend({template:jst["common/plugins/message/remain-pop"],className:"ns-remain-pop",itemView:TodoPopItemView,itemViewContainer:'[data-name="remain-main"]',ui:{main:'[data-name="remain-main"]',all:'[data-name="all"]',item:'[data-name="item"]',totalNum:'[data-name="total-num"]'},defaults:{titaHost:""},events:function(){var events={};events["click "+this.ui.all]="hide";events["click "+this.ui.item]="_itemHandler";return events},modelEvents:{"change:total":"_onTotalChange"},templateHelpers:function(){return{titaHost:this.settings.titaHost}},initialize:function(){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);Talent.$(document).off("mouseup.headView-remain-pop");Talent.$(document).on("mouseup.headView-remain-pop",function(){self.hide()});Talent.app.vent.on("global-headview-PopClose",function(){self.hide()});this.$el.on("mouseup click",function(ev){ev.stopPropagation()});this.isShow=false},onRender:function(){this.$(".item").last().addClass("last")},show:function(relNode,options){this.$el.show();this.isShow=true;localContext.setPosition(relNode,this.$el,options)},hide:function(){this.$el.hide();this.isShow=false},itemViewOptions:function(){return{titaHost:this.settings.titaHost}},_itemHandler:function(event){event.stopPropagation();this.hide()},_onTotalChange:function(){var total=this.model.get("total");this.ui.totalNum.text(total+"条")},onClose:function(){Talent.$(document).off("click.headView-remain-pop")}});var AppSelectItemView=talent.ItemView.extend({template:talent._.template('<a id="<%=AppId %>" href="<%=Href%>" class="app_<%= AppId %>"><span ><%= Name %></span></a>'),tagName:"li"});var AppSelectView=talent.CompositeView.extend({template:jst["common/italent/app-select-item"],className:"talent_app_selector",itemView:AppSelectItemView,itemViewContainer:"ul",ui:{close:".closed"},events:function(){var events={};events["click "+this.ui.close]="_closeElFun";return events},initialize:function(options){var self=this;this.options=options||{};this.customizePage=this.options["customizePage"]||false;if(this.customizePage){talent.app.vent.on("App-Select-Item-View:show",function(){self.show()});var data=this._customizeDataChange(this.options["data"]["secondaryNav"]);this.collection.reset(data)}else{talent.$(document).bind("click.App-Select-Item-View",function(){self._closeElFun()})}this.$el.bind("click",function(event){event.stopPropagation()})},show:function(){this.$el.stop().slideDown()},_closeElFun:function(event){var self=this;this.$el.stop().slideUp()},highlightUI:function(borderData){if(borderData.flag=="add"){this.show()}else{this._closeElFun()}},update:function(newData){var data=this._customizeDataChange(newData["secondaryNav"]);this.collection.reset(data)},_customizeDataChange:function(data){var new_data=[];talent._.each(data,function(item){var itemD=talent._.extend({},item,{AppId:item["id"],AppType:item["id"],Name:item["name"],Href:item["href"],Display:true});new_data.push(itemD)});return new_data}});var RemindmeWidgetItemView=talent.ItemView.extend({template:_.template(""),modelEvents:{"change:data":"modelDataChange"},initialize:function(){var self=this;this.model=new talent.Model({time:"",data:[]});this.routerData={index:0,showType:"one"}},onRender:function(){var self=this;this.modelDataChange()},modelDataChange:function(){var self=this;if(!this.model.get("data")||this.model.get("data").length==0){this.$el.addClass("disable");this.$el.off("click");this.remindmeWidgetListCompositeView&&this.remindmeWidgetListCompositeView.$el.hide()}else{this.renderRemindListView();this.$el.removeClass("disable");this.$el.off("click");this.$el.on("click",function(ev){self.renderRemindListView(ev)})}if(this.remindmeWidgetListCompositeView){this.changeCollectionData()}},renderRemindListView:function(ev){var routerData=this.routerData;var type=routerData.showType;var collectionData=type=="all"?this.model.get("data"):this.model.get("data")[routerData.index];if(!this.remindmeWidgetListCompositeView){this.remindmeWidgetListCompositeView=new RemindmeWidgetListCompositeView({collection:new talent.Collection(collectionData),model:new talent.Model({showType:type,index:routerData.index,count:this.model.get("data").length})});this.bindEvents();this.remindmeWidgetListCompositeView.render();this.$el.append(this.remindmeWidgetListCompositeView.$el);this.remindmeWidgetListCompositeView.$el.show();this.setPos()}else{this.remindmeWidgetListCompositeView.model.set({count:this.model.get("data").length,showType:type,index:this.routerData["index"]});this.remindmeWidgetListCompositeView.collection.reset(collectionData);if(talent._.isEmpty(collectionData)){this.remindmeWidgetListCompositeView.$el.hide()}else{this.setPos();this.remindmeWidgetListCompositeView.$el.show()}}},bindEvents:function(){var self=this;this.listenTo(this.remindmeWidgetListCompositeView,"changeRouteData",this.changeRouteData);this.listenTo(this.remindmeWidgetListCompositeView,"changeData",this.changeData);this.listenTo(this.remindmeWidgetListCompositeView,"deleteData",this.deleteData)},setPos:function(){var top=Talent.$("[data-name=header-region]").outerHeight()+10;this.remindmeWidgetListCompositeView.$el.css({top:top})},changeRouteData:function(data){if(data.showType&&data.showType=="all")data.index=0;this.routerData=talent.$.extend({},this.routerData,data);this.changeCollectionData()},changeCollectionData:function(){var type=this.routerData.showType;var routerData=this.routerData;var collectionData=type=="all"?this.model.get("data"):this.model.get("data")[routerData.index];this.remindmeWidgetListCompositeView.model.set({showType:type,index:this.routerData["index"],count:this.model.get("data").length});this.remindmeWidgetListCompositeView.collection.reset(collectionData)},deleteData:function(data){var self=this;var data=data||{};if(data.id){RequestCollection.deleteData(data).done(function(resp){self.onAfterChangeData(data)})}else{RequestCollection.deleteAllData({}).done(function(resp){self.onAfterChangeData(data)})}},changeData:function(data){var data=data||{};var self=this;if(data.time){var ftime=(new Date).getTime()+parseInt(data.time);data["time"]=this.formatDate(new Date(ftime),"yyyy/MM/dd hh:mm:ss");if(data.id){RequestCollection.setData(data).done(function(resp){self.onAfterChangeData(data)})}else{var collectionData=this.model.get("data");data["ids"]=talent._.pluck(collectionData,"Id").join(",");RequestCollection.setAllData(data).done(function(resp){self.onAfterChangeData(data)})}}},onAfterChangeData:function(data){var allData=this.model.get("data");if(data.id){allData=talent._.filter(allData,function(value){return value.Id!=parseInt(data.id)})}else{allData=[]}if(allData.length==0){this.remindmeWidgetListCompositeView.$el.hide()}this.model.set("data",allData)},formatDate:function(date,fmt){var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return fmt},onClose:function(){this.$el.off("click")}});var RemindmeWidgetListItemCompositeView=talent.ItemView.extend({template:jst["common/plugins/remindme-widget/remindme-widget-list-item"],tagName:"li",className:"remindme_item_normal",initialize:function(options){var options=options||{};this.templateHelpers=options;var routerData=this.templateHelpers["routerData"];var type=this.model.get("ObjType");var url=this.model.get("Url");var id=this.model.get("ObjId");var i18n=localContext.getI18n();var mapping={7:i18n["task_1"],4:i18n["work_1"],10:i18n["home_1"],11:i18n["plan_1"],8:"日报",20:"会议",21:"出差"};this.model.set({Url:url,typeText:mapping[type]})}});var DatePickerView=talent.ItemView.extend({tagName:"ul",className:"remindme_time_tip",template:jst["common/plugins/remindme-widget/remindme-time-picker"],defaults:[{value:.25,text:"15分钟后"},{value:.5,text:"30分钟后"},{value:.75,text:"45分钟后"},{value:1,text:"1小时后"},{value:2,text:"2小时后"},{value:3,text:"3小时后"},{value:6,text:"6小时后"},{value:12,text:"12小时后"},{value:24,text:"24小时后"},{value:48,text:"2天后"},{value:72,text:"3天后"},{value:168,text:"1周后"},{value:336,text:"2周后"}],events:{"click  li":"onDateSelect"},modelEvents:{"change:isSyc":"render"},templateHelpers:function(){var isSyc=this.model.get("isSyc");var helperData=isSyc?[{value:-2,text:"不再"}]:[{value:-1,text:"今日不再"},{value:-2,text:"永远不再"}];var helpers=talent._.clone(this.defaults);return{data:helperData.concat(helpers)}},initialize:function(){var self=this;$(document).off("mousedown.dataPicker");$(document).on("mousedown.dataPicker",function(){self.$el.hide()});this.$el.off("mousedown.dataPicker");this.$el.on("mousedown.dataPicker",function(ev){ev.stopPropagation()})},onDateSelect:function(ev){ev.stopPropagation();this.$el.hide();var time=parseFloat(talent.$(ev.target).attr("data-id"));if(time==-1||time==-2){this.trigger("onSelect",time)}else{this.trigger("onSelect",time*60*60*1e3)}this.$el.hide()},onClose:function(){this.$el.off("mousedown.dataPicker");$(document).off("mousedown.dataPicker")}});var RemindmeWidgetListCompositeView=talent.CompositeView.extend({template:jst["common/plugins/remindme-widget/remindme-widget"],itemView:RemindmeWidgetListItemCompositeView,itemViewContainer:".remindme_list_container",className:"remindme_widget_list_container",events:{"click  .btn_remindme_tip":"onAfterChangeShowType","click .btn_remindme_arrow_prev,.btn_remindme_arrow_next":"onAfterChangeIndex","click .btn_remindme_later":"showDataPicker","click .btn_remindme_clear":"onAfterClearRemindTime","click .btn_remindme_later_all":"showDataPicker","click .btn_remindme_clear_all":"onAfterClearAllRemindTime","click .btn_remindme_close":"hideRemindeView"},modelEvents:{"change:showType":"changeStatusType","change:count":"onAfterChangeCount"},itemViewOptions:function(){return{index:this.model.get("index"),count:this.model.get("count"),routerData:this.routerData}},onAfterItemAdded:function(itemView){var ids=this.collection.pluck("Id");var index=talent._.indexOf(ids,itemView.model.get("Id"));if(this.model.get("showType")=="one"){itemView.$el.removeClass("remindme_item_normal");itemView.$el.find(".disable").removeClass("disable");if(this.model.get("index")==0){itemView.$el.find(".btn_remindme_arrow_prev").attr("status",0);itemView.$el.find(".btn_remindme_arrow_prev").addClass("disable_btn_remindme_arrow_prev")}if(this.model.get("index")==this.model.get("count")-1){itemView.$el.find(".btn_remindme_arrow_next").addClass("disable_btn_remindme_arrow_next");itemView.$el.find(".btn_remindme_arrow_next").attr("status",0)}}if(!(this.model.get("showType")=="one")&&index==0){itemView.$el.removeClass("remindme_item_normal").addClass("remindme_item_first")}itemView.$el.attr("data-id",itemView.model.get("Id"))},onRender:function(){var self=this;this.changeStatusType();talent._.TitaCommon_preventMouseWheel(this.$el.find(".remindme_list_container"));this.onAfterChangeCount()},initialize:function(){this.$el.on("click",function(event){event.stopPropagation()});this._getRouterData()},_getRouterData:function(){var self=this;var queryObject=talent.app.request("history:getQueryObject");var deferred=new talent.$.Deferred;queryObject.done(function(routerData){self.routerData=routerData;self.routerData["appid"]=routerData["appid"]?routerData["appid"]:1;self.routerData["apptype"]=routerData["apptype"]?routerData["apptype"]:1});return deferred},changeStatusType:function(){if(this.model.get("showType")=="one"){this.$el.addClass("remindme_widget_list_container_all")}else{this.$el.removeClass("remindme_widget_list_container_all")}},onAfterChangeCount:function(){var count=this.model.get("count");this.$el.removeClass("one_remindme_widget_list_container").removeClass("two_remindme_widget_list_container");if(count==1){this.$el.addClass("one_remindme_widget_list_container")}else if(count==2){this.$el.addClass("two_remindme_widget_list_container")}this.$el.find(".remindme_list_foot_count span").html(this.model.get("count"))},onAfterChangeShowType:function(){var type=this.model.get("showType");type=type=="one"?"all":"one";this.trigger("changeRouteData",{showType:type})},onAfterChangeIndex:function(ev){var handler=talent.$(ev.target).attr("data-handler");if(talent.$(ev.target).attr("status")==0){return}var index=this.model.get("index");index=handler=="prev"?index-1:index+1;this.trigger("changeRouteData",{index:index})},showDataPicker:function(ev){var self=this;ev.stopPropagation();this.changTimeId=talent.$(ev.target).parents("li").attr("data-id");var domOff=talent.$(ev.currentTarget).offset();var domH=talent.$(ev.currentTarget).height();var top=domOff.top+domH-parseInt(this.$el.css("top"))+5-talent.$(document).scrollTop();var left=domOff.left-parseInt(this.$el.css("left"));var domOff=talent.$(ev.currentTarget).offset();var domH=talent.$(ev.currentTarget).height();var top=domOff.top+domH;var left=domOff.left;var elOff=this.$el.offset();top=top-elOff.top+2;left=left-elOff.left;var isSyc=true;if(this.changeTimeId){var model=this.collection.where({Id:parseInt(this.changTimeId)});isSyc=model.get("IsSyc")}if(!this.datePickerView){this.datePickerView=new DatePickerView({model:new talent.Model({isSyc:isSyc})});this.datePickerView.render().$el.css({top:top,left:left});this.$el.append(this.datePickerView.$el);talent._.TitaCommon_preventMouseWheel(this.datePickerView.$el);this.listenTo(this.datePickerView,"onSelect",this.onAfterChangeRemindTime);this.$el.find(".remindme_list_container").off("mousewheel");this.$el.find(".remindme_list_container").on("mousewheel",function(){self.datePickerView.$el.hide()})}else{this.datePickerView.model.set("isSyc",isSyc);this.datePickerView.$el.css({top:top,left:left}).show()}},onAfterChangeRemindTime:function(data){var self=this;if(this.changTimeId){if(data==-1||data==-2){this.trigger("deleteData",{id:this.changTimeId,isOnce:data/-1})}else{this.trigger("changeData",{id:this.changTimeId,time:data})}}else{this.trigger("changeData",{time:data});this.$el.hide()}},onAfterClearRemindTime:function(ev){var id=talent.$(ev.target).parents("li").attr("data-id");var model=this.collection.where({Id:parseInt(id)})[0];var isSyc=model&&model.get("IsSyc");this.trigger("deleteData",{id:id,isOnce:isSyc?1:2})},onAfterClearAllRemindTime:function(ev){this.trigger("deleteData");this.$el.hide()},hideRemindeView:function(){this.trigger("changeRouteData",{index:0,showType:"one"});this.$el.hide()},onClose:function(){this.$el.remove()}});var RequestCollection={request:function(options){var deferred=new talent.$.Deferred;options=talent._.extend({},options);options.url=options.url||this.url;options.url=localContext.getApiUrl(options.url);if(options.mockData){action(options.mockData)}return deferred.promise();function action(resp){var code=resp.Code;if(code==1){var data=resp.Data;if(resp.ExtendedData){data=talent._.extend({},resp.Data,resp.ExtendedData)}deferred.resolve(data)}else{if(code==401){login()}deferred.reject(resp.Message)}}function login(){location.href=localContext.getLoginUrl();throw new Error("401")}},getData:function(options){var self=this;var defaults={dateTime:""};var deferred=new talent.$.Deferred;var options=talent._.extend({},defaults,options);var url="RemindV2/Get";this.request({type:"Get",url:url,data:options}).done(function(resp){deferred.resolve(resp)});return deferred},setData:function(options){return this.request({url:"RemindV2/Set?time="+options.time,type:"POST",data:options})},setAllData:function(options){return this.request({url:"RemindV2/BatchSet?time="+options.time,type:"POST",data:options})},deleteData:function(options){return this.request({url:"RemindV2/Delete",type:"POST",data:options})},deleteAllData:function(options){return this.request({url:"RemindV2/BatchDelete",type:"POST",data:options})},getBSGlobalData:function(options){var self=this;var defaults={appid:"1",apptype:"1"};var deferred=new talent.$.Deferred;var options=talent._.extend({},defaults,options);var url="Tenant/UX/GLOBAL";this.request({type:"Get",url:url,data:options,contentType:"application/json"}).done(function(resp){deferred.resolve(resp)});return deferred},getMessage:function(options){var defaults={page_size:20,page_num:1,status:1,app_type:-1,app_id:-1};options=talent._.extend({},defaults,options);var deferred=new talent.$.Deferred;var url="messages/Get";this.request({url:url,data:options,type:"get"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred}};var FooterView=talent.ItemView.extend({template:talent._.template("<div/>"),className:"footer",events:function(){var events={};return events},initialize:function(){this._getRouterData()},_getActiveData:function(data){var groupDatas=data;this.activeGroup=talent._.findWhere(groupDatas,{Active:true})||groupDatas[0];var tagDatas=this.activeGroup["PlanTableListModels"];var activeTagData=talent._.findWhere(tagDatas,{Active:true})||tagDatas[0];this.planTableId=activeTagData.PlanTableModels[0].PlanTableId},onRender:function(){this.$el.hide()},_getRouterData:function(){var self=this;var queryObject=talent.app.request("history:getQueryObject");var deferred=new talent.$.Deferred;queryObject.done(function(routerData){self.routerData=routerData||{};self.routerData["show_guide"]=routerData["show_guide"]=="true"?true:false});return deferred}});function DesktopNotice(){}DesktopNotice.prototype={inin:function(){this.hasDesktopNotice=false},show:function(img,title,context){if(this.hasDesktopNotice){return}var self=this;var logo="//st-web.tita.com/ux/tita-web-v4/release/app/images/common/logo.png";img=img?img:logo;if(Notification.permission!=="granted"){Notification.requestPermission()}this.DNotification=new Notification(title,{body:context,icon:logo,onClose:function(){self.hasDesktopNotice=false}});if(this.Timer)clearTimeout(this.Timer);this.Timer=setTimeout(function(){self.DNotification.close();self.hasDesktopNotice=false},6e3)},hide:function(){if(this.DNotification){this.DNotification.close()}}};var HeaderView=talent.CompositeView.extend({template:jst["common/page-regions/tita-header"],className:"_tt_header",ui:{logo:"a[data-name=logo]",searchBox:"div[data-name=head-search]",searchInput:'input[type = "search"]',searchButton:"a[data-name=head-search-button]",logout:".logout_tthn",dropdownMenu:".menu_ltthn",message:"li[data-name=head-message] a",label:"label[data-name=head-search-label]",todo:"li[data-name=head-to-do] a",task:"li[data-name=head-task] a",appSlector:".talent_app_selector",appContainer:".italent_show_app_container",headNav:"ul[data-name=head-nav]",navProfile:".profile_ltthn",navSet:".set_ltthn",logoutBtn:'a[data-name="logout"]',searchForm:"div[data-name=head-search]",brand:"span[data-name=brand]",platform:"a[data-name=head-platform]",todoIndicator:"[data-name=head-to-do-indicator]",messageIndicator:"[data-name=head-message-indicator]"},events:function(){var events={};events["click "+this.ui.searchButton]="_clickSearchBtn";events["mouseenter "+this.ui.searchButton]="_showTipsyHandler";events["mouseleave "+this.ui.searchButton]="_hideTipsyHandler";events["keyup "+this.ui.searchInput]="_keyupSearchInput";events["keydown "+this.ui.searchInput]="_keydownSearchInput";events["blur "+this.ui.searchInput]="_blurSearchInput";events["mouseenter "+this.ui.logout]="_showDropdownMenu";events["mouseleave "+this.ui.logout]="_hideDropdownMenu";events["click "+this.ui.label]="_labeClcik";events["click "+this.ui.appContainer]="_showApp";events["mouseenter "+this.ui.message]="_showTipsyHandler";events["mouseleave "+this.ui.message]="_hideTipsyHandler";events["mouseenter "+this.ui.task]="_showTipsyHandler";events["mouseleave "+this.ui.task]="_hideTipsyHandler";events["mouseenter "+this.ui.todo]="_showTipsyHandler";events["mouseleave "+this.ui.todo]="_hideTipsyHandler";events["mouseenter "+this.ui.platform]="_showTipsyHandler";events["mouseleave "+this.ui.platform]="_hideTipsyHandler";events["click "+this.ui.message]="_renderMessagePopView";events["click "+this.ui.todo]="_onClickTodo";return events},templateHelpers:function(){var routerData=this.routerData;var tenantInfo=this.talentInfo;var customModuleIsShow=this._customModuleIsShow();var logout=BSGlobal["logoutUrl"]||"/Account/Logout";return{routerData:routerData,i18n:this.i18n,UserInfo:this.userInfo,isShowTask:customModuleIsShow["task"],webHost:this.webHost,host:this.options["titaHost"],isShowPlatform:this.options["IsOpenTms"]||false,homeIndex:this.options["entryPageId"],logoutUrl:logout,messageIndicator:this._numberCustomize("messageIndicator"),todoIndicator:this._numberCustomize("todoIndicator"),avatarUrl:"#set?url="+this.options["titaHost"]+"/u/"+localContext.getUserInfo().Id+"/Setting/Avatar&page_id=avatar"}},modelEvents:{"change:todoIndicator":"_updateTodoIndicatorNum","change:messageIndicator":"_updateMessageIndicatorNum","change:tenantInfo":"render"},initialize:function(options){this.options=options||{};this.customizePage=this.options["customizePage"]||false;var evn=this.options["env"];this.webHost=this._getTitaHost();var self=this;this.i18n=this.options["BSi18n"];this.userInfo=this.options["loginUserInfo"];this.talentInfo=this.options["tenantInfo"];this.apiPath=BSGlobal["apiPath"];this.routerData={appid:this.options["appid"]||1,apptype:this.options["appid"]||1};this.headerAppData=this.options["WebHead"]["AppHead"];this.headerAppData=talent._.map(this.headerAppData,function(item){if(item["Display"]==true){return item}});this.headerAppData=talent._.compact(this.headerAppData);this.model=new talent.Model({tenantInfo:this.talentInfo,loginUserInfo:this.userInfo,headerAppData:this.headerAppData},{silent:true});this._initIndicator();var queryObject=talent.app.request("history:getQueryObject").done(function(routerData){self.routerData=talent._.extend({},self.routerData,routerData)});this.inintDesktopNotice=true;if(navigator.userAgent.indexOf("MSIE")>=0){this.inintDesktopNotice=false}else{this.desktopNotice=new DesktopNotice}this._renderRemindMeView();this._renderMessageView()},onShow:function(){this.$el.append(this.messageView.render().$el);this.$el.append(this.remindmeWidgetItemView.render().$el);if(this.customizePage)return;var self=this;this._renderSelectApp();this._getneoajaxObjRemindData();if(this.Timer)clearInterval(this.Timer);this.Timer=setInterval(function(){self._getneoajaxObjRemindData()},15e3)},onRender:function(){var self=this;this._showTelentLogo();if(this.customizePage){this.ui.headNav.remove();this.ui.searchForm.remove();return}this._bindGlobalEvents()},_showDesktopNotice:function(){if(this.inintDesktopNotice){this.desktopNotice.show("","tita提醒","您有新的消息！请查收。");this.inintDesktopNotice=false}document.title="新消息"},_initIndicator:function(){var self=this;this.model.set({messageIndicator:0,todoIndicator:0});var mCollection=Talent.Collection.extend({model:Talent.Model.extend({idAttribute:"type"})});this.indicatorCollection=new mCollection;this.listenTo(this.indicatorCollection,"reset",function(){var messageData=this.indicatorCollection.where({messageType:1});var dsData=this.indicatorCollection.findWhere({indicatorType:15});if(this.messageView){this.messageView.collection.reset(messageData)}});Talent.app.vent.on("GlobalIndicatorDelete",function(options){this._requestClearIndicator(options)},this)},_requestClearIndicator:function(options){var defaults={indicatorType:"",messageType:"",indicatorNum:0};var self=this;var options=talent._.extend({},defaults,options);IndicatorColllection.indicatorClear({messageType:options["messageType"]||0,indicatorType:options["indicatorType"]||""}).done(function(resp){if(options["indicatorType"]==""&&options["indicatorNum"]){if(options["messageType"]==1){var num=self.model.get("messageIndicator");if(num<0)num=0;self.model.set("messageIndicator",num-options["indicatorNum"])}if(options["messageType"]==2){var num=this.model.get("todoIndicator");if(num<0)num=0;self.model.set("todoIndicator",num-options["indicatorNum"])}return}var type=options["indicatorType"].split(",");for(var i=0;i<type.length;i++){var model=self.indicatorCollection.get(type[i]);if(!model)return;var value=Number(model.get("value"))||0;if(value==0)continue;var msgs=["mCommentIndicator","mLeaveIndicator","mLeaveAllIndicator","mWorkIndicator","mfollowIndicator","mLeaveWorkIndicator","mLeaveDepartmentIndicator","mtitaIndicator","messageIndicator","mSuccessionIndicator","mRecruitIndicator","mEMPIndicator","mTalentReviewIndicator","mGoalIndicator","mApprove"];var todos=["todotitaIndicator","todoIndicator","tSuccessionIndicator","tRecruitIndicator","tEMPIndicator","tTalentReviewIndicator","tGoalIndicator","tApprove"];var type=model.get("type");if(Talent._.indexOf(msgs,type)>-1){var messageIndicator=self.model.get("messageIndicator");var num=messageIndicator-value;if(num<0)num=0;self.model.set("messageIndicator",num);self._updateGlobalIndiator(type,num)}if(Talent._.indexOf(todos,type)>-1){var messageIndicator=self.model.get("todoIndicator");var num=messageIndicator-value;if(num<0)num=0;self.model.set("todoIndicator",num);self._updateGlobalIndiator(type,num)}self.messageView&&self.messageView.collection.remove(model)}})},_updateGlobalIndiator:function(type,num){if(window.BSGlobal["indicator"]){var data=window.BSGlobal["indicator"];var item=Talent._.findWhere(data,{type:type});if(item){item["value"]=num}}},_updateMessageIndicatorNum:function(){var self=this;var messageNum=this._numberCustomize("messageIndicator"),msg=this.ui.message,todo=this.ui.todo;if(messageNum){this.ui.messageIndicator.html(messageNum).show();setTimeout(function(){self.ui.messageIndicator.addClass("UI_animated UI_speed_400 UI_ani_bounce")},400);msg.attr({href:"javascript:void(0)","data-name":"has-msg"});this._showDesktopNotice()}else{this.ui.messageIndicator.hide().html(0);msg.attr({href:this.webHost+"#more/messages?messageType=2&isRead=2","data-name":"no-msg"})}},_updateTodoIndicatorNum:function(){var self=this;var todoNum=this._numberCustomize("todoIndicator"),todo=this.ui.todo;

if(todoNum){this.ui.todoIndicator.html(todoNum).show().addClass("UI_animated UI_speed_400 UI_ani_bounce");setTimeout(function(){self.ui.todoIndicator.removeClass("UI_animated UI_speed_400 UI_ani_bounce")},400);todo.attr({href:"javascript:void(0)","data-name":"has-msg"});this._showDesktopNotice()}else{this.ui.todoIndicator.hide().html(0);todo.attr({href:this.webHost+"#more/messages?messageType=1","data-name":"no-msg"})}this._requestTodo()},_getTitaHost:function(){var webHost=this.options["titaHost"]||"";var host="http://"+location.host;var pathName=location.pathname.split("/");if(webHost==host&&pathName[pathName.length-1]!="TmHome"&&pathName[pathName.length-1]!="OkrHome"&&pathName[pathName.length-1]!="OceanIndex"){webHost=""}else{webHost=webHost+"/"+localContext.getUserInfo().Id+"/ITalentHome"}return webHost},_numberCustomize:function(type){var num=Number(this.model.get(type));if(!num)return 0;if(num>99){return"99+"}return num},_requestTodo:function(){var self=this;if(this.todoPopView){ToColllection.getTodoData({pageNum:1,page_size:200,status:1}).done(function(resp){self.todoPopView.collection.reset(resp.todos.slice(0,5));self.todoPopView.model.set({total:resp.todos.length})})}},_onClickTodo:function(ev){var node=this.$(ev.currentTarget),self=this;ev.stopPropagation();if(node.attr("data-name")=="no-msg"){return}this._renderRemainPopView()},_renderRemainPopView:function(){var self=this;ToColllection.getTodoData({pageNum:1,page_size:200,status:1}).done(function(resp){self.messageView&&self.messageView.hide();if(!resp.todos.length){return}if(self.todoPopView){if(self.todoPopView.isShow){self.todoPopView.hide()}else{self.todoPopView.show(self.ui.todo.parent(),{pos:"bottomRight",parentEl:self.$el,leftBias:72,topBias:10})}}else{self.todoPopView=new TodoPopView({collection:new talent.Collection(resp.todos.slice(0,5)),model:new talent.Model({total:resp.todos.length}),titaHost:self.webHost});self.$el.append(self.todoPopView.render().el);self.todoPopView.show(self.ui.todo.parent(),{pos:"bottomRight",parentEl:self.$el,leftBias:72,topBias:10})}})},_renderMessageView:function(){this.messageView=new MessagePopView({collection:new talent.Collection([]),titaHost:this.webHost})},_renderMessagePopView:function(ev){var node=this.$(ev.currentTarget),self=this;ev.stopPropagation();if(node.attr("data-name")=="no-msg"){return}this.todoPopView&&this.todoPopView.hide();if(!this.firstShowMessage){this.firstShowMessage=true;this.messageView.isShow=false;this.$el.append(this.messageView.render().el)}if(this.messageView.isShow){this.messageView.hide()}else{this.messageView.show(this.ui.message.parent(),{pos:"bottomRight",parentEl:this.$el,leftBias:72,topBias:10})}},_showTipsyHandler:function(event){var node=talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"n",trigger:"manual"})}node.tipsy("show")},_hideTipsyHandler:function(event){var node=talent.$(event.currentTarget);node.tipsy("hide")},_bindGlobalEvents:function(){var self=this;talent.$(document).off("click.head-search");talent.$(document).on("click.head-search",function(){self._searchInputPackUp()})},_searchInputPackUp:function(){var parentNode=talent.$(this.ui.searchBox);var val=talent.$.trim(this.$(".tt_headsearch input").val());var input=parentNode.find(".text_tths");if(val==""){parentNode.removeClass("focus_tt_headsearch");input.stop().animate({width:0},300,function(){input.hide();input.css("width","auto")})}},_getDate:function(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if(month<10){month="0"+month}if(day<10){day="0"+day}return year+"/"+month+"/"+day},_setGlobalIndicator:function(data){if(!window.BSGlobal){window.BSGlobal={}}window.BSGlobal["indicator"]=data},_parseData:function(response){var i18n=this.options["BSi18n"];talent._.map(response,function(value,key){var typeText;switch(value.ObjType){case 7:typeText=i18n["task_1"];break;case 4:typeText=i18n["work_1"];break;case 10:typeText=i18n["home_1"];break;case 11:typeText=i18n["plan_1"];break;case 8:typeText="日报";break;case 20:typeText="会议";break;case 21:typeText="出差";break}return value.typeText=typeText});return response},_showTelentLogo:function(){var self=this;var imgUrl=this.model.get("tenantInfo")["Logo"];if(!imgUrl)return;var img=new Image;img.onload=function(){var w=img.width;var h=img.height;var wh=self.fixImgSize(w,h,100,39);var mt=(39-wh.h)/2;self.ui.logo.find("img").css({width:wh.w,height:wh.h,"margin-top":mt<0?0:mt});self.ui.logo.find("img").attr("src",imgUrl)};img.onerror=function(){};img.src=imgUrl},fixImgSize:function(width,height,defaultWidth,defaultHeight){var WH={w:0,h:0};var initWid=width;var initHei=height;var defWid=defaultWidth;var defHei=defaultHeight;if(initWid>0&&initHei>0){var defFix=defWid/defHei;var initFix=initWid/initHei;if(initWid>defWid||initHei>defHei){if(initFix>defFix){WH.w=defWid;WH.h=initHei*(defWid/initWid)}else{WH.w=initWid*(defHei/initHei);WH.h=defHei}}else{WH.w=initWid;WH.h=initHei}}else{WH.w=initWid;WH.h=initHei}return WH},_renderRemindMeView:function(){if(!this.remindmeWidgetItemView){this.remindmeWidgetItemView=new RemindmeWidgetItemView}else{this.remindmeWidgetItemView.modelDataChange()}},_showDropdownMenu:function(events){var node=talent.$(events.currentTarget);var ui=talent.$(this.ui.dropdownMenu);node.addClass("hover_logout_tthn")},_labeClcik:function(events){events.stopPropagation();this.ui.searchInput.focus()},_hideDropdownMenu:function(events){var node=talent.$(events.currentTarget);var ui=talent.$(this.ui.dropdownMenu);node.removeClass("hover_logout_tthn")},_keyupSearchInput:function(events){var node=talent.$(events.currentTarget);var val=this._trimall(node.val());if(val.length>50){node.val(val.substring(0,50))}},_keydownSearchInput:function(events){events.stopPropagation();this.ui.label.hide();var node=talent.$(events.currentTarget);var val=this._trimall(node.val());if(events.keyCode==13&&val!=""){talent.$(this.ui.searchButton).trigger("click")}},_clickSearchBtn:function(events){events.stopPropagation();var node=talent.$(events.target);var parentNode=talent.$(this.ui.searchBox);var val=talent.$.trim(this.$(".tt_headsearch input").val());var input=parentNode.find(".text_tths");if(val==""){parentNode.addClass("focus_tt_headsearch");parentNode.find("input").focus();input.css("width",0).show();input.stop().animate({width:"146"},300)}else{var encodeval=encodeURIComponent(this._encodeScript(val));window.location.href=this.options["titaHost"]+"/Search/"+this.userInfo["Id"]+"/Search/Home?search="+encodeval}},_blurSearchInput:function(events){var node=talent.$(events.currentTarget);var val=talent.$.trim(node.val());var parentNode=node.parent();if(val==""){this.ui.label.show()}},_trimall:function(str){return str.replace(/^[\s　]+/,"").replace(/[\s　]+$/,"")},_encodeScript:function(str){var s="";if(str.length==0)return"";s=str.replace(/&/g,"&amp;");s=s.replace(/</g,"&lt;");s=s.replace(/>/g,"&gt;");s=s.replace(/    /g,"&nbsp;");s=s.replace(/\'/g,"&apos;");s=s.replace(/\"/g,"&quot;");s=s.replace(/\n/g,"");return s},_renderSelectApp:function(){var self=this;talent._.each(this.headerAppData,function(item){item.ClassName="app_"+item.AppId});if(!this.appSelectView){this.appSelectView=new AppSelectView({collection:new talent.Collection(self.headerAppData)});this.listenTo(this.appSelectView,"show",function(){self.ui.appContainer.trigger("click")});this.appSelectView.render().$el.appendTo(this.$el)}else{this.appSelectView.collection.reset(self.headerAppData)}},_showApp:function(ev){ev.stopPropagation();if(this.customizePage){talent.app.vent.trigger("App-Select-Item-View:show",function(){self.ui.appContainer.trigger("click")});return}this.appSelectView.show()},highlightUI:function(borderData){this.ui.brand[borderData.flag+"Class"]("show_border");this.ui.logo[borderData.flag+"Class"]("show_border")},update:function(newData){var tenantInfo=newData["tenantInfo"];var uploadResp=tenantInfo["uploadResp"]||"";var logo=tenantInfo["tenantLogo"];if(uploadResp){var json=eval("("+uploadResp+")");var logo=json["Result"][0]["ClientUrl"]}tenantInfo["Logo"]=logo;tenantInfo["Abbreviation"]=tenantInfo["tenantName"];this.model.set(newData)},onClose:function(){talent.$(document).off("click.head-search");talent.app.vent.off("route")},_customModuleIsShow:function(){var navigations=this.options["navigations"]||{};var navs=navigations["titaHomeNavigation"]||[];var obj={};for(var i=0;i<navs.length;i++){var item=navs[i];var value=item["navigationValue"],url=value["url"].substr(1);obj[url]=value["isUse"]}obj["task"]=obj["plan"]||false;obj["calendar"]=obj["plan"]&&obj["task"]&&obj["work"]||false;return obj}});var SidebarItemView=talent.ItemView.extend({template:jst["common/page-regions/tita-sidebar"],tagName:"li",ui:{homeIndicator:"[data-name=tita-sidebar-home-indicator]"},modelEvents:{"change:feedIndicator":"_updateHomeIndicator"},initialize:function(){var self=this;if(this.model.get("navigationType")=="HomeDynamic"){this.model.set({feedIndicator:0},{silent:true});Talent.app.vent.on("GlobalIndicatorUpdate",function(indicatorCollection){var model=indicatorCollection.get("feedIndicator")||new Talent.Model;var feedIndicator=model.get("value")||0;self.model.set("feedIndicator",feedIndicator)})}},_updateHomeIndicator:function(){var self=this;var num=this._numberCustomize("feedIndicator"),node=this.ui.homeIndicator;if(num){node.show().addClass("UI_animated UI_speed_400 UI_ani_bounce");setTimeout(function(){node.removeClass("UI_animated UI_speed_400 UI_ani_bounce")},400)}else{node.hide()}},_numberCustomize:function(type){var num=Number(this.model.get(type));if(!num)return 0;if(num>99){return"99+"}return num}});var SidebarView=talent.CollectionView.extend({tagName:"ul",className:"_tt_sidenav",itemView:SidebarItemView,itemViewContainer:"ul",ui:{li:"ul li"},events:function(){var events={};events["click "+this.ui.li]="_bindSidebar";return events},initialize:function(options){var self=this;this.options=options||{};this.routerData={appid:localContext.getGlobal("appid")||1,apptype:localContext.getGlobal("appid")||1};this._getNavData();this.customizePage=this.options["customizePage"]||false;if(this.customizePage==true){var data=this._customizeDataChange(options["data"]);this.collection=new talent.Collection(data["nav"]);this.$el.delegate("a","click",function(event){event.preventDefault();return false})}talent.app.vent.on("route",function(fragments,params){var hash=decodeURIComponent(location.hash);self._setDefault(hash)});talent.app.vent.on("sidebar-view:click",function(data){self._setDefault(data)})},onShow:function(){var self=this;var hash=decodeURIComponent(location.hash);this._setDefault(hash);this._setClientHeight()},highlightUI:function(borderData){this.$el[borderData.flag+"Class"]("show_border")},update:function(newData){var data=this._customizeDataChange(newData);this.collection.reset(data["nav"])},_getNavData:function(){var self=this,data=this.options["navigations"];if(data&&data["titaHomeNavigation"]&&data["titaHomeNavigation"].length){this._setNavData(data)}},_setNavData:function(data){var self=this,navData=data["titaHomeNavigation"]||[],new_nav_data=[];talent._.each(navData,function(item){var obj=item["navigationValue"];var json=talent._.extend({},item,obj),className=json["className"]||"";if(className){json["type_class"]=className}else{json["type_class"]=self._setTypeForData(json["url"])}if(json["isUse"]==true){new_nav_data.push(json)}});this.collection.reset(new_nav_data)},_bindSidebar:function(event){var node=talent.$(event.currentTarget);this.ui.li.removeClass("active");node.addClass("active")},_setDefault:function(data){var ary=[];if(data.indexOf("#")==-1){data="#"+data}if(data.indexOf("#")==0){ary.push(data);if(data.indexOf("?")>0){var s_data=data.split("?")[0];ary.push(s_data);ary.push(s_data.split("/")[0])}}var allA=this.$el.find("li");allA.removeClass("active");if(ary.length==1){var dataHref=ary[0];var aNode=this.$el.find('a[href="'+dataHref+'"]');if(!aNode.length){dataHref=dataHref.split("/")[0];aNode=this.$el.find('a[href="'+dataHref+'"]')}aNode.closest("li").addClass("active");this._clearIndictor(aNode)}if(ary.length>1){var aNode=this.$el.find('a[href="'+ary[0]+'"]');if(!aNode.length){aNode=this.$el.find('a[href="'+ary[1]+'"]')}if(!aNode.length){aNode=this.$el.find('a[href="'+ary[2]+'"]')}aNode.closest("li").addClass("active");this._clearIndictor(aNode)}},_clearIndictor:function(node){var id=node.attr("id");var model=this.collection.get(id);if(node.attr("data-type")=="HomeDynamic"){model.set("feedIndicator",0);Talent.app.vent.trigger("GlobalIndicatorDelete",{indicatorType:"feedIndicator",messageType:0})}},_setClientHeight:function(){var self=this;var main=this.$el;var setHeight=localContext.setMainRegionsHeight;setHeight(main);var resizeDelay=talent._.debounce(function(){setHeight(main)},300);$(window).off("resize.baseMaterLayout");$(window).on("resize.baseMaterLayout",resizeDelay)},_setTypeForData:function(url){var hashMarkIndex=url.indexOf("#");if(hashMarkIndex>-1){url=url.substr(1)}var markIndex=url.indexOf("?");if(markIndex>-1){url=url.slice(0,markIndex)}return url.split("/")[0]},_customizeDataChange:function(data){var self=this;talent._.each(data["nav"],function(item){item["type_class"]=self._setTypeForData(item["url"])});return data}});var MasterLayout=talent.BaseMasterLayout.extend({template:jst["common/layouts/master-layout"],regions:{header:"#header-region",footer:"#footer-region",sidebar:"#sidebar-region",main:"#main-region",rightSidebar:"#right-sidebar-region",pullScreen:"#pull-screen-region"},initialize:function(){this.routerData={appid:localContext.getGlobal("appid")||1,apptype:localContext.getGlobal("appid")||1}},className:"tt_layout_warp",regionsClass:{header:HeaderView,footer:FooterView,sidebar:SidebarView},_setClientHeight:function(){var headH=$(this.regions.header).outerHeight();var footH=$(this.regions.footer).outerHeight();var H=$(window).height()-headH-footH;var main=this.$el.find("._tt_layout_body");main.css({minHeight:H})},onShow:function(){var self=this;this._getBSGlobalData();this._setClientHeight();Talent.$(window).on("resize.Tita-Common-Master-Layout",function(){self._setClientHeight()})},onViewShowAfter:function(){},_getBSGlobalData:function(){var self=this,data=localContext.getGlobal("navigations"),routerData=this.routerData;this.globaData=BSGlobal;if(data&&data["titaHomeNavigation"]&&data["titaHomeNavigation"].length){this.renderView(this.globaData)}else{RequestCollection.getBSGlobalData({appid:routerData["appid"],apptype:routerData["apptype"]}).done(function(resp){self.globaData=resp;self.renderView()})}},renderView:function(){var headerView=new this.regionsClass.header(this.globaData);this.header.show(headerView);this.footer.show(new this.regionsClass.footer);this.refresh();this.onViewShowAfter()},refresh:function(){this._renderSidebarRight();if(this.hideSidebar){this.SidebarViewClass=null;this.sidebar.close();$(this.$el).addClass("tt_no_sidebar")}else{$(this.$el).removeClass("tt_no_sidebar");var SidebarViewClass=this.sidebarViewClass?this.sidebarViewClass:this.regionsClass.sidebar;if(this.SidebarViewClass!==SidebarViewClass||this.refreshSidebar){this.SidebarViewClass=SidebarViewClass;this.sidebarView=new this.SidebarViewClass(this.globaData);this.sidebar.show(this.sidebarView)}}var mainView=new this.mainViewClass(this.options);this.main.show(mainView);this._adjustPagelinePos()},_adjustPagelinePos:function(){if(typeof this.options.hideSubMenu=="undefined"){this.$el.addClass("tu-page-hidesubmenu").removeClass("tu-page-submenu");return}if(this.options.hideSubMenu){this.$el.addClass("tu-page-hidesubmenu").removeClass("tu-page-submenu")}else{this.$el.removeClass("tu-page-hidesubmenu").addClass("tu-page-submenu");this._adjustPageLinePos()}},_adjustPageLinePos:function(){var node=this.$el.find("#main-region");var wGide3=this.$el.find("[data-tu-submenu=tu-submenu]");node.css({backgroundPosition:wGide3.width()-1+"px 0"});wGide3.find(".tu-col-container").css("marginRight",1)},_getFragments:function(){var self=this;talent.app.request("history:getFragments").done(function(fragments){self.refreshSidebarRight=false;if(talent._.difference(self.routerFragments,fragments).length){self.refreshSidebarRight=true}self.routerFragments=fragments})},_renderSidebarRight:function(){this._getFragments();var self=this;var options=this.options;var showRightSidebar=options.showRightSidebar;var rightSidebar=showRightSidebar&&showRightSidebar();var showRightSidebar=rightSidebar&&rightSidebar.showRightSidebar,rightSidebarView=rightSidebar&&rightSidebar.rightSidebarView;if(rightSidebar&&rightSidebar.refreshSidebarRight){this.refreshSidebarRight=rightSidebar.refreshSidebarRight}if(showRightSidebar&&this.RightSidebarView){if(!this.refreshSidebarRight)return;this.RightSidebarView=rightSidebar.rightSidebarView;this.rightSidebar.show(this.RightSidebarView);this.$el.find(this.regions.main).addClass("tt_layout_container_show_rightbar")}else if(showRightSidebar&&!this.RightSidebarView){this.RightSidebarView=rightSidebarView;this.rightSidebar.show(this.RightSidebarView);this.$el.find(this.regions.main).addClass("tt_layout_container_show_rightbar")}else{this.rightSidebar.close();this.RightSidebarView=null;this.$el.find(this.regions.main).removeClass("tt_layout_container_show_rightbar")}}});var MasterLayoutSingle=new MasterLayout;return{MasterLayout:MasterLayoutSingle,HeaderView:HeaderView,FooterView:FooterView,SidebarView:SidebarView,RemindmeWidgetItemView:RemindmeWidgetItemView}});define("iTalent-header",["talent"],function(Talent){var jst=function(){this["JST"]=this["JST"]||{};this["JST"]["header/company-info"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="company-icon">\n	<!-- <a href="'+((__t=href)==null?"":__t)+'"><img class="cmpy-logo" src="'+((__t=logo)==null?"":__t)+'"></a> -->\n	<a href="'+((__t=href)==null?"":__t)+'"><img class="cmpy-logo" src=""  alt="logo"></a>\n	<span class="company-name">'+((__t=name)==null?"":__t)+"</span>\n</div>"}return __p};this["JST"]["header/header"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='    \n    <div class="header-out-wrapper">\n        <div class="header-left company-info-region clearfix"></div>\n        <div class="header-right clearfix">\n          <!--用户信息-->\n          <div class="user-info-region"></div>\n          <ul class=\'btns-group\'></ul>\n        </div>\n    </div>\n'}return __p};this["JST"]["header/icon-view/home-page"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+=' \n<a class="common-link '+((__t=iconName)==null?"":__t)+'" href="'+((__t=href)==null?"":__t)+'">\n	';if(reminds.remindCount){__p+='\n 		<span class="new-message">'+((__t=reminds.remindCount<=99?reminds.remindCount:"99+")==null?"":__t)+"</span>\n 	"}__p+='\n</a>\n<div class="list-wrapper"></div>\n'}return __p};this["JST"]["header/icon-view/message"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+=' \n<a class="common-link '+((__t=iconName)==null?"":__t)+'" href="'+((__t=reminds.remindCount?"javascript:void(0)":href)==null?"":__t)+'">\n	';if(reminds.remindCount){__p+='\n 		<span class="new-message">'+((__t=reminds.remindCount<=99?reminds.remindCount:"99+")==null?"":__t)+"</span>\n 	"}__p+="\n</a>\n\n";if(reminds.remindList.length){__p+='\n	<div class="list-wrapper">\n		<div class="content-visible">\n				<div class="title">'+((__t="新通知("+reminds.remindCount+")")==null?"":__t)+'</div>\n				<ul class="message-list">\n					';Talent._.each(reminds.remindList,function(item,index){__p+='\n						<li class="message-item">\n							<a href="'+((__t=item.href)==null?"":__t)+'" class="message-item-a">\n								<span class="icon-box '+((__t=item.className)==null?"":__t)+'"></span>\n								<span class="content">'+((__t=item.content)==null?"":__t)+'</span>\n								<span class="num" >'+((__t=item.length)==null?"":__t)+'</span>\n								<span class="date">'+((__t=item.date)==null?"":__t)+"</span>\n							</a>\n						</li>\n					"});__p+='\n				</ul>\n				<li class="view-all"><a href="'+((__t=reminds.viewAllHref)==null?"":__t)+'">查看全部</a></li>\n		</div>\n	</div>\n'}__p+="\n"}return __p};this["JST"]["header/icon-view/search"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+=' \n<a class="common-link '+((__t=iconName)==null?"":__t)+'" href="'+((__t=href)==null?"":__t)+'">\n	';if(reminds.remindCount){__p+='\n 		<span class="new-message">'+((__t=reminds.remindCount)==null?"":__t)+"</span>\n 	"}__p+='\n</a>\n\n<div class="list-wrapper">\n		<div class="form-input form-input-active"> \n			<input placeholder="请输入搜索内容" autofocus="autofocus" /> \n		</div> \n\n		<div class="comfirm-btn"></div>\n</div>\n'}return __p};this["JST"]["header/icon-view/settings"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+=' \n<a class="common-link '+((__t=iconName)==null?"":__t)+'" href="'+((__t=href)==null?"":__t)+'">\n	';if(reminds.remindCount){__p+='\n 		<span class="new-message">'+((__t=reminds.remindCount<=99?reminds.remindCount:"99+")==null?"":__t)+"</span>\n 	"}__p+='\n</a>\n<div class="list-wrapper"></div>\n'}return __p};this["JST"]["header/icon-view/skin"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='	<a class="common-link '+((__t=iconName)==null?"":__t)+'" href="'+((__t=href)==null?"":__t)+'">\n		';if(reminds.remindCount){__p+='\n 		<span class="new-message">'+((__t=reminds.remindCount<=99?reminds.remindCount:"99+")==null?"":__t)+"</span>\n	 	"}__p+='\n	</a>\n	<div class="list-wrapper">\n		<div class="content-visible">\n			<div class="color-title">拖动滑块选择颜色</div>\n			<input type="range" class="color-range">\n			<div class="selector-btn clearfix">\n				<div class="check-default check-back">\n					<div class="check-box ">\n						<span class="un-check"></span>\n						<span class="in-check"></span>\n					</div>\n					<label class="text">恢复默认</label>\n				</div>\n\n				<span class="comfirm-btn-style comfirm-btn">确定</span>\n			</div>\n		</div>\n	</div>\n</div>\n'}return __p};this["JST"]["header/icon-view/todos-item/todos-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n	";Talent._.each(reminds.remindList,function(item,index){__p+='\n		<li class="message-item">\n			<a href="'+((__t=item.href)==null?"":__t)+'" class="clearfix message-item-a">\n				';if(item.avatar.hasAvatar){__p+='\n					<div class="user-pic"><img src="'+((__t=item.avatar.medium)==null?"":__t)+'"></div>\n				'}else{__p+='\n					<div class="user-pic" style="background-color: '+((__t=item.avatar.color)==null?"":__t)+'">'+((__t=item.userName.substr(0,1)||"Name")==null?"":__t)+"</div>\n				"}__p+='\n				<div class="item-detail">\n					<div class="detail-head clearfix">\n						<span class="user-name">'+((__t=item.userName)==null?"":__t)+'</span>\n						<span class="user-opr">'+((__t=item.teskName)==null?"":__t)+'</span>\n						<span class="date">'+((__t=item.date)==null?"":__t)+'</span>\n					</div>\n					<div class="detail-content">'+((__t=item.taskContent)==null?"":__t)+"</div>\n				</div>\n			</a>\n		</li>\n	"});__p+="\n"}return __p};this["JST"]["header/icon-view/todos"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+=' \n<a class="common-link '+((__t=iconName)==null?"":__t)+'" href="'+((__t=reminds.remindCount?"javascript:void(0)":href)==null?"":__t)+'">\n	';if(reminds.remindCount){__p+='\n 		<span class="new-message">'+((__t=reminds.remindCount<=99?reminds.remindCount:"99+")==null?"":__t)+"</span>\n 	"}__p+="\n</a>\n\n";if(reminds.remindCount){__p+='\n	<div class="list-wrapper">\n		<div class="content-visible">\n			<div class="title">'+((__t="我的待办("+reminds.remindCount+")")==null?"":__t)+'</div>\n			<ul class="message-list">\n				<div class="spinner">\n					<div class="rect1"></div>\n					<div class="rect2"></div>\n					<div class="rect3"></div>\n					<div class="rect4"></div>\n				</div>\n				<div class="text-loading">加载中...</div>\n			</ul>\n			<li class="view-all"><a href="'+((__t=reminds.viewAllHref)==null?"":__t)+'">查看全部</a></li>\n		</div>\n	</div>\n'}__p+="\n"}return __p};this["JST"]["header/user-info"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n	<div class="user-info">\n		';if(userInfo.avatar.hasAvatar){__p+='\n			<span class="user-photo"><img src="'+((__t=userInfo.avatar.small)==null?"":__t)+'"></span>\n		'}else{__p+='\n			<span class="name-pic" style="background-color: '+((__t=userInfo.avatar.color)==null?"":__t)+'">'+((__t=userInfo.name.substr(0,1)||"Name")==null?"":__t)+"</span>\n		"}__p+='\n			<span class="user-name">'+((__t=userInfo.name)==null?"":__t)+'</span>\n	</div>\n\n	<div class="dp-down-list">\n		<ul class="list-ul-box dp-list-front">\n		';Talent._.each(userInfoDropDown,function(item,index){__p+='\n			<li class="dp-list-item"><a href="'+((__t=item.href)==null?"":__t)+'" target="'+((__t=item.target)==null?"":__t)+'" data-name="'+((__t=item.type)==null?"":__t)+'" index="'+((__t=index)==null?"":__t)+'">'+((__t=item.title)==null?"":__t)+"</a></li>\n		"});__p+='\n			<!-- <li class="item-high-light"></li> -->\n		</ul>\n\n		<ul class="list-ul-box dp-list-shadow">\n			';Talent._.each(userInfoDropDown,function(item,index){__p+='\n				<li class="'+((__t="item-"+index)==null?"":__t)+'" item-index="'+((__t=index)==null?"":__t)+'"><a href="">'+((__t=item.title)==null?"":__t)+"</a></li>\n			"});__p+="\n		</ul>\n	</div>"}return __p};return this["JST"]}();var Search=Talent.Layout.extend({template:jst["header/icon-view/search"],className:"search-icon-box",initialize:function(options){this.options=options;this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render)},regions:{popRegion:".list-wrapper"},ui:{iconBtn:".common-link",popList:".list-wrapper",valueInput:".form-input input"},events:function(){var events={};events["click "+this.ui.iconBtn]="listShow";events["mousedown "+this.ui.popList]="popListClick";events["keyup "+this.ui.valueInput]="valueInput";return events},onShow:function(){},popListClick:function(evt){var e=evt||window.event;e.stopPropagation()},listShow:function(e){var self=this;this.ui.popList.addClass("list-open").removeClass("list-close");this.ui.iconBtn.addClass("opr-btns-select");this.ui.valueInput.focus();Talent.$(document).off("mousedown.list-wrapper");Talent.$(document).on("mousedown.list-wrapper",function(e){self.ui.popList.removeClass("list-open").addClass("list-close");self.ui.iconBtn.removeClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper")});this.trigger("iconClickEvent",this.options)},valueInput:function(e){if(e.which==13){var triggerData={target:this.options.type,id:this.options.id,exportData:{searchValue:Talent.$(e.target).val()}};this.trigger("iconOprEvents",triggerData);this.listClose()}},listClose:function(){this.ui.popList.removeClass("list-open").addClass("list-close")},messageRenew:function(newMsg){this.model.clear({silent:true}).set(newMsg)}});var HomePage=Talent.Layout.extend({template:jst["header/icon-view/home-page"],className:"",initialize:function(options){this.options=options;this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render)},ui:{iconBtn:".common-link"},events:function(){var events={};events["click "+this.ui.iconBtn]="iconBtnClick";return events},onShow:function(){},iconBtnClick:function(){this.trigger("iconClickEvent",this.options)},messageRenew:function(){this.model.set({reminds:newMsg.reminds})}});var Message=Talent.Layout.extend({template:jst["header/icon-view/message"],className:"message-icon-box",initialize:function(options){this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render)},regions:{popRegion:".list-wrapper"},ui:{iconBtn:".common-link",popList:".list-wrapper",messageItem:".message-item",viewAll:".view-all"},events:function(){var events={};events["click "+this.ui.iconBtn]="listShow";events["mousedown "+this.ui.popList]="popListClick";events["click "+this.ui.messageItem]="listClose";events["click "+this.ui.viewAll]="listClose";return events},onShow:function(){},popListClick:function(evt){var e=evt||window.event;e.stopPropagation()},listShow:function(e){var self=this;this.ui.popList.addClass("list-open").removeClass("list-close");this.ui.iconBtn.addClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper");Talent.$(document).on("mousedown.list-wrapper",function(e){self.ui.popList.removeClass("list-open").addClass("list-close");self.ui.iconBtn.removeClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper")});this.trigger("iconClickEvent",this.options)},listClose:function(){this.ui.popList.removeClass("list-open").addClass("list-close")},messageRenew:function(newMsg){this.model.clear({silent:true}).set(newMsg)}});var TodosItems=Talent.ItemView.extend({template:jst["header/icon-view/todos-item/todos-item"],initialize:function(options){this.model=new Talent.Model(options)}});var Todos=Talent.Layout.extend({template:jst["header/icon-view/todos"],className:"todos-icon-box",initialize:function(options){this.options=options;this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render)},regions:{listRegion:".message-list"},ui:{iconBtn:".common-link",popList:".list-wrapper",messageItem:".message-item",viewAll:".view-all"},events:function(){var events={};events["click "+this.ui.iconBtn]="listShow";events["mousedown "+this.ui.popList]="popListClick";events["click "+this.ui.messageItem]="listClose";events["click "+this.ui.viewAll]="listClose";return events},onRender:function(){},popListClick:function(evt){var e=evt||window.event;e.stopPropagation()},listShow:function(e){var self=this;if(this.model.get("reminds").remindCount){this.ui.popList.addClass("list-open").removeClass("list-close");

this.ui.iconBtn.addClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper");Talent.$(document).on("mousedown.list-wrapper",function(e){self.ui.popList.removeClass("list-open").addClass("list-close");self.ui.iconBtn.removeClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper")})}this.trigger("iconClickEvent",this.options)},listClose:function(){this.ui.popList.removeClass("list-open").addClass("list-close")},messageRenew:function(newMsg){if(newMsg.reminds.remindList&&newMsg.reminds.remindList.length){this.listRegion.show(new TodosItems(newMsg))}else{this.model.clear({silent:true}).set(newMsg)}}});var Skin=Talent.Layout.extend({template:jst["header/icon-view/skin"],className:"skin-icon-box",initialize:function(options){this.options=options;this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render)},regions:{popRegion:".list-wrapper"},ui:{iconBtn:".common-link",popList:".list-wrapper",comfirmBtn:".comfirm-btn",inputRange:".color-range",checkbox:".check-default"},events:function(){var events={};events["click "+this.ui.iconBtn]="listShow";events["mousedown "+this.ui.popList]="popListClick";events["click "+this.ui.comfirmBtn]="getRangeVal";events["click "+this.ui.checkbox]="setDefalutColor";return events},onShow:function(){},popListClick:function(evt){var e=evt||window.event;e.stopPropagation()},getRangeVal:function(){var triggerData={target:this.options.type,id:this.options.id,exportData:{rangeValue:this.ui.inputRange.val(),isDefaultColor:this.ui.checkbox.hasClass("check-go")}};this.trigger("iconOprEvents",triggerData);this.listClose()},setDefalutColor:function(){this.ui.checkbox.toggleClass("check-back").toggleClass("check-go")},listShow:function(e){var self=this;this.ui.popList.addClass("list-open").removeClass("list-close");this.ui.iconBtn.addClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper");Talent.$(document).on("mousedown.list-wrapper",function(e){self.ui.popList.removeClass("list-open").addClass("list-close");self.ui.iconBtn.removeClass("opr-btns-select");Talent.$(document).off("mousedown.list-wrapper")});this.trigger("iconClickEvent",this.options)},listClose:function(){this.ui.popList.removeClass("list-open").addClass("list-close")},messageRenew:function(newMsg){this.model.clear({silent:true}).set(newMsg)}});var Settings=Talent.Layout.extend({template:jst["header/icon-view/settings"],className:"",initialize:function(options){this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render)},ui:{iconBtn:".common-link"},events:function(){var events={};events["click "+this.ui.iconBtn]="iconBtnClick";return events},onShow:function(){},iconBtnClick:function(){this.trigger("iconClickEvent",this.options)},messageRenew:function(newMsg){this.model.clear({silent:true}).set(newMsg)}});var UserInfo=Talent.Layout.extend({template:jst["header/user-info"],className:"",initialize:function(options){this.options=options;this.model=new Talent.Model(options)},ui:{showList:".user-info",listWrap:".dp-down-list",listItem:".list-ul-box .dp-list-item a",listFront:".dp-list-front",listShadow:".dp-list-shadow"},events:function(){var events={};events["click "+this.ui.showList]="showList";events["click "+this.ui.listItem]="listItemScale";return events},onShow:function(){},showList:function(e){var self=this;this.ui.listWrap.addClass("dp-down-active");Talent.$(document).off("mouseup.alertList");Talent.$(document).on("mouseup.alertList",function(e){self.ui.listWrap.removeClass("dp-down-active");Talent.$(document).off("mouseup.alertList")})},listItemScale:function(e){var self=this;var itemIndex=Talent.$(e.target).attr("index");this.ui.listWrap.removeClass("dp-down-active");!this.isIE()&&this.ui.listShadow.show();this.ui.listShadow.find(".item-"+itemIndex).addClass("li-scale").siblings().removeClass("li-scale");setTimeout(function(){self.ui.listShadow.hide()},350)},isIE:function(){if(!!window.ActiveXObject||"ActiveXObject"in window)return true;else return false}});var CompanyInfo=Talent.Layout.extend({template:jst["header/company-info"],className:"",initialize:function(options){if(!options.logo)options.logo="http://st-web.tita.com/ux/tita-web-v4/release/app/images/components/tita-common/logo_v3.png";this.model=new Talent.Model(options)},ui:{companyLogo:".cmpy-logo"},onRender:function(){var self=this;this.ui.companyLogo.attr("src",this.model.get("logo")).load(function(){imgWidth=this.width;imgHeight=this.height;var radio=imgWidth/imgHeight;if(this.height>30){var h=30;var w=radio*30;$(this).css({height:h,width:w,display:"block"})}else{var marginTop=(30-imgHeight)/2;var h=radio*imgHeight;$(this).css({height:imgHeight,"margin-top":marginTop,width:h,display:"block"})}})}});var Header=Talent.Layout.extend({template:jst["header/header"],className:"iTalent-header",initialize:function(options){var self=this;this.options=options;this.viewMapping={Search:Search,HomePage:HomePage,Message:Message,Skin:Skin,Todos:Todos,Settings:Settings}},ui:{btnGroup:".btns-group"},regions:{userInfoRegion:".user-info-region",companyInfoRegion:".company-info-region"},onShow:function(){},onRender:function(){this.companyInfoShow();this.userInfoShow();this.oprBtnShow()},userInfoShow:function(){this.userInfoRegion.show(new UserInfo({userInfo:this.options.userInfo,userInfoDropDown:this.options.userInfoDropDown}))},companyInfoShow:function(){this.companyInfoRegion.show(new CompanyInfo(this.options.companyInfo))},oprBtnShow:function(){var self=this;Talent._.each(this.options.oprBtn,function(item,index){var node=document.createElement("li");var iconViewName=item.type;var regionName=iconViewName+"-region";var className="opr-btns "+regionName;$(node).addClass(className);self.ui.btnGroup.prepend(node);self.addRegion(regionName,"."+regionName);self[iconViewName]=new self.viewMapping[iconViewName](item);self[regionName].show(self[iconViewName]);self.listenTo(self[iconViewName],"iconOprEvents",function(resp){self.trigger("iconOprEvents",resp)});self.listenTo(self[iconViewName],"iconClickEvent",function(resp){self.trigger("iconClickEvent",resp)})})},reloadMessage:function(newMsg){this[newMsg.type]["messageRenew"](newMsg)}});return Header});(function(factory){if(typeof define==="function"&&define.amd){define("$.cookie",["jquery"],factory)}else{factory(jQuery)}})(function($){var pluses=/\+/g;function encode(s){return config.raw?s:encodeURIComponent(s)}function decode(s){return config.raw?s:decodeURIComponent(s)}function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value))}function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{s=decodeURIComponent(s.replace(pluses," "));return config.json?JSON.parse(s):s}catch(e){}}function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value}var config=$.cookie=function(key,value,options){if(value!==undefined&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encode(key),"=",stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result=key?undefined:{};var cookies=document.cookie?document.cookie.split("; "):[];for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split("=");var name=decode(parts.shift());var cookie=parts.join("=");if(key&&key===name){result=read(cookie,value);break}if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie}}return result};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)===undefined){return false}$.cookie(key,"",$.extend({},options,{expires:-1}));return!$.cookie(key)}});define("iTalent-sidebar",["talent","$.cookie"],function(Talent){var jst=function(){this["JST"]=this["JST"]||{};this["JST"]["sidebar/bg-slider"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+=""}return __p};this["JST"]["sidebar/multiple-menu-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n\n<a class="list-1st-a" index="'+((__t=index)==null?"":__t)+"\" href='javascript:;'>\n    <span class=\"sd-icon-before "+((__t=iconName)==null?"":__t)+" "+((__t=!newCount?"":"sd-new-message")==null?"":__t)+'" >\n        <span class="red-remind" data-name="feed-all-indicator" ></span>\n    </span>\n    <span class="text">'+((__t=title)==null?"":__t)+'</span>\n    <span class="sd-icon-after"></span>\n</a>\n\n';if(children.length){__p+='\n		<ul class="list-2sd-ul">\n			';Talent._.each(children,function(item,index){__p+='\n					<a \n						class="list-2sd-li '+((__t="ani-item-"+index)==null?"":__t)+" "+((__t=item.type=="iframe"?"is-iframe":"")==null?"":__t)+" "+((__t=item.isActive?"bg-highlight":"")==null?"":__t)+' "\n						href="'+((__t=item.href==""||item.href=="#"||item.type=="iframe"?"javascript:;":item.href)==null?"":__t)+'"\n						index="'+((__t=index)==null?"":__t)+'"\n						target= "'+((__t=item.type=="intLink"?"_self":item.type=="extLink"?"_blank":"")==null?"":__t)+'"\n						data-trigger="'+((__t=item.type=="iframe"?false:"")==null?"":__t)+'">\n\n						'+((__t=item.title)==null?"":__t)+"\n					</a>\n			"});__p+="\n		</ul>\n"}__p+="\n"}return __p};this["JST"]["sidebar/narrow-list-extend"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<ul class="list-narrow-wrapper">\n    ';Talent._.each(menuArry,function(item,superindex){__p+='\n         <li class="list-1st2-li  '+((__t="sp-item-"+superindex)==null?"":__t)+" "+((__t=item.children&&item.children.length?"has-sub-list":"no-sub-list")==null?"":__t)+'">\n            <a \n            class="list-1st2-a '+((__t=item.type=="iframe"?"is-iframe":"")==null?"":__t)+" "+((__t=item.isActive?"shadow-bg":"")==null?"":__t)+'" \n            href="'+((__t=item.href==""||item.href=="#"||item.type=="iframe"?"javascript:void(0)":item.href)==null?"":__t)+'" \n            index="'+((__t=superindex)==null?"":__t)+'"\n            isSuperItem="true"\n            data-trigger="'+((__t=item.type=="iframe"?false:"")==null?"":__t)+'">\n                '+((__t=item.title)==null?"":__t)+'\n                <span class="sd-icon-after" ></span>\n            </a>\n            ';if(item.children&&item.children.length){__p+='\n                <ul class="list-2sd2-ul top-position">\n                    ';Talent._.each(item.children,function(subItem,subIndex){__p+='\n                        <li class="list-2sd2-li '+((__t="ani-index-"+subIndex)==null?"":__t)+" "+((__t=subItem.isActive?"shadow-bg":"")==null?"":__t)+'">\n                        <a \n                            href="'+((__t=subItem.href==""||subItem.href=="#"||subItem.type=="iframe"?"javascript:void(0)":subItem.href)==null?"":__t)+'"\n                            class="shadow-list-a '+((__t=subItem.type=="iframe"?"is-iframe":"")==null?"":__t)+'" \n                            super-name="'+((__t=item.code)==null?"":__t)+'"\n                            sub-name="'+((__t=subItem.code)==null?"":__t)+'"\n                            super-index="'+((__t=superindex)==null?"":__t)+'"\n                            sub-index="'+((__t=subIndex)==null?"":__t)+'"\n                            target= "'+((__t=subItem.type=="intLink"?"_self":subItem.type=="extLink"?"_blank":"")==null?"":__t)+'"\n                            data-trigger="'+((__t=subItem.type=="iframe"?false:"")==null?"":__t)+'">\n                            '+((__t=subItem.title)==null?"":__t)+"\n                        </a>\n                        </li>\n                    "});__p+="\n                </ul>\n            "}__p+="\n        </li>\n    "});__p+="\n</ul>\n"}return __p};this["JST"]["sidebar/side-bar"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n\n<div class="status-switch-wrapper">\n    <span class="status-switch" data-name="switch">\n        <span class="line-1"></span>\n        <span class="line-2"></span>\n        <span class="line-3"></span>\n    </span>\n</div>\n\n<div class="list-outer-wrapper">\n    <ul class="list-1st-ul">\n    	<div class="bg-slider-region"></div>\n    </ul>\n</div>\n\n<div class="list-narrow-extend"></div>\n\n'}return __p};this["JST"]["sidebar/single-menu-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<a class="list-1st-a '+((__t=isActive?"bg-highlight":"")==null?"":__t)+" "+((__t=type=="iframe"?"is-iframe":"")==null?"":__t)+'" \n	href="'+((__t=href==""||href=="#"||type=="iframe"?"javascript:;":href)==null?"":__t)+'" \n	index="'+((__t=index)==null?"":__t)+'" \n	target= "'+((__t=type=="intLink"?"_self":type=="extLink"?"_blank":"")==null?"":__t)+'"\n	data-trigger="'+((__t=type=="iframe"?false:"")==null?"":__t)+'">\n    <span class="sd-icon-before '+((__t=iconName)==null?"":__t)+" "+((__t=newCount?"sd-new-message":"")==null?"":__t)+' " >\n        <span class="red-remind" data-name="feed-all-indicator" ></span>\n    </span>\n    <span class="text">'+((__t=title)==null?"":__t)+"</span>\n</a>"}return __p};return this["JST"]}();var SingleItem=Talent.ItemView.extend({template:jst["sidebar/single-menu-item"],className:"",initialize:function(options){this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render);this.Viewindex=options.index},ui:{memuItem:".list-1st-a"},events:function(){var events={};events["click "+this.ui.memuItem]="menuItemClick";events["mouseenter "+this.ui.memuItem]="itemMouseEnter";events["mouseleave "+this.ui.memuItem]="itemMouseLeave";return events},menuItemClick:function(e){this.trigger("getLayout");this.model.set({newCount:false})},clickType:function(isNarrowLayout){if(isNarrowLayout){this.trigger("pseudoClick",this.model.toJSON())}else{this.trigger("itemClick",this.model.toJSON())}},highlightCancle:function(htInfo){this.model.set({isActive:false})},highlightAdd:function(){this.model.set({isActive:true})},itemMouseEnter:function(){this.triggerData("addClass")},itemMouseLeave:function(){this.triggerData("removeClass")},triggerData:function(classOpr){var data={id:this.model.get("id"),index:this.model.get("index"),isActive:this.model.get("isActive"),classOpr:classOpr};this.trigger("mouse-enter-leave",data)},itemReload:function(newData){newData.isActive=newData.isActive?true:false;newData.newCount=newData.newCount?true:false;newData.index=this.Viewindex;newData.isActive=this.isActive;this.model.clear({silent:true}).set(newData)},setMsgNotice:function(resp){this.model.set({newCount:resp})}});var MultipleItem=Talent.Layout.extend({template:jst["sidebar/multiple-menu-item"],className:"has-sub-list",initialize:function(options){this.options=options;this.viewIndex=options.index;this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render);this.isSubNav=true;this.listIsOpen=false;this.subListHeight=40*this.options.children.length},ui:{menuItem:".list-1st-a",subItem:".list-2sd-li",listWrap:".list-2sd-ul"},events:function(){var events={};events["click "+this.ui.subItem]="subNavClick";events["click "+this.ui.menuItem]="listSwitch";events["mouseenter "+this.ui.menuItem]="superItemEnter";events["mouseleave "+this.ui.menuItem]="superItemLeave";return events},onShow:function(){},listSwitch:function(){this.listIsOpen=!this.listIsOpen;this.$el.toggleClass("open");this.superMenuHighlightSwitch();var highlightChildNode=this.ui.listWrap.find(".bg-highlight");var heightGap=highlightChildNode.length?(parseInt(highlightChildNode.attr("index"))+1)*40:this.subListHeight;var positionY=this.$el.position().top;this.trigger("listSwitch",{top:positionY,subListHeight:heightGap,isOpen:this.listIsOpen,target:this})},subNavClick:function(e){var subIndex=Talent.$(e.target).attr("index");this.trigger("itemClick",this.model.toJSON().children[subIndex])},superMenuHighlightSwitch:function(){var isHasHighLightChild=this.ui.listWrap.find(".bg-highlight").length;this.ui.menuItem[isHasHighLightChild?"addClass":"removeClass"]("bg-highlight")},superItemEnter:function(e){this.dataTrigger("addClass")},superItemLeave:function(){this.dataTrigger("removeClass")},dataTrigger:function(classOpr){var data={id:this.model.get("id"),index:this.model.get("index"),isActive:this.ui.menuItem.hasClass("bg-highlight"),classOpr:classOpr};this.trigger("mouse-enter-leave",data)},listClose:function(){this.listIsOpen=false;this.$el.removeClass("open");this.superMenuHighlightSwitch();var highlightChildNode=this.ui.listWrap.find(".bg-highlight");var heightGap=highlightChildNode.length?(parseInt(highlightChildNode.attr("index"))+1)*40:this.subListHeight;var positionY=this.$el.position().top;this.trigger("listSwitch",{top:positionY,subListHeight:heightGap,isOpen:this.listIsOpen,target:this})},itemReload:function(newData){newData.isActive=newData.isActive?true:false;newData.newCount=newData.newCount?true:false;newData.index=this.viewIndex;this.model.clear({silent:true}).set(newData)},highlightReset:function(p){this.dataArrange({})},highlightAdd:function(p){this.ui.listWrap.find(".ani-item-"+p.cIndex).addClass("bg-highlight")},highlightCancle:function(p){this.$el.find(".bg-highlight").removeClass("bg-highlight")},dataArrange:function(subItem){var newModel=JSON.parse(JSON.stringify(this.model.toJSON()));Talent._.each(newModel.children,function(item,index){item.isActive=item.id==subItem.id?true:false});this.itemReload(newModel)}});var BgSlider=Talent.Layout.extend({template:jst["sidebar/bg-slider"],className:"bg-slider silder-hidden",initialize:function(options){this.positionY=0},sliderAni:function(newStyle){var self=this;this.$el.removeClass("silder-hidden");this.sliderGo(newStyle);setTimeout(function(){self.trigger("aniFinish");self.$el.addClass("silder-hidden")},300)},positionResetSlice:function(newStyle){this.sliderGo(newStyle)},sliderGo:function(style){this.positionY=style.top;this.height=style.height;var transformSupportTest=this.transitionSupport()("transform");var transitionSupportTest=this.transitionSupport()("transition");if(transformSupportTest.isSupport&&transitionSupportTest.isSupport){this.transformGo(style,transformSupportTest.props)}else{this.topGo(style)}},transformGo:function(style,prop){var cssStyle={};cssStyle[prop]="translate3d(0,"+style.top+"px,0)";cssStyle.height=style.height;this.$el.css(cssStyle)},topGo:function(style){this.$el.css({top:style.top,height:style.height})},transitionSupport:function(){var div=document.createElement("div"),vendors="Khtml Ms O Moz Webkit".split(" "),len=vendors.length;return function(prop){if(prop in div.style)return{isSupport:true,props:prop};prop=prop.replace(/^[a-z]/,function(val){return val.toUpperCase()});while(len--){if(vendors[len]+prop in div.style){return{isSupport:true,props:vendors[len]+prop}}}return false}}});var NarrowListExtend=Talent.Layout.extend({template:jst["sidebar/narrow-list-extend"],className:"list-narrow-outer",initialize:function(options){this.options=options;this.model=new Talent.Model(options);this.listenTo(this.model,"change",this.render);this.preHLT=null},ui:{superLi:".no-sub-list .list-1st2-a",subItem:".shadow-list-a",listItem:".list-1st2-li",ListWrap:".list-narrow-wrapper"},events:function(){var events={};events["click "+this.ui.superLi]="superItemClick";events["click "+this.ui.subItem]="subListClick";events["mouseenter "+this.ui.listItem]="showSpread";events["mouseleave "+this.ui.listItem]="hideSpread";return events},showSpread:function(e){var parentNode=$(e.target).parents(".list-1st2-li");parentNode.addClass("list-spread")},hideSpread:function(e){$(e.target).parents(".list-1st2-li").removeClass("list-spread")},superItemClick:function(e){var self=this,highlightNode=$(e.target).parent();highlightNode.removeClass("bg-ripple").addClass("bg-ripple");this.$el.find(".shadow-bg").removeClass("shadow-bg");var index=$(e.target).attr("index");var itemInfo=self.options.menuArry[index];self.trigger("superItemActive",itemInfo);setTimeout(function(){highlightNode.removeClass("bg-ripple list-spread").addClass("shadow-bg")},450)},subListClick:function(e){var self=this;var curNode=$(e.target);this.$el.find(".shadow-bg").removeClass("shadow-bg");curNode.removeClass("bg-ripple").addClass("bg-ripple");var nodeSuperIndex=curNode.attr("super-index");var nodeSubIndex=curNode.attr("sub-index");var superNodeInfo=JSON.parse(JSON.stringify(this.model.toJSON())).menuArry[nodeSuperIndex];var triggerData={superNodeInfo:superNodeInfo,subNodeInfo:superNodeInfo.children[nodeSubIndex]};this.trigger("sublistActive",triggerData);setTimeout(function(){curNode.parents(".list-1st2-li").removeClass("list-spread")},450)},itemSpreade:function(resp){var oprNode=this.$el.find(".sp-item-"+resp.index);oprNode[resp.classOpr]("list-spread");this.$el[resp.classOpr]("extend");this.subListOpen(oprNode,resp)},setScrollTop:function(top){this.ui.ListWrap.css("top",-top);this.positionTop=top},subListOpen:function(node,resp){var ulNode=node.find(".list-2sd2-ul");ulNode.removeClass("bottom-position").addClass("top-position");var itemPosition=node.offset().top;var windowH=$(window).height();var heightGap=windowH-itemPosition-50;var sublistHeight=this.options.menuArry[parseInt(resp.index)].children.length*40;if(heightGap-sublistHeight>20)return;ulNode.addClass("bottom-position").removeClass("top-position")},modelReset:function(p){var self=this;var currentModel=JSON.parse(JSON.stringify(this.model.toJSON()));Talent._.each(currentModel.menuArry,function(item,index){item.isActive=item.id==p.fId?true:false;Talent._.each(item.children,function(subItem,index){subItem.isActive=subItem.id==p.cId?true:false;subItem.isActive&&(item.isActive=true)})});setTimeout(function(){self.model.clear({silent:true}).set(currentModel)},700)},pseudoClick:function(node){this.$el.find(".sp-item-"+node.index).find(".list-1st2-a ").click()},onRender:function(){this.setScrollTop(this.positionTop||0)}});var SideBar=Talent.Layout.extend({template:jst["sidebar/side-bar"],className:"page-sidebar-wrapper page-spread-layout",initialize:function(options){this.options=options;this.isNarrowLayout=false;this.preOpenList=null;this.isFirstInit=true;this.initLayout()},regions:{bgSilderRegion:".bg-slider-region",listNarrowExtend:".list-narrow-extend"},ui:{layoutSwitchBtn:"[data-name='switch']",itemWrapper:"ul.list-1st-ul",btnWrap:".status-switch-wrapper"},events:function(){var events={};events["click "+this.ui.layoutSwitchBtn]="_changeLayout";return events},onRender:function(){this.bgSilder=new BgSlider;this.bgSilderRegion.show(this.bgSilder);this.narrowListExtend=new NarrowListExtend(this.options);this._listExtendListener();this.listNarrowExtend.show(this.narrowListExtend);this._baseViewCreate();this.triggerLayoutStatus()},onShow:function(){this._syncRoll()},_baseViewCreate:function(){var self=this;Talent._.each(this.options.menuArry,function(item,index){if(item.id!==undefined){item.isActive=item.isActive?true:false;item.newCount=item.newCount?true:false;item.index=index;var node=document.createElement("li");var itemViewName="menuItem"+item.id;var regionName=itemViewName+"-region";var className="list-1st-li "+regionName;$(node).addClass(className);self.ui.itemWrapper.append(node);self.addRegion(regionName,"."+regionName);self[itemViewName]=item.children.length?new MultipleItem(item):new SingleItem(item);self.baseViewListener(self[itemViewName]);self[regionName].show(self[itemViewName])}})},baseViewListener:function(baseView){var self=this;this.listenTo(baseView,"itemClick",function(itemInfo){self._triggerHash(itemInfo)});this.listenTo(baseView,"listSwitch",function(listInfo){if(self.bgSilder.positionY>=listInfo.top){var topAdd=listInfo.isOpen?listInfo.subListHeight:-listInfo.subListHeight;var newTop=self.bgSilder.positionY+topAdd;self.bgSilder.positionResetSlice({top:newTop,height:self.bgSilder.height})}if(self.preOpenList&&self.preOpenList!=listInfo.target){self.preOpenList.listClose()}self.preOpenList=listInfo.target});this.listenTo(baseView,"mouse-enter-leave",function(resp){self.isNarrowLayout&&self.narrowListExtend.itemSpreade(resp)});this.listenTo(baseView,"getLayout",function(){baseView.clickType(self.isNarrowLayout)});this.listenTo(baseView,"pseudoClick",function(node){self.narrowListExtend.pseudoClick(node)})},_listExtendListener:function(){var self=this;this.listenTo(this.narrowListExtend,"superItemActive",function(simpleNavInfo){self._triggerHash(simpleNavInfo)});this.listenTo(this.narrowListExtend,"sublistActive",function(p){self._triggerHash(p.subNodeInfo)})},_changeLayout:function(){this.$el.toggleClass("page-spread-layout").toggleClass("page-norrow-layout");this.isNarrowLayout=!this.isNarrowLayout;this.triggerLayoutStatus();var newCk=this.isNarrowLayout?"narrow":"extend";this._createCookie("layoutStatus",newCk,30)},_syncRoll:function(){var self=this;Talent.$(".list-outer-wrapper").scroll(function(top){self.narrowListExtend.setScrollTop(this.scrollTop);var classOpr=this.scrollTop>10?"addClass":"removeClass";self.ui.btnWrap[classOpr]("box-sd")});var windowH=$(window).innerHeight()-95-30;var isAlwaysVisible=this.isOS()?false:true;var slimScroll=Talent.$(".list-outer-wrapper").slimScroll({height:windowH,color:"#000",opacity:.3,size:6,distance:2,alwaysVisible:true,railVisible:false,railColor:"#000",railOpacity:.1,allowPageScroll:false,position:"right"});this.resetScrollArea();this.scrollEvent()},resetScrollArea:function(){var self=this;$(window).on("resize",function(){windowH=window.innerHeight-95-30;Talent.$(".page-sidebar-wrapper .slimScrollDiv").css({height:windowH}).find(".list-outer-wrapper").css({height:windowH})})},scrollEvent:function(){var slimScrollBar=$(".slimScrollBar");var slimScrollRail=$(".slimScrollRail");slimScrollBar.on("mouseenter",function(){slimScrollRail.css({width:12})});slimScrollBar.on("mouseleave",function(){slimScrollRail.css({width:8})})},initLayout:function(){var ck=this._getCookie("layoutStatus");if(ck=="extend"){this.isNarrowLayout=false}else if(ck=="narrow"){this.isNarrowLayout=true}else{var width=Talent.$(window).width();if(width<=1440){this.isNarrowLayout=true}var newCk=this.isNarrowLayout?"narrow":"extend";this._createCookie("layoutStatus",newCk,30)}if(this.isNarrowLayout){this.$el.removeClass("page-spread-layout").addClass("page-norrow-layout")}this.triggerLayoutStatus()},isOS:function(){var isOS=navigator.userAgent.indexOf("Mac",0)!=-1?true:false;return isOS},_createCookie:function(name,value,days){$.cookie(name,value,{expires:30})},_getCookie:function(c_name){return $.cookie(c_name)},getWidth:function(){var w=this.isNarrowLayout?50:200;return{width:w}},triggerLayoutStatus:function(){this.trigger("layoutChanged",{width:this.isNarrowLayout?50:200,isNarrowLayout:this.isNarrowLayout})},_triggerHash:function(hashData){this.trigger("hashChanged",hashData)},menuItemReload:function(resp){this["menuItem"+resp.id]&&this["menuItem"+resp.id].itemReload(resp)},setMsgNotice:function(resp){var msgIndex;if(resp.code){Talent._.each(this.options.menuArry,function(item,index){if(item.code==resp.code){msgIndex=item.index}})}else{Talent._.each(this.options.menuArry,function(item,index){if(item.id==resp.id){msgIndex=item.index}})}this["menuItem"+this.options.menuArry[msgIndex].id].setMsgNotice(resp.newCount)},_getHLTIndex:function(resp){var h={fId:null,fIndex:null,cId:null,cIndex:null};var code=resp.code||null;var id=resp.id||null;if(code!=null){Talent._.each(this.options.menuArry,function(item,index){if(item.code==resp.code){h.fId=item.id;h.fIndex=index}else{Talent._.each(item.children,function(subItem,subIndex){if(subItem.code==resp.code){h.fId=item.id;h.fIndex=index;h.cId=subItem.id;h.cIndex=subIndex}})}})}else if(id!=null){Talent._.each(this.options.menuArry,function(item,index){if(item.id==resp.id){h.fId=item.id;h.fIndex=index}else{Talent._.each(item.children,function(subItem,subIndex){if(subItem.id==resp.id){h.fId=item.id;h.fIndex=index;h.cId=subItem.id;h.cIndex=subIndex}})}})}return h},_goHighLight:function(p){var self=this;this.preHTView&&this.preHTView.highlightCancle(p);if(p.fIndex!=null){var curId=this.options.menuArry[p.fIndex].id;var curView=this["menuItem"+curId];if(curView){var loadTm=this.isFirstInit?0:300;var isSupportCss3=this.bgSilder.transitionSupport()("transform").isSupport;loadTm=isSupportCss3?loadTm:0;setTimeout(function(){curView.highlightAdd(p)},loadTm);this.preHTView=curView;this.narrowListExtend.modelReset(p);var h=p.cIndex==null?50:40;var subTop=p.cIndex==null?0:p.cIndex*40+50;var top=curView.$el.position().top+subTop;if(this.isFirstInit||this.isNarrowLayout){if(curView.isSubNav&&p.fId!=curView.id){curView.listSwitch()}this.bgSilder.positionResetSlice({top:top,height:h})}else{this.bgSilder.sliderAni({top:top,height:h})}this.isFirstInit=false}}if(p.fIndex==null){this.bgSilder.positionResetSlice({top:0,height:50});this.preHTView&&this.preHTView.highlightCancle()}},highLightSet:function(resp){if(resp!=undefined){var pInfo=this._getHLTIndex(resp);this._goHighLight(pInfo)}}});return SideBar});